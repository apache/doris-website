<!doctype html><html lang=zh-Hans-CN dir=ltr class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>61 篇博文 含有标签「Tech Sharing」 - Apache Doris</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://doris.apache.org/zh-CN/blog/tags/tech-sharing/><meta data-rh=true property=og:locale content=zh_Hans-CN><meta data-rh=true property=og:locale:alternate content=en_US><meta data-rh=true name=docusaurus_locale content=zh-CN><meta data-rh=true name=docsearch:language content=zh-CN><meta data-rh=true property=og:title content="61 篇博文 含有标签「Tech Sharing」 - Apache Doris"><meta data-rh=true name=docusaurus_tag content=blog_tags_posts><meta data-rh=true name=docsearch:docusaurus_tag content=blog_tags_posts><link data-rh=true rel=icon href=/zh-CN/images/favicon.ico><link data-rh=true rel=canonical href=https://doris.apache.org/zh-CN/blog/tags/tech-sharing/><link data-rh=true rel=alternate href=https://doris.apache.org/blog/tags/tech-sharing/ hreflang=en-US><link data-rh=true rel=alternate href=https://doris.apache.org/zh-CN/blog/tags/tech-sharing/ hreflang=zh-Hans-CN><link data-rh=true rel=alternate href=https://doris.apache.org/blog/tags/tech-sharing/ hreflang=x-default><link rel=alternate type=application/rss+xml href=/zh-CN/blog/rss.xml title="Apache Doris RSS Feed"><link rel=alternate type=application/atom+xml href=/zh-CN/blog/atom.xml title="Apache Doris Atom Feed"><link rel=preconnect href=https://analytics.apache.org/><script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://analytics.apache.org/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","43"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel=stylesheet href=/css/katex.min.css><script src=/js/custom-script.js></script><script async src=https://widget.kapa.ai/kapa-widget.bundle.js data-website-id=a5fb90df-217a-4097-95c0-80490220314b data-modal-title="Apache Doris AI" data-project-name="Apache Doris Website" data-button-hide=true data-modal-override-open-selector=#navbar-ask-ai-btn data-project-logo=https://cdn.selectdb.com/static/doris_1_3c42247c63.png data-modal-image=https://cdn.selectdb.com/static/doris_logo_cc5a30d886.png data-project-color=#11A679 data-modal-disclaimer="This is a custom LLM with access to all [Doris documentation](https://doris.apache.org/docs/4.x/gettingStarted/what-is-apache-doris)." data-consent-required data-consent-screen-disclaimer="By clicking &amp;quot;I agree, let's chat&amp;quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies." data-bot-protection-mechanism=hcaptcha></script><link rel=stylesheet href=/zh-CN/assets/css/styles.927db6f2.css><script src=/zh-CN/assets/js/runtime~main.0e33774b.js defer></script><script src=/zh-CN/assets/js/main.d5f9a343.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id=__docusaurus><div role=region aria-label=跳到主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><div class=navbar-left><div class="navbar-logo-wrapper flex items-center"><a class=navbar__brand href=/zh-CN/><div class=navbar__logo><img src=/zh-CN/images/logo-doris.svg alt="Apache Doris" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/zh-CN/images/logo-doris.svg alt="Apache Doris" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class=undefined><a href=/zh-CN/docs/4.x/gettingStarted/what-is-apache-doris/ class="navbar__item navbar__link" target=_blank>Docs</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/zh-CN/blog/>Blog</a><a class="navbar__item navbar__link" href=/zh-CN/users/>Users</a><a href=https://github.com/apache/doris/discussions target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Discussions</a><a class="navbar__item navbar__link" href=/zh-CN/ecosystem/cluster-management/>Ecosystem</a><a class="navbar__item navbar__link" href=/zh-CN/events/>Events</a><a class="navbar__item navbar__link" href=/zh-CN/community/join-community/>Community</a><a class="navbar__item navbar__link" href=/zh-CN/vendors/>Vendors</a></div></div></div><div class="navbar__items navbar__items--right"><button class="rounded-full flex items-center gap-x-2 px-4 py-[5px] border border-primary bg-[#F0FFF7] text-[1rem]/[1.625rem] font-medium text-[#1D1D1D]" id=navbar-ask-ai-btn><svg width=18 height=18 viewBox="0 0 18 18" fill=none><path d="M7.35457 0.574461C7.42306 0.423027 7.5322 0.292956 7.67018 0.198317C7.80816 0.103677 7.96974 0.04807 8.13742 0.037509C8.30511 0.026948 8.47253 0.0618351 8.62158 0.138397C8.77063 0.21496 8.89564 0.330283 8.98308 0.471896L9.03778 0.574461L9.98672 2.68378C10.8161 4.52515 12.1952 6.07276 13.9397 7.11968L14.2337 7.28972L15.9197 8.2263C16.0536 8.30049 16.1666 8.40653 16.2484 8.53479C16.3302 8.66304 16.3783 8.80945 16.3882 8.96069C16.3981 9.11194 16.3696 9.26323 16.3052 9.40083C16.2408 9.53842 16.1426 9.65796 16.0195 9.74857L15.921 9.81064L14.2337 10.7472C12.454 11.7355 11.0224 13.2365 10.1303 15.0495L9.98672 15.3532L9.03641 17.4625C8.96778 17.6136 8.85866 17.7433 8.72081 17.8377C8.58296 17.9321 8.42162 17.9876 8.25418 17.9982C8.08674 18.0087 7.91956 17.9739 7.77066 17.8976C7.62177 17.8213 7.49681 17.7063 7.40926 17.565L7.35457 17.4625L6.40426 15.3532C5.57484 13.5118 4.19572 11.9643 2.45124 10.9173L2.15726 10.7472L0.471311 9.81064C0.337321 9.73674 0.224189 9.63093 0.142217 9.50285C0.0602439 9.37477 0.0120344 9.22849 0.00197753 9.07732C-0.00807937 8.92615 0.0203358 8.7749 0.0846359 8.63734C0.148936 8.49978 0.247078 8.38028 0.370127 8.28972L0.468577 8.22765L2.15589 7.29107C3.93569 6.30285 5.36732 4.80183 6.25932 2.98877L6.40289 2.68513L7.3532 0.57581L7.35457 0.574461ZM15.6899 0.130465C16.1425 1.14532 16.9145 1.98914 17.8914 2.53668C17.9244 2.55517 17.9518 2.58196 17.9709 2.61432C17.9899 2.64668 18 2.68345 18 2.72089C18 2.75833 17.9899 2.7951 17.9709 2.82745C17.9518 2.85981 17.9244 2.8866 17.8914 2.9051C16.9145 3.45264 16.1425 4.29645 15.6899 5.31131C15.6731 5.3501 15.645 5.38315 15.6093 5.40638C15.5736 5.4296 15.5317 5.44198 15.4889 5.44198C15.4462 5.44198 15.4043 5.4296 15.3686 5.40638C15.3329 5.38315 15.3048 5.3501 15.2879 5.31131C14.8352 4.29695 14.0632 3.45364 13.0865 2.90645C13.0532 2.88805 13.0255 2.86122 13.0062 2.82872C12.9869 2.79622 12.9767 2.75923 12.9767 2.72156C12.9767 2.68389 12.9869 2.6469 13.0062 2.6144C13.0255 2.58191 13.0532 2.55508 13.0865 2.53668C14.0636 1.98879 14.8357 1.14448 15.2879 0.129116C15.305 0.0907214 15.3331 0.0580664 15.3686 0.035138C15.4042 0.0122096 15.4458 0 15.4883 0C15.5308 0 15.5723 0.0122096 15.6079 0.035138C15.6435 0.0580664 15.6715 0.0907214 15.6886 0.129116V0.130465H15.6899Z" fill=#11A679 /></svg>Ask AI</button><a class="navbar__item navbar__link header-right-button-primary navbar-download-mobile" href=/zh-CN/download/>Download</a><a href=https://github.com/apache/doris target=_blank rel="noopener noreferrer" class="github-btn bg-[#F7FAFC] mr-1 group !no-underline ml-4 rounded-sm items-center justify-start desktop h-[2.25rem] w-[6.5rem]"><svg id=github-icon-new class="github-icon-new ml-[0.5rem]" width=22 height=22 viewBox="0 0 22 22" fill=none><path d="M11.0001 0.998095C5.47563 0.998095 1.00024 5.47348 1.00024 10.9979C1.00024 15.4224 3.86293 19.1606 7.83742 20.4851C8.33741 20.5723 8.52468 20.2733 8.52468 20.0105C8.52468 19.7724 8.51286 18.9851 8.51286 18.1478C6.00017 18.6106 5.35018 17.5351 5.15018 16.9733C5.03746 16.6851 4.55019 15.7979 4.12565 15.5606C3.77566 15.3724 3.27476 14.9106 4.11293 14.8979C4.90019 14.8852 5.4629 15.6224 5.65018 15.9233C6.55016 17.4351 7.98741 17.0106 8.56286 16.7479C8.65013 16.0979 8.91285 15.6606 9.20012 15.4106C6.9747 15.1606 4.65019 14.2979 4.65019 10.4725C4.65019 9.38524 5.03746 8.48526 5.67563 7.78527C5.57472 7.53527 5.22473 6.51074 5.77563 5.13531C5.77563 5.13531 6.61289 4.87349 8.52468 6.16074C9.33873 5.93489 10.1798 5.82141 11.0246 5.82348C11.8755 5.82348 12.7255 5.93529 13.5246 6.16074C15.4373 4.86076 16.2746 5.13531 16.2746 5.13531C16.8246 6.51074 16.4755 7.53527 16.3755 7.78527C17.0127 8.48526 17.4 9.37342 17.4 10.4725C17.4 14.3106 15.0628 15.1606 12.8373 15.4106C13.2001 15.7233 13.5128 16.3233 13.5128 17.2606C13.5128 18.5978 13.5001 19.6733 13.5001 20.0105C13.5001 20.2733 13.6873 20.5851 14.1873 20.4851C18.1373 19.1606 20.9999 15.4106 20.9999 10.9979C20.9999 5.47348 16.5255 0.998095 11.0001 0.998095Z" fill=#1D1D1D /></svg><span class="github-text ml-1 text-[1rem]/[137.5%] group-hover:text-primary text-[#252734] font-medium">Star Me</span></a><div class="gh-count text-[1rem]/[1rem]">15<!-- -->k</div><a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer" class="slack-btn desktop header-right-button-slack"></a><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class="header-right-button-primary navbar-download-desktop font-medium" href=/zh-CN/download/>Download</a></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_eExm"><div class="mb-[4.875rem] container"><div class="lg:row lg:flex"><main class="col col--9 col--offset-1" itemscope itemtype=http://schema.org/Blog><header class=margin-bottom--xl><h1>61 篇博文 含有标签「Tech Sharing」</h1><a href=/zh-CN/blog/tags/>查看所有标签</a></header><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/variant-tech-deepdive-202601/>Fast JSON Analytics in Apache Doris: 100x Faster Than PostgreSQL and MongoDB</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-12-26T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年12月26日</time></div></header><div class=markdown itemprop=articleBody><p>import { BlogLink } from '../src/components/blogs/components/blog-link';
import { SeeMore } from '../src/components/blogs/components/see-more';</p>
<blockquote>
<p><bloglink rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/fast-json-analytics-in-apache-doris-100x-faster-than-postgresql-and-mongodb>Apache Doris uses the VARIANT data type to deliver flexible, high-performance JSON handling, thanks to features like dynamic subcolumns, sparse columns, schema templates, lazy materialization, and path-based indexing. <seemore></seemore></bloglink></p>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/apache-doris-min-io/>Deploying Apache Doris with MinIO: Analytics with Storage-Compute Separation</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-12-08T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年12月8日</time></div></header><div class=markdown itemprop=articleBody><p>import { BlogLink } from '../src/components/blogs/components/blog-link';
import { SeeMore } from '../src/components/blogs/components/see-more';</p>
<blockquote>
<p><bloglink rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/deploying-apache-doris-with-minio>In the Apache Doris + MinIO architecture, Apache Doris handles compute, MinIO handles storage, and the result is a modern analytics architecture that’s fast, scalable, cost-efficient, and separates compute from storage. <seemore></seemore></bloglink></p>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Doris-onelake-fabric-integration/>From OneLake to Insights: Building Modern Analytics with Apache Doris and Microsoft Fabric</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-11-17T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年11月17日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/connect-apache-doris-and-microsoft-fabric-and-onelake>Connect Apache Doris to Microsoft Fabric’s OneLake, the unified data lake behind Fabric. See how to set up data and authentication in Fabric, creating an Iceberg REST Catalog in Doris, and query OneLake tables without data movement.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Doris-tops-jsonbench-in-cold-queries/>Apache Doris Tops JSONBench in Cold Queries and Data Quality</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-11-06T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年11月6日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/apache-doris-tops-json-bench-cold-queries>Apache Doris has topped the latest JSONBench benchmark. Apache Doris ranks first in cold query performance and data quality, and ranks second in hot queries.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Doris-70-better-on-graviton/>Apache Doris Achieves 70% Better Price-Performance on ARM-based AWS Graviton</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-10-31T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年10月31日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/apache-doris-achieves-70-better-price-performance>We benchmarked Apache Doris on ARM-based AWS Graviton against x86 instances across five industry-standard OLAP tests (ClickBench, SSB 100G, SSB-Flat, TPC-H, and TPC-DS), and found Doris running on ARM-based Graviton consistently delivered 54%–70% higher price-performance.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Doris-34x-than-ck-real-time-updates/>Apache Doris Up to 34x Faster Than ClickHouse in Real-Time Updates</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-10-01T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年10月1日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/apache-doris-34x-faster-clickhouse-realtime-updates>We benchmarked Apache Doris against ClickHouse on ClickBench and SSB (Star Schema Benchmark), under fair resource allocations in each product's cloud services. Results: Apache Doris is 18-34x faster than ClickHouse in SSB and 2.5-4.6x faster than ClickHouse in ClickBench.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/data-pruning-250908/>Deep Dive: Data Pruning in Apache Doris</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-09-08T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年9月8日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1489>At Apache Doris, we have implemented multiple strategies to make the system more intelligent, enabling it to skip unnecessary data processing. In this article, we will discuss all the data pruning techniques used in Apache Doris.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/coffeebench-part2-250917/>Apache Doris Up To 40x Faster Than ClickHouse | OLAP Showdown Part 2</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-09-07T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年9月7日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1504>In every benchmark tested: CoffeeBench, TPC-H, and TPC-DS, Apache Doris consistently pulled ahead, establishing clear dominance over both ClickHouse v25.8 on-premises and ClickHouse Cloud.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/data-trait-250905/>Data Traits in Apache Doris: The Secret Weapon Behind 2x Faster Performance</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-09-05T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年9月5日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1488>At the core of database systems, the query optimizer acts as a shrewd strategist, constantly analyzing data traits to devise the optimal execution plans. Apache Doris, a high-performance MPP analytical database, employs a built-in Data Trait analysis mechanism in its optimizer. By uncovering statistical traits and semantic constraints within the data, Data Trait provides fundamental support for query optimization. Let’s explore its power!<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/rtabench-250902/>Apache Doris Tops RTABench, 6x Faster Than ClickHouse, 30x Faster Than PostgreSQL</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-09-02T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年9月2日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1465>Apache Doris, a popular real-time data warehouse, ranked first in the latest RTABench results, setting a new benchmark for real-time analytics performance. In standardized tests, Doris delivered up to 6 times the performance of ClickHouse, 30 times that of PostgreSQL, and 100 times that of MongoDB.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/coffeebench-olap-showdown-part1-250829/>The Ultimate OLAP Showdown: Apache Doris vs. ClickHouse vs. Snowflake (Part 1)</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-08-29T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年8月29日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1463>Apache Doris consistently delivers significantly faster performance in large-scale benchmarks spanning both straightforward JOINs and production-grade TPC-H/TPC-DS workloads. On top of that, Apache Doris requires just 10%-20% of the cost of Snowflake or ClickHouse for OLAP workloads.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/real-time-data-analytics-at-scale-integrating-apache-flink-and-doris/>Real-time Data Analytics at Scale: Integrating Apache Flink and Doris</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-08-18T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年8月18日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1453>In this article, we'll discuss the main technical use cases of Flink Doris Connector and Flink CDC, showing a complete playbook to combine Flink's real-time processing with Doris's fast analytics.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/real-time-analytical-data-platform-for-the-agentic-ai-era/>Apache Doris + MCP: The Real-Time Analytical Data Platform for the Agentic AI Era</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-08-11T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年8月11日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1444>Apache Doris is built to meet the data challenges in the agentic AI era, delivering real-time analytics at scale. But to use Doris's power for AI agents, you need a bridge between them. That's where Doris MCP Server comes in, acting as a communication layer between AI agents and Doris.In this article, we'll explore how agentic AI is rewriting the rules for analytics, how MCP connects AI agents to data sources, and walk through two demos that bring AI agents, MCP, and Apache Doris together in action.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/apache-doris-empowered-5G-fully-connected-factory-with-a-unified-real-time-data-platform/>Apache Doris Empowered 5G Fully-Connected Factory with A Unified Real-time & Batch Data Platform</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-08-08T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年8月8日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1446>One of the world's biggest telecommunication companies replaced the Lambda architecture with a unified real-time & batch data platform powered by Apache Doris for its 5G Fully-Connected Factory. Leveraging Doris's federated query capabilities, this platform established a unified query gateway and simplified data pipelines, significantly reducing storage costs, improving data freshness, and boosting query performance and development efficiency. Currently, Doris handles 70% of real-time data ingestion and 90% of real-time queries.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/stability-at-scale-how-apache-doris-handles-pressure/>Stability at Scale: How Apache Doris Handles Pressure</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-08-08T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年8月8日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1449>This article takes you under the hood of Apache Doris, a popular real-time data warehouse, to see how it tackles stability challenges: managing massive data volumes and high concurrency, handling diverse analytical workloads, and coping with the pressure of rapid iteration. We'll also highlight engineering practices that any team can adapt to make their systems more resilient.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/telecom-giant-journey-from-clickhouse-to-apache-doris-13pb-in-one-table/>Journey of telecom giant from ClickHouse to Apache Doris: 13PB in one table</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-08-04T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年8月4日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1440>An enterprise big data platform of leading telecommunication company, StreamCloud, chose Apache Doris as its core database solution for ingesting and querying trillions of incremental data daily. Currently, this solution has been deployed in more than ten production scenarios. The largest cluster is deployed on 117 high-performance server nodes and has been operating stably for over six months. Its single table contains over 13 petabytes of raw data and 534 trillion records, maintaining a daily data ingestion of about 145TB and peak loads of about 158TB during holidays.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/real-time-update-deep-dive/>Why Apache Doris excels at OLAP: a deep dive into real-time update technology</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-07-25T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年7月25日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1431>Apache Doris is all about making real-time analytics faster, smoother, and more adaptable for modern data needs. For primary key tables, Apache Doris delivers seamless UPSERT semantics, leveraging primary key indexes and a mark-for-deletion mechanism to ensure top-notch write performance and low-latency queries. Plus, its user-defined conflict resolution boosts concurrency for real-time writes, while fast Schema Change functionality keeps data flows uninterrupted. Flexible column updates and options further empower a wide range of real-time use cases with ease.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/from-clickhouse-to-doris-trillion-log-scale-analytics/>From ClickHouse to Apache Doris: Powering Trillion-Log-Scale Analytics at a Leading Music Streaming Service</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-07-17T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年7月17日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1429>A major music streaming platform successfully migrated its massive 2PB log analytics from ClickHouse to Apache Doris, achieving up to 7x faster searches, 30% lower P99 query latency, 2.5x higher concurrency, and significant operational savings.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/building-real-time-lakehouse-with-apache-doris/>Building Real-Time Lakehouse with Apache Doris: A Practical Guide</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-07-15T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年7月15日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1428>The Lakehouse is a data management paradigm that combines the advantages of data lakes and data warehouses. Apache Doris advances this concept with its core philosophies of Boundless Data, Seamless Lakehouse. This article takes a deeper dive into its typical application scenarios to help readers better understand and apply its capabilities.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/from-elasticsearch-to-doris-boosting-queries-by-56x/>From Elasticsearch to Apache Doris: How a Leading Payment Platform Upgraded its Financial Security Analytics, Boosting Queries by 56x</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-07-13T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年7月13日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1427>A leading payment platform, handling over 600 million daily security events, replaced its Elasticsearch and Hudi stack with Apache Doris. This move achieved up to 56x faster queries, 50% lower storage costs, and 58% higher write throughput, while simplifying architecture and boosting developer efficiency.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/1-billion-json-records-1-second-query-response/>1 Billion JSON Records, 1-Second Query Response</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · Xiaolei, Apache Doris Committer</span></span><time datetime=2025-07-02T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年7月2日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1422>Who reigns over JSONBench? Apache Doris ranks among the top-performers, second only to two versions of Clickhouse (the maintainer of JSONBench itself). After some simple tuning, Apache Doris outperforms ClickHouse by 39%.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/emqx-apache-doris-ecosystem-for-iot-analytics/>EMQX now supports real-time data ingestion into Apache Doris for efficient IoT analytics</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-07-02T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年7月2日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1422>Apache Doris data integration is an out-of-the-box feature in EMQX, which enables complex business development through simple configuration. In a typical IoT application, EMQX, as the IoT platform, is responsible for device connection and transmitting messages. Apache Doris, as the data storage platform, is responsible for storing device status and metadata, as well as message data storage and data analysis. Using EMQX and Apache Doris, users can build high-performance, reliable, and scalable IoT applications that deliver an end-to-end solution from data acquisition through analytics to actionable intelligence.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/apache-doris-the-data-lakehouse-evolution/>The data lakehouse evolution: why Apache Doris is leading the way</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · Rayner Chen, Apache Doris PMC Chair</span></span><time datetime=2025-06-30T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月30日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1411>As enterprises push forward with building a lakehouse architecture, they often face complex challenges. Apache Doris aims to facilitate this process. It offers easy data access (from Hive, Iceberg, Hudi, Paimon), an extensible connector framework (with Kudu, BigQuery, Delta Lake, Kafka, and Redis) and convenient cross-source data processing with high analytics performance. It also allows easy deployment, a rich set of data storage and management capabilities, and strong support for open table formats and file formats.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/community-voice-2025-how-do-you-choose-between-doris-and-clickhouse/>Community Voice | It’s 2025: How Do You Choose Between Doris and ClickHouse?</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Medium · Zen Hua</span></span><time datetime=2025-06-30T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月30日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://medium.com/@ith321.vip/its-2025-how-do-you-choose-between-doris-and-clickhouse-7d98456d9199>Those in favor of ClickHouse argued for its superior performance, while those supporting Doris emphasized its comprehensive ecosystem and high usability.Ultimately, it took us nearly two months of comprehensive testing to make a decision…<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/community-voice-cut-costs-and-boost-efficiency-how-doriss-unified-lakehouse-breaks-down-data-silos/>Community Voice | Cut Costs and Boost Efficiency! How Doris’s Unified Lakehouse Breaks Down Data Silos</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Medium · Hayden</span></span><time datetime=2025-06-29T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月29日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://medium.com/@hhj19075/cut-costs-and-boost-efficiency-how-doriss-unified-lakehouse-breaks-down-data-silos-bfb1c9cd079a>By leveraging Multi‑Catalog and an extensible connector framework, Doris seamlessly connects to all major data systems and formats — Hive, Iceberg, Hudi, Paimon, LakeSoul, Elasticsearch, MySQL, Oracle, SQL Server, and more.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/community-voice-doris-breaking-down-the-barriers-of-sql-dialects-and-building-a-unified-data-query-ecosystem/>Community Voice | Breaking Down the Barriers of SQL Dialects and Building a Unified Data Query Ecosystem</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">dev.to · Darren XU</span></span><time datetime=2025-06-28T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月28日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://dev.to/darren_xu/doris-breaking-down-the-barriers-of-sql-dialects-and-building-a-unified-data-query-ecosystem-37k1>Apache Doris, with its robust SQL dialect compatibility capabilities, has shattered this barrier and constructed a unified data query ecosystem for users.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/community-voice-doris-lakehouse-integration/>Community Voice | Doris Lakehouse Integration: A New Approach to Data Analysis</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">DZone · Darren XU</span></span><time datetime=2025-06-27T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月27日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://dzone.com/articles/doris-lakehouse-integration>Doris Lakehouse Integration bridges data lakes and warehouses and enables seamless access, faster queries, unified management, and greater data value.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/community-voice-lakehouse-manus-mcp-lets-talk-about-lakehouse/>Community Voice | Lakehouse: Manus? MCP? Let’s Talk About Lakehouse and AI</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">DZone · Mingyu Chen, Apache Doris PMC Chair</span></span><time datetime=2025-06-27T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月27日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://dzone.com/articles/lakehouse-manus-mcp-lets-talk-about-lakehouse>The data analytics domain is no exception — Databricks, Snowflake, and Elasticsearch have all redefined themselves as AI data platforms or AI-ready data analytics and search products. Setting aside the “hype”, in today’s article, we’ll explore what relationship actually exists between Lakehouse and AI.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/community-voice-lakehouse-starting-with-apache-doris-s3-tables/>Community Voice | Lakehouse: Starting With Apache Doris and S3 Tables</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Medium · Mingyu Chen, Apache Doris PMC Chair</span></span><time datetime=2025-06-26T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月26日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://medium.com/@morningman.cmy/lakehousewbd-1-starting-with-apache-doris-s3-tables-10c98ae39fe1>Based on data sharing, diverse workloads and collaboration, Lakehouse has brought us a new paradigm for data analysis. S3 Tables further simplify the setup and maintenance of underlying storage facilities on this basis, achieving a nearly out-of-the-box effect. <span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/community-voice-when-doris-meets-iceberg/>Community Voice | When Doris Meets Iceberg: A Redemption of a Data Engineer</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">DZone · Zen Hua</span></span><time datetime=2025-06-25T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月25日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://dzone.com/articles/when-doris-meets-iceberg>Apache Doris and Iceberg are redefining the way data lakes work. It's not just a simple 1 plus 1 equals to 2; it brings a qualitative leap!<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/apache-doris-and-deepseek-community-voice/>Community Voice | Apache Doris and DeepSeek: Redefining Intelligent Data Analytics</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Medium · DarrenXu</span></span><time datetime=2025-06-20T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月20日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://medium.com/%40xudarren1023/apache-doris-and-deepseek-redefining-intelligent-data-analytics-2b6b778e1034>This article will focus on the in — depth integration of Apache Doris and DeepSeek, and will analyze in detail its technical implementation, optimization strategies, application scenarios, and future trends. It is hoped that through this content, you can comprehensively understand the potential of this combination and find a practical path suitable for your business.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/doris-introduction-community-voice/>Community Voice | Introduction to Apache Doris</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">baeldung.com · Hannah Igboke</span></span><time datetime=2025-06-20T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月20日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.baeldung.com/sql/apache-doris-tutorial>With Apache Doris, we now have a comprehensive solution as a high-performance analytical database. In this tutorial, we’ll explore what makes Doris different, how it works, the ecosystem and tooling, and whether it deserves a place in your data stack.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/which-powers-observability-better/>Elasticsearch vs ClickHouse vs Apache Doris — which powers observability better?</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2025-06-17T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月17日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href=https://www.velodb.io/blog/1406>A side-by-side comparison of observability solutions in terms of performance, cost, usability, and ecosystem openness. This article also introduces Apache Doris as a powerful observability solution, supported by live demos and real-world user success stories.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/elasticsearch-vs-apache-doris-community-voice/>Community Voice: Elasticsearch vs. Apache Doris</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">LinkedIn · Rahul Kolluri</span></span><time datetime=2025-06-10T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年6月10日</time></div></header><div class=markdown itemprop=articleBody><blockquote>
<a class=blog-item-link rel="noopener noreferrer" target=_blank href="https://www.linkedin.com/posts/rahul-kolluri-352447191_rethinking-elasticsearch-for-analytics-activity-7333804955700473859-2-e4?utm_source=share&utm_medium=member_desktop&rcm=ACoAACoH8OcBYW4CFSr632eidBaUEb5u1O2r30o"> Listen to what users say! Rahul Kolluri has provided a detailed technical comparison between Elasticsearch and Apache Doris based on real-world billing analytics scenarios. Based on his experience building dashboards and backend APIs around AWS usage and billing data, he saw Elasticsearch hit major limits when used for analytics.<span style=color:var(--ifm-color-primary);display:inline-flex;align-items:center;gap:4px>see more <svg width=1rem height=1rem viewBox="0 0 18 18" fill=none><path d="M14.8497 8.99993L14.8497 14.5349C14.8497 14.8332 14.6079 15.0749 14.3097 15.0749H3.68966C3.39142 15.0749 3.14966 14.8332 3.14966 14.5349V3.46493C3.14966 3.16669 3.39142 2.92493 3.68966 2.92493H8.53166" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M11.4746 2.92493H14.3096C14.6078 2.92493 14.8496 3.16669 14.8496 3.46493V6.29993" stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round /><path d="M13.9944 3.82495L8.90322 8.91612" stroke=currentColor stroke-width=1.5 stroke-linecap=round /></svg></span></a>
</blockquote></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/why-apache-doris-is-best-alternatives-for-real-time-analytics/>Why Apache Doris is a Better Alternative to Elasticsearch for Real-Time Analytics</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Medium · Kang, Apache Doris PMC Member</span></span><time datetime=2025-03-25T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年3月25日</time></div></header><div class=markdown itemprop=articleBody><p>The author previously presented this topic at the VeloDB Webinar. This article expands on that presentation by providing more detailed comparative information, including test data and in-depth technical explanations: <a href="https://www.youtube.com/embed/qnxX-FOd8Wc?si=TcEF_w-XhqgQyP4A" target=_blank rel="noopener noreferrer">https://www.youtube.com/embed/qnxX-FOd8Wc?si=TcEF_w-XhqgQyP4A</a></p>
<p>In the past year, there's an increasing number of users looking to use Apache Doris as an alternative to Elasticsearch, so I'd like to provide an in-depth comparison of the two to serve as a reference for users.</p>
<p><a href=https://doris.apache.org target=_blank rel="noopener noreferrer">Apache Doris</a> is a real-time data warehouse commonly used for observability, cyber security analysis, online reports, customer profiles, data lakehouse and more. <a href=https://www.elastic.co/elasticsearch target=_blank rel="noopener noreferrer">Elasticsearch</a> is more like a search engine, but it is also widely used for data analytics, so there's an overlap in their use cases. The comparison in this post will focus on the real-time analytics capabilities of Apache Doris and Elasticsearch from a user-oriented perspective:</p>
<ol>
<li><strong>Open source</strong></li>
<li><strong>System architecture</strong></li>
<li><strong>Real-time writes</strong></li>
<li><strong>Real-time storage</strong></li>
<li><strong>Real-time queries</strong></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=open-source>Open source<a href=#open-source class=hash-link aria-label="Open source的直接链接" title="Open source的直接链接">​</a></h2>
<p>The license decides the level of openness of an open source product, and further decides whether users will be trapped in a vendor lock-in situation.</p>
<p><strong>Apache Doris</strong> is operated under the Apache Software Foundation and it is governed by <a href=https://www.apache.org/licenses/LICENSE-2.0.html target=_blank rel="noopener noreferrer">Apache License 2.0</a>. This is a highly liberal open source license. Anyone can freely use, modify, and distribute Apache Doris in open source or commercial projects.</p>
<p><strong>Elasticsearch</strong> has undergone several changes in licenses. It was subject to Apache License 2.0 at the very beginning. Then in <a href=https://www.elastic.co/blog/licensing-change target=_blank rel="noopener noreferrer">2021</a>, it switched to the <a href=https://www.elastic.co/licensing/elastic-license target=_blank rel="noopener noreferrer">Elastic License</a> and <a href=https://www.mongodb.com/licensing/server-side-public-license target=_blank rel="noopener noreferrer">SSPL</a>, mostly because some cloud service providers were providing Elasticsearch as a managed service. The Elastic company tried to protect its business interests and moved to the Elastic License in order to restrict certain commercial use. And then in 2024, Elasticsearch announced that <a href=https://www.elastic.co/blog/elasticsearch-is-open-source-again target=_blank rel="noopener noreferrer">"Elasticsearch Is Open Source. Again!"</a> by adding the AGPL License. This license has less restrictions on cloud providers.</p>
<p>The difference in licenses reflects the differing ways in which the two open-source projects are managed and operated. Apache Doris is operated under the Apache Software Foundation and adheres to "the Apache Way" and maintains vendor neutrality. It will always be under Apache License and maintain a high level of openness. Elasticsearch is owned and run by the Elastic company, so it is free to change its license based on the changing needs of the company.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=system-architecture>System architecture<a href=#system-architecture class=hash-link aria-label="System architecture的直接链接" title="System architecture的直接链接">​</a></h2>
<p>The system architecture of Apache Doris and Elasticsearch is relevant to how users can deploy them and the software/hardware prerequisites that must be met.</p>
<p><strong>Apache Doris</strong> supports various deployment models, especially after the <a href=https://doris.apache.org/blog/release-note-3.0.0 target=_blank rel="noopener noreferrer">release of verion 3.0</a>. It can be deployed on-premise the traditional way, which means compute and storage are integrated within the same hardware. It can also be deployed with <a href=https://doris.apache.org/docs/3.0/compute-storage-decoupled/overview target=_blank rel="noopener noreferrer">compute and storage decoupled</a>, providing higher flexibility and elasticity.</p>
<p><img decoding=async loading=lazy alt="System architecture.jpeg" src=/zh-CN/assets/images/System-architecture-00b81da315da4b5ca4041d6377cbe866.jpeg width=1280 height=415 class=img_ev3q></p>
<p>Apache Doris enables the isolation of computing workloads, which makes it well-suited for multi-tenancy. In addition to decoupling compute and storage, it also provides tiered storage so you can choose different storage medium for your hot and cold data.</p>
<p>For workload isolation, Apache Doris provides the <a href=https://doris.apache.org/docs/3.0/admin-manual/workload-management/compute-group target=_blank rel="noopener noreferrer">Compute Group</a> and <a href=https://doris.apache.org/docs/3.0/admin-manual/workload-management/workload-group target=_blank rel="noopener noreferrer">Workload Group</a> mechanism.</p>
<p><img decoding=async loading=lazy alt="System architecture-2.png" src=/zh-CN/assets/images/System-architecture-2-468364f6130920aa606189ac151ccf47.png width=1120 height=552 class=img_ev3q></p>
<p>Compute Group is a mechanism for physical isolation between different workloads in a compute-storage decoupled architecture. One or more BE nodes can form a Compute Group.</p>
<p><img decoding=async loading=lazy alt="System architecture-3.png" src=/zh-CN/assets/images/System-architecture-3-2c6a79b4e7b8b2e3b939e951efd25bbc.png width=1280 height=438 class=img_ev3q></p>
<p>Workload Group is an in-process mechanism for isolating workloads. It achieves resource isolation by finely partitioning or limiting resources (CPU, IO, Memory) within the BE process, which is implemented by Linux CGroup and offers strict hard isolation.</p>
<p><strong>Elasticsearch</strong> supports on-premise and cloud deployment. It does not support compute-storage decoupling. Elasticsearch implements workload isolation by Thread Groups, which provides limited soft resource isolation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=real-time-writes>Real-time writes<a href=#real-time-writes class=hash-link aria-label="Real-time writes的直接链接" title="Real-time writes的直接链接">​</a></h2>
<p>The next step after deploying the system is to write data into it. Apache Doris and Elasticsearch are very different in data ingestion.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=write-capabilities>Write capabilities<a href=#write-capabilities class=hash-link aria-label="Write capabilities的直接链接" title="Write capabilities的直接链接">​</a></h3>
<p>Normally there are two ways to write real-time data into a data system. One is push-based, and the other is pull-based. A push-based method means users actively push the data into the database system, such as via HTTP. A pull-based method, for example, is where database system pulls data from data source such as Kafka message queue.</p>
<p><strong>Elasticsearch</strong> supports push-based ingestion, but it requires Logstash to perform pull-based data ingestion, making it less convenient.</p>
<p>As for <strong>Apache Doris</strong>, it supports both push-based method (HTTP <a href=https://doris.apache.org/docs/3.0/data-operate/import/import-way/stream-load-manual target=_blank rel="noopener noreferrer">Stream Load</a>) and pull-based method (<a href=https://doris.apache.org/docs/3.0/data-operate/import/import-way/routine-load-manual target=_blank rel="noopener noreferrer">Routine Load</a> from Kafka, <a href=https://doris.apache.org/docs/3.0/data-operate/import/import-way/broker-load-manual target=_blank rel="noopener noreferrer">Broker Load</a> from object storage and HDFS). In addition, output plugins for <a href=https://doris.apache.org/docs/ecosystem/observability/logstash target=_blank rel="noopener noreferrer">Logstash</a> and <a href=https://doris.apache.org/docs/ecosystem/observability/beats target=_blank rel="noopener noreferrer">Beats</a> are available to enable seamless data ingestion from Logstash or Beats into Doris.</p>
<p>In addition, Doris provides a special write <a href=https://doris.apache.org/docs/3.0/data-operate/transaction target=_blank rel="noopener noreferrer">transaction</a> mechanism. By setting a <a href=https://doris.apache.org/docs/3.0/data-operate/transaction#label-mechanism target=_blank rel="noopener noreferrer">label</a> for a batch of data through the Load API, attempting to re-load a label that has been successfully load before will result in an error, thereby achieving data deduplication. This mechanism ensures that data is written without loss or duplication without relying on the uniqueness of primary keys at the storage layer. Additionally, having a unique label for each batch of data offers better performance compared to having a unique primary key for each individual record.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=write-performance>Write performance<a href=#write-performance class=hash-link aria-label="Write performance的直接链接" title="Write performance的直接链接">​</a></h3>
<p><strong>Apache Doris</strong>, as a real-time data warehouse, supports real-time data writes and updates. One of the standout features of Doris is its incredibly high write throughput. This is because the Doris community has put a lot of effort in optimizing it for high-throughput writes such as vertorized writting and  single replica indexing.</p>
<p>On the other hand, the low write throughput of <strong>Elasticsearch</strong> is a well-known pain point. This is due to Elasticsearch's needs to generate complex inverted index on multiple replicas, causing a lot of overheads.</p>
<p>We compare the write performance of Doris and Elasticsearch using Elasticsearch's official benchmark <a href=https://github.com/elastic/rally-tracks/tree/master/http_logs target=_blank rel="noopener noreferrer">httplogs</a>, under the same hardware resources and storage schema (including field types and inverted indexes). The test environment and results are as follows:</p>
<p><img decoding=async loading=lazy alt="write performance.png" src=/zh-CN/assets/images/write-performance-4d69725174a2f844b881ef4231f254cc.png width=1280 height=1184 class=img_ev3q></p>
<p>Under the premise of creating the same inverted index, Apache Doris delivers a much higher write throughput than Elasticsearch. This is due to some key advancements in performance optimization, including:</p>
<ol>
<li>Doris is implemented in C++, which is more efficient than Elasticsearch's Java implementation.</li>
<li>The vectorized execution engine of Doris fully utilizes CPU SIMD instructions to accelerate both data writing and inverted index building. Its columnar storage also facilitates vectorized execution.</li>
<li>The inverted index of Doris is simplified for real-time analytics scenarios, eliminating unnecessary storage structures such as forward indexes and norms.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=real-time-storage>Real-time storage<a href=#real-time-storage class=hash-link aria-label="Real-time storage的直接链接" title="Real-time storage的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=storage-format-and-cost>Storage format and cost<a href=#storage-format-and-cost class=hash-link aria-label="Storage format and cost的直接链接" title="Storage format and cost的直接链接">​</a></h3>
<p>As a real-time data warehouse, Doris adheres to the typical relational database model, with a storage hierarchy that includes <strong>catalog</strong>, <strong>database</strong>, and <strong>table</strong> levels. A table consists of one or more columns, each with its own data type, and indexes can be created on the columns.</p>
<p>By default, Doris stores tables in a columnar format, meaning that data for a single column is stored in contiguous physical files. This not only achieves a high compression ratio but also ensures high query efficiency in analysis scenarios where only certain columns are accessed, as only the required data is read and processed. Additionally, Doris supports an optional row storage format to accelerate detailed point queries.</p>
<p>In Elasticsearch, data is stored in Lucene using a document model. In this model, an Elasticsearch index is equivalent to a database table, the index mapping corresponds to the database table schema, and fields within the index mapping are akin to columns in a database, each with its own type and index type.</p>
<p>By default, Elasticsearch uses row-based storage (the _source field), where each field has an associated inverted index created for it, but it also supports optional columnar storage (docvalue). Generally, row-based storage is essential in Elasticsearch because it lays the foundation for raw detailed data queries.</p>
<p>Storage space consumption, or more straightforward, storage cost, is a big concern for users. This is another pain point of Elasticsearch - it creates huge storage costs.</p>
<p>Apache Doris community have made a lot of optimizations and successfully reduced the storage cost significantly. We have put a lot of work to simplify <a href=https://doris.apache.org/docs/3.0/table-design/index/inverted-index target=_blank rel="noopener noreferrer">inverted index</a>, which is supported in Doris since version 2.0, and it now takes up much less space. <strong>Doris</strong> supports the ZSTD algorithm, which is much more efficient than GZIP and LZ4, and it can reach a data compression ratio of 5:1 ~ 10:1. Since the compression ratio of <strong>Elasticsearch</strong> is usually about 1.5:1, Doris is 3~5 times more efficient than Elasticsearch in data compression.</p>
<p>As demonstrated in the httplogs test results table above, 32GB of raw data occupies 3.2GB in Doris, whereas Elasticsearch defaults to 19.4GB. Even with the latest logsdb optimization mode enabled, Elasticsearch still consumes 11.7GB. Compared to Elasticsearch, Doris reduces storage space by 83% (73% with logsdb enabled).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=table-model>Table model<a href=#table-model class=hash-link aria-label="Table model的直接链接" title="Table model的直接链接">​</a></h3>
<p>Apache Doris provides three data models. As for Elasticsearch, I put it as "one and two half" models because it only provides limited support for certain data storage models. I will get to them one by one.</p>
<ul>
<li>
<p>The first is the Duplicate model, which means it allows data duplication. This is suitable for storing logs. Both Doris and Elasticsearch support this model.</p>
</li>
<li>
<p>The second is the primary key model. It works like OLTP databases, which means the data will be deduplicated by key. The <a href=https://doris.apache.org/docs/table-design/data-model/unique target=_blank rel="noopener noreferrer">primary key model</a> in <strong>Doris</strong> provides high performance and many user-friendly features. Just like many databases, you can define one or multiple fields as the primary and unique key.</p>
<ul>
<li>
<p>However, in <strong>Elasticsearch</strong>, you can only use a special field <a href=https://www.elastic.co/guide/en/elasticsearch/reference/8.17/mapping-id-field.html target=_blank rel="noopener noreferrer">_id</a> as the unique identifier for a document (a row in database). Unlike database primary key, there are many limitations for it.</p>
</li>
<li>
<p>The <code>_id</code> field can not be used for aggregation or sorting</p>
</li>
<li>
<p>The <code>_id</code> field can not be larger than 512 bytes</p>
</li>
<li>
<p>The <code>_id</code> field can not be multiple fields, so you will need to combine the multiple fields into one before you can use them as the primary key, but the length of the combined _id can still not exceed 512 bytes.</p>
</li>
</ul>
</li>
<li>
<p>The third is the aggregation model, which means data will be aggregated or rolled up.</p>
</li>
</ul>
<p>In its early stages, Elasticsearch provided the <a href=https://www.elastic.co/guide/en/elasticsearch/reference/8.17/rollup-getting-started.html target=_blank rel="noopener noreferrer">rollup</a> feature through the commercial X-Pack plugin, allowing users to create rollup jobs that configured dimensions, metric fields, and aggregation intervals for rollup indexes based on a base index. However, X-Pack rollup had several limitations:</p>
<ol>
<li><strong>Data Asynchrony</strong>: Rollup jobs ran in the background, meaning the data in the rollup index was not synchronized in real time with the base index.</li>
<li><strong>Specialized Query Requirement</strong>: Queries targeting rolled-up data required dedicated rollup queries, and users had to manually specify the rollup index in their queries.</li>
</ol>
<p>Perhaps these reasons explain why <strong>Elasticsearch has deprecated the use of rollup starting in version 8.11.0</strong> and now recommends <strong><a href=https://www.elastic.co/guide/en/elasticsearch/reference/8.17/downsampling.html target=_blank rel="noopener noreferrer">downsampling</a></strong> as an alternative. Downsampling eliminates the need to specify a separate index and simplifies querying, but it also comes with its own constraints:</p>
<ol>
<li><strong>Time-Series Exclusive</strong>: Downsampling is only applicable to time-series data, relying on time as the primary dimension. It cannot be used for other data types, such as business reporting data.</li>
<li><strong>Index Replacement</strong>: A downsampled index replaces the original index, meaning aggregated data and raw data cannot coexist.</li>
<li><strong>Read-Only</strong>: Downsampling can only be performed on the original index after it transitions to a read-only state. Data actively being written (e.g., real-time ingestion) cannot undergo downsampling.</li>
</ol>
<p>As a real-time data warehouse excelling in aggregation and analytics, <strong>Doris</strong> has supported aggregation capabilities since its early use cases in online reporting and analytics. It offers two flexible mechanisms:</p>
<ol>
<li><strong><a href=https://doris.apache.org/docs/3.0/table-design/data-model/aggregate target=_blank rel="noopener noreferrer">Aggregation Table Model</a></strong>:
<ul>
<li>Data is directly aggregated during ingestion, eliminating the storage of raw data.</li>
<li>Only aggregated results are stored, drastically reducing storage costs.</li>
</ul>
</li>
<li><strong><a href=https://doris.apache.org/docs/query-acceleration/materialized-view/sync-materialized-view target=_blank rel="noopener noreferrer">Aggregated Materialized Views</a>/ Rollup</strong>:
<ul>
<li>Users can create aggregated materialized views on a base table. Data is written to both the base table and the materialized view simultaneously, ensuring atomic and synchronized updates.</li>
<li>Queries target the base table, and the query optimizer automatically rewrites queries to leverage the materialized view for accelerated performance.</li>
</ul>
</li>
</ol>
<p>This design ensures real-time aggregation while maintaining query flexibility and efficiency in Doris.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=flexible-schema>Flexible schema<a href=#flexible-schema class=hash-link aria-label="Flexible schema的直接链接" title="Flexible schema的直接链接">​</a></h3>
<p>In most cases, especially for online business scenarios, users often need to update or modify the data schema. Elasticsearch supports flexible schema, but it only allows users to dynamically add columns.</p>
<p><img decoding=async loading=lazy alt="Flexible schema.png" src=/zh-CN/assets/images/Flexible-schema-4a101b19b1ce379dcd31c5d6c0106aac.png width=1280 height=687 class=img_ev3q></p>
<p>When you write JSON data into Elasticsearch, if the data contains a new field which is not in index mapping, Elasticsearch will create a new field in the schema through <a href=https://www.elastic.co/guide/en/elasticsearch/reference/8.17/dynamic-field-mapping.html target=_blank rel="noopener noreferrer">dynamic mapping</a>, so you don't need to change the  schema beforehand, like you have to do in traditional databases. However, in Elasticsearch, users cannot directly delete a field of the schema. For that, you will need a reindex operation that reads and writes the entire index in Elasticsearch.</p>
<p>In addition, Elasticsearch does not allow adding index for an already existed field. Imagine that you have 100 fields in a schema, and you have created inverted index for 10 of them, and then some days later, you want to add inverted index for another 5 fields, but no, you can't do that in Elasticsearch. Likewise, deleting index for a field is not allowed either.</p>
<p>As a result, to avoid such troubles, most Elasticsearch users will just create inverted index for all of their fields, but that causes much slower data writing and much larger storage usage.</p>
<p>Also, Elasticsearch does not allow you to modify your index names or your field names. To sum up, if you need to make any changes to your data other than adding a field, you will need to re-index everything. That's a highly resource-intensive and time-consuming operation.</p>
<p>What about <strong>Apache Doris</strong>? Doris supports all these <a href=https://doris.apache.org/docs/3.0/table-design/schema-change target=_blank rel="noopener noreferrer">schema changes</a>. You can add or delete fields and <a href=https://doris.apache.org/docs/3.0/table-design/index/inverted-index#managing-indexes target=_blank rel="noopener noreferrer">indexes</a> as you want, and you can change the name of any table or field easily. Doris can finish these changes within just a few milliseconds. Such flexibility will save you a lot of time and resource, especially when you have changing business needs.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=real-time-queries>Real-time queries<a href=#real-time-queries class=hash-link aria-label="Real-time queries的直接链接" title="Real-time queries的直接链接">​</a></h2>
<p>We break down the real-time querying of Elasticsearch and Apache Doris into three dimensions: usability, query capabilities, and performance.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=usability>Usability<a href=#usability class=hash-link aria-label=Usability的直接链接 title=Usability的直接链接>​</a></h3>
<p>One key aspect of usability is reflected in the user interface.</p>
<p>The Doris SQL interface is designed to maintain protocol and syntax compatibility with MySQL. It even does not have its own client or JDBC driver, allowing the use of MySQL’s client and JDBC driver directly. This is a big convenience for many users familiar with MySQL. In fact, this choice was made early in the original design of Doris to make it more user-friendly. Since MySQL is the most widely used open-source OLTP database, Doris is designed to complement MySQL, creating the best practice for combining OLTP (MySQL) with OLAP (Doris). This allows engineers and data analysts to work seamlessly within a single interface and set of syntax, covering both transactional and analytical workloads.</p>
<p>On the other hand, Elasticsearch has its own Domain Specific Language (DSL), which is originally designed for searching. This DSL is part of the Elasticsearch ecosystem, it often requires engineers to invest a lot of time and effort to fully understand and use the DSL effectively.</p>
<p>Let's take a look at one example:</p>
<p><img decoding=async loading=lazy alt="Real-time queries.png" src=/zh-CN/assets/images/Real-time-queries-38c7e2bc6c2069a82fa10849a212f911.png width=1280 height=408 class=img_ev3q></p>
<p>Imagine we want to search for a particular keyword within a particular time range, and then group and order the data by time interval to visualize it as a trend chart.</p>
<p>In Doris, this can be done with only 7 lines of SQL. However, in Elasticsearch, the same process requires 30 lines.</p>
<p>And it's not just about the code complexity. I believe many of you may find this relatable: The first attempt to learn Elasticsearch's DSL is quite challenging. And even after gaining familiarity with it, crafting a query often requires frequent reference to documentation and examples. Due to its inherent complexity, writing DSL queries from scratch remains a challenging task. In contrast, SQL is simple, clear, and highly structured. Most engineers can easily write a query like this without much effort.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=query-capabilities>Query capabilities<a href=#query-capabilities class=hash-link aria-label="Query capabilities的直接链接" title="Query capabilities的直接链接">​</a></h3>
<p><strong>Elasticsearch</strong> is good at searching. As its name suggests, it was built for search. But beyond search and aggregation queries, it doesn't support complex analytical queries, such as multi-table JOIN.</p>
<p><strong>Apache Doris</strong> is a general-purpose data warehouse. It provides strong support for complex analytics, including multi-table JOIN, UDF, subquery, window function, logic view, materialized view, and data lakehouse. And Doris has been improving its searching capabilities since version 2.0. We have introduced inverted index and full-text search, so it is getting increasingly competitive in this area.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=search>Search<a href=#search class=hash-link aria-label=Search的直接链接 title=Search的直接链接>​</a></h4>
<p>While this article focuses on real-time analytics scenarios, we have chosen not to overlook <strong>Elasticsearch’s core strength</strong>: its search capabilities.</p>
<p>Elasticsearch, renowned for its search performance, leverages the <strong>Apache Lucene library</strong> under the hood. It provides two primary indexing structures:</p>
<ul>
<li><strong>Inverted indexes</strong> for text fields.</li>
<li><strong>BKD-Tree indexes</strong> for numeric, date, and geospatial data.</li>
</ul>
<p>Elasticsearch supports the following search paradigms:</p>
<ol>
<li><strong>Exact Matching</strong>:  equality or range queries for numeric, date, or non-tokenized string fields (keyword), powered by <strong>BKD-Tree indexes</strong> (numeric/date) or <strong>non-tokenized inverted indexes</strong> (exact term matches).</li>
<li><strong><a href=https://www.elastic.co/guide/en/elasticsearch/reference/8.17/full-text-queries.html target=_blank rel="noopener noreferrer">Full-Text Search</a></strong>:  keyword, phrase, or multi-term matching. During ingestion, text is split into tokens using a configurable tokenizer. Queries match tokens, phrases, or combinations (e.g., <code>"quick brown fox"</code>).  Elasticsearch supports some advanced full-text search features, such as relevance scoring, auto-completion, spell-checking, and search suggestions.</li>
<li><strong>Vector Search based on ANN index.</strong></li>
</ol>
<p><strong>Doris</strong> also supports a rich set of indexes to accelerate queries, including <strong>prefix-sorted indexes</strong>,  <strong>ZoneMap indexes</strong>,  <strong>BloomFilter indexes and N-Gram BloomFilter indexes</strong>.</p>
<p>Starting from version 2.0, Doris has added <strong>inverted indexes</strong> and BKD-Tree indexes to support <strong>exact matching</strong> and full-text search. <strong>Vector search</strong> is currently under development and is expected to be available within the next six months.</p>
<p>There are some <strong>differences between the indexes of Apache Doris and Elasticsearch</strong>:</p>
<ol>
<li><strong><a href=https://doris.apache.org/docs/3.0/table-design/index/index-overview target=_blank rel="noopener noreferrer">Diverse indexing strategies</a></strong>: Doris does not rely solely on inverted indexes for query acceleration. It offers different indexes for different scenarios. <strong>ZoneMap</strong>, BloomFilter, and <strong>N-Gram BloomFilter indexes</strong> are <strong>skip indexes</strong> that accelerate analytical queries by skipping non-matching data blocks based on <code>WHERE</code> conditions. The <strong>N-Gram BloomFilter index</strong> is specifically optimized for <code>LIKE</code>-style fuzzy string matching. Inverted index and Prefix-sorted indexes are point query indexes that speed up point queries by locating which rows satisfy the WHERE conditions through the index and directly read those rows.</li>
<li><strong>Performance centric design</strong>: Doris prioritizes <strong>speed and efficiency</strong> over advanced search features. To achieve faster index building and query performance (see the Query Performance section in the following), it omits certain complex functionalities of inverted indexes at present, such as relevance scoring, auto-completion, spell-checking, and search suggestions. Since there are more critical in document or web search scenarios, which are not Doris’ primary focus on real-time analytics.</li>
</ol>
<p>For <strong>exact matching</strong> and <strong>common full-text search</strong> requirements, such as term, range, phrase, multi-field matching, Doris is fully capable and reliable in most use cases. For <strong>complex search needs</strong> (e.g., relevance scoring, auto-completion, spell-checking, or search suggestions), <strong>Elasticsearch</strong> remains the more suitable choice.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=aggregation>Aggregation<a href=#aggregation class=hash-link aria-label=Aggregation的直接链接 title=Aggregation的直接链接>​</a></h4>
<p>Both <strong>Elasticsearch</strong> and <strong>Doris</strong> support a wide range of aggregation operators, including:</p>
<ul>
<li><strong>Basic aggregations</strong>: <code>MIN</code>, <code>MAX</code>, <code>COUNT</code>, <code>SUM</code>, <code>AVG</code>.</li>
<li><strong>Advanced aggregations</strong>: <code>PERCENTILE</code> (quantiles), <code>HISTOGRAM</code> (bucketed distributions).</li>
<li><strong>Aggregation modes</strong>: Global aggregation, key-based grouping (e.g., <code>GROUP BY</code>).</li>
</ul>
<p>However, their approaches to aggregation analysis differ significantly in the following aspects:</p>
<p><strong>1. Query syntax and usability:</strong> Doris uses <strong>standard SQL syntax</strong> (<code>GROUP BY</code> clauses + aggregation functions), making it intuitive for analysts and developers familiar with SQL. <strong>Elasticsearch</strong> relies on a <strong>custom Domain-Specific Language (DSL)</strong> with concepts like <code>metric agg</code>, <code>bucket agg</code>, and <code>pipeline agg</code>. Complexity increases with nested or multi-layered aggregations, requiring steeper learning curves.</p>
<p><strong>2. Result accuracy:</strong> Elasticsearch outputs inaccurate approximate result for many aggregation types by default. Aggregations (e.g., <code>terms</code> agg) are executed per shard, with each shard returning only its top results (e.g., top 10 buckets). These partial results are merged globally, leading to potentially inaccurate final outputs. As a serious OLAP database, Doris ensures exact results by processing full datasets without approximations.</p>
<p><strong>3. Query Performance:</strong> Doris demonstrates <strong>significant performance advantages over Elasticsearch</strong> in aggregation-heavy OLAP workloads like those on ClickBench (see more in the Query performance section bellow).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=join>JOIN<a href=#join class=hash-link aria-label=JOIN的直接链接 title=JOIN的直接链接>​</a></h4>
<p><strong>Elasticsearch</strong> does not support JOIN, making it unable to execute common benchmarks like TPC-H or TPC-DS. Since JOINs are critical in data analysis, Elasticsearch provides some complex <a href=https://www.elastic.co/guide/en/elasticsearch/reference/8.17/joining-queries.html target=_blank rel="noopener noreferrer">workarounds</a> with significant limitations:</p>
<ol>
<li><strong><a href=https://www.elastic.co/guide/en/elasticsearch/reference/8.17/parent-join.html target=_blank rel="noopener noreferrer">Parent-child</a></strong> relationships and has_child / has_parent queries: Simulate JOINs by establishing parent-child relationships within a single index. Child documents store the parent document’s ID. <code>has_child</code> queries first find matching child documents, then retrieve their parent documents via the stored parent IDs. <code>has_parent</code> queries reverse this logic.  It's complex and Elasticsearch explicitly warns against equating this approach to database-style JOINs.
<blockquote>
<p>We don’t recommend using multiple levels of relations to replicate a relational model. Each level of relation adds an overhead at query time in terms of memory and computation. For better search performance, denormalize your data instead.</p>
</blockquote>
</li>
<li><strong><a href=https://www.elastic.co/guide/en/elasticsearch/reference/8.17/query-dsl-terms-query.html#query-dsl-terms-lookup target=_blank rel="noopener noreferrer">Terms lookup</a></strong>:  Similar to an IN-subquery by fetching a value list from one index and using it in a <code>terms</code> query on another.  It's only suitable for large-table-to-small-table JOINs (e.g., filtering a large dataset using a small reference list), but performs very poorly for large-table-to-large-table JOINs due to scalability issues.</li>
</ol>
<p><strong>Doris</strong> provides comprehensive support for <a href=https://doris.apache.org/docs/3.0/query-data/join/ target=_blank rel="noopener noreferrer">JOIN</a> operations, including:</p>
<ul>
<li>INNER JOIN</li>
<li>CROSS JOIN</li>
<li>LEFT / RIGHT / FULL OUTER JOIN</li>
<li>LEFT / RIGHT SEMI JOIN</li>
<li>LEFT / RIGHT ANTI JOIN</li>
</ul>
<p>Further more, <strong>Doris’ query optimizer</strong> adaptively selects optimal execution plans for JOIN operations based on data characteristics and statistics, including:</p>
<ul>
<li><strong>Small-large table JOIN</strong>:
<ul>
<li><strong>Broadcast JOIN</strong>: The smaller table is broadcast to all nodes for local joins.</li>
</ul>
</li>
<li><strong>Large-large table JOIN</strong>:
<ul>
<li><strong>Bucket Shuffle JOIN</strong>: Used when the left table’s bucketing distribution aligns with the JOIN key.</li>
<li><strong>Colocate JOIN</strong>: Applied when both the left and right tables share identical bucketing distributions with the  JOIN keys.</li>
<li><strong>Runtime Filter</strong>: Reduces data scanned in the left table by pushing down predicates from the right table using runtime-generated filters.</li>
</ul>
</li>
</ul>
<p>This intelligent optimization ensures efficient JOIN execution across diverse data scales and distributions, including <a href=https://doris.apache.org/docs/3.0/benchmark/tpch/ target=_blank rel="noopener noreferrer">TPC-H</a> and <a href=https://doris.apache.org/docs/3.0/benchmark/tpcds target=_blank rel="noopener noreferrer">TPC-DS</a> benchmarks.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=lakehouse>Lakehouse<a href=#lakehouse class=hash-link aria-label=Lakehouse的直接链接 title=Lakehouse的直接链接>​</a></h4>
<p>Data warehouses addresses the need for fast data analysis, while data lakes are good at data storage and management. The integration of them, known as "<a href=https://doris.apache.org/docs/3.0/lakehouse/lakehouse-overview target=_blank rel="noopener noreferrer">lakehouse</a>", is to facilitate the seamless integration and free flow of data between the data lake and data warehouse. It enables users to leverage the analytic capabilities of the data warehouse while harnessing the data management power of the data lake.</p>
<p><img decoding=async loading=lazy alt=lakehouse.png src=/zh-CN/assets/images/lakehouse-e089ec3a90a1b6725e8f08d96d45c328.png width=1280 height=640 class=img_ev3q></p>
<p>Apache Doris can work as a data lakehouse with its <a href=https://doris.apache.org/docs/3.0/lakehouse/lakehouse-overview#multi-catalog target=_blank rel="noopener noreferrer">Multi Catalog</a> feature. It can access databases and data lakes including Apache Hive, Apache Iceberg, Apache Hudi, Apache Paimon, LakeSoul, Elasticsearch, MySQL, Oracle, and SQLServer. It also supports Apache Ranger for privilege management.</p>
<p>Elasticsearch does not support querying external data, and of course, it does not support lakehouse either.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=query-performance>Query performance<a href=#query-performance class=hash-link aria-label="Query performance的直接链接" title="Query performance的直接链接">​</a></h3>
<p><strong>Apache Doris</strong> has been extensively optimized for multiple scenarios, so it can deliver high performance in many use cases. For example, Doris can achieve tens of thousands of QPS for high-concurrency point queries, and it delivers industry-leading performance in aggregation analysis on a global scale.</p>
<p><strong>Elasticsearch</strong> is good at point queries (retrieving just a small amount of data). However, it might struggle with complex analytical workloads.</p>
<p><a href=https://elasticsearch-benchmarks.elastic.co/ target=_blank rel="noopener noreferrer">Elasticsearch httplogs</a> and the Microsoft Azure <a href=https://gigaom.com/report/log-data-analytics-testing/ target=_blank rel="noopener noreferrer">logsbench</a> are benchmarks for log storage and search. Both tests show that Doris is about 3 - 4 times faster than Elasticsearch in data writing, but only uses 1/6 - 1/4 of the storage space that Elasticsearch uses. Then for data queries, Doris is more than 2 times faster than Elasticsearch.</p>
<p><img decoding=async loading=lazy alt="Query performance.png" src=/zh-CN/assets/images/Query-performance-0fd762e5e1d85f0a4ecd6f1bfeccb93e.png width=1280 height=565 class=img_ev3q></p>
<p><a href=https://benchmark.clickhouse.com/#eyJzeXN0ZW0iOnsiQWxsb3lEQiI6ZmFsc2UsIkF0aGVuYSAocGFydGl0aW9uZWQpIjpmYWxzZSwiQXRoZW5hIChzaW5nbGUpIjpmYWxzZSwiQXVyb3JhIGZvciBNeVNRTCI6ZmFsc2UsIkF1cm9yYSBmb3IgUG9zdGdyZVNRTCI6ZmFsc2UsIkJ5Q29uaXR5IjpmYWxzZSwiQnl0ZUhvdXNlIjpmYWxzZSwiY2hEQiI6ZmFsc2UsIkNpdHVzIjpmYWxzZSwiQ2xpY2tIb3VzZSBDbG91ZCAoYXdzKSI6ZmFsc2UsIkNsaWNrSG91c2UgQ2xvdWQgKGdjcCkiOmZhbHNlLCJDbGlja0hvdXNlIChkYXRhIGxha2UsIHBhcnRpdGlvbmVkKSI6ZmFsc2UsIkNsaWNrSG91c2UgKGRhdGEgbGFrZSwgc2luZ2xlKSI6ZmFsc2UsIkNsaWNrSG91c2UgKFBhcnF1ZXQsIHBhcnRpdGlvbmVkKSI6ZmFsc2UsIkNsaWNrSG91c2UgKFBhcnF1ZXQsIHNpbmdsZSkiOmZhbHNlLCJDbGlja0hvdXNlICh3ZWIpIjpmYWxzZSwiQ2xpY2tIb3VzZSI6ZmFsc2UsIkNsaWNrSG91c2UgKHR1bmVkKSI6ZmFsc2UsIkNsaWNrSG91c2UgKHR1bmVkLCBtZW1vcnkpIjpmYWxzZSwiQ3JhdGVEQiI6ZmFsc2UsIkRhdGFiZW5kIjpmYWxzZSwiRGF0YUZ1c2lvbiAoUGFycXVldCwgcGFydGl0aW9uZWQpIjpmYWxzZSwiRGF0YUZ1c2lvbiAoUGFycXVldCwgc2luZ2xlKSI6ZmFsc2UsIkFwYWNoZSBEb3JpcyI6dHJ1ZSwiRHJ1aWQiOmZhbHNlLCJEdWNrREIgKFBhcnF1ZXQsIHBhcnRpdGlvbmVkKSI6ZmFsc2UsIkR1Y2tEQiI6ZmFsc2UsIkVsYXN0aWNzZWFyY2giOnRydWUsIkVsYXN0aWNzZWFyY2ggKHR1bmVkKSI6dHJ1ZSwiR2xhcmVEQiI6ZmFsc2UsIkdyZWVucGx1bSI6ZmFsc2UsIkhlYXZ5QUkiOmZhbHNlLCJIeWRyYSI6ZmFsc2UsIkluZm9icmlnaHQiOmZhbHNlLCJLaW5ldGljYSI6ZmFsc2UsIk1hcmlhREIgQ29sdW1uU3RvcmUiOmZhbHNlLCJNYXJpYURCIjpmYWxzZSwiTW9uZXREQiI6ZmFsc2UsIk1vbmdvREIiOmZhbHNlLCJNb3RoZXJkdWNrIjpmYWxzZSwiTXlTUUwgKE15SVNBTSkiOmZhbHNlLCJNeVNRTCI6ZmFsc2UsIk94bGEuY29tIjpmYWxzZSwiUGFyYWRlREIiOmZhbHNlLCJQaW5vdCI6ZmFsc2UsIlBvc3RncmVTUUwgKHR1bmVkKSI6ZmFsc2UsIlBvc3RncmVTUUwiOmZhbHNlLCJRdWVzdERCIChwYXJ0aXRpb25lZCkiOmZhbHNlLCJRdWVzdERCIjpmYWxzZSwiUmVkc2hpZnQiOmZhbHNlLCJTZWxlY3REQiI6ZmFsc2UsIlNpbmdsZVN0b3JlIjpmYWxzZSwiU25vd2ZsYWtlIjpmYWxzZSwiU1FMaXRlIjpmYWxzZSwiU3RhclJvY2tzIjpmYWxzZSwiVGFibGVzcGFjZSI6ZmFsc2UsIlRpbWVzY2FsZURCIChjb21wcmVzc2lvbikiOmZhbHNlLCJUaW1lc2NhbGVEQiI6ZmFsc2UsIlVtYnJhIjpmYWxzZX0sInR5cGUiOnsiQyI6dHJ1ZSwiY29sdW1uLW9yaWVudGVkIjp0cnVlLCJQb3N0Z3JlU1FMIGNvbXBhdGlibGUiOnRydWUsIm1hbmFnZWQiOnRydWUsImdjcCI6dHJ1ZSwic3RhdGVsZXNzIjp0cnVlLCJKYXZhIjp0cnVlLCJDKysiOnRydWUsIk15U1FMIGNvbXBhdGlibGUiOnRydWUsInJvdy1vcmllbnRlZCI6dHJ1ZSwiQ2xpY2tIb3VzZSBkZXJpdmF0aXZlIjp0cnVlLCJlbWJlZGRlZCI6dHJ1ZSwic2VydmVybGVzcyI6dHJ1ZSwiYXdzIjp0cnVlLCJSdXN0Ijp0cnVlLCJzZWFyY2giOnRydWUsImRvY3VtZW50Ijp0cnVlLCJhbmFseXRpY2FsIjp0cnVlLCJzb21ld2hhdCBQb3N0Z3JlU1FMIGNvbXBhdGlibGUiOnRydWUsInRpbWUtc2VyaWVzIjp0cnVlfSwibWFjaGluZSI6eyIxNiB2Q1BVIDEyOEdCIjp0cnVlLCI4IHZDUFUgNjRHQiI6dHJ1ZSwic2VydmVybGVzcyI6dHJ1ZSwiMTZhY3UiOnRydWUsImM2YS40eGxhcmdlLCA1MDBnYiBncDIiOnRydWUsIkwiOnRydWUsIk0iOnRydWUsIlMiOnRydWUsIlhTIjp0cnVlLCJjNmEubWV0YWwsIDUwMGdiIGdwMiI6ZmFsc2UsIjE5MkdCIjp0cnVlLCIyNEdCIjp0cnVlLCIzNjBHQiI6dHJ1ZSwiNDhHQiI6dHJ1ZSwiNzIwR0IiOnRydWUsIjk2R0IiOnRydWUsIjE0MzBHQiI6dHJ1ZSwiZGV2Ijp0cnVlLCI3MDhHQiI6dHJ1ZSwiYzVuLjR4bGFyZ2UsIDUwMGdiIGdwMiI6dHJ1ZSwiYzUuNHhsYXJnZSwgNTAwZ2IgZ3AyIjp0cnVlLCJjNmEuNHhsYXJnZSwgMTUwMGdiIGdwMiI6dHJ1ZSwiY2xvdWQiOnRydWUsImRjMi44eGxhcmdlIjp0cnVlLCJyYTMuMTZ4bGFyZ2UiOnRydWUsInJhMy40eGxhcmdlIjp0cnVlLCJyYTMueGxwbHVzIjp0cnVlLCJTMiI6dHJ1ZSwiUzI0Ijp0cnVlLCIyWEwiOnRydWUsIjNYTCI6dHJ1ZSwiNFhMIjp0cnVlLCJYTCI6dHJ1ZSwiTDEgLSAxNkNQVSAzMkdCIjp0cnVlfSwiY2x1c3Rlcl9zaXplIjp7IjEiOnRydWUsIjIiOnRydWUsIjQiOnRydWUsIjgiOnRydWUsIjE2Ijp0cnVlLCIzMiI6dHJ1ZSwiNjQiOnRydWUsIjEyOCI6dHJ1ZSwic2VydmVybGVzcyI6dHJ1ZSwiZGVkaWNhdGVkIjp0cnVlLCJ1bmRlZmluZWQiOnRydWV9LCJtZXRyaWMiOiJob3QiLCJxdWVyaWVzIjpbdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZSx0cnVlLHRydWUsdHJ1ZV19 target=_blank rel="noopener noreferrer">ClickBench</a> is a benchmark created and maintained by the ClickHouse team to evaluate the performance of analytical databases. It results show that Apache Doris delivers <strong>out-of-the-box</strong> query performance <strong>21 times faster</strong> than Elasticsearch and <strong>6 times faster</strong> than a fine-tuned Elasticsearch.</p>
<p><img decoding=async loading=lazy alt="Query performance-2.png" src=/zh-CN/assets/images/Query-performance-2-503b2bd7a3f7cf5a014e80a23c0ecc05.png width=1280 height=80 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=comparison-summary>Comparison Summary<a href=#comparison-summary class=hash-link aria-label="Comparison Summary的直接链接" title="Comparison Summary的直接链接">​</a></h2>
<p>In summary, Doris follows Apache License 2.0, which is a highly open license to ensure that Doris remains truly open and will continue to uphold such openness in the future.</p>
<p>Secondly, Doris supports both compute-storage coupled and decoupled mode, while Elasticsearch only supports the former, which enable more powerful elasticity and resource isolation.</p>
<p>Thirdly, Doris provides high performance in data ingestion. It is usually 3~5 times faster than Elasticsearch.</p>
<p>In terms of storage, compared to Elasticsearch, Doris can reduce storage costs by 70% or more. It is also 10 times faster than Elasticsearch in data updates.</p>
<p>As for data queries, Doris outperforms Elasticsearch by a lot. It also provides analytic capabilities that Elasticsearch does have, including multi-table JOIN, materialized views, and data lakehouse.</p>
<p><img decoding=async loading=lazy alt=comparisons.png src=/zh-CN/assets/images/comparisons-0a1ad658b623b841d29f70af1a2a7de2.png width=1280 height=964 class=img_ev3q>
<img decoding=async loading=lazy alt=comparisons-2.png src=/zh-CN/assets/images/comparisons-2-7fa21a175b6d96706dc1cd697bdf853e.png width=1280 height=1192 class=img_ev3q>
<img decoding=async loading=lazy alt=comparisons-3.png src=/zh-CN/assets/images/comparisons-3-d8740a99961c6701ceffe829263059a1.png width=1280 height=1240 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=use-cases>Use cases<a href=#use-cases class=hash-link aria-label="Use cases的直接链接" title="Use cases的直接链接">​</a></h2>
<p>Many users have replaced Elasticsearch with Apache Doris in their production environments and received exciting results. I will introduce some user stories from the fields of observability, cyber security, and real-time business analysis.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=observability>Observability<a href=#observability class=hash-link aria-label=Observability的直接链接 title=Observability的直接链接>​</a></h3>
<p><strong>User A: a world-famous short video provider</strong></p>
<ul>
<li>Daily incremental data: 800 billion rows (500 TB)</li>
<li>Average write throughput: 10 million row/s (60GB/s)</li>
<li>Peak write throughput: 30 million row/s (90GB/s)</li>
</ul>
<p>Apache Doris supports logging and tracing data storage for this tech giant and meets the data import performance requirements for nearly all use cases within the company.</p>
<p><img decoding=async loading=lazy alt=Observability.png src=/zh-CN/assets/images/Observability-0c354100d26ffddcecd95d82d8b66bb1.png width=1280 height=328 class=img_ev3q></p>
<p><strong>User B: NetEase - one of the World's Highest-Yielding Game Companies</strong></p>
<ul>
<li>Replacing Elasticsearch with Apache Doris for log analysis: reducing storage consumption by 2/3 and achieving 10X query performance</li>
<li>Replacing InfluxDB with Apache Doris for time-series data analysis: saving 50% of server resources and reducing storage consumption by 67%</li>
</ul>
<p><img decoding=async loading=lazy alt=Observability-2.png src=/zh-CN/assets/images/Observability-2-c178019ccf2ae7a409f4afaac4ae3a3e.png width=1280 height=365 class=img_ev3q></p>
<p><strong>User C: an observability platform provider</strong></p>
<p>Apache Doris offers a special data type, <a href=https://doris.apache.org/blog/variant-in-apache-doris-2.1 target=_blank rel="noopener noreferrer">VARIANT</a>, to handle semi-structured data in log and tracing, reducing costs by 70% and delivering 2~3 times faster full-text search performance compared to the Elasticsearch-based solution.</p>
<p><img decoding=async loading=lazy alt=Observability-3.png src=/zh-CN/assets/images/Observability-3-484559d17c7b3238e62b3aa8c2f052f5.png width=1280 height=346 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=cyber-security>Cyber security<a href=#cyber-security class=hash-link aria-label="Cyber security的直接链接" title="Cyber security的直接链接">​</a></h3>
<p><strong>User A: QAX - a listed company & leading cyber security leader</strong></p>
<p>The Doris-based security logging solution uses 40% less storage space, delivers 2X faster write performance, and supports full-text search, aggregation analysis, and multi-table JOIN capabilities in one database system.</p>
<p><img decoding=async loading=lazy alt="Cyber security.png" src=/zh-CN/assets/images/Cyber-security-c3b176bbfbb20b970106efda6ff1e3db.png width=1280 height=377 class=img_ev3q></p>
<p><strong>User B: a payment platform with nearly 600 million registered users</strong></p>
<p>As a unified security data storage solution, Apache Doris delivers 4X faster write speeds, 3X better query performance, and saves 50% storage space compared to the previous architecture with diverse tech stacks using Elasticsearch, Hive and Presto.</p>
<p><img decoding=async loading=lazy alt="Cyber security-2.png" src=/zh-CN/assets/images/Cyber-security-2-c3ec4307fe9b2078fd5d5f087f7b9920.png width=1280 height=379 class=img_ev3q></p>
<p><strong>User C: a leading cyber security solution provider</strong></p>
<p>Compared to Elasticsearch, Doris delivers 2 times faster write speeds, 4 times better query performance, and a 4 times data compression ratio.</p>
<p><img decoding=async loading=lazy alt="Cyber security-3.png" src=/zh-CN/assets/images/Cyber-security-3-c9030ffacacc789a948e29ba021e2182.png width=1280 height=694 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=business-analysis>Business analysis<a href=#business-analysis class=hash-link aria-label="Business analysis的直接链接" title="Business analysis的直接链接">​</a></h3>
<p><strong>User A: a world-leading live e-commerce company</strong></p>
<p>The user previously relied on Elasticsearch to handle online queries for their live stream detail pages, but they faced big challenges in cost and concurrency. After migrating to Apache Doris, they achieve:</p>
<ul>
<li>3 times faster real-time writes: 30w/s -> 100w/s</li>
<li>4 times higher query concurrency: 500QPS -> 2000QPS</li>
</ul>
<p><img decoding=async loading=lazy alt="Business analysis.png" src=/zh-CN/assets/images/Business-analysis-12d34ba8931fd3b43354a25d9f93b008.png width=1280 height=375 class=img_ev3q></p>
<p><strong>User B: Tencent Music Entertainment</strong></p>
<p>Previously, TME content library used both Elasticsearch and ClickHouse to meet their needs for data searching and analysis, but managing two separate systems was complex and inefficient. With Doris, they are able to unify the two systems into one single platform to support both data searching and analysis. The new architecture delivers 4X faster write speeds, reduces storage costs by 80%, and supports complex analytical operations.</p>
<p><img decoding=async loading=lazy alt="Business analysis-2.png" src=/zh-CN/assets/images/Business-analysis-2-8ccd357c1664ebc65a8aa6bc62b5bbf6.png width=1280 height=253 class=img_ev3q></p>
<p><strong>User C: a web browser provider with 600 million users</strong></p>
<p>After migrating to Apache Doris for a unified solution for log storage and report analysis, the company doubled its aggregation analysis efficiency, reduced storage consumption by 60%, and cut SQL development time by half.</p>
<p><img decoding=async loading=lazy alt="Business analysis-3.png" src=/zh-CN/assets/images/comparisons-3-d8740a99961c6701ceffe829263059a1.png width=1280 height=1240 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=taking-apache-doris-to-the-next-level>Taking Apache Doris to the next level<a href=#taking-apache-doris-to-the-next-level class=hash-link aria-label="Taking Apache Doris to the next level的直接链接" title="Taking Apache Doris to the next level的直接链接">​</a></h2>
<p><img decoding=async loading=lazy alt="Taking Apache Doris to the next level.png" src=/zh-CN/assets/images/Taking-Apache-Doris-to-the-next-level-3f01e8665550da6623b1bf7e20ff9b9e.png width=1280 height=586 class=img_ev3q></p>
<p>For the Apache Doris community developers, the path to making Doris good enough to replace Elasticsearch wasn't easy. In 2022, we started adding inverted index capabilities to Doris. At that time, this decision was met with skepticism. Many viewed inverted indexes as a feature exclusive to Elasticsearch, a domain few in the industry dared to venture into. Nevertheless, we went with it, and today we can confidently say that we have succeeded.</p>
<p>In 2022, we developed this feature from the ground up, and after a year of dedicated effort, we open-sourced it. Initially, we had only one user, QAX, who was willing to test and adopt the feature. We are deeply grateful to them for their early support during this pivotal stage.</p>
<p>By 2023, the value of Doris with inverted indexes became increasingly evident, leading to broader adoption by about 10 companies.</p>
<p>The growth momentum has continued, and as of 2024, we are experiencing rapid expansion, with over 100 companies now leveraging Doris to replace Elasticsearch.</p>
<p>Looking ahead, I am very much looking forward to what 2025 will bring. This progress, advancing from the ground up to such significant milestones, has been made possible by the incredible support from the Doris community users and developers. We encourage everyone to join the <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Apache Doris Slack community</a> and join the dedicated channel <a href=https://apachedoriscommunity.slack.com/archives/C08CQKX20R5 target=_blank rel="noopener noreferrer">#elasticsearch-to-doris</a>, where you can receive technical assistance, stay updated with the latest news about Doris, and engage with more Doris developers and users.</p>
<p>More on Apache Doris:</p>
<ul>
<li><a href=https://doris.apache.org/blog/apache-doris-for-log-and-time-series-data-analysis-in-netease target=_blank rel="noopener noreferrer">Apache Doris for log and time series data analysis in NetEase, why not Elasticsearch and InfluxDB?</a></li>
<li><a href=https://doris.apache.org/blog/from-elasticsearch-to-apache-doris-upgrading-an-observability-platform target=_blank rel="noopener noreferrer">From Elasticsearch to Apache Doris: upgrading an observability platform</a></li>
<li><a href=https://doris.apache.org/blog/Log-Analysis-How-to-Digest-15-Billion-Logs-Per-Day-and-Keep-Big-Queries-Within-1-Second target=_blank rel="noopener noreferrer">Log Analysis: How to Digest 15 Billion Logs Per Day and Keep Big Queries Within 1 Second</a></li>
<li><a href=https://doris.apache.org/blog/Replacing-Apache-Hive-Elasticsearch-and-PostgreSQL-with-Apache-Doris target=_blank rel="noopener noreferrer">Replacing Apache Hive, Elasticsearch and PostgreSQL with Apache Doris</a></li>
<li><a href=https://doris.apache.org/blog/Building-A-Log-Analytics-Solution-10-Times-More-Cost-Effective-Than-Elasticsearch target=_blank rel="noopener noreferrer">Log Analysis: Elasticsearch VS Apache Doris</a></li>
<li><a href=https://doris.apache.org/blog/inverted-index-accelerates-text-searches-by-40-time-apache-doris target=_blank rel="noopener noreferrer">A Deep Dive into Inverted Index in Apache Doris</a></li>
<li><a href=https://doris.apache.org/blog/variant-in-apache-doris-2.1 target=_blank rel="noopener noreferrer">VARIANT in Apache Doris 2.1.0: a new data type 8 times faster than JSON for semi-structured data analysis</a></li>
</ul>
<p>Connect with me on <a href=https://www.linkedin.com/in/kang-xiao-441740316/ target=_blank rel="noopener noreferrer">Linkedin</a></p>
<p>Apache Doris on <a href=https://github.com/apache/doris target=_blank rel="noopener noreferrer">GitHub</a></p>
<p>Apache Doris <a href=https://doris.apache.org target=_blank rel="noopener noreferrer">Website</a></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/doris-compute-storage-decoupled/>Slash your cost by 90% with Apache Doris Compute-Storage Decoupled Mode</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · Thomas Yang, Apache Doris PMC Member</span></span><time datetime=2025-03-21T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2025年3月21日</time></div></header><div class=markdown itemprop=articleBody><p>In the age of data-driven decision-making, the exponential growth of data volume and the ever-evolving demands for analytics pose great challenges. Data streams in from diverse sources (such as application logs, network interactions, and mobile devices), spanning structured, semi-structured, and unstructured formats. This diversity places pressure on storage and analytical systems. Meanwhile, the surge in demand for real-time analytics and exploratory queries requires systems to deliver millisecond-level responsiveness while achieving optimal cost efficiency and elastic scalability.</p>
<p>Apache Doris emerged in the era of integrated storage and computation, built on a classic <strong>Shared Nothing</strong> architecture. In this design, storage and computation are co-located on <strong>Backend (BE) nodes</strong>, leveraging an <strong>MPP (Massively Parallel Processing)</strong> distributed computing model. This architecture delivers key advantages, including high availability, simplified deployment, seamless horizontal scalability, and exceptional real-time analytical performance.</p>
<p>For real-time analytics and small-scale data processing, Apache Doris stands out with <strong>predictable, stable low-latency performance</strong>, making it an indispensable solution. However, when scaling to large-scale data processing, it encounters certain challenges, primarily in:</p>
<ul>
<li><strong>Relatively high costs & low elasticity:</strong> Balancing storage and compute resources remains a big challenge. Storage capacity must be sufficient to accommodate all data, while compute resources need to handle query workloads efficiently. However, dynamically scaling clusters is often time-consuming, prompting enterprises to over-provision resources to ensure stability. This approach simplifies operations but leads to resource waste and increased costs.</li>
<li><strong>Limited workload isolation:</strong> Since Apache Doris 2.0, Workload Groups provide soft isolation, while Resource Groups offer a degree of hard isolation. However, neither mechanism ensures complete physical isolation, which can impact performance in multi-tenant or resource-intensive environments.</li>
<li><strong>Operational complexity:</strong> Managing an OLAP system with built-in distributed storage requires not only overseeing compute nodes but also ensuring efficient storage administration. Storage management is inherently complex, and misconfigurations or improper operations can lead to data loss, making maintenance highly demanding.</li>
</ul>
<blockquote>
<p>Even so, in the absence of stable and large-scale storage support, a integrated storage-compute architecture remains the optimal choice.</p>
</blockquote>
<p>As cloud infrastructure matures, enterprises increasingly seek <strong>deeper Apache Doris integration with public clouds, private clouds, and Kubernetes (K8s) container platforms</strong> to unlock greater elasticity and flexibility. Public clouds offer mature object storage with on-demand compute resources, eliminating the need for pre-allocated space, while private clouds leverage technologies like K8s and MinIO to build scalable resource platforms. <strong>This evolution in cloud infrastructure has also accelerated Apache Doris’ transition to a storage-compute decoupled architecture, enabling lower costs, high elasticity, and enhanced workload isolation.</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=apache-doris-compute-storage-decoupled-mode>Apache Doris Compute-Storage Decoupled Mode<a href=#apache-doris-compute-storage-decoupled-mode class=hash-link aria-label="Apache Doris Compute-Storage Decoupled Mode的直接链接" title="Apache Doris Compute-Storage Decoupled Mode的直接链接">​</a></h2>
<p>Since <a href=https://doris.apache.org/blog/release-note-3.0.0 target=_blank rel="noopener noreferrer">version 3.0</a>, Apache Doris has supported both the compute-storage decoupled mode and the compute-storage coupled mode.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=01-compute-storage-decoupled>01 Compute-Storage Decoupled<a href=#01-compute-storage-decoupled class=hash-link aria-label="01 Compute-Storage Decoupled的直接链接" title="01 Compute-Storage Decoupled的直接链接">​</a></h3>
<p>In the compute-storage decoupled mode, Apache Doris adopts a three-tier architecture consisting of three layers: shared storage, compute groups, and meta data service:</p>
<p><img decoding=async loading=lazy alt=compute-storage-decoupled.jpg src=/zh-CN/assets/images/compute-storage-decoupled-2d3232ea831640a90da2fda54c82051f.jpg width=2560 height=1672 class=img_ev3q></p>
<p><strong>Shared Storage Layer</strong></p>
<p>Data is persisted in the shared storage layer, allowing compute nodes to access and share data seamlessly. This design enhances compute node flexibility and reduces operational overhead. Leveraging mature and reliable shared storage results in ultra-low storage costs and high data reliability. Whether using public cloud object storage or enterprise-managed shared storage, this approach greatly reduces the maintenance complexity of Apache Doris.</p>
<p><strong>Compute Groups</strong></p>
<p>The compute layer consists of multiple compute groups responsible for executing query plans. Each query is executed within a single compute group, ensuring isolation and scalability. Compute nodes are stateless, utilizing local disks as high-speed caches to accelerate queries while sharing the same data and metadata services. Each compute group operates independently, supporting on-demand scaling, and local caches remain isolated to ensure workload separation and performance consistency.</p>
<p><strong>Meta Data Service</strong></p>
<p>The meta data layer manages system meta data, including databases, tables, schemas, rowset meta data, and transaction information, with support for horizontal scaling. Future iterations of Apache Doris’ compute-storage decoupled mode will introduce stateless Frontend (FE) nodes, where memory consumption is decoupled from cluster size. This evolution will eliminate memory bottlenecks, allowing FE nodes to operate with minimal memory requirements.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=02-architecture-design>02 Architecture Design<a href=#02-architecture-design class=hash-link aria-label="02 Architecture Design的直接链接" title="02 Architecture Design的直接链接">​</a></h3>
<p>Traditional compute-storage decoupling approaches typically store both data and meta data in shared storage while centralizing transaction management on a single FE node. However, this design introduces several challenges:</p>
<ul>
<li><strong>Write performance bottlenecks</strong>: The two-phase commit protocol, driven by FE Master, incurs high latency and low throughput.</li>
<li><strong>Small file proliferation</strong>: Frequent meta data writes generate excessive small files, leading to system instability and inflated storage costs.</li>
<li><strong>Scalability constraints</strong>: Since FE nodes manage meta data in memory, an increasing number of Tablets amplifies memory pressure, eventually causing write bottlenecks.</li>
<li><strong>Data deletion risks</strong>: Relying on delta computation with timeout-based mechanisms for deletion introduces challenges in synchronizing writes and deletions. As a result, there is a risk of unintended data loss due to misalignment between ongoing writes and scheduled deletions.</li>
</ul>
<p>Compared to traditional approaches, <strong>Apache Doris</strong> effectively addresses these challenges through <strong>a shared meta data service</strong>:</p>
<ul>
<li><strong>Real-time ingestion</strong>: The meta data service provides a globally consistent view, enabling low-latency, high-throughput writes. Benchmarks show that the Apache Doris compute-storage decoupled mode achieves <strong>100X higher</strong> performance than other solutions at 50 concurrent writes and <strong>11X higher</strong> performance at 500 concurrent writes.</li>
<li><strong>Optimized small file management</strong>: Data is written to shared storage, while meta data is handled by the meta data service. This effectively reduces small file overheads. Tests indicate that the Apache Doris compute-storage decoupled mode generates only <strong>1/2 the number of write files</strong> compared to other industry solutions.</li>
<li><strong>Enhanced scalability</strong>: In future versions of Apache Doris, FE metadata will be moved to the meta data service to eliminate cluster scaling limitations and ensure seamless expansion.</li>
<li><strong>Reliable data deletion</strong>: Doris employs a forward deletion mechanism based on a globally consistent view. This ensures mutual exclusion between writes and deletions, thus eliminating the risk of accidental data loss.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=03-what-makes-it-stand-out>03 What makes it stand out<a href=#03-what-makes-it-stand-out class=hash-link aria-label="03 What makes it stand out的直接链接" title="03 What makes it stand out的直接链接">​</a></h3>
<p>The Apache Doris compute-storage decoupled architecture provide values for users in three aspects: cost efficiency, elasticity, and workload isolation.</p>
<p><strong>Firstly, it brings a 90% cost reduction compared to the compute-storage coupled mode.</strong></p>
<ul>
<li><strong>Pay-as-you-go</strong>: Unlike traditional coupled architectures, there’s no need to pre-provision compute and storage resources. Storage costs scale with actual usage, while compute resources can be dynamically adjusted based on demand.</li>
<li><strong>Single-replica storage</strong>: Instead of maintaining three replicas in costly block storage, data is stored as a single replica in low-cost object storage, with hot data cached in block storage for performance. This dramatically reduces storage footprint and hardware costs. For example, S3 costs only 25% to 50% of AWS EBS.</li>
<li><strong>Lower resource consumption</strong>: In compute-storage decoupled mode, compaction operations only process a single data replica, thus largely reducing resource usage compared to multi-replica environments.</li>
</ul>
<p><strong>Secondly, with a stateless compute node design, Doris enables on-demand resource scaling to meet fluctuating workloads efficiently.</strong></p>
<ul>
<li><strong>Elastic auto-scaling</strong>: Compute resources can be dynamically scaled to accommodate traffic spikes or workload variations. When demand increases, Doris can rapidly scale out compute nodes; when demand drops, resources scale down automatically, avoiding unnecessary costs.</li>
<li><strong>Fine-grained compute resource allocation</strong>: Doris allows compute nodes to be strategically assigned to specific compute groups based on workload requirements. For example, high-performance nodes handle complex queries and high-concurrency workloads, while standard nodes manage lightweight queries and infrequent requests.</li>
</ul>
<p><strong>Thirdly, Doris provides efficient resource scheduling and workload isolation mechanisms.</strong></p>
<ul>
<li><strong>Cross-business isolation</strong>: Different business units can be assigned dedicated compute groups with physical isolation, so workloads operate on dedicated resources without interference.</li>
<li><strong>Offline workload isolation</strong>: Large-scale batch processing tasks can be segregated into dedicated compute groups, so users can leverage low-cost resources for offline data processing without impacting real-time business performance.</li>
<li><strong>Read-write isolation</strong>: Doris allows dedicated compute groups for read and write operations to ensure consistent query response times even under high write loads.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=benchmarking-and-comparison>Benchmarking and comparison<a href=#benchmarking-and-comparison class=hash-link aria-label="Benchmarking and comparison的直接链接" title="Benchmarking and comparison的直接链接">​</a></h2>
<p>To provide a clear evaluation of the compute-storage decoupled architecture of Apache Doris, we conducted a series of benchmark tests across multiple dimensions, including data ingestion, query performance, and resource cost efficiency.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=01-ingestion-performance>01 Ingestion performance<a href=#01-ingestion-performance class=hash-link aria-label="01 Ingestion performance的直接链接" title="01 Ingestion performance的直接链�接">​</a></h3>
<p><strong>High-concurrency ingestion</strong></p>
<p>We compared Apache Doris' coupled and decoupled modes with other mainstream solutions under the same compute resources. The tests measured real-time ingestion performance under two levels of concurrency:</p>
<ul>
<li><strong>50 concurrent writes</strong>: Ingesting <strong>250 files</strong>, each containing <strong>20,000 rows</strong>.</li>
<li><strong>500 concurrent writes</strong>: Ingesting <strong>10,000 files</strong>, each containing <strong>500 rows</strong>.</li>
</ul>
<p><strong>Test results:</strong></p>
<ul>
<li>At 50 concurrent writes, Doris' compute-storage decoupled mode performed on par with the coupled mode while achieving <strong>100X the write performance</strong> of other industry compute-storage decoupled solutions.</li>
<li>At 500 concurrent writes, Doris' decoupled mode experienced a slight performance drop compared to the coupled mode, yet still maintained an <strong>11X advantage</strong> over other compute-storage decoupled architectures.</li>
</ul>
<p><img decoding=async loading=lazy alt=high-concurrency-ingestion.jpg src=/zh-CN/assets/images/high-concurrency-ingestion-d5dd1a2bf593d5d956899f9061faafff.jpg width=2560 height=1696 class=img_ev3q></p>
<p><strong>Batch data ingestion</strong></p>
<p>To evaluate batch data ingestion efficiency, we conducted tests using <strong>TPC-H 1TB</strong> and <strong>TPC-DS 1TB</strong> datasets, comparing the compute-storage coupled and decoupled modes of Apache Doris. Data was loaded using S3 Load. Under default configurations, multiple tables were ingested sequentially, and the total ingestion time was measured for comparison.</p>
<p>Hardware configuration:</p>
<ul>
<li>Cluster size: 4 compute instances (1 FE, 3 BE)</li>
<li>CPU: 48 cores per instance</li>
<li>Memory: 192GB per instance</li>
<li>Network Bandwidth: 21 Gbps</li>
<li>Storage: Enhanced SSD</li>
</ul>
<p><img decoding=async loading=lazy alt=batch-data-ingestion.jpg src=/zh-CN/assets/images/batch-data-ingestion-31be0ce398e88a036d547d4f118dd0fe.jpg width=2560 height=1724 class=img_ev3q></p>
<p>As is shown, even when using a single replica in both architectures, the compute-storage decoupled mode outperforms the coupled mode in batch data ingestion by <strong>20.05%</strong> and <strong>27.98%</strong> in the two benchmarks, respectively. <em>(In real-world deployments, the coupled mode typically adopts a three-replica strategy. This further amplifies the write performance gains of the decoupled mode.)</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=02-query-performance>02 Query Performance<a href=#02-query-performance class=hash-link aria-label="02 Query Performance的直接链接" title="02 Query Performance的直接链接">​</a></h3>
<p>In the compute-storage decoupled mode, Apache Doris leverages a multi-tier caching mechanism to accelerate queries. It improves overall query efficiency by speeding up data access and minimizing reliance on shared storage. The cache hierarchy includes:</p>
<ul>
<li><strong>Doris Page Cache</strong>: In-memory caching of decompressed data.</li>
<li><strong>Linux Page Cache</strong>: In-memory caching of compressed data.</li>
<li><strong>Local Disk Cache</strong>: Persistent caching of compressed data.</li>
</ul>
<p>Hardware configuration:</p>
<ul>
<li>Cluster size: 4 compute instances (1 FE, 3 BE)</li>
<li>CPU: 48 cores per instance</li>
<li>Memory: 192GB per instance</li>
<li>Network Bandwidth: 21 Gbps</li>
<li>Storage: Enhanced SSD</li>
</ul>
<p>We conducted performance benchmarking under different caching scenarios in both compute-storage coupled and decoupled modes. Using the TPC-DS 1TB dataset, the test results are as follows:</p>
<p><img decoding=async loading=lazy alt=query-performance.jpg src=/zh-CN/assets/images/query-performance-ab1378fa622ca786bab45122d1fdb148.jpg width=2560 height=1750 class=img_ev3q></p>
<ul>
<li><strong>Full cache hit</strong>: We execute the query twice and measure the runtime of the second execution, ensuring that all data is preloaded into the cache. Query performance in compute-storage decoupled mode matches that of the coupled architecture with no performance degradation.</li>
<li><strong>Partial cache hit</strong> (This scenario best reflects real-world usage.): Before the test begins, all caches are cleared, and we measure the runtime of the first execution while data is gradually loaded into the cache. Compared to the coupled architecture, query performance remains nearly identical, with an overall performance overhead of about 10%.</li>
<li><strong>No cache hit</strong>: All caches are cleared before each SQL execution, ensuring that every query runs without cached data. Compared to the coupled architecture, query performance sees an approximate 35% degradation.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=03-resource-cost>03 Resource Cost<a href=#03-resource-cost class=hash-link aria-label="03 Resource Cost的直接链接" title="03 Resource Cost的直接链接">​</a></h3>
<p><strong>Operational cost for online workloads</strong></p>
<p>Taking a real-world enterprise workload as an example, we compare the cost differences between compute-storage coupled and decoupled modes in Apache Doris.</p>
<ul>
<li><strong>Compute-storage coupled mode</strong>: The dataset in Doris has a size of 100TB per replica, resulting in a total of 300TB with three replicas. To prevent frequent scaling operations from impacting business stability, disk usage is maintained at about 50%. Thus, <strong>the monthly resource cost amounts to $36,962.7</strong> (as detailed below).</li>
</ul>
<p><img decoding=async loading=lazy alt=operational-cost-for-online-workloads.jpg src=/zh-CN/assets/images/operational-cost-for-online-workloads-b35a29cc9978a97e61ee1bbf9b4eefd7.jpg width=2560 height=794 class=img_ev3q></p>
<ul>
<li><strong>Compute-storage decoupled mode</strong>: With the same data scale, adopting the compute-storage decoupled model only requires storing a single replica in object storage, while hot data is cached on local disks. As shown below, the monthly resource cost is reduced to <strong>$22,212.65</strong>, achieving a 40% cost savings.</li>
</ul>
<p><img decoding=async loading=lazy alt=compute-storage-decoupled-mode.jpg src=/zh-CN/assets/images/compute-storage-decoupled-mode-4adafd0d76ba5c1b2be6ca48e7ff5783.jpg width=2954 height=840 class=img_ev3q></p>
<p><strong>Historical data cost</strong></p>
<p>For example, with 200TB of historical data, the resource utilization under both the compute-storage coupled and decoupled modes is shown below. The coupled model incurs a monthly cost of $48,851.10, whereas the decoupled model reduces the cost to just $4,502.40—<strong>cutting expenses by over 90%</strong>.</p>
<p><img decoding=async loading=lazy alt=historical-data-cost.jpg src=/zh-CN/assets/images/historical-data-cost-de9a66084e736214e67a80a659fcc278.jpg width=3220 height=794 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=whats-next>What's next<a href=#whats-next class=hash-link aria-label="What's next的直接链接" title="What's next的直接链接">​</a></h2>
<p>Powered by compute-storage decoupling, Apache Doris excels in real-time analytics, lakehouse analytics, observability and log storage & analysis. Looking ahead, Apache Doris will continue to enhance its capabilities in this mode. We will introduce new features such as snapshots, time travel, and Cross-Cluster Replication (CCR) support, and achieve stateless FE to further improve system stability and usability.</p>
<p>If you're interested in Apache Doris' compute-storage decoupled mode and its future development, we invite you to join the <a href=https://apachedoriscommunity.slack.com/archives/C08HZUZ37KJ target=_blank rel="noopener noreferrer">#compute-storage-decoupled</a> channel in the Apache Doris Slack community, where you can connect with core developers and users. We look forward to your thoughts and contributions!</p>
<p><a href=https://www.linkedin.com/events/exploringapachedoriscompute-sto7308127084457902080/comments/ target=_blank rel="noopener noreferrer">Join us live on March 27</a> for more insights into the Apache Doris compute-storage decoupled mode!</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/auto-partition-in-apache-doris/>Automatic and flexible data sharding: Auto Partition in Apache Doris</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2024-08-14T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2024年8月14日</time></div></header><div class=markdown itemprop=articleBody><p>To handle large datasets, distributed databases introduce strategies like partitioning and bucketing. Data is divided into smaller units based on specific rules and distributed across different nodes, so databases can perform parallel processing for higher performance and data management flexibility.</p>
<p>Like in many databases, <a href=https://doris.apache.org target=_blank rel="noopener noreferrer">Apache Doris</a> shards data into partitions, and then a partition is further divided into buckets. <strong>Partitions</strong> are typically defined by time or other continuous values. This allows query engines to quickly locate the target data during queries by pruning irrelevant data ranges.</p>
<p><strong>Bucketing</strong>, on the other hand, distributes data based on the hash values of one or more columns, which prevents data skew.</p>
<p>Prior to version <a href=https://doris.apache.org/blog/release-note-2.1.0 target=_blank rel="noopener noreferrer">2.1.0</a>, there are two way you can create data partitions in Apache Doris:</p>
<ul>
<li>
<p><strong><a href=https://doris.apache.org/docs/table-design/data-partitioning/manual-partitioning target=_blank rel="noopener noreferrer">Manual Partition</a></strong>: Users specify the partitions in the table creation statement, or modify them through DDL statements afterwards.</p>
</li>
<li>
<p><strong><a href=https://doris.apache.org/docs/table-design/data-partitioning/dynamic-partitioning target=_blank rel="noopener noreferrer">Dynamic Partition</a></strong>: The system automatically maintains partitions within a pre-defined range based on the data ingestion time.</p>
</li>
</ul>
<p>In Apache Doris 2.1.0, we have introduced <strong><a href=https://doris.apache.org/docs/table-design/data-partitioning/auto-partitioning target=_blank rel="noopener noreferrer">Auto Partition</a></strong>. It supports partitioning data by RANGE or by LIST and further enhances flexibility on top of automatic partitioning.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=evolution-of-partitioning-strategies-in-doris>Evolution of partitioning strategies in Doris<a href=#evolution-of-partitioning-strategies-in-doris class=hash-link aria-label="Evolution of partitioning strategies in Doris的直接链接" title="Evolution of partitioning strategies in Doris的直接链接">​</a></h2>
<p>In the design of data distribution, we focus more on partition planning, because the choice of partition columns and partition intervals heavily depends on the actual data distribution patterns, and a good partition design can largely improve the query and storage efficiency of the table.</p>
<p>In Doris, the data table is divided into partitions and then buckets in a hierarchical manner. The data within the same bucket then forms a data <strong>tablet</strong>, which is the minimum physical storage unit in Doris for data replication, inter-cluster data scheduling, and load balancing.</p>
<p><img decoding=async loading=lazy alt="Evolution of partitioning strategies in Doris" src=/zh-CN/assets/images/evolution-of-partitioning-strategies-in-Doris-28ecf81690866d81a59ef418c611a5d4.png width=1280 height=614 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=manual-partition>Manual Partition<a href=#manual-partition class=hash-link aria-label="Manual Partition的直接链接" title="Manual Partition的直接链接">​</a></h3>
<p>Doris allows users to manually create data partitions by RANGE and by LIST.</p>
<p>For time-stamped data like logs and transaction records, users typically create partitions based on the time dimension. Here's an example of the CREATE TABLE statement:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> example_range_tbl</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> LARGEINT </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"User ID"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Data import date"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">timestamp</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Data import timestamp"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Location of user"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SMALLINT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Age of user"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TINYINT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Sex of user"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">last_visit_date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1970-01-01 00:00:00"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Last visit date of user"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">cost</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> SUM </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"0"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"User consumption"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">max_dwell_time</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain"> MAX </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"0"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Maximum dwell time of user"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">min_dwell_time</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain"> MIN </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"99999"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Minimum dwell time of user"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">AGGREGATE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">timestamp</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">p201701</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> LESS THAN </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"2017-02-01"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">p201702</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> LESS THAN </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"2017-03-01"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">p201703</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> LESS THAN </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"2017-04-01"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">p2018</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"2018-01-01"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"2019-01-01"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">16</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"replication_num"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The table is partitioned by the data import date <code>date</code>, and 4 partitions have been pre-created. Within each partition, the data is further divided into 16 buckets based on the hash value of the <code>user_id</code>.</p>
<p>With this partitioning and bucketing design, when querying data from 2018 onwards, the system only need to scan the <code>p2018</code> partition. This is what the query SQL looks like:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> example_range_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'20180101'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------------------------------------------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Explain</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Nereids Planner</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------------------------------------------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PLAN</span><span class="token plain"> FRAGMENT </span><span class="token number">0</span><span class="token plain">                                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">   OUTPUT EXPRS:                                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">     </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token comment" style="color:rgb(98, 114, 164)">#11]                                                                    |</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">   </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain">: UNPARTITIONED                                                           </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">                                                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">                                                                            </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">                                                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">   </span><span class="token number">0</span><span class="token plain">:VOlapScanNode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">193</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                                                               </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain">: test</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">example_range_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">example_range_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> PREAGGREGATION: </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">OFF</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">          </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      PREDICATES: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token comment" style="color:rgb(98, 114, 164)">#1] >= '2018-01-01')                                          |</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      partitions</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">4</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">p2018</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tablets</span><span class="token operator">=</span><span class="token number">16</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tabletList</span><span class="token operator">=</span><span class="token number">561490</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">561492</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">561494</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      cardinality</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> avgRowSize</span><span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> numNodes</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain">                                       </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      pushAggOp</span><span class="token operator">=</span><span class="token plain">NONE                                                                  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">                                                                                      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------------------------------------------------------+</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If the data is distributed unevenly across partitions, the hash-based bucketing mechanism can further divide the data based on the <code>user_id</code>. This helps to avoid load imbalance on some machines during querying and storage.</p>
<p>However, in real-world business scenarios, one cluster may have tens of thousands of tables, which means it is impossible to manage them manually.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">DAILY_TRADE_VALUE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">              datev2 </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Trade date'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Trade ID'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200001 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-02-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200002 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-02-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200003 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-04-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200004 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-04-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-05-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200005 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-05-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-06-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200006 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-06-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-07-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200007 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-07-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-08-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200008 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-08-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-09-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200009 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-09-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-10-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200010 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-10-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-11-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200011 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-11-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-12-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200012 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2000-12-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2001-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p_200101 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2001-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2001-02-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>In the above example, data is partitioned on a monthly basis. This requires the database administrator (DBA) to manually add a new partition each month and maintain table schema regularly. Imagine the case of real-time data processing, where you might need to create partitions daily or even hourly, manually doing this is no long a choice. That's why we introduced Dynamic Partition.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=dynamic-partition>Dynamic Partition<a href=#dynamic-partition class=hash-link aria-label="Dynamic Partition的直接链接" title="Dynamic Partition的直接链接">​</a></h3>
<p>By Dynamic Partition, Doris automatically creates and reclaims data partitions as long as the user specifies the partition unit, the number of historical partitions, and the number of future partitions. This functionality relies on a fixed thread on the Doris Frontend. It continuously polls and checks for new partitions to be created or old partitions to be reclaimed, and updates the partition schema of the table.</p>
<p>This is an example CREATE TABLE statement for a table which is partitioned by day. The <code>start</code> and <code>end</code> parameters are set to <code>-7</code> and <code>3</code>, respectively, meaning that data partitions for the next 3 days will be pre-created and the historical partitions that are older than 7 days will be reclaimed.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">DAILY_TRADE_VALUE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">              datev2 </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Trade date'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Trade ID'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.enable"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"true"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.time_unit"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"DAY"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.start"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"-7"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.end"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"3"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.prefix"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"p"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.buckets"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"10"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Over time, the table will always maintain partitions within the range of <code>[current date - 7, current date + 3]</code>. Dynamic Partition is particularly useful for real-time data ingestion scenarios, such as when the ODS (Operational Data Store) layer directly receives data from external sources like Kafka.</p>
<p>The <code>start</code> and <code>end</code> parameters define a fixed range for the partitions, allowing the user to manage the partitions only within this range. However, if the user needs to include more historical data, they would have to dial up the <code>start</code> value, and that could lead to unnecessary metadata overhead in the cluster.</p>
<p>Therefore, when applying Dynamic Partition, there is a trade-off between the convenience and efficiency of metadata management.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=developers-words>Developers' words<a href=#developers-words class=hash-link aria-label="Developers' words的直接链接" title="Developers' words的直接链接">​</a></h2>
<p>As the complexity of business adds up, Dynamic Partition becomes inadequate because:</p>
<ul>
<li>
<p>It only supports partitioning by RANGE but not by LIST.</p>
</li>
<li>
<p>It can only be applied to the current real-world timestamps.</p>
</li>
<li>
<p>It only supports a single continuous partition range, and cannot accommodate partitions outside of that range.</p>
</li>
</ul>
<p>Given these functional limitations, we started to plan a new partitioning mechanism that can both automate partition management and simplify data table maintenance.</p>
<p>We figured out that the ideal partitioning implementation should:</p>
<ul>
<li>
<p>Save the need for manually creating partitions after table creation;</p>
</li>
<li>
<p>Be able to accommodate all ingested data in corresponding partitions.</p>
</li>
</ul>
<p><strong>The former stands for automation and the latter for flexibility. The essence of realizing them both is associating partition creation with the actual data.</strong></p>
<p>Then we started to think about: What if we hold off the creation of partitions until the data is ingested, rather than doing it during table creation or through regular polling. Instead of pre-constructing the partition distribution, we can define the "data-to-partition" mapping rules, so the partitions are created after data arrives.</p>
<p>Compared to Manual Partition, this whole process would be fully automated, eliminating the need for human maintenance. Compared to Dynamic Partition, it avoids having partitions that are not used, or partitions that are needed but not present.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=auto-partition>Auto Partition<a href=#auto-partition class=hash-link aria-label="Auto Partition的直接链接" title="Auto Partition的直接链接">​</a></h2>
<p>With <a href=https://doris.apache.org/blog/release-note-2.1.0 target=_blank rel="noopener noreferrer">Apache Doris 2.1.0</a>, we bring the above plan into fruition. During data ingestion, Doris creates data partitions based on the configured rules. The Doris Backend nodes that are responsible for data processing and distribution will attempt to find the appropriate partition for each row of data in the DataSink operator of the execution plan. It no longer filters out data that does not fit into any existing partition or reports an error for such a situation, but automatically generates partitions for all ingested data.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=auto-partition-by-range>Auto Partition by RANGE<a href=#auto-partition-by-range class=hash-link aria-label="Auto Partition by RANGE的直接链接" title="Auto Partition by RANGE的直接链接">​</a></h3>
<p>Auto Partition by RANGE provides an optimized partitioning solution based on the time dimension. It is more flexible than Dynamic Partition in terms of parameter configuration. The syntax for it is as follows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">AUTO </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">FUNC_CALL_EXPR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">FUNC_CALL_EXPR ::</span><span class="token operator">=</span><span class="token plain"> DATE_TRUNC </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">partition_column</span><span class="token operator">></span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'&lt;interval>'</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The <code>&lt;partition_column></code> above is the partition column (i.e., the column that the partitioning is based on). <code>&lt;interval></code>specifies the partition unit, which is the desired width of each partition.</p>
<p>For example, if the partition column is <code>k0</code> and you want to partition by month, the partition statement would be <code>AUTO PARTITION BY RANGE (DATE_TRUNC(k0, 'month'))</code>. For all the imported data, the system will call <code>DATE_TRUNC(k0, 'month')</code> to calculate the left endpoint of the partition, and then the right endpoint by adding one <code>interval</code>.</p>
<p>Now, we can apply Auto Partition to the <code>DAILY_TRADE_VALUE</code> table introduced in the previous section on Dynamic Partition.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> DAILY_TRADE_VALUE</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">    DATEV2 </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Trade Date'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Trade ID'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">AUTO </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">DATE_TRUNC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'month'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>After importing some data, these are the partitions we get:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">show</span><span class="token plain"> partitions </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> DAILY_TRADE_VALUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Empty </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.10</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> DAILY_TRADE_VALUE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2015-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2020-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-05'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-06'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10001</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.24</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">'label'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'label_2a7353a3f991400e_ae731988fa2bc568'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'status'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'VISIBLE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'txnId'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'85097'</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">show</span><span class="token plain"> partitions </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> DAILY_TRADE_VALUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> PartitionId </span><span class="token operator">|</span><span class="token plain"> PartitionName   </span><span class="token operator">|</span><span class="token plain"> VisibleVersion </span><span class="token operator">|</span><span class="token plain"> VisibleVersionTime  </span><span class="token operator">|</span><span class="token plain"> State  </span><span class="token operator">|</span><span class="token plain"> PartitionKey </span><span class="token operator">|</span><span class="token plain"> Range                                                                          </span><span class="token operator">|</span><span class="token plain"> DistributionKey </span><span class="token operator">|</span><span class="token plain"> Buckets </span><span class="token operator">|</span><span class="token plain"> ReplicationNum </span><span class="token operator">|</span><span class="token plain"> StorageMedium </span><span class="token operator">|</span><span class="token plain"> CooldownTime        </span><span class="token operator">|</span><span class="token plain"> RemoteStoragePolicy </span><span class="token operator">|</span><span class="token plain"> LastConsistencyCheckTime </span><span class="token operator">|</span><span class="token plain"> DataSize </span><span class="token operator">|</span><span class="token plain"> IsInMemory </span><span class="token operator">|</span><span class="token plain"> ReplicaAllocation       </span><span class="token operator">|</span><span class="token plain"> IsMutable </span><span class="token operator">|</span><span class="token plain"> SyncWithBaseTables </span><span class="token operator">|</span><span class="token plain"> UnsyncTables </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">588395</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p20150101000000 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">19</span><span class="token plain">:</span><span class="token number">02</span><span class="token plain">:</span><span class="token number">40</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">588437</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p20200101000000 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">19</span><span class="token plain">:</span><span class="token number">02</span><span class="token plain">:</span><span class="token number">40</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">588416</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p20240301000000 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">19</span><span class="token plain">:</span><span class="token number">02</span><span class="token plain">:</span><span class="token number">40</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.09</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>As is shown, partitions are automatically created for the imported data, and it doesn't create partitions that are beyond the range of the existing data.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=auto-partition-by-list>Auto Partition by LIST<a href=#auto-partition-by-list class=hash-link aria-label="Auto Partition by LIST的直接链接" title="Auto Partition by LIST的直接链接">​</a></h3>
<p>Auto Partition by LIST is to shard data based on non-time-based dimensions, such as <code>region</code> and <code>department</code>. It fills that gap for Dynamic Partition, which does not support data partitioning by LIST.</p>
<p>Auto Partition by RANGE provides an optimized partitioning solution based on the time dimension. It is more flexible than Dynamic Partition in terms of parameter configuration. The syntax for it is as follows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">AUTO </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> LIST </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">partition_col</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This is an example of Auto Partition by LIST using <code>city</code> as the partition column:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">str_table</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> AUTO </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> LIST </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.09</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> str_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Denver"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Boston"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Los_Angeles"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.25</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">show</span><span class="token plain"> partitions </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> str_table</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+-------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> PartitionId </span><span class="token operator">|</span><span class="token plain"> PartitionName   </span><span class="token operator">|</span><span class="token plain"> VisibleVersion </span><span class="token operator">|</span><span class="token plain"> VisibleVersionTime  </span><span class="token operator">|</span><span class="token plain"> State  </span><span class="token operator">|</span><span class="token plain"> PartitionKey </span><span class="token operator">|</span><span class="token plain"> Range                                     </span><span class="token operator">|</span><span class="token plain"> DistributionKey </span><span class="token operator">|</span><span class="token plain"> Buckets </span><span class="token operator">|</span><span class="token plain"> ReplicationNum </span><span class="token operator">|</span><span class="token plain"> StorageMedium </span><span class="token operator">|</span><span class="token plain"> CooldownTime        </span><span class="token operator">|</span><span class="token plain"> RemoteStoragePolicy </span><span class="token operator">|</span><span class="token plain"> LastConsistencyCheckTime </span><span class="token operator">|</span><span class="token plain"> DataSize </span><span class="token operator">|</span><span class="token plain"> IsInMemory </span><span class="token operator">|</span><span class="token plain"> ReplicaAllocation       </span><span class="token operator">|</span><span class="token plain"> IsMutable </span><span class="token operator">|</span><span class="token plain"> SyncWithBaseTables </span><span class="token operator">|</span><span class="token plain"> UnsyncTables </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+-------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">589685</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> pDenver7        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain">:</span><span class="token number">12</span><span class="token plain">:</span><span class="token number">37</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> city         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Denver</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> city            </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">589643</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> pLos5fAngeles11 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain">:</span><span class="token number">12</span><span class="token plain">:</span><span class="token number">37</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> city         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Los_Angeles</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> city            </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">589664</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> pBoston8        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain">:</span><span class="token number">12</span><span class="token plain">:</span><span class="token number">37</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> city         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Boston</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> city            </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+-------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.10</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>After inserting data for the cities of Denver, Boston, and Los Angeles, the system automatically created corresponding partitions based on the city names. Previously, this type of custom partitioning could only be achieved through manual DDL statements. This is how Auto Partition by LIST simplifies database maintenance.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=tips--notes>Tips & notes<a href=#tips--notes class=hash-link aria-label="Tips & notes的直接链接" title="Tips & notes的直接链接">​</a></h3>
<p><strong>Manually adjust historical partitions</strong></p>
<p>For tables that receive both real-time data and occasional historical updates, since Auto Partition does not automatically reclaim historical partitions, we recommend two options:</p>
<ul>
<li>
<p>Use Auto Partition, which will automatically create partitions for the occasional historical data updates.</p>
</li>
<li>
<p>Use Auto Partition and manually create a <code>LESS THAN</code> partition to accommodate the historical updates. This allows for a clearer separation of historical and real-time data, and makes data management easier.</p>
</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> DAILY_TRADE_VALUE</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">    DATEV2 </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Trade Date'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_ID</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Trade ID'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> AUTO </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">DATE_TRUNC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'DAY'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">pHistory</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> LESS THAN </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"2024-01-01"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">TRADE_DATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> PROPERTIES</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token string" style="color:rgb(255, 121, 198)">"replication_num"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.11</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> DAILY_TRADE_VALUE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2015-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2020-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-05'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-06'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10001</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.25</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">'label'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'label_96dc3d20c6974f4a_946bc1a674d24733'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'status'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'VISIBLE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'txnId'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'85092'</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">show</span><span class="token plain"> partitions </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> DAILY_TRADE_VALUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> PartitionId </span><span class="token operator">|</span><span class="token plain"> PartitionName   </span><span class="token operator">|</span><span class="token plain"> VisibleVersion </span><span class="token operator">|</span><span class="token plain"> VisibleVersionTime  </span><span class="token operator">|</span><span class="token plain"> State  </span><span class="token operator">|</span><span class="token plain"> PartitionKey </span><span class="token operator">|</span><span class="token plain"> Range                                                                          </span><span class="token operator">|</span><span class="token plain"> DistributionKey </span><span class="token operator">|</span><span class="token plain"> Buckets </span><span class="token operator">|</span><span class="token plain"> ReplicationNum </span><span class="token operator">|</span><span class="token plain"> StorageMedium </span><span class="token operator">|</span><span class="token plain"> CooldownTime        </span><span class="token operator">|</span><span class="token plain"> RemoteStoragePolicy </span><span class="token operator">|</span><span class="token plain"> LastConsistencyCheckTime </span><span class="token operator">|</span><span class="token plain"> DataSize </span><span class="token operator">|</span><span class="token plain"> IsInMemory </span><span class="token operator">|</span><span class="token plain"> ReplicaAllocation       </span><span class="token operator">|</span><span class="token plain"> IsMutable </span><span class="token operator">|</span><span class="token plain"> SyncWithBaseTables </span><span class="token operator">|</span><span class="token plain"> UnsyncTables </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577871</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> pHistory        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">53</span><span class="token plain">:</span><span class="token number">49</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0000</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577940</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p20240305000000 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">53</span><span class="token plain">:</span><span class="token number">49</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">05</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">06</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577919</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p20240306000000 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">53</span><span class="token plain">:</span><span class="token number">49</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">06</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">DATEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">07</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> TRADE_DATE      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.10</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>NULL partition</strong></p>
<p>With Auto Partition by LIST, Doris supports storing NULL values in NULL partitions. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> list_nullable</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">str</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> AUTO </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> LIST </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">str</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">str</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS auto</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> PROPERTIES</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token string" style="color:rgb(255, 121, 198)">"replication_num"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.10</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> list_nullable </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'123'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">''</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.24</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">'label'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'label_f5489769c2f04f0d_bfb65510f9737fff'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'status'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'VISIBLE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'txnId'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'85089'</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">show</span><span class="token plain"> partitions </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> list_nullable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+---------------+----------------+---------------------+--------+--------------+------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> PartitionId </span><span class="token operator">|</span><span class="token plain"> PartitionName </span><span class="token operator">|</span><span class="token plain"> VisibleVersion </span><span class="token operator">|</span><span class="token plain"> VisibleVersionTime  </span><span class="token operator">|</span><span class="token plain"> State  </span><span class="token operator">|</span><span class="token plain"> PartitionKey </span><span class="token operator">|</span><span class="token plain"> Range                              </span><span class="token operator">|</span><span class="token plain"> DistributionKey </span><span class="token operator">|</span><span class="token plain"> Buckets </span><span class="token operator">|</span><span class="token plain"> ReplicationNum </span><span class="token operator">|</span><span class="token plain"> StorageMedium </span><span class="token operator">|</span><span class="token plain"> CooldownTime        </span><span class="token operator">|</span><span class="token plain"> RemoteStoragePolicy </span><span class="token operator">|</span><span class="token plain"> LastConsistencyCheckTime </span><span class="token operator">|</span><span class="token plain"> DataSize </span><span class="token operator">|</span><span class="token plain"> IsInMemory </span><span class="token operator">|</span><span class="token plain"> ReplicaAllocation       </span><span class="token operator">|</span><span class="token plain"> IsMutable </span><span class="token operator">|</span><span class="token plain"> SyncWithBaseTables </span><span class="token operator">|</span><span class="token plain"> UnsyncTables </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+---------------+----------------+---------------------+--------+--------------+------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577297</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> pX            </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">19</span><span class="token plain">:</span><span class="token number">21</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> str          </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> str             </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577276</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p0            </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">19</span><span class="token plain">:</span><span class="token number">21</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> str          </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"> str             </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">577255</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> p1233         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain"> </span><span class="token number">08</span><span class="token plain">:</span><span class="token number">19</span><span class="token plain">:</span><span class="token number">21</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> NORMAL </span><span class="token operator">|</span><span class="token plain"> str          </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">types</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">keys</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">123</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> str             </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> HDD           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">9999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain"> </span><span class="token number">23</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain">:</span><span class="token number">59</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">                     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">               </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+---------------+----------------+---------------------+--------+--------------+------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+--------------------+--------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.11</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>However, Auto Partition by RANGE does not support NULL partitions, because the NULL values will be stored in the smallest <code>LESS THAN</code> partition, and it is impossible to reliably determine the appropriate range for it. If Auto Partition were to create a NULL partition with a range of (-INFINITY, MIN_VALUE), there would be a risk of this partition being inadvertently deleted in production, as the MIN_VALUE boundary may not accurately represent the intended business logic.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=summary>Summary<a href=#summary class=hash-link aria-label=Summary的直接链接 title=Summary的直接链接>​</a></h3>
<p>Auto Partition covers most of the use cases of Dynamic Partition, while introducing the benefit of upfront partition rule definition. Once the rules are defined, the bulk of partition creation work is automatically handled by Doris instead of a DBA.</p>
<p>Before utilizing Auto Partition, it's important to understand the relevant limitations:</p>
<ol>
<li>
<p>Auto Partition by LIST supports partitioning based on <strong>multiple columns</strong>, but each automatically created partition only contains one single value, and the partition name cannot exceed 50 characters in length. Note that the partition names follow specific naming conventions, which have particular implications for metadata management. That means not all of the 50-character space is at the user's disposal.</p>
</li>
<li>
<p>Auto Partition by RANGE only supports a <strong>single partition column</strong>, which must be of type <strong>DATE</strong> or <strong>DATETIME</strong>.</p>
</li>
<li>
<p>Auto Partition by LIST supports <strong>NULLABLE</strong> partition column and inserting NULL values. Auto Partition by RANGE does not support NULLABLE partition column.</p>
</li>
<li>
<p>It is not recommended to use Auto Partition in conjunction with Dynamic Partition after Apache Doris 2.1.3.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=performance-comparison>Performance comparison<a href=#performance-comparison class=hash-link aria-label="Performance comparison的直接链接" title="Performance comparison的直接链接">​</a></h2>
<p>The main functional differences between Auto Partition and Dynamic Partition lie in partition creation and deletion, supported partition types, and their impact on import performance.</p>
<p>Dynamic Partition uses fixed threads to periodically create and reclaim partitions. It only supports partitioning by RANGE. In contrast, Auto Partition supports both partitioning by RANGE and by LIST. It automatically creates partitions on-demand based on specific rules during data ingestion, providing a higher level of automation and flexibility.</p>
<p>Dynamic Partition does not slow down data ingestion speed, while Auto Partition causes certain time overheads because it firstly checks for existing partitions and then creates new ones on demand. We will present the performance test results.</p>
<p><img decoding=async loading=lazy alt="Performance comparison" src=/zh-CN/assets/images/performance-comparison-8d7f8ccd4c4267e74e3af342ada5d6fe.png width=1280 height=585 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=auto-partition-ingestion-workflow>Auto Partition: ingestion workflow<a href=#auto-partition-ingestion-workflow class=hash-link aria-label="Auto Partition: ingestion workflow的直接链接" title="Auto Partition: ingestion workflow的直接链接">​</a></h2>
<p>This part is about how data ingestion is implemented with the Auto Partition mechanism, and we use <a href=https://doris.apache.org/docs/data-operate/import/stream-load-manual target=_blank rel="noopener noreferrer">Stream Load</a> as an example. When Doris initiates a data import, one of the Doris Backend nodes takes on the role of the Coordinator. It is responsible for the initial data processing work and then dispatching the data to the appropriate BE nodes, known as the Executors, for execution.</p>
<p><img decoding=async loading=lazy alt="Auto Partition: ingestion workflow" src=/zh-CN/assets/images/auto-partition-ingestion-workflow-3343361208ec317008cf169ac91398be.png width=1280 height=731 class=img_ev3q></p>
<p>In the final Datasink Node of the Coordinator's execution pipeline, the data needs to be routed to the correct partitions, buckets, and Doris Backend node locations before it can be successfully transmitted and stored.</p>
<p>To enable this data transfer, the Coordinator and Executor nodes establish a communication channels:</p>
<ul>
<li>
<p>The sending end is called the Node Channel.</p>
</li>
<li>
<p>The receiving end is called the Tablets Channel.</p>
</li>
</ul>
<p>This is how Auto Partition comes into play during the process of determining the correct partitions for the data:</p>
<p><img decoding=async loading=lazy alt="Auto Partition: ingestion workflow" src=/zh-CN/assets/images/auto-partition-ingestion-workflow-2-7e25e7fd75a37f9da1de58c0f2c46f11.png width=1280 height=348 class=img_ev3q></p>
<p>Previously, without Auto Partition, when a table does not have the required partition, the behavior in Doris is for the BE nodes to accumulate errors until a <code>DATA_QUALITY_ERROR</code> is reported. Now, with Auto Partition enabled, a request will be initiated to the Doris Frontend to create the necessary partition on-the-fly. After the partition creation transaction is completed, the Doris Frontend responds to the Coordinator, which then opens the corresponding communication channels (Node Channel and Tablets Channel) to continue the data ingestion process. This is a seamless experience for users.</p>
<p>In a real-world cluster environment, the time spent by the Coordinator waiting for the Doris Frontend to complete partition creation can incur large overheads. This is due to the inherent latency of Thrift RPC calls, as well as lock contention on the Frontend under high load conditions.</p>
<p>To improve the data ingestion efficiency in Auto Partition, Doris has implemented batching to largely reduce the number of RPC calls made to the FE. This brings a notable performance enhancement for data write operations.</p>
<p>Note that when the FE Master completes the partition creation transaction, the new partition becomes immediately visible. However, if the import process ultimately fails or is canceled, the created partitions are not automatically reclaimed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=auto-partition-performance>Auto Partition performance<a href=#auto-partition-performance class=hash-link aria-label="Auto Partition performance的直接链接" title="Auto Partition performance的直接链接">​</a></h2>
<p>We tested the performance and stability of Auto Partition in Doris, covering different use cases:</p>
<p><strong>Case 1</strong>: 1 Frontend + 3 Backend; 6 randomly generated datasets, each having 100 million rows and 2,000 partitions; ingested the 6 datasets concurrently into 6 tables</p>
<ul>
<li>
<p><strong>Objective</strong>: Evaluate the performance of Auto Partition under high pressure and check for any performance degradation.</p>
</li>
<li>
<p><strong>Results</strong>: Auto Partition brings an <strong>average performance loss less than 5%</strong>, with all import transactions running stably.</p>
</li>
</ul>
<p><img decoding=async loading=lazy alt="Auto Partition performance" src=/zh-CN/assets/images/auto-partition-performance-4739a5a3e97dfe4b88cf2d94b0542c14.png width=1280 height=581 class=img_ev3q></p>
<p><strong>Case 2</strong>: 1 Frontend + 3 Backend; ingesting 100 rows per second from Flink by Routine Load; testing with 1, 10, and 20 concurrent transactions (tables), respectively</p>
<ul>
<li>
<p><strong>Objective</strong>: Identify any potential  or data backlog issues that could arise with Auto Partition under different concurrency levels.</p>
</li>
<li>
<p><strong>Results</strong>: With or without Auto Partition enabled, the data ingestion was successful without any backpressure issues across all the concurrency levels tested, even at 20 concurrent transactions when the CPU utilization reached close to 100%.</p>
</li>
</ul>
<p><img decoding=async loading=lazy alt="Auto Partition performance" src=/zh-CN/assets/images/auto-partition-performance-2-8a3981c9825d5ca4e6b4e3f5aec38708.png width=1280 height=557 class=img_ev3q></p>
<p>To conclude the results of these tests, the impact of enabling Auto Partition on data ingestion performance is minimal.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=conclusion-and-future-plans>Conclusion and future plans<a href=#conclusion-and-future-plans class=hash-link aria-label="Conclusion and future plans的直接链接" title="Conclusion and future plans的直接链接">​</a></h2>
<p>Auto Partition has simplified DDL and partition management since Apache Doris 2.1.0. It is useful in large-scale data processing and makes it easy for users to migrate from other database systems to Apache Doris.</p>
<p>Moreover, we are committed to expanding the capabilities of Auto Partition to support more complex data types.</p>
<p>Plans for Auto Partition by RANGE:</p>
<ul>
<li>
<p>Support numeric values;</p>
</li>
<li>
<p>Allowing users to specify the left and right boundaries of the partition range.</p>
</li>
</ul>
<p>Plans for Auto Partition by LIST:</p>
<ul>
<li>Allow merging multiple values into the same partition based on specific rules.</li>
</ul>
<p>Join <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Apache Doris open-source community</a> for more information and further guidance.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/apache-doris-vs-rockset/>Why Apache Doris is the best open source alternative to Rockset</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · Zaki Lu, Apache Doris Committer</span></span><time datetime=2024-06-24T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2024年6月24日</time></div></header><div class=markdown itemprop=articleBody><p>OpenAI dropped a bomb on the data world by announcing <a href=https://openai.com/index/openai-acquires-rockset/ target=_blank rel="noopener noreferrer">the acquisition of Rockset</a>, a cloud-based, fully managed analytical database. Among all the congratulating voices, one question is raised: <strong>why <a href=https://rockset.com target=_blank rel="noopener noreferrer">Rockset</a></strong>?</p>
<p><img decoding=async loading=lazy alt="OpenAI acquisition Rockset" src=/zh-CN/assets/images/openai-twitter-rockset-629193903b8235732c88086caa39cc0c.png width=1212 height=482 class=img_ev3q></p>
<p>Founded in 2016 by Venkat Venkataramani, former Engineering Director at Meta, Rockset focuses on real-time search and data analytics. Compared to other DBMS, Rockset stands out by its:</p>
<ul>
<li>
<p><strong>Real-time data updates</strong>: Rockset ensures data freshness for users by its capabilities in fetching and delivering the latest data. It supports real-time updates at the granularity of data fields, which can be performed within milliseconds.</p>
</li>
<li>
<p><strong>Converged index</strong>: It reaps the benefits of inverted index, columnar storage, and row-oriented storage, and provides efficient and flexible data querying services.</p>
</li>
<li>
<p><strong>Native support for semi-structured data</strong>: Rockset is well-suited to the growing demand for semi-structured data processing, hash joins, and nested loop joins.</p>
</li>
<li>
<p><strong>SQL and JOIN compatibility</strong>: The Search Index of Rockset is optimized for various join queries.</p>
</li>
</ul>
<p>The news also gaves all Rockset users a ticking time bomb: they have to find an appropriate alternative to Rockset for their own use case within three months. This, of course, arises as an opportunity for other analytical databases on the market. However, of all the claim-to-be alternatives, only a few of them cover all the above-mentioned key features of Rockset. Among them, Apache Doris is worth looking into.</p>
<p>As an open-source real-time data warehouse, Apache Doris is trusted by over 4000 enterprise users worldwide with powerful functionalities including:</p>
<ul>
<li>
<p><strong>Real-time data updates</strong>: Apache Doris supports not only <a href=https://doris.apache.org/docs/table-design/data-model/unique target=_blank rel="noopener noreferrer">real-time updates</a> and deletion, but also real-time partial column updates, making it particularly useful in cases involving frequent data updates.</p>
</li>
<li>
<p><strong>Row/column hybrid storage</strong>: Apache Doris is a column-oriented data warehouse that achieves world-leading OLAP performance on <a href=https://benchmark.clickhouse.com/ target=_blank rel="noopener noreferrer">ClickBench</a>. Additionally, it supports row-oriented storage to serve <a href=https://doris.apache.org/docs/query/high-concurrent-point-query/ target=_blank rel="noopener noreferrer">high-concurrency point query scenarios</a>, which allows it to respond to almost a million query requests within milliseconds.</p>
</li>
<li>
<p><strong><a href=https://doris.apache.org/docs/table-design/index/inverted-index target=_blank rel="noopener noreferrer">Inverted index</a> and full-text searches</strong>: Apache Doris provides high efficiency and flexibility in keyword searching. It allows index creation on all fields and a flexible combination of data fields for multi-dimensional data analysis.</p>
</li>
<li>
<p><strong>Native support for semi-structured data</strong>: Apache Doris has introduced the <a href=https://doris.apache.org/docs/sql-manual/sql-types/Data-Types/VARIANT target=_blank rel="noopener noreferrer">VARIANT</a> data type to accommodate semi-structured data. It enables flexible data schema and high query speed on top of cost-efficient data storage. Compared to traditional JSON methods, VARIANT can bring a 10x performance improvement.</p>
</li>
<li>
<p><strong>Support for various SQL and <a href=https://doris.apache.org/docs/query/join-optimization/doris-join-optimization target=_blank rel="noopener noreferrer">join operations</a></strong>: Apache Doris is highly compatible with MySQL syntaxes and interfaces. It supports INNER JOIN, CROSS JOIN, and all types of OUTER JOIN. The best part is its capability of auto-optimization based on data types to guarantee optimal performance under different circumstances.</p>
</li>
</ul>
<p>As a Top-Level Project of the Apache Software Foundation, Apache Doris is supported by a robust and fast-growing community. It has accumulated over 11.8K GitHub stars and 636 contributors so far.</p>
<p>Apache Doris is the best open-source alternative to Rockset. Feel free to contact <a href=mailto:dev@doris.apache.org target=_blank rel="noopener noreferrer">dev@doris.apache.org</a> for more assistance.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/evolution-of-the-apache-doris-execution-engine/>Steps to industry-leading query speed: evolution of the Apache Doris execution engine</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2024-06-18T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2024年6月18日</time></div></header><div class=markdown itemprop=articleBody><p>What makes a modern database system? The three key modules are query optimizer, execution engine, and storage engine. Among them, the role of execution engine to the DBMS is like the chef to a restaurant. This article focuses on the execution engine of the <a href=https://doris.apache.org target=_blank rel="noopener noreferrer">Apache Doris</a> data warehouse, explaining the secret to its high performance.</p>
<p>To illustrate the role of the execution engine, let's follow the execution process of an SQL statement:</p>
<ul>
<li>
<p>Upon receiving an SQL query, the query optimizer performs syntax/lexical analysis and generates the optimal execution plan based on the cost model and optimization rules.</p>
</li>
<li>
<p>The execution engine then schedules the plan to the nodes, which operate on data in the underlying storage engine and then return the query results.</p>
</li>
</ul>
<p>The execution engine performs operations like data reading, filtering, sorting, and aggregation. The efficiency of these steps determines query performance and resource utilization. That's why different execution models bring distinction in query efficiency.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=volcano-model>Volcano Model<a href=#volcano-model class=hash-link aria-label="Volcano Model的直接链接" title="Volcano Model的直接链接">​</a></h2>
<p>The Volcano Model (originally known as the Iterator Model) predominates in analytical databases, followed by the Materialization Model and Vectorized Model. In a Volcano Model, each operation is abstracted as an operator, so the entire SQL query is an operator tree. During query execution, the tree is traversed top-down by calling the <code>next()</code> interface, and data is pulled and processed from the bottom up. This is called a <strong>pull-based</strong> execution model.</p>
<p>The Volcano Model is flexible, scalable, and easy to implement and optimize. It underpins Apache Doris before version 2.1.0. When a user initiates an SQL query, Doris parses the query, generates a distributed execution plan, and dispatches tasks to the nodes for execution. Each individual task is an <strong>instance</strong>. Take a simple query as an example:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> age</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> sex </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> employees </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> age </span><span class="token operator">></span><span class="token plain"> </span><span class="token number">30</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><img decoding=async loading=lazy alt="Volcano Model" src=/zh-CN/assets/images/doris-volcano-model-bf7cd6bf0fe5c369d9ae4ac0efa617d4.png width=1280 height=874 class=img_ev3q></p>
<p>In an instance, data flows between operators are propelled by the <code>next()</code> method. If the <code>next()</code> method of an operator is called, it will first call the <code>next()</code> of its child operator, obtain data from it, and then process the data to produce output.</p>
<p><code>next()</code> is a synchronous method. In other words, the current operator will be blocked if its child operator does not provide data for it. In this case, the <code>next()</code> method of the root operator needs to be called in a loop until all data is processed, which is when the instance finishes its computation.</p>
<p>Such execution mechanism faces a few bottlenecks in single-node, multi-core use cases:</p>
<ul>
<li>
<p><strong>Thread blocking</strong>: In a fixed-size thread pool, if an instance occupies a thread and it is blocked, that will easily cause a deadlock when there are a large number of instances requesting execution simultaneously. This is especially the case when the current instance is dependent on other instances. Additionally, if a node is running more instances than the number of CPU cores it has, the system scheduling mechanism will be heavily relied upon and a huge context switching overhead can be produced. In a colocation scenario, this will lead to an even larger thread switching overhead.</p>
</li>
<li>
<p><strong>CPU contention</strong>: The threads might compete for CPU resources so queries of different sizes and between different tenants might interfere with each other.</p>
</li>
<li>
<p><strong>Underutilization of the multi-core computing capabilities</strong>: Execution concurrency relies heavily on data distribution. Specifically, the number of instances running on a node is limited by the number of data buckets on that node. In this case, it's important to set an appropriate number of buckets. If you shard the data into too many buckets, that will become a burden for the system and bring unnecessary overheads; if the buckets are too few, you will not be able to utilize your CPU cores to the fullest. However, in a production environment, it is not always easy to estimate the proper number of buckets you need, thus performance loss.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=pipeline-execution-engine>Pipeline Execution Engine<a href=#pipeline-execution-engine class=hash-link aria-label="Pipeline Execution Engine的直接链接" title="Pipeline Execution Engine的直接链接">​</a></h2>
<p>Based on the known issues of Volcano Model, we've replaced it with the Pipeline Execution Engine since Apache Doris 2.0.0.</p>
<p>As the name suggests, the Pipeline Execution Engine breaks down the execution plan into pipeline tasks, and schedules these pipeline tasks into a thread pool in a time-sharing manner. If a pipeline task is blocked, it will be put on hold to release the thread it is occupying. Meanwhile, it supports various scheduling strategies, meaning that you can allocate CPU resources to different queries and tenants more flexibly.</p>
<p>Additionally, the Pipeline Execution Engine pools together data within data buckets, so the number of running instances is no longer capped by the number of buckets. This not only enhances Apache Doris' utilization of multi-core systems, but also improves system performance and stability by avoiding frequent thread creation and deletion.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=example>Example<a href=#example class=hash-link aria-label=Example的直接链接 title=Example的直接链接>​</a></h3>
<p>This is the execution plan of a join query. It includes two instances:</p>
<p><img decoding=async loading=lazy alt="Pipeline Execution Engine" src=/zh-CN/assets/images/doris-pipeline-execution-engine-0f462e7876f79b16a3dd1cb21daa8444.png width=1280 height=678 class=img_ev3q></p>
<p>As illustrated, the Probe operation can only be executed after the hash table is built, while the Build operation is reliant on the computation results of the Exchange operator. Each of the two instances is divided into two pipeline tasks as such. Then these tasks will be scheduled in the "ready" queue of the thread pool. Following the specified strategies, the threads obtain the tasks to process. In a pipeline task, after one data block is finished, if the relevant data is ready and its runtime stays within the maximum allowed duration, the thread will continue to compute the next data block.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=design--implementation>Design & implementation<a href=#design--implementation class=hash-link aria-label="Design & implementation的直接链接" title="Design & implementation的直接链接">​</a></h3>
<p><strong>Avoid thread blocking</strong></p>
<p>As is mentioned earlier, the Volcano Model is faced with a few bottlenecks:</p>
<ol>
<li>
<p>If too many threads are blocked, the thread pool will be saturated and unable to respond to subsequent queries.</p>
</li>
<li>
<p>Thread scheduling is entirely managed by the operating system, without any user-level control or customization.</p>
</li>
</ol>
<p>How does Pipeline Execution Engine avoid such issues?</p>
<ol>
<li>
<p>We fix the size of the thread pool to match the CPU core count. Then we split all operators that are prone to blocking into pipeline tasks. For example, we use individual threads for disk I/O operations and RPC operations.</p>
</li>
<li>
<p>We design a user-space polling scheduler. It continuously checks the state of all executable pipeline tasks and assigns executable tasks to threads. With this in place, the operating system doesn't have to frequently switch threads, thus less overheads. It also allows customized scheduling strategies, such as assigning priorities to tasks.</p>
</li>
</ol>
<p><img decoding=async loading=lazy alt="Design &amp;amp; implementation" src=/zh-CN/assets/images/pipeline-design-implementation-21c2bccd9d7d386133decbf17c2040fb.png width=1280 height=587 class=img_ev3q></p>
<p><strong>Parallelization</strong></p>
<p>Before version 2.0, Apache Doris requires users to set a concurrency parameter for the execution engine (<code>parallel_fragment_exec_instance_num</code>), which does not dynamically change based on the workloads. Therefore, it is a burden for users to figure out an appropriate concurrency level that leads to optimal performance.</p>
<p>What's the industry's solution to this?</p>
<p>Presto's idea is to shuffle the data into a reasonable number of partitions during execution, which requires minimal concurrency control from users. On the other hand, DuckDB introduces an extra synchronization mechanism instead of shuffling. We decide to follow Presto's track of Presto because the DuckDB solution inevitably involves the use of locks, which works against our purpose of avoiding blocking.</p>
<p>Unlike Presto, Apache Doris doesn't need an extra Local Exchange mechanism to shards the data into an appropriate number of partitions. With its massively parallel processing (MPP) architecture, Doris already does so during shuffling. (In Presto's case, it re-partitions the data via Local Exchange for higher execution concurrency. For example, in hash aggregation, Doris further shards the data based on the aggregation key in order to fully utilize the CPU cores. Also, this can downsize the hash table that each execution thread has to build.)</p>
<p><img decoding=async loading=lazy alt="Design &amp;amp; implementation" src=/zh-CN/assets/images/pipeline-design-implementation-2-a687d57ca081c1170f31ab0145d5caff.png width=1280 height=686 class=img_ev3q></p>
<p>Based on the MPP architecture, we only need two improvements before we achieve what we want in Doris:</p>
<ul>
<li>
<p><strong>Increase the concurrency level during shuffling</strong>. For this, we only need to have the frontend (FE) perceive the backend (BE) environment and then set a reasonable number of partitions.</p>
</li>
<li>
<p><strong>Implement concurrent execution after data reading by the scan layer</strong>. To do this, we need a logical restructuring of the scan layer to decouple the threads from the number of data tablets. This is a pooling process. We pool the data read by scanner threads, so it can be fetched by multiple pipeline tasks directly.</p>
</li>
</ul>
<p><img decoding=async loading=lazy alt="Design &amp;amp; implementation" src=/zh-CN/assets/images/pipleine-design-implementation-3-fbbbb04f5de750bad1fd28694ca3b1d7.jpeg width=1280 height=670 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=pipelinex>PipelineX<a href=#pipelinex class=hash-link aria-label=PipelineX的直接链接 title=PipelineX的直接链接>​</a></h2>
<p>Introduced in Apache Doris 2.0.0, the pipeline execution engine has been improving query performance and stability under hybrid workload scenarios (queries of different sizes and from different tenants). In <a href=https://doris.apache.org/blog/release-note-2.1.0 target=_blank rel="noopener noreferrer">version 2.1.0</a>, we've tackled the known issues and upgraded this from an experimental feature to a robust and reliable solution, which is what we call <a href=https://doris.apache.org/docs/query/pipeline/pipeline-x-execution-engine target=_blank rel="noopener noreferrer">PipelineX</a>.</p>
<p>PipelineX has provided answers to the following issues that used to challenge the Pipeline Execution Engine:</p>
<ul>
<li>
<p><strong>Limited execution concurrency</strong></p>
</li>
<li>
<p><strong>High execution overhead</strong></p>
</li>
<li>
<p><strong>High scheduling overhead</strong></p>
</li>
<li>
<p><strong>Poor readability of operator profile</strong></p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=execution-concurrency>Execution concurrency<a href=#execution-concurrency class=hash-link aria-label="Execution concurrency的直接链接" title="Execution concurrency的直接链接">​</a></h3>
<p>The Pipeline Execution Engine remains under the restriction of the static concurrency parameter at FE and the tablet count at the storage layer, making itself unable to capitalize on the full computing resources. Plus, it is easily affected by data skew.</p>
<p>For example, suppose that Table A contains 100 million rows but it has only 1 tablet, which means it is not sharded enough, let's see what can happen when you perform an aggregation query on it:</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain"> SELECT COUNT(*) FROM A GROUP BY A.COL_1;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>During query execution, the query plan is divided into two <strong>fragments</strong>. Each fragment, consisting of multiple operators, is dispatched by frontend (FE) to backend (BE). The BE starts threads to execute the fragments concurrently.</p>
<p><img decoding=async loading=lazy alt="Pipeline Execution concurrency" src=/zh-CN/assets/images/doris-pipelinex-4e2f29eb887b9b2dc157ab32aea356b4.png width=1280 height=707 class=img_ev3q></p>
<p>Now, let's focus on Fragment 0 for further elaboration. Because there is only one tablet, Fragment 0 can only be executed by one thread. That means aggregation of 100 million rows by one single thread. If you have 16 CPU cores, ideally, the system can allocate 8 threads to execute Fragment 0. In this case, there is a concurrency disparity of 8 to 1. This is how <strong>the number of tablets restricts execution concurrency</strong> and also why we introduce the idea of <strong>Local Shuffle mechanism to remove that restriction</strong> in Apache Doris 2.1.0. So this is how it works in PipelineX:</p>
<ul>
<li>
<p>The threads execute their own pipeline tasks, but the pipeline tasks only maintain their runtime state (known as <strong>Local State</strong>), while the information that shared across all pipeline tasks (known as <strong>Global State</strong>) is managed by one pipeline object.</p>
</li>
<li>
<p>On a single BE, the Local Shuffle mechanism is responsible for data distribution and data balancing across pipeline tasks.</p>
</li>
</ul>
<p><img decoding=async loading=lazy alt="Pipeline Execution concurrency" src=/zh-CN/assets/images/doris-pipelinex-1-6f7365d5417f254f369c691827d034eb.png width=1220 height=1280 class=img_ev3q></p>
<p>Apart from decoupling execution concurrency from tablet count, Local Shuffle can avoid performance loss due to data skew. Again, we will explain with the foregoing example.</p>
<p>This time, we shard Table A into two tablets instead of one, but the data is not evenly distributed. Tablet 1 and Tablet 3 hold 10 million and 90 million rows, respectively. The Pipeline Execution Engine and PipelineX Execution Engine respond differently to such data skew:</p>
<ul>
<li>
<p><strong>Pipeline Execution Engine</strong>: Thread 1 and Thread 2 executes Fragment 1 concurrently. The latter takes 9 times as long as Thread 1 because of the different data sizes they deal with.</p>
</li>
<li>
<p><strong>PipelineX Execution Engine</strong>: With Local Shuffle, data is distributed evenly to the two threads, so they take almost equal time to finish.</p>
</li>
</ul>
<p><img decoding=async loading=lazy alt="Pipeline vs PipelineX execution engine" src=/zh-CN/assets/images/doris-pipelinex-3-4be6cbf01667eb21a88ce0914e3a404a.png width=1280 height=972 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=execution-overhead>Execution overhead<a href=#execution-overhead class=hash-link aria-label="Execution overhead的直接链接" title="Execution overhead的直接链接">​</a></h3>
<p>Under the Pipeline Execution Engine, because the expressions of different instances are individual, each instance is initialized individually. However, since the initialization parameters of instances share a lot in common, we can reuse the shared states to reduce execution overheads. This is what PipelineX does: it initializes the Global State at a time, and the Local State sequentially.</p>
<p><img decoding=async loading=lazy alt="Execution overhead" src=/zh-CN/assets/images/pipeline-execution-overhead-f3d56f790b260c95154e1039faf202d9.png width=1280 height=625 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=scheduling-overhead>Scheduling overhead<a href=#scheduling-overhead class=hash-link aria-label="Scheduling overhead的直接链接" title="Scheduling overhead的直接链接">​</a></h3>
<p>In the Pipeline Execution Engine, the blocked tasks are put into a blocked queue, where a dedicated thread takes polls and moves the executable tasks over to the runnable queue. This dedicated scheduling thread consumes a CPU core, and incurs overheads that can be particularly noticeable on systems with limited computing resources.</p>
<p><strong>As a better solution, PipelineX encapsulates the blocking conditions as dependencies, and the task status (blocked or runnable) will be triggered to change by event notifications.</strong> Specifically, when RPC data arrives, the relevant task will be considered as ready by the ExchangeSourceOperator and then moved to the runnable queue.</p>
<p><img decoding=async loading=lazy alt="Scheduling overhead" src=/zh-CN/assets/images/pipeline-scheduling-overhead-8fc879065b8ec7b550448f12d8cbad7d.png width=1280 height=740 class=img_ev3q></p>
<p>That means <strong>PipelineX implements event-driven scheduling</strong>. A query execution plan can be depicted as a DAG, where the pipeline tasks are abstracted as nodes and the dependencies as edges. Whether a pipeline task gets executed depends on whether all its associated dependencies have satisfied the requisite conditions.</p>
<p><img decoding=async loading=lazy alt="Scheduling overhead" src=/zh-CN/assets/images/pipeline-scheduling-overhead-2-2141c79fe8435bc10d6f4e933e009ef4.jpeg width=1280 height=723 class=img_ev3q></p>
<p>For simplicity of illustration, the above DAG only shows the dependencies between the upstream and downstream pipeline tasks. In fact, all blocking conditions are abstracted as dependencies. The complete execution workflow of a pipeline task is as follows:</p>
<p><img decoding=async loading=lazy alt="Scheduling overhead" src=/zh-CN/assets/images/pipeline-scheduling-overhead-3-7a77f777afc96de866410fd9624ce605.png width=1280 height=629 class=img_ev3q></p>
<p>In event-driven execution, a pipeline task will only be executed after all its dependencies satisfy the conditions; otherwise, it will be added to the blocked queue. When an external event arrives, all blocked tasks will be re-evaluated to see if they're runnable.</p>
<p>The event-driven design of PipelineX eliminates the need for a polling thread and thus the consequential performance loss under high cluster loads. Moreover, the encapsulation of dependencies enables a more flexible scheduling framework, making it easier to spill data to disks.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=operator-profile>Operator profile<a href=#operator-profile class=hash-link aria-label="Operator profile的直接链接" title="Operator profile的直接链接">​</a></h3>
<p>PipelineX has reorganized the metrics in the operator profiles, adding new ones and obsoleting irrelevant ones. Besides, with the dependencies encapsulated, we monitor how long the dependencies take to get ready by the metric <code>WaitForDependency</code>, so the profile can provide a clear picture of the time spent in each step. These are two examples:</p>
<ul>
<li>
<p><strong>Scan Operator</strong>: The total execution time of <code>OLAP_SCAN_OPERATOR</code> is 457.750ms, including that spent in data reading by the scanner (436.883ms) and that in actual execution.</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">OLAP_SCAN_OPERATOR  (id=4.  table  name  =  Z03_DI_MID):</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    -  ExecTime:  457.750ms</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    -  WaitForDependency[OLAP_SCAN_OPERATOR_DEPENDENCY]Time:  436.883ms</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Exchange Source Operator</strong>: The execution time of <code>EXCHANGE_OPERATOR</code> is 86.691us. The time spent waiting for data from upstream is 409.256us.</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">EXCHANGE_OPERATOR  (id=3):</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    -  ExecTime:  86.691us</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    -  WaitForDependencyTime:  0ns</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        -  WaitForData0:  409.256us</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=whats-next>What's next<a href=#whats-next class=hash-link aria-label="What's next的直接链接" title="What's next的直接链接">​</a></h2>
<p>From the Volcano Model to the Pipeline Execution Engine, Apache Doris 2.0.0 has overcome the deadlocks under high cluster load and greatly increased CPU utilization. Now, from the Pipeline Execution Engine to PipelineX, Apache Doris 2.1.0 is more production-friendly as it has ironed out the kinks in concurrency, overheads, and operator profile.</p>
<p>What's next in our roadmap is to support spilling data to disk in PipelineX to further improve query speed and system reliability. We also plan to advance further in terms of automation, such as self-adaptive concurrency and auto execution plan optimization, accompanied by NUMA technologies to harvest better performance from hardware resources.</p>
<p>If you want to talk to the amazing Doris developers who lead these changes, you are more than welcome to join the <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Apache Doris</a> community.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/job-scheduler-for-task-automation/>Another lifesaver for data engineers: Apache Doris Job Scheduler for task automation</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2024-06-06T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2024年6月6日</time></div></header><div class=markdown itemprop=articleBody><p>Job scheduling is an important part of data management as it enables regular data updates and cleanups. In a data platform, it is often undertaken by workflow orchestration tools like <a href=https://airflow.apache.org target=_blank rel="noopener noreferrer">Apache Airflow</a> and <a href=https://dolphinscheduler.apache.org/en-us target=_blank rel="noopener noreferrer">Apache Dolphinscheduler</a>. However, adding another component to the data architecture also means investing extra resources for management and maintenance. That's why <a href=https://doris.apache.org/blog/release-note-2.1.0 target=_blank rel="noopener noreferrer">Apache Doris 2.1.0</a> introduces a built-in Job Scheduler. It is strategically more tailored to Apache Doris, and brings higher scheduling flexibility and architectural simplicity.</p>
<p>The Doris Job Scheduler triggers the pre-defined operations at specific time points or intervals, thus allowing for efficient and reliable task automation. Its key capabilities include:</p>
<ul>
<li>
<p><strong>Efficiency</strong>: It adopts the TimeWheel algorithm to ensure that the triggering of tasks is precise to the second.</p>
</li>
<li>
<p><strong>Flexibility</strong>: It supports both one-time jobs and regular jobs. For the latter, users can define the start/end time, and intervals of minutes, hours, days, or weeks.</p>
</li>
<li>
<p><strong>Execution thread pool and processing queue</strong>: It is supported by a Disruptor-based single-producer, multi-consumer model to avoid task execution overload.</p>
</li>
<li>
<p><strong>Traceability</strong>: It keeps track of the latest task execution records (configurable), which are queryable by a simple command.</p>
</li>
<li>
<p><strong>Availability</strong>: Like Apache Doris itself, the Doris Job Scheduler is easily recoverable and highly available.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=syntax--examples>Syntax & examples<a href=#syntax--examples class=hash-link aria-label="Syntax & examples的直接链接" title="Syntax & examples的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=syntax-description>Syntax description<a href=#syntax-description class=hash-link aria-label="Syntax description的直接链接" title="Syntax description的直接链接">​</a></h3>
<p>A valid job statement consists of the following elements:</p>
<ul>
<li>
<p><code>CREATE JOB</code>: Specifies the job name as a unique identifier.</p>
</li>
<li>
<p>The <code>ON SCHEDULE</code> clause: Specifies the type, trigger time, and frequency of the job.</p>
<ul>
<li>
<p><code>AT timestamp</code>: This is used to specify a one-time job. <code>AT CURRENT_TIMESTAMP</code> means that the job will run immediately upon creation.</p>
</li>
<li>
<p><code>EVERY</code>: This is used to specify a regular job. You can define the execution frequency of the job. The interval can be measured in weeks, days, hours, and minutes.</p>
<ul>
<li>The <code>EVERY</code> clause supports an optional <code>STARTS</code> clause  with a timestamp to define the start time of the recurring schedule. <code>CURRENT_TIMESTAMP</code> can be used. It also supports an optional <code>ENDS</code> clause to specify the end time for the job.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>The <code>DO</code> clause defines the action to be performed when the job is executed. At this time, the only supported operation is INSERT.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    JOB</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    job_name</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE schedule</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'string'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"> execute_sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">schedule: {</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    AT </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">timestamp</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> EVERY </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">STARTS </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">timestamp</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">ENDS </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">timestamp</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain">:</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    quantity { WEEK </span><span class="token operator">|</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DAY</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HOUR</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">MINUTE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            }</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB my_job </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE EVERY </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">MINUTE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> db1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> db2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The above statement creates a job named <code>my_job</code>, which is to load data from <code>db2.tbl2</code> to <code>db1.tbl1</code> every minute.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=more-examples>More examples<a href=#more-examples class=hash-link aria-label="More examples的直接链接" title="More examples的直接链接">​</a></h3>
<p><strong>Create a one-time job</strong>: Load data from <code>db2.tbl2</code> to <code>db1.tbl1</code> at 2025-01-01 00:00:00.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB my_job </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE AT </span><span class="token string" style="color:rgb(255, 121, 198)">'2025-01-01 00:00:00'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> db1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> db2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Create a regular job without specifying the end time</strong>: Load data from <code>db2.tbl2</code> to <code>db1.tbl1</code> once a day starting from 2025-01-01 00:00:00.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB my_job </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE EVERY </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DAY</span><span class="token plain"> STARTS </span><span class="token string" style="color:rgb(255, 121, 198)">'2025-01-01 00:00:00'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> db1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> db2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl2 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain">  create_time </span><span class="token operator">>=</span><span class="token plain">  days_add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Create a regular job within a specified period</strong>: Load data from <code>db2.tbl2</code> to <code>db1.tbl1</code> once a day, beginning at 2025-01-01 00:00:00 and finishing at 2026-01-01 00:10:00.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB my_job </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULER EVERY </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DAY</span><span class="token plain"> STARTS </span><span class="token string" style="color:rgb(255, 121, 198)">'2025-01-01 00:00:00'</span><span class="token plain"> ENDS </span><span class="token string" style="color:rgb(255, 121, 198)">'2026-01-01 00:10:00'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> db1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> db2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tbl2 create_time </span><span class="token operator">>=</span><span class="token plain">  days_add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Asynchronous execution</strong>: Because jobs are executed in an asynchronous manner in Doris. Tasks that require asynchronous execution, such as <code>insert into select</code>, can be implemented by a job.</p>
<p>For example, to asynchronously execute data loading from <code>db2.tbl2</code> to <code>db1.tbl1</code>, simply create a one-time job for it and schedule it at <code>current_timestamp</code>.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE JOB my_job ON SCHEDULE AT current_timestamp DO INSERT INTO db1.tbl1 SELECT * FROM db2.tbl2;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=auto-data-synchronization>Auto data synchronization<a href=#auto-data-synchronization class=hash-link aria-label="Auto data synchronization的直接链接" title="Auto data synchronization的直接链接">​</a></h2>
<p>The combination of the Job Scheduler and the <a href=https://doris.apache.org/docs/lakehouse/lakehouse-overview#multi-catalog target=_blank rel="noopener noreferrer">Multi-Catalog</a> feature of Apache Doris is an efficient way to implement regular data synchronization across data sources.</p>
<p>This is useful in many cases, such as for an e-commerce user who regularly needs to load business data from MySQL to Doris for analysis.</p>
<p><strong>Example</strong>: To filter consumers by total consumption amount, last visit time, sex, and city in the table below, and import the query results to Doris regularly.</p>
<p><img decoding=async loading=lazy alt="Auto data synchronization" src=/zh-CN/assets/images/auto-data-synchronization-e697db722413038ee542074082391276.png width=1280 height=463 class=img_ev3q></p>
<p><strong>Step 1</strong>: Create a table in Doris</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> user_activity</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> LARGEINT </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"User ID"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Time of data import"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"User city"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SMALLINT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"User age"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TINYINT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"User sex"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">last_visit_date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1970-01-01 00:00:00"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Time of user's last visit"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">cost</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> SUM </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"0"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"User's total consumption amount"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">max_dwell_time</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain"> MAX </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"0"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Maximum dwell time of user"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">min_dwell_time</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain"> MIN </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"99999"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Minimum dwell time of user"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">AGGREGATE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">sex</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Step 2</strong>: Create a catalog in Doris to map to the data in MySQL</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE CATALOG activity PROPERTIES (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "type"="jdbc",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "user"="root",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "jdbc_url" = "jdbc:mysql://127.0.0.1:9734/user?useSSL=false",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "driver_url" = "mysql-connector-java-5.1.49.jar",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "driver_class" = "com.mysql.jdbc.Driver"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">);</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Step 3</strong>: Ingest data from MySQL to Doris. Leverage the catalog mechanism and the Insert Into method for full data ingestion. (We recommend that such operations be executed during low-traffic hours to minimize potential service disruptions.)</p>
<ul>
<li>
<p><strong>One-time job</strong>: Schedule a one-time full-scale data loading that starts at 2024-8-10 03:00:00.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB one_time_load_job</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">AT </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-8-10 03:00:00'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> user_activity </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> activity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">activity </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Regular job</strong>: Create a regular job to update data periodically.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> JOB schedule_load</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> SCHEDULE EVERY </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DAY</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DO</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> user_activity </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> activity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">activity </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> create_time </span><span class="token operator">>=</span><span class="token plain">  days_add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=technical-design--implementation>Technical design & implementation<a href=#technical-design--implementation class=hash-link aria-label="Technical design & implementation的直接链接" title="Technical design & implementation的直接链接">​</a></h2>
<p>Efficient scheduling often comes at the cost of significant resource consumption, and high-precision scheduling is even more resource-intensive. To implement job scheduling, some people rely on the built-in scheduling capabilities of Java, while others employ job scheduling libraries. But what if we want higher precision and lower memory usage than these solutions can reach? For that, the Doris makers combine the TimingWheel algorithm with the Disruptor framework to achieve second-level job scheduling.</p>
<p><img decoding=async loading=lazy alt="Technical design &amp;amp; implementation" src=/zh-CN/assets/images/technical-design-and-implementation-86d5f8b242e698232e33c6c1f6e25c1e.png width=1280 height=1000 class=img_ev3q></p>
<p>To implement the TimingWheel algorithm, we leverage the HashedWheelTimer in Netty. The Job Manager puts tasks every 10 minutes (by default) in the TimeWheel for scheduling. In order to ensure efficient task triggering and avoid high resource usage, we adopt a Disruptor-based single-producer, multi-consumer model. The TimeWheel only triggers tasks but does not execute jobs directly. Tasks that need to be triggered upon expiration will be put into a Dispatch thread and distributed to an appropriate execution thread pool. Tasks that need to be executed immediately will be directly submitted to the corresponding execution thread pool.</p>
<p>This is how we improve processing efficiency by reducing unnecessary traversal: For one-time tasks, their definition will be removed after execution. For recurring tasks, the system events in the TimeWheel will periodically fetch the next round of execution tasks. This helps to avoid the accumulation of tasks in a single bucket.</p>
<p>In addition, for transactional tasks, the Job Scheduler can ensure data consistency and integrity by the transaction association and transaction callback mechanisms.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=applicable-scenarios>Applicable scenarios<a href=#applicable-scenarios class=hash-link aria-label="Applicable scenarios的直接链接" title="Applicable scenarios的直接链接">​</a></h2>
<p>The Doris Job Scheduler is a Swiss Army Knife. It is not only useful in ETL and data lake analytics as we mentioned, but also critical for the implementation of <a href=https://doris.apache.org/docs/query/view-materialized-view/async-materialized-view target=_blank rel="noopener noreferrer">asynchronous materialized views</a>. An asynchronous materialized view is a pre-computed result set. Unlike normal materialized views, it can be built on multiple tables. Thus, as you can imagine, changes in any of the source tables will lead to the need for updates in the asynchronous materialized view. That's why we apply the job scheduling mechanism for periodic data refreshing in asynchronous materialized views, which is low-maintenance and also ensures data consistency.</p>
<p>Where are we going with the Doris Job Scheduler? The <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Apache Doris developer community</a> is looking at:</p>
<ul>
<li>
<p>Displaying the distribution of tasks executed in different time slots on the WebUI.</p>
</li>
<li>
<p>DAG jobs. This will allow data warehouse task orchestration within Apache Doris, which will unlock many possibilities when it is combined with the Multi-Catalog feature.</p>
</li>
<li>
<p>Support for more operations such as UPDATE and DELETE.</p>
</li>
</ul></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/multi-tenant-workload-isolation-in-apache-doris/>Multi-tenant workload isolation: a better balance between isolation and utilization</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2024-05-14T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2024年5月14日</time></div></header><div class=markdown itemprop=articleBody><p>This is an in-depth introduction to the workload isolation capabilities of <a href=https://doris.apache.org target=_blank rel="noopener noreferrer">Apache Doris</a>. But first of all, why and when do you need workload isolation? If you relate to any of the following situations, read on and you will end up with a solution:</p>
<ul>
<li>
<p>You have different business departments or tenants sharing the same cluster and you want to prevent the interference of workloads among them.</p>
</li>
<li>
<p>You have query tasks of varying priority levels and you want to give priority to your critical tasks (such as real-time data analytics and online transactions) in terms of resources and execution.</p>
</li>
<li>
<p>You need workload isolation but also want high cost-effectiveness and resource utilization rates.</p>
</li>
</ul>
<p>Apache Doris supports workload isolation based on Resource Tag and Workload Group. Resource Tag isolates the CPU and memory resources for different workloads at the level of backend nodes, while the Workload Group mechanism can further divide the resources within a backend node for higher resource utilization.</p>
<div class="theme-admonition theme-admonition-tip admonition_Gfwi alert alert--success"><div class=admonitionHeading_f1Ed>提示</div><div class=admonitionContent_UjKb><p><a href="https://www.youtube.com/watch?v=Wd3l5C4k8Ok&t=1s" target=_blank rel="noopener noreferrer">Demo</a> of using the Workload Manager in Apache Doris to set a CPU soft/hard limit for Workload Groups.</div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=resource-isolation-based-on-resource-tag>Resource isolation based on Resource Tag<a href=#resource-isolation-based-on-resource-tag class=hash-link aria-label="Resource isolation based on Resource Tag的直接链接" title="Resource isolation based on Resource Tag的直接链接">​</a></h2>
<p>Let's begin with the architecture of Apache Doris. Doris has two <a href=https://doris.apache.org/docs/gettingStarted/what-is-apache-doris target=_blank rel="noopener noreferrer">types of nodes</a>: frontends (FEs) and backends (BEs). FE nodes store metadata, manage clusters, process user requests, and parse query plans, while BE nodes are responsible for computation and data storage. Thus, BE nodes are the major resource consumers.</p>
<p>The main idea of a Resource Tag-based isolation solution is to divide computing resources into groups by assigning tags to BE nodes in a cluster, where BE nodes of the same tag constitute a Resource Group. A Resource Group can be deemed as a unit for data storage and computation. For data ingested into Doris, the system will write data replicas into different Resource Groups according to the configurations. Queries will also be assigned to their corresponding <a href=https://doris.apache.org/docs/admin-manual/resource-admin/multi-tenant#tag-division-and-cpu-limitation-are-new-features-in-version-015-in-order-to-ensure-a-smooth-upgrade-from-the-old-version-doris-has-made-the-following-forward-compatibility target=_blank rel="noopener noreferrer">Resource Groups</a> for execution.</p>
<p>For example, if you want to separate read and write workloads in a 3-BE cluster, you can follow these steps:</p>
<ol>
<li>
<p><strong>Assign Resource Tags to BE nodes</strong>: Bind 2 BEs to the "Read" tag and 1 BE to the "Write" tag.</p>
</li>
<li>
<p><strong>Assign Resource Tags to data replicas</strong>: Assuming that Table 1 has 3 replicas, bind 2 of them to the "Read" tag and 1 to the "Write" tag. Data written into Replica 3 will be synchronized to Replica 1 and Replica 2 and the data synchronization process consumes few resources of BE 1 and BE2.</p>
</li>
<li>
<p><strong>Assign workload groups to Resource Tags</strong>: Queries that include the "Read" tag in their SQLs will be automatically routed to the nodes tagged with "Read" (in this case, BE 1 and BE 2). For data writing tasks, you also need to assign them with the "Write" tag, so they can be routed to the corresponding node (BE 3). In this way, there will be no resource contention between read and write workloads except the data synchronization overheads from replica 3 to replicate 1 and 2.</p>
</li>
</ol>
<p><img decoding=async loading=lazy alt="Resource isolation based on Resource Tag" src=/zh-CN/assets/images/resource-isolation-based-on-resource-tag-af8fea20b39cee40b735034a21e723d6.PNG width=1280 height=719 class=img_ev3q></p>
<p>Resource Tag also enables <strong>multi-tenancy</strong> in Apache Doris. For example, computing and storage resources tagged with "User A" are for User A only, while those tagged with "User B" are exclusive to User B. This is how Doris implements multi-tenant resource isolation with Resource Tags at the BE side.</p>
<p><img decoding=async loading=lazy alt="Resource isolation based on Resource Tag" src=/zh-CN/assets/images/resource-isolation-based-on-resource-tag-2-30b41e82f10cf3f14ee9363bdcea06b1.PNG width=1280 height=609 class=img_ev3q></p>
<p>Dividing the BE nodes into groups ensures <strong>a high level of isolation</strong>:</p>
<ul>
<li>
<p>CPU, memory, and I/O of different tenants are physically isolated.</p>
</li>
<li>
<p>One tenant will never be affected by the failures (such as process crashes) of another tenant.</p>
</li>
</ul>
<p>But it has a few downsides:</p>
<ul>
<li>
<p>In read-write separation, when the data writing stops, the BE nodes tagged with "Write" become idle. This reduces overall cluster utilization.</p>
</li>
<li>
<p>Under multi-tenancy, if you want to further isolate different workloads of the same tenant by assigning separate BE nodes to each of them, you will need to endure significant costs and low resource utilization.</p>
</li>
<li>
<p>The number of tenants is tied to the number of data replicas. So if you have 5 tenants, you will need 5 data replicas. That's huge storage redundancy.</p>
</li>
</ul>
<p><strong>To improve on this,we provide a workload isolation solution based on Workload Group in Apache Doris 2.0.0, and enhanced it in <a href=https://doris.apache.org/blog/release-note-2.1.0 target=_blank rel="noopener noreferrer">Apache Doris 2.1.0</a></strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=workload-isolation-based-on-workload-group>Workload isolation based on Workload Group<a href=#workload-isolation-based-on-workload-group class=hash-link aria-label="Workload isolation based on Workload Group的直接链接" title="Workload isolation based on Workload Group的直接链接">​</a></h2>
<p>The <a href=https://doris.apache.org/docs/admin-manual/resource-admin/workload-group target=_blank rel="noopener noreferrer">Workload Group</a>-based solution realizes a more granular division of resources. It further divides CPU and memory resources within processes on BE nodes, meaning that the queries in one BE node can be isolated from each other to some extent. This avoids resource competition within BE processes and optimizes resource utilization.</p>
<p>Users can relate queries to Workload Groups, and thus limit the percentage of CPU and memory resources that a query can use. Under high cluster loads, Doris can automatically kill the most resource-consuming queries in a Workload Group. Under low cluster loads, Doris can allow multiple Workload Groups to share idle resources.</p>
<p>Doris supports both CPU soft limit and CPU hard limit. The soft limit allows Workload Groups to break the limit and utilize idle resources, enabling more efficient utilization. The hard limit is a hard guarantee of stable performance because it prevents the mutual impact of Workload Groups.</p>
<p><em>(CPU soft limit and CPU hard limit are contradictory to each other. You can choose between them based on your own use case.)</em></p>
<p><img decoding=async loading=lazy alt="Workload isolation based on Workload Group" src=/zh-CN/assets/images/workload-isolation-based-on-workload-group-432d800f87b879c1ed7412a4f31e81ca.png width=1280 height=710 class=img_ev3q></p>
<p>Its differences from the Resource Tag-based solution include:</p>
<ul>
<li>
<p>Workload Groups are formed within processes. Multiple Workload Groups compete for resources within the same BE node.</p>
</li>
<li>
<p>The consideration of data replica distribution is out of the picture because Workload Group is only a way of resource management.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=cpu-soft-limit>CPU soft limit<a href=#cpu-soft-limit class=hash-link aria-label="CPU soft limit的直接链接" title="CPU soft limit的直接链接">​</a></h3>
<p>CPU soft limit is implemented by the <code>cpu_share</code> parameter, which is similar to weights conceptually. Workload Groups with higher <code>cpu_share</code> will be allocated more CPU time during a time slot.</p>
<p>For example, if Group A is configured with a <code>cpu_share</code> of 1, and Group B, 9. In a time slot of 10 seconds, when both Group A and Group B are fully loaded, Group A and Group B will be able to consume 1s and 9s of CPU time, respectively.</p>
<p>What happens in real-world cases is that, not all workloads in the cluster run at full capacity. Under the soft limit, if Group B has low or zero workload, then Group A will be able to use all 10s of CPU time, thus increasing the overall CPU utilization in the cluster.</p>
<p><img decoding=async loading=lazy alt="CPU soft limit" src=/zh-CN/assets/images/CPU-soft-limit-c549d1cefbc8648c861695b19e405b6a.png width=1280 height=732 class=img_ev3q></p>
<p>A soft limit brings flexibility and a higher resource utilization rate. On the flip side, it might cause performance fluctuations.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=cpu-hard-limit>CPU hard limit<a href=#cpu-hard-limit class=hash-link aria-label="CPU hard limit的直接链接" title="CPU hard limit的直接链接">​</a></h3>
<p>CPU hard limit in Apache Doris 2.1.0 is designed for users who require stable performance. In simple terms, the CPU hard limit defines that a Workload Group cannot use more CPU resources than its limit whether there are idle CPU resources or not.</p>
<p>This is how it works:</p>
<p>Suppose that Group A is set with <code>cpu_hard_limit=10%</code> and Group B with <code>cpu_hard_limit=90%</code>. If both Group A and Group B run at full load, Group A and Group B will respectively use 10% and 90% of the overall CPU time. The difference lies in when the workload of Group B decreases. In such cases, regardless of how high the query load of Group A is, it should not use more than the 10% CPU resources allocated to it.</p>
<p><img decoding=async loading=lazy alt="CPU hard limit" src=/zh-CN/assets/images/CPU-hard-limit-cff5be57e984d26b7df9039ce69e5018.png width=1280 height=746 class=img_ev3q></p>
<p>As opposed to soft limit, a hard limit guarantees stable system performance at the cost of flexibility and the possibility of a higher resource utilization rate.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=memory-resource-limit>Memory resource limit<a href=#memory-resource-limit class=hash-link aria-label="Memory resource limit的直接链接" title="Memory resource limit的直接链接">​</a></h3>
<blockquote>
<p>The memory of a BE node comprises the following parts:</p>
<ul>
<li>
<p>Reserved memory for the operating system.</p>
</li>
<li>
<p>Memory consumed by non-queries, which is not considered in the Workload Group's memory statistics.</p>
</li>
<li>
<p>Memory consumed by queries, including data writing. This can be tracked and controlled by Workload Group.</p>
</li>
</ul>
</blockquote>
<p>The <code>memory_limit</code> parameter defines the maximum (%) memory available to a Workload Group within the BE process. It also affects the priority of Resource Groups.</p>
<p>Under initial status, a high-priority Resource Group will be allocated more memory. By setting <code>enable_memory_overcommit</code>, you can allow Resource Groups to occupy more memory than the limits when there is idle space. When memory is tight, Doris will cancel tasks to reclaim the memory resources that they commit.  In this case, the system will retain memory resources for high-priority resource groups as much as possible.</p>
<div><img decoding=async loading=lazy src=/images/memory-resource-limit.png alt="Memory resource limit" class=img_ev3q></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=query-queue>Query queue<a href=#query-queue class=hash-link aria-label="Query queue的直接链接" title="Query queue的直接链接">​</a></h3>
<p>It happens that the cluster is undertaking more loads than it can handle. In this case, submitting new query requests will not only be fruitless but also interruptive to the queries in progress.</p>
<p>To improve on this, Apache Doris provides the <a href=https://doris.apache.org/docs/admin-manual/resource-admin/workload-group#query-queue target=_blank rel="noopener noreferrer">query queue</a> mechanism. Users can put a limit on the number of queries that can run concurrently in the cluster. A query will be rejected when the query queue is full or after a waiting timeout, thus ensuring system stability under high loads.</p>
<p><img decoding=async loading=lazy alt="Query queue" src=/zh-CN/assets/images/query-queue-863a0ad9b10c79e223d84abe16783f3c.png width=1280 height=682 class=img_ev3q></p>
<p>The query queue mechanism involves three parameters: <code>max_concurrency</code>, <code>max_queue_size</code>, and <code>queue_timeout</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=tests>Tests<a href=#tests class=hash-link aria-label=Tests的直接链接 title=Tests的直接链接>​</a></h2>
<p>To demonstrate the effectiveness of the CPU soft limit and hard limit, we did a few tests.</p>
<ul>
<li>
<p>Environment: single machine, 16 cores, 64GB</p>
</li>
<li>
<p>Deployment: 1 FE + 1 BE</p>
</li>
<li>
<p>Dataset: ClickBench, TPC-H</p>
</li>
<li>
<p>Load testing tool: Apache JMeter</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=cpu-soft-limit-test>CPU soft limit test<a href=#cpu-soft-limit-test class=hash-link aria-label="CPU soft limit test的直接链接" title="CPU soft limit test的直接链接">​</a></h3>
<p>Start two clients and continuously submit queries (ClickBench Q23) with and without using Workload Groups, respectively. Note that Page Cache should be disabled to prevent it from affecting the test results.</p>
<p><img decoding=async loading=lazy alt="CPU soft limit test" src=/zh-CN/assets/images/CPU-soft-limit-test-6398c8f7b4a0be54817a4443c05343a6.png width=1280 height=374 class=img_ev3q></p>
<p>Comparing the throughputs of the two clients in both tests, it can be concluded that:</p>
<ul>
<li>
<p><strong>Without configuring Workload Groups</strong>, the two clients consume the CPU resources on an equal basis.</p>
</li>
<li>
<p><strong>Configuring Workload Groups</strong> and setting the <code>cpu_share</code> to 2:1, the throughput ratio of the two clients is 2:1. With a higher <code>cpu_share</code>, Client 1 is provided with a higher portion of CPU resources, and it delivers a higher throughput.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=cpu-hard-limit-test>CPU hard limit test<a href=#cpu-hard-limit-test class=hash-link aria-label="CPU hard limit test的直接链接" title="CPU hard limit test的直接链接">​</a></h3>
<p>Start a client, set <code>cpu_hard_limit=50%</code> for the Workload Group, and execute ClickBench Q23 for 5 minutes under a concurrency level of 1, 2, and 4, respectively.</p>
<p><img decoding=async loading=lazy alt="CPU hard limit test" src=/zh-CN/assets/images/CPU-hard-limit-test-55edf1e86571dd5256567852fecefa08.png width=1280 height=838 class=img_ev3q></p>
<p>As the query concurrency increases, the CPU utilization rate remains at around 800%, meaning that 8 cores are used. On a 16-core machine, that's <strong>50% utilization</strong>, which is as expected. In addition, since CPU hard limits are imposed, the increase in TP99 latency as concurrency rises is also an expected outcome.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=test-in-simulated-production-environment>Test in simulated production environment<a href=#test-in-simulated-production-environment class=hash-link aria-label="Test in simulated production environment的直接链接" title="Test in simulated production environment的直接链接">​</a></h2>
<p>In real-world usage, users are particularly concerned about query latency rather than just query throughput, since latency is more easily perceptible in user experience. That's why we decided to validate the effectiveness of Workload Group in a simulated production environment.</p>
<p>We picked out a SQL set consisting of queries that should be finished within 1s (ClickBench Q15, Q17, Q23 and TPC-H Q3, Q7, Q19), including single-table aggregations and join queries. The size of the TPC-H dataset is 100GB.</p>
<p>Similarly, we conduct tests with and without configuring Workload Groups.</p>
<p><img decoding=async loading=lazy alt="Test in simulated production environment" src=/zh-CN/assets/images/test-in-simulated-production-environment-a97b3764ec737366e55558d2ffb5f89e.png width=1280 height=619 class=img_ev3q></p>
<p>As the results show:</p>
<ul>
<li>
<p><strong>Without Workload Group</strong> (comparing Test 1 & 2): When dialing up the concurrency of Client 2, both clients experience a 2~3-time increase in query latency.</p>
</li>
<li>
<p><strong>Configuring Workload Group</strong> (comparing Test 3 & 4): As the concurrency of Client 2 goes up, the performance fluctuation in Client 1 is much smaller, which is proof of how it is effectively protected by workload isolation.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=recommendations--plans>Recommendations & plans<a href=#recommendations--plans class=hash-link aria-label="Recommendations & plans的直接链接" title="Recommendations & plans的直接链接">​</a></h2>
<p>The Resource Tag-based solution is a thorough workload isolation plan. The Workload Group-based solution realizes a better balance between resource isolation and utilization, and it is complemented by the query queue mechanism for stability guarantee.</p>
<p>So which one to choose for your use case? Here is our recommendation:</p>
<ul>
<li>
<p><strong>Resource Tag</strong>: for use cases where different business lines of departments share the same cluster, so the resources and data are physically isolated for different tenants.</p>
</li>
<li>
<p><strong>Workload Group</strong>: for use cases where one cluster undertakes various query workloads for flexible resource allocation.</p>
</li>
</ul>
<p>In future releases, we will keep improving user experience of the Workload Group and query queue features:</p>
<ul>
<li>
<p>Freeing up memory space by canceling queries is a brutal method. We plan to implement that by disk spilling, which will bring higher stability in query performance.</p>
</li>
<li>
<p>Since memory consumed by non-queries in the BE is not included in Workload Group's memory statistics, users might observe a disparity between the BE process memory usage and Workload Group memory usage. We will address this issue to avoid confusion.</p>
</li>
<li>
<p>In the query queue mechanism,  cluster load is controlled by setting the maximum query concurrency. We plan to enable dynamic maximum query concurrency based on resource availability at the BE. This is to create backpressure on the client side and thus improve the availability of Doris when clients keep submitting high loads.</p>
</li>
<li>
<p>The main idea of Resource Tag is to group the BE nodes, while that of Workload Group is to further divide the resources of a single BE node. For users to grasp these ideas, they need to learn about the concept of BE nodes in Doris first. However, from an operational perspective, users only need to understand the resource consumption percentage of each of their workloads and what priority they should have when cluster load is saturated. Thus, we will try and figure out a way to flatten the learning curve for users, such as keeping the concept of BE nodes in the black box.</p>
</li>
</ul>
<p>For further assistance on workload isolation in Apache Doris, join the <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Apache Doris community</a>.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/from-presto-trino-clickhouse-and-hive-to-apache-doris-sql-convertor-for-easy-migration/>From Presto, Trino, ClickHouse, and Hive to Apache Doris: SQL convertor for easy migration</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2024-05-06T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2024年5月6日</time></div></header><div class=markdown itemprop=articleBody><p><a href=https://doris.apache.org/ target=_blank rel="noopener noreferrer">Apache Doris</a> is an all-in-one data platform that is capable of real-time reporting, ad-hoc queries, data lakehousing, log management and analysis, and batch data processing. As more and more companies have been replacing their component-heavy data architecture with Apache Doris, there is an increasing need for a more convenient data migration solution. <strong>That's why the Doris SQL Convertor is made.</strong></p>
<p>Most database systems run their own SQL dialects. Thus, migration between systems often entails modifications of SQL syntaxes. Since SQLs work closely with a company's business logic, in many cases, users have to modify their business logic, too. To reduce the transition pain for users, Apache Doris 2.1 provides the Doris SQL Convertor. It supports the SQL syntaxes of Presto, Trino, Hive, ClickHouse, and PostgreSQL. With it, users can execute queries with their old SQL syntaxes directly in Doris or batch convert their existing SQL statements on the visual interface.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=doris-sql-convertor>Doris SQL Convertor<a href=#doris-sql-convertor class=hash-link aria-label="Doris SQL Convertor的直接链接" title="Doris SQL Convertor的直接链接">​</a></h2>
<p>The Doris SQL Convertor requires <strong>zero rewriting</strong> of SQL. Simply <code>set sql_dialect = "trino"</code> in the session variable, then you can execute queries in Doris using Trino SQLs.</p>
<p>The SQL compatibility of it has been proven by extensive tests. For example, a user tested the Doris SQL Convertor with over 30,000 SQL queries from their production environment. Turned out that the Convertor successfully converted 99.6% of the Trino SQLs and 98% of the ClickHouse SQLs.</p>
<p>Currently, Presto, Trino, Hive, ClickHouse, and PostgreSQL dialects are supported. We are working to add Teradata, SQL Server, and Snowflake to the list, and consistently increase the compatibility level of each SQL dialect.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=installation--usage>Installation & usage<a href=#installation--usage class=hash-link aria-label="Installation & usage的直接链接" title="Installation & usage的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=sql-conversion-service>SQL conversion service<a href=#sql-conversion-service class=hash-link aria-label="SQL conversion service的直接链接" title="SQL conversion service的直接链接">​</a></h3>
<ol>
<li>
<p><strong>Download</strong> <strong><a href=https://selectdb-doris-1308700295.cos.ap-beijing.myqcloud.com/doris-sql-convertor/doris-sql-convertor-1.0.3-bin-x86.tar.gz target=_blank rel="noopener noreferrer">Doris SQL Convertor</a></strong></p>
</li>
<li>
<p>On any frontend (FE) node, start the service using the following command.</p>
</li>
</ol>
<ul>
<li>
<p>The SQL conversion service is stateless and can be started or stopped at any time.</p>
</li>
<li>
<p><code>port=5001</code> in the command specifies the service port. (You can use any available port.)</p>
</li>
<li>
<p>It is advisable to start a service individually for each FE node.</p>
</li>
</ul>
<div class="language-Shell language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">nohup ./doris-sql-convertor-1.0.1-bin-x86 run --host=0.0.0.0 --port=5001 &</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=3>
<li>
<p>Start a Doris cluster <strong>(Use Doris 2.1.0 or newer)</strong>.</p>
</li>
<li>
<p>Set the URL for SQL conversion service in Doris. <code>127.0.0.1:5001</code> in the command represents the IP and port number of the node where the service is deployed.</p>
</li>
</ol>
<div class="language-Shell language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">MySQL> set global sql_converter_service_url = "http://127.0.0.1:5001/api/v1/convert"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>After deployment, you can execute SQL directly in the command line. You can start the service by <code>set sql_dialect = XXX</code>. The following examples are based on ClickHouse SQL dialects.</p>
<ul>
<li>Presto</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> sql_dialect</span><span class="token operator">=</span><span class="token plain">presto</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                                                                                                                                                                                                             </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start_time </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                     </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            array_distinct</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr_int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                             </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            FILTER</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr_str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> x </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> x </span><span class="token operator">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'%World%'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                              </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            to_date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">'%Y-%m-%d'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                           </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                                    </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            date_add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'month'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                    </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            REGEXP_EXTRACT_ALL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'-.'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                     </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            JSON_EXTRACT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'{"id": "33"}'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'$.id'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                 </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            element_at</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr_int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col9</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                                                                              </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            date_trunc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'day'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col10                                                                                                                                                                                        </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> test_sqlconvert                                                                                                                                                                                                            </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> date_trunc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'day'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token string" style="color:rgb(255, 121, 198)">'2024-05-20'</span><span class="token plain">                                                                                                                                                                            </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                                                                                                                                                                                                                        </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                                                                                </span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> col1                </span><span class="token operator">|</span><span class="token plain"> col2      </span><span class="token operator">|</span><span class="token plain"> col3      </span><span class="token operator">|</span><span class="token plain"> col4       </span><span class="token operator">|</span><span class="token plain"> col5 </span><span class="token operator">|</span><span class="token plain"> col6                </span><span class="token operator">|</span><span class="token plain"> col7        </span><span class="token operator">|</span><span class="token plain"> col8 </span><span class="token operator">|</span><span class="token plain"> col9 </span><span class="token operator">|</span><span class="token plain"> col10               </span><span class="token operator">|</span><span class="token plain">                                                                                                </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                                                                                </span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">13</span><span class="token plain">:</span><span class="token number">14</span><span class="token plain">:</span><span class="token number">52</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"World"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">14</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">13</span><span class="token plain">:</span><span class="token number">14</span><span class="token plain">:</span><span class="token number">52</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'-0'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">'-1'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"33"</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">00</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                                                                                                </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                                                                                </span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.03</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">    </span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ul>
<li>ClickHouse</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> sql_dialect</span><span class="token operator">=</span><span class="token plain">clickhouse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                                                                                                                                             </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                                                                                                                                           </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                                                                                                                                                                               </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain">  toString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                   </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             arrayCompact</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr_int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                  </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             arrayFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">x </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> x </span><span class="token operator">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'%World%'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">arr_str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                              </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             toDate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                          </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             toYear</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                      </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             addMonths</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             extractAll</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'-.'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                                 </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             JSONExtractString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'{"id": "33"}'</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'id'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             arrayElement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr_int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col9</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                                                                                                                               </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             date_trunc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'day'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> col10                                                                                                                           </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> test_sqlconvert                                                                                                                                               </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> date_trunc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'day'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-05-20 00:00:00'</span><span class="token plain">                                                                                                          </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                                                                                                                                                   </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                    </span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> col1                </span><span class="token operator">|</span><span class="token plain"> col2      </span><span class="token operator">|</span><span class="token plain"> col3      </span><span class="token operator">|</span><span class="token plain"> col4       </span><span class="token operator">|</span><span class="token plain"> col5 </span><span class="token operator">|</span><span class="token plain"> col6                </span><span class="token operator">|</span><span class="token plain"> col7        </span><span class="token operator">|</span><span class="token plain"> col8 </span><span class="token operator">|</span><span class="token plain"> col9 </span><span class="token operator">|</span><span class="token plain"> col10               </span><span class="token operator">|</span><span class="token plain">                                    </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                    </span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">13</span><span class="token plain">:</span><span class="token number">14</span><span class="token plain">:</span><span class="token number">52</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"World"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">14</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">13</span><span class="token plain">:</span><span class="token number">14</span><span class="token plain">:</span><span class="token number">52</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'-0'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">'-1'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"33"</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span><span class="token plain"> </span><span class="token number">00</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">                                    </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+                                    </span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.02</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=visual-interface>Visual interface<a href=#visual-interface class=hash-link aria-label="Visual interface的直接链接" title="Visual interface的直接链接">​</a></h3>
<p>For large-scale conversion, it is recommended to use the visual interface, on which you can batch upload the files for dialect conversion.</p>
<p>Follow these steps to deploy the visual conversion interface:</p>
<ol>
<li>
<p>Environment: Docker, Docker-Compose</p>
</li>
<li>
<p>Get Doris-SQL-Convertor Docker image</p>
</li>
<li>
<p>Create a network for the image</p>
</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">docker network create app_network</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=4>
<li>Decompress the package</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">tar xzvf doris-sql-convertor-1.0.1.tar.gz</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cd doris-sql-convertor</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=5>
<li>Edit the environment variables</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">FLASK_APP=server/app.py</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">FLASK_DEBUG=1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">API_HOST=http://doris-sql-convertor-api:5000</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># DOCKER TAG</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">API_TAG=latest</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">WEB_TAG=latest</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=6>
<li>Start it up</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">sh start.sh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>After deployment, you can access the service by <code>ip:8080</code> via your local browser. <code>8080</code> is the default port. You can change the mapping port. On the visual interface, you can select the source dialect type and target dialect type, and then click "Convert".</p>
<div class="theme-admonition theme-admonition-info admonition_Gfwi alert alert--info"><div class=admonitionHeading_f1Ed>Note</div><div class=admonitionContent_UjKb><ol>
<li>
<p>For batch conversion, each SQL statement should end with <code>; </code>.</p>
</li>
<li>
<p>The Doris SQL Convertor supports 239 UNION ALL conversions at most.</p>
</li>
</ol></div></div>
<p>Join the <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Apache Doris community</a> to seek guidance from the Doris makers or provide your feedback!</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/arrow-flight-sql-in-apache-doris-for-10x-faster-data-transfer/>Arrow Flight SQL for 10X faster data transfer</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2024-04-16T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2024年4月16日</time></div></header><div class=markdown itemprop=articleBody><p>For years, JDBC and ODBC have been commonly adopted norms for database interaction. Now, as we gaze upon the vast expanse of the data realm, the rise of data science and data lake analytics brings bigger and bigger datasets. Correspondingly, we need faster and faster data reading and transmission, so we start to look for better answers than JDBC and ODBC. Thus, we include <strong>Arrow Flight SQL protocol</strong> into <a href=https://doris.apache.org target=_blank rel="noopener noreferrer">Apache Doris 2.1</a>, which provides <strong>tens-fold speedups for data transfer</strong>.</p>
<div class="theme-admonition theme-admonition-tip admonition_Gfwi alert alert--success"><div class=admonitionHeading_f1Ed>Tip</div><div class=admonitionContent_UjKb><p>A <a href="https://www.youtube.com/watch?v=zIqy24gI8DE" target=_blank rel="noopener noreferrer">demo</a> of loading data from Apache Doris to Python using Arrow Flight SQL.</div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=high-speed-data-transfer-based-on-arrow-flight-sql>High-speed data transfer based on Arrow Flight SQL<a href=#high-speed-data-transfer-based-on-arrow-flight-sql class=hash-link aria-label="High-speed data transfer based on Arrow Flight SQL的直接链接" title="High-speed data transfer based on Arrow Flight SQL的直接链接">​</a></h2>
<p>As a column-oriented data warehouse, Apache Doris arranges its query results in the form of data Blocks in a columnar format. Before version 2.1, the Blocks must be serialized into bytes in row-oriented formats before they can be transferred to a target client via a MySQL client or JDBC/ODBC driver. Moreover, if the target client is a columnar database or a column-oriented data science component like Pandas, the data should then be de-serialized. The serialization-deserialization process is a speed bump for data transmission.</p>
<p>Apache Doris 2.1 has a data transmission channel built on <a href=https://arrow.apache.org/docs/format/FlightSql.html target=_blank rel="noopener noreferrer">Arrow Flight SQL</a>. (<a href=https://arrow.apache.org/ target=_blank rel="noopener noreferrer">Apache Arrow</a> is a software development platform designed for high data movement efficiency across systems and languages, and the Arrow format aims for high-performance, lossless data exchange.) It allows <strong>high-speed, large-scale data reading from Doris via SQL in various mainstream programming languages</strong>. For target clients that also support the Arrow format, the whole process will be free of serialization/deserialization, thus no performance loss. Another upside is, Arrow Flight can make full use of multi-node and multi-core architecture and implement parallel data transfer, which is another enabler of high data throughput.</p>
<p>For example, if a Python client reads data from Apache Doris, Doris will first convert the column-oriented Blocks to Arrow RecordBatch. Then in the Python client, Arrow RecordBatch will be converted to Pandas DataFrame. Both conversions are fast because the Doris Blocks, Arrow RecordBatch, and Pandas DataFrame are all column-oriented.</p>
<p><img decoding=async loading=lazy alt=img src=/zh-CN/assets/images/high-speed-data-transfer-based-on-doris-arrow-flight-sql-c51538bca23f1062d141adab8fe055cb.png width=1280 height=647 class=img_ev3q></p>
<p>In addition, Arrow Flight SQL provides a general JDBC driver to facilitate seamless communication between databases that supports the Arrow Flight SQL protocol. This unlocks the the potential of Doris to be connected to a wider ecosystem and to be used in more cases.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=performance-test>Performance test<a href=#performance-test class=hash-link aria-label="Performance test的直接链接" title="Performance test的直接链接">​</a></h2>
<p>The "tens-fold speedups" conclusion is based on our benchmark tests. We tried reading data from Doris using PyMySQL, Pandas, and Arrow Flight SQL, and jotted down the durations, respectively. The test data is the ClickBench dataset.</p>
<p><img decoding=async loading=lazy alt="Performance test" src=/zh-CN/assets/images/doris-performance-test-a0ccb1f783b2f85210c63d8aa961f649.png width=1980 height=1062 class=img_ev3q></p>
<p>Results on various data types are as follows:</p>
<p><img decoding=async loading=lazy alt="Performance test results" src=/zh-CN/assets/images/doris-performance-test-2-8c60cb82710df9d37e6707593830da6c.png width=1280 height=481 class=img_ev3q></p>
<p><strong>As shown, Arrow Flight SQL outperforms PyMySQL and Pandas in all data types by a factor ranging from 20 to several hundreds</strong>.</p>
<p><img decoding=async loading=lazy alt="Arrow Flight SQL outperforms PyMySQL and Pandas" src=/zh-CN/assets/images/doris-performance-test-3-b48f9e4bdec4a27877fcddbb33e6375a.png width=1280 height=502 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=usage>Usage<a href=#usage class=hash-link aria-label=Usage的直接链接 title=Usage的直接链接>​</a></h2>
<p>With support for Arrow Flight SQL, Apache Doris can leverage the Python ADBC Driver for fast data reading. I will showcase a few frequently executed database operations using the Python ADBC Driver (version 3.9 or later), including DDL, DML, session variable setting, and <code>show</code> statements.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=01--install-library>01  Install library<a href=#01--install-library class=hash-link aria-label="01  Install library的直接链接" title="01  Install library的直接链接">​</a></h3>
<p>The relevant library is already published on PyPI. It can be installed simply as follows:</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">pip install adbc_driver_manager</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">pip install adbc_driver_flightsql</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Import the following module/library to interact with the installed library:</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> adbc_driver_manager</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> adbc_driver_flightsql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dbapi </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> flight_sql</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">>></span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">adbc_driver_manager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">__version__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1.1</span><span class="token number">.0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">>></span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">adbc_driver_flightsql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">__version__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1.1</span><span class="token number">.0</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=02--connect-to-doris>02  Connect to Doris<a href=#02--connect-to-doris class=hash-link aria-label="02  Connect to Doris的直接链接" title="02  Connect to Doris的直接链接">​</a></h3>
<p>Create a client for interacting with the Doris Arrow Flight SQL service. Prerequisites include: Doris frontend (FE) host, Arrow Flight port, and login username/password.</p>
<p>Configure parameters for Doris frontend (FE) and backend (BE):</p>
<ul>
<li>
<p>In <code>fe/conf/fe.conf</code>, set <code>arrow_flight_sql_port </code> to an available port, such as 8070.</p>
</li>
<li>
<p>In <code>be/conf/be.conf</code>, set <code>arrow_flight_sql_port </code> to an available port, such as 8050.</p>
</li>
</ul>
<p><code>Note: The arrow_flight_sql_port port number configured in fe.conf and be.conf is different</code></p>
<p>After modifying the configuration and restarting the cluster, searching for <code>Arrow Flight SQL service is started</code> in the fe/log/fe.log file indicates that the Arrow Flight Server of FE has been successfully started; searching for <code>Arrow Flight Service bind to host</code> in the be/log/be.INFO file indicates that the Arrow Flight Server of BE has been successfully started.</p>
<p>Suppose that the Arrow Flight SQL services for the Doris instance will run on ports 8070 and 8050 for FE and BE respectively, and the Doris username/password is "user" and "pass", the connection process would be:</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">conn = flight_sql.connect(uri="grpc://{FE_HOST}:{fe.conf:arrow_flight_sql_port}", db_kwargs={</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            adbc_driver_manager.DatabaseOptions.USERNAME.value: "user",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            adbc_driver_manager.DatabaseOptions.PASSWORD.value: "pass",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        })</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cursor = conn.cursor()</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Once the connection is established, you can interact with Doris using SQL statements through the returned cursor object. This allows you to perform various operations such as table creation, metadata retrieval, data import, and query execution.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=03--create-table-and-retrieve-metadata>03  Create table and retrieve metadata<a href=#03--create-table-and-retrieve-metadata class=hash-link aria-label="03  Create table and retrieve metadata的直接链接" title="03  Create table and retrieve metadata的直接链接">​</a></h3>
<p>Pass the query to the <code>cursor.execute()</code> function, which creates tables and retrieves metadata.</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">cursor.execute("DROP DATABASE IF EXISTS arrow_flight_sql FORCE;")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cursor.execute("create database arrow_flight_sql;")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cursor.execute("show databases;")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cursor.execute("use arrow_flight_sql;")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cursor.execute("""CREATE TABLE arrow_flight_sql_test</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         k0 INT,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         k1 DOUBLE,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         K2 varchar(32) NULL DEFAULT "" COMMENT "",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         k3 DECIMAL(27,9) DEFAULT "0",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         k4 BIGINT NULL DEFAULT '10',</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         k5 DATE,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    )</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    DISTRIBUTED BY HASH(k5) BUCKETS 5</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    PROPERTIES("replication_num" = "1");""")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cursor.execute("show create table arrow_flight_sql_test;")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If the returned <code>StatusResult</code> is 0, that means the query is executed successfully. (Such design is to ensure compatibility with JDBC.)</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">  StatusResult</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0            0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  StatusResult</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0            0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                   Database</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0         __internal_schema</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">1          arrow_flight_sql</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">..                      ...</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">507             udf_auth_db</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">[508 rows x 1 columns]</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  StatusResult</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0            0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  StatusResult</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0            0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                   Table                                       Create Table</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0  arrow_flight_sql_test  CREATE TABLE `arrow_flight_sql_test` (\n  `k0`...</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=04--ingest-data>04  Ingest data<a href=#04--ingest-data class=hash-link aria-label="04  Ingest data的直接链接" title="04  Ingest data的直接链接">​</a></h3>
<p>Execute an INSERT INTO statement to load test data into the table created:</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">cursor.execute("""INSERT INTO arrow_flight_sql_test VALUES</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        ('0', 0.1, "ID", 0.0001, 9999999999, '2023-10-21'),</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        ('1', 0.20, "ID_1", 1.00000001, 0, '2023-10-21'),</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        ('2', 3.4, "ID_1", 3.1, 123456, '2023-10-22'),</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        ('3', 4, "ID", 4, 4, '2023-10-22'),</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        ('4', 122345.54321, "ID", 122345.54321, 5, '2023-10-22');""")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If you see the following returned result, the data ingestion is successful.</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">  StatusResult</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0            0</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If the data size to ingest is huge, you can apply the Stream Load method using <a href=https://pypi.org/project/pydoris/ target=_blank rel="noopener noreferrer">pydoris</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=05--execute-queries>05  Execute queries<a href=#05--execute-queries class=hash-link aria-label="05  Execute queries的直接链接" title="05  Execute queries的直接链接">​</a></h3>
<p>Perform queries on the above table, such as aggregation, sorting, and session variable setting.</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">cursor.execute("select * from arrow_flight_sql_test order by k0;")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cursor.execute("set exec_mem_limit=2000;")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cursor.execute("show variables like \"%exec_mem_limit%\";")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cursor.execute("select k5, sum(k1), count(1), avg(k3) from arrow_flight_sql_test group by k5;")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">print(cursor.fetchallarrow().to_pandas())</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The results are as follows:</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">   k0            k1    K2                k3          k4          k5</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0   0       0.10000    ID       0.000100000  9999999999  2023-10-21</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">1   1       0.20000  ID_1       1.000000010           0  2023-10-21</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">2   2       3.40000  ID_1       3.100000000      123456  2023-10-22</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">3   3       4.00000    ID       4.000000000           4  2023-10-22</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">4   4  122345.54321    ID  122345.543210000           5  2023-10-22</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">[5 rows x 6 columns]</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  StatusResult</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0            0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    Variable_name Value Default_Value Changed</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0  exec_mem_limit  2000    2147483648       1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           k5  Nullable(Float64)_1  Int64_2 Nullable(Decimal(38, 9))_3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0  2023-10-22         122352.94321        3            40784.214403333</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">1  2023-10-21              0.30000        2                0.500050005</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">[2 rows x 5 columns]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=06--complete-code>06  Complete code<a href=#06--complete-code class=hash-link aria-label="06  Complete code的直接链接" title="06  Complete code的直接链接">​</a></h3>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)"># Doris Arrow Flight SQL Test</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># step 1, library is released on PyPI and can be easily installed.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># pip install adbc_driver_manager</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># pip install adbc_driver_flightsql</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> adbc_driver_manager</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> adbc_driver_flightsql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dbapi </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> flight_sql</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># step 2, create a client that interacts with the Doris Arrow Flight SQL service.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Modify arrow_flight_sql_port in fe/conf/fe.conf to an available port, such as 8070.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Modify arrow_flight_sql_port in be/conf/be.conf to an available port, such as 8050.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">conn </span><span class="token operator">=</span><span class="token plain"> flight_sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">uri</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"grpc://{FE_HOST}:{fe.conf:arrow_flight_sql_port}"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> db_kwargs</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            adbc_driver_manager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DatabaseOptions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">USERNAME</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"root"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            adbc_driver_manager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DatabaseOptions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">PASSWORD</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cursor </span><span class="token operator">=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># interacting with Doris via SQL using Cursor</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"\n### execute query: ###\n "</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"### result: ###"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">fetchallarrow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">to_pandas</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># step3, execute DDL statements, create database/table, show stmt.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"DROP DATABASE IF EXISTS arrow_flight_sql FORCE;"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"show databases;"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"create database arrow_flight_sql;"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"show databases;"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"use arrow_flight_sql;"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""CREATE TABLE arrow_flight_sql_test</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">         k0 INT,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">         k1 DOUBLE,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">         K2 varchar(32) NULL DEFAULT "" COMMENT "",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">         k3 DECIMAL(27,9) DEFAULT "0",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">         k4 BIGINT NULL DEFAULT '10',</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">         k5 DATE,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    )</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    DISTRIBUTED BY HASH(k5) BUCKETS 5</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    PROPERTIES("replication_num" = "1");"""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"show create table arrow_flight_sql_test;"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># step4, insert into</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""INSERT INTO arrow_flight_sql_test VALUES</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">        ('0', 0.1, "ID", 0.0001, 9999999999, '2023-10-21'),</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">        ('1', 0.20, "ID_1", 1.00000001, 0, '2023-10-21'),</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">        ('2', 3.4, "ID_1", 3.1, 123456, '2023-10-22'),</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">        ('3', 4, "ID", 4, 4, '2023-10-22'),</span><br></span><span class=token-line style=color:#F8F8F2><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">        ('4', 122345.54321, "ID", 122345.54321, 5, '2023-10-22');"""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># step5, execute queries, aggregation, sort, set session variable</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"select * from arrow_flight_sql_test order by k0;"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"set exec_mem_limit=2000;"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"show variables like \"%exec_mem_limit%\";"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"select k5, sum(k1), count(1), avg(k3) from arrow_flight_sql_test group by k5;"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># step6, close cursor </span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=examples-of-data-transmission-at-scale>Examples of data transmission at scale<a href=#examples-of-data-transmission-at-scale class=hash-link aria-label="Examples of data transmission at scale的直接链接" title="Examples of data transmission at scale的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=01--python>01  Python<a href=#01--python class=hash-link aria-label="01  Python的直接链接" title="01  Python的直接链接">​</a></h3>
<p>In Python, after connecting to Doris using the ADBC Driver, you can use various ADBC APIs to load the Clickbench dataset from Doris into Python. Here's how:</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">#!/usr/bin/env python</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># -*- coding: utf-8 -*-</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> adbc_driver_manager</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> adbc_driver_flightsql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dbapi </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> flight_sql</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> pandas</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> datetime</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">my_uri </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"grpc://0.0.0.0:`fe.conf_arrow_flight_sql_port`"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">my_db_kwargs </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    adbc_driver_manager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DatabaseOptions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">USERNAME</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"root"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    adbc_driver_manager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DatabaseOptions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">PASSWORD</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">sql </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"select * from clickbench.hits limit 1000000;"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># PEP 249 (DB-API 2.0) API wrapper for the ADBC Driver Manager.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">dbapi_adbc_execute_fetchallarrow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    conn </span><span class="token operator">=</span><span class="token plain"> flight_sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">uri</span><span class="token operator">=</span><span class="token plain">my_uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> db_kwargs</span><span class="token operator">=</span><span class="token plain">my_db_kwargs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cursor </span><span class="token operator">=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    start_time </span><span class="token operator">=</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    arrow_data </span><span class="token operator">=</span><span class="token plain"> cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">fetchallarrow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    dataframe </span><span class="token operator">=</span><span class="token plain"> arrow_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">to_pandas</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"\n##################\n dbapi_adbc_execute_fetchallarrow"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">", cost:"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">", bytes:"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arrow_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">nbytes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">", len(arrow_data):"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arrow_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dataframe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">memory_usage</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">'deep'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dataframe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ADBC reads data into pandas dataframe, which is faster than fetchallarrow first and then to_pandas.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">dbapi_adbc_execute_fetch_df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    conn </span><span class="token operator">=</span><span class="token plain"> flight_sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">uri</span><span class="token operator">=</span><span class="token plain">my_uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> db_kwargs</span><span class="token operator">=</span><span class="token plain">my_db_kwargs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cursor </span><span class="token operator">=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    start_time </span><span class="token operator">=</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    dataframe </span><span class="token operator">=</span><span class="token plain"> cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">fetch_df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">    </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"\n##################\n dbapi_adbc_execute_fetch_df"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">", cost:"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dataframe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">memory_usage</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">'deep'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dataframe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Can read multiple partitions in parallel.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">dbapi_adbc_execute_partitions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    conn </span><span class="token operator">=</span><span class="token plain"> flight_sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">uri</span><span class="token operator">=</span><span class="token plain">my_uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> db_kwargs</span><span class="token operator">=</span><span class="token plain">my_db_kwargs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cursor </span><span class="token operator">=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    start_time </span><span class="token operator">=</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    partitions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> schema </span><span class="token operator">=</span><span class="token plain"> cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">adbc_execute_partitions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">adbc_read_partition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">partitions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    arrow_data </span><span class="token operator">=</span><span class="token plain"> cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">fetchallarrow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    dataframe </span><span class="token operator">=</span><span class="token plain"> arrow_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">to_pandas</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"\n##################\n dbapi_adbc_execute_partitions"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">", cost:"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> start_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">", len(partitions):"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">partitions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dataframe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">memory_usage</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">'deep'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dataframe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">dbapi_adbc_execute_fetchallarrow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">dbapi_adbc_execute_fetch_df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">dbapi_adbc_execute_partitions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Results are as follows (omitting the repeated outputs). <strong>It only takes 3s</strong> to load a Clickbench dataset containing 1 million rows and 105 columns.</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">##################</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"> dbapi_adbc_execute_fetchallarrow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">03.548080</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">bytes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">784372793</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arrow_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">1000000</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'pandas.core.frame.DataFrame'</span><span class="token operator">></span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">RangeIndex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1000000</span><span class="token plain"> entries</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> to </span><span class="token number">999999</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Columns</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">105</span><span class="token plain"> entries</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> CounterID to CLID</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">dtypes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> int16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">48</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> int32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">19</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> int64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">memory usage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">2.4</span><span class="token plain"> GB</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token boolean">None</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        CounterID   EventDate               UserID            EventTime              WatchID  JavaEnable                                              Title  GoodEvent  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">  UTMCampaign  UTMContent  UTMTerm  FromTag  HasGCLID          RefererHash              URLHash  CLID</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">0</span><span class="token plain">          </span><span class="token number">245620</span><span class="token plain">  </span><span class="token number">2013</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">09</span><span class="token plain">  </span><span class="token number">2178958239546411410</span><span class="token plain">  </span><span class="token number">2013</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">09</span><span class="token plain"> </span><span class="token number">19</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">27</span><span class="token plain">  </span><span class="token number">8302242799508478680</span><span class="token plain">           </span><span class="token number">1</span><span class="token plain">  OWAProfessionov — Мой Круг </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">СВАО Интернет</span><span class="token operator">-</span><span class="token plain">магазин          </span><span class="token number">1</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">                                                    </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">7861356476484644683</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">2933046165847566158</span><span class="token plain">     </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">999999</span><span class="token plain">       </span><span class="token number">1095</span><span class="token plain">  </span><span class="token number">2013</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">03</span><span class="token plain">  </span><span class="token number">4224919145474070397</span><span class="token plain">  </span><span class="token number">2013</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">03</span><span class="token plain"> </span><span class="token number">14</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">36</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">17</span><span class="token plain">  </span><span class="token number">6301487284302774604</span><span class="token plain">           </span><span class="token number">0</span><span class="token plain">  @дневники Sinatra </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ЛАДА</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> цена для деталли кто </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">          </span><span class="token number">1</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">                                                    </span><span class="token number">0</span><span class="token plain">  </span><span class="token operator">-</span><span class="token number">296158784638538920</span><span class="token plain">  </span><span class="token number">1335027772388499430</span><span class="token plain">     </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1000000</span><span class="token plain"> rows x </span><span class="token number">105</span><span class="token plain"> columns</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">##################</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"> dbapi_adbc_execute_fetch_df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">03.611664</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">##################</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"> dbapi_adbc_execute_partitions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">03.483436</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">partitions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">##################</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"> low_level_api_execute_query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">03.523598</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> stream</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">139992182177600</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> rows</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">bytes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">784322926</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arrow_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">1000000</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">##################</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"> low_level_api_execute_partitions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">03</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">738128streams</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=02--jdbc>02  JDBC<a href=#02--jdbc class=hash-link aria-label="02  JDBC的直接链接" title="02  JDBC的直接链接">​</a></h3>
<p>The open-source JDBC driver for the Arrow Flight SQL protocol provides compatibility with the standard JDBC API. It allows most BI tools to access Doris via JDBC and supports high-speed transfer of Apache Arrow data.</p>
<p>Usage of this driver is similar to using that for the MySQL protocol. You just need to replace <code>jdbc:mysql</code> in the connection URL with <code>jdbc:arrow-flight-sql</code>. The returned result will be in the JDBC ResultSet data structure.</p>
<div class="language-Java language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token import namespace">java</span><span class="token import namespace punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token import namespace">sql</span><span class="token import namespace punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token import class-name">Connection</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token import namespace">java</span><span class="token import namespace punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token import namespace">sql</span><span class="token import namespace punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token import class-name">DriverManager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token import namespace">java</span><span class="token import namespace punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token import namespace">sql</span><span class="token import namespace punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token import class-name">ResultSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token import namespace">java</span><span class="token import namespace punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token import namespace">sql</span><span class="token import namespace punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token import class-name">Statement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">Class</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">forName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"org.apache.arrow.driver.jdbc.ArrowFlightJdbcDriver"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">String</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">DB_URL</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"jdbc:arrow-flight-sql://{FE_HOST}:{fe.conf:arrow_flight_sql_port}?useServerPrepStmts=false"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"&cachePrepStmts=true&useSSL=false&useEncryption=false"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">String</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">USER</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"root"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">String</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">PASS</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">Connection</span><span class="token plain"> conn </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">DriverManager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getConnection</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token constant" style="color:rgb(189, 147, 249)">DB_URL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">USER</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">PASS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">Statement</span><span class="token plain"> stmt </span><span class="token operator">=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">createStatement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">ResultSet</span><span class="token plain"> resultSet </span><span class="token operator">=</span><span class="token plain"> stmt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">executeQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"show tables;"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">resultSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">next</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> col1 </span><span class="token operator">=</span><span class="token plain"> resultSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token class-name">System</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">println</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">col1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">resultSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">close</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">stmt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">close</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">conn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">close</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=03--java>03  JAVA<a href=#03--java class=hash-link aria-label="03  JAVA的直接链接" title="03  JAVA的直接链接">​</a></h3>
<p>Similar to that with Python, you can directly create an ADBC client with JAVA to read data from Doris. Firstly, you need to obtain the FlightInfo. Then, you connect to each endpoint to pull the data.</p>
<div class="language-Java language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">// method one</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">AdbcStatement</span><span class="token plain"> stmt </span><span class="token operator">=</span><span class="token plain"> connection</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">createStatement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">stmt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setSqlQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"SELECT * FROM "</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> tableName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// executeQuery, two steps:</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 1. Execute Query and get returned FlightInfo;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 2. Create FlightInfoReader to sequentially traverse each Endpoint;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">QueryResult</span><span class="token plain"> queryResult </span><span class="token operator">=</span><span class="token plain"> stmt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">executeQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// method two</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">AdbcStatement</span><span class="token plain"> stmt </span><span class="token operator">=</span><span class="token plain"> connection</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">createStatement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">stmt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setSqlQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"SELECT * FROM "</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> tableName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Execute Query and parse each Endpoint in FlightInfo, and use the Location and Ticket to construct a PartitionDescriptor</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">partitionResult </span><span class="token operator">=</span><span class="token plain"> stmt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">executePartitioned</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">partitionResult</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getPartitionDescriptors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Create ArrowReader for each PartitionDescriptor to read data</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">ArrowReader</span><span class="token plain"> reader </span><span class="token operator">=</span><span class="token plain"> connection2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">readPartition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">partitionResult</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getPartitionDescriptors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getDescriptor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=04--spark>04  Spark<a href=#04--spark class=hash-link aria-label="04  Spark的直接链接" title="04  Spark的直接链接">​</a></h3>
<p>For Spark users, apart from connecting to Flight SQL Server using JDBC and JAVA, you can apply the <a href=https://github.com/qwshen/spark-flight-connector target=_blank rel="noopener noreferrer">Spark-Flight-Connector</a>, which enables Spark to act as a client for reading and writing data from/to a Flight SQL Server. This is made possible by the fast data conversion between the Arrow format and the Block in Apache Doris, which is <strong>10 times faster than the conversion between CSV and Block</strong>. Moreover, the Arrow data format provides more comprehensive and robust support for complex data types such as Map and Array.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=hop-on-the-trend-train>Hop on the trend train<a href=#hop-on-the-trend-train class=hash-link aria-label="Hop on the trend train的直接链接" title="Hop on the trend train的直接链接">​</a></h2>
<p>A number of enterprise users of Doris has tried loading data from Doris to Python, Spark, and Flink using Arrow Flight SQL and enjoyed much faster data reading speed. In the future, we plan to include the support for Arrow Flight SQL in data writing, too. By then, most systems built with mainstream programming languages will be able to read and write data from/to Apache Doris by an ADBC client. That's high-speed data interaction which opens up numerous possibilities. On our to-do list, we also envision leveraging Arrow Flight to implement parallel data reading by multiple backends and facilitate federated queries across Doris and Spark.</p>
<p>Download <a href=https://doris.apache.org/download/ target=_blank rel="noopener noreferrer">Apache Doris 2.1</a> and get a taste of 100 times faster data transfer powered by Arrow Flight SQL. If you need assistance, come find us in the <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Apache Doris developer and user community</a>.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/auto-increment-columns-in-databases/>Auto-increment columns in databases: a simple magic that makes a big difference</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2024-04-08T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2024年4月8日</time></div></header><div class=markdown itemprop=articleBody><p>Auto-increment column is a bread-and-butter feature of single-node transactional databases. It assigns a unique identifier for each row in a way that requires the least manual effort from users. With an auto-increment column in the table, whenever a new row is inserted into the table, the new row will be assigned with the next available value from the auto-increment sequence. This is an automated mechanism that makes database maintenance easy and reliable.</p>
<p>Auto-increment column is the bedrock of many features in databases:</p>
<ul>
<li>
<p><strong>Dictionary encoding</strong>: User IDs and Order IDs are often stored as strings. However, strings are not friendly to precise deduplication query execution. So for optimal performance, a common practice is to perform dictionary encoding on the strings and then construct a bitmap for aggregation operations. The role of an auto-increment column in this process is that <strong>it speeds up dictionary encoding and thus accelerates string deduplication</strong>.</p>
</li>
<li>
<p><strong>Primary key generation</strong>: An auto-increment column is the perfect candidate for the primary key of a table. Primary keys must be unique and not empty, while auto-increment columns guarantee a unique identifier for each row.</p>
</li>
<li>
<p><strong>Detailed data updates</strong>: Updating detail tables is tricky, but it can be easy if you add a auto-increment table to it. It gives each data record in the database a unique ID, which can work as the primary key, and then data updates can be done based on the primary key.</p>
</li>
<li>
<p><strong>Efficient pagination</strong>: Pagination is often required in data display. It is typically implemented by the <code>limit</code> or <code>offset</code> + <code>order by</code> statement in SQL queries. However, such implementation involves full data reading and sorting, which doesn't make so much sense in deep pagination queries (those with large offsets). This is when auto-increment columns come to the rescue. Like I said, it gives a unique identifier to each row, so the maximum identifier of the last page can be used as the filtering condition for the next page. Thus, it can avoid a lot of unnecessary data scanning and increase pagination efficiency.</p>
</li>
</ul>
<p>The idea of auto-increment columns is intuitive, but when it comes to distributed databases, it becomes a different game, because it has to consider global transactions. As a distributed DBMS, Apache Doris provides an innovative and efficient auto-increment solution that does no harm to data writing performance.</p>
<div class="theme-admonition theme-admonition-tip admonition_Gfwi alert alert--success"><div class=admonitionHeading_f1Ed>提示</div><div class=admonitionContent_UjKb><p>To give AUTO_INCREMENT column a spin, follow this quick <a href="https://www.youtube.com/watch?v=FGVp2RQvGBo" target=_blank rel="noopener noreferrer">demo</a>.</div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=syntax--usage>Syntax & usage<a href=#syntax--usage class=hash-link aria-label="Syntax & usage的直接链接" title="Syntax & usage的直接链接">​</a></h2>
<p>To enable an auto-increment column in Doris, add <code>AUTO_INCREMENT</code> property to the column in the table creation statement (<a href=https://doris.apache.org/zh-CN/docs/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-TABLE target=_blank rel="noopener noreferrer">CREAT-TABLE</a>). You can specify a starting value for the auto-increment column via <code>AUTO_INCREMENT(start_value)</code>; if not, the default starting value is 1.</p>
<p>For example, you can create a table in the <a href=https://doris.apache.org/docs/data-table/data-model#duplicate-model target=_blank rel="noopener noreferrer">Duplicate Key model</a>, with one of the key columns being an auto-increment column.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// highlight-next-line</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">value</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 3"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Apart from a key column, you can also specify a value column as an auto-increment column (example below):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">uid</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// highlight-next-line</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">value</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">uid</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">uid</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 3"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>AUTO_INCREMENT is supported in both the Duplicate Key model and the <a href=https://doris.apache.org/docs/data-table/data-model/#unique-model target=_blank rel="noopener noreferrer">Unique Key model</a>. Usage in the latter is similar.</p>
<p>I will walk you down the rest of the road with the table below as an example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">65533</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">value</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 3"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>When you ingest data into this table using an <code>insert into</code> statement, if the <code>id</code> column has no specified value in the original data file, it will be auto-filled with auto-increment values.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Bob"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Alice"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Jack"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.09</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">'label'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'label_183babcb84ad4023_a2d6266ab73fb5aa'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'status'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'VISIBLE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'txnId'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'7'</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> id   </span><span class="token operator">|</span><span class="token plain"> name  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Bob   </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Alice </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">20</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Jack  </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">30</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.05</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Similarly, when you ingest a data file <code>test.csv</code> by Stream Load, the <code>id</code> column will be auto-filled with auto-increment values, too.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">test</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">csv:</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Tom</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">40</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">John</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">50</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">curl </span><span class="token comment" style="color:rgb(98, 114, 164)">--location-trusted -u user:passwd -H "columns:name,value" -H "column_separator:," -T ./test.csv http://{host}:{port}/api/{db}/tbl/_stream_load</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> id   </span><span class="token operator">|</span><span class="token plain"> name  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Bob   </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Alice </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">20</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Jack  </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">30</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Tom   </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">40</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> John  </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">50</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------+-------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.04</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=applicable-scenarios>Applicable scenarios<a href=#applicable-scenarios class=hash-link aria-label="Applicable scenarios的直接链接" title="Applicable scenarios的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=01-dictionary-encoding>01 Dictionary encoding<a href=#01-dictionary-encoding class=hash-link aria-label="01 Dictionary encoding的直接链接" title="01 Dictionary encoding的直接链接">​</a></h3>
<p>In Apache Doris, the bitmap data type and the bitmap-related aggregations are implemented with RoaringBitmap, which can deliver high performance especially when dictionary encoding produces dense values.</p>
<p>As is mentioned, auto-increment columns enable fast dictionary encoding. I will put you into the context of user profiling to show you how that works.</p>
<p>For analysis of offline page views (PV) and unique visitors (UV), store the details in a user behavior table:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dwd_dup_tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim1</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim2</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim3</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim4</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim5</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">visit_time</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">32</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 3"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Create a dictionary table as follows leveraging AUTO_INCREMENT:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dictionary_tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">aid</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AUTO_INCREMENT</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">32</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 3"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Load the existing <code>user_id</code> into the dictionary table, and create mappings from <code>user_id</code> to integer values.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> user_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> dwd_dup_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If you only need to load the incremental <code>user_id</code> into the dictionary table, you can use the following command. In practice, you can also use the <a href=https://doris.apache.org/docs/ecosystem/flink-doris-connector/ target=_blank rel="noopener noreferrer">Flink Doris Connector</a> for data writing.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> dwd_dup_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> dictionary_tbl</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id </span><span class="token operator">=</span><span class="token plain"> dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">visit_time  </span><span class="token string" style="color:rgb(255, 121, 198)">'2023-12-10'</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id </span><span class="token operator">is</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Suppose you have your analytic dimensions as <code>dim1</code>,  <code>dim3</code>,  <code>dim5</code>, create a table in the <a href=https://doris.apache.org/docs/data-table/data-model#aggregate-model target=_blank rel="noopener noreferrer">Aggregate Key model</a> to accommodate the results of data aggregation:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dws_agg_tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim1</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim3</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim5</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id_bitmap</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> BITMAP BITMAP_UNION </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">pv</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> SUM </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">AGGREGATE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim1</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim3</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim5</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dim1</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">32</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 3"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Load the aggregated results into the table:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> dws_agg_tbl</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> BITMAP_UNION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">TO_BITMAP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">aid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">COUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> dwd_dup_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">JOIN</span><span class="token plain"> dictionary_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id </span><span class="token operator">=</span><span class="token plain"> dictionary_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">user_id</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dwd_dup_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Then you query PV/UV using the following statement:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> dim1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dim3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dim5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> bitmap_count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_id_bitmap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> uv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> pv </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> dws_agg_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=02-detailed-data-updates>02 Detailed data updates<a href=#02-detailed-data-updates class=hash-link aria-label="02 Detailed data updates的直接链接" title="02 Detailed data updates的直接链接">​</a></h3>
<p>In Doris, the Unique Key model is applicable to use cases with frequent data updates, while the Duplicate Key model is designed for detailed data storage with no data updating requirements.</p>
<p>However, in real life, users might need to update their detailed data sometimes, which can be hard to implement because the data tables don't come with unique key columns.</p>
<p>In this case, you can <strong>use an auto-increment column as the primary key for the detailed data</strong>.</p>
<p>For example, a financial institution keeps record of customer loans and writes it into a Duplicate Key table, in which one single user might have multiple borrowing records.</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE TABLE loan_records </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `user_id` VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'Customer ID'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `loan_amount` DECIMAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'Amount of loan'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `interest_rate` DECIMAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'Interest rate'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `loan_start_date` DATE DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'Start date of the loan'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `loan_end_date` DATE DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'End date of the loan'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `total_debt` DECIMAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'Amount of debt'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> DUPLICATE KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">`user_id`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">DISTRIBUTED BY HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">`user_id`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 3"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Suppose that in a promotional campaign, the institution offers a 10% discount on interest rates to its existing customers. Correspondingly, there is a need to update the <code>interest_rate</code> and <code>total_debt</code> in the table.</p>
<p>For that sake, you can create a Unique Key table for the same data, but add an <code>auto_id</code> field and set it as the primary key.</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE TABLE loan_records </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `auto_id` BIGINT NOT NULL AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `user_id` VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'Customer ID'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `loan_amount` DECIMAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'Amount of loan'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `interest_rate` DECIMAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'Interest rate'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `loan_start_date` DATE DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'Start date of the loan'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `loan_end_date` DATE DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'End date of the loan'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    `total_debt` DECIMAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> DEFAULT NULL COMMENT </span><span class="token string" style="color:rgb(255, 121, 198)">'Amount of debt'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> UNIQUE KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">`auto_id`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">DISTRIBUTED BY HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">`auto_id`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 3"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Now, write a few new records into the table and see what happens. (Note that you don't have to write in the <code>auto_id</code> field.)</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">INSERT INTO loan_records </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> loan_amount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> interest_rate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> loan_start_date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> loan_end_date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> total_debt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> VALUES</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'10001'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5000.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-31'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5020.55</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'10002'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10000.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-05-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10082.56</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'10003'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2000.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-15'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2003.84</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'10004'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">7500.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-04-15'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">7546.23</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'10005'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3000.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-21'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3008.22</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'10002'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">8000.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-06-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">8100.82</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'10007'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">6000.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-04-10'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">6032.88</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'10008'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">4000.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-26'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">4013.70</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'10001'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5500.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-04-05'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5526.37</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'10010'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">9000.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5.00</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-03-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2024-05-10'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">9086.30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Check with the <code>select * from loan_records</code> statement, and you can see a unique ID is already in place for each newly-ingested record:</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> select </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> loan_records</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> auto_id </span><span class="token operator">|</span><span class="token plain"> user_id </span><span class="token operator">|</span><span class="token plain"> loan_amount </span><span class="token operator">|</span><span class="token plain"> interest_rate </span><span class="token operator">|</span><span class="token plain"> loan_start_date </span><span class="token operator">|</span><span class="token plain"> loan_end_date </span><span class="token operator">|</span><span class="token plain"> total_debt </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10001</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">5000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">5020.55</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10004</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">7500.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">7546.23</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10002</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">10000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">   </span><span class="token number">10082.56</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10003</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">2000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">15</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">2003.84</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10002</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">8000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">8100.82</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">8</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10008</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">4000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">26</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">4013.70</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">7</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10007</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">6000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">6032.88</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">9</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10001</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">5500.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">5526.37</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10005</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">3000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">21</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">3008.22</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10010</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">9000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">9086.30</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">10</span><span class="token plain"> rows </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Execute these two SQL statements to update <code>interest_rate</code> and <code>total_debt</code>, respectively:</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">update loan_records </span><span class="token builtin" style="color:rgb(189, 147, 249)">set</span><span class="token plain"> interest_rate </span><span class="token operator">=</span><span class="token plain"> interest_rate </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">0.9</span><span class="token plain"> where user_id </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">10005</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">update loan_records </span><span class="token builtin" style="color:rgb(189, 147, 249)">set</span><span class="token plain"> total_debt </span><span class="token operator">=</span><span class="token plain"> loan_amount </span><span class="token operator">+</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">loan_amount </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">interest_rate </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> DATEDIFF</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">loan_end_date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> loan_start_date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">365</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Check again to see if the old records have been replaced by the new ones:</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> select </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> loan_records order by auto_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> auto_id </span><span class="token operator">|</span><span class="token plain"> user_id </span><span class="token operator">|</span><span class="token plain"> loan_amount </span><span class="token operator">|</span><span class="token plain"> interest_rate </span><span class="token operator">|</span><span class="token plain"> loan_start_date </span><span class="token operator">|</span><span class="token plain"> loan_end_date </span><span class="token operator">|</span><span class="token plain"> total_debt </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10001</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">5000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">4.50</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">31</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">5018.49</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10002</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">10000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">4.50</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">   </span><span class="token number">10075.21</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10003</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">2000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">4.50</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">15</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">2003.45</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10004</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">7500.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">4.50</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">7541.61</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10005</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">3000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">4.50</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">21</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">3007.40</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10002</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">8000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">4.50</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">8090.74</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">7</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10007</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">6000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">6032.88</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">8</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10008</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">4000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">26</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">4013.70</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">9</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10001</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">5500.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">4.50</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">5523.73</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10010</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">9000.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">5.00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">9086.30</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">10</span><span class="token plain"> rows </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=03-efficient-pagination>03 Efficient pagination<a href=#03-efficient-pagination class=hash-link aria-label="03 Efficient pagination的直接链接" title="03 Efficient pagination的直接链接">​</a></h3>
<p>Imagine that you need to sort the data in a specific order and then retrieve record No. 90,001 to record No. 90,010. This means you have a large offset of 90,000. This is what we call a deep pagination query. Even though you only require a result set of 10 rows, the database system still has to read the entire dataset into memory and perform a full sorting.</p>
<p><strong>For higher execution efficiency in deep pagination queries, you can harness the power of auto-increment columns</strong>. The main idea is to record the <code>max_value</code> from the <code>unique_value</code> column of the previous page, and push down predicates by <code>where unique_value > max_value limit rows_per_page</code>.</p>
<p>For example, during table creation, you enable an auto-increment column: <code>unique_value</code>, which gives each row an identifier.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">demo</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">records_tbl</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">26</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">address</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">41</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">city</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">nation</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">region</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">13</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">phone</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">mktsegment</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">unique_value</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AUTO_INCREMENT</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 3"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>In pagination queries, suppose that each page displays 100 results, this is how you retrieve the first page of the result set.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> records_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> unique_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Use programs to record the maximum <code>unique_value</code> in the returned result. Suppose that the maximum is 99, you can query data from the second page using the following statement:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> records_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> unique_value </span><span class="token operator">></span><span class="token plain"> </span><span class="token number">99</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> unique_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If you need to query data from a deeper page, for example, page 101, which means it's hard to get the maximum <code>unique_value</code> from the previous page directly, then you can use the statement as follows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> region</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> phone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> mktsegment</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> records_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> unique_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> max_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> records_tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> unique_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">offset</span><span class="token plain"> </span><span class="token number">9999</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> previous_data</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> records_tbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">unique_value </span><span class="token operator">></span><span class="token plain"> previous_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">max_value</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> unique_value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=implementation>Implementation<a href=#implementation class=hash-link aria-label=Implementation的直接链接 title=Implementation的直接链接>​</a></h2>
<p>Typical OLTP databases perform incremental ID matching by their transaction mechanisms. However, in an MPP-based distributed database system like Apache Doris, such an approach can easily suffocate data writing performance.</p>
<p>That's why Apache Doris 2.1 innovates the implementation of auto-increment IDs. In a data ingestion task, one of the backend (BE) nodes will work as the coordinator, which is responsible for the allocation of auto-increment IDs. The coordinator BE requests a range of IDs in bulk from the frontend (FE). The FE makes sure that the ID ranges allocated to each BE do not overlap, thus guaranteeing the uniqueness of IDs.</p>
<p>I illustrate the process with the figure below. StreamLoad1 has BE1 as the coordinator. BE1 requests a batch of IDs (range: 1-1000) from the FE and caches the IDs locally. Once all 1000 IDs are allocated, BE1 will request a new batch from the FE. At the same time, StreamLoad 2 selects BE3 as the coordinator, and BE3 also requests IDs from the FE. Since IDs 1-1000 have already been allocated to BE1, the FE assigns IDs 1001-2000 to BE3.</p>
<p><img decoding=async loading=lazy alt="the implementation of auto-increment IDs" src=/zh-CN/assets/images/the-implementation-of-auto-increment-IDs-d48d7814da087bde1ef5fe3fbf0db7b5.png width=1280 height=1100 class=img_ev3q></p>
<p>Suppose that StreamLoad1 and StreamLoad2 each write in 50 new data records, the auto-increment IDs assigned to them will be 1-50 and 1001-1050.</p>
<p>Suppose that StreamLoad3 arises later and selects BE1 as the coordinator, BE1 will assign IDs starting from 51 to the data written by StreamLoad3. From the user's side, they will see that rows written by StreamLoad3 get smaller ID numbers than those by StreamLoad2, even though StreamLoad2 precedes StreamLoad3 in time.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=note>Note<a href=#note class=hash-link aria-label=Note的直接链接 title=Note的直接链接>​</a></h2>
<p>Attention is required regarding:</p>
<ul>
<li>
<p><strong>Scope of uniqueness guarantee</strong>: Doris ensures that the values generated on an auto-increment column are unique within the table, but this only applies to values auto-filled by Doris. If a user explicitly inserts values into the auto-increment column, Doris cannot guarantee the uniqueness of those values.</p>
</li>
<li>
<p><strong>Density and continuity of values</strong>: Doris ensures that the values generated by the auto-increment column are dense. However, for performance reasons, it cannot guarantee that the auto-filled values are continuous. This means there may be occurrences of value jumps in the auto-increment column. Additionally, since the auto-increment values are pre-allocated and cached in BE, the magnitude of the auto-increment values cannot reflect the order of data import.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label=Conclusion的直接链接 title=Conclusion的直接链接>​</a></h2>
<p>AUTO_INCREMENT brings higher stability and reliability for Doris in large-scale data processing. If it sounds like something you need, download <a href=https://doris.apache.org/download/ target=_blank rel="noopener noreferrer">Apache Doris</a> and try it out. For issues you come across along the way, join us in the <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Apache Doris developer and user community</a> and we are happy to help.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/variant-in-apache-doris-2.1/>Variant in Apache Doris 2.1.0: a new data type 8 times faster than JSON for semi-structured data analysis</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2024-03-26T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2024年3月26日</time></div></header><div class=markdown itemprop=articleBody><p>Semi-structured data is data arranged in flexible formats. Unlike structured data, it does not require data users to pre-define the table schema for it, so it provides convenience for data storage and analysis. Common forms of semi-structured data include XML, JSON, and log files. They are widely seen in the following industry scenarios:</p>
<ul>
<li>
<p><strong>E-commerce</strong> platforms store user reviews of products as semi-structured data for sentiment analysis and user behavior pattern mining.</p>
</li>
<li>
<p><strong>Telecommunication</strong> use cases often require schemaless support for their network data and complicated nested JSON data.</p>
</li>
<li>
<p><strong>Mobile applications</strong> keep records of user behavior in the form of semi-structured data, because after new features are introduced, the user behavior attributes can change. A non-fixed schema can adapt to these changes easily and save the trouble of frequent manual modification.</p>
</li>
<li>
<p><strong>Internet of Vehicles</strong> (IoV) and <strong>Internet of Things</strong> (IoT) platforms receive real-time data from vehicle sensors, such as speed, location, and fuel consumption, based on which they perform real-time monitoring, fault alerting, and route planning. Such data is also stored as semi-structured data.</p>
</li>
</ul>
<p>As an open-source real-time data warehouse, <a href=https://doris.apache.org target=_blank rel="noopener noreferrer">Apache Doris</a> provides semi-structured data processing capabilities, and the newly-released <a href=https://doris.apache.org/blog/release-note-2.1.0 target=_blank rel="noopener noreferrer">version 2.1.0</a> makes a stride in this direction. Before V2.1, Apache Doris stores semi-structured data as JSON files. However, during query execution, the real-time parsing of JSON data leads to high CPU and I/O consumption in addition to high query latency, especially when the dataset is huge and complicated. Moreover, the lack of a pre-defined schema means there is no handle for query optimization.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=a-newly-added-data-type-variant>A newly-added data type: Variant<a href=#a-newly-added-data-type-variant class=hash-link aria-label="A newly-added data type: Variant的直接链接" title="A newly-added data type: Variant的直接链接">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_Gfwi alert alert--success"><div class=admonitionHeading_f1Ed>提示</div><div class=admonitionContent_UjKb><p>To help you quickly learn and use Variant data type, we provide **<a href="https://www.youtube.com/watch?v=FVfsnkZUBsU" target=_blank rel="noopener noreferrer">a hands-on demo</a> **</div></div>
<p>In Apache Doris 2.1.0, we have introduced a new data type: <a href=https://doris.apache.org/docs/sql-manual/sql-reference/Data-Types/VARIANT target=_blank rel="noopener noreferrer">Variant</a>. Fields of the Variant data type can accommodate integers, strings, boolean values, and any combination of them. With Variant, you don't have to define the specific columns in the table schema in advance.</p>
<p>The Variant data type is well-suited to handle nested structures, which tend to change dynamically. Upon data writing, the Variant type automatically infers column information based on the data and its structure in the columns, and then merges it into the existing table schema. It stores the JSON keys and their corresponding values as dynamic sub-columns.</p>
<p>Meanwhile, you can include both Variant columns and static columns of pre-defined data types in the same table. This Schema-on-Write method provides greater flexibility in storage and queries. Powered by the columnar storage, vectorized execution engine, and query optimizer of Doris, the Variant type delivers high efficiency in queries and storage.</p>
<p>Compared to the JSON type, storage data in the Variant type can save up to 65% of disk space, and increase query speed by 8 times. (See details later in this post)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=usage-guide>Usage guide<a href=#usage-guide class=hash-link aria-label="Usage guide的直接链接" title="Usage guide的直接链接">​</a></h2>
<p>Create table: syntax keyword <code>variant</code></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">-- No index</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> ${table_name} </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    k </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    v VARIANT</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">table_properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- Create index for the v column, specify the parser</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> ${table_name} </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    k </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    v VARIANT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> idx_var</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> INVERTED </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">PROPERTIES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"parser"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"english|unicode|chinese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'your comment'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">table_properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- Create Bloom Filter for the v column</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> ${table_name} </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    k </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    v VARIANT</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"replication_num"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"bloom_filter_columns"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"v"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Query: access sub-column via <code>[]</code>. The sub-columns are also of the Variant type.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"properties"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"title"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> ${table_name}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Now, let's show you how to create a table containing the Variant data type and conduct data ingestion and queries to it. The dataset is Github Events records. This is one of the formatted records:</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token property">"id"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"14186154924"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token property">"type"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"PushEvent"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token property">"actor"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"id"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">282080</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"login"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"brianchandotcom"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"display_login"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"brianchandotcom"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"gravatar_id"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"url"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"https://api.github.com/users/brianchandotcom"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"avatar_url"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"https://avatars.githubusercontent.com/u/282080?"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token property">"repo"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"id"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1920851</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"name"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"brianchandotcom/liferay-portal"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"url"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"https://api.github.com/repos/brianchandotcom/liferay-portal"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token property">"payload"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"push_id"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">6027092734</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"size"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"distinct_size"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"ref"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"refs/heads/master"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"head"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"91edd3c8c98c214155191feb852831ec535580ba"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"before"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"abb58cc0db673a0bd5190000d2ff9c53bb51d04d"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"commits"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token property">"public"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token property">"created_at"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"2020-11-13T18:00:00Z"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=01--create-table>01  Create table<a href=#01--create-table class=hash-link aria-label="01  Create table的直接链接" title="01  Create table的直接链接">​</a></h3>
<ul>
<li>
<p>Create 3 columns of the Variant type: <code>actor</code>, <code>repo</code> and <code>payload</code></p>
</li>
<li>
<p>Meanwhile, create inverted index for the <code>payload</code> column: <code>idx_payload</code></p>
</li>
<li>
<p><code>USING INVERTED</code> specifies the index as inverted index, which accelerates conditional filtering on sub-columns</p>
</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATABASE</span><span class="token plain"> test_variant</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USE</span><span class="token plain"> test_variant</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">IF</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> github_events </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    actor VARIANT </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    repo VARIANT </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    payload VARIANT </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BOOLEAN</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    created_at </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> idx_payload </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">payload</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> INVERTED PROPERTIES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"parser"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"english"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'inverted index for payload'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"replication_num"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<blockquote>
<p>Note: If the <code>Payload</code> column has too many sub-columns, creating indexes on it may lead to an excessive number of index columns and decrease data writing performance. If the data analysis only involves equivalence queries, it is advisable to build Bloom Filter index on the Variant columns. This can bring better performance than inverted index. For a single Variant column, if the parsing properties are the same but you have multiple parsing requirements, you can replicate the column and specify various indexes for each of them.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=02--ingest-data-by-stream-load>02  Ingest data by Stream Load<a href=#02--ingest-data-by-stream-load class=hash-link aria-label="02  Ingest data by Stream Load的直接链接" title="02  Ingest data by Stream Load的直接链接">​</a></h3>
<p>Load the <code>gh_2022-11-07-3.json</code> file, which is Github Events records of an hour. One formatted row of it looks like this:</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">wget https</span><span class="token operator">:</span><span class="token comment" style="color:rgb(98, 114, 164)">//qa-build.oss-cn-beijing.aliyuncs.com/regression/variant/gh_2022-11-07-3.json</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">curl --location-trusted -u root</span><span class="token operator">:</span><span class="token plain">  -T gh_2022</span><span class="token number">-11</span><span class="token number">-07</span><span class="token number">-3</span><span class="token plain">.json -H </span><span class="token string" style="color:rgb(255, 121, 198)">"read_json_by_line:true"</span><span class="token plain"> -H </span><span class="token string" style="color:rgb(255, 121, 198)">"format:json"</span><span class="token plain">  http</span><span class="token operator">:</span><span class="token comment" style="color:rgb(98, 114, 164)">//127.0.0.1:18148/api/test_variant/github_events/_strea</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">m_load</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"TxnId"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"Label"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"086fd46a-20e6-4487-becc-9b6ca80281bf"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"Comment"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"TwoPhaseCommit"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"false"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"Status"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Success"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"Message"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"OK"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"NumberTotalRows"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">139325</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"NumberLoadedRows"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">139325</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"NumberFilteredRows"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"NumberUnselectedRows"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"LoadBytes"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">633782875</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"LoadTimeMs"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">7870</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"BeginTxnTimeMs"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">19</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"StreamLoadPutTimeMs"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">162</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"ReadDataTimeMs"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">2416</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"WriteDataTimeMs"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">7634</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token property">"CommitAndPublishTimeMs"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">55</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Check if the data loading succeeds:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">-- Check the number of rows</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> github_events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">   </span><span class="token number">139325</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.25</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- View a random row</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> github_events </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------+---------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> id          </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> actor                                                                                                                                                                                                                       </span><span class="token operator">|</span><span class="token plain"> repo                                                                                                                                                     </span><span class="token operator">|</span><span class="token plain"> payload                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> created_at          </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------+---------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">25061821748</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> PushEvent </span><span class="token operator">|</span><span class="token plain"> {</span><span class="token string" style="color:rgb(255, 121, 198)">"gravatar_id"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"display_login"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"jfrog-pipelie-intg"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"url"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"https://api.github.com/users/jfrog-pipelie-intg"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"id"</span><span class="token plain">:</span><span class="token number">98024358</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"login"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"jfrog-pipelie-intg"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"avatar_url"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"https://avatars.githubusercontent.com/u/98024358?"</span><span class="token plain">} </span><span class="token operator">|</span><span class="token plain"> {</span><span class="token string" style="color:rgb(255, 121, 198)">"url"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"https://api.github.com/repos/jfrog-pipelie-intg/jfinte2e_1667789956723_16"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"id"</span><span class="token plain">:</span><span class="token number">562683829</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"jfrog-pipelie-intg/jfinte2e_1667789956723_16"</span><span class="token plain">} </span><span class="token operator">|</span><span class="token plain"> {</span><span class="token string" style="color:rgb(255, 121, 198)">"commits"</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">"sha"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"334433de436baa198024ef9f55f0647721bcd750"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"author"</span><span class="token plain">:{</span><span class="token string" style="color:rgb(255, 121, 198)">"email"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"98024358+jfrog-pipelie-intg@users.noreply.github.com"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"jfrog-pipelie-intg"</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"message"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"commit message 10238493157623136117"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"distinct"</span><span class="token plain">:</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"url"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"https://api.github.com/repos/jfrog-pipelie-intg/jfinte2e_1667789956723_16/commits/334433de436baa198024ef9f55f0647721bcd750"</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"before"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"f84a26792f44d54305ddd41b7e3a79d25b1a9568"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"head"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"334433de436baa198024ef9f55f0647721bcd750"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"size"</span><span class="token plain">:</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"push_id"</span><span class="token plain">:</span><span class="token number">11572649828</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"ref"</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">"refs/heads/test-notification-sent-branch-10238493157623136113"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"distinct_size"</span><span class="token plain">:</span><span class="token number">1</span><span class="token plain">} </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">07</span><span class="token plain"> </span><span class="token number">11</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain">:</span><span class="token number">00</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------+---------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.23</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>View schema information via <code>desc</code>. The sub-columns will be automatically extended in the storage layer, and the data types of the sub-columns are automatically inferred.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">-- No display of extended columns</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token plain"> github_events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+-------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> Field      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Type</span><span class="token plain">        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">Null</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Key</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Default</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Extra </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+-------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> id         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">No</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor      </span><span class="token operator">|</span><span class="token plain"> VARIANT     </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> repo       </span><span class="token operator">|</span><span class="token plain"> VARIANT     </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload    </span><span class="token operator">|</span><span class="token plain"> VARIANT     </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BOOLEAN</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> created_at </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+-------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">7</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- Displaying extended columns of Variant columns</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> describe_extend_variant_column </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token plain"> github_events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------------------------------------------------------+------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> Field                                                      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Type</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">Null</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Key</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Default</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Extra </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------------------------------------------------------+------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> id                                                         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">No</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain">                                                       </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor                                                      </span><span class="token operator">|</span><span class="token plain"> VARIANT    </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">avatar_url                                           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">display_login                                        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">id                                                   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain">        </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">login                                                </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">url                                                  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> created_at                                                 </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATETIME</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload                                                    </span><span class="token operator">|</span><span class="token plain"> VARIANT    </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">action</span><span class="token plain">                                             </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">before                                             </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">comment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">author_association                         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">comment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">body                                       </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------------------------------------------------------+------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">406</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.07</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>With the <code>desc</code> statement, you can specify which partition you want to check the schema of:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESCRIBE</span><span class="token plain"> ${table_name} </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">$partition_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=03--query>03  Query<a href=#03--query class=hash-link aria-label="03  Query的直接链接" title="03  Query的直接链接">​</a></h3>
<blockquote>
<p>Note: When filtering and aggregating sub-columns, an additional CAST operation is required to ensure data type consistency. This is because the storage types may not be fixed, and the <code>CAST</code> expression in SQL can unify the data types. For example, <code>SELECT * FROM tbl WHERE CAST(var['title'] AS TEXT) MATCH 'hello world'</code>.</p>
</blockquote>
<p><strong>The following are simple examples of queries on Variant columns</strong></p>
<ol>
<li>Retrieve the Top 5 repositories with the most Stars from <code>github_events</code>.</li>
</ol>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">repo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> repo_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> stars</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> github_events</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'WatchEvent'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> repo_name</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> stars </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> repo_name                </span><span class="token operator">|</span><span class="token plain"> stars </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> aplus</span><span class="token operator">-</span><span class="token plain">framework</span><span class="token operator">/</span><span class="token plain">app      </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">78</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> lensterxyz</span><span class="token operator">/</span><span class="token plain">lenster       </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">77</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> aplus</span><span class="token operator">-</span><span class="token plain">framework</span><span class="token operator">/</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">database</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">46</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> stashapp</span><span class="token operator">/</span><span class="token plain">stash           </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">42</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> aplus</span><span class="token operator">-</span><span class="token plain">framework</span><span class="token operator">/</span><span class="token plain">image    </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">34</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.03</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=2>
<li>Count the number of events containing the keyword <code>doris</code>.</li>
</ol>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">-- implicit cast `payload['comment']['body']` to string type</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> github_events</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'comment'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'body'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">MATCH</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'doris'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.04</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=3>
<li>Check the ID of the issue that has the most comments and the repository it belongs to.</li>
</ol>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">   cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">repo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> repo_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">   cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"issue"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"number"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> issue_number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">   </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> comments</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">   </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">distinct</span><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">actor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"login"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> authors </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain">  github_events </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'IssueCommentEvent'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"action"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'created'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"issue"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"number"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">></span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> repo_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> issue_number </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HAVING</span><span class="token plain"> authors </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> comments </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> repo_name</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------+--------------+----------+---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> repo_name                            </span><span class="token operator">|</span><span class="token plain"> issue_number </span><span class="token operator">|</span><span class="token plain"> comments </span><span class="token operator">|</span><span class="token plain"> authors </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------+--------------+----------+---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> facebook</span><span class="token operator">/</span><span class="token plain">react</span><span class="token operator">-</span><span class="token plain">native                </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">35228</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> swsnu</span><span class="token operator">/</span><span class="token plain">swppfall2022</span><span class="token operator">-</span><span class="token plain">team4             </span><span class="token operator">|</span><span class="token plain">           </span><span class="token number">27</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> belgattitude</span><span class="token operator">/</span><span class="token plain">nextjs</span><span class="token operator">-</span><span class="token plain">monorepo</span><span class="token operator">-</span><span class="token plain">example </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">2865</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">--------------------------------------+--------------+----------+---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.03</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=04--notes>04  Notes<a href=#04--notes class=hash-link aria-label="04  Notes的直接链接" title="04  Notes的直接链接">​</a></h3>
<p>Based on our test results, it is safe to say that there is no efficiency disparity between Variant dynamic columns and pre-defined static columns. However, in log data processing, when users need to add fields to the table, such as container labels in Kubernetes, JSON parsing and type inference during data writing incur additional overhead.</p>
<p>To strike a balance between flexibility and efficiency for the Variant data type, we recommend keeping the number of columns below 1000. A small number of columns will reduce overheads caused by data parsing and type inference and thus increase data writing performance.</p>
<p>It is also advisable to ensure field type consistency whenever possible. This is because Doris automatically performs compatible type conversions to unify fields of different data types. If it cannot find a compatible type, it will convert the data to the JSONB type, which may result in degraded performance compared to the int or text type.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=variant-vs-json>Variant VS JSON<a href=#variant-vs-json class=hash-link aria-label="Variant VS JSON的直接链接" title="Variant VS JSON的直接链接">​</a></h2>
<p>To see how the newly added Variant type impacts data storage and queries, we did comparison tests on pre-defined static columns, Variant columns, and JSON columns with ClickBench.</p>
<p><strong>Test environment</strong>: 16 core, 64GB, AWS EC2 instance, 1TB ESSD</p>
<p><strong>Test result</strong>:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=01-storage-space>01 Storage space<a href=#01-storage-space class=hash-link aria-label="01 Storage space的直接链接" title="01 Storage space的直接链接">​</a></h3>
<p>As the results show, storing data as Variant columns takes up a similar storage space to storing it as pre-defined static columns. Compared with the JSON type, the Variant type requires 65% less space. <strong>In other words, the Variant type only takes up one-third of the storage space that JSON does. The difference will be even more notable with low-cardinality data because of columnar storage.</strong></p>
<p><img decoding=async loading=lazy alt="Storage space" src=/zh-CN/assets/images/storage-space-1a7ce7030524f8ce1553d8872503825a.png width=1280 height=476 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=02-query-performance>02 Query performance<a href=#02-query-performance class=hash-link aria-label="02 Query performance的直接链接" title="02 Query performance的直接链接">​</a></h3>
<p>We tested with 43<a href=https://github.com/ClickHouse/ClickBench/blob/main/selectdb/queries.sql target=_blank rel="noopener noreferrer"> Clickbench</a> SQL queries. Queries on the Variant columns are about 10% slower than those on pre-defined static columns, and <strong>8 times faster than those on</strong> <strong>JSON</strong> <strong>columns</strong>. (For I/O reasons, most cold runs on JSONB data failed with OOM.)</p>
<p><img decoding=async loading=lazy alt="Query Performance" src=/zh-CN/assets/images/query-performance-9442542741fd22019a68e5807dc1c2fb.png width=1280 height=394 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=design--implementation-of-variant>Design & implementation of Variant<a href=#design--implementation-of-variant class=hash-link aria-label="Design & implementation of Variant的直接链接" title="Design & implementation of Variant的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=01--data-writing--type-inference>01  Data writing & type inference<a href=#01--data-writing--type-inference class=hash-link aria-label="01  Data writing & type inference的直接链接" title="01  Data writing & type inference的直接链接">​</a></h3>
<p>In Apache Doris, this is a normal writing process: data sorting, merging, and Segment file generation in the Memtable. Variant writing works similarly. It involves type inference and data merging of the same JSON keys within the Memtable, resulting in the creation of a prefix tree. The tree keeps the type and column information of every JSON field, and merges all type information of the same column into the least common type, generates columns, encodes them into the Doris storage formats, and appends them to the segment.</p>
<p>Each Segment file not only contains data after type encoding and compaction, but also includes the metadata of dynamically generated columns. Such design ensures data integrity and queryability while also improving storage efficiency. <strong>By type inference and merging in the memory, the Variant type largely reduces disk space usage compared to traditional raw text storage</strong>.</p>
<p><img decoding=async loading=lazy alt="Data Writing &amp;amp; Type inferece" src=/zh-CN/assets/images/data-writing-and-type-inference-ef3da2624eff730ddec2ebceaecfccfb.png width=1280 height=364 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=02-column-change-column-adding-or-column-type-changes>02 Column change (column adding or column type changes)<a href=#02-column-change-column-adding-or-column-type-changes class=hash-link aria-label="02 Column change (column adding or column type changes)的直接链接" title="02 Column change (column adding or column type changes)的直接链接">​</a></h3>
<p>During the writing process, all metadata and data of the leaf nodes in the prefix tree will be appended to the Segment file, and the metadata of the Rowsets will be merged. Here is an example of the merging process:</p>
<p><img decoding=async loading=lazy alt="Column change (column adding or column type changes)" src=/zh-CN/assets/images/column-change-c7807e83ad624ebb11654d5ebdcdcc70.png width=1280 height=245 class=img_ev3q></p>
<p>In the end, the Rowset will use the <code>Least Common Column Schema</code> as the metadata after data merging. (Least common column schema is a schema with the most sub-columns and the sub-column type being the least common type.) This allows for dynamic column extension and type changes.</p>
<p>Based on this mechanism, the stored schema for Variant can be considered data-driven. It offers greater flexibility compared to the Schema Change process in Doris. The diagram below illustrates the directions for type changes (type changes can only be performed in the direction indicated by the arrows, with JSONB being the common type for all types):</p>
<p><img decoding=async loading=lazy alt="Column change (column adding or column type changes)" src=/zh-CN/assets/images/column-change2-4ae8a9d1a6389b9ca9bc49e5c84b3164.png width=1248 height=474 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=03-index--query-acceleration>03 Index & query acceleration<a href=#03-index--query-acceleration class=hash-link aria-label="03 Index & query acceleration的直接链接" title="03 Index & query acceleration的直接链接">​</a></h3>
<p>In Variant, the leaf nodes are stored in a columnar format in the Segment file, which is exactly the same as the storage format for static pre-defined columns. Thus, queries on Variant columns can also be accelerated by dictionary encoding, vectorization, and indexes (ZoneMap, inverted index, BloomFilter, etc.). Since the same column might be of different types in different files, users need to specify a type as the hint during query execution. Here is an example query:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- var['title'] is to access the 'title' sub-column of var, which is a Variant column. If there is inverted index for var, the queries will be accelerated by inverted index.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">var</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'titile'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">MATCH</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"hello world"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- If there is Bloom Filter for var, equivalence queries will be accelerated by Bloom Filter.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> tbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">var</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'id'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bigint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1010101</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Predicates will be pushed down to the storage layer (Segment), where the storage type is checked against the target type of the CAST operation. If the types match, a more efficient predicate filtering mechanism will be utilized. This approach reduces unnecessary data reading and conversion, thus improving query performance.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=04--storage-optimization-for-sparse-columns>04  Storage optimization for sparse columns<a href=#04--storage-optimization-for-sparse-columns class=hash-link aria-label="04  Storage optimization for sparse columns的直接链接" title="04  Storage optimization for sparse columns的直接链接">​</a></h3>
<p>Examples of sparse JSON columns:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">"a"</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"b"</span><span class="token plain">:</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"c"</span><span class="token plain">:</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"x_1"</span><span class="token plain"> : </span><span class="token number">1</span><span class="token plain">，</span><span class="token string" style="color:rgb(255, 121, 198)">"x_2"</span><span class="token plain">: </span><span class="token string" style="color:rgb(255, 121, 198)">"3"</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">"a"</span><span class="token plain">:</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"b"</span><span class="token plain">:</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"c"</span><span class="token plain">:</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"x_1"</span><span class="token plain"> : </span><span class="token number">1</span><span class="token plain">，</span><span class="token string" style="color:rgb(255, 121, 198)">"x_2"</span><span class="token plain">: </span><span class="token string" style="color:rgb(255, 121, 198)">"3"</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">"a"</span><span class="token plain">:</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"b"</span><span class="token plain">:</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"c"</span><span class="token plain">:</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"x_3"</span><span class="token plain"> : </span><span class="token number">1</span><span class="token plain">，</span><span class="token string" style="color:rgb(255, 121, 198)">"x_4"</span><span class="token plain">: </span><span class="token string" style="color:rgb(255, 121, 198)">"3"</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">"a"</span><span class="token plain">:</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"b"</span><span class="token plain">:</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"c"</span><span class="token plain">:</span><span class="token number">9</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"x_5"</span><span class="token plain"> : </span><span class="token number">1</span><span class="token plain">，</span><span class="token string" style="color:rgb(255, 121, 198)">"x_6"</span><span class="token plain">: </span><span class="token string" style="color:rgb(255, 121, 198)">"3"</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The <code>a, b, c</code> columns are dense. They are included in almost every row. While the <code> x_？</code> columns are sparse. Only a few of them are not null. If the system stores every column in a columnar way, it will suffer huge storage pressure and exploding meta.</p>
<p>To solve this, Doris detects the sparsity of columns based on the percentage of null values upon data ingestion. The highly sparse columns (with a high proportion of null values) will be packed into JSONB encoding and stored in a separate column.</p>
<p><img decoding=async loading=lazy alt=" Storage optimization for sparse columns" src=/zh-CN/assets/images/storage-optimization-for-sparse-columns-4ece65d5d623312590b94532dc8c0237.png width=1280 height=684 class=img_ev3q></p>
<p>Such optimization for storing sparse columns will relieve pressure on meta and data compaction and increase flexibility.</p>
<p>Queries on the sparse columns are implemented in exactly the same way as those on other columns.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=use-case>Use case<a href=#use-case class=hash-link aria-label="Use case的直接链接" title="Use case的直接链接">​</a></h2>
<p>GuanceDB, an observability platform, used an Elasticsearch-based solution for storing logs and user behavior data. However, Elasticsearch has inadequate schemaless support, so it is inefficient in processing large amounts of user-defined fields. Under the Dynamic Mapping mechanism in Elasticsearch, frequent field type conflicts led to data losses and required lots of human intervention. Meanwhile, the writing process in Elasticsearch was resource-intensive and the performance in massive data aggregation was less than ideal.</p>
<p>For a data architectural upgrade, GuanceDB works with <a href=https://www.velodb.io/ target=_blank rel="noopener noreferrer">VeloDB</a> and builds an Apache Doris-based observability solution. They utilize the Variant data type to realize partition-based schema change, which is more flexible and efficient. In addition, Doris imposes no upper limit on the number of columns, meaning that it can better accommodate schema-free data.</p>
<p>The Doris-based solution also delivers lower CPU usage in data writing and higher speed in complicated data aggregation (accelerated by inverted index and query optimization techniques). After the upgrade, GuanceDB <strong>decreased their machine costs by 70% and doubled their overall query speed</strong>, with an over 4-time performance increase in simple queries.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label=Conclusion的直接链接 title=Conclusion的直接链接>​</a></h2>
<p>The Variant data type has stood the test of many users before the official release of Apache Doris 2.1.0. It is production-available now. In the future, we plan to realize more lightweight changes for Variant to facilitate data modeling.</p>
<p>For more information about Variant and guides on how to build a semi-structured data analytics solution for your case, come talk to the <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Apache Doris developer team</a>.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/inverted-index-accelerates-text-searches-by-40-time-apache-doris/>A deep dive into inverted index: how it speeds up text searches by 40 times</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2024-02-01T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2024年2月1日</time></div></header><div class=markdown itemprop=articleBody><p>As an open-source real-time data warehouse, <a href=https://doris.apache.org target=_blank rel="noopener noreferrer">Apache Doris</a> provides a rich choice of indexes to speed up data scanning and filtering. Based on user involvement, they can be divided into built-in smart indexes and user-created indexes. The former is automatically generated by Apache Doris on data ingestion, such as ZoneMap index and prefix index, while the latter is the index users choose for various use cases, including inverted index and NGram BloomFilter index.</p>
<p>This post is a deep dive into inverted index and NGram BloomFilter index, providing a hands-on guide to applying them for various queries.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=sample-dataset>Sample dataset<a href=#sample-dataset class=hash-link aria-label="Sample dataset的直接链接" title="Sample dataset的直接链接">​</a></h2>
<p>The test dataset comprises about 130 million Amazon customer reviews. It is a few Snappy-compressed Parquet files with a total size of 37GB. These are a few samples:</p>
<p><img decoding=async loading=lazy alt=img src=/zh-CN/assets/images/sample-dataset-0a343d2a31f6f2afd8617577cf9e8823.png width=4733 height=557 class=img_ev3q></p>
<p>Each row includes 15 columns including <code>customer_id</code>, <code>review_id</code>, <code>product_id</code>, <code>product_category</code>, <code>star_rating</code>, <code>review_headline</code>, and <code>review_body</code>.</p>
<p>A lot of these columns can be accelerated by indexes based on their structures. For example, <code>customer_id</code> is a high-cardinality numerical field while <code>product_id</code> is a low-cardinality fixed-length text field, and <code>product_title</code> and <code>review_body</code> are short and long text fields, respectively.</p>
<p>Queries on these columns can be roughly divided into two types:</p>
<ul>
<li><strong>Text searches</strong>: searches for certain contents in the <code>review_body</code> field.</li>
<li><strong>Non-primary key column queries</strong>: query reviews about certain <code>product_id</code> or from certain <code>customer_id</code>.</li>
</ul>
<p>These are also the main threads of this article. I will present to you how indexes can speed up these queries.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=prerequisites>Prerequisites<a href=#prerequisites class=hash-link aria-label=Prerequisites的直接链接 title=Prerequisites的直接链接>​</a></h2>
<p>For a quick run, here we use a single-node cluster (1 frontend, 1 backend).</p>
<ol>
<li>Deploy Apache Doris: refer to <a href=https://doris.apache.org/docs/get-starting/quick-start/ target=_blank rel="noopener noreferrer">Quick Start</a></li>
<li>Create a table using the following statements:</li>
</ol>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">amazon_reviews</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">  </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">review_date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">marketplace</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">customer_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bigint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">review_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">product_id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">product_parent</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bigint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">product_title</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">500</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">product_category</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">star_rating</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">smallint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">helpful_votes</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">total_votes</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">vine</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">boolean</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">verified_purchase</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">boolean</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">review_headline</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">500</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">review_body</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> string </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">review_date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'OLAP'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">review_date</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">16</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"compression"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"ZSTD"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=3>
<li>Download datasets: Snappy-compressed Parquet files with a total size of 37GB</li>
</ol>
<ul>
<li><a href=https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2010.snappy.parquet target=_blank rel="noopener noreferrer">amazon_reviews_2010</a></li>
<li><a href=https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2011.snappy.parquet target=_blank rel="noopener noreferrer">amazon_reviews_2011</a></li>
<li><a href=https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2012.snappy.parquet target=_blank rel="noopener noreferrer">amazon_reviews_2012</a></li>
<li><a href=https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2013.snappy.parquet target=_blank rel="noopener noreferrer">amazon_reviews_2013</a></li>
<li><a href=https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2014.snappy.parquet target=_blank rel="noopener noreferrer">amazon_reviews_2014</a></li>
<li><a href=https://datasets-documentation.s3.eu-west-3.amazonaws.com/amazon_reviews/amazon_reviews_2015.snappy.parquet target=_blank rel="noopener noreferrer">amazon_reviews_2015</a></li>
</ul>
<ol start=4>
<li>Execute the following commands to load the datasets</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">curl --location-trusted -u root: -T amazon_reviews_2010.snappy.parquet -H "format:parquet" http://${BE_IP}:${BE_PORT}/api/${DB}/amazon_reviews/_stream_load</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">curl --location-trusted -u root: -T amazon_reviews_2011.snappy.parquet -H "format:parquet" http://${BE_IP}:${BE_PORT}/api/${DB}/amazon_reviews/_stream_load</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">curl --location-trusted -u root: -T amazon_reviews_2012.snappy.parquet -H "format:parquet" http://${BE_IP}:${BE_PORT}/api/${DB}/amazon_reviews/_stream_load</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">curl --location-trusted -u root: -T amazon_reviews_2013.snappy.parquet -H "format:parquet" http://${BE_IP}:${BE_PORT}/api/${DB}/amazon_reviews/_stream_load</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">curl --location-trusted -u root: -T amazon_reviews_2014.snappy.parquet -H "format:parquet" http://${BE_IP}:${BE_PORT}/api/${DB}/amazon_reviews/_stream_load</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">curl --location-trusted -u root: -T amazon_reviews_2015.snappy.parquet -H "format:parquet" http://${BE_IP}:${BE_PORT}/api/${DB}/amazon_reviews/_stream_load</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=5>
<li>Check and verify: After the above steps, execute the following statements in the MySQL client to check and see the size of the dataset. It can be seen from below that 135589433 rows are loaded and they take up 25.873GB in Apache Doris, which is 30% smaller than the original Parquet files.</li>
</ol>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">COUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> amazon_reviews</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-----------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-----------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">135589433</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-----------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.02</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SHOW</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATA</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> amazon_reviews</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------------+----------------+-----------+--------------+-----------+------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> TableName      </span><span class="token operator">|</span><span class="token plain"> IndexName      </span><span class="token operator">|</span><span class="token plain"> Size      </span><span class="token operator">|</span><span class="token plain"> ReplicaCount </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">RowCount</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> RemoteSize </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------------+----------------+-----------+--------------+-----------+------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> amazon_reviews </span><span class="token operator">|</span><span class="token plain"> amazon_reviews </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">25.873</span><span class="token plain"> GB </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain">           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">135589433</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">                </span><span class="token operator">|</span><span class="token plain"> Total          </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">25.873</span><span class="token plain"> GB </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain">           </span><span class="token operator">|</span><span class="token plain">           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0.000</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------------+----------------+-----------+--------------+-----------+------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">2</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=accelerate-text-searches>Accelerate text searches<a href=#accelerate-text-searches class=hash-link aria-label="Accelerate text searches的直接链接" title="Accelerate text searches的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=no-index>No index<a href=#no-index class=hash-link aria-label="No index的直接链接" title="No index的直接链接">​</a></h3>
<p>Now let's try running text searches on the <code>review_body</code> field. Specifically, we're trying to retrieve the top 5 products whose reviews include the keywords "is super awesome". The results should be sorted in descending order based on the number of reviews. Each result should include the product ID, a randomly selected product title, the average star rating, and the total number of reviews.</p>
<p>This is the query statement:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    product_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">product_title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">AVG</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">star_rating</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> rating</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">COUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> count</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    amazon_reviews</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    review_body </span><span class="token operator">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'%is super awesome%'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    product_id</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    count </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    rating </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    product_id</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Since the <code>review_body</code> field contains lengthy reviews, such text searches can be time-consuming. Without enabling any indexes, it took <strong>7.6 seconds</strong> to return the results:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+------------------------------------------+--------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> product_id </span><span class="token operator">|</span><span class="token plain"> any_value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">product_title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                 </span><span class="token operator">|</span><span class="token plain"> rating             </span><span class="token operator">|</span><span class="token plain"> count </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+------------------------------------------+--------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B00992CF6W </span><span class="token operator">|</span><span class="token plain"> Minecraft                                </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">4.8235294117647056</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">17</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B009UX2YAC </span><span class="token operator">|</span><span class="token plain"> Subway Surfers                           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">4.7777777777777777</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">9</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B00DJFIMW6 </span><span class="token operator">|</span><span class="token plain"> Minion Rush: Despicable Me Official Game </span><span class="token operator">|</span><span class="token plain">              </span><span class="token number">4.875</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">8</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B0086700CM </span><span class="token operator">|</span><span class="token plain"> Temple Run                               </span><span class="token operator">|</span><span class="token plain">                  </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B00KWVZ750 </span><span class="token operator">|</span><span class="token plain"> Angry Birds Epic RPG                     </span><span class="token operator">|</span><span class="token plain">                  </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+------------------------------------------+--------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">7.60</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=ngram-bloomfilter-index>Ngram BloomFilter index<a href=#ngram-bloomfilter-index class=hash-link aria-label="Ngram BloomFilter index的直接链接" title="Ngram BloomFilter index的直接链接">​</a></h3>
<p>Now, let's try accelerating such text searches using the Ngram BloomFilter index.</p>
<ul>
<li><code>gram_size</code>: the value of "N" in "Ngram", representing the length of consecutive characters. In the snippet below, <code>"gram_size"="10"</code> means that the texts will be divided into a number of 10-character strings, which are the basis of the Ngram BloomFilter index.</li>
<li><code>bf_size</code>: the size of the BloomFilter in bytes. <code>"bf_size"="10240"</code> indicates that the BloomFilter occupies 10240 bytes of space.</li>
</ul>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> amazon_reviews </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> review_body_ngram_idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">review_body</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> NGRAM_BF PROPERTIES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"gram_size"</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"10"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"bf_size"</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"10240"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This time, the query is finished within <strong>0.93 seconds</strong>. That means Ngram BloomFilter brings a speedup of <strong>8 times</strong>.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+------------------------------------------+--------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> product_id </span><span class="token operator">|</span><span class="token plain"> any_value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">product_title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                 </span><span class="token operator">|</span><span class="token plain"> rating             </span><span class="token operator">|</span><span class="token plain"> count </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+------------------------------------------+--------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B00992CF6W </span><span class="token operator">|</span><span class="token plain"> Minecraft                                </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">4.8235294117647056</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">17</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B009UX2YAC </span><span class="token operator">|</span><span class="token plain"> Subway Surfers                           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">4.7777777777777777</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">9</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B00DJFIMW6 </span><span class="token operator">|</span><span class="token plain"> Minion Rush: Despicable Me Official Game </span><span class="token operator">|</span><span class="token plain">              </span><span class="token number">4.875</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">8</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B0086700CM </span><span class="token operator">|</span><span class="token plain"> Temple Run                               </span><span class="token operator">|</span><span class="token plain">                  </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B00KWVZ750 </span><span class="token operator">|</span><span class="token plain"> Angry Birds Epic RPG                     </span><span class="token operator">|</span><span class="token plain">                  </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+------------------------------------------+--------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.93</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>So how does Ngram BloomFilter do the magic?</strong> The way it works can be explained in two parts.</p>
<ul>
<li><strong>Ngram tokenization</strong>: When <code>gram_size=5</code>, the phrase "hello world" is split into ["hello", "ello ", "llo w", "lo wo", "o wor", " worl", "world"]. These sub-strings are then hashed and added to a BloomFilter of the <code>bf_size</code>. Since data in Apache Doris is stored by page, the BloomFilters are generated also by page.</li>
<li><strong>Query acceleration</strong>: For example, to query the word "hello" in the texts, "hello" is tokenized and compared with the BloomFilters of each page. If the BloomFilter detects a potential match (there might be false positives) in a page, that page is loaded for further matching. Otherwise, that page is skipped.</li>
</ul>
<p>By skipping the irrelevant pages, the BloomFilter index reduces unnecessary data scanning and thus greatly reduces query latency.</p>
<p><img decoding=async loading=lazy alt=img src=/zh-CN/assets/images/data-storage-structure-in-apache-doris-da2f97a4dbdbfbe800121484566d7d25.png width=1280 height=644 class=img_ev3q></p>
<div> Data storage structure in Apache Doris </div>
<p><img decoding=async loading=lazy alt=img src=/zh-CN/assets/images/illustration-of-ngram-bloomfilter-d0db39fe1aee6af22cf7ad2949396c3b.png width=1280 height=697 class=img_ev3q></p>
<div> Illustration of Ngram BloomFilter </div>
<p><strong>How to find the optimal parameter configurations for Ngram BloomFilter?</strong></p>
<p><code>gram_size</code> determines the matching efficiency, while <code>bf_size</code> impacts the false positive rate. Typically, a large <code>bf_size</code> reduces the false positive rate but also requires more storage space. Thus, we suggest that you configure these two parameters based on these two factors:</p>
<ol>
<li>
<p>Text length:</p>
<ul>
<li>For short texts (words or phrases), a small <code>gram_size</code> (2~4) and a small <code>bf_size</code> are recommended.</li>
<li>For long texts (sentences or paragraphs), a large <code>gram_size</code> (5~10) and a large <code>bf_size</code> work better.</li>
</ul>
</li>
<li>
<p>Query pattern:</p>
<ul>
<li>If the queries often involve phrases or complete words, a large <code>gram_size</code> will be more efficient.</li>
<li>For fuzzy matching or diverse queries, a small <code>gram_size</code> allows more flexible matching.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=inverted-index>Inverted index<a href=#inverted-index class=hash-link aria-label="Inverted index的直接链接" title="Inverted index的直接链接">​</a></h3>
<p><a href=https://doris.apache.org/blog/Building-A-Log-Analytics-Solution-10-Times-More-Cost-Effective-Than-Elasticsearch target=_blank rel="noopener noreferrer">Inverted index</a> is another way to accelerate text searches. Creating inverted index is simple:</p>
<ol>
<li>
<p><strong>Add inverted index</strong>: Refer to the snippet below to create inverted index for the <code>review_body</code> column of the <code>amazon_reviews</code> table. Inverted index supports phrase searching, in which the order of the tokenized words will affect the search results.</p>
</li>
<li>
<p><strong>Add inverted index for historical data</strong>: You can also create inverted index for historical data.</p>
</li>
</ol>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> amazon_reviews </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> review_body_inverted_idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">review_body</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> INVERTED PROPERTIES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"parser"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"english"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"support_phrase"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"true"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">BUILD </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> review_body_inverted_idx </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> amazon_reviews</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=3>
<li><strong>Check and verify</strong>: You can check and see the created indexes using the following statement:</li>
</ol>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">show</span><span class="token plain"> BUILD </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> TableName</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"amazon_reviews"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------+----------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> JobId </span><span class="token operator">|</span><span class="token plain"> TableName      </span><span class="token operator">|</span><span class="token plain"> PartitionName  </span><span class="token operator">|</span><span class="token plain"> AlterInvertedIndexes                                                                                                              </span><span class="token operator">|</span><span class="token plain"> CreateTime              </span><span class="token operator">|</span><span class="token plain"> FinishTime              </span><span class="token operator">|</span><span class="token plain"> TransactionId </span><span class="token operator">|</span><span class="token plain"> State    </span><span class="token operator">|</span><span class="token plain"> Msg  </span><span class="token operator">|</span><span class="token plain"> Progress </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------+----------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">10152</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> amazon_reviews </span><span class="token operator">|</span><span class="token plain"> amazon_reviews </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> review_body_inverted_idx </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">review_body</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> INVERTED PROPERTIES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"parser"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"english"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"support_phrase"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"true"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span><span class="token plain"> </span><span class="token number">15</span><span class="token plain">:</span><span class="token number">42</span><span class="token plain">:</span><span class="token number">28.658</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span><span class="token plain"> </span><span class="token number">15</span><span class="token plain">:</span><span class="token number">48</span><span class="token plain">:</span><span class="token number">42.990</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">11</span><span class="token plain">            </span><span class="token operator">|</span><span class="token plain"> FINISHED </span><span class="token operator">|</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------+----------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If you want to see how tokenization works, you can test with the <code>TOKENIZE</code> function. Just input the text that needs to be tokenized and the parameters:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> TOKENIZE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'I can honestly give the shipment and package 100%, it came in time that it was supposed to with no hasels, and the book was in PERFECT condition.</span><br></span><span class=token-line style=color:#F8F8F2><span class="token string" style="color:rgb(255, 121, 198)">super awesome buy, and excellent for my college classs'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'"parser" = "english","support_phrase" = "true"'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> tokenize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'I can honestly give the shipment and package 100%, it came in time that it was supposed to with no hasels, and the book was in PERFECT condition. super awesome buy, and excellent for my college classs'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'"parser" = "english","support_phrase" = "true"'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                                              </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"i"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"can"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"honestly"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"give"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"the"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"shipment"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"and"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"package"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"100"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"it"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"came"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"in"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"time"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"that"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"it"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"was"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"supposed"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"to"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"with"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"no"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"hasels"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"and"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"the"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"book"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"was"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"in"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"perfect"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"condition"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"super"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"awesome"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"buy"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"and"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"excellent"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"for"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"my"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"college"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"classs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.05</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>With inverted index, now we retrieve customer reviews containing "is super awesome" using <code>MATCH_PHRASE</code>.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    product_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">product_title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">AVG</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">star_rating</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> rating</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">COUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> count</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    amazon_reviews</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    review_body MATCH_PHRASE </span><span class="token string" style="color:rgb(255, 121, 198)">'is super awesome'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    product_id</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    count </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    rating </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    product_id</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The clause <code>review_body MATCH_PHRASE 'is super awesome'</code> searches for text fragments in the <code>review_body</code> column that contains all three keywords "is", "super", and "awesome" in that exact order, with no other words in between.</p>
<p>The <code>MATCH</code> query is case-insensitive, which is also what sets it apart from the <code>LIKE</code> query. The <code>MATCH</code> query is more efficient in large datasets.</p>
<p>Results show that inverted index has decreased the query latency to <strong>0.19 seconds</strong>, bringing a <strong>4-time performance increase</strong> compared to the Ngram BloomFilter index, and <strong>a nearly 40-time increase</strong> compared to having no indexes at all.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+------------------------------------------+-------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> product_id </span><span class="token operator">|</span><span class="token plain"> any_value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">product_title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                 </span><span class="token operator">|</span><span class="token plain"> rating            </span><span class="token operator">|</span><span class="token plain"> count </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+------------------------------------------+-------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B00992CF6W </span><span class="token operator">|</span><span class="token plain"> Minecraft                                </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">4.833333333333333</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">18</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B009UX2YAC </span><span class="token operator">|</span><span class="token plain"> Subway Surfers                           </span><span class="token operator">|</span><span class="token plain">               </span><span class="token number">4.7</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B00DJFIMW6 </span><span class="token operator">|</span><span class="token plain"> Minion Rush: Despicable Me Official Game </span><span class="token operator">|</span><span class="token plain">                 </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">7</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B0086700CM </span><span class="token operator">|</span><span class="token plain"> Temple Run                               </span><span class="token operator">|</span><span class="token plain">                 </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B00KWVZ750 </span><span class="token operator">|</span><span class="token plain"> Angry Birds Epic RPG                     </span><span class="token operator">|</span><span class="token plain">                 </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+------------------------------------------+-------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.19</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>How does inverted index make it possible?</strong></p>
<p>Inverted index splits the texts into words and maps each word to a row number. Then the tokenized words are sorted alphabetically and and a skip list index is created. When executing queries of specific words, the system locates the row numbers in this orderly mapping using the skip list index and binary search methods. Based on the row numbers, the system retrieves the entire data record.</p>
<p>This approach avoids line-by-line matching and reduces computational complexity from O(n) to O(logn). That's how inverted index speeds up queries on large datasets.</p>
<p><img decoding=async loading=lazy alt=img src=/zh-CN/assets/images/illustration-of-inverted-index-460ac7b75f89211aeba6c32af670cccd.png width=1280 height=744 class=img_ev3q></p>
<div> Illustration of Inverted Index </div>
<p>To provide a deeper understanding of inverted index, I will start from its read/write logic. In Doris, logically, inverted index is applied at the column level of a table. However, from a physical storage and implementation perspective, it is actually built on data files.</p>
<ul>
<li><strong>Writing</strong>: When data is written to a data file, it is also synchronously written to the inverted index file, and the row numbers are matched.</li>
<li><strong>Query</strong>: In a query, if the <code>WHERE</code> condition involves a column for which an inverted index has been built, Doris will go directly to the index file and returns the corresponding row numbers. Then, based on the row numbers, it skips the irrelevant pages and rows and only reads the target rows.</li>
</ul>
<p>In short, inverted index enables high-speed text searches by mapping, and its implementation relies on the coordination of data files and index files.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=accelerate-non-primary-key-column-queries>Accelerate non-primary key column queries<a href=#accelerate-non-primary-key-column-queries class=hash-link aria-label="Accelerate non-primary key column queries的直接链接" title="Accelerate non-primary key column queries的直接链接">​</a></h2>
<p>To showcase the impact of inverted index on non-primary key column queries, let's try some multi-dimensional queries.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=no-index-1>No index<a href=#no-index-1 class=hash-link aria-label="No index的直接链接" title="No index的直接链接">​</a></h3>
<p>Retrieve the review from Customer ID 13916588 about Product ID B002DMK1R0. Without indexes, the system has to scan the entire table. The query is finished within <strong>1.81 seconds</strong>.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> product_title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">review_headline</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">review_body</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">star_rating </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> amazon_reviews </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> product_id</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">'B002DMK1R0'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> customer_id</span><span class="token operator">=</span><span class="token number">13916588</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> product_title                                                   </span><span class="token operator">|</span><span class="token plain"> review_headline      </span><span class="token operator">|</span><span class="token plain"> review_body                                                                                                                 </span><span class="token operator">|</span><span class="token plain"> star_rating </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> Magellan Maestro </span><span class="token number">4700</span><span class="token plain"> </span><span class="token number">4.7</span><span class="token operator">-</span><span class="token plain">Inch Bluetooth Portable GPS Navigator </span><span class="token operator">|</span><span class="token plain"> Nice Features But</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> This </span><span class="token operator">is</span><span class="token plain"> a great GPS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> Gets you </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> you are going</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> Don't forget </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> buy the separate </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">grr</span><span class="token operator">!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> cord </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> the traffic kit though</span><span class="token operator">!</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">           </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1.81</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=inverted-index-1>Inverted index<a href=#inverted-index-1 class=hash-link aria-label="Inverted index的直接链接" title="Inverted index的直接链接">​</a></h3>
<p>This query is executed in a different way than what is said above, because the system does not have to tokenize the <code>product_id</code> and <code>customer_id</code>, but creates a Value→RowID inverted index table.</p>
<p>First of all, create inverted index via the following statement:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> amazon_reviews </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> product_id_inverted_idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">product_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> INVERTED </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> amazon_reviews </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> customer_id_inverted_idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">customer_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> INVERTED </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">BUILD </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> product_id_inverted_idx </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> amazon_reviews</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">BUILD </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> customer_id_inverted_idx </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> amazon_reviews</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>With inverted index, the same query is finished within <strong>0.06 seconds</strong>. That represents a <strong>30-time</strong> higher speed compared to the previous 1.81 seconds.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> product_title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">review_headline</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">review_body</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">star_rating </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> amazon_reviews </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> product_id</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">'B002DMK1R0'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> customer_id</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">'13916588'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> product_title                                                   </span><span class="token operator">|</span><span class="token plain"> review_headline      </span><span class="token operator">|</span><span class="token plain"> review_body                                                                                                                 </span><span class="token operator">|</span><span class="token plain"> star_rating </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> Magellan Maestro </span><span class="token number">4700</span><span class="token plain"> </span><span class="token number">4.7</span><span class="token operator">-</span><span class="token plain">Inch Bluetooth Portable GPS Navigator </span><span class="token operator">|</span><span class="token plain"> Nice Features But</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> This </span><span class="token operator">is</span><span class="token plain"> a great GPS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> Gets you </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> you are going</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> Don't forget </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> buy the separate </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">grr</span><span class="token operator">!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> cord </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> the traffic kit though</span><span class="token operator">!</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">           </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-----------------------------------------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.06</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=profile>Profile<a href=#profile class=hash-link aria-label=Profile的直接链接 title=Profile的直接链接>​</a></h3>
<p>This is an excerpt of the SegmentIterator Profile, from which you can tell why inverted index accelerates query execution.</p>
<p>(Note that if you need to check the Profile of a query, make sure you have executed <code>SET enable_profile=true;</code> in the MySQL client before you execute the query. Then you can check the Profile at <em>http://FE_IP:FE_HTTP_PORT/QueryProfile</em>)</p>
<div class="language-YAML language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token key atrule">SegmentIterator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">FirstReadSeekCount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">FirstReadSeekTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 0ns</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">FirstReadTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 13.119ms</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">IOTimer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 19.537ms</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">InvertedIndexQueryTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 11.583ms</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RawRowsRead</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RowsConditionsFiltered</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RowsInvertedIndexFiltered</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 16.907403M (16907403)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RowsShortCircuitPredInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RowsVectorPredFiltered</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RowsVectorPredInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">ShortPredEvalTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 0ns</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">TotalPagesNum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">27</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">UncompressedBytesRead</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 3.71 MB</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">VectorPredEvalTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 0ns</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>RowsInvertedIndexFiltered: 16.907403M (16907403)</code> and <code>RawRowsRead: 1</code> means that the inverted index has filtered out 16907403 rows and only reads 1 row (the target row). <code>FirstReadTime: 13.119ms</code> means that it takes 13.119 ms to read the page where the target row is located, and <code>InvertedIndexQueryTime: 11.583ms</code> means that the system <strong>filters out 16907403 rows within only 11.58 ms</strong>.</p>
<p>For comparision, this is the SegmentIterator Profile when no index is used:</p>
<div class="language-YAML language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token key atrule">SegmentIterator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">FirstReadSeekCount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 9.374K (9374)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">FirstReadSeekTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 400.522ms</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">FirstReadTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 3s144ms</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">IOTimer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 2s564ms</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">InvertedIndexQueryTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 0ns</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RawRowsRead</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 16.680706M (16680706)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RowsConditionsFiltered</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 226.698K (226698)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RowsInvertedIndexFiltered</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RowsShortCircuitPredInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RowsVectorPredFiltered</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 16.680705M (16680705)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RowsVectorPredInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 16.680706M (16680706)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">RowsZonemapFiltered</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 226.698K (226698)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">ShortPredEvalTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 2.723ms</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">TotalPagesNum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 5.421K (5421)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">UncompressedBytesRead</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 277.05 MB</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">VectorPredEvalTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 8.114ms</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Without inverted index, it takes 3.14s to load 16680706 rows (<code>FirstReadTime: 3s144ms</code>). Then, the system conducts filtering by Predicate Evaluate and screens out 16680705 rows. The conditional filtering process only takes less than 10ms, making original data loading the most time-consuming task.</p>
<p>To sum up, inverted index increases query execution efficiency by enabling quick retrieval of the target rows and thus reducing unnecessary data loading.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=accelerate-low-cardinality-text-column-queries>Accelerate low-cardinality text column queries<a href=#accelerate-low-cardinality-text-column-queries class=hash-link aria-label="Accelerate low-cardinality text column queries的直接链接" title="Accelerate low-cardinality text column queries的直接链接">​</a></h2>
<p>So inverted index is a big accelerator for queries on high-cardinality text columns, but that might raise a concern: For low-cardinality columns, will too many indexes bring excessive overheads and undermine query performance?</p>
<p>The answer is: no. Let me show you why and how. The following example uses <code>product_category</code> as the predicate column for filtering.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">COUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTINCT</span><span class="token plain"> product_category</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> amazon_reviews </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------------------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTINCT</span><span class="token plain"> product_category</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------------------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">                               </span><span class="token number">43</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------------------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.57</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>As is shown, the <code>product_category</code> column has only 43 distinct categories, making it a typical low-cardinality text column. Now, let's add inverted index to it.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> amazon_reviews </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> product_category_inverted_idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">product_category</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> INVERTED</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">BUILD </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> product_category_inverted_idx </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> amazon_reviews</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>After adding inverted index, run the following SQL query to retrieve the top 3 products with the most reviews in the "Mobile_Electronics" product category.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    product_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    product_title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">AVG</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">star_rating</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> rating</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">review_body</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">review_headline</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">COUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> count </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    amazon_reviews </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    product_category </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Mobile_Electronics'</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    product_title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> product_id </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    count </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>With inverted index, the query takes 1.54s to finish.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> product_id </span><span class="token operator">|</span><span class="token plain"> product_title                                                                                                                                                                                          </span><span class="token operator">|</span><span class="token plain"> rating             </span><span class="token operator">|</span><span class="token plain"> any_value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">review_body</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </span><span class="token operator">|</span><span class="token plain"> any_value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">review_headline</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">      </span><span class="token operator">|</span><span class="token plain"> count </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B00J46XO9U </span><span class="token operator">|</span><span class="token plain"> iXCC Lightning Cable </span><span class="token number">3</span><span class="token plain">ft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> iPhone charger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> iPhone X</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token plain"> Plus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token plain"> Plus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain">s Plus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain"> Plus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SE </span><span class="token number">5</span><span class="token plain">s </span><span class="token number">5</span><span class="token plain">c </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> iPad Air </span><span class="token number">2</span><span class="token plain"> Pro</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> iPad mini </span><span class="token number">2</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> iPad </span><span class="token number">4</span><span class="token plain">th Gen Apple MFi Certified</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Black </span><span class="token operator">and</span><span class="token plain"> White</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">4.3766233766233764</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Great cable </span><span class="token operator">and</span><span class="token plain"> works well</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> Exact fit </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> Apple cable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> I would recommend this </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> anyone who </span><span class="token operator">is</span><span class="token plain"> looking </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">save</span><span class="token plain"> money </span><span class="token operator">and</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> a quality cable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">                                                                                                                                                                                                                                                                                                                                                             </span><span class="token operator">|</span><span class="token plain"> Apple certified lightning cable </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">1078</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B004911E9M </span><span class="token operator">|</span><span class="token plain"> Wall AC Charger USB Sync </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Data</span><span class="token plain"> Cable </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> iPhone </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain">GS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> iPod                                                                                                                                        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2.4281805745554035</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> A total waste </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">of</span><span class="token plain"> money </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> me because I needed it </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> a iPhone </span><span class="token number">4.</span><span class="token plain">  The plug will only go </span><span class="token operator">in</span><span class="token plain"> upside down </span><span class="token operator">and</span><span class="token plain"> thus won</span><span class="token string" style="color:rgb(255, 121, 198)">'t work at all.                                                                                                                                                                                                                                                                                                                                                                      | Won'</span><span class="token plain">t </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">work</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> a iPhone </span><span class="token number">4</span><span class="token operator">!</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain">   </span><span class="token number">731</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B002D4IHYM </span><span class="token operator">|</span><span class="token plain"> New Trent Easypak </span><span class="token number">7000</span><span class="token plain">mAh Portable Triple USB Port External Battery Charger</span><span class="token operator">/</span><span class="token plain">Power Pack </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> Smartphones</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Tablets </span><span class="token operator">and</span><span class="token plain"> more </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">w</span><span class="token operator">/</span><span class="token plain">built</span><span class="token operator">-</span><span class="token operator">in</span><span class="token plain"> USB cable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                                                        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">4.5216095380029806</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> I bought this product based </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> the reviews that i </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">read</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> i am very glad that i did</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> I did have a problem </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> the product charging my itouch </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">after</span><span class="token plain"> i received it but i emailed the company </span><span class="token operator">and</span><span class="token plain"> they corrected the problem immediately</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> VERY GOOD customer service</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> very prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> The product itself </span><span class="token operator">is</span><span class="token plain"> very good</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> It charges my power hungry itouch very quickly </span><span class="token operator">and</span><span class="token plain"> the imax battery power lasts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> a long </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">All</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">all</span><span class="token plain"> a very good purchase that i would recommend </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> anyone who owns an itouch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Great product </span><span class="token operator">&</span><span class="token plain"> company         </span><span class="token operator">|</span><span class="token plain">   </span><span class="token number">671</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1.54</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Now let's try again without enabling inverted index. The same query takes 1.8s to finish. (You can simply disable inverted index by executing <code>set enable_inverted_index_query=false;</code> in the MySQL client.)</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> product_id </span><span class="token operator">|</span><span class="token plain"> product_title                                                                                                                                                                                          </span><span class="token operator">|</span><span class="token plain"> rating             </span><span class="token operator">|</span><span class="token plain"> any_value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">review_body</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </span><span class="token operator">|</span><span class="token plain"> any_value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">review_headline</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">            </span><span class="token operator">|</span><span class="token plain"> count </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B00J46XO9U </span><span class="token operator">|</span><span class="token plain"> iXCC Lightning Cable </span><span class="token number">3</span><span class="token plain">ft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> iPhone charger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> iPhone X</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token plain"> Plus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token plain"> Plus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain">s Plus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain"> Plus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SE </span><span class="token number">5</span><span class="token plain">s </span><span class="token number">5</span><span class="token plain">c </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> iPad Air </span><span class="token number">2</span><span class="token plain"> Pro</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> iPad mini </span><span class="token number">2</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> iPad </span><span class="token number">4</span><span class="token plain">th Gen Apple MFi Certified</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Black </span><span class="token operator">and</span><span class="token plain"> White</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">4.3766233766233764</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> These cables are great</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> They feel quality</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> best </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">of</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> they </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">work</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> they should</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> I have </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">no</span><span class="token plain"> issues </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> them whatsoever </span><span class="token operator">and</span><span class="token plain"> will be buying more </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">when</span><span class="token plain"> needed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </span><span class="token operator">|</span><span class="token plain"> Just </span><span class="token operator">like</span><span class="token plain"> the original </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> Apple     </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">1078</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B004911E9M </span><span class="token operator">|</span><span class="token plain"> Wall AC Charger USB Sync </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Data</span><span class="token plain"> Cable </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> iPhone </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain">GS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> iPod                                                                                                                                        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2.4281805745554035</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> I ordered two </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">of</span><span class="token plain"> these chargers </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> an Iphone </span><span class="token number">4.</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Then</span><span class="token plain"> I started experiencing weird behavior </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> the touch screen</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> It would </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> the wrong area </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">of</span><span class="token plain"> the screen</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">or</span><span class="token plain"> it would refuse </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> scroll beyond a certain </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">point</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> jump back up </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> the </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">top</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">of</span><span class="token plain"> the page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> This behavior occurs whenever either </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">of</span><span class="token plain"> the two that I bought are attached </span><span class="token operator">and</span><span class="token plain"> charging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">When</span><span class="token plain"> I remove them</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> it works fine once again</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> Needless </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> say</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> these items are being returned</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">                                                                                                                                                                                                                                                                                                                                                                              </span><span class="token operator">|</span><span class="token plain"> Beware </span><span class="token operator">-</span><span class="token plain"> these chargers are defective </span><span class="token operator">|</span><span class="token plain">   </span><span class="token number">731</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> B002D4IHYM </span><span class="token operator">|</span><span class="token plain"> New Trent Easypak </span><span class="token number">7000</span><span class="token plain">mAh Portable Triple USB Port External Battery Charger</span><span class="token operator">/</span><span class="token plain">Power Pack </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> Smartphones</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Tablets </span><span class="token operator">and</span><span class="token plain"> more </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">w</span><span class="token operator">/</span><span class="token plain">built</span><span class="token operator">-</span><span class="token operator">in</span><span class="token plain"> USB cable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">                                                        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">4.5216095380029806</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> I received this </span><span class="token operator">in</span><span class="token plain"> the mail </span><span class="token number">4</span><span class="token plain"> days ago</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">after</span><span class="token plain"> charging it </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain"> hours</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> I</span><span class="token string" style="color:rgb(255, 121, 198)">'ve been using it as the sole source for recharging my 3Gs to see how long it would work.  I use my Iphone A LOT every day and usually by the time I get home it'</span><span class="token plain">s down </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> </span><span class="token number">50</span><span class="token operator">%</span><span class="token plain"> </span><span class="token operator">or</span><span class="token plain"> less</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">After</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> days </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">of</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">using</span><span class="token plain"> the IMAX </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> recharge my Iphone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> it finally went </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> bars </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> this afternoon </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">when</span><span class="token plain"> I plugged my iphone </span><span class="token operator">in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">  It charges the iphone very quickly</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> I</span><span class="token string" style="color:rgb(255, 121, 198)">'ve been topping my phone off (stopping around 95% or so) twice a day.  This is a great product and the size is very similar to a deck of cards (not like an iphone that someone else posted) and is very easy to carry in a jacket pocket or back pack.  I bought this for a 4 day music festival I'</span><span class="token plain">m going </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> I have </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">no</span><span class="token plain"> worries at </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">all</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">of</span><span class="token plain"> my iphone running </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">of</span><span class="token plain"> juice</span><span class="token operator">!</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> FANTASTIC product</span><span class="token operator">!</span><span class="token plain">                    </span><span class="token operator">|</span><span class="token plain">   </span><span class="token number">671</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1.80</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>To sum up, inverted index can bring a 15% speedup for queries on low-cardinality columns. So it is not only harmless but also beneficial to low-cardinality data filtering.</p>
<p>In addition, Apache Doris adopts effective dictionary encoding and compression for low-cardinality columns. It also utilizes built-in indexes like ZoneMap for filtering. Thus, it can deliver ideal query performance even without inverted indexes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label=Conclusion的直接链接 title=Conclusion的直接链接>​</a></h2>
<p>Inverted index in Apache Doris optimizes data filtering based on the predicate column (the <code>WHERE</code> clause in SQL queries). It reduces unnecessary data scanning and significantly increases query speed on high-cardinality columns and guarantees no negative effects on low-cardinality columns. It supports lightweight index management, including ADD/DROP INDEX and BUILD INDEX. It can be easily enabled or disabled via <code>enable_inverted_index_query=true/false</code>.</p>
<p>Inverted index and NGram BloomFilter index apply to different scenarios. This is how you decide which one is the optimal choice:</p>
<ul>
<li><strong>Non-primary key column queries</strong>: These cases often involve widely scattered values and a low hit rate. <strong>Inverted index</strong> can work in conjunction with the built-in smart indexes in Doris to accelerate these queries. It has well-established support for scalar data types including characters, numerics, and datetime.</li>
<li><strong>Text searches on short texts</strong>: If the dataset includes short texts that are highly diverse, <strong>NGram BloomFilter</strong> will be an effective choice for fuzzy matching (<code>LIKE</code>) on short texts. If the short texts are very similar (with lots of identical content), <strong>inverted index</strong> will be more efficient because it ensures a smaller dictionary and faster retrieval of the row numbers.</li>
<li><strong>Text searches on long texts</strong>: Inverted index is a better choice for long texts. Compared to brutal-force string matching, it largely reduces CPU resource consumption.</li>
</ul>
<p>Inverted index has been available in Apache Doris for almost a year and stood the test of many users in their production environment with massive data. In future versions of Apache Doris regarding inverted index, we plan to add support for:</p>
<ul>
<li><strong>Self-defined tokenization</strong>: provides a user-defined tokenizer to fit in different use cases.</li>
<li><strong>More data types</strong>: Users will be able to create inverted index for complex data types including Array and Map.</li>
</ul>
<p>If you encounter any issues while trying it out in Apache Doris or would like to know more details, join our <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Slack</a> community and talk to us!</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/introduction-to-apache-doris-a-next-generation-real-time-data-warehouse/>Introduction to Apache Doris: a next-generation real-time data warehouse</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2023-10-03T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2023年10月3日</time></div></header><div class=markdown itemprop=articleBody><h2 class="anchor anchorWithStickyNavbar_LWe7" id=what-is-apache-doris>What is Apache Doris?<a href=#what-is-apache-doris class=hash-link aria-label="What is Apache Doris?的直接链接" title="What is Apache Doris?的直接链接">​</a></h2>
<p><a href=https://doris.apache.org/ target=_blank rel="noopener noreferrer">Apache Doris</a> is an open-source real-time data warehouse. It can collect data from various data sources, including relational databases (MySQL, PostgreSQL, SQL Server, Oracle, etc.), logs, and time series data from IoT devices. It is capable of reporting, ad-hoc analysis, federated queries, and log analysis, so it can be used to support dashboarding, self-service BI, A/B testing, user behavior analysis and the like.</p>
<p>Apache Doris supports both batch import and stream writing. It can be well integrated with Apache Spark, Apache Hive, Apache Flink, Airbyte, DBT, and Fivetran. It can also connect to data lakes such as Apache Hive, Apache Hudi, Apache Iceberg, Delta Lake, and Apache Paimon.</p>
<p><img decoding=async loading=lazy alt=What-Is-Apache-Doris src=/zh-CN/assets/images/introduction_1-d906db31b97b75340d9e0cf7fe267dfc.png width=1280 height=654 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=performance>Performance<a href=#performance class=hash-link aria-label=Performance的直接链接 title=Performance的直接链接>​</a></h2>
<p>As a real-time OLAP engine, Apache Doris hasn a competitive edge in query speed. According to the TPC-H and SSB-Flat benchmarking results, Doris can deliver much faster performance than Presto, Greenplum, and ClickHouse.</p>
<p>As for its self-volution, it has increased its query speed by over 10 times in the past two years, both in complex queries and flat table analysis.</p>
<p><img decoding=async loading=lazy alt=Apache-Doris-VS-Presto-Greenplum-ClickHouse src=/zh-CN/assets/images/introduction_2-3b95346f511caf321269de6c7ea692cd.png width=1280 height=616 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=architectural-design>Architectural Design<a href=#architectural-design class=hash-link aria-label="Architectural Design的直接链接" title="Architectural Design的直接链接">​</a></h2>
<p>Behind the fast speed of Apache Doris is the architectural design, features, and mechanisms that contribute to the performance of Doris.</p>
<p>First of all, Apache Doris has a cost-based optimizer (CBO) that can figure out the most efficient execution plan for complicated big queries. It has a fully vectorized execution engine so it can reduce virtual function calls and cache misses. It is MPP-based (Massively Parallel Processing) so it can give full play to the user's machines and cores. In Doris, query execution is data-driven, which means whether a query gets executed is determined by whether its relevant data is ready, and this enables more efficient use of CPUs.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=fast-point-queries-for-a-column-oriented-database>Fast Point Queries for A Column-Oriented Database<a href=#fast-point-queries-for-a-column-oriented-database class=hash-link aria-label="Fast Point Queries for A Column-Oriented Database的直接链接" title="Fast Point Queries for A Column-Oriented Database的直接链接">​</a></h2>
<p>Apache Doris is a column-oriented database so it can make data compression and data sharding easier and faster. But this might not be suitable for cases such as customer-facing services. In these cases, a data platform will have to handle requests from a large number of users concurrently (these are called "high-concurrency point queries"), and having a columnar storage engine will amplify I/O operations per second, especially when data is arranged in flat tables.</p>
<p>To fix that, Apache Doris enables hybrid storage, which means to have row storage and columnar storage at the same time.</p>
<p><img decoding=async loading=lazy alt=Hybrid-Columnar-Row-Storage src=/zh-CN/assets/images/Introduction_3-1ec14fc9a98e2d4029ce949804b3e1a7.png width=1914 height=456 class=img_ev3q></p>
<p>In addition, since point queries are all simple queries, it will be unnecessary and wasteful to call out the query planner, so Doris executes a short circuit plan for them to reduce overhead.</p>
<p>Another big source of overheads in high-concurrency point queries is SQL parsing. For that, Doris has prepared statements. The idea is to pre-compute the SQL statement and cache them, so they can be reused for similar queries.</p>
<p><img decoding=async loading=lazy alt=prepared-statement-and-short-circuit-plan src=/zh-CN/assets/images/Introduction_4-5daaa3b40e9f7b62a6f30bf10a039f94.png width=1902 height=392 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=data-ingestion>Data Ingestion<a href=#data-ingestion class=hash-link aria-label="Data Ingestion的直接链接" title="Data Ingestion的直接链接">​</a></h2>
<p>Apache Doris provides a range of methods for data ingestion.</p>
<p><strong>Real-Time stream writing</strong>:</p>
<ul>
<li><strong><a href="https://doris.apache.org/docs/dev/data-operate/import/import-way/stream-load-manual?_highlight=stream&_highlight=loa" target=_blank rel="noopener noreferrer">Stream Load</a></strong>: You can apply this method to write local files or data streams via HTTP. It is linearly scalable and can reach a throughput of 10 million records per second in some use cases.</li>
<li><strong><a href=https://doris.apache.org/docs/1.2/ecosystem/flink-doris-connector/ target=_blank rel="noopener noreferrer">Flink-Doris-Connector</a></strong>: With built-in Flink CDC, this Connector ingests data from OLTP databases to Doris. So far, we have realized auto-synchronization of data from MySQL and Oracle to Doris.</li>
<li><strong><a href=https://doris.apache.org/docs/dev/data-operate/import/import-way/routine-load-manual target=_blank rel="noopener noreferrer">Routine Load</a></strong>: This is to subscribe data from Kafka message queues.</li>
<li><strong><a href=https://doris.apache.org/docs/dev/data-operate/import/import-way/insert-into-manual target=_blank rel="noopener noreferrer">Insert Into</a></strong>: This is especially useful when you try to do ETL in Doris internally, like writing data from one Doris table to another.</li>
</ul>
<p><strong>Batch writing</strong>:</p>
<ul>
<li><strong><a href=https://doris.apache.org/docs/dev/data-operate/import/import-way/spark-load-manual target=_blank rel="noopener noreferrer">Spark Load</a></strong>: With this method, you can leverage Spark resources to pre-process data from HDFS and object storage before writing to Doris.</li>
<li><strong><a href=https://doris.apache.org/docs/dev/data-operate/import/import-way/broker-load-manual target=_blank rel="noopener noreferrer">Broker Load</a></strong>: This supports HDFS and S3 protocol.</li>
<li><code>insert into &lt;internal table> select from &lt;external table></code>: This simple statement allows you to connect Doris to various storage systems, data lakes, and databases.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=data-update>Data Update<a href=#data-update class=hash-link aria-label="Data Update的直接链接" title="Data Update的直接链接">​</a></h2>
<p>For data updates, what Apache Doris has to offer is that, it supports both Merge on Read and Merge on Write, the former for low-frequency batch updates and the latter for real-time writing. With Merge on Write, the latest data will be ready by the time you execute queries, and that's why it can improve your query speed by 5 to 10 times compared to Merge on Read.</p>
<p>From an implementation perspective, these are a few common data update operations, and Doris supports them all:</p>
<ul>
<li><strong>Upsert</strong>: to replace or update a whole row</li>
<li><strong>Partial column update</strong>: to update just a few columns in a row</li>
<li><strong>Conditional updating</strong>: to filter out some data by combining a few conditions in order to replace or delete it</li>
<li><strong>Insert Overwrite</strong>: to rewrite a table or partition</li>
</ul>
<p>In some cases, data updates happen concurrently, which means there is numerous new data coming in and trying to modify the existing data record, so the updating order matters a lot. That's why Doris allows you to decide the order, either by the order of transaction commit or that of the sequence column (something that you specify in the table in advance). Doris also supports data deletion based on the specified predicate, and that's how conditional updating is done.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=service-availability--data-reliability>Service Availability & Data Reliability<a href=#service-availability--data-reliability class=hash-link aria-label="Service Availability & Data Reliability的直接链接" title="Service Availability & Data Reliability的直接链接">​</a></h2>
<p>Apart from fast performance in queries and data ingestion, Apache Doris also provides service availability guarantee, and this is how:</p>
<p>Architecturally, Doris has two processes: frontend and backend. Both of them are easily scalable. The frontend nodes manage the clusters, metadata and handle user requests; the backend nodes execute the queries and are capable of auto data balancing and auto-restoration. It supports cluster upgrading and scaling to avoid interruption to services.</p>
<p><img decoding=async loading=lazy alt=architecture-design-of-Apache-Doris src=/zh-CN/assets/images/introduction_5-69ce643bd14fb428099a545039a4e18e.png width=1118 height=720 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=cross-cluster-replication>Cross Cluster Replication<a href=#cross-cluster-replication class=hash-link aria-label="Cross Cluster Replication的直接链接" title="Cross Cluster Replication的直接链接">​</a></h2>
<p>Enterprise users, especially those in finance or e-commerce, will need to backup their clusters or their entire data center, just in case of force majeure. So Doris 2.0 provides Cross Cluster Replication (CCR). With CCR, users can do a lot:</p>
<ul>
<li><strong>Disaster recovery</strong>: for quick restoration of data services</li>
<li><strong>Read-write separation</strong>: master cluster + slave cluster; one for reading, one for writing</li>
<li><strong>Isolated upgrade of clusters</strong>: For cluster scaling, CCR allows users to pre-create a backup cluster for a trial run so they can clear out the possible incompatibility issues and bugs.</li>
</ul>
<p>Tests show that Doris CCR can reach a data latency of minutes. In the best case, it can reach the upper speed limit of the hardware environment.</p>
<p><img decoding=async loading=lazy alt=Cross-Cluster-Replication-in-Apache-Doris src=/zh-CN/assets/images/introduction_6-0a799bae221f0af5ddfe41901743df98.png width=1280 height=297 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=multi-tenant-management>Multi-Tenant Management<a href=#multi-tenant-management class=hash-link aria-label="Multi-Tenant Management的直接链接" title="Multi-Tenant Management的直接链接">​</a></h2>
<p>Apache Doris has sophisticated Role-Based Access Control, and it allows fine-grained privilege control on the level of databases, tables, rows, and columns.</p>
<p><img decoding=async loading=lazy alt=multi-tenant-management-in-Apache-Doris src=/zh-CN/assets/images/introduction_7-97a2ac7fbb42fff86d99e46f92e184e5.png width=1095 height=720 class=img_ev3q></p>
<p>For resource isolation, Doris used to implement a hard isolation plan, which is to divide the backend nodes into resource groups, and assign the Resource Groups to different workloads. This is a hard isolation plan. It was simple and neat. But sometimes users can make the most out of their computing resource because some Resource Groups are idle.</p>
<p><img decoding=async loading=lazy alt=resource-group-in-Apache-Doris src=/zh-CN/assets/images/introduction_8-c25066059694cad6e5e4015a4e4e8976.png width=1280 height=685 class=img_ev3q></p>
<p>Thus, instead of Resource Groups, Doris 2.0 introduces Workload Group. A soft limit is set for a Workload Group about how many resources it can use. When that soft limit is hit, and meanwhile there are some idle resources available. The idle resources will be shared across the workload groups. Users can also prioritize the workload groups in terms of their access to idle resources.</p>
<p><img decoding=async loading=lazy alt=workload-group-in-Apache-Doris src=/zh-CN/assets/images/introduction_9-aeadca64cd04fe431a0120cec1fd6b20.png width=1166 height=362 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=easy-to-use>Easy to Use<a href=#easy-to-use class=hash-link aria-label="Easy to Use的直接链接" title="Easy to Use的直接链接">​</a></h2>
<p>As many capabilities as Apache Doris provides, it is also easy to use. It supports standard SQL and is compatible with MySQL protocol and most BI tools on the market.</p>
<p>Another effort that we've made to improve usability is a feature called Light Schema Change. This means if users need to add or delete some columns in a table, they just need to update the metadata in the frontend but don't have to modify all the data files. Light Schema Change can be done within milliseconds. It also allows changes to indexes and data type of columns. The combination of Light Schema Change and Flink-Doris-Connector means synchronization of upstream tables within milliseconds.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=semi-structured-data-analysis>Semi-Structured Data Analysis<a href=#semi-structured-data-analysis class=hash-link aria-label="Semi-Structured Data Analysis的直接链接" title="Semi-Structured Data Analysis的直接链接">​</a></h2>
<p>Common examples of semi-structure data include logs, observability data, and time series data. These cases require schema-free support, lower cost, and capabilities in multi-dimensional analysis and full-text search.</p>
<p>In text analysis, mostly, people use the LIKE operator, so we put a lot of effort into improving the performance of it, including pushing down the LIKE operator down to the storage layer (to reduce data scanning), and introducing the NGram Bloomfilter, the Hyperscan regex matching library, and the Volnitsky algorithm (for sub-string matching).</p>
<p><img decoding=async loading=lazy alt=LIKE-operator src=/zh-CN/assets/images/introduction_10-f4a60eac6572f70e2d4cedb5046e2b60.png width=1280 height=335 class=img_ev3q></p>
<p>We have also introduced inverted index for text tokenization. It is a power tool for fuzzy keyword search, full-text search, equivalence queries, and range queries.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=data-lakehouse>Data Lakehouse<a href=#data-lakehouse class=hash-link aria-label="Data Lakehouse的直接链接" title="Data Lakehouse的直接链接">​</a></h2>
<p>For users to build a high-performing data lakehouse and a unified query gateway, Doris can map, cache, and auto-refresh the meta data from external sources. It supports Hive Metastore and almost all open data lakehouse formats. You can connect it to relational databases, Elasticsearch, and many other sources. And it allows you to reuse your own authentication systems, like Kerberos and Apache Ranger, on the external tables.</p>
<p>Benchmark results show that Apache Doris is 3~5 times faster than Trino in queries on Hive tables. It is the joint result of a few features:</p>
<ol>
<li>Efficient query engine</li>
<li>Hot data caching mechanism</li>
<li>Compute nodes</li>
<li>Views in Doris</li>
</ol>
<p>The <a href=https://doris.apache.org/docs/dev/advanced/compute-node target=_blank rel="noopener noreferrer">Compute Nodes</a> is a newly introduced solution in version 2.0 for data lakehousing. Unlike normal backend nodes, Compute Nodes are stateless and do not store any data. Neither are they involved in data balancing during cluster scaling. Thus, they can join the cluster flexibly and easily during computation peak times.</p>
<p>Also, Doris allows you to write the computation results of external tables into Doris to form a view. This is a similar thinking to Materialized Views: to trade space for speed. After a query on external tables is executed, the results can be put in Doris internally. When there are similar queries following up, the system can directly read the results of previous queries from Doris, and that speeds things up.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=tiered-storage>Tiered Storage<a href=#tiered-storage class=hash-link aria-label="Tiered Storage的直接链接" title="Tiered Storage的直接链接">​</a></h2>
<p>The main purpose of tiered storage is to save money. <a href="https://doris.apache.org/docs/dev/advanced/cold-hot-separation?_highlight=cold" target=_blank rel="noopener noreferrer">Tiered storage </a>means to separate hot data and cold data into different storage, with hot data being the data that is frequently accessed and cold data that isn't. It allows users to put hot data in the quick but expensive disks (such as SSD and HDD), and cold data in object storage.</p>
<p><img decoding=async loading=lazy alt=tiered-storage-in-Apache-Doris src=/zh-CN/assets/images/introduction_11-a841a4fd892e69d61184e21b7c34246b.png width=1150 height=622 class=img_ev3q></p>
<p>Roughly speaking, for a data asset consisting of 80% cold data, tiered storage will reduce your storage cost by 70%.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=the-apache-doris-community>The Apache Doris Community<a href=#the-apache-doris-community class=hash-link aria-label="The Apache Doris Community的直接链接" title="The Apache Doris Community的直接链接">​</a></h2>
<p>This is an overview of Apache Doris, an open-source real-time data warehouse. It is actively evolving with an agile release schedule, and the <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">community</a> embraces any questions, ideas, and feedback.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/log-analysis-elasticsearch-vs-apache-doris/>Log analysis: Elasticsearch vs Apache Doris</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2023-09-28T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2023年9月28日</time></div></header><div class=markdown itemprop=articleBody><p>As a major part of a company's data asset, logs brings values to businesses in three aspects: system observability, cyber security, and data analysis. They are your first resort for troubleshooting, your reference for improving system security, and your data mine where you can extract information that points to business growth.</p>
<p>Logs are the sequential records of events in the computer system. If you think about how logs are generated and used, you will know what an ideal log analysis system should look like:</p>
<ul>
<li><strong>It should have schema-free support.</strong> Raw logs are unstructured free texts and basically impossible for aggregation and calculation, so you needed to turn them into structured tables (the process is called "ETL") before putting them into a database or data warehouse for analysis. If there was a schema change, lots of complicated adjustments needed to put into ETL and the structured tables. Therefore, semi-structured logs, mostly in JSON format, emerged. You can add or delete fields in these logs and the log storage system will adjust the schema accordingly.</li>
<li><strong>It should be low-cost.</strong> Logs are huge and they are generated continuously. A fairly big company produces 10~100 TBs of log data. For business or compliance reasons, it should keep the logs around for half a year or longer. That means to store a log size measured in PB, so the cost is considerable.</li>
<li><strong>It should be capable of real-time processing.</strong> Logs should be written in real time, otherwise engineers won't be able to catch the latest events in troubleshooting and security tracking. Plus, a good log system should provide full-text searching capabilities and respond to interactive queries quickly.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=the-elasticsearch-based-log-analysis-solution>The Elasticsearch-Based Log Analysis Solution<a href=#the-elasticsearch-based-log-analysis-solution class=hash-link aria-label="The Elasticsearch-Based Log Analysis Solution的直接链接" title="The Elasticsearch-Based Log Analysis Solution的直接链接">​</a></h2>
<p>A popular log processing solution within the data industry is the <strong>ELK stack: Elasticsearch, Logstash, and Kibana</strong>. The pipeline can be split into five modules:</p>
<ul>
<li><strong>Log collection</strong>: Filebeat collects local log files and writes them to a Kafka message queue.</li>
<li><strong>Log transmission</strong>: Kafka message queue gathers and caches logs.</li>
<li><strong>Log transfer</strong>: Logstash filters and transfers log data in Kafka.</li>
<li><strong>Log storage</strong>: Logstash writes logs in JSON format into Elasticsearch for storage.</li>
<li><strong>Log query</strong>: Users search for logs via Kibana visualization or send a query request via Elasticsearch DSL API.</li>
</ul>
<p><img decoding=async loading=lazy alt=ELK-Stack src=/zh-CN/assets/images/LAS_1-5855470fa53156592103937c4c267847.png width=1280 height=230 class=img_ev3q></p>
<p>The ELK stack has outstanding real-time processing capabilities, but frictions exist.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=inadequate-schema-free-support>Inadequate Schema-Free Support<a href=#inadequate-schema-free-support class=hash-link aria-label="Inadequate Schema-Free Support的直接链接" title="Inadequate Schema-Free Support的直接链接">​</a></h3>
<p>The Index Mapping in Elasticsearch defines the table scheme, which includes the field names, data types, and whether to enable index creation.</p>
<p><img decoding=async loading=lazy alt=index-mapping-in-Elasticsearch src=/zh-CN/assets/images/LAS_2-426b7a38106af2b1b439180d5ea5be47.png width=796 height=772 class=img_ev3q></p>
<p>Elasticsearch also boasts a Dynamic Mapping mechanism that automatically adds fields to the Mapping according to the input JSON data. This provides some sort of schema-free support, but it's not enough because:</p>
<ul>
<li>Dynamic Mapping often creates too many fields when processing dirty data, which interrupts the whole system.</li>
<li>The data type of fields is immutable. To ensure compatibility, users often configure "text" as the data type, but that results in much slower query performance than binary data types such as integer.</li>
<li>The index of fields is immutable, too. Users cannot add or delete indexes for a certain field, so they often create indexes for all fields to facilitate data filtering in queries. But too many indexes require extra storage space and slow down data ingestion.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=inadequate-analytic-capability>Inadequate Analytic Capability<a href=#inadequate-analytic-capability class=hash-link aria-label="Inadequate Analytic Capability的直接链接" title="Inadequate Analytic Capability的直接链接">​</a></h3>
<p>Elasticsearch has its unique Domain Specific Language (DSL), which is very different from the tech stack that most data engineers and analysts are familiar with, so there is a steep learning curve. Moreover, Elasticsearch has a relatively closed ecosystem so there might be strong resistance in integration with BI tools. Most importantly, Elastisearch only supports single-table analysis and is lagging behind the modern OLAP demands for multi-table join, sub-query, and views.</p>
<p><img decoding=async loading=lazy alt=Elasticsearch-DSL src=/zh-CN/assets/images/LAS_3-8dda5ac77b54b4a58682c977efcd3817.png width=550 height=764 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=high-cost--low-stability>High Cost & Low Stability<a href=#high-cost--low-stability class=hash-link aria-label="High Cost & Low Stability的直接链接" title="High Cost & Low Stability的直接链接">​</a></h3>
<p>Elasticsearch users have been complaining about the computation and storage costs. The root reason lies in the way Elasticsearch works.</p>
<ul>
<li><strong>Computation cost</strong>: In data writing, Elasticsearch also executes compute-intensive operations including inverted index creation, tokenization, and inverted index ranking. Under these circumstances, data is written into Elasticsearch at a speed of around 2MB/s per core. When CPU resources are tight, data writing requirements often get rejected during peak times, which further leads to higher latency.</li>
<li><strong>Storage cost</strong>: To speed up retrieval, Elasticsearch stores the forward indexes, inverted indexes, and docvalues of the original data, consuming a lot more storage space. The compression ratio of a single data copy is only 1.5:1, compared to the 5:1 in most log solutions.</li>
</ul>
<p>As data and cluster size grows, maintaining stability can be another issue:</p>
<ul>
<li>
<p><strong>During data writing peaks</strong>: Clusters are prone to overload during data writing peaks.</p>
</li>
<li>
<p><strong>During queries</strong>: Since all queries are processed in the memory, big queries can easily lead to JVM OOM.</p>
</li>
<li>
<p><strong>Slow recovery</strong>: For a cluster failure, Elasticsearch should reload indexes, which is resource-intensive, so it will take many minutes to recover. That challenges service availability guarantee.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=a-more-cost-effective-option>A More Cost-Effective Option<a href=#a-more-cost-effective-option class=hash-link aria-label="A More Cost-Effective Option的直接链接" title="A More Cost-Effective Option的直接链接">​</a></h2>
<p>Reflecting on the strengths and limitations of the Elasticsearch-based solution, the Apache Doris developers have optimized Apache Doris for log processing.</p>
<ul>
<li><strong>Increase writing throughout</strong>: The performance of Elasticsearch is bottlenecked by data parsing and inverted index creation, so we improved Apache Doris in these factors: we quickened data parsing and index creation by SIMD instructions and CPU vector instructions; then we removed those data structures unnecessary for log analysis scenarios, such as forward indexes, to simplify index creation.</li>
<li><strong>Reduce storage costs</strong>: We removed forward indexes, which represented 30% of index data. We adopted columnar storage and the ZSTD compression algorithm, and thus achieved a compression ratio of 5:1 to 10:1. Given that a large part of the historical logs are rarely accessed, we introduced tiered storage to separate hot and cold data. Logs that are older than a specified time period will be moved to object storage, which is much less expensive. This can reduce storage costs by around 70%.</li>
</ul>
<p>Benchmark tests with ES Rally, the official testing tool for Elasticsearch, showed that Apache Doris was around 5 times as fast as Elasticsearch in data writing, 2.3 times as fast in queries, and it consumed only 1/5 of the storage space that Elasticsearch used. On the test dataset of HTTP logs, it achieved a writing speed of 550 MB/s and a compression ratio of 10:1.</p>
<p><img decoding=async loading=lazy alt=Elasticsearch-VS-Apache-Doris src=/zh-CN/assets/images/LAS_4-49afc2c61d8929daeb0f51c39686e305.png width=1280 height=725 class=img_ev3q></p>
<p>The below figure show what a typical Doris-based log processing system looks like. It is more inclusive and allows for more flexible usage from data ingestion, analysis, and application:</p>
<ul>
<li><strong>Ingestion</strong>: Apache Doris supports various ingestion methods for log data. You can push logs to Doris via HTTP Output using Logstash, you can use Flink to pre-process the logs before you write them into Doris, or you can load logs from Flink or object storage to Doris via Routine Load and S3 Load.</li>
<li><strong>Analysis</strong>: You can put log data in Doris and conduct join queries across logs and other data in the data warehouse.</li>
<li><strong>Application</strong>: Apache Doris is compatible with MySQL protocol, so you can integrate a wide variety of data analytic tools and clients to Doris, such as Grafana and Tableau. You can also connect applications to Doris via JDBC and ODBC APIs. We are planning to build a Kibana-like system to visualize logs.</li>
</ul>
<p><img decoding=async loading=lazy alt=Apache-Doris-log-analysis-stack src=/zh-CN/assets/images/LAS_5-cdbff999ed0de15553dee4514a869fd4.png width=1272 height=432 class=img_ev3q></p>
<p>Moreover, Apache Doris has better scheme-free support and a more user-friendly analytic engine.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=native-support-for-semi-structured-data>Native Support for Semi-Structured Data<a href=#native-support-for-semi-structured-data class=hash-link aria-label="Native Support for Semi-Structured Data的直接链接" title="Native Support for Semi-Structured Data的直接链接">​</a></h3>
<p><strong>Firstly, we worked on the data types.</strong> We optimized the string search and regular expression matching for "text" through vectorization and brought a performance increase of 2~10 times. For JSON strings, Apache Doris will parse and store them as a more compacted and efficient binary format, which can speed up queries by 4 times. We also added a new data type for complicated data: Array Map. It can structuralize concatenated strings to allow for higher compression rate and faster queries.</p>
<p><strong>Secondly, Apache Doris supports schema evolution.</strong> This means you can adjust the schema as your business changes. You can add or delete fields and indexes, and change the data types for fields.</p>
<p>Apache Doris provides Light Schema Change capabilities, so you can add or delete fields within milliseconds:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">-- Add a column. Result will be returned in milliseconds.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> lineitem </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COLUMN</span><span class="token plain"> l_new_column </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>You can also add index only for your target fields, so you can avoid overheads from unnecessary index creation. After you add an index, by default, the system will generate the index for all incremental data, and you can specify which historical data partitions that need the index.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">-- Add inverted index. Doris will generate inverted index for all new data afterward.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> table_name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> index_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">column_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> INVERTED</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- Build index for the specified historical data partitions.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">BUILD </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> index_name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> table_name PARTITIONS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">partition_name1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> partition_name2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=sql-based-analytic-engine>SQL-Based Analytic Engine<a href=#sql-based-analytic-engine class=hash-link aria-label="SQL-Based Analytic Engine的直接链接" title="SQL-Based Analytic Engine的直接链接">​</a></h3>
<p>The SQL-based analytic engine makes sure that data engineers and analysts can smoothly grasp Apache Doris in a short time and bring their experience with SQL to this OLAP engine. Building on the rich features of SQL, users can execute data retrieval, aggregation, multi-table join, sub-query, UDF, logic views, and materialized views to serve their own needs.</p>
<p>With MySQL compatibility, Apache Doris can be integrated with most GUI and BI tools in the big data ecosystem, so users can realize more complex and diversified data analysis.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=performance-in-use-case>Performance in Use Case<a href=#performance-in-use-case class=hash-link aria-label="Performance in Use Case的直接链接" title="Performance in Use Case的直接链接">​</a></h3>
<p>A gaming company has transitioned from the ELK stack to the Apache Doris solution. Their Doris-based log system used 1/6 of the storage space that they previously needed.</p>
<p>In a cybersecurity company who built their log analysis system utilizing inverted index in Apache Doris, they supported a data writing speed of 300,000 rows per second with 1/5 of the server resources that they formerly used.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=hands-on-guide>Hands-On Guide<a href=#hands-on-guide class=hash-link aria-label="Hands-On Guide的直接链接" title="Hands-On Guide的直接链接">​</a></h2>
<p>Now let's go through the three steps of building a log analysis system with Apache Doris.</p>
<p>Before you start, <a href=https://doris.apache.org/download/ target=_blank rel="noopener noreferrer">download</a> Apache Doris 2.0 or newer versions from the website and <a href=https://doris.apache.org/docs/dev/install/standard-deployment/ target=_blank rel="noopener noreferrer">deploy</a> clusters.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=step-1-create-tables>Step 1: Create Tables<a href=#step-1-create-tables class=hash-link aria-label="Step 1: Create Tables的直接链接" title="Step 1: Create Tables的直接链接">​</a></h3>
<p>This is an example of table creation.</p>
<p>Explanations for the configurations:</p>
<ul>
<li>The DATETIMEV2 time field is specified as the Key in order to speed up queries for the latest N log records.</li>
<li>Indexes are created for the frequently accessed fields, and fields that require full-text search are specified with Parser parameters.</li>
<li>"PARTITION BY RANGE" means to partition the data by RANGE based on time fields, <a href=https://doris.apache.org/docs/dev/advanced/partition/dynamic-partition/ target=_blank rel="noopener noreferrer">Dynamic Partition</a> is enabled for auto-management.</li>
<li>"DISTRIBUTED BY RANDOM BUCKETS AUTO" means to distribute the data into buckets randomly and the system will automatically decide the number of buckets based on the cluster size and data volume.</li>
<li>"log_policy_1day" and "log_s3" means to move logs older than 1 day to S3 storage.</li>
</ul>
<div class="language-Go language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE DATABASE log_db</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">USE log_db</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE RESOURCE </span><span class="token string" style="color:rgb(255, 121, 198)">"log_s3"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"type"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"s3"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"s3.endpoint"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"your_endpoint_url"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"s3.region"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"your_region"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"s3.bucket"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"your_bucket"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"s3.root.path"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"your_path"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"s3.access_key"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"your_ak"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"s3.secret_key"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"your_sk"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE STORAGE POLICY log_policy_1day</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">PROPERTIES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"storage_resource"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"log_s3"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"cooldown_ttl"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"86400"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE TABLE log_table</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">`ts`</span><span class="token plain"> DATETIMEV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">`clientip`</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">`request`</span><span class="token plain"> TEXT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">`status`</span><span class="token plain"> INT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">`size`</span><span class="token plain"> INT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  INDEX idx_size </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">`size`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> USING INVERTED</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  INDEX idx_status </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">`status`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> USING INVERTED</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  INDEX idx_clientip </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">`clientip`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> USING INVERTED</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  INDEX idx_request </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">`request`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> USING INVERTED </span><span class="token function" style="color:rgb(80, 250, 123)">PROPERTIES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"parser"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"english"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">ENGINE </span><span class="token operator">=</span><span class="token plain"> OLAP</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">DUPLICATE </span><span class="token function" style="color:rgb(80, 250, 123)">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">`ts`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PARTITION BY </span><span class="token function" style="color:rgb(80, 250, 123)">RANGE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">`ts`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">DISTRIBUTED BY RANDOM BUCKETS AUTO</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"replication_num"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"storage_policy"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"log_policy_1day"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"deprecated_dynamic_schema"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"true"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.enable"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"true"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.time_unit"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"DAY"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.start"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"-3"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.end"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"7"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.prefix"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"p"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.buckets"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"AUTO"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"dynamic_partition.replication_num"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=step-2-ingest-the-logs>Step 2: Ingest the Logs<a href=#step-2-ingest-the-logs class=hash-link aria-label="Step 2: Ingest the Logs的直接链接" title="Step 2: Ingest the Logs的直接链接">​</a></h3>
<p>Apache Doris supports various ingestion methods. For real-time logs, we recommend the following three methods:</p>
<ul>
<li>Pull logs from Kafka message queue: Routine Load</li>
<li>Logstash: write logs into Doris via HTTP API</li>
<li>Self-defined writing program: write logs into Doris via HTTP API</li>
</ul>
<p><strong>Ingest from Kafka</strong></p>
<p>For JSON logs that are written into Kafka message queues, create <a href=https://doris.apache.org/docs/dev/data-operate/import/import-way/routine-load-manual/ target=_blank rel="noopener noreferrer">Routine Load</a> so Doris will pull data from Kafka. The following is an example. The <code>property.*</code> configurations are optional:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">-- Prepare the Kafka cluster and topic ("log_topic")</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- Create Routine Load, load data from Kafka log_topic to "log_table"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ROUTINE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LOAD</span><span class="token plain"> load_log_kafka </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> log_db</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">log_table</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COLUMNS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> clientip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"max_batch_interval"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"60"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"max_batch_rows"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"20000000"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"max_batch_size"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1073741824"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"load_to_single_tablet"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"true"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"format"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"json"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> KAFKA </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"kafka_broker_list"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"host:port"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"kafka_topic"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"log_topic"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"property.group.id"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"your_group_id"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"property.security.protocol"</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"SASL_PLAINTEXT"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">     </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"property.sasl.mechanism"</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"GSSAPI"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">     </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"property.sasl.kerberos.service.name"</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"kafka"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">     </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"property.sasl.kerberos.keytab"</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"/path/to/xxx.keytab"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">     </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"property.sasl.kerberos.principal"</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"xxx@yyy.com"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>You can check how the Routine Load runs via the <code>SHOW ROUTINE LOAD</code> command.</p>
<p><strong>Ingest via Logstash</strong></p>
<p>Configure HTTP Output for Logstash, and then data will be sent to Doris via HTTP Stream Load.</p>
<ol>
<li>Specify the batch size and batch delay in <code>logstash.yml</code> to improve data writing performance.</li>
</ol>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">pipeline.batch.size: 100000</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">pipeline.batch.delay: 10000</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=2>
<li>Add HTTP Output to the log collection configuration file <code>testlog.conf</code>, URL => the Stream Load address in Doris.</li>
</ol>
<ul>
<li>Since Logstash does not support HTTP redirection, you should use a backend address instead of a FE address.</li>
<li>Authorization in the headers is <code>http basic auth</code>. It is computed with <code>echo -n 'username:password' | base64</code>.</li>
<li>The <code>load_to_single_tablet</code> in the headers can reduce the number of small files in data ingestion.</li>
</ul>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">output {</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    http {</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       follow_redirects => true</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       keepalive => false</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       http_method => "put"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       url => "http://172.21.0.5:8640/api/logdb/logtable/_stream_load"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       headers => [</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           "format", "json",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           "strip_outer_array", "true",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           "load_to_single_tablet", "true",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           "Authorization", "Basic cm9vdDo=",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           "Expect", "100-continue"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       ]</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       format => "json_batch"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    }</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Ingest via self-defined program</strong></p>
<p>This is an example of ingesting data to Doris via HTTP Stream Load.</p>
<p>Notes:</p>
<ul>
<li>Use <code>basic auth</code> for HTTP authorization, use <code>echo -n 'username:password' | base64</code> in computation</li>
<li><code>http header "format:json"</code>: the data type is specified as JSON</li>
<li><code>http header "read_json_by_line:true"</code>: each line is a JSON record</li>
<li><code>http header "load_to_single_tablet:true"</code>: write to one tablet each time</li>
<li>For the data writing clients, we recommend a batch size of 100MB~1GB. Future versions will enable Group Commit at the server end and reduce batch size from clients.</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">curl \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">--location-trusted \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">-u username:password \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">-H "format:json" \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">-H "read_json_by_line:true" \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">-H "load_to_single_tablet:true" \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">-T logfile.json \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">http://fe_host:fe_http_port/api/log_db/log_table/_stream_load</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=step-3-execute-queries>Step 3: Execute Queries<a href=#step-3-execute-queries class=hash-link aria-label="Step 3: Execute Queries的直接链接" title="Step 3: Execute Queries的直接链接">​</a></h3>
<p>Apache Doris supports standard SQL, so you can connect to Doris via MySQL client or JDBC and then execute SQL queries.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql </span><span class="token operator">-</span><span class="token plain">h fe_host </span><span class="token operator">-</span><span class="token plain">P fe_mysql_port </span><span class="token operator">-</span><span class="token plain">u root </span><span class="token operator">-</span><span class="token plain">Dlog_db</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>A few common queries in log analysis:</strong></p>
<ul>
<li>Check the latest 10 records.</li>
</ul>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> log_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> ts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ul>
<li>Check the latest 10 records of Client IP "8.8.8.8".</li>
</ul>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> log_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> clientip </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'8.8.8.8'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> ts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ul>
<li>Retrieve the latest 10 records with "error" or "404" in the "request" field. <strong>MATCH_ANY</strong> is a SQL syntax keyword for full-text search in Doris. It means to find the records that include any one of the specified keywords.</li>
</ul>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> log_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> request MATCH_ANY </span><span class="token string" style="color:rgb(255, 121, 198)">'error 404'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> ts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ul>
<li>Retrieve the latest 10 records with "image" and "faq" in the "request" field. <strong>MATCH_ALL</strong> is also a SQL syntax keyword for full-text search in Doris. It means to find the records that include all of the specified keywords.</li>
</ul>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> log_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> request MATCH_ALL </span><span class="token string" style="color:rgb(255, 121, 198)">'image faq'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> ts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label=Conclusion的直接链接 title=Conclusion的直接链接>​</a></h2>
<p>If you are looking for an efficient log analytic solution, Apache Doris is friendly to anyone equipped with SQL knowledge; if you find friction with the ELK stack, try Apache Doris provides better schema-free support, enables faster data writing and queries, and brings much less storage burden.</p>
<p>But we won't stop here. We are going to provide more features to facilitate log analysis. We plan to add more complicated data types to inverted index, and support BKD index to make Apache Doris a fit for geo data analysis. We also plan to expand capabilities in semi-structured data analysis, such as working on the complex data types (Array, Map, Struct, JSON) and high-performance string matching algorithm. And we welcome any <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">user feedback and development advice</a>.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Auto-Synchronization-of-an-Entire-MySQL-Database-for-Data-Analysis/>Auto synchronization of an entire MySQL database for data analysis</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">velodb.io · VeloDB Engineering Team</span></span><time datetime=2023-08-16T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2023年8月16日</time></div></header><div class=markdown itemprop=articleBody><p>Flink-Doris-Connector 1.4.0 allows users to ingest a whole database (<strong>MySQL</strong> or <strong>Oracle</strong>) that contains thousands of tables into <a href=https://doris.apache.org/zh-CN/ target=_blank rel="noopener noreferrer">Apache Doris</a>, a real-time analytic database, <strong>in one step</strong>.</p>
<p>With built-in Flink CDC, the Connector can directly synchronize the table schema and data from the upstream source to Apache Doris, which means users no longer have to write a DataStream program or pre-create mapping tables in Doris.</p>
<p>When a Flink job starts, the Connector automatically checks for data equivalence between the source database and Apache Doris. If the data source contains tables which do not exist in Doris, the Connector will automatically create those same tables in Doris, and utilizes the side outputs of Flink to facilitate the ingestion of multiple tables at once; if there is a schema change in the source, it will automatically obtain the DDL statement and make the same schema change in Doris.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=quick-start>Quick Start<a href=#quick-start class=hash-link aria-label="Quick Start的直接链接" title="Quick Start的直接链接">​</a></h2>
<p>Download Flink Doris Connector: <a href=https://doris.apache.org/download/ target=_blank rel="noopener noreferrer">https://doris.apache.org/download/</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=how-to-use-it>How to Use It<a href=#how-to-use-it class=hash-link aria-label="How to Use It的直接链接" title="How to Use It的直接链接">​</a></h2>
<p>For example, to ingest a whole MySQL database <code>mysql_db</code> into Doris (the MySQL table names start with <code>tbl</code> or <code>test</code>), simply execute the following command (no need to create the tables in Doris in advance):</p>
<div class="language-Shell language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">&lt;FLINK_HOME>/bin/flink run \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    -Dexecution.checkpointing.interval=10s \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    -Dparallelism.default=1 \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    -c org.apache.doris.flink.tools.cdc.CdcTools \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lib/flink-doris-connector-1.16-1.4.0.jar \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    mysql-sync-database \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --database test_db \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --mysql-conf hostname=127.0.0.1 \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --mysql-conf username=root \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --mysql-conf password=123456 \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --mysql-conf database-name=mysql_db \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --including-tables "tbl|test.*" \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --sink-conf fenodes=127.0.0.1:8030 \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --sink-conf username=root \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --sink-conf password=123456 \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --sink-conf jdbc-url=jdbc:mysql://127.0.0.1:9030 \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --sink-conf sink.label-prefix=label1 \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    --table-conf replication_num=1 </span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>To ingest an Oracle database: please refer to the <a href=https://github.com/apache/doris-flink-connector/pull/156 target=_blank rel="noopener noreferrer">example code</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=how-it-performs>How It Performs<a href=#how-it-performs class=hash-link aria-label="How It Performs的直接链接" title="How It Performs的直接链接">​</a></h2>
<p>When it comes to synchronizing a whole database (containing hundreds or even thousands of tables, active or inactive), most users want it to be done within seconds. So we tested the Connector to see if it came up to scratch:</p>
<ul>
<li>1000 MySQL tables, each having 100 fields. All tables were active (which meant they were continuously updated and each data writing involved over a hundred rows)</li>
<li>Flink job checkpoint: 10s</li>
</ul>
<p>Under pressure test, the system showed high stability, with key metrics as follows:</p>
<p><img decoding=async loading=lazy alt=Flink-Doris-Connector src=/zh-CN/assets/images/FDC_1-ce2b3c35d3126c743a9b9df1105dd1ce.png width=1280 height=243 class=img_ev3q></p>
<p><img decoding=async loading=lazy alt=Flink-CDC src=/zh-CN/assets/images/FDC_2-18b4e1b3346d90e6430b992d74e9a64f.png width=1280 height=487 class=img_ev3q></p>
<p><img decoding=async loading=lazy alt=Doris-Cluster-Compaction-Score src=/zh-CN/assets/images/FDC_3-5e973914e448c11df5e3e408823f2ded.png width=1280 height=306 class=img_ev3q></p>
<p>According to feedback from early adopters, the Connector has also delivered high performance and system stability in 10,000-table database synchronization in their production environment. This proves that the combination of Apache Doris and Flink CDC is capable of large-scale data synchronization with high efficiency and reliability.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=how-it-benefits-data-engineers>How It Benefits Data Engineers<a href=#how-it-benefits-data-engineers class=hash-link aria-label="How It Benefits Data Engineers的直接链接" title="How It Benefits Data Engineers的直接链接">​</a></h2>
<p>Engineers no longer have to worry about table creation or table schema maintenance, saving them days of tedious and error-prone work. Previously in Flink CDC, you need to create a Flink job for each table and build a log parsing link at the source end, but now with whole-database ingestion, resource consumption in the source database is largely reduced. It is also a unified solution for incremental update and full update.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=other-features>Other Features<a href=#other-features class=hash-link aria-label="Other Features的直接链接" title="Other Features的直接链接">​</a></h2>
<p><strong>1. Joining dimension table and fact table</strong></p>
<p>The common practice is to put dimension tables in Doris and run join queries via the real-time stream of Flink. Based on the <a href=https://nightlies.apache.org/flink/flink-docs-release-1.14/docs/dev/datastream/operators/asyncio/ target=_blank rel="noopener noreferrer">Async I/O of Flink</a>, Flink-Doris-Connector 1.4.0 implements asynchronous Lookup Join, so the Flink real-time stream won't be blocked due to queries. Also, the Connector allows you to combine multiple queries into one big query, and send it to Doris at once for processing. This improves the efficiency and throughput of such join queries.</p>
<p><strong>2. Thrift</strong> <strong>SDK</strong></p>
<p>We introduced Thrift-Service SDK into the Connector so users no longer have to use Thrift plug-ins or configure a Thrift environment in compilation. This makes the compilation process much simpler.</p>
<p><strong>3. On-Demand Stream Load</strong></p>
<p>During data synchronization, when there is no new data ingestion, no Stream Load requests will be issued. This avoids unnecessary consumption of cluster resources.</p>
<p><strong>4. Polling of Backend Nodes</strong></p>
<p>For data ingestion, Doris calls a frontend node to obtain a list of the backend nodes, and randomly chooses one to launch an ingestion request. That backend node will be the Coordinator. Flink-Doris-Connector 1.4.0 allows users to enable the polling mechanism, which is to have a different backend node to be the Coordinator at each Flink checkpoint to avoid too much pressure on a single backend node for a long time.</p>
<p><strong>5. Support for More Data Types</strong></p>
<p>In addition to the common data types, Flink-Doris-Connector 1.4.0 supports DecimalV3/DateV2/DateTimev2/Array/JSON in Doris.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=example-usage>Example Usage<a href=#example-usage class=hash-link aria-label="Example Usage的直接链接" title="Example Usage的直接链接">​</a></h2>
<p><strong>Read from Apache Doris:</strong></p>
<p>You can read data from Doris via DataStream or FlinkSQL (bounded stream). Predicate pushdown is supported.</p>
<div class="language-Java language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token constant" style="color:rgb(189, 147, 249)">CREATE</span><span class="token plain"> </span><span class="token class-name">TABLE</span><span class="token plain"> flink_doris_source </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    name </span><span class="token constant" style="color:rgb(189, 147, 249)">STRING</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    age </span><span class="token constant" style="color:rgb(189, 147, 249)">INT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    score </span><span class="token function" style="color:rgb(80, 250, 123)">DECIMAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token constant" style="color:rgb(189, 147, 249)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'connector</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">doris'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'fenodes</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8030</span><span class="token plain">'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'table</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">identifier</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">database</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">table'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'username</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">root'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'password</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">password'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'doris</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">age</span><span class="token operator">=</span><span class="token number">18</span><span class="token plain">'</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token class-name">FROM</span><span class="token plain"> flink_doris_source</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Join dimension table and fact table</strong>:</p>
<div class="language-Java language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token constant" style="color:rgb(189, 147, 249)">CREATE</span><span class="token plain"> </span><span class="token class-name">TABLE</span><span class="token plain"> fact_table </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `id` </span><span class="token constant" style="color:rgb(189, 147, 249)">BIGINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `name` </span><span class="token constant" style="color:rgb(189, 147, 249)">STRING</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `city` </span><span class="token constant" style="color:rgb(189, 147, 249)">STRING</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `process_time` as </span><span class="token function" style="color:rgb(80, 250, 123)">proctime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  'connector</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">kafka'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">create table </span><span class="token function" style="color:rgb(80, 250, 123)">dim_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `city` </span><span class="token constant" style="color:rgb(189, 147, 249)">STRING</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `level` </span><span class="token constant" style="color:rgb(189, 147, 249)">INT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `province` </span><span class="token constant" style="color:rgb(189, 147, 249)">STRING</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `country` </span><span class="token constant" style="color:rgb(189, 147, 249)">STRING</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  'connector</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">doris'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  'fenodes</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8030</span><span class="token plain">'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  'jdbc</span><span class="token operator">-</span><span class="token plain">url</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">jdbc</span><span class="token operator">:</span><span class="token plain">mysql</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">9030</span><span class="token plain">'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  'lookup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">jdbc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">async</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token boolean">true</span><span class="token plain">'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  'table</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">identifier</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">dim</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dim_city'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  'username</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">root'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  'password</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">'</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">SELECT</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">province</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">country</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">level </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">FROM</span><span class="token plain"> fact_table a</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">LEFT</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">JOIN</span><span class="token plain"> dim_city </span><span class="token constant" style="color:rgb(189, 147, 249)">FOR</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">SYSTEM_TIME</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">AS</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">OF</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">process_time </span><span class="token constant" style="color:rgb(189, 147, 249)">AS</span><span class="token plain"> c</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">ON</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">city </span><span class="token operator">=</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">city</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Write to Apache Doris</strong>:</p>
<div class="language-Java language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token constant" style="color:rgb(189, 147, 249)">CREATE</span><span class="token plain"> </span><span class="token class-name">TABLE</span><span class="token plain"> doris_sink </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    name </span><span class="token constant" style="color:rgb(189, 147, 249)">STRING</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    age </span><span class="token constant" style="color:rgb(189, 147, 249)">INT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    score </span><span class="token function" style="color:rgb(80, 250, 123)">DECIMAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token constant" style="color:rgb(189, 147, 249)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'connector</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">doris'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'fenodes</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8030</span><span class="token plain">'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'table</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">identifier</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">database</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">table'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'username</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">root'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'password</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'sink</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">label</span><span class="token operator">-</span><span class="token plain">prefix</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">doris_label'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">//json write in</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'sink</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">format</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token plain">json'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      'sink</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">read_json_by_line</span><span class="token char" style="color:rgb(255, 121, 198)">' = '</span><span class="token boolean">true</span><span class="token plain">'</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If you've got any questions, find Apache Doris developers on <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Slack</a>.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Is-Your-Latest-Data-Really-the-Latest-Check-the-Data-Update-Mechanism-of-Your-Database/>Is your latest data really the latest? check the data update mechanism of your database</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2023-07-24T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2023年7月24日</time></div></header><div class=markdown itemprop=articleBody><p>In databases, data update is to add, delete, or modify data. Timely data update is an important part of high quality data services.</p>
<p>Technically speaking, there are two types of data updates: you either update a whole row (<strong>Row Update</strong>) or just update part of the columns (<strong>Partial Column Update</strong>). Many databases supports both of them, but in different ways. This post is about one of them, which is simple in execution and efficient in data quality guarantee.</p>
<p>As an open source analytic database, Apache Doris supports both Row Update and Partial Column Update with one data model: the <a href=https://doris.apache.org/docs/dev/data-table/data-model#unique-model target=_blank rel="noopener noreferrer"><strong>Unique Key Model</strong></a>. It is where you put data that doesn't need to be aggregated. In the Unique Key Model, you can specify one column or the combination of several columns as the Unique Key (a.k.a. Primary Key). For one Unique Key, there will always be one row of data: the newly ingested data record replaces the old. That's how data updates work.</p>
<p>The idea is straightforward, but in real-life implementation, it happens that the latest data does not arrive the last or doesn't even get written at all, so I'm going to show you how Apache Doris implements data update and avoids messups with its Unique Key Model.</p>
<p><img decoding=async loading=lazy alt=data-update src=/zh-CN/assets/images/Dataupdate_1-f213a24dcaaac700ff9f45906687c4a9.png width=1280 height=705 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=row-update>Row Update<a href=#row-update class=hash-link aria-label="Row Update的直接链接" title="Row Update的直接链接">​</a></h2>
<p>For data writing to the Unique Key Model, Apache Doris adopts the <strong>Upsert</strong> semantics, which means <strong>Update or Insert</strong>. If the new data record includes a Unique Key that already exists in the table, the new record will replace the old record; if it includes a brand new Unique Key, the new record will be inserted into the table as a whole. The Upsert operation can provide high throughput and guarantee data reliability.</p>
<p><strong>Example</strong>:</p>
<p>In the following table, the Unique Key is the combination of three columns: <code>user_id, date, group_id</code>.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token plain"> test_table</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+--------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> Field       </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Type</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">Null</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Key</span><span class="token plain">   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Default</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Extra </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+--------------+------+-------+---------+-------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> user_id     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain">        </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> group_id    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> modify_date </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token plain">         </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> keyword     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">128</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Yes  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> NONE  </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">-------------+--------------+------+-------+---------+-------+</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Execute <code>insert into</code> to write in a data record. Since the table was empty, by the Upsert semantics, it means to add a new row to the table.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> test_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"2023-04-28"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"2023-04-28"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"foo"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.05</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">'label'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'insert_2fb45d1833db4348_b612b8791c97b467'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'status'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'VISIBLE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'txnId'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'343'</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> test_table</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+------------+----------+-------------+---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> user_id </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> group_id </span><span class="token operator">|</span><span class="token plain"> modify_date </span><span class="token operator">|</span><span class="token plain"> keyword </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+------------+----------+-------------+---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">28</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">28</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> foo     </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+------------+----------+-------------+---------+</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Then insert two more data records, one of which has the same Unique Key with the previously inserted row. Now, by the Upsert semantics, it means to replace the old row with the new one of the same Unique Key, and insert the record of the new Unique Key.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> test_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"2023-04-28"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"2023-04-29"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"foo"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"2023-04-29"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"2023-04-29"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"bar"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.04</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">'label'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'insert_7dd3954468aa4ac1_a63a3852e3573b4c'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'status'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'VISIBLE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'txnId'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'344'</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> test_table</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+------------+----------+-------------+---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> user_id </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> group_id </span><span class="token operator">|</span><span class="token plain"> modify_date </span><span class="token operator">|</span><span class="token plain"> keyword </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+------------+----------+-------------+---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">29</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">29</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> bar     </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">28</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">29</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> foo     </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+------------+----------+-------------+---------+</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=partial-column-update>Partial Column Update<a href=#partial-column-update class=hash-link aria-label="Partial Column Update的直接链接" title="Partial Column Update的直接链接">​</a></h2>
<p>Besides row update, under many circumstances, data analysts require the convenience of partial column update. For example, in user portraits, they would like to update certain dimensions of their users in real time. Or, if they need to maintain a flat table that is made of data from various source tables, they will prefer partial column update than complicated join operations as a way of data update.</p>
<p>Apache Doris supports partial column update with the UPDATE statement. It filters the rows that need to be modified, read them, changes a few values, and write the rows back to the table.</p>
<p><strong>Example</strong>:</p>
<p>Suppose that there is an order table, in which the Order ID is the Unique Key.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+--------------+-----------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> order_id </span><span class="token operator">|</span><span class="token plain"> order_amount </span><span class="token operator">|</span><span class="token plain"> order_status    </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+--------------+-----------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">        </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">100</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Payment Pending </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+--------------+-----------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>When the buyer completes the payment, Apache Doris should change the order status of Order ID 1 from "Payment Pending" to "Delivery Pending". This is when the Update command comes into play.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UPDATE</span><span class="token plain"> test_order </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SET</span><span class="token plain"> order_status </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Delivery Pending'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> order_id </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.11</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">'label'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'update_20ae22daf0354fe0-b5aceeaaddc666c5'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'status'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'VISIBLE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'txnId'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'33'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'queryId'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'20ae22daf0354fe0-b5aceeaaddc666c5'</span><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This is the table after updating.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+--------------+------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> order_id </span><span class="token operator">|</span><span class="token plain"> order_amount </span><span class="token operator">|</span><span class="token plain"> order_status     </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+--------------+------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">        </span><span class="token operator">|</span><span class="token plain">          </span><span class="token number">100</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Delivery Pending </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">----------+--------------+------------------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The execution of the Update command consists of three steps in the system:</p>
<ul>
<li>Step One: Read the row where Order ID = 1 (1, 100, 'Payment Pending')</li>
<li>Step Two: Modify the order status from "Payment Pending" to "Delivery Pending" (1, 100, 'Delivery Pending')</li>
<li>Step Three: Insert the new row into the table</li>
</ul>
<p><img decoding=async loading=lazy alt=partial-column-update-1 src=/zh-CN/assets/images/Dataupdate_2-9a653bfdd528301c5b147351f157da3a.png width=1484 height=296 class=img_ev3q></p>
<p>The table is in the Unique Key Model, which means for rows of the same Unique Key, only the last inserted one will be reserved, so this is what the table will finally look like:</p>
<p><img decoding=async loading=lazy alt=partial-column-update-2 src=/zh-CN/assets/images/Dataupdate_3-0af75c350522fdc2c1074db4b2235711.png width=1500 height=260 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=order-of-data-updates>Order of Data Updates<a href=#order-of-data-updates class=hash-link aria-label="Order of Data Updates的直接链接" title="Order of Data Updates的直接链接">​</a></h2>
<p>So far this sounds simple, but in the actual world, data update might fail due to reasons such as data format errors, and thus mess up the data writing order. The order of data update matters more than you imagine. For example, in financial transactions, messed-up data writing order might lead to transaction data losses, errors, or duplication, which further leads to bigger problems.</p>
<p>Apache Doris provides two options for users to guarantee that their data is updated in the correct order:</p>
<p><strong>1. Update by the order of transaction commit</strong></p>
<p>In Apache Doris, each data ingestion task is a transaction. Each successfully ingested task will be given a data version and the number of data versions is strictly increasing. If the ingestion fails, the transaction will be rolled back, and no new data version will be generated.</p>
<p>By default, the Upsert semantics follows the order of the transaction commits. If there are two data ingestion tasks involving the same Unique Key, the first task generating data version 2 and the second, data version 3, then according to transaction commit order, data version 3 will replace data version 2.</p>
<p><strong>2. Update by the user-defined order</strong></p>
<p>In real-time data analytics, data updates often happen in high concurrency. It is possible that there are multiple data ingestion tasks updating the same row, but these tasks are committed in unknown order, so the last saved update remains unknown, too.</p>
<p>For example, these are two data updates, with "2023-04-30" and "2023-05-01" as the <code>modify_data</code>, respectively. If they are written into the system concurrently, but the "2023-05-01" one is successfully committed first and the other later, then the "2023-04-30" record will be saved due to its higher data version number, but we know it is not the latest one.</p>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql> insert into test_table values (2, "2023-04-29", 2, "2023-05-01", "bbb");</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK, 1 row affected (0.04 sec)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{'label':'insert_e2daf8cea5524ee1_94e5c87e7bb74d67', 'status':'VISIBLE', 'txnId':'345'}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql> insert into test_table values (2, "2023-04-29", 2, "2023-04-30", "aaa");</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK, 1 row affected (0.03 sec)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{'label':'insert_ef906f685a7049d0_b135b6cfee49fb98', 'status':'VISIBLE', 'txnId':'346'}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql> select * from test_table;</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">| user_id | date       | group_id | modify_date | keyword |</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">|       2 | 2023-04-29 |        2 | 2023-04-30 | aaa     |</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">|       1 | 2023-04-28 |        2 | 2023-04-29  | foo     |</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">+---------+------------+----------+-------------+---------+</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>That's why in high-concurrency scenarios, Apache Doris allows data update in user-defined order. Users can designate a column to the Sequence Column. In this way, the system will identity save the latest data version based on value in the Sequence Column.</p>
<p><strong>Example:</strong></p>
<p>You can designate a Sequence Column by specifying the <code>function_column.sequence_col</code> property upon table creation.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> test</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">test_table</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    user_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bigint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    group_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bigint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    modify_date </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    keyword </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">128</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> group_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">32</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"function_column.sequence_col"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'modify_date'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"replication_num"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"in_memory"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"false"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Then check and see, the data record with the highest value in the Sequence Column will be saved:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> test_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"2023-04-29"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"2023-05-01"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"bbb"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.03</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">'label'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'insert_3aac37ae95bc4b5d_b3839b49a4d1ad6f'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'status'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'VISIBLE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'txnId'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'349'</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> test_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"2023-04-29"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"2023-04-30"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"aaa"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.03</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><span class="token string" style="color:rgb(255, 121, 198)">'label'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'insert_419d4008768d45f3_a6912e584cf1b500'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'status'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'VISIBLE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'txnId'</span><span class="token plain">:</span><span class="token string" style="color:rgb(255, 121, 198)">'350'</span><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> test_table</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+------------+----------+-------------+---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> user_id </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain">       </span><span class="token operator">|</span><span class="token plain"> group_id </span><span class="token operator">|</span><span class="token plain"> modify_date </span><span class="token operator">|</span><span class="token plain"> keyword </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+------------+----------+-------------+---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">29</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> bbb     </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">28</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">29</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> foo     </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+------------+----------+-------------+---------+</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label=Conclusion的直接链接 title=Conclusion的直接链接>​</a></h2>
<p>Congratulations. Now you've gained an overview of how data updates are implemented in Apache Doris. With this knowledge, you can basically guarantee efficiency and accuracy of data updating. But wait, there is so much more about that. As Apache Doris 2.0 is going to provide more powerful Partial Column Update capabilities, with improved execution of the Update statement and the support for more complicated multi-table Join queries, I will show you how to take advantage of them in details in my follow-up writings. <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">We</a> are constantly updating our data updates!</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Tiered-Storage-for-Hot-and-Cold-Data-What-Why-and-How/>Tiered storage for hot and cold data: what, why, and how?</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2023-06-23T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2023年6月23日</time></div></header><div class=markdown itemprop=articleBody><p>Apparently tiered storage is hot now. But first of all:</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=what-is-hotcold-data>What is Hot/Cold Data?<a href=#what-is-hotcold-data class=hash-link aria-label="What is Hot/Cold Data?的直接链接" title="What is Hot/Cold Data?的直接链接">​</a></h2>
<p>In simple terms, hot data is the frequently accessed data, while cold data is the one you seldom visit but still need. Normally in data analytics, data is "hot" when it is new, and gets "colder" and "colder" as time goes by.</p>
<p>For example, orders of the past six months are "hot" and logs from years ago are "cold". But no matter how cold the logs are, you still need them to be somewhere you can find.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=why-separate-hot-and-cold-data>Why Separate Hot and Cold Data?<a href=#why-separate-hot-and-cold-data class=hash-link aria-label="Why Separate Hot and Cold Data?的直接链接" title="Why Separate Hot and Cold Data?的直接链接">​</a></h2>
<p>Tiered storage is an idea often seen in real life: You put your favorite book on your bedside table, your Christmas ornament in the attic, and your childhood art project in the garage or a cheap self-storage space on the other side of town. The purpose is a tidy and efficient life.</p>
<p>Similarly, companies separate hot and cold data for more efficient computation and more cost-effective storage, because storage that allows quick read/write is always expensive, like SSD. On the other hand, HDD is cheaper but slower. So it is more sensible to put hot data on SSD and cold data on HDD. If you are looking for an even lower-cost option, you can go for object storage.</p>
<p>In data analytics, tiered storage is implemented by a tiered storage mechanism in the database. For example, Apache Doris supports three-tiered storage: SSD, HDD, and object storage. For newly ingested data, after a specified cooldown period, it will turn from hot data into cold data and be moved to object storage. In addition, object storage only preserves one copy of data, which further cuts down storage costs and the relevant computation/network overheads.</p>
<p><img decoding=async loading=lazy alt=tiered-storage src=/zh-CN/assets/images/HCDS_1-4bae127a675df686b358d72a242fc193.png width=1528 height=722 class=img_ev3q></p>
<p>How much can you save by tiered storage? Here is some math.</p>
<p>In public cloud services, cloud disks generally cost 5~10 times as much as object storage. If 80% of your data asset is cold data and you put it in object storage instead of cloud disks, you can expect a cost reduction of around 70%.</p>
<p>Let the percentage of cold data be "rate", the price of object storage be "OS", and the price of cloud disk be "CloudDisk", this is how much you can save by tiered storage instead of putting all your data on cloud disks:</p>
<p><img decoding=async loading=lazy alt=cost-calculation-of-tiered-storage src=/zh-CN/assets/images/HCDS_2-c03620863295956acc180ad3a590bcf6.png width=1532 height=226 class=img_ev3q></p>
<p>Now let's put real-world numbers in this formula:</p>
<p>AWS pricing, US East (Ohio):</p>
<ul>
<li><strong>S3 Standard Storage</strong>: 23 USD per TB per month</li>
<li><strong>Throughput Optimized HDD (st 1)</strong>: 102 USD per TB per month</li>
<li><strong>General Purpose SSD (gp2)</strong>: 158 USD per TB per month</li>
</ul>
<p><img decoding=async loading=lazy alt=cost-reduction-by-tiered-storage src=/zh-CN/assets/images/HCDS_3-631232bc5ad459445ffd5c51313a23d2.png width=1280 height=590 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=how-is-tiered-storage-implemented>How Is Tiered Storage Implemented?<a href=#how-is-tiered-storage-implemented class=hash-link aria-label="How Is Tiered Storage Implemented?的直接链接" title="How Is Tiered Storage Implemented?的直接链接">​</a></h2>
<p>Till now, hot-cold separation sounds nice, but the biggest concern is: how can we implement it without compromising query performance? This can be broken down to three questions:</p>
<ul>
<li>How to enable quick reading of cold data?</li>
<li>How to ensure high availability of data?</li>
<li>How to reduce I/O and CPU overheads?</li>
</ul>
<p>In what follows, I will show you how Apache Doris addresses them one by one.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=quick-reading-of-cold-data>Quick Reading of Cold Data<a href=#quick-reading-of-cold-data class=hash-link aria-label="Quick Reading of Cold Data的直接链接" title="Quick Reading of Cold Data的直接链接">​</a></h3>
<p>Accessing cold data from object storage will indeed be slow. One solution is to cache cold data in local disks for use in queries. In Apache Doris 2.0, when a query requests cold data, only the first-time access will entail a full network I/O operation from object storage. Subsequent queries will be able to read data directly from local cache.</p>
<p>The granularity of caching matters, too. A coarse granularity might lead to a waste of cache space, but a fine granularity could be the reason for low I/O efficiency. Apache Doris bases its caching on data blocks. It downloads cold data blocks from object storage onto local Block Cache. This is the "pre-heating" process. With cold data fully pre-heated, queries on tables with tiered storage will be basically as fast as those on tablets without. We drew this conclusion from test results on Apache Doris:</p>
<p><img decoding=async loading=lazy alt=query-performance-with-tiered-storage src=/zh-CN/assets/images/HCDS_4-87151098d2bd6aa0e665ba9766dc8e19.png width=1280 height=854 class=img_ev3q></p>
<ul>
<li><em><strong>Test Data</strong></em>*: SSB SF100 dataset*</li>
<li><em><strong>Configuration</strong></em>*: 3 × 16C 64G, a cluster of 1 frontend and 3 backends*</li>
</ul>
<p>P.S. Block Cache adopts the LRU algorithm, so the more frequently accessed data will stay in Block Cache for longer.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=high-availability-of-data>High Availability of Data<a href=#high-availability-of-data class=hash-link aria-label="High Availability of Data的直接链接" title="High Availability of Data的直接链接">​</a></h3>
<p>In object storage, only one copy of cold data is preserved. Within Apache Doris, hot data and metadata are put in the backend nodes, and there are multiple replicas of them across different backend nodes in order to ensure high data availability. These replicas are called "local replicas". The metadata of cold data is synchronized to all local replicas, so that Doris can ensure high availability of cold data without using too much storage space.</p>
<p>Implementation-wise, the Doris frontend picks a local replica as the Leader. Updates to the Leader will be synchronized to all other local replicas via a regular report mechanism. Also, as the Leader uploads data to object storage, the relevant metadata will be updated to other local replicas, too.</p>
<p><img decoding=async loading=lazy alt=data-availability-with-tiered-storage src=/zh-CN/assets/images/HCDS_5-91d506621f633b43cc8fdc41fb7c9aaa.png width=1280 height=1041 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=reduced-io-and-cpu-overhead>Reduced I/O and CPU Overhead<a href=#reduced-io-and-cpu-overhead class=hash-link aria-label="Reduced I/O and CPU Overhead的直接链接" title="Reduced I/O and CPU Overhead的直接链接">​</a></h3>
<p>This is realized by cold data <a href=https://medium.com/gitconnected/understanding-data-compaction-in-3-minutes-d2b5a1f7446f target=_blank rel="noopener noreferrer">compaction</a>. Some scenarios require large-scale update of historical data. In this case, part of the cold data in object storage should be deleted. Apache Doris 2.0 supports cold data compaction, which ensures that the updated cold data will be reorganized and compacted, so that it will take up storage space.</p>
<p>A thread in Doris backend will regularly pick N tablets from the cold data and start compaction. Every tablet has a CooldownReplica and only the CooldownReplica will execute cold data compaction for the tablet. Every time 5MB of data is compacted, it will be uploaded to object storage to clear up space locally. Once the compaction is done, the CooldownReplica will update the new metadata to object storage. Other replicas only need to synchronize the metadata from object storage. This is how I/O and CPU overheads are reduced.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=tutorial>Tutorial<a href=#tutorial class=hash-link aria-label=Tutorial的直接链接 title=Tutorial的直接链接>​</a></h2>
<p>Separating tiered storage in storage is a huge cost saver and there have been ways to ensure the same fast query performance. Executing hot-cold data separation is a simple 6-step process, so you can find out how it works yourself:</p>
<p>To begin with, you need <strong>an object storage bucket</strong> and the relevant <strong>Access Key (AK)</strong> and <strong>Secret Access Key (SK)</strong>.</p>
<p>Then you can start cold/hot data separation by following these six steps.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-create-resource>1. Create Resource<a href=#1-create-resource class=hash-link aria-label="1. Create Resource的直接链接" title="1. Create Resource的直接链接">​</a></h3>
<p>You can create a resource using the object storage bucket with the AK and  SK. Apache Doris supports object storage on various cloud service  providers including AWS, Azure, and Alibaba Cloud.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE RESOURCE IF NOT EXISTS "${resource_name}"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        PROPERTIES(</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "type"="s3",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "s3.endpoint" = "${S3Endpoint}",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "s3.region" = "${S3Region}",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "s3.root.path" = "path/to/root",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "s3.access_key" = "${S3AK}",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "s3.secret_key" = "${S3SK}",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "s3.connection.maximum" = "50",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "s3.connection.request.timeout" = "3000",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "s3.connection.timeout" = "1000",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "s3.bucket" = "${S3BucketName}"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        );</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-create-storage-policy>2. Create Storage Policy<a href=#2-create-storage-policy class=hash-link aria-label="2. Create Storage Policy的直接链接" title="2. Create Storage Policy的直接链接">​</a></h3>
<p>With the Storage Policy, you can specify the cooling-down period of data  (including absolute cooling-down period and relative cooling-down  period).</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE STORAGE POLICY testPolicy</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES(</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  "storage_resource" = "remote_s3",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  "cooldown_ttl" = "1d"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">);</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>In the above snippet, the Storage Policy is named <code>testPolicy</code>, and data will start to cool down one day after it is ingested. The cold data will be moved under the <code>root path</code> of the object storage <code>remote_s3</code>. Apart from setting the TTL, you can also specify the timepoint when the cooling down starts.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE STORAGE POLICY testPolicyForTTlDatatime</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES(</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  "storage_resource" = "remote_s3",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  "cooldown_datetime" = "2023-06-07 21:00:00"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">);</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3-specify-storage-policy-for-a-tablepartition>3. Specify Storage Policy for a Table/Partition<a href=#3-specify-storage-policy-for-a-tablepartition class=hash-link aria-label="3. Specify Storage Policy for a Table/Partition的直接链接" title="3. Specify Storage Policy for a Table/Partition的直接链接">​</a></h3>
<p>With an established Resource and a Storage Policy, you can set a Storage Policy for a data table or a specific data partition.</p>
<p>The following snippet uses the lineitem table in the TPC-H dataset as an  example. To set a Storage Policy for the whole table, specify the  PROPERTIES as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE TABLE IF NOT EXISTS lineitem1 (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_ORDERKEY    INTEGER NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_PARTKEY     INTEGER NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_SUPPKEY     INTEGER NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_LINENUMBER  INTEGER NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_QUANTITY    DECIMAL(15,2) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_EXTENDEDPRICE  DECIMAL(15,2) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_DISCOUNT    DECIMAL(15,2) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_TAX         DECIMAL(15,2) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_RETURNFLAG  CHAR(1) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_LINESTATUS  CHAR(1) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_SHIPDATE    DATEV2 NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_COMMITDATE  DATEV2 NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_RECEIPTDATE DATEV2 NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_SHIPINSTRUCT CHAR(25) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_SHIPMODE     CHAR(10) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_COMMENT      VARCHAR(44) NOT NULL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            )</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            DUPLICATE KEY(L_ORDERKEY, L_PARTKEY, L_SUPPKEY, L_LINENUMBER)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            PARTITION BY RANGE(`L_SHIPDATE`)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                PARTITION `p202301` VALUES LESS THAN ("2017-02-01"),</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                PARTITION `p202302` VALUES LESS THAN ("2017-03-01")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            )</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            DISTRIBUTED BY HASH(L_ORDERKEY) BUCKETS 3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            PROPERTIES (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "replication_num" = "3",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "storage_policy" = "${policy_name}"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            )</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>You can check the Storage Policy of a tablet via the <code>show tablets</code> command. If the <code>CooldownReplicaId</code> is anything rather than <code>-1</code> and the <code>CooldownMetaId</code> is not null, that means the current tablet has been specified with a Storage Policy.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">               TabletId: 3674797</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              ReplicaId: 3674799</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              BackendId: 10162</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             SchemaHash: 513232100</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                Version: 1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      LstSuccessVersion: 1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       LstFailedVersion: -1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          LstFailedTime: NULL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          LocalDataSize: 0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         RemoteDataSize: 0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">               RowCount: 0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                  State: NORMAL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">LstConsistencyCheckTime: NULL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           CheckVersion: -1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           VersionCount: 1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              QueryHits: 0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">               PathHash: 8030511811695924097</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                MetaUrl: http://172.16.0.16:6781/api/meta/header/3674797</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       CompactionStatus: http://172.16.0.16:6781/api/compaction/show?tablet_id=3674797</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      CooldownReplicaId: 3674799</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         CooldownMetaId: TUniqueId(hi:-8987737979209762207, lo:-2847426088899160152)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>To set a Storage Policy for a specific partition, add the policy name to the partition PROPERTIES as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE TABLE IF NOT EXISTS lineitem1 (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_ORDERKEY    INTEGER NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_PARTKEY     INTEGER NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_SUPPKEY     INTEGER NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_LINENUMBER  INTEGER NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_QUANTITY    DECIMAL(15,2) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_EXTENDEDPRICE  DECIMAL(15,2) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_DISCOUNT    DECIMAL(15,2) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_TAX         DECIMAL(15,2) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_RETURNFLAG  CHAR(1) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_LINESTATUS  CHAR(1) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_SHIPDATE    DATEV2 NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_COMMITDATE  DATEV2 NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_RECEIPTDATE DATEV2 NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_SHIPINSTRUCT CHAR(25) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_SHIPMODE     CHAR(10) NOT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            L_COMMENT      VARCHAR(44) NOT NULL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            )</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            DUPLICATE KEY(L_ORDERKEY, L_PARTKEY, L_SUPPKEY, L_LINENUMBER)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            PARTITION BY RANGE(`L_SHIPDATE`)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                PARTITION `p202301` VALUES LESS THAN ("2017-02-01") ("storage_policy" = "${policy_name}"),</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                PARTITION `p202302` VALUES LESS THAN ("2017-03-01")</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            )</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            DISTRIBUTED BY HASH(L_ORDERKEY) BUCKETS 3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            PROPERTIES (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            "replication_num" = "3"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            )</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>This is how you can confirm that only the target partition is set with a Storage Policy:</strong></p>
<p>In the above example, Table Lineitem1 has 2 partitions, each partition has 3 buckets, and <code>replication_num</code> is set to "3". That means there are 2<em>3 = 6 tablets and 6</em>3 = 18 replicas in total.</p>
<p>Now, if you check the replica information of all tablets via the <code>show tablets</code> command, you will see that only the replicas of tablets of the target  partion have a CooldownReplicaId and a CooldownMetaId. (For a clear  comparison, you can check replica information of a specific partition  via the <code>ADMIN SHOW REPLICA STATUS FROM TABLE PARTITION(PARTITION)</code> command.)</p>
<p>For instance, Tablet 3691990 belongs to Partition p202301, which is the  target partition, so the 3 replicas of this tablet have a  CooldownReplicaId and a CooldownMetaId:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">*****************************************************************</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">               TabletId: 3691990</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              ReplicaId: 3691991</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      CooldownReplicaId: 3691993</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         CooldownMetaId: TUniqueId(hi:-7401335798601697108, lo:3253711199097733258)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">*****************************************************************</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">               TabletId: 3691990</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              ReplicaId: 3691992</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      CooldownReplicaId: 3691993</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         CooldownMetaId: TUniqueId(hi:-7401335798601697108, lo:3253711199097733258)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">*****************************************************************</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">               TabletId: 3691990</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              ReplicaId: 3691993</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      CooldownReplicaId: 3691993</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         CooldownMetaId: TUniqueId(hi:-7401335798601697108, lo:3253711199097733258)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Also, the above snippet means that all these 3 replicas have been specified  with the same CooldownReplica: 3691993, so only the data in Replica  3691993 will be stored in the Resource.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=4-view-tablet-details>4. View Tablet Details<a href=#4-view-tablet-details class=hash-link aria-label="4. View Tablet Details的直接链接" title="4. View Tablet Details的直接链接">​</a></h3>
<p>You can view the detailed information of Table Lineitem1 via a <code>show tablets from lineitem1</code> command. Among all the properties, <code>LocalDataSize</code> represents the size of locally stored data and <code>RemoteDataSize</code> represents the size of cold data in object storage.</p>
<p>For example, when the data is newly ingested into the Doris backends, you can see that all data is stored locally.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">*************************** 1. row ***************************</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">               TabletId: 2749703</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              ReplicaId: 2749704</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              BackendId: 10090</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             SchemaHash: 1159194262</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                Version: 3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      LstSuccessVersion: 3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       LstFailedVersion: -1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          LstFailedTime: NULL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          LocalDataSize: 73001235</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         RemoteDataSize: 0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">               RowCount: 1996567</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                  State: NORMAL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">LstConsistencyCheckTime: NULL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           CheckVersion: -1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           VersionCount: 3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              QueryHits: 0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">               PathHash: -8567514893400420464</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                MetaUrl: http://172.16.0.8:6781/api/meta/header/2749703</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       CompactionStatus: http://172.16.0.8:6781/api/compaction/show?tablet_id=2749703</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      CooldownReplicaId: 2749704</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         CooldownMetaId:</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>When the data has cooled down, you will see that the data has been moved to remote object storage.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">*************************** 1. row ***************************</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">               TabletId: 2749703</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              ReplicaId: 2749704</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              BackendId: 10090</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             SchemaHash: 1159194262</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                Version: 3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      LstSuccessVersion: 3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       LstFailedVersion: -1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          LstFailedTime: NULL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          LocalDataSize: 0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         RemoteDataSize: 73001235</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">               RowCount: 1996567</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                  State: NORMAL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">LstConsistencyCheckTime: NULL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           CheckVersion: -1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">           VersionCount: 3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">              QueryHits: 0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">               PathHash: -8567514893400420464</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                MetaUrl: http://172.16.0.8:6781/api/meta/header/2749703</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">       CompactionStatus: http://172.16.0.8:6781/api/compaction/show?tablet_id=2749703</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      CooldownReplicaId: 2749704</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">         CooldownMetaId: TUniqueId(hi:-8697097432131255833, lo:9213158865768502666)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>You can also check your cold data from the object storage side by finding  the data files under the path specified in the Storage Policy.</p>
<p>Data in object storage only has a single copy.</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/v2/resize:fit:1400/1*jao2TrbhDI2h6S04W0x95Q.png alt=img class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=5-execute-queries>5. Execute Queries<a href=#5-execute-queries class=hash-link aria-label="5. Execute Queries的直接链接" title="5. Execute Queries的直接链接">​</a></h3>
<p>When all data in Table Lineitem1 has been moved to object storage and a  query requests data from Table Lineitem1, Apache Doris will follow the  root path specified in the Storage Policy of the relevant data  partition, and download the requested data for local computation.</p>
<p>Apache Doris 2.0 has been optimized for cold data queries. Only the first-time access to the cold data will entail a full network I/O operation from  object storage. After that, the downloaded data will be put in cache to  be available for subsequent queries, so as to improve query speed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=6-update-cold-data>6. Update Cold Data<a href=#6-update-cold-data class=hash-link aria-label="6. Update Cold Data的直接链接" title="6. Update Cold Data的直接链接">​</a></h3>
<p>In Apache Doris, each data ingestion leads to the generation of a new  Rowset, so the update of historical data will be put in a Rowset that is separated from those of newly loaded data. That’s how it makes sure the updating of cold data does not interfere with the ingestion of hot  data. Once the rowsets cool down, they will be moved to S3 and deleted  locally, and the updated historical data will go to the partition where  it belongs.</p>
<p>If you any questions, come find Apache Doris developers on <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Slack</a>. We will be happy to provide targeted support.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Say-Goodbye-to-OOM-Crashes/>Say goodbye to OOM crashes</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2023-06-16T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2023年6月16日</time></div></header><div class=markdown itemprop=articleBody><p>What guarantees system stability in large data query tasks? It is an effective memory allocation and monitoring mechanism. It is how you speed up computation, avoid memory hotspots, promptly respond to insufficient memory, and minimize OOM errors.</p>
<p><img decoding=async loading=lazy alt=memory-allocator src=/zh-CN/assets/images/OOM_1-cbcc6d864b892831d6e8e3acf37a356f.png width=1226 height=214 class=img_ev3q></p>
<p>From a database user's perspective, how do they suffer from bad memory management? This is a list of things that used to bother our users:</p>
<ul>
<li>OOM errors cause backend processes to crash. To quote one of our community members: Hi, Apache Doris, it's okay to slow things down or fail a few tasks when you are short of memory, but throwing a downtime is just not cool.</li>
<li>Backend processes consume too much memory space, but there is no way to find the exact task to blame or limit the memory usage for a single query.</li>
<li>It is hard to set a proper memory size for each query, so chances are that a query gets canceled even when there is plenty of memory space.</li>
<li>High-concurrency queries are disproportionately slow, and memory hotspots are hard to locate.</li>
<li>Intermediate data during HashTable creation cannot be flushed to disks, so join queries between two large tables often fail due to OOM.</li>
</ul>
<p>Luckily, those dark days are behind us, because we have improved our memory management mechanism from the bottom up. Now get ready, things are going to be intensive.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=memory-allocation>Memory Allocation<a href=#memory-allocation class=hash-link aria-label="Memory Allocation的直接链接" title="Memory Allocation的直接链接">​</a></h2>
<p>In Apache Doris, we have a one-and-only interface for memory allocation: <strong>Allocator</strong>. It will make adjustments as it sees appropriate to keep memory usage efficient and under control. Also, MemTrackers are in place to track the allocated or released memory size, and three different data structures are responsible for large memory allocation in operator execution (we will get to them immediately).</p>
<p><img decoding=async loading=lazy alt=memory-tracker src=/zh-CN/assets/images/OOM_2-2804f7f38fc4bfec4b20bb6f1ce2416e.png width=1228 height=568 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=data-structures-in-memory>Data Structures in Memory<a href=#data-structures-in-memory class=hash-link aria-label="Data Structures in Memory的直接链接" title="Data Structures in Memory的直接链接">​</a></h3>
<p>As different queries have different memory hotspot patterns in execution, Apache Doris provides three different in-memory data structures: <strong>Arena</strong>, <strong>HashTable</strong>, and <strong>PODArray</strong>. They are all under the reign of the Allocator.</p>
<p><img decoding=async loading=lazy alt=data-structures src=/zh-CN/assets/images/OOM_3-9450598001ffa0bb838abad7bc62efb6.png width=1222 height=758 class=img_ev3q></p>
<p><strong>1. Arena</strong></p>
<p>The Arena is a memory pool that maintains a list of chunks, which are to be allocated upon request from the Allocator. The chunks support memory alignment. They exist throughout the lifespan of the Arena, and will be freed up upon destruction (usually when the query is completed). Chunks are mainly used to store the serialized or deserialized data during Shuffle, or the serialized Keys in HashTables.</p>
<p>The initial size of a chunk is 4096 bytes. If the current chunk is smaller than the requested memory, a new chunk will be added to the list. If the current chunk is smaller than 128M, the new chunk will double its size; if it is larger than 128M, the new chunk will, at most, be 128M larger than what is required. The old small chunk will not be allocated for new requests. There is a cursor to mark the dividing line of chunks allocated and those unallocated.</p>
<p><strong>2. HashTable</strong></p>
<p>HashTables are applicable for Hash Joins, aggregations, set operations, and window functions. The PartitionedHashTable structure supports no more than 16 sub-HashTables. It also supports the parallel merging of HashTables and each sub-Hash Join can be scaled independently. These can reduce overall memory usage and the latency caused by scaling.</p>
<p>If the current HashTable is smaller than 8M, it will be scaled by a factor of 4;</p>
<p>If it is larger than 8M, it will be scaled by a factor of 2;</p>
<p>If it is smaller than 2G, it will be scaled when it is 50% full;</p>
<p>And if it is larger than 2G, it will be scaled when it is 75% full.</p>
<p>The newly created HashTables will be pre-scaled based on how much data it is going to have. We also provide different types of HashTables for different scenarios. For example, for aggregations, you can apply PHmap.</p>
<p><strong>3. PODArray</strong></p>
<p>PODArray, as the name suggests, is a dynamic array of POD. The difference between it and <code>std::vector</code> is that PODArray does not initialize elements. It supports memory alignment and some interfaces of <code>std::vector</code>. It is scaled by a factor of 2. In destruction, instead of calling the destructor function for each element, it releases memory of the whole PODArray. PODArray is mainly used to save strings in columns and is applicable in many function computation and expression filtering.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=memory-interface>Memory Interface<a href=#memory-interface class=hash-link aria-label="Memory Interface的直接链接" title="Memory Interface的直接链接">​</a></h3>
<p>As the only interface that coordinates Arena, PODArray, and HashTable, the Allocator executes memory mapping (MMAP) allocation for requests larger than 64M. Those smaller than 4K will be directly allocated from the system via malloc/free; and those in between will be accelerated by a general-purpose caching ChunkAllocator, which brings a 10% performance increase according to our benchmarking results. The ChunkAllocator will try and retrieve a chunk of the specified size from the FreeList of the current core in a lock-free manner; if such a chunk doesn't exist, it will try from other cores in a lock-based manner; if that still fails, it will request the specified memory size from the system and encapsulate it into a chunk.</p>
<p>We chose Jemalloc over TCMalloc after experience with both of them. We tried TCMalloc in our high-concurrency tests and noticed that Spin Lock in CentralFreeList took up 40% of the total query time. Disabling "aggressive memory decommit" made things better, but that brought much more memory usage, so we had to use an individual thread to regularly recycle cache. Jemalloc, on the other hand, was more performant and stable in high-concurrency queries. After fine-tuning for other scenarios, it delivered the same performance as TCMalloc but consumed less memory.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=memory-reuse>Memory Reuse<a href=#memory-reuse class=hash-link aria-label="Memory Reuse的直接链接" title="Memory Reuse的直接链接">​</a></h3>
<p>Memory reuse is widely executed on the execution layer of Apache Doris. For example, data blocks will be reused throughout the execution of a query. During Shuffle, there will be two blocks at the Sender end and they work alternately, one receiving data and the other in RPC transport. When reading a tablet, Doris will reuse the predicate column, implement cyclic reading, filter, copy filtered data to the upper block, and then clear. When ingesting data into an Aggregate Key table, once the MemTable that caches data reaches a certain size, it will be pre-aggregated and then more data will be written in.</p>
<p>Memory reuse is executed in data scanning, too. Before the scanning starts, a number of free blocks (depending on the number of scanners and threads) will be allocated to the scanning task. During each scanner scheduling, one of the free blocks will be passed to the storage layer for data reading. After data reading, the block will be put into the producer queue for consumption of the upper operators in subsequent computation. Once an upper operator has copied the computation data from the block, the block will go back in the free blocks for next scanner scheduling. The thread the preallocates the free blocks will also be responsible for freeing them up after data scanning, so there won't be extra overheads. The number of free blocks somehow determines the concurrency of data scanning.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=memory-tracking>Memory Tracking<a href=#memory-tracking class=hash-link aria-label="Memory Tracking的直接链接" title="Memory Tracking的直接链接">​</a></h2>
<p>Apache Doris uses MemTrackers to follow up on the allocation and releasing of memory while analyzing memory hotspots. The MemTrackers keep records of each data query, data ingestion, data compaction task, and the memory size of each global object, such as Cache and TabletMeta. It supports both manual counting and MemHook auto-tracking. Users can view the real-time memory usage in Doris backend on a Web page.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=structure-of-memtrackers>Structure of MemTrackers<a href=#structure-of-memtrackers class=hash-link aria-label="Structure of MemTrackers的直接链接" title="Structure of MemTrackers的直接链接">​</a></h3>
<p>The MemTracker system before Apache Doris 1.2.0 was in a hierarchical tree structure, consisting of process_mem_tracker, query_pool_mem_tracker, query_mem_tracker, instance_mem_tracker, ExecNode_mem_tracker and so on. MemTrackers of two neighbouring layers are of parent-child relationship. Hence, any calculation mistakes in a child MemTracker will be accumulated all the way up and result in a larger scale of incredibility.</p>
<p><img decoding=async loading=lazy alt=MemTrackers src=/zh-CN/assets/images/OOM_4-90b44adf02bc4653708948cf5e65d50e.png width=1280 height=419 class=img_ev3q></p>
<p>In Apache Doris 1.2.0 and newer, we made the structure of MemTrackers much simpler. MemTrackers are only divided into two types based on their roles: <strong>MemTracker Limiter</strong> and the others. MemTracker Limiter, monitoring memory usage, is unique in every query/ingestion/compaction task and global object; while the other MemTrackers traces the memory hotspots in query execution, such as HashTables in Join/Aggregation/Sort/Window functions and intermediate data in serialization, to give a picture of how memory is used in different operators or provide reference for memory control in data flushing.</p>
<p>The parent-child relationship between MemTracker Limiter and other MemTrackers is only manifested in snapshot printing. You can think of such a relationship as a symbolic link. They are not consumed at the same time, and the lifecycle of one does not affect that of the other. This makes it much easier for developers to understand and use them.</p>
<p>MemTrackers (including MemTracker Limiter and the others) are put into a group of Maps. They allow users to print overall MemTracker type snapshot, Query/Load/Compaction task snapshot, and find out the Query/Load with the most memory usage or the most memory overusage.</p>
<p><img decoding=async loading=lazy alt=Structure-of-MemTrackers src=/zh-CN/assets/images/OOM_5-beba9f4c16d66d0df644f9e69a3b7db3.png width=1280 height=1063 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=how-memtracker-works>How MemTracker Works<a href=#how-memtracker-works class=hash-link aria-label="How MemTracker Works的直接链接" title="How MemTracker Works的直接链接">​</a></h3>
<p>To calculate memory usage of a certain execution, a MemTracker is added to a stack in Thread Local of the current thread. By reloading the malloc/free/realloc in Jemalloc or TCMalloc, MemHook obtains the actual size of the memory allocated or released, and records it in Thread Local of the current thread. When an execution is done, the relevant MemTracker will be removed from the stack. At the bottom of the stack is the MemTracker that records memory usage during the whole query/load execution process.</p>
<p>Now let me explain with a simplified query execution process.</p>
<ul>
<li>After a Doris backend node starts, the memory usage of all threads will be recorded in the Process MemTracker.</li>
<li>When a query is submitted, a <strong>Query MemTracker</strong> will be added to the Thread Local Storage(TLS) Stack in the fragment execution thread.</li>
<li>Once a ScanNode is scheduled, a <strong>ScanNode MemTracker</strong> will be added to Thread Local Storage(TLS) Stack in the fragment execution thread. Then, any memory allocated or released in this thread will be recorded into both the Query MemTracker and the ScanNode MemTracker.</li>
<li>After a Scanner is scheduled, a Query MemTracker and a <strong>Scanner MemTracker</strong> will be added to the TLS Stack of the Scanner thread.</li>
<li>When the scanning is done, all MemTrackers in the Scanner Thread TLS Stack will be removed. When the ScanNode scheduling is done, the ScanNode MemTracker will be removed from the fragment execution thread. Then, similarly, when an aggregation node is scheduled, an <strong>AggregationNode MemTracker</strong> will be added to the fragment execution thread TLS Stack, and get removed after the scheduling is done.</li>
<li>If the query is completed, the Query MemTracker will be removed from the fragment execution thread TLS Stack. At this point, this stack should be empty. Then, from the QueryProfile, you can view the peak memory usage during the whole query execution as well as each phase (scanning, aggregation, etc.).</li>
</ul>
<p><img decoding=async loading=lazy alt=How-MemTrackers-Works src=/zh-CN/assets/images/OOM_6-cf0ef627ae1b9d5448b54ab92f9c3180.png width=1280 height=424 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=how-to-use-memtracker>How to Use MemTracker<a href=#how-to-use-memtracker class=hash-link aria-label="How to Use MemTracker的直接链接" title="How to Use MemTracker的直接链接">​</a></h3>
<p>The Doris backend Web page demonstrates real-time memory usage, which is divided into types: Query/Load/Compaction/Global. Current memory consumption and peak consumption are shown.</p>
<p><img decoding=async loading=lazy alt=How-to-use-MemTrackers src=/zh-CN/assets/images/OOM_7-4fef601c6c9f9a5fcc53b785485057d3.png width=1280 height=562 class=img_ev3q></p>
<p>The Global types include MemTrackers of Cache and TabletMeta.</p>
<p><img decoding=async loading=lazy alt=memory-usage-by-subsystem-1 src=/zh-CN/assets/images/OOM_8-a007e2d4fa06263628f5d603471a3f79.png width=1280 height=489 class=img_ev3q></p>
<p>From the Query types, you can see the current memory consumption and peak consumption of the current query and the operators it involves (you can tell how they are related from the labels). For memory statistics of historical queries, you can check the Doris FE audit logs or BE INFO logs.</p>
<p><img decoding=async loading=lazy alt=memory-usage-by-subsystem-2 src=/zh-CN/assets/images/OOM_9-32f7ad3c6b10088f0735cfd1ff0e1e39.png width=1280 height=762 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=memory-limit>Memory Limit<a href=#memory-limit class=hash-link aria-label="Memory Limit的直接链接" title="Memory Limit的直接链接">​</a></h2>
<p>With widely implemented memory tracking in Doris backends, we are one step closer to eliminating OOM, the cause of backend downtime and large-scale query failures. The next step is to optimize the memory limit on queries and processes to keep memory usage under control.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=memory-limit-on-query>Memory Limit on Query<a href=#memory-limit-on-query class=hash-link aria-label="Memory Limit on Query的直接链接" title="Memory Limit on Query的直接链接">​</a></h3>
<p>Users can put a memory limit on every query. If that limit is exceeded during execution, the query will be canceled. But since version 1.2, we have allowed Memory Overcommit, which is a more flexible memory limit control. If there are sufficient memory resources, a query can consume more memory than the limit without being canceled, so users don't have to pay extra attention to memory usage; if there are not, the query will wait until new memory space is allocated; only when the newly freed up memory is not enough for the query will the query be canceled.</p>
<p>While in Apache Doris 2.0, we have realized exception safety for queries. That means any insufficient memory allocation will immediately cause the query to be canceled, which saves the trouble of checking "Cancel" status in subsequent steps.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=memory-limit-on-process>Memory Limit on Process<a href=#memory-limit-on-process class=hash-link aria-label="Memory Limit on Process的直接链接" title="Memory Limit on Process的直接链接">​</a></h3>
<p>On a regular basis, Doris backend retrieves the physical memory of processes and the currently available memory size from the system. Meanwhile, it collects MemTracker snapshots of all Query/Load/Compaction tasks. If a backend process exceeds its memory limit or there is insufficient memory, Doris will free up some memory space by clearing Cache and cancelling a number of queries or data ingestion tasks. These will be executed by an individual GC thread regularly.</p>
<p><img decoding=async loading=lazy alt=memory-limit-on-process src=/zh-CN/assets/images/OOM_10-4926bcb7439768952d6d973697de2468.png width=1280 height=610 class=img_ev3q></p>
<p>If the process memory consumed is over the SoftMemLimit (81% of total system memory, by default), or the available system memory drops below the Warning Water Mark (less than 3.2GB), <strong>Minor GC</strong> will be triggered. At this moment, query execution will be paused at the memory allocation step, the cached data in data ingestion tasks will be force flushed, and part of the Data Page Cache and the outdated Segment Cache will be released. If the newly released memory does not cover 10% of the process memory, with Memory Overcommit enabled, Doris will start cancelling the queries which are the biggest "overcommitters" until the 10% target is met or all queries are canceled. Then, Doris will shorten the system memory checking interval and the GC interval. The queries will be continued after more memory is available.</p>
<p>If the process memory consumed is beyond the MemLimit (90% of total system memory, by default), or the available system memory drops below the Low Water Mark (less than 1.6GB), <strong>Full GC</strong> will be triggered. At this time, data ingestion tasks will be stopped, and all Data Page Cache and most other Cache will be released. If, after all these steps, the newly released memory does not cover 20% of the process memory, Doris will look into all MemTrackers and find the most memory-consuming queries and ingestion tasks, and cancel them one by one. Only after the 20% target is met will the system memory checking interval and the GC interval be extended, and the queries and ingestion tasks be continued. (One garbage collection operation usually takes hundreds of μs to dozens of ms.)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=influences-and-outcomes>Influences and Outcomes<a href=#influences-and-outcomes class=hash-link aria-label="Influences and Outcomes的直接链接" title="Influences and Outcomes的直接链接">​</a></h2>
<p>After optimizations in memory allocation, memory tracking, and memory limit, we have substantially increased the stability and high-concurrency performance of Apache Doris as a real-time analytic data warehouse platform. OOM crash in the backend is a rare scene now. Even if there is an OOM, users can locate the problem root based on the logs and then fix it. In addition, with more flexible memory limits on queries and data ingestion, users don't have to spend extra effort taking care of memory when memory space is adequate.</p>
<p>In the next phase, we plan to ensure completion of queries in memory overcommitment, which means less queries will have to be canceled due to memory shortage. We have broken this objective into specific directions of work: exception safety, memory isolation between resource groups, and the flushing mechanism of intermediate data. If you want to meet our developers, <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">this is where you find us</a>.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Understanding-Data-Compaction-in-3-Minutes/>Understanding data compaction in 3 minutes</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2023-06-09T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2023年6月9日</time></div></header><div class=markdown itemprop=articleBody><p>What is compaction in database? Think of your disks as a warehouse: The compaction mechanism is like a team of storekeepers (with genius organizing skills like Marie Kondo) who help put away the incoming data.</p>
<p>In particular, the data (which is the inflowing cargo in this metaphor) comes in on a "conveyor belt", which does not allow cutting in line. This is how the <strong>LSM-Tree</strong> (Log Structured-Merge Tree) works: In data storage, data is written into <strong>MemTables</strong> in an append-only manner, and then the MemTables are flushed to disks to form files. (These files go by different names in different databases. In my community, we call them <strong>Rowsets</strong>). Just like putting small boxes of cargo into a large container, compaction means merging multiple small rowset files into a big one, but it does much more than that. Like I said, the compaction mechanism is an organizing magician:</p>
<ul>
<li>Although the items (data) in each box (rowset) are orderly arranged, the boxes themselves are not. Hence, one thing that the "storekeepers" do is to sort the boxes (rowsets) in a certain order so they can be quickly found once needed (quickening data reading).</li>
<li>If an item needs to be discarded or replaced, since no line-jump is allowed on the conveyor belt (append-only), you can only put a "note" (together with the substitution item) at the end of the queue on the belt to remind the "storekeepers", who will later perform replacing or discarding for you.</li>
<li>If needed, the "storekeepers" are even kind enough to pre-process the cargo for you (pre-aggregating data to reduce computation burden during data reading).</li>
</ul>
<p><img decoding=async loading=lazy alt=MemTable-rowset src=/zh-CN/assets/images/Compaction_1-ee87990e8968b1976f60ae8c76c1f224.png width=1279 height=670 class=img_ev3q></p>
<p>As helpful as the "storekeepers" are, they can be troublemakers at times — that's why "team management" matters. For the compaction mechanism to work efficiently, you need wise planning and scheduling, or else you might need to deal with high memory and CPU usage, if not OOM in the backend or write error.</p>
<p>Specifically, efficient compaction is added up by quick triggering of compaction tasks, controllable memory and CPU overheads, and easy parameter adjustment from the engineer's side. That begs the question: <strong>How</strong>? In this post, I will show you our way, including how we trigger, execute, and fine-tune compaction for faster and less resource-hungry execution.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=trigger-strategies>Trigger Strategies<a href=#trigger-strategies class=hash-link aria-label="Trigger Strategies的直接链接" title="Trigger Strategies的直接链接">​</a></h2>
<p>The overall objective here is to trigger compaction tasks timely with the least resource consumption possible.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=active-trigger>Active Trigger<a href=#active-trigger class=hash-link aria-label="Active Trigger的直接链接" title="Active Trigger的直接链接">​</a></h3>
<p>The most intuitive way to ensure timely compaction is to scan for potential compaction tasks upon data ingestion. Every time a new data tablet version is generated, a compaction task is triggered immediately, so you will never have to worry about version buildup. But this only works for newly ingested data. This is called <strong>Cumulative Compaction</strong>, as opposed to <strong>Base Compaction</strong>, which is the compaction of existing data.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=passive-scan>Passive Scan<a href=#passive-scan class=hash-link aria-label="Passive Scan的直接链接" title="Passive Scan的直接链接">​</a></h3>
<p>Base compaction is triggered by passive scan. Passive scan is a much heavier job than active trigger, because it scans all metadata in all data tablets in the node. After identifying all potential compaction tasks, the system starts compaction for the most urgent data tablet.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=tablet-dormancy>Tablet Dormancy<a href=#tablet-dormancy class=hash-link aria-label="Tablet Dormancy的直接链接" title="Tablet Dormancy的直接链接">​</a></h3>
<p>Frequent metadata scanning is a waste of CPU resources, so it is better to introduce domancy: For tablets that have been producing no compaction tasks for long, the system just stops looking at them for a while. If there is a sudden data-write on a dormant tablet, that will trigger cumulative compaction as mentioned above, so no worries, you won't miss anything.</p>
<p>The combination of these three strategies is an example of cost-effective planning.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=execution>Execution<a href=#execution class=hash-link aria-label=Execution的直接链接 title=Execution的直接链接>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=vertical-compaction-for-columnar-storage>Vertical Compaction for Columnar Storage<a href=#vertical-compaction-for-columnar-storage class=hash-link aria-label="Vertical Compaction for Columnar Storage的直接链接" title="Vertical Compaction for Columnar Storage的直接链接">​</a></h3>
<p>As columnar storage is the future for analytic databases, the execution of compaction should adapt to that. We call it vertical compaction. I illustrate this mechanism with the figure below:</p>
<p><img decoding=async loading=lazy alt=vertical-compaction src=/zh-CN/assets/images/Compaction_2-a6a4e08e1d33d0c489208d8fb607abb9.png width=1536 height=826 class=img_ev3q></p>
<p>Hope all these tiny blocks and numbers don't make you dizzy. Actually, vertical compaction can be broken down into four simple steps:</p>
<ol>
<li><strong>Separate key columns and value columns</strong>. Split out all key columns from the input rowsets and put them into one group, and all value columns into N groups.</li>
<li><strong>Merge the key columns</strong>. Heap sort is used in this step. The product here is a merged and ordered key column as well as a global sequence marker (<strong>RowSources</strong>).</li>
<li><strong>Merge the value columns</strong>. The value columns are merged and organized based on the sequence in <strong>RowSources</strong>.</li>
<li><strong>Write the data</strong>. All columns are assembled together and form one big rowset.</li>
</ol>
<p>As a supporting technique for columnar storage, vertical compaction avoids the need to load all columns in every merging operation. That means it can vastly reduce memory usage compared to traditional row-oriented compaction.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=segment-compaction-to-avoid-jams>Segment Compaction to Avoid "Jams"<a href=#segment-compaction-to-avoid-jams class=hash-link aria-label='Segment Compaction to Avoid "Jams"的直接链接' title='Segment Compaction to Avoid "Jams"的直接链接'>​</a></h3>
<p>As described in the beginning, in data ingestion, data will first be piled in the memory until it reaches a certain size, and then flushed to disks and stored in the form of files. Therefore, if you have ingested one huge batch of data at a time, you will have a large number of newly generated files on the disks. That adds to the scanning burden during data reading, and thus slows down data queries. (Imagine that suddenly you have to look into 50 boxes instead of 5, to find the item you need. That's overwhelming.) In some databases, such explosion of files could even trigger a protection mechanism that suspends data ingestion.</p>
<p>Segment compaction is the way to avoid that. It allows you to compact data at the same time you ingest it, so that the system can ingest a larger data size quickly without generating too many files.</p>
<p>This is a flow chart that explains how segment compaction works:</p>
<p><img decoding=async loading=lazy alt=segment-compaction src=/zh-CN/assets/images/Compaction_3-6558067933ac6eb62900cd50b18f09fa.png width=1030 height=950 class=img_ev3q></p>
<p>Segment compaction will be triggered once the number of newly generated files exceeds a certain limit (let's say, 10). It is executed asynchronously by a specialized merging thread. Every 10 files will be merged into one, and the original 10 files will be deleted. Segment compaction does not prolong the data ingestion process by much, but it can largely accelerate data queries.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=ordered-data-compaction>Ordered Data Compaction<a href=#ordered-data-compaction class=hash-link aria-label="Ordered Data Compaction的直接链接" title="Ordered Data Compaction的直接链接">​</a></h3>
<p>Time series data analysis is an increasingly common analytic scenario.</p>
<p>Time series data is "born orderly". It is already arranged chronologically, it is written at a regular pace, and every batch of it is of similar size. It is like the least-worried-about child in the family. Correspondingly, we have a tailored compaction method for it: ordered data compaction.</p>
<p><img decoding=async loading=lazy alt=ordered-data-compaction src=/zh-CN/assets/images/Compaction_4-e2cea4ec600d74073084b6ecbd1e600f.png width=653 height=443 class=img_ev3q></p>
<p>Ordered data compaction is even simpler:</p>
<ol>
<li><strong>Upload</strong>: Jot down the Min/Max Keys of the input rowset files.</li>
<li><strong>Check</strong>: Check if the rowset files are organized correctly based on the Min/Max Keys and the file size.</li>
<li><strong>Merge</strong>: Hard link the input rowsets to the new rowset, and create metadata for the new rowset (including number of rows, file size, Min/Max Key, etc.)</li>
</ol>
<p>See? It is a super neat and lightweight workload, involving only file linking and metadata creation. Statistically, <strong>it just takes milliseconds to compact huge amounts of time series data but consumes nearly zero memory</strong>.</p>
<p>So far, these are strategic and algorithmic optimizations for compaction, implemented by <a href=https://github.com/apache/doris/issues/19231 target=_blank rel="noopener noreferrer">Apache Doris 2.0.0</a>, a unified analytic database. Apart from these, we, as developers for the open source project, have fine-tuned it from an engineering perspective.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=engineering-optimizations>Engineering Optimizations<a href=#engineering-optimizations class=hash-link aria-label="Engineering Optimizations的直接链接" title="Engineering Optimizations的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=zero-copy>Zero-Copy<a href=#zero-copy class=hash-link aria-label=Zero-Copy的直接链接 title=Zero-Copy的直接链接>​</a></h3>
<p>In the backend nodes of Apache Doris, data goes through a few layers: Tablet -> Rowset -> Segment -> Column -> Page. The compaction process involves data transferring that consumes a lot of CPU resources. So we designed zero-copy compaction logic, which is realized by a data structure named BlockView. This brings another 5% increase in compaction efficiency.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=load-on-demand>Load-on-Demand<a href=#load-on-demand class=hash-link aria-label=Load-on-Demand的直接链接 title=Load-on-Demand的直接链接>​</a></h3>
<p>In most cases, the rowsets are not 100% orderless, so we can take advantage of such partial orderliness. For a group of ordered rowsets, Apache Doris only loads the first one and then starts merging. As the merging goes on, it gradually loads the rowset files it needs. This is how it decreases memory usage.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=idle-schedule><strong>Idle Schedule</strong><a href=#idle-schedule class=hash-link aria-label=idle-schedule的直接链接 title=idle-schedule的直接链接>​</a></h3>
<p>According to our experience, base compaction tasks are often resource-intensive and time-consuming, so they can easily stand in the way of data queries. Doris 2.0.0 enables Idle Schedule, deprioritizing those base compaction tasks with huge data, long execution, and low compaction rate.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=parameter-optimizations>Parameter Optimizations<a href=#parameter-optimizations class=hash-link aria-label="Parameter Optimizations的直接链接" title="Parameter Optimizations的直接链接">​</a></h2>
<p>Every data engineer has somehow been harassed by complicated parameters and configurations. To protect our users from this nightmare, we have provided a streamlined set of parameters with the best-performing default configurations in the general environment.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label=Conclusion的直接链接 title=Conclusion的直接链接>​</a></h2>
<p>This is how we keep our "storekeepers" working efficiently and cost-effectively. If you wonder how these strategies and optimization work in real practice, we tested Apache Doris with ClickBench. It reaches a <strong>compaction speed of 300,000 row/s</strong>; in high-concurrency scenarios, it maintains <strong>a stable compaction score of around 50</strong>. Also, we are planning to implement auto-tuning and increase observability for the compaction mechanism. If you are interested in the <a href=https://github.com/apache/doris target=_blank rel="noopener noreferrer">Apache Doris</a> project and what we do, this is a group of visionary and passionate <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">developers</a> that you can talk to.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Building-A-Log-Analytics-Solution-10-Times-More-Cost-Effective-Than-Elasticsearch/>Building a log analytics solution 10 times more cost-effective than Elasticsearch</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2023-05-26T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2023年5月26日</time></div></header><div class=markdown itemprop=articleBody><p>Logs often take up the majority of a company's data assets. Examples of logs include business logs (such as user activity logs), and Operation & Maintenance logs of servers, databases, and network or IoT devices.</p>
<p>Logs are the guardian angel of business. On the one hand, they provide system risk alerts and help engineers in troubleshooting. On the other hand, if you zoom them out by time range, you might identify some helpful trends and patterns, not to mention that business logs are the cornerstone of user insights.</p>
<p>However, logs can be a handful, because:</p>
<ul>
<li><strong>They flow in like crazy.</strong> Every system event or click from user generates a log. A company often produces tens of billions of new logs per day.</li>
<li><strong>They are bulky.</strong> Logs are supposed to stay. They might not be useful until they are. So a company can accumulate up to PBs of log data, many of which are seldom visited but take up huge storage space.</li>
<li><strong>They must be quick to load and find.</strong> Locating the target log for troubleshooting is literally like looking for a needle in a haystack. People long for real-time log writing and real-time responses to log queries.</li>
</ul>
<p>Now you can see a clear picture of what an ideal log processing system is like. It should support:</p>
<ul>
<li><strong>High-throughput real-time data ingestion:</strong> It should be able to write blogs in bulk, and make them visible immediately.</li>
<li><strong>Low-cost storage:</strong> It should be able to store substantial amounts of logs without costing too many resources.</li>
<li><strong>Real-time text search:</strong> It should be capable of quick text search.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=common-solutions-elasticsearch--grafana-loki>Common Solutions: Elasticsearch & Grafana Loki<a href=#common-solutions-elasticsearch--grafana-loki class=hash-link aria-label="Common Solutions: Elasticsearch & Grafana Loki的直接链接" title="Common Solutions: Elasticsearch & Grafana Loki的直接链接">​</a></h2>
<p>There exist two common log processing solutions within the industry, exemplified by Elasticsearch and Grafana Loki, respectively.</p>
<ul>
<li><strong>Inverted index (Elasticsearch)</strong>: It is well-embraced due to its support for full-text search and high performance. The downside is the low throughput in real-time writing and the huge resource consumption in index creation.</li>
<li><strong>Lightweight index / no index (Grafana Loki)</strong>: It is the opposite of inverted index because it boasts high real-time write throughput and low storage cost but delivers slow queries.</li>
</ul>
<p><img decoding=async loading=lazy alt=Elasticsearch-and-Grafana-Loki src=/zh-CN/assets/images/Inverted_1-976368c1a98899c128fdb268e00261c5.png width=1412 height=748 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=introduction-to-inverted-index>Introduction to Inverted Index<a href=#introduction-to-inverted-index class=hash-link aria-label="Introduction to Inverted Index的直接链接" title="Introduction to Inverted Index的直接链接">​</a></h2>
<p>A prominent strength of Elasticsearch in log processing is quick keyword search among a sea of logs. This is enabled by inverted indexes.</p>
<p>Inverted indexing was originally used to retrieve words or phrases in texts. The figure below illustrates how it works:</p>
<p>Upon data writing, the system tokenizes texts into <strong>terms</strong>, and stores these terms in a <strong>posting list</strong> which maps terms to the ID of the row where they exist. In text queries, the database finds the corresponding <strong>row ID</strong> of the keyword (term) in the posting list, and fetches the target row based on the row ID. By doing so, the system won't have to traverse the whole dataset and thus improves query speeds by orders of magnitudes.</p>
<p><img decoding=async loading=lazy alt=inverted-index src=/zh-CN/assets/images/Inverted_2-20f3d1267475f3074304b15f8a901db3.png width=961 height=720 class=img_ev3q></p>
<p>In inverted indexing of Elasticsearch, quick retrieval comes at the cost of writing speed, writing throughput, and storage space. Why? Firstly, tokenization, dictionary sorting, and inverted index creation are all CPU- and memory-intensive operations. Secondly, Elasticssearch has to store the original data, the inverted index, and an extra copy of data stored in columns for query acceleration. That's triple redundancy.</p>
<p>But without inverted index, Grafana Loki, for example, is hurting user experience with its slow queries, which is the biggest pain point for engineers in log analysis.</p>
<p>Simply put, Elasticsearch and Grafana Loki represent different tradeoffs between high writing throughput, low storage cost, and fast query performance. What if I tell you there is a way to have them all? We have introduced inverted indexes in <a href=https://github.com/apache/doris/issues/19231 target=_blank rel="noopener noreferrer">Apache Doris 2.0.0</a> and further optimized it to realize <strong>two times faster log query performance than Elasticsearch with 1/5 of the storage space it uses. Both factors combined, it is a 10 times better solution.</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=inverted-index-in-apache-doris>Inverted Index in Apache Doris<a href=#inverted-index-in-apache-doris class=hash-link aria-label="Inverted Index in Apache Doris的直接链接" title="Inverted Index in Apache Doris的直接链接">​</a></h2>
<p>Generally, there are two ways to implement indexes: <strong>external indexing system</strong> or <strong>built-in indexes</strong>.</p>
<p><strong>External indexing system:</strong> You connect an external indexing system to your database. In data ingestion, data is imported to both systems. After the indexing system creates indexes, it deletes the original data within itself. When data users input a query, the indexing system provides the IDs of the relevant data, and then the database looks up the target data based on the IDs.</p>
<p>Building an external indexing system is easier and less intrusive to the database, but it comes with some annoying flaws:</p>
<ul>
<li>The need to write data into two systems can result in data inconsistency and storage redundancy.</li>
<li>Interaction between the database and the indexing system brings overheads, so when the target data is huge, the query across the two systems can be slow.</li>
<li>It is exhausting to maintain two systems.</li>
</ul>
<p>In <a href=https://github.com/apache/doris target=_blank rel="noopener noreferrer">Apache Doris</a>, we opt for the other way. Built-in inverted indexes are more difficult to make, but once it is done, it is faster, more user-friendly, and trouble-free to maintain.</p>
<p>In Apache Doris, data is arranged in the following format. Indexes are stored in the Index Region:</p>
<p><img decoding=async loading=lazy alt=index-region-in-Apache-Doris src=/zh-CN/assets/images/Inverted_3-10be120b343f5721d2c3adb666ab16b2.png width=1054 height=324 class=img_ev3q></p>
<p>We implement inverted indexes in a non-intrusive manner:</p>
<ol>
<li><strong>Data ingestion & compaction</strong>: As a segment file is written into Doris, an inverted index file will be written, too. The index file path is determined by the segment ID and the index ID. Rows in segments correspond to the docs in indexes, so are the RowID and the DocID.</li>
<li><strong>Query</strong>: If the <code>where</code> clause includes a column with inverted index, the system will look up in the index file, return a DocID list, and convert the DocID list into a RowID Bitmap. Under the RowID filtering mechanism of Apache Doris, only the target rows will be read. This is how queries are accelerated.</li>
</ol>
<p><img decoding=async loading=lazy alt=non-intrusive-inverted-index src=/zh-CN/assets/images/Inverted_4-9de8707a87ec78e61f52142b043b512b.png width=1174 height=1126 class=img_ev3q></p>
<p>Such non-intrusive method separates the index file from the data files, so you can make any changes to the inverted indexes without worrying about affecting the data files themselves or other indexes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=optimizations-for-inverted-index>Optimizations for Inverted Index<a href=#optimizations-for-inverted-index class=hash-link aria-label="Optimizations for Inverted Index的直接链接" title="Optimizations for Inverted Index的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=general-optimizations>General Optimizations<a href=#general-optimizations class=hash-link aria-label="General Optimizations的直接链接" title="General Optimizations的直接链接">​</a></h3>
<p><strong>C++ Implementation and Vectorization</strong></p>
<p>Different from Elasticsearch, which uses Java, Apache Doris implements C++ in its storage modules, query execution engine, and inverted indexes. Compared to Java, C++ provides better performance, allows easier vectorization, and produces no JVM GC overheads. We have vectorized every step of inverted indexing in Apache Doris, such as tokenization, index creation, and queries. To provide you with a perspective, <strong>in inverted indexing, Apache Doris writes data at a speed of 20MB/s per core, which is four times that of Elasticsearch (5MB/s).</strong></p>
<p><strong>Columnar Storage & Compression</strong></p>
<p>Apache Lucene lays the foundation for inverted indexes in Elasticsearch. As Lucene itself is built to support file storage, it stores data in a row-oriented format.</p>
<p>In Apache Doris, inverted indexes for different columns are isolated from each other, and the inverted index files adopt columnar storage to facilitate vectorization and data compression.</p>
<p>By utilizing Zstandard compression, Apache Doris realizes a compression ratio ranging from <strong>5:1</strong> to <strong>10:1</strong>, faster compression speeds, and 50% less space usage than GZIP compression.</p>
<p><strong>BKD Trees for Numeric / Datetime Columns</strong></p>
<p>Apache Doris implements BKD trees for numeric and datetime columns. This not only increases performance of range queries, but is a more space-saving method than converting those columns to fixed-length strings. Other benefits of it include:</p>
<ol>
<li><strong>Efficient range queries</strong>: It is able to quickly locate the target data range in numeric and datetime columns.</li>
<li><strong>Less storage space</strong>: It aggregates and compresses adjacent data blocks to reduce storage costs.</li>
<li><strong>Support for multi-dimensional data</strong>: BKD trees are scalable and adaptive to multi-dimensional data types, such as GEO points and ranges.</li>
</ol>
<p>In addition to BKD trees, we have further optimized the queries on numeric and datetime columns.</p>
<ol>
<li><strong>Optimization for low-cardinality scenarios</strong>: We have fine-tuned the compression algorithm for low-cardinality scenarios, so decompressing and de-serializing large amounts of inverted lists will consume less CPU resources.</li>
<li><strong>Pre-fetching</strong>: For high-hit-rate scenarios, we adopt pre-fetching. If the hit rate exceeds a certain threshold, Doris will skip the indexing process and start data filtering.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=tailored-optimizations-to-olap>Tailored Optimizations to OLAP<a href=#tailored-optimizations-to-olap class=hash-link aria-label="Tailored Optimizations to OLAP的直接链接" title="Tailored Optimizations to OLAP的直接链接">​</a></h3>
<p>Log analysis is a simple kind of query with no need for advanced features (e.g. relevance scoring in Apache Lucene). The bread and butter capability of a log processing tool is quick queries and low storage cost. Therefore, in Apache Doris, we have streamlined the inverted index structure to meet the needs of an OLAP database.</p>
<ul>
<li>In data ingestion, we prevent multiple threads from writing data into the same index, and thus avoid overheads brought by lock contention.</li>
<li>We discard forward index files and Norm files to clear storage space and reduce I/O overheads.</li>
<li>We simplify the computation logic of relevance scoring and ranking to further reduce overheads and increase performance.</li>
</ul>
<p>In light of the fact that logs are partitioned by time range and historical logs are visited less frequently. We plan to provide more granular and flexible index management in future versions of Apache Doris:</p>
<ul>
<li><strong>Create inverted index for a specified data partition</strong>: create index for logs of the past seven days, etc.</li>
<li><strong>Delete</strong> <strong>inverted index for a specified data partition</strong>: delete index for logs from over one month ago, etc. (so as to clear out index space).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=benchmarking>Benchmarking<a href=#benchmarking class=hash-link aria-label=Benchmarking的直接链接 title=Benchmarking的直接链接>​</a></h2>
<p>We tested Apache Doris on publicly available datasets against Elasticsearch and ClickHouse.</p>
<p>For a fair comparison, we ensure uniformity of testing conditions, including benchmarking tool, dataset, and hardware.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=apache-doris-vs-elasticsearch>Apache Doris VS Elasticsearch<a href=#apache-doris-vs-elasticsearch class=hash-link aria-label="Apache Doris VS Elasticsearch的直接链接" title="Apache Doris VS Elasticsearch的直接链接">​</a></h3>
<p><strong>Benchmarking tool</strong>: ES Rally, the official testing tool for Elasticsearch</p>
<p><strong>Dataset</strong>: 1998 World Cup HTTP Server Logs (self-contained dataset in ES Rally)</p>
<p><strong>Data Size (Before Compression)</strong>: 32G, 247 million rows, 134 bytes per row (on average)</p>
<p><strong>Query</strong>:  11 queries including keyword search, range query, aggregation, and ranking; Each query is serially executed 100 times.</p>
<p><strong>Environment</strong>: 3 × 16C 64G cloud virtual machines</p>
<ul>
<li>
<p><strong>Results of Apache Doris</strong>:</p>
<ul>
<li>Writing Speed: 550 MB/s, <strong>4.2 times that of Elasticsearch</strong></li>
<li>Compression Ratio: 10:1</li>
<li>Storage Usage: <strong>20% that of Elasticsearch</strong></li>
<li>Response Time: <strong>43% that of Elasticsearch</strong></li>
</ul>
</li>
</ul>
<p><img decoding=async loading=lazy alt=Apache-Doris-VS-Elasticsearch src=/zh-CN/assets/images/Inverted_5-d5600afe9c83f8ade57180eaa1104e8e.png width=1592 height=680 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=apache-doris-vs-clickhouse>Apache Doris VS ClickHouse<a href=#apache-doris-vs-clickhouse class=hash-link aria-label="Apache Doris VS ClickHouse的直接链接" title="Apache Doris VS ClickHouse的直接链接">​</a></h3>
<p>As ClickHouse launched inverted index as an experimental feature in v23.1, we tested Apache Doris with the same dataset and SQL as described in the ClickHouse <a href=https://clickhouse.com/blog/clickhouse-search-with-inverted-indices target=_blank rel="noopener noreferrer">blog</a>, and compared performance of the two under the same testing resource, case, and tool.</p>
<p><strong>Data</strong>: 6.7G, 28.73 million rows, the Hacker News dataset, Parquet format</p>
<p><strong>Query</strong>:  3 keyword searches, counting the number of occurrence of the keywords "ClickHouse", "OLAP" OR "OLTP", and "avx" AND "sve".</p>
<p><strong>Environment</strong>: 1 × 16C 64G cloud virtual machine</p>
<p><strong>Result</strong>: Apache Doris was <strong>4.7 times, 12 times, 18.5 times</strong> faster than ClickHouse in the three queries, respectively.</p>
<p><img decoding=async loading=lazy alt=Apache-Doris-VS-ClickHouse src=/zh-CN/assets/images/Inverted_6-a3e009f32ae1d0a25a40f257c04b8878.png width=1546 height=626 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=usage--example>Usage & Example<a href=#usage--example class=hash-link aria-label="Usage & Example的直接链接" title="Usage & Example的直接链接">​</a></h2>
<p><strong>Dataset</strong>: one million comment records from Hacker News</p>
<ul>
<li>
<p><strong>Step 1</strong>: Specify inverted index to the data table upon table creation.</p>
</li>
<li>
<p><strong>Parameters</strong>:</p>
</li>
<li>
<ul>
<li>INDEX idx_comment (<code>comment</code>): create an index named "idx_comment" comment for the "comment" column</li>
<li>USING INVERTED: specify inverted index for the table</li>
<li>PROPERTIES("parser" = "english"): specify the tokenization language to English</li>
</ul>
</li>
</ul>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> hackernews_1m</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">deleted</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TINYINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">type</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">author</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">timestamp</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> DateTimeV2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">comment</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">dead</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TINYINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">parent</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">poll</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">children</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> Array</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BIGINT</span><span class="token operator">></span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">url</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">score</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">title</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">parts</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> Array</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token operator">></span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">descendants</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> idx_comment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">comment</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> INVERTED PROPERTIES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"parser"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"english"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'inverted index for comment'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"replication_num"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Note: You can add index to an existing table via <code>ADD INDEX idx_comment ON hackernews_1m(</code>comment<code>) USING INVERTED PROPERTIES("parser" = "english") </code>. Different from that of smart index and secondary index, the creation of inverted index only involves the reading of the comment column, so it can be much faster.</p>
<p><strong>Step 2</strong>: Retrieve the words"OLAP" and "OLTP" in the comment column with <code>MATCH_ALL</code>. The response time here was 1/10 of that in hard matching with <code>like</code>. (The performance gap widens as data volume increases.)</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> hackernews_1m </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">comment</span><span class="token plain"> </span><span class="token operator">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'%OLAP%'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">comment</span><span class="token plain"> </span><span class="token operator">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'%OLTP%'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">15</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.13</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mysql</span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> hackernews_1m </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">comment</span><span class="token plain"> MATCH_ALL </span><span class="token string" style="color:rgb(255, 121, 198)">'OLAP OLTP'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">15</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token operator">+</span><span class="token comment" style="color:rgb(98, 114, 164)">---------+</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">row</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>For more feature introduction and usage guide, see documentation: <a href=https://doris.apache.org/docs/dev/data-table/index/inverted-index/ target=_blank rel="noopener noreferrer">Inverted Index</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=wrap-up>Wrap-up<a href=#wrap-up class=hash-link aria-label=Wrap-up的直接链接 title=Wrap-up的直接链接>​</a></h2>
<p>In a word, what contributes to Apache Doris' 10-time higher cost-effectiveness than Elasticsearch is its OLAP-tailored optimizations for inverted indexing, supported by the columnar storage engine, massively parallel processing framework, vectorized query engine, and cost-based optimizer of Apache Doris.</p>
<p>As proud as we are about our own inverted indexing solution, we understand that self-published benchmarks can be controversial, so we are open to <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">feedback</a> from any third-party users and see how <a href=https://github.com/apache/doris target=_blank rel="noopener noreferrer">Apache Doris</a> works in real-world cases.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/How-We-Increased-Database-Query-Concurrency-by-20-Times/>How We increased database query concurrency by 20 times</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2023-04-14T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2023年4月14日</time></div></header><div class=markdown itemprop=articleBody><p>A unified analytic database is the holy grail for data engineers, but what does it look like specifically? It should evolve with the needs of data users.</p>
<p>Vertically, companies now have an ever enlarging pool of data and expect a higher level of concurrency in data processing. Horizontally, they require a wider range of data analytics services. Besides traditional OLAP scenarios such as statistical reporting and ad-hoc queries, they are also leveraging data analysis in recommender systems, risk control, customer tagging and profiling, and IoT.</p>
<p>Among all these data services, point queries are the most frequent operations conducted by data users. Point query means to retrieve one or several rows from the database based on the Key. A point query only returns a small piece of data, such as the details of a shopping order, a transaction, a consumer profile, a product description, logistics status, and so on. Sounds easy, right? But the tricky part is, <strong>a database often needs to handle tens of thousands of point queries at a time and respond to all of them in milliseconds</strong>.</p>
<p>Most current OLAP databases are built with a columnar storage engine to process huge data volumes. They take pride in their high throughput, but often underperform in high-concurrency scenarios. As a complement, many data engineers invite Key-Value stores like Apache HBase for point queries, and Redis as a cache layer to ease the burden. The downside is redundant storage and high maintenance costs.</p>
<p>Since Apache Doris was born, we have been striving to make it a unified database for data queries of all sizes, including ad-hoc queries and point queries. Till now, we have already taken down the monster of high-throughput OLAP scenarios. In the upcoming Apache Doris 2.0, we have optimized it for high-concurrency point queries. Long story short, it can achieve over 30,000 QPS for a single node.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=five-ways-to-accelerate-high-concurrency-queries>Five Ways to Accelerate High-Concurrency Queries<a href=#five-ways-to-accelerate-high-concurrency-queries class=hash-link aria-label="Five Ways to Accelerate High-Concurrency Queries的直接链接" title="Five Ways to Accelerate High-Concurrency Queries的直接链接">​</a></h2>
<p>High-concurrency queries are thorny because you need to handle high loads with limited system resources. That means you have to reduce the CPU, memory and I/O overheads of a single SQL as much as possible. The key is to minimize the scanning of underlying data and follow-up computing.</p>
<p>Apache Doris uses five methods to achieve higher QPS.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=partioning-and-bucketing>Partioning and Bucketing<a href=#partioning-and-bucketing class=hash-link aria-label="Partioning and Bucketing的直接链接" title="Partioning and Bucketing的直接链接">​</a></h3>
<p>Apache Doris shards data into a two-tiered structure: Partition and Bucket. You can use time information as the Partition Key. As for bucketing, you distribute the data into various nodes after data hashing. A wise bucketing plan can largely increase concurrency and throughput in data reading.</p>
<p>This is an example:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> user_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> id </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">5122</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> create_date </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2022-01-01'</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>In this case, the user has set 10 buckets. <code>create_date</code> is the Partition Key and <code>id</code> is the Bucket Key. After dividing the data into partitions and buckets, the system only needs to scan one bucket in one partition before it can locate the needed data. This is a huge time saver.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=index>Index<a href=#index class=hash-link aria-label=Index的直接链接 title=Index的直接链接>​</a></h3>
<p>Apache Doris uses various data indexes to speed up data reading and filtering, including smart indexes and secondary indexes. Smart indexes are auto-generated by Doris upon data ingestion, which requires no action from the user's side.</p>
<p>There are two types of smart indexes:</p>
<ul>
<li><strong>Sorted Index</strong>: Apache Doris stores data in an orderly way. It creates a sorted index for every 1024 rows of data. The Key in the index is the value of the sorted column in the first row of the current 1024 rows. If the query involves the sorted column, the system will locate the first row of the relevant 1024 row group and start scanning there.</li>
<li><strong>ZoneMap Index</strong>: These are indexes on the Segment and Page level. The maximum and minimum values of each column within a Page will be recorded, so are those within a Segment. Hence, in equivalence queries and range queries, the system can narrow down the filter range with the help of the MinMax indexes.</li>
</ul>
<p>Secondary indexes are created by users. These include Bloom Filter indexes, Bitmap indexes, <a href=https://doris.apache.org/docs/dev/data-table/index/inverted-index/ target=_blank rel="noopener noreferrer">Inverted indexes</a>, and <a href=https://doris.apache.org/docs/dev/data-table/index/ngram-bloomfilter-index/ target=_blank rel="noopener noreferrer">NGram Bloom Filter indexes</a>. (If you are interested, I will go into details about them in future articles.)</p>
<p>Example:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> user_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> id </span><span class="token operator">></span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> id </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">1024</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Suppose that the user has designated <code>id</code> as the Key during table creation, the data will be sorted by <code>id</code> on Memtable and the disks. So any queries involving <code>id</code> as a filter condition will be executed much faster with the aid of sorted indexes. Specifically, the data in storage will be put into multiple ranges based on <code>id</code>, and the system will implement binary search to locate the exact range according to the sorted indexes. But that could still be a large range since the sorted indexes are sparse. You can further narrow it down based on ZoneMap indexes, Bloom Filter indexes, and Bitmap indexes.</p>
<p>This is another way to reduce data scanning and improve overall concurrency of the system.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=materialized-view>Materialized View<a href=#materialized-view class=hash-link aria-label="Materialized View的直接链接" title="Materialized View的直接链接">​</a></h3>
<p>The idea of materialized view is to trade space for time: You execute pre-computation with pre-defined SQL statements, and perpetuate the results in a table that is visible to users but occupies some storage space. In this way, Apache Doris can respond much faster to queries for aggregated data and breakdown data and those involve the matching of sorted indexes once it hits a materialized view. This is a good way to lessen computation, improve query performance, and reduce resource consumption.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">// For an aggregation query, the system reads the pre-aggregated columns in the materialized view.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">create</span><span class="token plain"> materialized </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">view</span><span class="token plain"> store_amt </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> store_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sale_amt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> sales_records </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> store_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> store_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sale_amt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> sales_records </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> store_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// For a query where k3 matches the sorted column in the materialized view, the system directly performs the query on the materialized view. </span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> MATERIALIZED </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VIEW</span><span class="token plain"> mv_1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> k3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> k2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> k1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> tableA </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> k3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> k1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> k2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> k3 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">table</span><span class="token plain"> A </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> k3</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=runtime-filter>Runtime Filter<a href=#runtime-filter class=hash-link aria-label="Runtime Filter的直接链接" title="Runtime Filter的直接链接">​</a></h3>
<p>Apart from filtering data by indexes, Apache Doris has a dynamic filtering mechanism: Runtime Filter.</p>
<p>In multi-table Join queries, the left table is usually called ProbeTable while the right one is called BuildTable, with the former much bigger than the latter. In query execution, firstly, the system reads the right table and creates a HashTable (Build) in the memory. Then, it starts reading the left table row by row, during which it also compares data between the left table and the HashTable and returns the matched data (Probe).</p>
<p>So what's new about that in Apache Doris? During the creation of HashTable, Apache Doris generates a filter for the columns. It can be a Min/Max filter or an IN filter. Then it pushes down the filter to the left table, which can use the filter to screen out data and thus reduces the amount of data that the Probe node has to transfer and compare.</p>
<p>This is how the Runtime Filter works. In most Join queries, the Runtime Filter can be automatically pushed down to the most underlying scan nodes or to the distributed Shuffle Join. In other words, Runtime Filter is able to reduce data reading and shorten response time for most Join queries.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=top-n-optimization>TOP-N Optimization<a href=#top-n-optimization class=hash-link aria-label="TOP-N Optimization的直接链接" title="TOP-N Optimization的直接链接">​</a></h3>
<p>TOP-N query is a frequent scenario in data analysis. For example, users want to fetch the most recent 100 orders, or the 5 highest/lowest priced products. The performance of such queries determines the quality of real-time analysis. For them, Apache Doris implements TOP-N optimization. Here is how it goes:</p>
<ol>
<li>Apache Doris reads the sorted fields and query fields from the Scanner layer, reserves only the TOP-N pieces of data by means of Heapsort, updates the real-time TOP-N results as it continues reading, and dynamically pushes them down to the Scanner.</li>
<li>Combing the received TOP-N range and the indexes, the Scanner can skip a large proportion of irrelevant files and data chunks and only read a small number of rows.</li>
<li>Queries on flat tables usually mean the need to scan massive data, but TOP-N queries only retrieve a small amount of data. The strategy here is to divide the data reading process into two stages. In stage one, the system sorts the data based on a few columns (sorted column, or condition column) and locates the TOP-N rows. In stage two, it fetches the TOP-N rows of data after data sorting, and then it retrieves the target data according to the row numbers.</li>
</ol>
<p>To sum up, Apache Doris prunes the data that needs to be read and sorted, and thus substantially reduces consumption of I/O, CPU, and memory resources.</p>
<p>In addition to the foregoing five methods, Apache Doris also improves concurrency by SQL Cache, Partition Cache, and a variety of Join optimization techniques.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=how-we-bring-concurrency-to-the-next-level>How We Bring Concurrency to the Next Level<a href=#how-we-bring-concurrency-to-the-next-level class=hash-link aria-label="How We Bring Concurrency to the Next Level的直接链接" title="How We Bring Concurrency to the Next Level的直接链接">​</a></h2>
<p>By adopting the above methods, Apache Doris was able to achieve thousands of QPS per node. However, in scenarios requiring tens of thousands of QPS, it was still bottlenecked by several issues:</p>
<ul>
<li>With Doris' columnar storage engine, it was inconvenient to read rows. In flat table models, columnar storage could result in much larger I/O usage.</li>
<li>The execution engine and query optimizer of OLAP databases were sometimes too complicated for simple queries (point queries, etc.). Such queries needed to be processed with a shorter pipeline, which should be considered in query planning.</li>
<li>FE modules of Doris, implementing Java, were responsible for interfacing with SQL requests and parsing query plans. These processes could produce high CPU overheads in high-concurrency scenarios.</li>
</ul>
<p>We optimized Apache Doris to solve these problems. (<a href=https://github.com/apache/doris/pull/15491 target=_blank rel="noopener noreferrer">Pull Request on Github</a>)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=row-storage-format>Row Storage Format<a href=#row-storage-format class=hash-link aria-label="Row Storage Format的直接链接" title="Row Storage Format的直接链接">​</a></h3>
<p>As we know, row storage is much more efficient when the user only queries for a single row of data. So we introduced row storage format in Apache Doris 2.0. Users can enable row storage by specifying the following property in the table creation statement.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token string" style="color:rgb(255, 121, 198)">"store_row_column"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"true"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>We chose JSONB as the encoding format for row storage for three reasons:</p>
<ul>
<li><strong>Flexible schema change</strong>: If a user has added or deleted a field, or modified the type of a field, these changes must be updated in row storage in real time. So we choose to adopt the JSONB format and encode columns into JSONB fields. This makes changes in fields very easy.</li>
<li><strong>High performance</strong>:  Accessing rows in row-oriented storage is much faster than doing that in columnar storage, and it requires much less disk access in high-concurrency scenarios. Also, in some cases, you can map the column ID to the corresponding JSONB value so you can quickly access a certain column.</li>
<li><strong>Less storage space</strong>: JSONB is a compacted binary format. It consumes less space on the disk and is more cost-effective.</li>
</ul>
<p>In the storage engine, row storage will be stored as a hidden column (DORIS_ROW_STORE_COL). During Memtable Flush, the columns will be encoded into JSONB and cached into this hidden column. In data reading, the system uses the Column ID to locate the column, finds the target row based on the row number, and then deserializes the relevant columns.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=short-circuit>Short-Circuit<a href=#short-circuit class=hash-link aria-label=Short-Circuit的直接链接 title=Short-Circuit的直接链接>​</a></h3>
<p>Normally, an SQL statement is executed in three steps:</p>
<ol>
<li>SQL Parser parses the statement to generate an abstract syntax tree (AST).</li>
<li>The Query Optimizer produces an executable plan.</li>
<li>Execute the plan and return the results.</li>
</ol>
<p>For complex queries on massive data, it is better to follow the plan created by the Query Optimizer. However, for high-concurrency point queries requiring low latency, that plan is not only unnecessary but also brings extra overheads. That's why we implement a short-circuit plan for point queries.</p>
<p><img decoding=async loading=lazy alt=short-circuit-plan src=/zh-CN/assets/images/high-concurrency_1-90fb6261659bb3cce5ad8076fa9dc65d.png width=1606 height=778 class=img_ev3q></p>
<p>Once the FE receives a point query request, a short-circuit plan will be produced. It is a lightweight plan that involves no equivalent transformation, logic optimization or physical optimization. Instead, it conducts some basic analysis on the AST, creates a fixed plan accordingly, and finds ways to reduce overhead of the optimizer.</p>
<p>For a simple point query involving primary keys, such as <code>select * from tbl where pk1 = 123 and pk2 = 456</code>, since it only involves one single Tablet, it is better to use a lightweight RPC interface for interaction with the Storage Engine. This avoids the creation of a complicated Fragment Plan and eliminates the performance overhead brought by the scheduling under the MPP query framework.</p>
<p>Details of the RPC interface are as follows:</p>
<div class="language-Java language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">message </span><span class="token class-name">PTabletKeyLookupRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    required int64 tablet_id </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    repeated </span><span class="token class-name">KeyTuple</span><span class="token plain"> key_tuples </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optional </span><span class="token class-name">Descriptor</span><span class="token plain"> desc_tbl </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optional </span><span class="token class-name">ExprList</span><span class="token plain">  output_expr </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">message </span><span class="token class-name">PTabletKeyLookupResponse</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    required </span><span class="token class-name">PStatus</span><span class="token plain"> status </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optional bytes row_batch </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optional bool empty_batch </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">rpc </span><span class="token function" style="color:rgb(80, 250, 123)">tablet_fetch_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">PTabletKeyLookupRequest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> returns </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">PTabletKeyLookupResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>tablet_id</code> is calculated based on the primary key column, while <code>key_tuples</code> is the string format of the primary key. In this example, the <code>key_tuples</code> is similar to ['123', '456']. As BE receives the request, <code>key_tuples</code> will be encoded into primary key storage format. Then, it will locate the corresponding row number of the Key in the Segment File with the help of the primary key index, and check if that row exists in <code>delete bitmap</code>. If it does, the row number will be returned; if not, the system returns NotFound. The returned row number will be used for point query on <code>__DORIS_ROW_STORE_COL__</code>. That means we only need to locate one row in that column, fetch the original value of the JSONB format, and deserialize it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=prepared-statement>Prepared Statement<a href=#prepared-statement class=hash-link aria-label="Prepared Statement的直接链接" title="Prepared Statement的直接链接">​</a></h3>
<p>In high-concurrency queries, part of the CPU overhead comes from SQL analysis and parsing in FE. To reduce such overhead, in FE, we provide prepared statements that are fully compatible with MySQL protocol. With prepared statements, we can achieve a four-time performance increase for primary key point queries.</p>
<p><img decoding=async loading=lazy alt=prepared-statement-map src=/zh-CN/assets/images/high-concurrency_2-24db356001a7e9c6276202b59ce09d03.png width=1280 height=775 class=img_ev3q></p>
<p>The idea of prepared statements is to cache precomputed SQL and expressions in HashMap in memory, so they can be directly used in queries when applicable.</p>
<p>Prepared statements adopt MySQL binary protocol for transmission. The protocol is implemented in the mysql_row_buffer.[h|cpp] file, and uses MySQL binary encoding. Under this protocol, the client (for example, JDBC Client) sends a pre-compiled statement to FE via <code>PREPARE</code> MySQL Command. Next, FE will parse and analyze the statement and cache it in the HashMap as shown in the figure above. Next, the client, using <code>EXECUTE</code> MySQL Command, will replace the placeholder, encode it into binary format, and send it to FE. Then, FE will perform deserialization to obtain the value of the placeholder, and generate query conditions.</p>
<p><img decoding=async loading=lazy alt=prepared-statement-execution src=/zh-CN/assets/images/high-concurrency_3-78f37932ab22095589cd35e1829eba6b.png width=1134 height=904 class=img_ev3q></p>
<p>Apart from caching prepared statements in FE, we also cache reusable structures in BE. These structures include pre-allocated computation blocks, query descriptors, and output expressions. Serializing and deserializing these structures often cause a CPU hotspot, so it makes more sense to cache them. The prepared statement for each query comes with a UUID named CacheID. So when BE executes the point query, it will find the corresponding class based on the CacheID, and then reuse the structure in computation.</p>
<p>The following example demonstrates how to use a prepared statement in JDBC:</p>
<ol>
<li>Set a JDBC URL and enable prepared statement at the server end.</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">url = jdbc:mysql://127.0.0.1:9030/ycsb?useServerPrepStmts=true</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol>
<li>Use a prepared statement.</li>
</ol>
<div class="language-Java language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">// Use `?` as placeholder, reuse readStatement.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">PreparedStatement</span><span class="token plain"> readStatement </span><span class="token operator">=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">prepareStatement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"select * from tbl_point_query where key = ?"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">readStatement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setInt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1234</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token class-name">ResultSet</span><span class="token plain"> resultSet </span><span class="token operator">=</span><span class="token plain"> readStatement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">executeQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">readStatement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setInt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1235</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">resultSet </span><span class="token operator">=</span><span class="token plain"> readStatement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">executeQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=row-storage-cache>Row Storage Cache<a href=#row-storage-cache class=hash-link aria-label="Row Storage Cache的直接链接" title="Row Storage Cache的直接链接">​</a></h3>
<p>Apache Doris has a Page Cache feature, where each page caches the data of one column.</p>
<p><img decoding=async loading=lazy alt=page-cache src=/zh-CN/assets/images/high-concurrency_4-3a2f6a6b077605a579c5b00560e0cffb.png width=568 height=540 class=img_ev3q></p>
<p>As mentioned above, we have introduced row storage in Doris. The problem with this is, one row of data consists of multiple columns, so in the case of big queries, the cached data might be erased. Thus, we also introduced row cache to increase row cache hit rate.</p>
<p>Row cache reuses the LRU Cache mechanism in Apache Doris. When the caching starts, the system will initialize a threshold value. If that threshold is hit, the old cached rows will be phased out. For a primary key query statement, the performance gap between cache hit and cache miss can be huge (we are talking about dozens of times less disk I/O and memory access here). So the introduction of row cache can remarkably enhance point query performance.</p>
<p><img decoding=async loading=lazy alt=row-cache src=/zh-CN/assets/images/high-concurrency_5-91a7b2adc421fb31c47d89f638adecf6.png width=468 height=500 class=img_ev3q></p>
<p>To enable row cache, you can specify the following configuration in BE:</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">disable_storage_row_cache=</span><span class="token boolean">false</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// This specifies whether to enable row cache; it is set to false by default.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">row_cache_mem_limit=</span><span class="token number">20</span><span class="token plain">% </span><span class="token comment" style="color:rgb(98, 114, 164)">// This specifies the percentage of row cache in the memory; it is set to 20% by default.</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=benchmark-performance>Benchmark Performance<a href=#benchmark-performance class=hash-link aria-label="Benchmark Performance��的直接链接" title="Benchmark Performance的直接链接">​</a></h2>
<p>We tested Apache Doris with YCSB (Yahoo! Cloud Serving Benchmark) to see how all these optimizations work.</p>
<p><strong>Configurations and data size:</strong></p>
<ul>
<li>Machines: a single 16 Core 64G cloud server with 4×1T hard drives</li>
<li>Cluster size: 1 Frontend + 2 Backends</li>
<li>Data volume: 100 million rows of data, with each row taking 1KB to store; preheated</li>
<li>Table schema and query statement:</li>
</ul>
<div class="language-JavaScript language-javascript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">// Table creation statement:</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">CREATE</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">TABLE</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">usertable</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">YCSB_KEY</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">255</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">FIELD0</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> text </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">FIELD1</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> text </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">FIELD2</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> text </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">FIELD3</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> text </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">FIELD4</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> text </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">FIELD5</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> text </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">FIELD6</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> text </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">FIELD7</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> text </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">FIELD8</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> text </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">FIELD9</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"> text </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">ENGINE</span><span class="token operator">=</span><span class="token constant" style="color:rgb(189, 147, 249)">OLAP</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">UNIQUE</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">YCSB_KEY</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'OLAP'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">DISTRIBUTED</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">BY</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">YCSB_KEY</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">BUCKETS</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">PROPERTIES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"replication_allocation"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tag.location.default: 1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"in_memory"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"false"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"persistent"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"false"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"storage_format"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"V2"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"enable_unique_key_merge_on_write"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"true"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"light_schema_change"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"true"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"store_row_column"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"true"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"disable_auto_compaction"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"false"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Query statement:</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> usertable </span><span class="token constant" style="color:rgb(189, 147, 249)">WHERE</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">YCSB_KEY</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>We run the test with the optimizations (row storage, short-circuit, and prepared statement) enabled, and then did it again with all of them disabled. Here are the results:</p>
<p><img decoding=async loading=lazy alt=performance-before-and-after-concurrency-optimization src=/zh-CN/assets/images/high-concurrency_6-6c3bbd4d2c6e6a54db40297c2154a9da.png width=1280 height=653 class=img_ev3q></p>
<p>With optimizations enabled, <strong>the average query latency decreased by a whopping 96%, the 99th percentile latency was only 1/28 of that without optimizations, and it has achieved a query concurrency of over 30,000 QPS.</strong> This is a huge leap in performance and an over 20-time increase in concurrency.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=best-practice>Best Practice<a href=#best-practice class=hash-link aria-label="Best Practice的直接链接" title="Best Practice的直接链接">​</a></h2>
<p>It should be noted that these optimizations for point queries are implemented in the Unique Key model of Apache Doris, and you should enable Merge-on-Write and Light Schema Change for this model.</p>
<p>This is a table creation statement example for point queries:</p>
<div class="language-undefined codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-undefined codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE TABLE `usertable` (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `USER_KEY` BIGINT NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `FIELD0` text NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `FIELD1` text NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `FIELD2` text NULL,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  `FIELD3` text NULL</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">) ENGINE=OLAP</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">UNIQUE KEY(`USER_KEY`)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">COMMENT 'OLAP'</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">DISTRIBUTED BY HASH(`USER_KEY`) BUCKETS 16</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">"enable_unique_key_merge_on_write" = "true",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">"light_schema_change" = "true",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">"store_row_column" = "true",</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">); </span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Note:</strong></p>
<ul>
<li>Enable <code>light_schema_change</code> to support JSONB row storage for encoding ColumnID</li>
<li>Enable <code>store_row_column</code> to store row storage format</li>
</ul>
<p>For a primary key-based point query like the one below, after table creation, you can use row storage and short-circuit execution to improve performance to a great extent.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> usertable </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> USER_KEY </span><span class="token operator">=</span><span class="token plain"> xxx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>To further unleash performance, you can apply prepared statement. If you have enough memory space, you can also enable row cache in the BE configuration.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label=Conclusion的直接链接 title=Conclusion的直接链接>​</a></h2>
<p>In high-concurrency scenarios, Apache Doris realizes over 30,000 QPS per node after optimizations including row storage, short-circuit, prepared statement, and row cache. Also, Apache Doris is easily scaled out since it is built on MPP architecture, on top of which you can scale it up by upgrading the hardware and machine configuration. This is how Apache Doris manages to achieve both high throughput and high concurrency. It allows you to deal with various data analytic workloads on one single platform and experience quick data analytics for various scenarios. Thanks to the great efforts of the Apache Doris community and a group of excellent SelectDB engineers, Apache Doris 2.0 is about to be released soon.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Building-the-Next-Generation-Data-Lakehouse-10X-Performance/>Building the next-generation data lakehouse: 10X performance</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2023-03-14T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2023年3月14日</time></div></header><div class=markdown itemprop=articleBody><p>A data warehouse was defined by Bill Inmon as "a subject-oriented, integrated, nonvolatile, and time-variant collection of data in support of management's decisions" over 30 years ago. However, the initial data warehouses unable to store massive heterogeneous data, hence the creation of data lakes. In modern times, data lakehouse emerges as a new paradigm. It is an open data management architecture featured by strong data analytics and governance capabilities, high flexibility, and open storage.</p>
<p>If I could only use one word to describe the next-gen data lakehouse, it would be <strong>unification:</strong></p>
<ul>
<li><strong>Unified data storage</strong> to avoid the trouble and risks brought by redundant storage and cross-system ETL.</li>
<li><strong>Unified governance</strong> of both data and metadata with support for ACID, Schema Evolution, and Snapshot.</li>
<li><strong>Unified data application</strong> that supports data access via a single interface for multiple engines and workloads.</li>
</ul>
<p>Let's look into the architecture of a data lakehouse. We will find that it is not only supported by table formats such as Apache Iceberg, Apache Hudi, and Delta Lake, but more importantly, it is powered by a high-performance query engine to extract value from data.</p>
<p>Users are looking for a query engine that allows quick and smooth access to the most popular data sources. What they don't want is for their data to be locked in a certain database and rendered unavailable for other engines or to spend extra time and computing costs on data transfer and format conversion.</p>
<p>To turn these visions into reality, a data query engine needs to figure out the following questions:</p>
<ul>
<li>How to access more data sources and acquire metadata more easily?</li>
<li>How to improve query performance on data coming from various sources?</li>
<li>How to enable more flexible resource scheduling and workload management?</li>
</ul>
<p><a href=https://github.com/apache/doris target=_blank rel="noopener noreferrer">Apache Doris</a> provides a possible answer to these questions. It is a real-time OLAP database that aspires to build itself into a unified data analysis gateway. This means it needs to be easily connected to various RDBMS, data warehouses, and data lake engines (such as Hive, Iceberg, Hudi, Delta Lake, and Flink Table Store) and allow for quick data writing from and queries on these heterogeneous data sources. The rest of this article is an in-depth explanation of Apache Doris' techniques in the above three aspects: metadata acquisition, query performance optimization, and resource scheduling.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=metadata-acquisition-and-data-access>Metadata Acquisition and Data Access<a href=#metadata-acquisition-and-data-access class=hash-link aria-label="Metadata Acquisition and Data Access的直接链接" title="Metadata Acquisition and Data Access的直接链接">​</a></h2>
<p>Apache Doris 1.2.2 supports a wide variety of data lake formats and data access from various external data sources. Besides, via the Table Value Function, users can analyze files in object storage or HDFS directly.</p>
<p><img decoding=async loading=lazy alt=data-sources-supported-in-data-lakehouse src=/zh-CN/assets/images/Lakehouse_1-3be8649464d93663ca4b474a8ce1d669.png width=1598 height=882 class=img_ev3q></p>
<p>To support multiple data sources, Apache Doris puts efforts into metadata acquisition and data access.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=metadata-acquisition>Metadata Acquisition<a href=#metadata-acquisition class=hash-link aria-label="Metadata Acquisition的直接链接" title="Metadata Acquisition的直接链接">​</a></h3>
<p>Metadata consists of information about the databases, tables, partitions, indexes, and files from the data source. Thus, metadata of various data sources come in different formats and patterns, adding to the difficulty of metadata connection. An ideal metadata acquisition service should include the following:</p>
<ol>
<li>A <strong>metadata structure</strong> that can accommodate heterogeneous metadata.</li>
<li>An <strong>extensible metadata connection framework</strong> that enables quick and low-cost data connection.</li>
<li>Reliable and <strong>efficient</strong> <strong>metadata access</strong> that supports real-time metadata capture.</li>
<li><strong>Custom authentication</strong> services to interface with external privilege management systems and thus reduce migration costs.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=metadata-structure>Metadata Structure<a href=#metadata-structure class=hash-link aria-label="Metadata Structure的直接链接" title="Metadata Structure的直接链接">​</a></h4>
<p>Older versions of Doris support a two-tiered metadata structure: database and table. As a result, users need to create mappings for external databases and tables one by one, which is heavy work. Thus, Apache Doris 1.2.0 introduced the Multi-Catalog functionality. With this, you can map to external data at the catalog level, which means:</p>
<ol>
<li>You can map to the whole external data source and ingest all metadata from it.</li>
<li>You can manage the properties of the specified data source at the catalog level, such as connection, privileges, and data ingestion details, and easily handle multiple data sources.</li>
</ol>
<p><img decoding=async loading=lazy alt=metadata-structure src=/zh-CN/assets/images/Lakehouse_2-c1381100fe5007d6e3ee17ef81245112.png width=1280 height=650 class=img_ev3q></p>
<p>Data in Doris falls into two types of catalogs:</p>
<ol>
<li>Internal Catalog: Existing Doris databases and tables all belong to the Internal Catalog.</li>
<li>External Catalog: This is used to interface with external data sources. For example, HMS External Catalog can be connected to a cluster managed by Hive Metastore, and Iceberg External Catalog can be connected to an Iceberg cluster.</li>
</ol>
<p>You can use the <code>SWITCH</code> statement to switch catalogs. You can also conduct federated queries using fully qualified names. For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">SELECT * FROM hive.db1.tbl1 a JOIN iceberg.db2.tbl2 b</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">ON a.k1 = b.k1;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>See more details <a href=https://doris.apache.org/docs/dev/lakehouse/multi-catalog/ target=_blank rel="noopener noreferrer">here</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=extensible-metadata-connection-framework><strong>Extensible Metadata Connection Framework</strong><a href=#extensible-metadata-connection-framework class=hash-link aria-label=extensible-metadata-connection-framework的直接链接 title=extensible-metadata-connection-framework的直接链接>​</a></h4>
<p>The introduction of the catalog level also enables users to add new data sources simply by using the <code>CREATE CATALOG</code> statement:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">CREATE CATALOG hive PROPERTIES (</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    'type'='hms',</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    'hive.metastore.uris' = 'thrift://172.21.0.1:7004',</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">);</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>In data lake scenarios, Apache Doris currently supports the following metadata services:</p>
<ul>
<li>Hive Metastore-compatible metadata services</li>
<li>Alibaba Cloud Data Lake Formation</li>
<li>AWS Glue</li>
</ul>
<p>This also paves the way for developers who want to connect to more data sources via External Catalog. All they need is to implement the access interface.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=efficient-metadata-access><strong>Efficient Metadata Access</strong><a href=#efficient-metadata-access class=hash-link aria-label=efficient-metadata-access的直接链接 title=efficient-metadata-access的直接链接>​</a></h4>
<p>Access to external data sources is often hindered by network conditions and data resources. This requires extra efforts of a data query engine to guarantee reliability, stability, and real-timeliness in metadata access.</p>
<p><img decoding=async loading=lazy alt=metadata-access-Hive-MetaStore src=/zh-CN/assets/images/Lakehouse_3-9539a868abd98e4fa92881ef8c32b38a.png width=1280 height=472 class=img_ev3q></p>
<p>Doris enables high efficiency in metadata access by <strong>Meta Cache</strong>, which includes Schema Cache, Partition Cache, and File Cache. This means that Doris can respond to metadata queries on thousands of tables in milliseconds. In addition, Doris supports manual refresh of metadata at the Catalog/Database/Table level. Meanwhile, it enables auto synchronization of metadata in Hive Metastore by monitoring Hive Metastore Event, so any changes can be updated within seconds.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=custom-authorization><strong>Custom Authorization</strong><a href=#custom-authorization class=hash-link aria-label=custom-authorization的直接链接 title=custom-authorization的直接链接>​</a></h4>
<p>External data sources usually come with their own privilege management services. Many companies use one single tool (such as Apache Ranger) to provide authorization for their multiple data systems. Doris supports a custom authorization plugin, which can be connected to the user's own privilege management system via the Doris Access Controller interface. As a user, you only need to specify the authorization plugin for a newly created catalog, and then you can readily perform authorization, audit, and data encryption on external data in Doris.</p>
<p><img decoding=async loading=lazy alt=custom-authorization src=/zh-CN/assets/images/Lakehouse_4-1f3438ed8d88966a5352a85b1b479057.png width=1280 height=568 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=data-access>Data Access<a href=#data-access class=hash-link aria-label="Data Access的直接链接" title="Data Access的直接链接">​</a></h3>
<p>Doris supports data access to external storage systems, including HDFS and S3-compatible object storage:</p>
<p><img decoding=async loading=lazy alt=access-to-external-storage-systems src=/zh-CN/assets/images/Lakehouse_5-3407cba9da2ea30688926b5e6ade10f5.png width=1490 height=610 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=query-performance-optimization>Query Performance Optimization<a href=#query-performance-optimization class=hash-link aria-label="Query Performance Optimization的直接链接" title="Query Performance Optimization的直接链接">​</a></h2>
<p>After clearing the way for external data access, the next step for a query engine would be to accelerate data queries. In the case of Apache Doris, efforts are made in data reading, execution engine, and optimizer.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=data-reading><strong>Data Reading</strong><a href=#data-reading class=hash-link aria-label=data-reading的直接链接 title=data-reading的直接链接>​</a></h3>
<p>Reading data on remote storage systems is often bottlenecked by access latency, concurrency, and I/O bandwidth, so reducing reading frequency will be a better choice.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=native-file-format-reader><strong>Native File Format Reader</strong><a href=#native-file-format-reader class=hash-link aria-label=native-file-format-reader的直接链接 title=native-file-format-reader的直接链接>​</a></h4>
<p>Improving data reading efficiency entails optimizing the reading of Parquet files and ORC files, which are the most commonly seen data files. Doris has refactored its File Reader, which is fine-tuned for each data format. Take the Native Parquet Reader as an example:</p>
<ul>
<li><strong>Reduce format conversion</strong>: It can directly convert files to the Doris storage format or to a format of higher performance using dictionary encoding.</li>
<li><strong>Smart indexing of finer granularity</strong>: It supports Page Index for Parquet files, so it can utilize Page-level smart indexing to filter Pages.</li>
<li><strong>Predicate pushdown and late materialization</strong>: It first reads columns with filters first and then reads the other columns of the filtered rows. This remarkably reduces file read volume since it avoids reading irrelevant data.</li>
<li><strong>Lower read frequency</strong>: Building on the high throughput and low concurrency of remote storage, it combines multiple data reads into one in order to improve overall data reading efficiency.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=file-cache>File Cache<a href=#file-cache class=hash-link aria-label="File Cache的直接链接" title="File Cache的直接链接">​</a></h4>
<p>Doris caches files from remote storage in local high-performance disks as a way to reduce overhead and increase performance in data reading. In addition, it has developed two new features that make queries on remote files as quick as those on local files:</p>
<ol>
<li><strong>Block cache</strong>: Doris supports the block cache of remote files and can automatically adjust the block size from 4KB to 4MB based on the read request. The block cache method reduces read/write amplification and read latency in cold caches.</li>
<li><strong>Consistent hashing for caching</strong>: Doris applies consistent hashing to manage cache locations and schedule data scanning. By doing so, it prevents cache failures brought about by the online and offlining of nodes. It can also increase cache hit rate and query service stability.</li>
</ol>
<p><img decoding=async loading=lazy alt=file-cache src=/zh-CN/assets/images/Lakehouse_6-ab3642f54deb4b5f57694e0814a891a7.png width=1080 height=638 class=img_ev3q></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=execution-engine>Execution Engine<a href=#execution-engine class=hash-link aria-label="Execution Engine的直接链接" title="Execution Engine的直接链接">​</a></h4>
<p>Developers surely don't want to rebuild all the general features for every new data source. Instead, they hope to reuse the vectorized execution engine and all operators in Doris in the data lakehouse scenario. Thus, Doris has refactored the scan nodes:</p>
<ul>
<li><strong>Layer the logic</strong>: All data queries in Doris, including those on internal tables, use the same operators, such as Join, Sort, and Agg. The only difference between queries on internal and external data lies in data access. In Doris, anything above the scan nodes follows the same query logic, while below the scan nodes, the implementation classes will take care of access to different data sources.</li>
<li><strong>Use a general framework for scan operators</strong>: Even for the scan nodes, different data sources have a lot in common, such as task splitting logic, scheduling of sub-tasks and I/O, predicate pushdown, and Runtime Filter. Therefore, Doris uses interfaces to handle them. Then, it implements a unified scheduling logic for all sub-tasks. The scheduler is in charge of all scanning tasks in the node. With global information of the node in hand, the schedular is able to do fine-grained management. Such a general framework makes it easy to connect a new data source to Doris, which will only take a week of work for one developer.</li>
</ul>
<p><img decoding=async loading=lazy alt=execution-engine src=/zh-CN/assets/images/Lakehouse_7-8e726de5b739f4532ff1c8a45055911e.png width=830 height=844 class=img_ev3q></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=query-optimizer>Query Optimizer<a href=#query-optimizer class=hash-link aria-label="Query Optimizer的直接链接" title="Query Optimizer的直接链接">​</a></h4>
<p>Doris supports a range of statistical information from various data sources, including Hive Metastore, Iceberg Metafile, and Hudi MetaTable. It has also refined its cost model inference based on the characteristics of different data sources to enhance its query planning capability.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=performance>Performance<a href=#performance class=hash-link aria-label=Performance的直接链接 title=Performance的直接链接>​</a></h4>
<p>We tested Doris and Presto/Trino on HDFS in flat table scenarios (ClickBench) and multi-table scenarios (TPC-H). Here are the results:</p>
<p><img decoding=async loading=lazy alt=Apache-Doris-VS-Trino-Presto-ClickBench src=/zh-CN/assets/images/Lakehouse_8-3fc3c0c72557dccb1dde18e02b88d155.png width=1925 height=345 class=img_ev3q></p>
<p><img decoding=async loading=lazy alt=Apache-Doris-VS-Trino-Presto-TPCH src=/zh-CN/assets/images/Lakehouse_9-07cdca2b93201425f7d2f7647c13c163.png width=1688 height=421 class=img_ev3q></p>
<p>As is shown, with the same computing resources and on the same dataset, Apache Doris takes much less time to respond to SQL queries in both scenarios, delivering a 3~10 times higher performance than Presto/Trino.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=workload-management-and-elastic-computing>Workload Management and Elastic Computing<a href=#workload-management-and-elastic-computing class=hash-link aria-label="Workload Management and Elastic Computing的直接链接" title="Workload Management and Elastic Computing的直接链接">​</a></h2>
<p>Querying external data sources requires no internal storage of Doris. This makes elastic stateless computing nodes possible. Apache Doris 2.0 is going to implement Elastic Compute Node, which is dedicated to supporting query workloads of external data sources.</p>
<p><img decoding=async loading=lazy alt=stateless-compute-nodes src=/zh-CN/assets/images/Lakehouse_10-96454cb74de1a358c1b94af7e9673f24.png width=1960 height=884 class=img_ev3q></p>
<p>Stateless computing nodes are open for quick scaling so users can easily cope with query workloads during peaks and valleys and strike a balance between performance and cost. In addition, Doris has optimized itself for Kubernetes cluster management and node scheduling. Now Master nodes can automatically manage the onlining and offlining of Elastic Compute Nodes, so users can govern their cluster workloads in cloud-native and hybrid cloud scenarios without difficulty.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=use-case>Use Case<a href=#use-case class=hash-link aria-label="Use Case的直接链接" title="Use Case的直接链接">​</a></h2>
<p>Apache Doris has been adopted by a financial institution for risk management. The user's high demands for data timeliness makes their data mart built on Greenplum and CDH, which could only process data from one day ago, no longer a great fit. In 2022, they incorporated Apache Doris in their data production and application pipeline, which allowed them to perform federated queries across Elasticsearch, Greenplum, and Hive. A few highlights from the user's feedback include:</p>
<ul>
<li>Doris allows them to create one Hive Catalog that maps to tens of thousands of external Hive tables and conducts fast queries on them.</li>
<li>Doris makes it possible to perform real-time federated queries using Elasticsearch Catalog and achieve a response time of mere milliseconds.</li>
<li>Doris enables the decoupling of daily batch processing and statistical analysis, bringing less resource consumption and higher system stability.</li>
</ul>
<p><img decoding=async loading=lazy alt=use-case-of-data-lakehouse src=/zh-CN/assets/images/Lakehouse_11-486b5f1ff26d1d7f20c70d4c4841e6ee.png width=1510 height=882 class=img_ev3q></p>
<h1>Future Plans</h1>
<p>Apache Doris is going to support a wider range of data sources, improve its data reading and write-back functionality, and optimizes its resource isolation and scheduling.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=more-data-sources>More Data Sources<a href=#more-data-sources class=hash-link aria-label="More Data Sources的直接链接" title="More Data Sources的直接链接">​</a></h2>
<p>We are working closely with various open source communities to expand and improve Doris' features in data lake analytics. We plan to provide:</p>
<ul>
<li>Support for Incremental Query of Hudi Merge-on-Read tables;</li>
<li>Lower query latency utilizing the indexing of Iceberg/Hudi in combination with the query optimizer;</li>
<li>Support for more data lake formats such as Delta Lake and Flink Table Store.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=data-integration>Data Integration<a href=#data-integration class=hash-link aria-label="Data Integration的直接链接" title="Data Integration的直接链接">​</a></h2>
<p><strong>Data reading:</strong></p>
<p>Apache Doris is going to:</p>
<ul>
<li>Support CDC and Incremental Materialized Views for data lakes in order to provide users with near real-time data views;</li>
<li>Support a Git-Like data access mode and enable easier and safer data management via the multi-version and Branch mechanisms.</li>
</ul>
<p><strong>Data Write-Back:</strong></p>
<p>We are going to enhance Apache Doris' data analysis gateway. In the future, users will be able to use Doris as a unified data management portal that is in charge of the write-back of processed data, export of data, and the generation of a unified data view.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=resource-isolation--scheduling>Resource Isolation & Scheduling<a href=#resource-isolation--scheduling class=hash-link aria-label="Resource Isolation & Scheduling的直接链接" title="Resource Isolation & Scheduling的直接链接">​</a></h2>
<p>Apache Doris is undertaking a wider variety of workloads as it is interfacing with more and more data sources. For example, it needs to provide low-latency online services while batch processing T-1 data in Hive. To make it work, resource isolation within the same cluster is critical, which is where efforts will be made.</p>
<p>Meanwhile, we will continue optimizing the scheduling logic of elastic computing nodes in various scenarios and develop intra-node resource isolation at a finer granularity, such as CPU, I/O, and memory.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=join-us>Join us<a href=#join-us class=hash-link aria-label="Join us的直接链接" title="Join us的直接链接">​</a></h2>
<p>Contact <a href=mailto:dev@apache.doris.org target=_blank rel="noopener noreferrer">dev@apache.doris.org</a> to join the Lakehouse SIG(Special Interest Group) in the Apache Doris community and talk to developers from all walks of life.</p>
<p><strong># Links:</strong></p>
<p><strong>Apache Doris:</strong></p>
<p><a href=http://doris.apache.org target=_blank rel="noopener noreferrer">http://doris.apache.org</a></p>
<p><strong>Apache Doris Github:</strong></p>
<p><a href=https://github.com/apache/doris target=_blank rel="noopener noreferrer">https://github.com/apache/doris</a></p>
<p>Find Apache Doris developers on <a href=https://doris.apache.org/slack target=_blank rel="noopener noreferrer">Slack</a>.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/ssb/>Apache Doris 1.2 star-schema-benchmark performance test report</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2022-11-22T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2022年11月22日</time></div></header><div class=markdown itemprop=articleBody><p><a href=https://www.cs.umb.edu/~poneil/StarSchemaB.PDF target=_blank rel="noopener noreferrer">Star Schema Benchmark(SSB)</a> is a lightweight performance test set in the data warehouse scenario. SSB provides a simplified star schema data based on <a href=http://www.tpc.org/tpch/ target=_blank rel="noopener noreferrer">TPC-H</a>, which is mainly used to test the performance of multi-table JOIN query under star schema.  In addition, the industry usually flattens SSB into a wide table model (Referred as: SSB flat) to test the performance of the query engine, refer to <a href=https://clickhouse.com/docs/zh/getting-started target=_blank rel="noopener noreferrer">Clickhouse</a>.</p>
<p>This document mainly introduces the performance of Doris on the SSB 100G test set.</p>
<blockquote>
<p>Note 1: The standard test set including SSB usually has a large gap with the actual business scenario, and some tests will perform parameter tuning for the test set. Therefore, the test results of the standard test set can only reflect the performance of the database in a specific scenario. It is recommended that users use actual business data for further testing.</p>
<p>Note 2: The operations involved in this document are all performed in the Ubuntu Server 20.04 environment, and CentOS 7 as well.</p>
</blockquote>
<p>With 13 queries on the SSB standard test data set, we conducted a comparison test based on Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 versions.</p>
<p>On the SSB flat wide table, the overall performance of Apache Doris 1.2.0-rc01 has been improved by nearly 4 times compared with Apache Doris 1.1.3, and nearly 10 times compared with Apache Doris 0.15.0 RC04.</p>
<p>On the SQL test with standard SSB, the overall performance of Apache Doris 1.2.0-rc01 has been improved by nearly 2 times compared with Apache Doris 1.1.3, and nearly 31 times compared with Apache Doris 0.15.0 RC04.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=1-hardware-environment>1. Hardware Environment<a href=#1-hardware-environment class=hash-link aria-label="1. Hardware Environment的直接链接" title="1. Hardware Environment的直接链接">​</a></h2>

























<table><thead><tr><th>Number of machines<th>4 Tencent Cloud Hosts (1 FE, 3 BEs)<tbody><tr><td>CPU<td>AMD EPYC™ Milan (2.55GHz/3.5GHz) 16 Cores<tr><td>Memory<td>64G<tr><td>Network Bandwidth<td>7Gbps<tr><td>Disk<td>High-performance Cloud Disk</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=2-software-environment>2. Software Environment<a href=#2-software-environment class=hash-link aria-label="2. Software Environment的直接链接" title="2. Software Environment的直接链接">​</a></h2>
<ul>
<li>Doris deployed 3BEs and 1FE;</li>
<li>Kernel version: Linux version 5.4.0-96-generic (buildd@lgw01-amd64-051)</li>
<li>OS version: Ubuntu Server 20.04 LTS 64-bit</li>
<li>Doris software versions: Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04</li>
<li>JDK: openjdk version "11.0.14" 2022-01-18</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=3-test-data-volume>3. Test Data Volume<a href=#3-test-data-volume class=hash-link aria-label="3. Test Data Volume的直接链接" title="3. Test Data Volume的直接链接">​</a></h2>








































<table><thead><tr><th style=text-align:left>SSB Table Name<th style=text-align:left>Rows<th style=text-align:left>Annotation<tbody><tr><td style=text-align:left>lineorder<td style=text-align:left>600,037,902<td style=text-align:left>Commodity Order Details<tr><td style=text-align:left>customer<td style=text-align:left>3,000,000<td style=text-align:left>Customer Information<tr><td style=text-align:left>part<td style=text-align:left>1,400,000<td style=text-align:left>Parts Information<tr><td style=text-align:left>supplier<td style=text-align:left>200,000<td style=text-align:left>Supplier Information<tr><td style=text-align:left>date<td style=text-align:left>2,556<td style=text-align:left>Date<tr><td style=text-align:left>lineorder_flat<td style=text-align:left>600,037,902<td style=text-align:left>Wide Table after Data Flattening</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=4-test-results>4. Test Results<a href=#4-test-results class=hash-link aria-label="4. Test Results的直接链接" title="4. Test Results的直接链接">​</a></h2>
<p>We use Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 for comparative testing. The test results are as follows:</p>































































































<table><thead><tr><th>Query<th>Apache Doris 1.2.0-rc01(ms)<th>Apache Doris 1.1.3 (ms)<th>Doris 0.15.0 RC04 (ms)<tbody><tr><td>Q1.1<td>20<td>90<td>250<tr><td>Q1.2<td>10<td>10<td>30<tr><td>Q1.3<td>30<td>70<td>120<tr><td>Q2.1<td>90<td>360<td>900<tr><td>Q2.2<td>90<td>340<td>1,020<tr><td>Q2.3<td>60<td>260<td>770<tr><td>Q3.1<td>160<td>550<td>1,710<tr><td>Q3.2<td>80<td>290<td>670<tr><td>Q3.3<td>90<td>240<td>550<tr><td>Q3.4<td>20<td>20<td>30<tr><td>Q4.1<td>140<td>480<td>1,250<tr><td>Q4.2<td>50<td>240<td>400<tr><td>Q4.3<td>30<td>200<td>330<tr><td>Total<td>880<td>3,150<td>8,030</table>
<p><img decoding=async loading=lazy alt=ssb_v11_v015_compare src=/zh-CN/assets/images/ssb_flat-a8cfebbc53e6f2db116876e3d53e19c7.png width=1522 height=674 class=img_ev3q></p>
<p><strong>Interpretation of Results</strong></p>
<ul>
<li>The data set corresponding to the test results is scale 100, about 600 million.</li>
<li>The test environment is configured as the user's common configuration, with 4 cloud servers, 16-core 64G SSD, and 1 FE, 3 BEs deployment.</li>
<li>We select the user's common configuration test to reduce the cost of user selection and evaluation, but the entire test process will not consume so many hardware resources.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=5-standard-ssb-test-results>5. Standard SSB Test Results<a href=#5-standard-ssb-test-results class=hash-link aria-label="5. Standard SSB Test Results的直接链接" title="5. Standard SSB Test Results的直接链接">​</a></h2>
<p>Here we use Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 for comparative testing. In the test, we use Query Time（ms） as the main performance indicator. The test results are as follows:</p>































































































<table><thead><tr><th>Query<th>Apache Doris 1.2.0-rc01 (ms)<th>Apache Doris 1.1.3 (ms)<th>Doris 0.15.0 RC04 (ms)<tbody><tr><td>Q1.1<td>40<td>18<td>350<tr><td>Q1.2<td>30<td>100<td>80<tr><td>Q1.3<td>20<td>70<td>80<tr><td>Q2.1<td>350<td>940<td>20,680<tr><td>Q2.2<td>320<td>750<td>18,250<tr><td>Q2.3<td>300<td>720<td>14,760<tr><td>Q3.1<td>650<td>2,150<td>22,190<tr><td>Q3.2<td>260<td>510<td>8,360<tr><td>Q3.3<td>220<td>450<td>6,200<tr><td>Q3.4<td>60<td>70<td>160<tr><td>Q4.1<td>840<td>1,480<td>24,320<tr><td>Q4.2<td>460<td>560<td>6,310<tr><td>Q4.3<td>610<td>660<td>10,170<tr><td>Total<td>4,160<td>8,478<td>131,910</table>
<p><img decoding=async loading=lazy alt=ssb_12_11_015 src=/zh-CN/assets/images/ssb-6f7fc8825356019f61622f6fcb9fa1d0.png width=1354 height=728 class=img_ev3q></p>
<p><strong>Interpretation of Results</strong></p>
<ul>
<li>The data set corresponding to the test results is scale 100, about 600 million.</li>
<li>The test environment is configured as the user's common configuration, with 4 cloud servers, 16-core 64G SSD, and 1 FE 3 BEs deployment.</li>
<li>We select the user's common configuration test to reduce the cost of user selection and evaluation, but the entire test process will not consume so many hardware resources.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=6-environment-preparation>6. Environment Preparation<a href=#6-environment-preparation class=hash-link aria-label="6. Environment Preparation的直接链接" title="6. Environment Preparation的直接链接">​</a></h2>
<p>Please first refer to the <a href=/zh-CN/blog/tags/install/deploy-manually/storage-compute-decoupled-deploy-manually/>official documentation</a> to install and deploy Apache Doris first to obtain a Doris cluster which is working well(including at least 1 FE 1 BE, 1 FE 3 BEs is recommended).</p>
<p>The scripts mentioned in the following documents are stored in the Apache Doris codebase: <a href=https://github.com/apache/doris/tree/master/tools/ssb-tools target=_blank rel="noopener noreferrer">ssb-tools</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=7-data-preparation>7. Data Preparation<a href=#7-data-preparation class=hash-link aria-label="7. Data Preparation的直接链接" title="7. Data Preparation的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=71-download-and-install-the-ssb-data-generation-tool>7.1 Download and Install the SSB Data Generation Tool.<a href=#71-download-and-install-the-ssb-data-generation-tool class=hash-link aria-label="7.1 Download and Install the SSB Data Generation Tool.的直接链接" title="7.1 Download and Install the SSB Data Generation Tool.的直接链接">​</a></h3>
<p>Execute the following script to download and compile the <a href=https://github.com/electrum/ssb-dbgen.git target=_blank rel="noopener noreferrer">ssb-dbgen</a> tool.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">sh build-ssb-dbgen.sh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>After successful installation, the <code>dbgen</code> binary will be generated under the <code>ssb-dbgen/</code> directory.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=72-generate-ssb-test-set>7.2 Generate SSB Test Set<a href=#72-generate-ssb-test-set class=hash-link aria-label="7.2 Generate SSB Test Set的直接链接" title="7.2 Generate SSB Test Set的直接链接">​</a></h3>
<p>Execute the following script to generate the SSB dataset:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">sh gen-ssb-data.sh -s 100 -c 100</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<blockquote>
<p>Note 1: Check the script help via <code>sh gen-ssb-data.sh -h</code>.</p>
<p>Note 2: The data will be generated under the <code>ssb-data/</code> directory with the suffix <code>.tbl</code>. The total file size is about 60GB and may need a few minutes to an hour to generate.</p>
<p>Note 3: <code>-s 100</code> indicates that the test set size factor is 100, <code>-c 100</code> indicates that 100 concurrent threads generate the data of the lineorder table. The <code>-c</code> parameter also determines the number of files in the final lineorder table. The larger the parameter, the larger the number of files and the smaller each file.</p>
</blockquote>
<p>With the <code>-s 100</code> parameter, the resulting dataset size is:</p>









































<table><thead><tr><th>Table<th>Rows<th>Size<th>File Number<tbody><tr><td>lineorder<td>600,037,902<td>60GB<td>100<tr><td>customer<td>3,000,000<td>277M<td>1<tr><td>part<td>1,400,000<td>116M<td>1<tr><td>supplier<td>200,000<td>17M<td>1<tr><td>date<td>2,556<td>228K<td>1</table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=73-create-table>7.3 Create Table<a href=#73-create-table class=hash-link aria-label="7.3 Create Table的直接链接" title="7.3 Create Table的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=731-prepare-the-doris-clusterconf-file>7.3.1 Prepare the <code>doris-cluster.conf</code> File.<a href=#731-prepare-the-doris-clusterconf-file class=hash-link aria-label=731-prepare-the-doris-clusterconf-file的直接链接 title=731-prepare-the-doris-clusterconf-file的直接链接>​</a></h4>
<p>Before import the script, you need to write the FE’s ip port and other information in the <code>doris-cluster.conf</code> file.</p>
<p>The file location is at the same level as <code>load-ssb-dimension-data.sh</code>.</p>
<p>The content of the file includes FE's ip, HTTP port, user name, password and the DB name of the data to be imported:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">export FE_HOST="xxx"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">export FE_HTTP_PORT="8030"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">export FE_QUERY_PORT="9030"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">export USER="root"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">export PASSWORD='xxx'</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">export DB="ssb"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=732-execute-the-following-script-to-generate-and-create-the-ssb-table>7.3.2 Execute the Following Script to Generate and Create the SSB Table:<a href=#732-execute-the-following-script-to-generate-and-create-the-ssb-table class=hash-link aria-label="7.3.2 Execute the Following Script to Generate and Create the SSB Table:的直接链接" title="7.3.2 Execute the Following Script to Generate and Create the SSB Table:的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">sh create-ssb-tables.sh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Or copy the table creation statements in <a href=https://github.com/apache/incubator-doris/tree/master/tools/ssb-tools/ddl/create-ssb-tables.sql target=_blank rel="noopener noreferrer">create-ssb-tables.sql</a> and <a href=https://github.com/apache/incubator-doris/tree/master/tools/ssb-tools/ddl/create-ssb-flat-table.sql target=_blank rel="noopener noreferrer"> create-ssb-flat-table.sql</a> and then execute them in the MySQL client.</p>
<p>The following is the <code>lineorder_flat</code> table build statement. Create the <code>lineorder_flat</code> table in the above <code>create-ssb-flat-table.sh</code> script, and perform the default number of buckets (48 buckets). You can delete this table and adjust the number of buckets according to your cluster scale node configuration, so as to obtain a better test result.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">lineorder_flat</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERDATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_LINENUMBER</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_CUSTKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_PARTKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_SUPPKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERPRIORITY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_SHIPPRIORITY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_QUANTITY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_EXTENDEDPRICE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDTOTALPRICE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_DISCOUNT</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_REVENUE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_SUPPLYCOST</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_TAX</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_COMMITDATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_SHIPMODE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_NAME</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_ADDRESS</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_CITY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_NATION</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_REGION</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_PHONE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">C_MKTSEGMENT</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_NAME</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_ADDRESS</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_CITY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_NATION</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_REGION</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">S_PHONE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_NAME</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_MFGR</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_CATEGORY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_BRAND</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_COLOR</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_TYPE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_SIZE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">tinyint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">P_CONTAINER</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ENGINE</span><span class="token operator">=</span><span class="token plain">OLAP</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERDATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"OLAP"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> RANGE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERDATE</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'0000-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1993-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p2 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1993-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1994-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p3 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1994-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1995-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p4 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1995-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1996-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p5 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1996-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1997-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p6 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1997-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1998-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PARTITION</span><span class="token plain"> p7 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1998-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'1999-01-01'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">LO_ORDERKEY</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> BUCKETS </span><span class="token number">48</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"replication_num"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"colocate_with"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"groupxx1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"in_memory"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"false"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"storage_format"</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"DEFAULT"</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=74-import-data>7.4 Import data<a href=#74-import-data class=hash-link aria-label="7.4 Import data��的直接链接" title="7.4 Import data的直接链接">​</a></h3>
<p>We use the following command to complete all data import of SSB test set and SSB FLAT wide table data synthesis and then import into the table.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain"> sh bin/load-ssb-data.sh -c 10</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>-c 5</code> means start 10 concurrent threads to import (5 by default). In the case of a single BE node, the lineorder data generated by <code>sh gen-ssb-data.sh -s 100 -c 100</code> will also generate the data of the ssb-flat table in the end. If more threads are enabled, the import speed can be accelerated. But it will cost extra memory.</p>
<blockquote>
<p>Notes.</p>
<ol>
<li>
<p>To get faster import speed, you can add <code>flush_thread_num_per_store=5</code> in be.conf and then restart BE. This configuration indicates the number of disk writing threads for each data directory, 2 by default. Larger data can improve write data throughput, but may increase IO Util. (Reference value: 1 mechanical disk, with 2 by default, the IO Util during the import process is about 12%. When it is set to 5, the IO Util is about 26%. If it is an SSD disk, it is almost 0%) .</p>
</li>
<li>
<p>The flat table data is imported by 'INSERT INTO ... SELECT ... '.</p>
</li>
</ol>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=75-checking-imported-data>7.5 Checking Imported data<a href=#75-checking-imported-data class=hash-link aria-label="7.5 Checking Imported data的直接链接" title="7.5 Checking Imported data的直接链接">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> lineorder_flat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The amount of data should be consistent with the number of rows of generated data.</p>















































<table><thead><tr><th>Table<th>Rows<th>Origin Size<th>Compacted Size(1 Replica)<tbody><tr><td>lineorder_flat<td>600,037,902<td><td>59.709 GB<tr><td>lineorder<td>600,037,902<td>60 GB<td>14.514 GB<tr><td>customer<td>3,000,000<td>277 MB<td>138.247 MB<tr><td>part<td>1,400,000<td>116 MB<td>12.759 MB<tr><td>supplier<td>200,000<td>17 MB<td>9.143 MB<tr><td>date<td>2,556<td>228 KB<td>34.276 KB</table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=76-query-test>7.6 Query Test<a href=#76-query-test class=hash-link aria-label="7.6 Query Test的直接链接" title="7.6 Query Test的直接链接">​</a></h3>
<ul>
<li>SSB-Flat Query Statement: <a href=https://github.com/apache/doris/tree/master/tools/ssb-tools/ssb-flat-queries target=_blank rel="noopener noreferrer"> ssb-flat-queries</a></li>
<li>Standard SSB Queries: <a href=https://github.com/apache/doris/tree/master/tools/ssb-tools/ssb-queries target=_blank rel="noopener noreferrer"> ssb-queries</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=761-ssb-flat-test-for-sql>7.6.1 SSB FLAT Test for SQL<a href=#761-ssb-flat-test-for-sql class=hash-link aria-label="7.6.1 SSB FLAT Test for SQL的直接链接" title="7.6.1 SSB FLAT Test for SQL的直接链接">​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">--Q1.1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_EXTENDEDPRICE </span><span class="token operator">*</span><span class="token plain"> LO_DISCOUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain">  LO_ORDERDATE </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">19930101</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19931231</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_DISCOUNT </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_QUANTITY </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">25</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q1.2</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_EXTENDEDPRICE </span><span class="token operator">*</span><span class="token plain"> LO_DISCOUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">19940101</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19940131</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_DISCOUNT </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_QUANTITY </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">26</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">35</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q1.3</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_EXTENDEDPRICE </span><span class="token operator">*</span><span class="token plain"> LO_DISCOUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain">  weekofyear</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">19940101</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19941231</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_DISCOUNT </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">7</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_QUANTITY </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">26</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">35</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q2.1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> P_CATEGORY </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#12'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AMERICA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q2.2</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> P_BRAND </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#2221'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> P_BRAND </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#2228'</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'ASIA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q2.3</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> P_BRAND </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#2239'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'EUROPE'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> C_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'ASIA'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'ASIA'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">19920101</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19971231</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> C_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> revenue </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.2</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_NATION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED STATES'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_NATION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED STATES'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">19920101</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19971231</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> revenue </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.3</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_CITY </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI1'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI5'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_CITY </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI1'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI5'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">19920101</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19971231</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> revenue </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.4</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_CITY </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI1'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI5'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_CITY </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI1'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI5'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">19971201</span><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19971231</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> C_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> revenue </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q4.1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> C_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE </span><span class="token operator">-</span><span class="token plain"> LO_SUPPLYCOST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> profit</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AMERICA'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AMERICA'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> P_MFGR </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#1'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#2'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> C_NATION</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> C_NATION </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q4.2</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">S_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_CATEGORY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE </span><span class="token operator">-</span><span class="token plain"> LO_SUPPLYCOST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> profit</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> C_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AMERICA'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S_REGION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AMERICA'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">19970101</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19981231</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> P_MFGR </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#1'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#2'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_NATION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_CATEGORY</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_NATION </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_CATEGORY </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q4.3</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_ORDERDATE </span><span class="token operator">DIV</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">LO_REVENUE </span><span class="token operator">-</span><span class="token plain"> LO_SUPPLYCOST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> profit</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder_flat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S_NATION </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED STATES'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">19970101</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> LO_ORDERDATE </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">19981231</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> P_CATEGORY </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#14'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">YEAR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> S_CITY </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> P_BRAND </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=762-ssb-standard-test-for-sql>7.6.2 SSB Standard Test for SQL<a href=#762-ssb-standard-test-for-sql class=hash-link aria-label="7.6.2 SSB Standard Test for SQL的直接链接" title="7.6.2 SSB Standard Test for SQL的直接链接">​</a></h4>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">--Q1.1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_extendedprice </span><span class="token operator">*</span><span class="token plain"> lo_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> REVENUE</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dates</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> d_year </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1993</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_discount </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_quantity </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">25</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q1.2</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_extendedprice </span><span class="token operator">*</span><span class="token plain"> lo_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> REVENUE</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dates</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> d_yearmonth </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Jan1994'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_discount </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_quantity </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">26</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">35</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q1.3</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_extendedprice </span><span class="token operator">*</span><span class="token plain"> lo_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> REVENUE</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dates</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> d_weeknuminyear </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> d_year </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1994</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_discount </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">7</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_quantity </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token number">26</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token number">35</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q2.1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_revenue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_brand</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dates</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> supplier</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_partkey </span><span class="token operator">=</span><span class="token plain"> p_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_suppkey </span><span class="token operator">=</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> p_category </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#12'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> s_region </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AMERICA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_brand</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> p_brand</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q2.2</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_revenue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_brand</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dates</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> supplier</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_partkey </span><span class="token operator">=</span><span class="token plain"> p_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_suppkey </span><span class="token operator">=</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> p_brand </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#2221'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#2228'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> s_region </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'ASIA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_brand</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_brand</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q2.3</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_revenue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_brand</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dates</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> supplier</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_partkey </span><span class="token operator">=</span><span class="token plain"> p_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_suppkey </span><span class="token operator">=</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> p_brand </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#2239'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> s_region </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'EUROPE'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_brand</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_brand</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_revenue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> REVENUE</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dates</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_custkey </span><span class="token operator">=</span><span class="token plain"> c_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_suppkey </span><span class="token operator">=</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> c_region </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'ASIA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> s_region </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'ASIA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> d_year </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">1992</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> d_year </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">1997</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> c_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> s_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> d_year</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> REVENUE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.2</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_revenue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> REVENUE</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dates</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_custkey </span><span class="token operator">=</span><span class="token plain"> c_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_suppkey </span><span class="token operator">=</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> c_nation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED STATES'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> s_nation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED STATES'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> d_year </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">1992</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> d_year </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">1997</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> c_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> s_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> d_year</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> REVENUE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.3</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_revenue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> REVENUE</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dates</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_custkey </span><span class="token operator">=</span><span class="token plain"> c_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_suppkey </span><span class="token operator">=</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        c_city </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI1'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">OR</span><span class="token plain"> c_city </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI5'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        s_city </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI1'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">OR</span><span class="token plain"> s_city </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI5'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> d_year </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">1992</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> d_year </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">1997</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> c_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> s_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> d_year</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> REVENUE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3.4</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_revenue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> REVENUE</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> lineorder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dates</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_custkey </span><span class="token operator">=</span><span class="token plain"> c_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_suppkey </span><span class="token operator">=</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        c_city </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI1'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">OR</span><span class="token plain"> c_city </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI5'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        s_city </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI1'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">OR</span><span class="token plain"> s_city </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED KI5'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> d_yearmonth </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Dec1997'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> c_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> s_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> d_year</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ASC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> REVENUE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q4.1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(parallel_fragment_exec_instance_num=4, enable_vectorized_engine=true, batch_size=4096, enable_cost_based_join_reorder=true, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_revenue </span><span class="token operator">-</span><span class="token plain"> lo_supplycost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> PROFIT</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> dates</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> lineorder</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_custkey </span><span class="token operator">=</span><span class="token plain"> c_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_suppkey </span><span class="token operator">=</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_partkey </span><span class="token operator">=</span><span class="token plain"> p_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> c_region </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AMERICA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> s_region </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AMERICA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        p_mfgr </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#1'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">OR</span><span class="token plain"> p_mfgr </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#2'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> c_nation</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> c_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q4.2</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, enable_cost_based_join_reorder=true, enable_projection=true) */</span><span class="token plain">  </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_category</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_revenue </span><span class="token operator">-</span><span class="token plain"> lo_supplycost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> PROFIT</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> dates</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> lineorder</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_custkey </span><span class="token operator">=</span><span class="token plain"> c_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_suppkey </span><span class="token operator">=</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_partkey </span><span class="token operator">=</span><span class="token plain"> p_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> c_region </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AMERICA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> s_region </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AMERICA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        d_year </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1997</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">OR</span><span class="token plain"> d_year </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1998</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        p_mfgr </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#1'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">OR</span><span class="token plain"> p_mfgr </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#2'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> s_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_category</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> s_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_category</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q4.3</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, enable_cost_based_join_reorder=true, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_brand</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lo_revenue </span><span class="token operator">-</span><span class="token plain"> lo_supplycost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> PROFIT</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> dates</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> lineorder</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lo_custkey </span><span class="token operator">=</span><span class="token plain"> c_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_suppkey </span><span class="token operator">=</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_partkey </span><span class="token operator">=</span><span class="token plain"> p_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> lo_orderdate </span><span class="token operator">=</span><span class="token plain"> d_datekey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> s_nation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNITED STATES'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        d_year </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1997</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">OR</span><span class="token plain"> d_year </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1998</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">AND</span><span class="token plain"> p_category </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MFGR#14'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> s_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_brand</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> d_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> s_city</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p_brand</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/tpch/>Apache Doris 1.2 TPC-H performance test report</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2022-11-22T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2022年11月22日</time></div></header><div class=markdown itemprop=articleBody><p>TPC-H is a decision support benchmark (Decision Support Benchmark), which consists of a set of business-oriented special query and concurrent data modification. The data that is queried and populates the database has broad industry relevance. This benchmark demonstrates a decision support system that examines large amounts of data, executes highly complex queries, and answers key business questions. The performance index reported by TPC-H is called TPC-H composite query performance index per hour (QphH@Size), which reflects multiple aspects of the system's ability to process queries. These aspects include the database size chosen when executing the query, the query processing capability when the query is submitted by a single stream, and the query throughput when the query is submitted by many concurrent users.</p>
<p>This document mainly introduces the performance of Doris on the TPC-H 100G test set.</p>
<blockquote>
<p>Note 1: The standard test set including TPC-H is usually far from the actual business scenario, and some tests will perform parameter tuning for the test set. Therefore, the test results of the standard test set can only reflect the performance of the database in a specific scenario. We suggest users use actual business data for further testing.</p>
<p>Note 2: The operations involved in this document are all tested on CentOS 7.x.</p>
</blockquote>
<p>On 22 queries on the TPC-H standard test data set, we conducted a comparison test based on Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 versions. Compared with Apache Doris 1.1.3, the overall performance of Apache Doris 1.2.0-rc01 has been improved by nearly 3 times, and by nearly 11 times compared with Apache Doris 0.15.0 RC04.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=1-hardware-environment>1. Hardware Environment<a href=#1-hardware-environment class=hash-link aria-label="1. Hardware Environment的直接链接" title="1. Hardware Environment的直接链接">​</a></h2>





























<table><thead><tr><th>Hardware<th>Configuration Instructions<tbody><tr><td>Number of mMachines<td>4 Tencent Cloud Virtual Machine（1FE，3BEs）<tr><td>CPU<td>Intel Xeon(Cascade Lake) Platinum 8269CY  16C  (2.5 GHz/3.2 GHz)<tr><td>Memory<td>64G<tr><td>Network<td>5Gbps<tr><td>Disk<td>ESSD Cloud Hard Disk</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=2-software-environment>2. Software Environment<a href=#2-software-environment class=hash-link aria-label="2. Software Environment的直接链接" title="2. Software Environment的直接链接">​</a></h2>
<ul>
<li>Doris Deployed 3BEs and 1FE</li>
<li>Kernel Version: Linux version 5.4.0-96-generic (buildd@lgw01-amd64-051)</li>
<li>OS version: CentOS 7.8</li>
<li>Doris software version: Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 , Apache Doris 0.15.0 RC04</li>
<li>JDK: openjdk version "11.0.14" 2022-01-18</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=3-test-data-volume>3. Test Data Volume<a href=#3-test-data-volume class=hash-link aria-label="3. Test Data Volume的直接链接" title="3. Test Data Volume的直接链接">​</a></h2>
<p>The TPCH 100G data generated by the simulation of the entire test are respectively imported into Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 for testing. The following is the relevant description and data volume of the table.</p>



























































<table><thead><tr><th style=text-align:left>TPC-H Table Name<th style=text-align:left>Rows<th>Size after Import<th style=text-align:left>Annotation<tbody><tr><td style=text-align:left>REGION<td style=text-align:left>5<td>400KB<td style=text-align:left>Region<tr><td style=text-align:left>NATION<td style=text-align:left>25<td>7.714 KB<td style=text-align:left>Nation<tr><td style=text-align:left>SUPPLIER<td style=text-align:left>1,000,000<td>85.528 MB<td style=text-align:left>Supplier<tr><td style=text-align:left>PART<td style=text-align:left>20,000,000<td>752.330 MB<td style=text-align:left>Parts<tr><td style=text-align:left>PARTSUPP<td style=text-align:left>20,000,000<td>4.375 GB<td style=text-align:left>Parts Supply<tr><td style=text-align:left>CUSTOMER<td style=text-align:left>15,000,000<td>1.317 GB<td style=text-align:left>Customer<tr><td style=text-align:left>ORDERS<td style=text-align:left>1,500,000,000<td>6.301 GB<td style=text-align:left>Orders<tr><td style=text-align:left>LINEITEM<td style=text-align:left>6,000,000,000<td>20.882 GB<td style=text-align:left>Order Details</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=4-test-sql>4. Test SQL<a href=#4-test-sql class=hash-link aria-label="4. Test SQL的直接链接" title="4. Test SQL的直接链接">​</a></h2>
<p>TPCH 22 test query statements : <a href=https://github.com/apache/incubator-doris/tree/master/tools/tpch-tools/queries target=_blank rel="noopener noreferrer">TPCH-Query-SQL</a></p>
<p><strong>Notice:</strong></p>
<p>The following four parameters in the above SQL do not exist in Apache Doris 0.15.0 RC04. When executing, please remove:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">1. enable_vectorized_engine=true,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">2. batch_size=4096,</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">3. disable_join_reorder=false</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">4. enable_projection=true</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=5-test-results>5. Test Results<a href=#5-test-results class=hash-link aria-label="5. Test Results的直接链接" title="5. Test Results的直接链接">​</a></h2>
<p>Here we use Apache Doris 1.2.0-rc01, Apache Doris 1.1.3 and Apache Doris 0.15.0 RC04 for comparative testing. In the test, we use Query Time(ms) as the main performance indicator. The test results are as follows:</p>





















































































































































<table><thead><tr><th>Query<th>Apache Doris 1.2.0-rc01 (ms)<th>Apache Doris 1.1.3 (ms)<th>Apache Doris 0.15.0 RC04 (ms)<tbody><tr><td>Q1<td>2.12<td>3.75<td>28.63<tr><td>Q2<td>0.20<td>4.22<td>7.88<tr><td>Q3<td>0.62<td>2.64<td>9.39<tr><td>Q4<td>0.61<td>1.5<td>9.3<tr><td>Q5<td>1.05<td>2.15<td>4.11<tr><td>Q6<td>0.08<td>0.19<td>0.43<tr><td>Q7<td>0.58<td>1.04<td>1.61<tr><td>Q8<td>0.72<td>1.75<td>50.35<tr><td>Q9<td>3.61<td>7.94<td>16.34<tr><td>Q10<td>1.26<td>1.41<td>5.21<tr><td>Q11<td>0.15<td>0.35<td>1.72<tr><td>Q12<td>0.21<td>0.57<td>5.39<tr><td>Q13<td>2.62<td>8.15<td>20.88<tr><td>Q14<td>0.16<td>0.3<td><tr><td>Q15<td>0.30<td>0.66<td>1.86<tr><td>Q16<td>0.38<td>0.79<td>1.32<tr><td>Q17<td>0.65<td>1.51<td>26.67<tr><td>Q18<td>2.28<td>3.364<td>11.77<tr><td>Q19<td>0.20<td>0.829<td>1.71<tr><td>Q20<td>0.21<td>2.77<td>5.2<tr><td>Q21<td>1.17<td>4.47<td>10.34<tr><td>Q22<td>0.46<td>0.9<td>3.22<tr><td><strong>Total</strong><td><strong>19.64</strong><td><strong>51.253</strong><td><strong>223.33</strong></table>
<p><img decoding=async loading=lazy alt=image-20220614114351241 src=/zh-CN/assets/images/tpch-2048da37571ef8b1d4b0a49c3fba44ca.png width=1526 height=726 class=img_ev3q></p>
<ul>
<li><strong>Result Description</strong>
<ul>
<li>The data set corresponding to the test results is scale 100, about 600 million.</li>
<li>The test environment is configured as the user's common configuration, with 4 cloud servers, 16-core 64G SSD, and 1 FE 3 BEs deployment.</li>
<li>Select the user's common configuration test to reduce the cost of user selection and evaluation, but the entire test process will not consume so many hardware resources.</li>
<li>Apache Doris 0.15 RC04 failed to execute Q14 in the TPC-H test, unable to complete the query.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=6-environmental-preparation>6. Environmental Preparation<a href=#6-environmental-preparation class=hash-link aria-label="6. Environmental Preparation的直接链接" title="6. Environmental Preparation的直接链接">​</a></h2>
<p>Please refer to the <a href=https://doris.apache.org/docs/install/deploy-manually/storage-compute-coupled-deploy-manually/ target=_blank rel="noopener noreferrer">official document</a> to install and deploy Doris to obtain a normal running Doris cluster (at least 1 FE 1 BE, 1 FE 3 BE is recommended).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=7-data-preparation>7. Data Preparation<a href=#7-data-preparation class=hash-link aria-label="7. Data Preparation的直接链接" title="7. Data Preparation的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=71-download-and-install-tpc-h-data-generation-tool>7.1 Download and Install TPC-H Data Generation Tool<a href=#71-download-and-install-tpc-h-data-generation-tool class=hash-link aria-label="7.1 Download and Install TPC-H Data Generation Tool的直接链接" title="7.1 Download and Install TPC-H Data Generation Tool的直接链接">​</a></h3>
<p>Execute the following script to download and compile the <a href=https://github.com/apache/incubator-doris/tree/master/tools/tpch-tools target=_blank rel="noopener noreferrer">tpch-tools</a> tool.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">sh build-tpch-dbgen.sh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>After successful installation, the <code>dbgen</code> binary will be generated under the <code>TPC-H_Tools_v3.0.0/</code> directory.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=72-generating-the-tpc-h-test-set>7.2 Generating the TPC-H Test Set<a href=#72-generating-the-tpc-h-test-set class=hash-link aria-label="7.2 Generating the TPC-H Test Set的直接链接" title="7.2 Generating the TPC-H Test Set的直接链接">​</a></h3>
<p>Execute the following script to generate the TPC-H dataset:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">sh gen-tpch-data.sh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<blockquote>
<p>Note 1: Check the script help via <code>sh gen-tpch-data.sh -h</code>.</p>
<p>Note 2: The data will be generated under the <code>tpch-data/</code> directory with the suffix <code>.tbl</code>. The total file size is about 100GB and may need a few minutes to an hour to generate.</p>
<p>Note 3: A standard test data set of 100G is generated by default.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=73-create-table>7.3 Create Table<a href=#73-create-table class=hash-link aria-label="7.3 Create Table的直接链接" title="7.3 Create Table的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=731-prepare-the-doris-clusterconf-file>7.3.1 Prepare the <code>doris-cluster.conf</code> File<a href=#731-prepare-the-doris-clusterconf-file class=hash-link aria-label=731-prepare-the-doris-clusterconf-file的直接链接 title=731-prepare-the-doris-clusterconf-file的直接链接>​</a></h4>
<p>Before import the script, you need to write the FE’s ip port and other information in the <code>doris-cluster.conf</code> file.</p>
<p>The file location is at the same level as <code>load-tpch-data.sh</code>.</p>
<p>The content of the file includes FE's ip, HTTP port, user name, password and the DB name of the data to be imported:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain"># Any of FE host</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">export FE_HOST='127.0.0.1'</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># http_port in fe.conf</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">export FE_HTTP_PORT=8030</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># query_port in fe.conf</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">export FE_QUERY_PORT=9030</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># Doris username</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">export USER='root'</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># Doris password</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">export PASSWORD=''</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># The database where TPC-H tables located</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">export DB='tpch1'</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=execute-the-following-script-to-generate-and-create-tpc-h-table>Execute the Following Script to Generate and Create TPC-H Table<a href=#execute-the-following-script-to-generate-and-create-tpc-h-table class=hash-link aria-label="Execute the Following Script to Generate and Create TPC-H Table的直接链接" title="Execute the Following Script to Generate and Create TPC-H Table的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">sh create-tpch-tables.sh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Or copy the table creation statement in <a href=https://github.com/apache/incubator-doris/blob/master/tools/tpch-tools/create-tpch-tables.sql target=_blank rel="noopener noreferrer">create-tpch-tables.sql</a> and execute it in Doris.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=74-import-data>7.4 Import Data<a href=#74-import-data class=hash-link aria-label="7.4 Import Data的直接链接" title="7.4 Import Data的直接链接">​</a></h3>
<p>Please perform data import with the following command:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">sh ./load-tpch-data.sh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=75-check-imported-data>7.5 Check Imported Data<a href=#75-check-imported-data class=hash-link aria-label="7.5 Check Imported Data的直接链接" title="7.5 Check Imported Data的直接链接">​</a></h3>
<p>Execute the following SQL statement to check that the imported data is consistent with the above data.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  lineitem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  orders</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  partsupp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  region</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain">  revenue0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=76-query-test>7.6 Query Test<a href=#76-query-test class=hash-link aria-label="7.6 Query Test的直接链接" title="7.6 Query Test的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=761-executing-query-scripts>7.6.1 Executing Query Scripts<a href=#761-executing-query-scripts class=hash-link aria-label="7.6.1 Executing Query Scripts的直接链接" title="7.6.1 Executing Query Scripts的直接链接">​</a></h4>
<p>Execute the above test SQL or execute the following command</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">./run-tpch-queries.sh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<blockquote>
<p>Notice:</p>
<ol>
<li>
<p>At present, the query optimizer and statistics functions of Doris are not so perfect, so we rewrite some queries in TPC-H to adapt to the execution framework of Doris, but it does not affect the correctness of the results</p>
</li>
<li>
<p>Doris' new query optimizer will be released in future versions</p>
</li>
<li>
<p>Set <code>set mem_exec_limit=8G</code> before executing the query</p>
</li>
</ol>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=762-single-sql-execution>7.6.2 Single SQL Execution<a href=#762-single-sql-execution class=hash-link aria-label="7.6.2 Single SQL Execution的直接链接" title="7.6.2 Single SQL Execution的直接链接">​</a></h4>
<p>The following is the SQL statement used in the test, you can also get the latest SQL from the code base.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)">--Q1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=false) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_returnflag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_linestatus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_quantity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> sum_qty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_extendedprice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> sum_base_price</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_extendedprice </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> sum_disc_price</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_extendedprice </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> l_tax</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> sum_charge</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">avg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_quantity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> avg_qty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">avg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_extendedprice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> avg_price</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">avg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> avg_disc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> count_order</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lineitem</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_shipdate </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1998-12-01'</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'90'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">day</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_returnflag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_linestatus</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_returnflag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_linestatus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q2</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=1, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=false, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_acctbal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    n_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_partkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_mfgr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_phone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_comment</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    partsupp </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            ps_partkey </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> a_partkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ps_supplycost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> a_min</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            partsupp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            region</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            p_partkey </span><span class="token operator">=</span><span class="token plain"> ps_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> s_suppkey </span><span class="token operator">=</span><span class="token plain"> ps_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> s_nationkey </span><span class="token operator">=</span><span class="token plain"> n_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> n_regionkey </span><span class="token operator">=</span><span class="token plain"> r_regionkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> r_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'EUROPE'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> p_size </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">15</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> p_type </span><span class="token operator">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'%BRASS'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> a_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> A </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> ps_partkey </span><span class="token operator">=</span><span class="token plain"> a_partkey </span><span class="token operator">and</span><span class="token plain"> ps_supplycost</span><span class="token operator">=</span><span class="token plain">a_min </span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    region</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_partkey </span><span class="token operator">=</span><span class="token plain"> ps_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> s_suppkey </span><span class="token operator">=</span><span class="token plain"> ps_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> p_size </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">15</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> p_type </span><span class="token operator">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'%BRASS'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> s_nationkey </span><span class="token operator">=</span><span class="token plain"> n_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> n_regionkey </span><span class="token operator">=</span><span class="token plain"> r_regionkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> r_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'EUROPE'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_acctbal </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    n_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q3</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=false, enable_projection=true, runtime_filter_wait_time_ms=10000) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_orderkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_extendedprice </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> revenue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_orderdate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_shippriority</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> l_orderkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> l_extendedprice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> o_orderdate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> o_shippriority</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> o_custkey </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        lineitem </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> orders</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> l_orderkey </span><span class="token operator">=</span><span class="token plain"> o_orderkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> o_orderdate </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1995-03-15'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> l_shipdate </span><span class="token operator">></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1995-03-15'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> customer c </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">c_custkey </span><span class="token operator">=</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> c_mktsegment </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'BUILDING'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_orderkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_orderdate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_shippriority</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    revenue </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_orderdate</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q4</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=4, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=false, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_orderpriority</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> order_count</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">*</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            lineitem</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> l_commitdate </span><span class="token operator">&lt;</span><span class="token plain"> l_receiptdate</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">right</span><span class="token plain"> semi </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> orders</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_orderkey </span><span class="token operator">=</span><span class="token plain"> o_orderkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_orderdate </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1993-07-01'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> o_orderdate </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1993-07-01'</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'3'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">month</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_orderpriority</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_orderpriority</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q5</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    n_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_extendedprice </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    orders</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lineitem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    region</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_custkey </span><span class="token operator">=</span><span class="token plain"> o_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_orderkey </span><span class="token operator">=</span><span class="token plain"> o_orderkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_suppkey </span><span class="token operator">=</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> c_nationkey </span><span class="token operator">=</span><span class="token plain"> s_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> s_nationkey </span><span class="token operator">=</span><span class="token plain"> n_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> n_regionkey </span><span class="token operator">=</span><span class="token plain"> r_regionkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> r_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'ASIA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> o_orderdate </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1994-01-01'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> o_orderdate </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1994-01-01'</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">year</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    n_name</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    revenue </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q6</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=1, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_extendedprice </span><span class="token operator">*</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lineitem</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_shipdate </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1994-01-01'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_shipdate </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1994-01-01'</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">year</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_discount </span><span class="token operator">between</span><span class="token plain"> </span><span class="token number">.06</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">0.01</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> </span><span class="token number">.06</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">0.01</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_quantity </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">24</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q7</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=458589934592, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    supp_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cust_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">volume</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            n1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> supp_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            n2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> cust_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            extract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">year</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> l_shipdate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> l_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            l_extendedprice </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> volume</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            lineitem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            orders</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            nation n1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            nation n2</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            s_suppkey </span><span class="token operator">=</span><span class="token plain"> l_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> o_orderkey </span><span class="token operator">=</span><span class="token plain"> l_orderkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> c_custkey </span><span class="token operator">=</span><span class="token plain"> o_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> s_nationkey </span><span class="token operator">=</span><span class="token plain"> n1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> c_nationkey </span><span class="token operator">=</span><span class="token plain"> n2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'FRANCE'</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> n2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'GERMANY'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                </span><span class="token operator">or</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'GERMANY'</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> n2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'FRANCE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> l_shipdate </span><span class="token operator">between</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1995-01-01'</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1996-12-31'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> shipping</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    supp_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cust_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_year</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    supp_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cust_nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q8</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=false, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">when</span><span class="token plain"> nation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'BRAZIL'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"> volume</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">volume</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> mkt_share</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            extract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">year</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> o_orderdate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> o_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            l_extendedprice </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> volume</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            n2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> nation</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            lineitem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            orders</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            nation n1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            nation n2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            region</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            p_partkey </span><span class="token operator">=</span><span class="token plain"> l_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> s_suppkey </span><span class="token operator">=</span><span class="token plain"> l_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> l_orderkey </span><span class="token operator">=</span><span class="token plain"> o_orderkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> o_custkey </span><span class="token operator">=</span><span class="token plain"> c_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> c_nationkey </span><span class="token operator">=</span><span class="token plain"> n1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> n1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_regionkey </span><span class="token operator">=</span><span class="token plain"> r_regionkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> r_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AMERICA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> s_nationkey </span><span class="token operator">=</span><span class="token plain"> n2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">n_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> o_orderdate </span><span class="token operator">between</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1995-01-01'</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1996-12-31'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> p_type </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'ECONOMY ANODIZED STEEL'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> all_nations</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_year</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q9</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=37179869184, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=true, enable_remove_no_conjuncts_runtime_filter_policy=true, runtime_filter_wait_time_ms=100000) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> sum_profit</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            n_name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            extract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">year</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> o_orderdate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> o_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            l_extendedprice </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> ps_supplycost </span><span class="token operator">*</span><span class="token plain"> l_quantity </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> amount</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            lineitem </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> orders </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> o_orderkey </span><span class="token operator">=</span><span class="token plain"> l_orderkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">shuffle</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> part </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> p_partkey </span><span class="token operator">=</span><span class="token plain"> l_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">shuffle</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> partsupp </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> ps_partkey </span><span class="token operator">=</span><span class="token plain"> l_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">shuffle</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> supplier </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> s_suppkey </span><span class="token operator">=</span><span class="token plain"> l_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">broadcast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> nation </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> s_nationkey </span><span class="token operator">=</span><span class="token plain"> n_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            ps_suppkey </span><span class="token operator">=</span><span class="token plain"> l_suppkey </span><span class="token operator">and</span><span class="token plain"> </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            p_name </span><span class="token operator">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'%green%'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> profit</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_year</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    nation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_year </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=4, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=false, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_custkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_extendedprice </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> revenue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_acctbal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    n_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_phone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_comment</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    customer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> o_custkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">l_extendedprice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">l_discount </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> lineitem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> orders</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> l_orderkey </span><span class="token operator">=</span><span class="token plain"> o_orderkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> o_orderdate </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1993-10-01'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> o_orderdate </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1993-10-01'</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'3'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">month</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> l_returnflag </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'R'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    nation</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_custkey </span><span class="token operator">=</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> c_nationkey </span><span class="token operator">=</span><span class="token plain"> n_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_custkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_acctbal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_phone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    n_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_comment</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    revenue </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q11</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=true, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    ps_partkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ps_supplycost </span><span class="token operator">*</span><span class="token plain"> ps_availqty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    partsupp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> nation</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> s_nationkey </span><span class="token operator">=</span><span class="token plain"> n_nationkey </span><span class="token operator">and</span><span class="token plain"> n_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'GERMANY'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> B</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    ps_suppkey </span><span class="token operator">=</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    ps_partkey </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">having</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ps_supplycost </span><span class="token operator">*</span><span class="token plain"> ps_availqty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ps_supplycost </span><span class="token operator">*</span><span class="token plain"> ps_availqty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">0.000002</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                partsupp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> nation</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> s_nationkey </span><span class="token operator">=</span><span class="token plain"> n_nationkey </span><span class="token operator">and</span><span class="token plain"> n_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'GERMANY'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> A</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                ps_suppkey </span><span class="token operator">=</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">value</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q12</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=true, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_shipmode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">when</span><span class="token plain"> o_orderpriority </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1-URGENT'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">or</span><span class="token plain"> o_orderpriority </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2-HIGH'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> high_line_count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">when</span><span class="token plain"> o_orderpriority </span><span class="token operator">&lt;></span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1-URGENT'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> o_orderpriority </span><span class="token operator">&lt;></span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2-HIGH'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> low_line_count</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    orders</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lineitem</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    o_orderkey </span><span class="token operator">=</span><span class="token plain"> l_orderkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_shipmode </span><span class="token operator">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'MAIL'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'SHIP'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_commitdate </span><span class="token operator">&lt;</span><span class="token plain"> l_receiptdate</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_shipdate </span><span class="token operator">&lt;</span><span class="token plain"> l_commitdate</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_receiptdate </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1994-01-01'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_receiptdate </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1994-01-01'</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">year</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_shipmode</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_shipmode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q13</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=45899345920, parallel_fragment_exec_instance_num=16, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=true, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> custdist</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            c_custkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">o_orderkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> c_count</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            orders </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">right</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">outer</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> customer </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                c_custkey </span><span class="token operator">=</span><span class="token plain"> o_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                </span><span class="token operator">and</span><span class="token plain"> o_comment </span><span class="token operator">not</span><span class="token plain"> </span><span class="token operator">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'%special%requests%'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            c_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> c_orders</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_count</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    custdist </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_count </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q14</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=true, enable_projection=true, runtime_filter_mode=OFF) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token number">100.00</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">when</span><span class="token plain"> p_type </span><span class="token operator">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'PROMO%'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"> l_extendedprice </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_extendedprice </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> promo_revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lineitem</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    l_partkey </span><span class="token operator">=</span><span class="token plain"> p_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_shipdate </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1995-09-01'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_shipdate </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1995-09-01'</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">month</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q15</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=true, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_suppkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_phone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    total_revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    supplier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    revenue0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_suppkey </span><span class="token operator">=</span><span class="token plain"> supplier_no</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> total_revenue </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">max</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">total_revenue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            revenue0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    s_suppkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q16</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=8, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=true, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_brand</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">distinct</span><span class="token plain"> ps_suppkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> supplier_cnt</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    partsupp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    part</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_partkey </span><span class="token operator">=</span><span class="token plain"> ps_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> p_brand </span><span class="token operator">&lt;></span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Brand#45'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> p_type </span><span class="token operator">not</span><span class="token plain"> </span><span class="token operator">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MEDIUM POLISHED%'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> p_size </span><span class="token operator">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">49</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">14</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">23</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">45</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">19</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">36</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">9</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> ps_suppkey </span><span class="token operator">not</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            s_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            supplier</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            s_comment </span><span class="token operator">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'%Customer%Complaints%'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_brand</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_size</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    supplier_cnt </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_brand</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q17</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=1, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=true, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_extendedprice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">7.0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> avg_yearly</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lineitem </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">broadcast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    part p1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p_partkey </span><span class="token operator">=</span><span class="token plain"> l_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    p1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p_brand </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Brand#23'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p_container </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MED BOX'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> l_quantity </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token number">0.2</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">avg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_quantity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            lineitem </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">broadcast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            part p2 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> p2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p_partkey </span><span class="token operator">=</span><span class="token plain"> l_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            l_partkey </span><span class="token operator">=</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> p2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p_brand </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Brand#23'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> p2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p_container </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MED BOX'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q18</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=45899345920, parallel_fragment_exec_instance_num=4, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=true, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_custkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_orderkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_orderdate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_totalprice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_quantity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">customer </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  lineitem </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    orders </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">left</span><span class="token plain"> semi </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          l_orderkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          lineitem</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          l_orderkey </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">having</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_quantity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">></span><span class="token plain"> </span><span class="token number">300</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> o_orderkey </span><span class="token operator">=</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_orderkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t2</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_orderkey </span><span class="token operator">=</span><span class="token plain"> l_orderkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> c_custkey </span><span class="token operator">=</span><span class="token plain"> t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_custkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    c_custkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_orderkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_orderdate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_totalprice</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_totalprice </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">o_orderdate</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q19</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=false, enable_cost_based_join_reorder=false, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_extendedprice</span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> l_discount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> revenue</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lineitem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    part</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        p_partkey </span><span class="token operator">=</span><span class="token plain"> l_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> p_brand </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Brand#12'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> p_container </span><span class="token operator">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'SM CASE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'SM BOX'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'SM PACK'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'SM PKG'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> l_quantity </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> l_quantity </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> p_size </span><span class="token operator">between</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> l_shipmode </span><span class="token operator">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'AIR'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AIR REG'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> l_shipinstruct </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'DELIVER IN PERSON'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">or</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        p_partkey </span><span class="token operator">=</span><span class="token plain"> l_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> p_brand </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Brand#23'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> p_container </span><span class="token operator">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'MED BAG'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MED BOX'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MED PKG'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'MED PACK'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> l_quantity </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> l_quantity </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> p_size </span><span class="token operator">between</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> l_shipmode </span><span class="token operator">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'AIR'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AIR REG'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> l_shipinstruct </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'DELIVER IN PERSON'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">or</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        p_partkey </span><span class="token operator">=</span><span class="token plain"> l_partkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> p_brand </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Brand#34'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> p_container </span><span class="token operator">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'LG CASE'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'LG BOX'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'LG PACK'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'LG PKG'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> l_quantity </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> l_quantity </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> p_size </span><span class="token operator">between</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> </span><span class="token number">15</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> l_shipmode </span><span class="token operator">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'AIR'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'AIR REG'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token operator">and</span><span class="token plain"> l_shipinstruct </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'DELIVER IN PERSON'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q20</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=2, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=true, enable_projection=true, runtime_bloom_filter_size=551943) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">s_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> s_address </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">supplier </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">left</span><span class="token plain"> semi </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> l_partkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">l_suppkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0.5</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l_quantity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> l_q</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> lineitem</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> l_shipdate </span><span class="token operator">>=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1994-01-01'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token operator">and</span><span class="token plain"> l_shipdate </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1994-01-01'</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interval</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'1'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">year</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> l_partkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">l_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t2 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> ps_partkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ps_suppkey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ps_availqty</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> partsupp </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">left</span><span class="token plain"> semi </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> part</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> ps_partkey </span><span class="token operator">=</span><span class="token plain"> p_partkey </span><span class="token operator">and</span><span class="token plain"> p_name </span><span class="token operator">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'forest%'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_partkey </span><span class="token operator">=</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ps_partkey </span><span class="token operator">and</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_suppkey </span><span class="token operator">=</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ps_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ps_availqty </span><span class="token operator">></span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_q</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> s_suppkey </span><span class="token operator">=</span><span class="token plain"> t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ps_suppkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> nation</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> s_nationkey </span><span class="token operator">=</span><span class="token plain"> n_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token operator">and</span><span class="token plain"> n_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'CANADA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> s_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q21</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=4, enable_vectorized_engine=true, batch_size=4096, disable_join_reorder=true, enable_cost_based_join_reorder=true, enable_projection=true) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">s_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> numwait</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  lineitem l2 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">right</span><span class="token plain"> semi </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    lineitem l3 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">right</span><span class="token plain"> anti </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      orders </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> lineitem l1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> l1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_orderkey </span><span class="token operator">=</span><span class="token plain"> o_orderkey </span><span class="token operator">and</span><span class="token plain"> o_orderstatus </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'F'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        supplier </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> nation</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> s_nationkey </span><span class="token operator">=</span><span class="token plain"> n_nationkey</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">          </span><span class="token operator">and</span><span class="token plain"> n_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'SAUDI ARABIA'</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t1</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">s_suppkey </span><span class="token operator">=</span><span class="token plain"> l1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_suppkey </span><span class="token operator">and</span><span class="token plain"> l1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_receiptdate </span><span class="token operator">></span><span class="token plain"> l1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_commitdate</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t2</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> l3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_orderkey </span><span class="token operator">=</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_orderkey </span><span class="token operator">and</span><span class="token plain"> l3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_suppkey </span><span class="token operator">&lt;></span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_suppkey  </span><span class="token operator">and</span><span class="token plain"> l3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_receiptdate </span><span class="token operator">></span><span class="token plain"> l3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_commitdate</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> t3</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> l2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_orderkey </span><span class="token operator">=</span><span class="token plain"> t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_orderkey </span><span class="token operator">and</span><span class="token plain"> l2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_suppkey </span><span class="token operator">&lt;></span><span class="token plain"> t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">l_suppkey </span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">s_name</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    numwait </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    t3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">s_name</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">--Q22</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> tmp </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">avg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">c_acctbal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> av</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                    customer</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                    c_acctbal </span><span class="token operator">></span><span class="token plain"> </span><span class="token number">0.00</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                    </span><span class="token operator">and</span><span class="token plain"> substring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">c_phone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'13'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'31'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'23'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'29'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'30'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'18'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'17'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/*+SET_VAR(exec_mem_limit=8589934592, parallel_fragment_exec_instance_num=4,runtime_bloom_filter_size=4194304) */</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cntrycode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> numcust</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">c_acctbal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> totacctbal</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">	</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            substring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">c_phone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> cntrycode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            c_acctbal</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">             orders </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">right</span><span class="token plain"> anti </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> customer c </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain">  o_custkey </span><span class="token operator">=</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">c_custkey </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> tmp </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">c_acctbal </span><span class="token operator">></span><span class="token plain"> tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">av</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">            substring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">c_phone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">in</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'13'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'31'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'23'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'29'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'30'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'18'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'17'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> custsale</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cntrycode</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    cntrycode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/principle-of-Doris-Stream-Load/>Doris stream load principle analysis</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2022-09-08T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2022年9月8日</time></div></header><div class=markdown itemprop=articleBody><p><strong>Lead：</strong></p>
<p>Stream Load, one of the most commonly used data import methods for Doris users, is a synchronous import method. It allows users to import data into Doris in batch through HTTP access and returns the results of data import. The user can not only directly judge whether the data import is successful through the return body of the HTTP request, but also query the results of historical tasks by executing query SQL on the client.</p>
<p>The Doris import (Load) function is to import the user's original data into the Doris table. And Doris realizes a unified streaming import framework at the bottom. On this basis, Doris provides a very rich import mode to adapt to different data sources and data import requirements. Stream Load is one of the most commonly used data import methods for Doris users. It is a synchronous import method that allows users to import data in CSV format or JSON format into Doris in batch through HTTP access and return the results of data import. User can directly judge whether the data import is successful through the return body of the HTTP request, and can query the results of historical tasks by executing query SQL on the client. In addition, Doris also provides the operation audit function for Stream Load, which can audit the historical Stream Load task information through the audit log. The implementation principle of Stream Load will be deeply analyzed from the aspects of execution process, transaction management, implementation of import plan, data writing and operation audit of Stream Load.</p>
<h1>1 Implementation Process</h1>
<p>The user submits the HTTP request of Stream Load to the FE, and the FE will forward the data import request to a BE node through HTTP Redirect, which will be the Coordinator of this Stream Load task. In this process, the FE node receiving the request only provides forwarding service. The BE node as the Coordinator is actually responsible for the entire import job, such as sending transaction requests to the Master FE, obtaining import execution plans from the FE, receiving real-time data, distributing data to other Executor BE nodes, and returning results to the user after data import. The user can also submit the HTTP request of Stream Load directly to a specified BE node, and the node will act as the Coordinator of this Stream Load task. During the Stream Load process, the Executor BE node is responsible for writing data to the storage layer.</p>
<p>In the Coordinator BE, all HTTP requests, including Stream Load requests, are processed through a thread pool. A Stream Load task is uniquely identified by the imported Label. The principle block diagram of Stream Load is shown in Figure 1.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_1_en-b2fe685555585338cf6207b8d24a878e.png width=1080 height=1044 class=img_ev3q></p>
<p>The complete execution process of Stream Load is shown in Figure 2:</p>
<p>(1)The user submits the HTTP request of Stream Load to the FE (the user can also directly submit the HTTP request of Stream Load to the Coordinator BE).</p>
<p>(2)FE, after receiving the Stream Load request submitted by the user, will perform HTTP Header parsing (including the library, table, Label and other information imported by parsing data), and then perform user authentication. If the HTTP Header is successfully resolved and the user authentication passes, the FE will forward the HTTP request of Stream Load to a BE node, which will be the Coordinator of this Stream Load. Otherwise, the FE will directly return the failure information of Stream Load to the user.</p>
<p>(3)After receiving the HTTP request from Stream Load, the Coordinator BE will first perform HTTP Header parsing and data verification, including the file format of the parsed data, the size of the data body, the HTTP timeout, and user authentication. If the Header data verification fails, the Stream Load failure information will be directly returned to the user.</p>
<p>(4)After the HTTP Header data verification is passed, the Coordinator BE will send a Begin Transaction request to the FE through Thrift RPC.</p>
<p>(5)After the FE receives the Begin Transaction request sent by the Coordinator BE, it will start a transaction and return the Transaction ID to the Coordinator BE.</p>
<p>(6)After the Coordinator BE receives the Begin Transaction success information, it will send a request to get the import plan to the FE through Thrift RPC.</p>
<p>(7)After receiving the request for obtaining the import plan sent by the Coordinator BE, the FE will generate the import plan for the Stream Load task and return it to the Coordinator BE.</p>
<p>(8)After receiving the import plan, the Coordinator BE starts to execute the import plan, including receiving the real-time data from HTTP and distributing the real-time data to other Executor BE through BRPC.</p>
<p>(9)After receiving the real-time data distributed by the Coordinator BE, the Executor BE is responsible for writing the data to the storage layer.</p>
<p>(10)After the Executor BE completes data writing, the Coordinator BE sends a Commit Transaction request to the FE through Thrift RPC.</p>
<p>(11)After receiving the Commit Transaction request sent by the Coordinator BE, the FE will commit transaction, send the Publish Version task to the Executor BE, and wait for the Executor BE to execute the Publish Version.</p>
<p>(12)The Executor BE asynchronously executes the Publish Version to change the Rowset generated by data import into a visible data version.</p>
<p>(13)After the Publish Version completes normally or the execution timeout, the FE returns the results of the Commit Transaction and the Publish Version to the Coordinator BE.</p>
<p>(14)The Coordinator BE returns the final result of Stream Load to the user.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_2_en-c2ea39e56fb64fa30ef649c281ee5e67.png width=1068 height=1461 class=img_ev3q></p>
<h1>2 Transaction Management</h1>
<p>Doris ensures the atomicity of data import through Transaction. One Stream Load task corresponds to one transaction. The FE is responsible for the transaction management of Stream Load. The FE receives the Thrift RPC transaction request sent by the Coordinator BE node through the FrontendService. Transaction request types include Begin Transaction, Commit Transaction and Rollback Transaction. The transaction states of Doris include PREPARE, COMMITTED, VISIBLE, and ABORTED. The status flow process of the Stream Load transaction is shown in Figure 3.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_3_en-afe100ea9995f8032cf312bb75825028.png width=1080 height=165 class=img_ev3q></p>
<p>The Coordinator BE node will send a Begin Transaction request to the FE before data import. The FE will check whether the label requested by the Begin Transaction already exists. If the label does not exist in the system, it will open a new transaction for the current label, assign a Transaction ID to the transaction, and set the transaction status to PREPARE, then returns the Transaction ID and the success information of the Begin Transaction to the Coordinator BE. Otherwise, this transaction may be a repeated data import. The FE returns the Begin Transaction failure message to the Coordinator BE, and the Stream Load task exits.</p>
<p>After the data is written in all Executor BE nodes, the Coordinator BE node will send a Commit Transaction request to the FE. After receiving the Commit Transaction request, the FE will execute the Commit Transaction and Publish Version operations. First, the FE will judge whether the number of replicas of data successfully written by each Tablet exceeds half of the total number of replicas of the tablet. If the number of replicas of data successfully written by each Tablet exceeds half of the total number of replicas of the Tablet (most of them are successful), the Commit Transaction is successful and the transaction status is set to COMMITTED; Otherwise, the Commit Transaction failure information is returned to the Coordinator BE. The COMMITTED status indicates that the data has been written successfully, but the data is not visible. You need to continue to execute the Publish Version task. After that, the transaction cannot be rolled back.</p>
<p>The FE will have a separate thread to execute the Publish Version on the Transaction with successful Commit. When the Publish Version is executed, the FE will send the Publish Version request to all Executor BE nodes related to the Transaction through Thrift RPC. The Publish Version task is executed asynchronously on each Executor BE node, and the Rowset generated by data import is changed into a visible data version. When all the Publish Version tasks on the Executor BE are successfully executed, the FE will set the transaction status to VISIBLE, and return the Commit Transaction and Publish Version success information to the Coordinator BE. When some Publish Version tasks fail, the FE will repeatedly issue a Publish Version request to the Executor BE node until the previously failed Publish Version task succeeds. If the transaction status has not been set to VISIBLE after a certain timeout period, the FE will return to the Coordinator BE the information that the Commit Transaction was successful but the Publish Version timed out (note that at this time, the data is still written successfully, but it is still invisible, and the user needs to wait for the transaction status to finally become VISIBLE).</p>
<p>When obtaining the import plan from the FE fails, executing data import fails, or Commit Transaction fails, the Coordinator BE node will send a Rollback Transaction request to the FE to execute transaction rollback. After receiving the transaction rollback request, the FE will set the transaction status to ABORTED, and send a Clear Transaction request to the Executor BE through Thrift RPC. The Clear Transaction task is asynchronously executed at the BE node, marking the Rowset generated by data import as unavailable. These Rowset will be deleted from the BE later. Transactions with COMMITTED status (transactions with Commit Transaction succeeded but Publish Version timed out) cannot be rolled back.</p>
<h1>3 Execution of the import plan</h1>
<p>In Doris BE, all execution plans are managed by FragmentMgr, and the execution of each import plan is managed by PlanFragmentExecutor. After the BE obtains the import execution plan from the FE, it will submit the import plan to the thread pool of FragmentMgr for execution. The import execution plan of Stream Load has only one Fragment, including one BrokerScanNode and one OlapTableSink. BrokerScanNode is responsible for reading streaming data in real time and converting the data lines in CSV format or JSON format to the Tuple format of Doris. OlapTableSink is responsible for sending real-time data to the corresponding Executor BE node. The Executor BE node corresponding to each data row is determined by which BE the Tablet where the data row is stored. The Partition and Tablet where the data row is stored can be determined according to the PartitionKey and DistributionKey of the data row. The BE node on which each Tablet and its replica are stored has been determined when the Table or Partition is created.</p>
<p>After importing the execution plan and submitting it to the thread pool of FragmentMgr, the Stream Load thread will receive the real-time data transmitted through HTTP in chunks and write it to the StreamLoadPipe. The BrokerScanNode will read the real-time data in batches from the StreamLoadPipe. OlapTableSink will send the batch data read by the BrokerScanNode to the Executor BE through BRPC for data writing. After all real-time data is written to the StreamLoadPipe, the Stream Load thread will wait for the import plan to finish.</p>
<p>The PlanFragmentExecutor executes a specific import plan process, which consists of three stages: Prepare, Open, and Close. In the Prepare stage, the import execution plan from the FE is mainly analyzed; In the Open stage, BrokerScanNode and OlapTableSink will be opened. BrokerScanNode is responsible for reading the real-time data of one Batch at a time, and OlapTableSink is responsible for calling BRPC to send the data of each Batch to other Executor BE nodes; In the Close stage, it is responsible for waiting for the data import to end and closing the BrokerScanNode and OlapTableSink. The import execution plan of Stream Load is shown in Figure 4.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_4_en-6bf14a31ea5acff82e83e5745a3603aa.png width=1080 height=888 class=img_ev3q></p>
<p>OlapTableSink is responsible for the data distribution of the Stream Load task. Tables in Doris may have Rollup or Materialized view. Each Table and its Rollup and Materialized view are called an Index. In the process of data distribution, the IndexChannel will maintain a data distribution channel of the Index. The Tablet under the Index may have multiple replicas and are distributed on different BE nodes. The NodeChannel will maintain the data distribution channel of an Executor BE node under the IndexChannel. Therefore, the OlapTableSink contains multiple IndexChannel, and each NodeChannel contains multiple NodeChannel, as shown in Figure 5.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_5_en-f040fee94a651a88a2a3ef68de235532.png width=1080 height=471 class=img_ev3q></p>
<p>When OlapTableSink distributes data, it will read the data Batch obtained by BrokerScanNode row by row, and add the data row to the IndexChannel of each Index. The Partition and Tablet of the data row can be determined according to the PartitionKey and DistributionKey, and then the corresponding Tablet of the data row in other Index can be calculated according to the order of the Tablet in the Partition. Each Tablet may have multiple replicas distributed on different BE nodes. Therefore, in the IndexChannel, each data row will be added to the NodeChannel corresponding to each replica of its Tablet. Each NodeChannel has a send queue. When the new data rows in NodeChannel accumulate to a certain size, they will be added to the send queue as a data Batch. There will be a fixed thread in OlapTableSink to train each NodeChannel under each IndexChannel in turn, and call BRPC to send a data Batch in the sending queue to the corresponding Executor BE. The data distribution process of the Stream Load task is shown in Figure 6.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_6_en-20cfadfbbb14b377e4a0debd6ef0bb1b.png width=1080 height=850 class=img_ev3q></p>
<h1>4 <strong>Data Write</strong></h1>
<p>After receiving the data Batch sent by the Coordinator BE, the BRPC server of the Executor BE will submit the data writing task to the thread pool for asynchronous execution. In Doris BE, data is written to the storage layer in a hierarchical manner. Each Stream Load task corresponds to a LoadChannel on each Executor BE. The LoadChannel maintains the data writing channel of a Stream Load task and is responsible for the data writing of a Stream Load task on the current Executor BE node, LoadChannel can write the data of a Stream Load task in the current BE node to the storage layer in batches until the Stream Load task is completed. Each LoadChannel is uniquely identified by the load ID, and all LoadChannel on the BE node are managed by LoadChannelMgr. The Table corresponding to a Stream Load task may have multiple Index. Each Index corresponds to a TabletsChannel, which is uniquely identified by the Index ID. Therefore, there will be multiple TabletsChannel under each LoadChannel. The TabletsChannel maintains an Index data writing channel, which is responsible for managing the data writing of all the Tablet under the Index. The TabletsChannel will read the data Batch row by row and write it to the corresponding Tablet through the DeltaWriter. The DeltaWriter maintains a data writing channel of a Tablet, which is uniquely identified by the Tablet ID. it is responsible for receiving the data import of a single Tablet and writing the data into the MemTable corresponding to the tablet. When the MemTable is full, the data in the MemTable will be flushed to the disk and Segment files will be generated. MemTable adopts the data structure of SkipList to temporarily store the data in memory. SkipList will sort the data rows according to the Key of Schema. In addition, if the data model is Aggregate or Unique, MemTable will aggregate data rows with the same Key. The data write channel of the Stream Load task is shown in Figure 7.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_7_en-757ccfec5d94537f5e85cc8026cc0d4a.png width=1080 height=656 class=img_ev3q></p>
<p>The Flush operation of MemTable is performed asynchronously by MemtableFlushExecutor. After the MemTable Flush task is submitted to the thread pool, a new MemTable will be generated to receive the subsequent data writing of the current Tablet. When the MemtableFlushExecutor performs data Flush, the RowsetWriter will read out all the data in the MemTable and write out multiple Segment files through the SegmentWriter. The size of each Segment file is no more than 256MB. For a Tablet, each Stream Load task will generate a newRowset. The generated Rowset can contain multiple Segment files. The data writing process of the Stream Load task is shown in Figure 8.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_8_en-11db5419d6ebd287d1abcb254fd174f0.png width=1073 height=1280 class=img_ev3q></p>
<p>The TxnManager on the Executor BE node is responsible for transaction management of Tablet level data import. When the Delta Writer is initialized, the PrepareTransaction will be executed to add the data write transaction of the corresponding Tablet in the current Stream Load task to the TxnManager for management. When the data write Tablet is completed and the DeltaWriter is closed, the Commit Transaction will be executed to add the new Rowset generated by the data import to the TxnManager for management. Note that the TxnManager here is only responsible for the transactions on a single BE, while the transaction management in the FE is responsible for the overall import of transactions.</p>
<p>After the data import is completed, when the Executor BE executes the Publish Version task issued by the FE, it will execute the Publish Transaction to change the new Rowset generated by the data import into a visible version, and delete the data writing task of the corresponding Tablet in the current Stream Load task from the TxnManager. This means that the data writing transaction of the Tablet in the current Stream Load task ends.</p>
<h1>5 <strong>Stream Load Operation Audit</strong></h1>
<p>Doris adds the operation audit function to Stream Load. After each Stream Load task is completed and the results are returned to the user, the Coordinator BE will persistently store the detailed information of this Stream Load task on the local RocksDB. The Master FE periodically pulls the information of the completed Stream Load task from each BE node of the cluster through Thrift RPC, pulls a batch of Stream Load operation records from one BE node at a time, and writes the pulled Stream Load task information into the audit log (fe.audit.log). Each Stream Load task information stored on the BE will be set with an expiration time (TTL), and the expired Stream Load task information will be deleted when RocksDB executes the Compaction. The user can audit the historical Stream Load task information through the FE audit log.</p>
<p>When the FE writes the pulled Stream Load task information into the Audit log, it will keep a copy in the memory. In order to prevent memory expansion, a fixed number of Stream Load task information will be kept in the memory. As the subsequent data pulling continues, the early Stream Load task information will be gradually eliminated from the FE memory. The user can query the latest Stream Load task information by executing the SHOW STREAM LOAD command at the client.</p>
<h1><strong>Summary</strong></h1>
<p>In this paper, the implementation principle of Stream Load is deeply analyzed from the aspects of execution process, transaction management, implementation of import plan, data writing and operation audit of Stream Load. Stream Load is one of the most commonly used data import methods for Doris users. It is a synchronous import method that allows users to import data into Doris in batch through HTTP access and return the results of data import. The user can not only directly judge whether the data import is successful through the return body of the HTTP request, but also query the results of historical tasks by executing query SQL on the client. Otherwise, Doris also provides the result audit function for Stream Load, which can audit the historical Stream Load task information through the audit log.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/principle-of-Doris-SQL-parsing/>Doris analysis: Doris SQL principle analysis</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2022-08-25T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2022年8月25日</time></div></header><div class=markdown itemprop=articleBody><p><strong>Lead：</strong>
This article mainly introduces the principle of Doris SQL parsing.</p>
<p>It focuses on generating a single-machine logical plan, developing a distributed logical plan, and generating a distributed physical plan. Analyze, SinglePlan, DistributedPlan, and Schedule four parts correspond to the code implementation.</p>
<p>First, AST will be processed preliminary by Analyze and then optimized by SinglePlan to generate a single-machine query plan. Third, DistributedPlan will split the single-machine query plan into distributed query plans. In the end, the query plan will be sent to machines and executed orderly, which decide by Schedule.</p>
<p>Since there are many types of SQL, this article focuses on the analysis of query SQL. Doris's SQL analysis will be explained deeply in the algorithm principle and code implementation.</p>
<p>Doris is an interactive SQL database based on MPP architecture, mainly used to solve near real-time reports and multi-dimensional analysis. The Doris architecture is straightforward, with only two types of processes.</p>
<ul>
<li>
<p>Frontend（FE）: It is mainly responsible for user request access, query parsing and planning, storage and management of metadata, and node management-related work.</p>
</li>
<li>
<p>Backend（BE）: It is mainly responsible for data storage and query plan execution.</p>
</li>
</ul>
<p>In Doris' storage engine, data will be horizontally divided into several data shards (Tablet, also called data bucket). Each tablet contains several rows of data. Multiple Tablets belong to different partitions logically. A Tablet only belongs to one Partition. And a Partition contains several Tablets. Tablet is the smallest physical storage unit for operations such as data movement, copying, etc.</p>
<h1>2. SQL parsing In Apache Doris</h1>
<p>SQL parsing in this article refers to <strong>the process of generating a complete physical execution plan after a series of parsing of an SQL statement</strong>.</p>
<p>This process includes the following four steps: lexical analysis, syntax analysis, generating a logical plan, and generating a physical plan.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_1_en-0c09f140305ed3879a5bdd86428f0f1c.png width=1080 height=446 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=21-lexical-analysis>2.1 Lexical analysis<a href=#21-lexical-analysis class=hash-link aria-label="2.1 Lexical analysis的直接链接" title="2.1 Lexical analysis的直接链接">​</a></h2>
<p>The lexical analysis will identify the SQL in the form of a string into tokens, in preparation for the grammatical analysis.</p>
<div class="language-undefined codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-undefined codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">select ......  from ...... where ....... group by ..... order by ......</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">SQL Tokens could be divided into the following categories:</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">￮ Keywords (select, from, where)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">￮ operator (+, -, >=)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">￮ Open/close flag ((, CASE)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">￮ placeholder (?)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">￮ Comments</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">￮ space</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">......</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=22-syntax-analysis>2.2 Syntax analysis<a href=#22-syntax-analysis class=hash-link aria-label="2.2 Syntax analysis的直接链接" title="2.2 Syntax analysis的直接链接">​</a></h2>
<p>The syntax analysis will convert the token generated by the lexical analysis into an abstract syntax tree based on the syntax rules, as shown in Figure 2.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_2_en-3288af3435350e506b2d1f6314172e64.png width=1080 height=473 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=23-logical-plan>2.3 Logical plan<a href=#23-logical-plan class=hash-link aria-label="2.3 Logical plan的直接链接" title="2.3 Logical plan的直接链接">​</a></h2>
<p>The logical plan converts the abstract syntax tree into an algebraic relation, which is an operator tree, and each node represents a calculation method for data. The entire tree represents the calculation method and flows direction of data, as shown in Figure 3.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_3_en-7a6ac1b525922fce20195f2224d176ad.png width=573 height=893 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=24-physical-plan>2.4 Physical plan<a href=#24-physical-plan class=hash-link aria-label="2.4 Physical plan的直接链接" title="2.4 Physical plan的直接链接">​</a></h2>
<p>The physical plan is the plan that determines which computing operations are performed on which machines. It will be generated based on the logical plan, the distribution of machines, and the distribution of data.</p>
<p>The SQL parsing of the Doris system also adopts these steps, but it is refined and optimized according to the characteristics of the Doris system structure and the storage method of data to maximize the computing power of the machine.</p>
<h1>3. Design goals</h1>
<p>The design goals of the Doris SQL parsing architecture are:</p>
<ol>
<li>
<p>Maximize Computational Parallelism</p>
</li>
<li>
<p>Minimize network transfer of data</p>
</li>
<li>
<p>Minimize the amount of data that needs to be scanned</p>
</li>
</ol>
<h1>4. Architecture</h1>
<p>Doris SQL parsing includes five steps: lexical analysis, syntax analysis, generation of a stand-alone logical plan, generation of a distributed logical plan, and generation of a physical execution plan.</p>
<p>In terms of code implementation, it corresponds to the following five steps: Parse, Analyze, SinglePlan, DistributedPlan, and Schedule, which as shown in Figure 4.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_4_en-cd2aa449d728cd42554bbf7ddbdbaad6.png width=1080 height=1682 class=img_ev3q></p>
<p>The Parse phase will not be discussed in this article. Analyze will do some pre-processing of the AST. A stand-alone query plan will be optimized by SinglePlan based on the AST. DistributedPlan will split the stand-alone query plan into distributed query plans. Schedule phase will determine which machines the query plan will be sent to for execution.</p>
<p><strong>Since there are many types of SQL, this article focuses on the analysis of query SQL.</strong></p>
<p>Figure 5 shows a simple query SQL parsing implementation in Doris.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_5_en-cd3c8dd60e28999551acce60541797d2.png width=1080 height=1344 class=img_ev3q></p>
<h1>5. Parse Phase</h1>
<p>In the Parse stage, JFlex technology is used for lexical analysis, java cup parser technology is used for syntax analysis, and an AST（Abstract Syntax Tree）will finally generate. These are existing and mature technologies and will not be introduced in detail here.</p>
<p>AST has a tree-like structure, which represents a piece of SQL. Therefore, different types of queries -- select, insert, show, set, alter table, create table, etc. will generate additional data structures after Parse (SelectStmt, InsertStmt, ShowStmt, SetStmt, AlterStmt, AlterTableStmt, CreateTableStmt, etc.). However, they all inherit from Statements and will perform some specific processing according to their own grammar rules. For example: for select type SQL, the SelectStmt structure will be generated after Parse.</p>
<p>SelectStmt structure contains SelectList, FromClause, WhereClause, GroupByClause, SortInfo and other structures. These structures contain more basic data structures. For Example, WhereClause contains BetweenPredicate, BinaryPredicate, CompoundPredicate, InPredicate, and so on.</p>
<p>All structures in AST are composed of basic structure expressions--Expr by using various combinations, as shown in Figure 6.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_6_en-39088e65b97c95938d6cf9c1aba359e8.png width=1080 height=718 class=img_ev3q></p>
<h1>6. Analyze Phase</h1>
<p>Analyze will perform pre-processing and semantic analysis on the abstract syntax tree AST generated in the Parse phase, preparing for the generation of stand-alone logic plans.</p>
<p>The abstract class StatementBase represents the abstract syntax tree. This abstract class contains a most crucial member function--analyze(), which is used to perform what's needed to do in Analyze phase.</p>
<p>Different types of queries (select, insert, show, set, alter table, create table, etc.) will generate different data structures through the Parse stage(SelectStmt, InsertStmt, ShowStmt, SetStmt, AlterStmt, AlterTableStmt, CreateTableStmt, etc.), these data structures inherit From StatementBase, and perform a specific Analysis on a specific type sof SQL by implementing the analyze() function.</p>
<p>For example, a query of select type will be converted into analyze() of the sub-statements SelectList, FromClause, GroupByClause, HavingClause, WhereClause, SortInfo, etc. of select SQL. Then these sub-statements further analyze() their sub-structures, and various scenarios of various types of SQL are analyzed by layer-by-layer iteration. For example, WhereClause will further explore the BetweenPredicate, BinaryPredicate, CompoundPredicate, InPredicate, etc., which it contains.</p>
<p><strong>For query type SQL, Analyze will performs several important steps:</strong></p>
<ul>
<li>
<p><strong>Metadata identification and parsing</strong>： Identify and parse metadata such as Cluster, Database, Table, Column, etc. involved in SQL, and determine which columns, tables, databases, and clusters need to be calculated.</p>
</li>
<li>
<p><strong>SQL correctness check</strong>：such as the window function cannot DISTINCT, whether the projection column is ambiguous, the where statement cannot contain grouping operations, etc.</p>
</li>
<li>
<p><strong>Rewrite SQL simply</strong>：for example, expand select * to select all columns, convert count distinct to bitmap or hll function, etc.</p>
</li>
<li>
<p><strong>Function correctness check</strong>：Check whether the functions contained in SQL are consistent with the system-defined procedures, including parameter types, number of parameters, etc.</p>
</li>
<li>
<p><strong>Aliasing for Table and Column.</strong></p>
</li>
<li>
<p><strong>Type checking and conversion</strong>： For example, when the types on both sides of a binary expression are inconsistent, one of the types needs to be converted (with BIGINT and DECIMAL, the BIGINT type needs to be cast to DECIMAL).</p>
</li>
</ul>
<p>After analyzing the AST, a rewrite operation will be performed again to simplify or convert it into a unified processing method. A present rewrite algorithm is a rule-based approach. It will rewrite the AST with each rule from bottom to top, based on the tree structure of the AST. If the AST changes after rewriting, analysis and rewrite will start again until there is no change in the AST.</p>
<p>For example: simplification of constant expressions: 1 + 1 + 1 is rewritten as 3, 1 > 2 is rewritten as Flase, etc. Convert some statements into a unified processing method, such as rewriting where in, where exists as semi join, where not in, where not exists as anti join.</p>
<h1>7. Generate stand-alone logical Plan phase</h1>
<p>At this stage, algebraic relations will be generated according to the AST abstract syntax tree, also known as the operator number. Each node on the tree is an operator, representing an operation.</p>
<p>As shown in Figure 7, ScanNode represents scan and read operations on a table. HashJoinNode represents the join operation. A hash table of a small table will be constructed in memory, and the large table will be traversed to find the exact value of the join key. Project means the projection operation, which represents the column that needs to be output at the end. Figure 7 shows that only citycode column will output.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_7_en-3b659a292f7c875ca9651197305c47ab.png width=1080 height=543 class=img_ev3q></p>
<p>Without optimization, the generated relational algebra is very expensive to send to storage and execute.</p>
<p>For query:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">siteid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">pv </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> table1 a </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">join</span><span class="token plain"> table2 b </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">on</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">siteid </span><span class="token operator">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">siteid </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">citycode</span><span class="token operator">=</span><span class="token number">122216</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">username</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"test"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">by</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">pv </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">limit</span><span class="token plain"> </span><span class="token number">10</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>As shown in Figure 8, for unoptimized relational algebra, all columns need to be read out for a series of calculations. In the end, siteid and pv column are selected and output. A large amount of useless column data wastes computing resources.</p>
<p>When Doris generates algebraic relations, a lot of optimizations are made: the projection columns and query conditions will be put into the scan operation as much as possible.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_8_en-021b337867f379cc036dfbe34f5fe9f8.png width=500 height=1110 class=img_ev3q></p>
<p><strong>Specifically, this phase mainly does the following tasks:</strong></p>
<ul>
<li>
<p><strong>Slot materialization</strong>：Determine the column that needs to be scanned and calculated for the expression. Such as aggregate function expressions and Group By words of aggregate nodes need to be materialized.</p>
</li>
<li>
<p><strong>Projection pushdown</strong>：BE only scans the columns that must be read when Scanning.</p>
</li>
<li>
<p><strong>Predicate pushdown</strong>：Push down the filter conditions to the Scan node as much as possible under the premise of semantically correct.</p>
</li>
<li>
<p><strong>Partition, bucket cutting</strong>：According to the information in the filter conditions, determine which partitions and buckets of tablets need to be scanned.</p>
</li>
<li>
<p><strong>Join Reorder</strong>：For Inner Join, Doris will adjust the order of the table according to the number of rows--put the large table in the front.</p>
</li>
<li>
<p><strong>Sort + Limit optimized to TopN</strong>：For the order by the limit statement, it will be converted into TopN operation nodes, which is convenient for unified processing.</p>
</li>
<li>
<p><strong>MaterializedView selection</strong>: The best-materialized view will be selected according to the columns required by the query, the columns for filtering, sorting and Join, the number of rows, the number of columns, and other factors.</p>
</li>
</ul>
<p>Figure 9 shows an example of optimization. The optimization of Doris is carried out in generating relational algebra. Generating one will optimize one.· Projection pushdown: BE only scans the columns that must be read when Scanning.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_9_en-cceafd6d3dd41c1765b4dbbf3ce047e1.png width=1080 height=290 class=img_ev3q></p>
<h1>8 Generate Distributed Plan Phase</h1>
<p>After the single-machine PlanNode tree is generated, it needs to be split into a distributed PlanFragment tree (PlanFragment is used to represent an independent execution unit) according to the distributed environment. A table's data is distributed across multiple hosts could allow some computations to be parallelized.</p>
<p>The primary purpose of this step is to maximize parallelism and data localization. The primary strategy is to split the nodes that can be executed in parallel and create a separate PlanFragment. ExchangeNodes will replace the split nodes to receive data. Finally, a DataSinkNode will be added to the split node to transmit the calculated data to the ExchangeNode for further processing.</p>
<p>This step adopts a recursive method, traverses the entire PlanNode tree from bottom to top, and then creates a PlanFragment for each leaf node on the tree. If the parent node is encountered, splitting the child nodes that can be executed in parallel will be considered.</p>
<p>For query operations, the join operation is the most common.</p>
<p><strong>Doris currently supports four join algorithms:</strong> broadcast join, hash partition join, colocate join, and bucket shuffle join.</p>
<p><strong>broadcast join</strong>：Send the small table to each machine where the large table is located and perform a hash join operation. When the amount of data scanned from a table is small, the cost of broadcast join will be calculated, and the method with the smallest cost will be selected by calculating and comparing the cost of hash partitions.</p>
<p><strong>hash partition join</strong>：When the data scanned from the two tables are both large, hash partition join is generally used. It traverses all the data in the table, calculates the hash value of the key, then modulizes the number of clusters, and whichever machine is selected, the data will be sent to this machine for hash join operation.</p>
<p><strong>colocate join</strong>：If the data distribution of the two tables is specified to be consistent when they are created, the colocate join algorithm will be used when the join key of the two tables is the same as the bucket key. Since the data distribution of the two tables is the same, the hash join operation is equivalent to a local process. It does not involve data transmission, which significantly improves query performance.</p>
<p><strong>bucket shuffle join</strong>：When the join key is a bucketing key, and only one partition is involved, the bucket shuffle join algorithm is preferred. Since bucketing itself represents a way of dividing data, it only needs to take the hash modulo of the number of buckets from the right table to the left table, so that only one copy of the data in the right table needs to be transmitted over the network, which greatly reduces the network of data transmission, as shown in Figure 10.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_10_en-e99cc952e6ef7e1500565bffbd73da18.png width=878 height=938 class=img_ev3q></p>
<p>Figure 11 shows the core process of creating a distributed logical plan with a single-machine logical plan with HashJoinNode.</p>
<ul>
<li>
<p>For PlanNodes, PlanFragments are created bottom-up.</p>
</li>
<li>
<p>If it is a ScanNode, PlanFragment will be created directly, and the RootPlanNode of the PlanFragment is this ScanNode.</p>
</li>
<li>
<p>If it is a HashJoinNode, the broadcastCost will be calculated at first, which could provide a reference for selecting boracast join or hash partition join.</p>
</li>
<li>
<p>Join algorithm will be chosen according to different conditions.</p>
</li>
<li>
<p>If colocate joins are used, since joins are all local, no splitting is required. Set the left child node of HashJoinNode as the RootPlanNode of leftFragment, and the right child node as the RootPlanNode of rightFragment, share a PlanFragment with leftFragment, and delete rightFragment.</p>
</li>
<li>
<p>If bucket shuffle join is used, data from the right table needs to be sent to the left table. So first create an ExchangeNode, set the left child node of HashJoinNode as the RootPlanNode of leftFragment, the right child node as this ExchangeNode, share a PlanFragment with leftFragment, and specify the destination of rightFragment data to be sent to this ExchangeNode.</p>
</li>
<li>
<p>If broadcast join is used, the data from the right table needs to be sent to the left table. So first create an ExchangeNode, set the left child node of HashJoinNode as the RootPlanNode of leftFragment, the right child node as this ExchangeNode, share a PlanFragment with leftFragment, and specify the destination of rightFragment data to be sent to this ExchangeNode.</p>
</li>
<li>
<p>If hash partition join is used, the data in the left table and the right table must be split, and both left and right nodes need to be split out to create left ExchangeNode and right ExchangeNode respectively. HashJoinNode specifies the left and right nodes as left ExchangeNode and right ExchangeNode. Create a PlanFragment separately and specify RootPlanNode as this HashJoinNode. Finally, specify the data sending destination of leftFragment and rightFragment as left ExchangeNode and right ExchangeNode.</p>
</li>
</ul>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_11_en-df9efe7a2e23bc2caa676a52414ed916.png width=1080 height=975 class=img_ev3q></p>
<p>Figure 12 is an example after the join operation of two tables is converted into a PlanFragment tree, there are 3 PlanFragments generated. The final output data passes through the ResultSinkNode node.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_12_en-fc24ac9080f5429b9e7a871a34192f97.png width=1080 height=1079 class=img_ev3q></p>
<h1>9. Schedule phase</h1>
<p>This step is to create a distributed physical plan based on the distributed logical plan. will solve the following questions:</p>
<ul>
<li>
<p>Which BE executes which PlanFragment</p>
</li>
<li>
<p>Which replica to chooes for each Tablet to query</p>
</li>
<li>
<p>How to perform multi-instance concurrency</p>
</li>
</ul>
<p><strong>Figure 13 shows the core process for creating a distributed physical plan:</strong></p>
<p><strong>a. Prepare phase</strong>：Create a FragmentExecParams structure for each PlanFragment to represent all the parameters required for PlanFragment execution; if a PlanFragment contains DataSinkNode, the destination PlanFragment for data transmission will be found, and specify the input of FragmentExecParams of the destination PlanFragment as FragmentExecParams of this PlanFragment.</p>
<p><strong>b. computeScanRangeAssignment phase</strong>：Different processing is performed for different types of joins.</p>
<ul>
<li>
<p>computeScanRangeAssignmentByColocate: For colocate join processing, since the data distribution in the two table buckets of the join is the same, they are based on the bucket join operation, so here is to determine which host is selected for each bucket. When allocating buckets to hosts, try to ensure that the buckets allocated to each host are even.</p>
</li>
<li>
<p>computeScanRangeAssignmentByBucket: Processing for bucket shuffle join, which is only based on bucket operations, so here is to determine which host is selected for each bucket. When allocating buckets to hosts, it is also necessary to try to ensure that the buckets allocated to each host are even.</p>
</li>
<li>
<p>computeScanRangeAssignmentByScheduler: Process for other types of joins. Determines which replica of the tablet each scanNode reads. A scanNode will read multiple tablets, and each tablet has various copies. To distribute the scan operation on various machines as much as possible, improve concurrent performance, and reduce IO pressure, Doris uses the Round-Robin algorithm to distribute tablet scans to multiple machines as much as possible. For example, 100 tablets need to be scanned, each tablet has three copies, and ten machines could be used. When allocating, each machine is guaranteed to scan ten tablets.</p>
</li>
</ul>
<p><strong>c.computeFragmentExecParams phase</strong>：This stage determines which BE the PlanFragment is issued to for execution and how to handle instance concurrency. After the scan address of each tablet is determined, FragmentExecParams will generate multiple instances with the address as the dimension. If various addresses are contained in FragmentExecParams, various instances of FInstanceExecParam will be generated. If the concurrency is set, the execution instance of an address will be further split into multiple FInstanceExecParams. There will be some special processing for bucket shuffle join and colocate join, but the basic logic is the same. After FInstanceExecParam is created, a unique ID will be assigned to facilitate tracking information. If FragmentExecParams contains ExchangeNode, the number of senders will be counted to know how many senders' data needs to be accepted. Finally, FragmentExecParams determines the destinations and fills in the destination address.</p>
<p><strong>d. Create result receiver stage</strong>：The resulting receiver is where the final data needs to be output after the query is completed.</p>
<p><strong>e. to thrift stage</strong>：Create RPC requests based on FInstanceExecParam of all PlanFragments, then send them to the BE side for execution. A complete SQL parsing process is completed.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_13_en-11d11e8bdcacdc813f16f698e3c7cb6d.png width=1080 height=846 class=img_ev3q></p>
<p>Figure 14 is a simple example. The PlanFrament in the figure contains a ScanNode. The ScanNode scans three tablets. Each tablet has two copies, and the cluster assumes that there are two hosts.</p>
<p>The computeScanRangeAssignment stage determines that replicas 1, 3, 5, 8, 10, and 12 need to be scanned, where replicas 1, 3, and 5 are located on host1, and replicas 8, 10, and 12 are located on host2.</p>
<p>If the global concurrency is set to 1, 2 instances of FInstanceExecParam are created and sent to host1 and host2 for execution. If the global concurrency is set to 3, 3 instances of FInstanceExecParam are created on this host1, and three instances of FInstanceExecParam are created on host2. Each instance scans one replica, equivalent to initiating 6 RPC requests.</p>
<p><img decoding=async loading=lazy src=/zh-CN/assets/images/Figure_14_en-584e7935ee2ef6eb13e0cd4dada6ac8d.png width=1080 height=545 class=img_ev3q></p>
<h1>10 Summary</h1>
<p>This article first briefly introduces Doris and then introduces the general process of SQL parsing: lexical analysis, syntax analysis, generating logical plans, and generating physical plans. Then, it presents the overall architecture of DorisSQL parsing. In the end, the five processes:  Parse, Analyze, SinglePlan, DistributedPlan, and Schedule are explained in detail, and an in-depth explanation is given of the algorithm principle and code implementation.</p>
<p>Doris complies with the standard methods of SQL parsing. Still, according to the underlying storage architecture and distributed characteristics, many optimizations have been made in SQL parsing to achieve maximum parallelism and minimize network transmission, reducing a lot of burden on the SQL execution level.</div></div></article><article class=margin-bottom--xl itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><div class=markdown itemprop=articleBody><header><div class="text-center mb-4"><a class="!text-[#8592A6] cursor-pointer hover:no-underline" href=/zh-CN/blog/>Blog</a><span class="px-2 text-[#8592A6]">/</span><span><span class=s-tags><span class=s-tag>Tech Sharing</span></span></span></div><h2 class="blog-post-title text-[2rem] leading-normal lg:!text-[2.5rem] text-center" itemprop=headline><a itemprop=url href=/zh-CN/blog/Flink-realtime-write/>How Flink's real-time writes to Apache Doris ensure both high throughput and low latency</a></h2><div class="blog-info text-center flex justify-center text-sm text-black"><span class=authors><span class="s-author text-black">Apache Doris</span></span><time datetime=2022-07-29T00:00:00.000Z itemprop=datePublished class="text-black ml-4">2022年7月29日</time></div></header><div class=markdown itemprop=articleBody><p>With the increasing demand for real-time analysis, the timeliness of data is becoming more and more important to the refined operation of enterprises. With the massive data, real-time data warehouse plays an irreplaceable role in effectively digging out valuable information, quickly obtaining data feedback, helping companies make faster decisions and better product iterations.</p>
<p>In this situation, Apache Doris stands out as a real-time MPP analytic database, which is high performance and easy to use, and supports various data import methods. Combined with Apache Flink, users can quickly import unstructured data from Kafka and CDC(Change Data Capture) from upstream database like MySQL. Apache Doris also provides sub-second analytic query capabilities, which can effectively satisfy the needs of several real-time scenarios: multi-dimensional analysis, dashboard and data serving etc.</p>
<p>Usually, there are many challenges to ensure high end-to-end concurrency and low latency for real-time data warehouses , such as:</p>
<ul>
<li>
<p>How to ensure end-to-end data sync in second-level ?</p>
</li>
<li>
<p>How to quickly ensure data visibility ?</p>
</li>
<li>
<p>How to solve the problem of small files writing under high concurrency situation?</p>
</li>
<li>
<p>How to ensure end-to-end Exactly-Once?</p>
</li>
</ul>
<p>Within the challenges above , we conducted an in-depth research on the business scenarios of users using Flink and Doris to build real-time data warehouses . After grasping the pain points of users, we made targeted optimizations in Doris version 1.1 and greatly improved the user experience  and improved the stability. The resource consumption of Doris has also been greatly optimized.</p>
<h1>Optimization</h1>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=streaming-write>Streaming Write<a href=#streaming-write class=hash-link aria-label="Streaming Write的直接链接" title="Streaming Write的直接链接">​</a></h3>
<p>The initial practice of Flink Doris Connector is to cache the data into the memory batch after receiving data.The method of data writing is saving batches, and using parameters such as <code>batch.size</code> and <code>batch.interval</code> to control the timing of Stream Load writing at the same time.</p>
<p>It usually runs stably when the parameters are reasonable. Whatever the parameters are unreasonable, it would cause frequent Stream Load and compaction untimely, resulting in excessive version errors ( -235 ). On the other hand, when there is too much data, in order to reduce the writing frequency of Stream Load , the setting of <code>batch.size</code> too large may also cause OOM.</p>
<p><strong>To solve this problem, we introduce streaming write:</strong></p>
<p><img decoding=async loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/otliigutb8p9l1y6qyp6.png alt="Image description" class=img_ev3q></p>
<ul>
<li>
<p>After the Flink task starts, the Stream Load Http request will be asynchronously initiated.</p>
</li>
<li>
<p>When the data is received, it will be continuously transmitted to Doris through the Chunked transfer encoding of Http.</p>
</li>
<li>
<p>Http request will end at Checkpoint and complete the Stream Load writing . The next Stream Load request will be asynchronously initiated at the same time.</p>
</li>
<li>
<p>The data will continue to be received and the follow-up process is the same as above.</p>
</li>
</ul>
<p>The pressure on the memory of the batch is avoided since the Chunked mechanism is used to transmit data. And the timing of writing is bound to the Checkpoint, which makes the timing of Stream Load controllable, and provides a basis for the following Exactly-Once semantics.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=exactly-once>Exactly-Once<a href=#exactly-once class=hash-link aria-label=Exactly-Once的直接链接 title=Exactly-Once的直接链接>​</a></h3>
<p>Exactly-Once means that data will not be reprocessed or lost, even machine or application failure. Flink supports the End-to-End's Exactly-Once scenario a long time ago, mainly through the two-phase commit protocol to realize the Exactly-Once semantics of the Sink operator.</p>
<p>On the basis of Flink's two-stage submission, with the help of Doris 1.0's Stream Load two-stage submission,Flink Doris Connector implements Exactly Once semantics. The specific principles are as follows:</p>
<ul>
<li>When the Flink task is started, it will initiate a Stream Load PreCommit request. At this time, a transaction will be opened first, and data will be continuously sent to Doris through the Chunked mechanism of Http.</li>
</ul>
<p><img decoding=async loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ole5tqi91jibzdg9vqep.png alt="Image description" class=img_ev3q></p>
<ul>
<li>Http request will be completed when the data writing ends at Checkpoint , and set the transaction status to preCommitted. The data has been written to BE and is invisible to the user at this time.</li>
</ul>
<p><img decoding=async loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/jiieu1eff6smunkr85s5.png alt="Image description" class=img_ev3q></p>
<ul>
<li>A Commit request will be initiated after the Checkpoint, and the transaction status will be set to Committed. The data will become visible to the user after request.</li>
</ul>
<p><img decoding=async loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/eaona8eslljmkpaa9324.png alt="Image description" class=img_ev3q></p>
<ul>
<li>After the Flink application ends unexpectedly and restarts from Checkpoint, if the last transaction was in the preCommitted state, a rollback request will be initiated and the transaction state will be set to Aborted.</li>
</ul>
<p>Based on the above , Flink Doris Connector can be used to realize real-time data storage without loss or weight.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=second--level-data-synchronization>Second- Level Data Synchronization<a href=#second--level-data-synchronization class=hash-link aria-label="Second- Level Data Synchronization的直接链接" title="Second- Level Data Synchronization的直接链接">​</a></h3>
<p>End-to-end second-level data sync and real-time visibility of data in high concurrent write scenarios require Doris to have the following capabilities:</p>
<ul>
<li><strong>Transaction Processing Capability</strong></li>
</ul>
<p>Flink real-time writing interacts with Doris in the form of Stream Load 2pc, which requires Doris to have the corresponding transaction processing capabilities to ensure the basic ACID characteristics, and support Flink's second-level data sync in high concurrency scenarios.</p>
<ul>
<li><strong>Rapid Aggregation Capability of Data Versions</strong></li>
</ul>
<p>One import in Doris will generate one data version. In a high concurrent write scenario, an inevitable impact is that there are too many data versions, and the amount of data imported in a single time will not be too large. The continuous high-concurrency small file writing scenario extremely tests the real-time ability and Doris' data merging performance, which is not friendly to Doris, and in turn affects the performance of the query. Doris has greatly enhanced the data compaction capability in version 1.1, which can quickly complete the aggregation of new data, avoiding -235 errors and query efficiency problems which are caused by too many versions of sharded data.</p>
<p>First of all, in Doris 1.1 version, QuickCompaction was introduced, which can actively triggered Compaction when the data version increased. At the same time, by improving the ability to scan fragment meta information, fragments that need to be compacted can be quickly discovered and trigger Compaction. Through active triggering and passive scanning, the real-time problem of data merging is completely solved.</p>
<p>For high-frequency small file Cumulative Compaction, the scheduling and isolation of Compaction tasks is implemented to prevent the heavyweight Base Compaction from affecting the merging of new data.</p>
<p>Finally, the strategy of merging small files is optimized by adopting gradient merge method. Each time the files participating in the merging belong to the same data magnitude,which can prevent versions with large differences in size from merging, and gradually merges hierarchically, reducing the number of times a single file is involved in merging, which can greatly save the CPU consumption of the system.</p>
<p><img decoding=async loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ez5qdcpgwjw60g9aacqd.png alt="Image description" class=img_ev3q></p>
<p>Doris version 1.1 has made targeted optimizations for scenarios such as high concurrent import, second-level data sync, and real-time data visibility, which greatly increases the ease of use and stability of the Flink system and Doris system, saves the overall resources of the cluster.</p>
<h1>Effect</h1>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=general-flink-high-concurrency-scenarios>General Flink High Concurrency Scenarios<a href=#general-flink-high-concurrency-scenarios class=hash-link aria-label="General Flink High Concurrency Scenarios的直接链接" title="General Flink High Concurrency Scenarios的直接链接">​</a></h3>
<p>In the general scenario of the survey, Flink is used to synchronize unstructured data in upstream Kafka. The data is written to Doris in real time by the Flink Doris Connector after ETL.</p>
<p>The customer scenario is extremely strict here. The upstream maintains a high frequency of 10w per second, and the data needs to be able to complete the upstream and downstream sync within 5s to achieve second-level data visibility. Flink is configured with 20 concurrency, and the Checkpoint interval is 5s. The performance of Doris version 1.1 is quite excellent.</p>
<p>Specifically reflected in the following aspects:</p>
<ul>
<li><strong>Compaction Real-Time</strong></li>
</ul>
<p>Data can be merged quickly, the number of tablet data versions is kept below 50, and the compaction score is stable. Compared with the previous -235 problem in high concurrent import scenario, the compaction efficiency is improved more than 10 times.</p>
<p><img decoding=async loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d6enyv1zj68o7myjypnl.png alt="Image description" class=img_ev3q></p>
<ul>
<li><strong>CPU Resource Consumption</strong></li>
</ul>
<p>Doris version 1.1 has optimized the strategy for compaction of small files. In high-concurrency import scenarios, CPU resource consumption is reduced by 25%.</p>
<ul>
<li><strong>QPS Query Delay is Stable</strong></li>
</ul>
<p>By reducing the CPU usage and the number of data versions, the overall order of data has been improved, and the delay of SQL queries will be reduced.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=second-level-data-synchronization-scenario-extreme-high-pressure>Second-Level Data Synchronization Scenario (Extreme High Pressure)<a href=#second-level-data-synchronization-scenario-extreme-high-pressure class=hash-link aria-label="Second-Level Data Synchronization Scenario (Extreme High Pressure)的直接链接" title="Second-Level Data Synchronization Scenario (Extreme High Pressure)的直接链接">​</a></h3>
<p>In single bet and single tablet with 30 concurrent limit stream load pressure test on the client side, data in real-time &lt;1s, the comparison before and after compaction score optimization as below:</p>
<p><img decoding=async loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/r01hn8hv6arzbdclknis.png alt="Image description" class=img_ev3q></p>
<h1>Recommendations</h1>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=real-time-data-visualization-scenario>Real-Time Data Visualization Scenario<a href=#real-time-data-visualization-scenario class=hash-link aria-label="Real-Time Data Visualization Scenario的直接链接" title="Real-Time Data Visualization Scenario的直接链接">​</a></h3>
<p>For strict latency requirements scenarios, such as second-level data synchronization, usually mean that a single import file is small, and it is recommended to reduce <code>cumulative_size_based_promotion_min_size_mbytes </code>. The default unit is 64 MB, and you can set it to 8 MB manually, which can greatly improve the compaction real-time performance.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=high-concurrency-scenario>High Concurrency Scenario<a href=#high-concurrency-scenario class=hash-link aria-label="High Concurrency Scenario的直接链接" title="High Concurrency Scenario的直接链接">​</a></h3>
<p>For high concurrent writing scenarios, you can reduce the frequency of Stream Load by increasing the checkpoint interval. For example, setting checkpoint to 5-10s can not only increase the throughput of Flink tasks, but also reduce the generation of small files and avoid causing compaction more pressure.</p>
<p>In addition, for scenarios that do not require high real-time data, such as minute-level data sync, the checkpoint interval can be increased, such as 5-10 minutes. And the Flink Doris connector can still ensure the integrity of data through the two-stage submission and checkpoint mechanism.</p>
<h1>Future planning</h1>
<ul>
<li><strong>Real-time Schema Change</strong></li>
</ul>
<p>When accessing data in real time through Flink CDC, the upstream business table will perform the schema change operation, it has to modify the schema manually in Doris and Flink tasks. In the end, the data of the new schema can be synchronized after restart the task .</p>
<p>This way requires human intervention, which will bring a great operation burden to users. In subsequent versions, real-time schema changes will support CDC scenarios, and the upstream schema changes will be synchronized to the downstream in real-time, which will comprehensively improve the efficiency of schema changes.</p>
<ul>
<li><strong>Doris Multi-table Writing</strong></li>
</ul>
<p>At present, the Doris Sink operator only supports synchronizing a single table, so for the entire database, it still has to divide the flow manually at the Flink level and write to multiple Doris Sinks, which will increase the difficulty of developers. In subsequent versions, we will support a single Doris Sink to synchronize multiple tables, which greatly simplifies the user's operation.</p>
<ul>
<li><strong>Adaptive Compaction Parameter Tuning</strong></li>
</ul>
<p>At present, the compaction strategy has many parameters, which can play a good role in most general scenarios, but these strategies still can't play an efficient role in some special scenarios. We will continue to optimize in subsequent versions, carry out adaptive compaction tuning for different scenarios, and keep improving data merging efficiency and real-time performance in various scenarios.</p>
<ul>
<li><strong>Single-Copy Compaction</strong></li>
</ul>
<p>The current compaction strategy is that each BE is carried out separately. In subsequent versions, we will implement single-copy compaction, and realize compaction tasks by cloning snapshots, reduce system load while reducing about 2/3 compaction tasks of the cluster, leaving more system resources to the user side.</div></div></article><nav class=pagination-nav aria-label=博文列表分页导航></nav></main></div></div></div><div class="footer pt-16 pb-10"><div class=container><div class=footer-box><div class=left><img src=/zh-CN/images/asf_logo_apache.svg alt="" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src=/zh-CN/images/asf_logo_apache.svg alt="" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>ASF</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.apache.org/ target=_blank rel="noopener noreferrer" class=footer__link-item>Foundation<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.apache.org/licenses/ target=_blank rel="noopener noreferrer" class=footer__link-item>License<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.apache.org/events/current-event target=_blank rel="noopener noreferrer" class=footer__link-item>Events<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.apache.org/foundation/sponsorship.html target=_blank rel="noopener noreferrer" class=footer__link-item>Sponsorship<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://privacy.apache.org/policies/privacy-policy-public.html target=_blank rel="noopener noreferrer" class=footer__link-item>Privacy<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.apache.org/security/ target=_blank rel="noopener noreferrer" class=footer__link-item>Security<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.apache.org/foundation/thanks.html target=_blank rel="noopener noreferrer" class=footer__link-item>Thanks<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Resources</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/zh-CN/download/>Download</a><li class=footer__item><a class=footer__link-item href=/zh-CN/blog/>Blog</a><li class=footer__item><a class=footer__link-item href=/zh-CN/ecosystem/cluster-management/>Ecosystem</a><li class=footer__item><a class=footer__link-item href=/zh-CN/users/>Users</a><li class=footer__item><a href=https://github.com/apache/doris/discussions target=_blank rel="noopener noreferrer" class=footer__link-item>Discussions<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/zh-CN/community/how-to-contribute/contribute-to-doris/>How to contribute</a><li class=footer__item><a href=https://github.com/apache/doris/ target=_blank rel="noopener noreferrer" class=footer__link-item>Source code<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a class=footer__link-item href=/zh-CN/community/team/>Doris team</a><li class=footer__item><a href=https://github.com/apache/doris/issues/30669 target=_blank rel="noopener noreferrer" class=footer__link-item>Roadmap<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://cwiki.apache.org/confluence/display/DORIS/Doris+Improvement+Proposals target=_blank rel="noopener noreferrer" class=footer__link-item>Improvement proposal<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div></div></div><div class=right><div class=footer__title>Join the community</div><div class=social-list><div class=social><a href=mailto:dev@doris.apache.org target=_blank title=mail class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><path d="M5.6003 6H26.3997C27.8186 6 28.982 7.10964 29 8.46946L16.0045 15.454L3.01202 8.47829C3.02405 7.11258 4.1784 6 5.6003 6ZM3.01202 11.1508L3 23.5011C3 24.8756 4.16938 26 5.6003 26H26.3997C27.8306 26 29 24.8756 29 23.5011V11.145L16.3111 17.8028C16.1157 17.9058 15.8813 17.9058 15.6889 17.8028L3.01202 11.1508Z" fill=currentColor /></svg></a><a href=https://github.com/apache/doris target=_blank title=github class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><path d="M16.0001 2.66675C8.63342 2.66675 2.66675 8.63341 2.66675 16.0001C2.66524 18.7991 3.54517 21.5276 5.1817 23.7983C6.81824 26.0691 9.12828 27.7668 11.7841 28.6508C12.4508 28.7668 12.7001 28.3668 12.7001 28.0161C12.7001 27.7001 12.6828 26.6508 12.6828 25.5334C9.33342 26.1508 8.46675 24.7174 8.20008 23.9668C8.04942 23.5828 7.40008 22.4001 6.83342 22.0828C6.36675 21.8334 5.70008 21.2161 6.81608 21.2001C7.86675 21.1828 8.61608 22.1668 8.86675 22.5668C10.0668 24.5828 11.9841 24.0161 12.7494 23.6668C12.8668 22.8001 13.2161 22.2174 13.6001 21.8841C10.6334 21.5508 7.53342 20.4001 7.53342 15.3001C7.53342 13.8494 8.04942 12.6507 8.90008 11.7161C8.76675 11.3827 8.30008 10.0161 9.03342 8.18275C9.03342 8.18275 10.1494 7.83342 12.7001 9.55075C13.7855 9.2495 14.907 9.09787 16.0334 9.10008C17.1668 9.10008 18.3001 9.24942 19.3668 9.54942C21.9161 7.81608 23.0334 8.18408 23.0334 8.18408C23.7668 10.0174 23.3001 11.3841 23.1668 11.7174C24.0161 12.6507 24.5334 13.8334 24.5334 15.3001C24.5334 20.4174 21.4174 21.5508 18.4508 21.8841C18.9334 22.3001 19.3508 23.1001 19.3508 24.3508C19.3508 26.1334 19.3334 27.5668 19.3334 28.0174C19.3334 28.3668 19.5841 28.7828 20.2508 28.6494C22.8975 27.7558 25.1973 26.0547 26.8266 23.7856C28.4559 21.5165 29.3327 18.7936 29.3334 16.0001C29.3334 8.63341 23.3668 2.66675 16.0001 2.66675V2.66675Z" fill=currentColor /></svg></a><a href=https://twitter.com/doris_apache target=_blank title=twitter class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><path d="M4.625 4.625H11.2809L27.375 27.375H20.7191L4.625 4.625ZM7.52549 6.10639L21.5236 25.8936H24.4746L10.4764 6.10639H7.52549Z" fill=currentColor /><path d="M14.4268 18.4803L6.53447 27.375H4.625L13.5581 17.2525L14.4268 18.4803ZM18.1299 14.3066L26.7203 4.625H24.7017L17.2525 13.0662L18.1299 14.3066Z" fill=currentColor /></svg></a><a href=https://doris.apache.org/slack title=slack target=_blank class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><g clip-path=url(#clip0_125_278)><path d="M12.5875 16.6906C11.0844 16.6906 9.86562 17.9094 9.86562 19.4125V26.2375C9.86562 26.9594 10.1524 27.6517 10.6628 28.1622C11.1733 28.6726 11.8656 28.9594 12.5875 28.9594C13.3094 28.9594 14.0017 28.6726 14.5122 28.1622C15.0226 27.6517 15.3094 26.9594 15.3094 26.2375V19.4531C15.3094 17.9094 14.0906 16.6906 12.5875 16.6906ZM3 19.4531C3 20.175 3.28677 20.8673 3.79722 21.3778C4.30767 21.8882 4.99999 22.175 5.72187 22.175C6.44376 22.175 7.13608 21.8882 7.64653 21.3778C8.15698 20.8673 8.44375 20.175 8.44375 19.4531V16.7312H5.7625C4.25938 16.6906 3 17.9094 3 19.4531ZM12.5875 3C11.8656 3 11.1733 3.28677 10.6628 3.79722C10.1524 4.30767 9.86562 4.99999 9.86562 5.72187C9.86562 6.44376 10.1524 7.13608 10.6628 7.64653C11.1733 8.15698 11.8656 8.44375 12.5875 8.44375H15.3094V5.72187C15.3094 4.21875 14.0906 3 12.5875 3ZM5.72187 15.3094H12.5469C13.2688 15.3094 13.9611 15.0226 14.4715 14.5122C14.982 14.0017 15.2688 13.3094 15.2688 12.5875C15.2688 11.8656 14.982 11.1733 14.4715 10.6628C13.9611 10.1524 13.2688 9.86562 12.5469 9.86562H5.72187C4.99999 9.86562 4.30767 10.1524 3.79722 10.6628C3.28677 11.1733 3 11.8656 3 12.5875C3 13.3094 3.28677 14.0017 3.79722 14.5122C4.30767 15.0226 4.99999 15.3094 5.72187 15.3094ZM26.2375 9.86562C24.7344 9.86562 23.5156 11.0844 23.5156 12.5875V15.3094H26.2375C26.9594 15.3094 27.6517 15.0226 28.1622 14.5122C28.6726 14.0017 28.9594 13.3094 28.9594 12.5875C28.9594 11.8656 28.6726 11.1733 28.1622 10.6628C27.6517 10.1524 26.9594 9.86562 26.2375 9.86562ZM16.6906 5.72187V12.5875C16.6906 13.3094 16.9774 14.0017 17.4878 14.5122C17.9983 15.0226 18.6906 15.3094 19.4125 15.3094C20.1344 15.3094 20.8267 15.0226 21.3372 14.5122C21.8476 14.0017 22.1344 13.3094 22.1344 12.5875V5.72187C22.1344 4.99999 21.8476 4.30767 21.3372 3.79722C20.8267 3.28677 20.1344 3 19.4125 3C18.6906 3 17.9983 3.28677 17.4878 3.79722C16.9774 4.30767 16.6906 4.99999 16.6906 5.72187ZM22.1344 26.2781C22.1344 24.775 20.9156 23.5562 19.4125 23.5562H16.6906V26.2781C16.6906 27 16.9774 27.6923 17.4878 28.2028C17.9983 28.7132 18.6906 29 19.4125 29C20.1344 29 20.8267 28.7132 21.3372 28.2028C21.8476 27.6923 22.1344 27 22.1344 26.2781ZM26.2781 16.6906H19.4125C18.6906 16.6906 17.9983 16.9774 17.4878 17.4878C16.9774 17.9983 16.6906 18.6906 16.6906 19.4125C16.6906 20.1344 16.9774 20.8267 17.4878 21.3372C17.9983 21.8476 18.6906 22.1344 19.4125 22.1344H26.2375C27.7406 22.1344 28.9594 20.9156 28.9594 19.4125C29 17.9094 27.7812 16.6906 26.2781 16.6906Z" fill=currentColor /></g><defs><clipPath id=clip0_125_278><rect width=26 height=26 fill=currentColor transform="translate(3 3)"/></clipPath></defs></svg></a></div><div class=social><a href=https://www.youtube.com/hashtag/apachedoris title=youtube target=_blank class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><path d="M28.5167 7.83429C28.9436 8.25423 29.2532 8.77539 29.4154 9.34742C29.8205 11.5462 30.0159 13.7775 29.999 16.0121C30.0144 18.2382 29.819 20.4609 29.4154 22.6515C29.2532 23.2235 28.9436 23.7446 28.5167 24.1645C28.0898 24.5845 27.5601 24.889 26.9785 25.0486C24.7728 25.625 16.0124 25.625 16.0124 25.625C16.0124 25.625 7.22652 25.625 5.04638 25.0486C4.46489 24.889 3.9351 24.5845 3.5082 24.1645C3.08132 23.7446 2.77176 23.2235 2.60948 22.6515C2.19736 20.4617 1.9934 18.239 2.00025 16.0121C1.9918 13.7767 2.19577 11.5455 2.60948 9.34742C2.77176 8.77539 3.08132 8.25423 3.5082 7.83429C3.9351 7.41436 4.46489 7.10985 5.04638 6.95021C7.25103 6.36354 16.0124 6.37502 16.0124 6.37502C16.0124 6.37502 24.796 6.37502 26.9785 6.95021C27.5601 7.10985 28.0898 7.41436 28.5167 7.83429ZM12.5 21.25L21.25 16.008L12.5 10.75V21.25Z" fill=currentColor /></svg></a><a href=https://www.linkedin.com/company/doris-apache/ title=linkedin target=_blank class=item><svg width=2rem height=2rem viewBox="0 0 32 32" fill=none><path d="M4.29925 26.9996H9.66738V11.6781H4.29925V26.9996ZM22.1628 11.1949C19.9409 11.1949 18.7157 11.9388 17.3054 13.7407V11.6777H11.9459V26.9996H17.305V18.6738C17.305 16.9168 18.145 15.1982 20.1535 15.1982C22.162 15.1982 22.6559 16.9164 22.6559 18.632V27H28V18.2902C28 12.2386 24.3854 11.1949 22.1628 11.1949ZM6.99325 4C5.3395 4 4 5.21047 4 6.7046C4 8.19759 5.3395 9.40617 6.99325 9.40617C8.6455 9.40617 9.985 8.19722 9.985 6.7046C9.985 5.21047 8.6455 4 6.99325 4Z" fill=white /></svg></a><a href=https://medium.com/@ApacheDoris title=medium target=_blank class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><g id=Frame><path id=Vector d="M17.7967 16.5385C17.8029 18.53 16.9746 20.4425 15.4937 21.8559C14.0128 23.2693 12.0004 24.0681 9.89836 24.0769C7.79633 24.0681 5.78391 23.2693 4.30302 21.8559C2.82212 20.4425 1.99383 18.53 2.00003 16.5385C1.99383 14.5469 2.82212 12.6344 4.30302 11.221C5.78391 9.80759 7.79633 9.00878 9.89836 9C12.0004 9.00878 14.0128 9.80759 15.4937 11.221C16.9746 12.6344 17.8029 14.5469 17.7967 16.5385ZM26.4533 16.5385C26.4533 20.4514 24.6917 23.6348 22.51 23.6348C20.3283 23.6348 18.555 20.4514 18.555 16.5385C18.555 12.6255 20.3283 9.44214 22.51 9.44214C24.6917 9.44214 26.4533 12.6255 26.4533 16.5385ZM30 16.5385C30 20.0424 29.3817 22.8942 28.6117 22.8942C27.8417 22.8942 27.2233 20.0424 27.2233 16.5385C27.2233 13.0345 27.8417 10.1827 28.6117 10.1827C29.3817 10.1827 30 13.0345 30 16.5385Z" fill=currentColor /></g></svg></a></div></div></div></div><div class=footer__copyright>Copyright © 2026 The Apache Software Foundation,Licensed under the <a href=https://www.apache.org/licenses/LICENSE-2.0 target=_blank>Apache License, Version 2.0</a>. Apache, Doris, Apache Doris, the Apache feather logo and the Apache Doris logo are trademarks of The Apache Software Foundation.</div></div></div></div>