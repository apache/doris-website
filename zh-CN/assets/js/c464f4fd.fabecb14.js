"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["858117"],{305893:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>l,metadata:()=>r,assets:()=>c,toc:()=>d,contentTitle:()=>o});var r=JSON.parse('{"id":"developer-guide/regression-testing","title":"\u56DE\u5F52\u6D4B\u8BD5","description":"\x3c!--","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs-community/current/developer-guide/regression-testing.md","sourceDirName":"developer-guide","slug":"/developer-guide/regression-testing","permalink":"/zh-CN/community/developer-guide/regression-testing","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"\u56DE\u5F52\u6D4B\u8BD5","language":"zh-CN"},"sidebar":"community","previous":{"title":"Github \u51C6\u5165\u68C0\u67E5","permalink":"/zh-CN/community/developer-guide/github-checks"},"next":{"title":"Doris \u56E2\u961F","permalink":"/zh-CN/community/team"}}'),i=s("785893"),t=s("250065");let l={title:"\u56DE\u5F52\u6D4B\u8BD5",language:"zh-CN"},o="\u56DE\u5F52\u6D4B\u8BD5",c={},d=[{value:"\u6982\u5FF5",id:"\u6982\u5FF5",level:2},{value:"\u6D4B\u8BD5\u6B65\u9AA4",id:"\u6D4B\u8BD5\u6B65\u9AA4",level:2},{value:"\u76EE\u5F55\u7ED3\u6784",id:"\u76EE\u5F55\u7ED3\u6784",level:2},{value:"\u6846\u67B6\u9ED8\u8BA4\u914D\u7F6E",id:"\u6846\u67B6\u9ED8\u8BA4\u914D\u7F6E",level:2},{value:"\u7F16\u5199\u7528\u4F8B\u7684\u6B65\u9AA4",id:"\u7F16\u5199\u7528\u4F8B\u7684\u6B65\u9AA4",level:2},{value:"Action",id:"action",level:2},{value:"sql action",id:"sql-action",level:3},{value:"qt action",id:"qt-action",level:3},{value:"test action",id:"test-action",level:3},{value:"explain action",id:"explain-action",level:3},{value:"streamLoad action",id:"streamload-action",level:3},{value:"\u5176\u4ED6Action",id:"\u5176\u4ED6action",level:3},{value:"\u542F\u52A8\u811A\u672C\u4F8B\u5B50",id:"\u542F\u52A8\u811A\u672C\u4F8B\u5B50",level:2},{value:"\u4F7F\u7528\u67E5\u8BE2\u7ED3\u679C\u81EA\u52A8\u751F\u6210.out\u6587\u4EF6",id:"\u4F7F\u7528\u67E5\u8BE2\u7ED3\u679C\u81EA\u52A8\u751F\u6210out\u6587\u4EF6",level:2},{value:"Suite\u63D2\u4EF6",id:"suite\u63D2\u4EF6",level:2},{value:"CI/CD\u7684\u652F\u6301",id:"cicd\u7684\u652F\u6301",level:2},{value:"TeamCity",id:"teamcity",level:3},{value:"\u5916\u90E8\u6570\u636E\u6E90 e2e \u6D4B\u8BD5",id:"\u5916\u90E8\u6570\u636E\u6E90-e2e-\u6D4B\u8BD5",level:2}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u56DE\u5F52\u6D4B\u8BD5",children:"\u56DE\u5F52\u6D4B\u8BD5"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6982\u5FF5",children:"\u6982\u5FF5"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Suite"}),": \u4E00\u4E2A\u6D4B\u8BD5\u7528\u4F8B\uFF0C\u76EE\u524D\u4EC5\u7528\u6765\u6307\u4EE3\u6D4B\u8BD5\u7528\u4F8B\u6587\u4EF6\u540D"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Group"}),": \u4E00\u4E2A\u6D4B\u8BD5\u96C6\uFF0C\u76EE\u524D\u4EC5\u7528\u4E8E\u6307\u4EE3\u6D4B\u8BD5\u7528\u4F8B\u6240\u5C5E\u7684\u76EE\u5F55"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Action"}),": \u4E00\u4E2A\u5C01\u88C5\u597D\u7684\u5177\u4F53\u6D4B\u8BD5\u884C\u4E3A\uFF0C\u6BD4\u5982\u7528\u4E8E\u6267\u884Csql\u7684",(0,i.jsx)(n.code,{children:"sql"})," Action\uFF0C\u7528\u4E8E\u6821\u9A8C\u7ED3\u679C\u7684",(0,i.jsx)(n.code,{children:"test"})," Action\uFF0C\u7528\u4E8E\u5BFC\u5165\u6570\u636E\u7684",(0,i.jsx)(n.code,{children:"streamLoad"})," Action\u7B49"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6D4B\u8BD5\u6B65\u9AA4",children:"\u6D4B\u8BD5\u6B65\u9AA4"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u9700\u8981\u9884\u5148\u5B89\u88C5\u597D\u96C6\u7FA4"}),"\n",(0,i.jsxs)(n.li,{children:["\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/conf/regression-conf.groovy"}),"\uFF0C\u8BBE\u7F6Ejdbc url\u3001\u7528\u6237\u7B49\u914D\u7F6E\u9879"]}),"\n",(0,i.jsx)(n.li,{children:"\u521B\u5EFA\u6D4B\u8BD5\u7528\u4F8B\u6587\u4EF6\u5E76\u7F16\u5199\u7528\u4F8B"}),"\n",(0,i.jsxs)(n.li,{children:["\u5982\u679C\u7528\u4F8B\u6587\u4EF6\u5305\u542B",(0,i.jsx)(n.code,{children:"qt"})," Action\uFF0C\u5219\u9700\u8981\u521B\u5EFA\u5173\u8054\u7684data\u6587\u4EF6\uFF0C\u6BD4\u5982",(0,i.jsx)(n.code,{children:"suites/demo/qt_action.groovy"}),"\u8FD9\u4E2A\u4F8B\u5B50\uFF0C\u9700\u8981\u7528\u5230",(0,i.jsx)(n.code,{children:"data/demo/qt_action.out"}),"\u8FD9\u4E2ATSV\u6587\u4EF6\u6765\u6821\u9A8C\u8F93\u51FA\u662F\u5426\u4E00\u81F4"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FD0\u884C",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/run-regression-test.sh"}),"\u6D4B\u8BD5\u5168\u90E8\u7528\u4F8B,\u6216\u8FD0\u884C",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/run-regression-test.sh --run <suiteName>"}),' \u6D4B\u8BD5\u82E5\u5E72\u7528\u4F8B\uFF0C\u66F4\u591A\u4F8B\u5B50\u89C1"\u542F\u52A8\u811A\u672C\u4F8B\u5B50"\u7AE0\u8282']}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u76EE\u5F55\u7ED3\u6784",children:"\u76EE\u5F55\u7ED3\u6784"}),"\n",(0,i.jsx)(n.p,{children:"\u5F00\u53D1\u65F6\u9700\u8981\u5173\u6CE8\u7684\u91CD\u8981\u6587\u4EF6/\u76EE\u5F55"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"run-regression-test.sh"}),": \u542F\u52A8\u811A\u672C"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"regression-conf.groovy"}),": \u56DE\u5F52\u6D4B\u8BD5\u7684\u9ED8\u8BA4\u914D\u7F6E"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data"}),": \u5B58\u653E\u8F93\u5165\u6570\u636E\u548C\u8F93\u51FA\u6821\u9A8C\u6570\u636E"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"suites"}),": \u5B58\u653E\u7528\u4F8B"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"./${DORIS_HOME}\n    |-- **run-regression-test.sh**           \u56DE\u5F52\u6D4B\u8BD5\u542F\u52A8\u811A\u672C\n    |-- regression-test\n    |   |-- plugins                          \u63D2\u4EF6\u76EE\u5F55\n    |   |-- conf\n    |   |   |-- logback.xml                  \u65E5\u5FD7\u914D\u7F6E\u6587\u4EF6\n    |   |   |-- **regression-conf.groovy**   \u9ED8\u8BA4\u914D\u7F6E\u6587\u4EF6\n    |   |\n    |   |-- framework                        \u56DE\u5F52\u6D4B\u8BD5\u6846\u67B6\u6E90\u7801\n    |   |-- **data**                         \u7528\u4F8B\u7684\u8F93\u5165\u8F93\u51FA\u6587\u4EF6\n    |   |   |-- demo                         \u5B58\u653Edemo\u7684\u8F93\u5165\u8F93\u51FA\u6587\u4EF6\n    |   |   |-- correctness                  \u5B58\u653E\u6B63\u786E\u6027\u6D4B\u8BD5\u7528\u4F8B\u7684\u8F93\u5165\u8F93\u51FA\u6587\u4EF6\n    |   |   |-- performance                  \u5B58\u653E\u6027\u80FD\u6D4B\u8BD5\u7528\u4F8B\u7684\u8F93\u5165\u8F93\u51FA\u6587\u4EF6\n    |   |   |-- utils                        \u5B58\u653E\u5176\u4ED6\u5DE5\u5177\u7684\u8F93\u5165\u8F93\u51FA\u6587\u4EF6\n    |   |\n    |   |-- **suites**                       \u56DE\u5F52\u6D4B\u8BD5\u7528\u4F8B\n    |       |-- demo                         \u5B58\u653E\u6D4B\u8BD5\u7528\u4F8B\u7684demo\n    |       |-- correctness                  \u5B58\u653E\u6B63\u786E\u6027\u6D4B\u8BD5\u7528\u4F8B\n    |       |-- performance                  \u5B58\u653E\u6027\u80FD\u6D4B\u8BD5\u7528\u4F8B\n    |       |-- utils                        \u5176\u4ED6\u5DE5\u5177\n    |\n    |-- output\n        |-- regression-test\n            |-- log                          \u56DE\u5F52\u6D4B\u8BD5\u65E5\u5FD7\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6846\u67B6\u9ED8\u8BA4\u914D\u7F6E",children:"\u6846\u67B6\u9ED8\u8BA4\u914D\u7F6E"}),"\n",(0,i.jsx)(n.p,{children:"\u6D4B\u8BD5\u65F6\u9700\u8981\u5B9E\u9645\u60C5\u51B5\u4FEE\u6539jdbc\u548Cfe\u7684\u914D\u7F6E"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'\n/* ============ \u4E00\u822C\u53EA\u9700\u8981\u5173\u6CE8\u4E0B\u9762\u8FD9\u90E8\u5206 ============ */\n// \u9ED8\u8BA4DB,\u5982\u679C\u672A\u521B\u5EFA,\u5219\u4F1A\u5C1D\u8BD5\u521B\u5EFA\u8FD9\u4E2Adb\ndefaultDb = "regression_test"\n\n// Jdbc\u914D\u7F6E\njdbcUrl = "jdbc:mysql://127.0.0.1:9030/?"\njdbcUser = "root"\njdbcPassword = ""\n\n// fe\u5730\u5740\u914D\u7F6E, \u7528\u4E8Estream load\nfeHttpAddress = "127.0.0.1:8030"\nfeHttpUser = "root"\nfeHttpPassword = ""\n\n/* ============ \u4E00\u822C\u4E0D\u9700\u8981\u4FEE\u6539\u4E0B\u9762\u7684\u90E8\u5206 ============ */\n\n// DORIS_HOME\u53D8\u91CF\u662F\u901A\u8FC7run-regression-test.sh\u4F20\u5165\u7684\n// \u5373 java -DDORIS_HOME=./\n\n// \u8BBE\u7F6E\u56DE\u5F52\u6D4B\u8BD5\u7528\u4F8B\u7684\u76EE\u5F55\nsuitePath = "${DORIS_HOME}/regression-test/suites"\n// \u8BBE\u7F6E\u8F93\u5165\u8F93\u51FA\u6570\u636E\u7684\u76EE\u5F55\ndataPath = "${DORIS_HOME}/regression-test/data"\n// \u8BBE\u7F6E\u63D2\u4EF6\u7684\u76EE\u5F55\npluginPath = "${DORIS_HOME}/regression-test/plugins"\n\n// \u9ED8\u8BA4\u4F1A\u8BFB\u6240\u6709\u7684\u7EC4,\u8BFB\u591A\u4E2A\u7EC4\u53EF\u4EE5\u7528\u534A\u89D2\u9017\u53F7\u9694\u5F00\uFF0C\u5982: "demo,performance"\n// \u4E00\u822C\u4E0D\u9700\u8981\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u4FEE\u6539\uFF0C\u800C\u662F\u901A\u8FC7run-regression-test.sh --run -g\u6765\u52A8\u6001\u6307\u5B9A\u548C\u8986\u76D6\ntestGroups = ""\n// \u9ED8\u8BA4\u4F1A\u8BFB\u6240\u6709\u7684\u7528\u4F8B, \u540C\u6837\u53EF\u4EE5\u4F7F\u7528run-regression-test.sh --run -s\u6765\u52A8\u6001\u6307\u5B9A\u548C\u8986\u76D6\ntestSuites = ""\n// \u9ED8\u8BA4\u4F1A\u52A0\u8F7D\u7684\u7528\u4F8B\u76EE\u5F55, \u53EF\u4EE5\u901A\u8FC7run-regression-test.sh --run -d\u6765\u52A8\u6001\u6307\u5B9A\u548C\u8986\u76D6\ntestDirectories = ""\n\n// \u6392\u9664\u8FD9\u4E9B\u7EC4\u7684\u7528\u4F8B\uFF0C\u53EF\u901A\u8FC7run-regression-test.sh --run -xg\u6765\u52A8\u6001\u6307\u5B9A\u548C\u8986\u76D6\nexcludeGroups = ""\n// \u6392\u9664\u8FD9\u4E9Bsuite\uFF0C\u53EF\u901A\u8FC7run-regression-test.sh --run -xs\u6765\u52A8\u6001\u6307\u5B9A\u548C\u8986\u76D6\nexcludeSuites = ""\n// \u6392\u9664\u8FD9\u4E9B\u76EE\u5F55\uFF0C\u53EF\u901A\u8FC7run-regression-test.sh --run -xd\u6765\u52A8\u6001\u6307\u5B9A\u548C\u8986\u76D6\nexcludeDirectories = ""\n\n// \u5176\u4ED6\u81EA\u5B9A\u4E49\u914D\u7F6E\ncustomConf1 = "test_custom_conf_value"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u7F16\u5199\u7528\u4F8B\u7684\u6B65\u9AA4",children:"\u7F16\u5199\u7528\u4F8B\u7684\u6B65\u9AA4"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u8FDB\u5165",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test"}),"\u76EE\u5F55"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6839\u636E\u6D4B\u8BD5\u7684\u76EE\u7684\u6765\u9009\u62E9\u7528\u4F8B\u7684\u76EE\u5F55\uFF0C\u6B63\u786E\u6027\u6D4B\u8BD5\u5B58\u5728",(0,i.jsx)(n.code,{children:"suites/correctness"}),"\uFF0C\u800C\u6027\u80FD\u6D4B\u8BD5\u5B58\u5728",(0,i.jsx)(n.code,{children:"suites/performance"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u65B0\u5EFA\u4E00\u4E2Agroovy\u7528\u4F8B\u6587\u4EF6\uFF0C\u589E\u52A0\u82E5\u5E72",(0,i.jsx)(n.code,{children:"Action"}),"\u7528\u4E8E\u6D4B\u8BD5\uFF0CAction\u5C06\u5728\u540E\u7EED\u7AE0\u8282\u5177\u4F53\u8BF4\u660E"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"action",children:"Action"}),"\n",(0,i.jsx)(n.p,{children:"Action\u662F\u4E00\u4E2A\u6D4B\u8BD5\u6846\u67B6\u9ED8\u8BA4\u63D0\u4F9B\u7684\u6D4B\u8BD5\u884C\u4E3A\uFF0C\u4F7F\u7528DSL\u6765\u5B9A\u4E49\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"sql-action",children:"sql action"}),"\n",(0,i.jsx)(n.p,{children:"sql action\u7528\u4E8E\u63D0\u4EA4sql\u5E76\u83B7\u53D6\u7ED3\u679C\uFF0C\u5982\u679C\u67E5\u8BE2\u5931\u8D25\u5219\u4F1A\u629B\u51FA\u5F02\u5E38"}),"\n",(0,i.jsx)(n.p,{children:"\u53C2\u6570\u5982\u4E0B"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"String sql: \u8F93\u5165\u7684sql\u5B57\u7B26\u4E32"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"return List<List<Object>>"}),": \u67E5\u8BE2\u7ED3\u679C\uFF0C\u5982\u679C\u662FDDL/DML\uFF0C\u5219\u8FD4\u56DE\u4E00\u884C\u4E00\u5217\uFF0C\u552F\u4E00\u7684\u503C\u662FupdateRowCount"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4E0B\u9762\u7684\u6837\u4F8B\u4EE3\u7801\u5B58\u653E\u4E8E",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/sql_action.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("sql_action", "demo") {\n    // execute sql and ignore result\n    sql "show databases"\n\n    // execute sql and get result, outer List denote rows, inner List denote columns in a single row\n    List<List<Object>> tables = sql "show tables"\n\n    // assertXxx() will invoke junit5\'s Assertions.assertXxx() dynamically\n    assertTrue(tables.size() >= 0) // test rowCount >= 0\n\n    // syntax error\n    try {\n        sql "a b c d e"\n        throw new IllegalStateException("Should be syntax error")\n    } catch (java.sql.SQLException t) {\n        assertTrue(true)\n    }\n\n    def testTable = "test_sql_action1"\n\n    try {\n        sql "DROP TABLE IF EXISTS ${testTable}"\n\n        // multi-line sql\n        def result1 = sql """\n                        CREATE TABLE IF NOT EXISTS ${testTable} (\n                            id int\n                        )\n                        DISTRIBUTED BY HASH(id) BUCKETS 1\n                        PROPERTIES (\n                          "replication_num" = "1"\n                        ) \n                        """\n\n        // DDL/DML return 1 row and 1 column, the only value is update row count\n        assertTrue(result1.size() == 1)\n        assertTrue(result1[0].size() == 1)\n        assertTrue(result1[0][0] == 0, "Create table should update 0 rows")\n\n        def result2 = sql "INSERT INTO test_sql_action1 values(1), (2), (3)"\n        assertTrue(result2.size() == 1)\n        assertTrue(result2[0].size() == 1)\n        assertTrue(result2[0][0] == 3, "Insert should update 3 rows")\n    } finally {\n        /**\n         * try_xxx(args) means:\n         *\n         * try {\n         *    return xxx(args)\n         * } catch (Throwable t) {\n         *     // do nothing\n         *     return null\n         * }\n         */\n        try_sql("DROP TABLE IF EXISTS ${testTable}")\n\n        // you can see the error sql will not throw exception and return\n        try {\n            def errorSqlResult = try_sql("a b c d e f g")\n            assertTrue(errorSqlResult == null)\n        } catch (Throwable t) {\n            assertTrue(false, "Never catch exception")\n        }\n    }\n\n    // order_sql(sqlStr) equals to sql(sqlStr, isOrder=true)\n    // sort result by string dict\n    def list = order_sql """\n                select 2\n                union all\n                select 1\n                union all\n                select null\n                union all\n                select 15\n                union all\n                select 3\n                """\n\n    assertEquals(null, list[0][0])\n    assertEquals(1, list[1][0])\n    assertEquals(15, list[2][0])\n    assertEquals(2, list[3][0])\n    assertEquals(3, list[4][0])\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"qt-action",children:"qt action"}),"\n",(0,i.jsx)(n.p,{children:"qt action\u7528\u4E8E\u63D0\u4EA4sql\uFF0C\u5E76\u4F7F\u7528\u5BF9\u5E94\u7684.out TSV\u6587\u4EF6\u6765\u6821\u9A8C\u7ED3\u679C"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"String sql: \u8F93\u5165sql\u5B57\u7B26\u4E32"}),"\n",(0,i.jsx)(n.li,{children:"return void"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4E0B\u9762\u7684\u6837\u4F8B\u4EE3\u7801\u5B58\u653E\u4E8E",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/qt_action.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("qt_action", "demo") {\n    /**\n     * qt_xxx sql equals to quickTest(xxx, sql) witch xxx is tag.\n     * the result will be compare to the relate file: ${DORIS_HOME}/regression_test/data/qt_action.out.\n     *\n     * if you want to generate .out tsv file for real execute result. you can run with -genOut or -forceGenOut option.\n     * e.g\n     *   ${DORIS_HOME}/run-regression-test.sh --run qt_action -genOut\n     *   ${DORIS_HOME}/run-regression-test.sh --run qt_action -forceGenOut\n     */\n    qt_select "select 1, \'beijing\' union all select 2, \'shanghai\'"\n\n    qt_select2 "select 2"\n\n    // order result by string dict then compare to .out file.\n    // order_qt_xxx sql equals to quickTest(xxx, sql, true).\n    order_qt_union_all  """\n                select 2\n                union all\n                select 1\n                union all\n                select null\n                union all\n                select 15\n                union all\n                select 3\n                """\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"test-action",children:"test action"}),"\n",(0,i.jsx)(n.p,{children:"test action\u53EF\u4EE5\u4F7F\u7528\u66F4\u590D\u6742\u7684\u6821\u9A8C\u89C4\u5219\u6765\u6D4B\u8BD5\uFF0C\u6BD4\u5982\u9A8C\u8BC1\u884C\u6570\u3001\u6267\u884C\u65F6\u95F4\u3001\u662F\u5426\u629B\u51FA\u5F02\u5E38"}),"\n",(0,i.jsx)(n.p,{children:"\u53EF\u7528\u53C2\u6570"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"String sql: \u8F93\u5165\u7684sql\u5B57\u7B26\u4E32"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"List<List<Object>> result"}),": \u63D0\u4F9B\u4E00\u4E2AList\u5BF9\u8C61\uFF0C\u7528\u4E8E\u6BD4\u8F83\u771F\u5B9E\u67E5\u8BE2\u7ED3\u679C\u4E0EList\u5BF9\u8C61\u662F\u5426\u76F8\u7B49"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Iterator<Object> resultIterator"}),": \u63D0\u4F9B\u4E00\u4E2AIterator\u5BF9\u8C61\uFF0C\u7528\u4E8E\u6BD4\u8F83\u771F\u5B9E\u67E5\u8BE2\u7ED3\u679C\u4E0EIterator\u662F\u5426\u76F8\u7B49"]}),"\n",(0,i.jsx)(n.li,{children:"String resultFile: \u63D0\u4F9B\u4E00\u4E2A\u6587\u4EF6Uri(\u53EF\u4EE5\u662F\u672C\u5730\u6587\u4EF6\u76F8\u5BF9\u8DEF\u5F84\uFF0C\u6216http(s)\u8DEF\u5F84)\uFF0C\u7528\u4E8E\u6BD4\u8F83\u771F\u5B9E\u67E5\u8BE2\u7ED3\u679C\u4E0Ehttp\u54CD\u5E94\u6D41\u662F\u5426\u76F8\u7B49\uFF0C\u683C\u5F0F\u4E0E.out\u6587\u4EF6\u683C\u5F0F\u7C7B\u4F3C\uFF0C\u4F46\u6CA1\u6709\u5757\u5934\u548C\u6CE8\u91CA"}),"\n",(0,i.jsx)(n.li,{children:"String exception: \u6821\u9A8C\u629B\u51FA\u7684\u5F02\u5E38\u662F\u5426\u5305\u542B\u67D0\u4E9B\u5B57\u7B26\u4E32"}),"\n",(0,i.jsx)(n.li,{children:"long rowNum: \u9A8C\u8BC1\u7ED3\u679C\u884C\u6570"}),"\n",(0,i.jsx)(n.li,{children:"long time: \u9A8C\u8BC1\u6267\u884C\u65F6\u95F4\u662F\u5426\u5C0F\u4E8E\u8FD9\u4E2A\u503C\uFF0C\u5355\u4F4D\u662F\u6BEB\u79D2"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Closure<List<List<Object>>, Throwable, Long, Long> check"}),": \u81EA\u5B9A\u4E49\u56DE\u8C03\u6821\u9A8C\uFF0C\u53EF\u4F20\u5165\u7ED3\u679C\u3001\u5F02\u5E38\u3001\u65F6\u95F4\u3002\u5B58\u5728\u56DE\u8C03\u51FD\u6570\u65F6\uFF0C\u5176\u4ED6\u6821\u9A8C\u65B9\u5F0F\u4F1A\u5931\u6548\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4E0B\u9762\u7684\u6837\u4F8B\u4EE3\u7801\u5B58\u653E\u4E8E",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/test_action.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("test_action", "demo") {\n    test {\n        sql "abcdefg"\n        // check exception message contains\n        exception "errCode = 2, detailMessage = Syntax error"\n    }\n\n    test {\n        sql """\n            select *\n            from (\n                select 1 id\n                union all\n                select 2\n            ) a\n            order by id"""\n\n        // multi check condition\n\n        // check return 2 rows\n        rowNum 2\n        // execute time must <= 5000 millisecond\n        time 5000\n        // check result, must be 2 rows and 1 column, the first row is 1, second is 2\n        result(\n            [[1], [2]]\n        )\n    }\n\n    test {\n        sql "a b c d e f g"\n\n        // other check will not work because already declared a check callback\n        exception "aaaaaaaaa"\n\n        // callback\n        check { result, exception, startTime, endTime ->\n            // assertXxx() will invoke junit5\'s Assertions.assertXxx() dynamically\n            assertTrue(exception != null)\n        }\n    }\n\n    test {\n        sql  """\n                select 2\n                union all\n                select 1\n                union all\n                select null\n                union all\n                select 15\n                union all\n                select 3\n                """\n\n        check { result, ex, startTime, endTime ->\n            // same as order_sql(sqlStr)\n            result = sortRows(result)\n\n            assertEquals(null, result[0][0])\n            assertEquals(1, result[1][0])\n            assertEquals(15, result[2][0])\n            assertEquals(2, result[3][0])\n            assertEquals(3, result[4][0])\n        }\n    }\n\n    // execute sql and order query result, then compare to iterator\n    def selectValues = [1, 2, 3, 4]\n    test {\n        order true\n        sql selectUnionAll(selectValues)\n        resultIterator(selectValues.iterator())\n    }\n\n    // compare to data/demo/test_action.csv\n    test {\n        order true\n        sql selectUnionAll(selectValues)\n\n        // you can set to http://xxx or https://xxx\n        // and compare to http response body\n        resultFile "test_action.csv"\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"explain-action",children:"explain action"}),"\n",(0,i.jsx)(n.p,{children:"explain action\u7528\u6765\u6821\u9A8Cexplain\u8FD4\u56DE\u7684\u5B57\u7B26\u4E32\u662F\u5426\u5305\u542B\u67D0\u4E9B\u5B57\u7B26\u4E32"}),"\n",(0,i.jsx)(n.p,{children:"\u53EF\u7528\u53C2\u6570:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"String sql: \u67E5\u8BE2\u7684sql\uFF0C\u9700\u8981\u53BB\u6389sql\u4E2D\u7684explain"}),"\n",(0,i.jsx)(n.li,{children:"String contains: \u6821\u9A8Cexplain\u662F\u5426\u5305\u542B\u67D0\u4E9B\u5B57\u7B26\u4E32\uFF0C\u53EF\u591A\u6B21\u8C03\u7528\u6821\u9A8C\u540C\u65F6\u591A\u4E2A\u7ED3\u679C"}),"\n",(0,i.jsx)(n.li,{children:"String notContains: \u6821\u9A8Cexplain\u662F\u5426\u4E0D\u542B\u67D0\u4E9B\u5B57\u7B26\u4E32\uFF0C\u53EF\u591A\u6B21\u8C03\u7528\u6821\u9A8C\u540C\u65F6\u591A\u4E2A\u7ED3\u679C"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Closure<String> check"}),": \u81EA\u5B9A\u4E49\u6821\u9A8C\u56DE\u8C03\u51FD\u6570\uFF0C\u53EF\u4EE5\u83B7\u53D6\u8FD4\u56DE\u7684\u5B57\u7B26\u4E32\uFF0C\u5B58\u5728\u6821\u9A8C\u51FD\u6570\u65F6\uFF0C\u5176\u4ED6\u6821\u9A8C\u65B9\u5F0F\u4F1A\u5931\u6548"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Closure<String, Throwable, Long, Long> check"}),": \u81EA\u5B9A\u4E49\u6821\u9A8C\u56DE\u8C03\u51FD\u6570\uFF0C\u53EF\u4EE5\u989D\u5916\u83B7\u53D6\u5F02\u5E38\u548C\u65F6\u95F4"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4E0B\u9762\u7684\u6837\u4F8B\u4EE3\u7801\u5B58\u653E\u4E8E",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/explain_action.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("explain_action", "demo") {\n    explain {\n        sql("select 100")\n\n        // contains("OUTPUT EXPRS:<slot 0> 100\\n") && contains("PARTITION: UNPARTITIONED\\n")\n        contains "OUTPUT EXPRS:<slot 0> 100\\n"\n        contains "PARTITION: UNPARTITIONED\\n"\n    }\n\n    explain {\n        sql("select 100")\n\n        // contains(" 100\\n") && !contains("abcdefg") && !("1234567")\n        contains " 100\\n"\n        notContains "abcdefg"\n        notContains "1234567"\n    }\n\n    explain {\n        sql("select 100")\n        // simple callback\n        check { explainStr -> explainStr.contains("abcdefg") || explainStr.contains(" 100\\n") }\n    }\n\n    explain {\n        sql("a b c d e")\n        // callback with exception and time\n        check { explainStr, exception, startTime, endTime ->\n            // assertXxx() will invoke junit5\'s Assertions.assertXxx() dynamically\n            assertTrue(exception != null)\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"streamload-action",children:"streamLoad action"}),"\n",(0,i.jsx)(n.p,{children:"streamLoad action\u7528\u4E8E\u5BFC\u5165\u6570\u636E\n\u53EF\u7528\u53C2\u6570\u4E3A"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"String db: db\uFF0C\u9ED8\u8BA4\u503C\u4E3Aregression-conf.groovy\u4E2D\u7684defaultDb"}),"\n",(0,i.jsx)(n.li,{children:"String table: \u8868\u540D"}),"\n",(0,i.jsx)(n.li,{children:"String file: \u8981\u5BFC\u5165\u7684\u6587\u4EF6\u8DEF\u5F84\uFF0C\u53EF\u4EE5\u5199data\u76EE\u5F55\u4E0B\u7684\u76F8\u5BF9\u8DEF\u5F84\uFF0C\u6216\u8005\u5199http url\u6765\u5BFC\u5165\u7F51\u7EDC\u6587\u4EF6"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Iterator<List<Object>> inputIterator"}),": \u8981\u5BFC\u5165\u7684\u8FED\u4EE3\u5668"]}),"\n",(0,i.jsx)(n.li,{children:"String inputText: \u8981\u5BFC\u5165\u7684\u6587\u672C, \u8F83\u4E3A\u5C11\u7528"}),"\n",(0,i.jsx)(n.li,{children:"InputStream inputStream: \u8981\u5BFC\u5165\u7684\u5B57\u8282\u6D41\uFF0C\u8F83\u4E3A\u5C11\u7528"}),"\n",(0,i.jsx)(n.li,{children:"long time: \u9A8C\u8BC1\u6267\u884C\u65F6\u95F4\u662F\u5426\u5C0F\u4E8E\u8FD9\u4E2A\u503C\uFF0C\u5355\u4F4D\u662F\u6BEB\u79D2"}),"\n",(0,i.jsx)(n.li,{children:"void set(String key, String value): \u8BBE\u7F6Estream load\u7684http\u8BF7\u6C42\u7684header\uFF0C\u5982label\u3001columnSeparator"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Closure<String, Throwable, Long, Long> check"}),": \u81EA\u5B9A\u4E49\u6821\u9A8C\u56DE\u8C03\u51FD\u6570\uFF0C\u53EF\u4EE5\u83B7\u53D6\u8FD4\u56DE\u7ED3\u679C\u3001\u5F02\u5E38\u548C\u8D85\u65F6\u65F6\u95F4\u3002\u5F53\u5B58\u5728\u56DE\u8C03\u51FD\u6570\u65F6\uFF0C\u5176\u4ED6\u6821\u9A8C\u9879\u4F1A\u5931\u6548\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4E0B\u9762\u7684\u6837\u4F8B\u4EE3\u7801\u5B58\u653E\u4E8E",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/streamLoad_action.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("streamLoad_action", "demo") {\n\n    def tableName = "test_streamload_action1"\n\n    sql """\n            CREATE TABLE IF NOT EXISTS ${tableName} (\n                id int,\n                name varchar(255)\n            )\n            DISTRIBUTED BY HASH(id) BUCKETS 1\n            PROPERTIES (\n              "replication_num" = "1"\n            ) \n        """\n\n    streamLoad {\n        // you can skip declare db, because a default db already specify in ${DORIS_HOME}/conf/regression-conf.groovy\n        // db \'regression_test\'\n        table tableName\n\n        // default label is UUID:\n        // set \'label\' UUID.randomUUID().toString()\n\n        // default column_separator is specify in doris fe config, usually is \'\\t\'.\n        // this line change to \',\'\n        set \'column_separator\', \',\'\n\n        // relate to ${DORIS_HOME}/regression-test/data/demo/streamload_input.csv.\n        // also, you can stream load a http stream, e.g. http://xxx/some.csv\n        file \'streamload_input.csv\'\n\n        time 10000 // limit inflight 10s\n\n        // stream load action will check result, include Success status, and NumberTotalRows == NumberLoadedRows\n    }\n\n\n    // stream load 100 rows\n    def rowCount = 100\n    // range: [0, rowCount)\n    // or rangeClosed: [0, rowCount]\n    def rowIt = range(0, rowCount)\n            .mapToObj({i -> [i, "a_" + i]}) // change Long to List<Long, String>\n            .iterator()\n\n    streamLoad {\n        table tableName\n        // also, you can upload a memory iterator\n        inputIterator rowIt\n\n        // if declared a check callback, the default check condition will ignore.\n        // So you must check all condition\n        check { result, exception, startTime, endTime ->\n            if (exception != null) {\n                throw exception\n            }\n            log.info("Stream load result: ${result}".toString())\n            def json = parseJson(result)\n            assertEquals("success", json.Status.toLowerCase())\n            assertEquals(json.NumberTotalRows, json.NumberLoadedRows)\n            assertTrue(json.NumberLoadedRows > 0 && json.LoadBytes > 0)\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5176\u4ED6action",children:"\u5176\u4ED6Action"}),"\n",(0,i.jsxs)(n.p,{children:["thread, lazyCheck, events, connect, selectUnionAll\n\u5177\u4F53\u53EF\u4EE5\u5728\u8FD9\u4E2A\u76EE\u5F55\u627E\u5230\u4F8B\u5B50: ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo"})]}),"\n",(0,i.jsx)(n.h2,{id:"\u542F\u52A8\u811A\u672C\u4F8B\u5B50",children:"\u542F\u52A8\u811A\u672C\u4F8B\u5B50"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u67E5\u770B\u811A\u672C\u53C2\u6570\u8BF4\u660E\n./run-regression-test.sh h\n\n# \u67E5\u770B\u6846\u67B6\u53C2\u6570\u8BF4\u660E\n./run-regression-test.sh --run -h\n\n# \u6D4B\u8BD5\u6240\u6709\u7528\u4F8B\n./run-regression-test.sh \n\n# \u5220\u9664\u6D4B\u8BD5\u6846\u67B6\u7F16\u8BD1\u7ED3\u679C\u548C\u6D4B\u8BD5\u65E5\u5FD7\n./run-regression-test.sh --clean\n\n# \u6D4B\u8BD5suiteName\u4E3Asql_action\u7684\u7528\u4F8B, \u76EE\u524DsuiteName\u7B49\u4E8E\u6587\u4EF6\u540D\u524D\u7F00\uFF0C\u4F8B\u5B50\u5BF9\u5E94\u7684\u7528\u4F8B\u6587\u4EF6\u662Fsql_action.groovy\n./run-regression-test.sh --run sql_action \n\n# \u6D4B\u8BD5suiteName\u5305\u542B'sql'\u7684\u7528\u4F8B\uFF0C**\u6CE8\u610F\u9700\u8981\u7528\u5355\u5F15\u53F7\u62EC\u8D77\u6765**\n./run-regression-test.sh --run '*sql*' \n\n# \u6D4B\u8BD5demo\u548Cperformance group\n./run-regression-test.sh --run -g 'demo,performance'\n\n# \u6D4B\u8BD5demo group\u4E0B\u7684sql_action\n./run-regression-test.sh --run -g demo -s sql_action\n\n# \u6D4B\u8BD5demo\u76EE\u5F55\u4E0B\u7684sql_action\n./run-regression-test.sh --run -d demo -s sql_action\n\n# \u6D4B\u8BD5demo\u76EE\u5F55\u4E0B\u7528\u4F8B\uFF0C\u6392\u9664sql_action\u7528\u4F8B\n./run-regression-test.sh --run -d demo -xs sql_action\n\n# \u6392\u9664demo\u76EE\u5F55\u7684\u7528\u4F8B\n./run-regression-test.sh --run -xd demo\n\n# \u6392\u9664demo group\u7684\u7528\u4F8B\n./run-regression-test.sh --run -xg demo\n\n# \u81EA\u5B9A\u4E49\u914D\u7F6E\n./run-regression-test.sh --run -conf a=b\n\n# \u5E76\u53D1\u6267\u884C\n./run-regression-test.sh --run -parallel 5 -suiteParallel 10 -actionParallel 20\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u4F7F\u7528\u67E5\u8BE2\u7ED3\u679C\u81EA\u52A8\u751F\u6210out\u6587\u4EF6",children:"\u4F7F\u7528\u67E5\u8BE2\u7ED3\u679C\u81EA\u52A8\u751F\u6210.out\u6587\u4EF6"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u4F7F\u7528\u67E5\u8BE2\u7ED3\u679C\u81EA\u52A8\u751F\u6210sql_action\u7528\u4F8B\u7684.out\u6587\u4EF6\uFF0C\u5982\u679C.out\u6587\u4EF6\u5B58\u5728\u5219\u5FFD\u7565\n./run-regression-test.sh --run sql_action -genOut\n\n# \u4F7F\u7528\u67E5\u8BE2\u7ED3\u679C\u81EA\u52A8\u751F\u6210sql_action\u7528\u4F8B\u7684.out\u6587\u4EF6\uFF0C\u5982\u679C.out\u6587\u4EF6\u5B58\u5728\u5219\u8986\u76D6\n./run-regression-test.sh --run sql_action -forceGenOut\n"})}),"\n",(0,i.jsx)(n.h2,{id:"suite\u63D2\u4EF6",children:"Suite\u63D2\u4EF6"}),"\n",(0,i.jsxs)(n.p,{children:["\u6709\u7684\u65F6\u5019\u6211\u4EEC\u9700\u8981\u62D3\u5C55Suite\u7C7B\uFF0C\u4F46\u4E0D\u4FBF\u4E8E\u4FEE\u6539Suite\u7C7B\u7684\u6E90\u7801\uFF0C\u5219\u53EF\u4EE5\u901A\u8FC7\u63D2\u4EF6\u6765\u8FDB\u884C\u62D3\u5C55\u3002\u9ED8\u8BA4\u63D2\u4EF6\u76EE\u5F55\u4E3A",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/plugins"}),"\uFF0C\u5728\u5176\u4E2D\u53EF\u4EE5\u901A\u8FC7groovy\u811A\u672C\u5B9A\u4E49\u62D3\u5C55\u65B9\u6CD5\uFF0C\u4EE5",(0,i.jsx)(n.code,{children:"plugin_example.groovy"}),"\u4E3A\u4F8B\uFF0C\u4E3ASuite\u7C7B\u589E\u52A0\u4E86testPlugin\u51FD\u6570\u7528\u4E8E\u6253\u5370\u65E5\u5FD7\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'import org.apache.doris.regression.suite.Suite\n\n// register `testPlugin` function to Suite,\n// and invoke in ${DORIS_HOME}/regression-test/suites/demo/test_plugin.groovy\nSuite.metaClass.testPlugin = { String info /* param */ ->\n\n    // which suite invoke current function?\n    Suite suite = delegate as Suite\n\n    // function body\n    suite.getLogger().info("Test plugin: suiteName: ${suite.name}, info: ${info}".toString())\n\n    // optional return value\n    return "OK"\n}\n\nlogger.info("Added \'testPlugin\' function to Suite")\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u589E\u52A0\u4E86testPlugin\u51FD\u6570\u540E\uFF0C\u5219\u53EF\u4EE5\u5728\u666E\u901A\u7528\u4F8B\u4E2D\u4F7F\u7528\u5B83\uFF0C\u4EE5",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/test_plugin.groovy"}),"\u4E3A\u4F8B:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("test_plugin", "demo") {\n    // register testPlugin function in ${DORIS_HOME}/regression-test/plugins/plugin_example.groovy\n    def result = testPlugin("message from suite")\n    assertEquals("OK", result)\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"cicd\u7684\u652F\u6301",children:"CI/CD\u7684\u652F\u6301"}),"\n",(0,i.jsx)(n.h3,{id:"teamcity",children:"TeamCity"}),"\n",(0,i.jsxs)(n.p,{children:["TeamCity\u53EF\u4EE5\u901A\u8FC7stdout\u8BC6\u522BService Message\u3002\u5F53\u4F7F\u7528",(0,i.jsx)(n.code,{children:"--teamcity"}),"\u53C2\u6570\u542F\u52A8\u56DE\u5F52\u6D4B\u8BD5\u6846\u67B6\u65F6\uFF0C\u56DE\u5F52\u6D4B\u8BD5\u6846\u67B6\u5C31\u4F1A\u5728stdout\u6253\u5370TeamCity Service Message\uFF0CTeamCity\u5C06\u4F1A\u81EA\u52A8\u8BFB\u53D6stdout\u4E2D\u7684\u4E8B\u4EF6\u65E5\u5FD7\uFF0C\u5E76\u5728\u5F53\u524D\u6D41\u6C34\u7EBF\u4E2D\u5C55\u793A",(0,i.jsx)(n.code,{children:"Tests"}),"\uFF0C\u5176\u4E2D\u4F1A\u5C55\u793A\u6D4B\u8BD5\u7684test\u53CA\u5176\u65E5\u5FD7\u3002\n\u56E0\u6B64\u53EA\u9700\u8981\u914D\u7F6E\u4E0B\u9762\u4E00\u884C\u542F\u52A8\u56DE\u5F52\u6D4B\u8BD5\u6846\u67B6\u7684\u547D\u4EE4\u5373\u53EF\u3002\u5176\u4E2D",(0,i.jsx)(n.code,{children:"-Dteamcity.enableStdErr=false"}),"\u53EF\u4EE5\u8BA9\u9519\u8BEF\u65E5\u5FD7\u4E5F\u6253\u5370\u5230stdout\u4E2D\uFF0C\u65B9\u4FBF\u6309\u65F6\u95F4\u987A\u5E8F\u5206\u6790\u65E5\u5FD7\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'JAVA_OPTS="-Dteamcity.enableStdErr=${enableStdErr}" ./run-regression-test.sh --teamcity --run\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5916\u90E8\u6570\u636E\u6E90-e2e-\u6D4B\u8BD5",children:"\u5916\u90E8\u6570\u636E\u6E90 e2e \u6D4B\u8BD5"}),"\n",(0,i.jsx)(n.p,{children:"Doris \u652F\u6301\u4E00\u4E9B\u5916\u90E8\u7F72\u6570\u636E\u6E90\u7684\u67E5\u8BE2\u3002\u6240\u4EE5\u56DE\u5F52\u6846\u67B6\u4E5F\u63D0\u4F9B\u4E86\u901A\u8FC7 Docker Compose \u642D\u5EFA\u5916\u90E8\u6570\u636E\u6E90\u7684\u529F\u80FD\uFF0C\u4EE5\u63D0\u4F9B Doris \u5BF9\u5916\u90E8\u6570\u636E\u6E90\u7684 e2e \u6D4B\u8BD5\u3002"}),"\n",(0,i.jsxs)(n.ol,{start:"0",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u51C6\u5907\u5DE5\u4F5C"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u542F\u52A8 Docker \u524D\uFF0C\u8BF7\u5148\u4FEE\u6539 ",(0,i.jsx)(n.code,{children:"docker/thirdparties/custom_settings.env"})," \u6587\u4EF6\u4E2D\u7684 ",(0,i.jsx)(n.code,{children:"CONTAINER_UID"})," \u53D8\u91CF\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u53EF\u4EE5\u4FEE\u6539\u4E3A\u5982\uFF1A",(0,i.jsx)(n.code,{children:"doris-10002-18sda1-"}),"\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u4E4B\u540E\u7684\u542F\u52A8\u811A\u672C\u4F1A\uFF0C\u5C06 docker compose \u4E2D\u5BF9\u5E94\u7684\u540D\u79F0\u8FDB\u884C\u66FF\u6362\uFF0C\u8FD9\u6837\u53EF\u4EE5\u4FDD\u8BC1\u591A\u5957 containers \u73AF\u5883\u7684\u5BB9\u5668\u540D\u79F0\u548C\u7F51\u7EDC\u4E0D\u4F1A\u51B2\u7A81\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u542F\u52A8\u5BB9\u5668\u524D\uFF0C\u9700\u8981\u68C0\u67E5\u670D\u52A1\u5668/\u4E91\u4E3B\u673A\u7684\u7F51\u7EDC\u914D\u7F6E\uFF0C\u786E\u8BA4/etc/hosts\u4E2D\u662F\u5426\u914D\u7F6E\u4E86\u4E3B\u673A\u540D\uFF08hostname\uFF09\u548C\u4E3B\u673A IP \u5730\u5740\uFF08hostname -i\uFF09\u7684\u6620\u5C04\u5173\u7CFB\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u5F62\u5982\uFF1A",(0,i.jsx)(n.code,{children:"10.0.0.46    iZj6cbwlx5pl6y0681t6scZ    iZj6cbwlx5pl6y0681t6scZ"}),"\uFF0C\u5206\u522B\u4E3A IP \u5730\u5740\uFF08hostname -i\u547D\u4EE4\u8F93\u51FA\uFF0C\u4E00\u822C\u4E3Aeth0\u7684IP\uFF09\u3001\u4E3B\u673A\u540D\uFF08hostname\u547D\u4EE4\u8F93\u51FA\uFF09\u3001\u522B\u540D\uFF08\u540C\u524D\uFF09\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u542F\u52A8 Container"}),"\n",(0,i.jsxs)(n.p,{children:["Doris \u76EE\u524D\u652F\u6301 es, mysql, pg, hive, sqlserver, oracle, iceberg, hudi, trino \u7B49\u6570\u636E\u6E90\u7684 Docker compose\u3002\u76F8\u5173\u6587\u4EF6\u5B58\u653E\u5728 ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose"})," \u76EE\u5F55\u4E0B\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u53EF\u4EE5\u76F4\u63A5\u901A\u8FC7\u4EE5\u4E0B\u547D\u4EE4\u542F\u52A8\u6240\u6709\u5916\u90E8\u6570\u636E\u6E90\u7684 Docker container\uFF1A\n\uFF08\u6CE8\u610F\uFF0Chive\u548Chudi container \u9700\u8981\u4E0B\u8F7D\u9884\u5236\u7684\u6570\u636E\u6587\u4EF6\uFF0C\u8BF7\u53C2\u9605\u4E0B\u9762 hive\u548Chudi \u76F8\u5173\u7684\u6587\u6863\u3002\uFF09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cd docker/thirdparties && sh run-thirdparties-docker.sh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u8BE5\u547D\u4EE4\u9700\u8981 root \u6216 sudo \u6743\u9650\u3002\u547D\u4EE4\u8FD4\u56DE\u6210\u529F\uFF0C\u5219\u4EE3\u8868\u6240\u6709 container \u542F\u52A8\u5B8C\u6210\u3002\u53EF\u4EE5\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"docker ps -a"})," \u547D\u4EE4\u67E5\u770B\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["container \u542F\u52A8\u8FC7\u7A0B\u4E2D\uFF0C\u53EF\u4EE5\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"docker logs -f <container-name>"})," \u547D\u4EE4\u67E5\u770B container \u7684\u65E5\u5FD7\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u53EF\u4EE5\u901A\u8FC7\u4EE5\u4E0B\u547D\u4EE4\u505C\u6B62\u6240\u6709 container\uFF1A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cd docker/thirdparties && sh run-thirdparties-docker.sh --stop\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4E5F\u53EF\u4EE5\u901A\u8FC7\u4EE5\u4E0B\u547D\u4EE4\u542F\u52A8\u6216\u505C\u6B62\u6307\u5B9A\u7684\u7EC4\u4EF6\uFF1A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cd docker/thirdparties\n# \u542F\u52A8 mysql\nsh run-thirdparties-docker.sh -c mysql\n# \u542F\u52A8 mysql,pg,iceberg\nsh run-thirdparties-docker.sh -c mysql,pg,iceberg\n# \u505C\u6B62 mysql,pg,iceberg\nsh run-thirdparties-docker.sh -c mysql,pg,iceberg --stop\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"MySQL"}),"\n",(0,i.jsx)(n.p,{children:"MySQL \u76F8\u5173\u7684 Docker compose \u6587\u4EF6\u5B58\u653E\u5728 docker/thirdparties/docker-compose/mysql \u4E0B\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mysql-5.7.yaml.tpl"}),"\uFF1ADocker compose \u6587\u4EF6\u6A21\u677F\uFF0C\u65E0\u9700\u4FEE\u6539\u3002\u9ED8\u8BA4\u7528\u6237\u540D\u5BC6\u7801\u4E3A root/123456"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mysql-5.7.env"}),"\uFF1A\u914D\u7F6E\u6587\u4EF6\uFF0C\u5176\u4E2D\u53EF\u4EE5\u914D\u7F6E MySQL container \u5BF9\u5916\u66B4\u9732\u7684\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 3316\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"init/"}),"\uFF1A\u8BE5\u76EE\u5F55\u5B58\u653E\u7684 sql \u6587\u4EF6\u4F1A\u5728 container \u521B\u5EFA\u540E\u81EA\u52A8\u6267\u884C\u3002\u76EE\u524D\u9ED8\u8BA4\u4F1A\u521B\u5EFA\u5E93\u3001\u8868\u5E76\u63D2\u5165\u5C11\u91CF\u6570\u636E\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data/"}),"\uFF1Acontainer \u542F\u52A8\u540E\u6302\u8F7D\u7684\u672C\u5730\u6570\u636E\u76EE\u5F55\uFF0C",(0,i.jsx)(n.code,{children:"run-thirdparties-docker.sh"})," \u811A\u672C\u4F1A\u5728\u6BCF\u6B21\u542F\u52A8\u65F6\uFF0C\u81EA\u52A8\u6E05\u7A7A\u5E76\u91CD\u5EFA\u8FD9\u4E2A\u76EE\u5F55\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Postgresql"}),"\n",(0,i.jsx)(n.p,{children:"Postgresql \u76F8\u5173\u7684 Docker compose \u6587\u4EF6\u5B58\u653E\u5728 docker/thirdparties/docker-compose/postgresql \u4E0B\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"postgresql-14.yaml.tpl"}),"\uFF1ADocker compose \u6587\u4EF6\u6A21\u677F\uFF0C\u65E0\u9700\u4FEE\u6539\u3002\u9ED8\u8BA4\u7528\u6237\u540D\u5BC6\u7801\u4E3A postgres/123456"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"postgresql-14.env"}),"\uFF1A\u914D\u7F6E\u6587\u4EF6\uFF0C\u5176\u4E2D\u53EF\u4EE5\u914D\u7F6E Postgresql container \u5BF9\u5916\u66B4\u9732\u7684\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 5442\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"init/"}),"\uFF1A\u8BE5\u76EE\u5F55\u5B58\u653E\u7684 sql \u6587\u4EF6\u4F1A\u5728 container \u521B\u5EFA\u540E\u81EA\u52A8\u6267\u884C\u3002\u76EE\u524D\u9ED8\u8BA4\u4F1A\u521B\u5EFA\u5E93\u3001\u8868\u5E76\u63D2\u5165\u5C11\u91CF\u6570\u636E\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data/"}),"\uFF1Acontainer \u542F\u52A8\u540E\u6302\u8F7D\u7684\u672C\u5730\u6570\u636E\u76EE\u5F55\uFF0C",(0,i.jsx)(n.code,{children:"run-thirdparties-docker.sh"})," \u811A\u672C\u4F1A\u5728\u6BCF\u6B21\u542F\u52A8\u65F6\uFF0C\u81EA\u52A8\u6E05\u7A7A\u5E76\u91CD\u5EFA\u8FD9\u4E2A\u76EE\u5F55\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Hive"}),"\n",(0,i.jsx)(n.p,{children:"Hive \u76F8\u5173\u7684 Docker compose \u6587\u4EF6\u5B58\u653E\u5728 docker/thirdparties/docker-compose/hive \u4E0B\uFF0C\u652F\u6301Hive2\u548CHive3\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hive-2x.yaml.tpl"}),"\u3001",(0,i.jsx)(n.code,{children:"hive-3x.yaml.tpl"}),"\uFF1ADocker compose \u6587\u4EF6\u6A21\u677F\uFF0C\u65E0\u9700\u4FEE\u6539\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hadoop-hive.env.tpl"}),"\u3001",(0,i.jsx)(n.code,{children:"hadoop-hive-2x.env.tpl"}),"\u548C",(0,i.jsx)(n.code,{children:"hadoop-hive-3x.env.tpl"}),"\uFF1A\u914D\u7F6E\u6587\u4EF6\u7684\u6A21\u677F\uFF0C\u65E0\u9700\u4FEE\u6539\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hive-2x_settings.env"}),"\uFF1AHive2\u521D\u59CB\u5316\u914D\u7F6E\u6587\u4EF6\u7684\u811A\u672C\uFF0C",(0,i.jsx)(n.code,{children:"run-thirdparties-docker.sh"})," \u542F\u52A8\u65F6\u4F1A\u81EA\u52A8\u8C03\u7528\u8FD9\u4E2A\u811A\u672C\u3002\u53EF\u4EE5\u5728\u5176\u4E2D\u4FEE\u6539\uFF1A",(0,i.jsx)(n.code,{children:"FS_PORT"}),"\u3001",(0,i.jsx)(n.code,{children:"HMS_PORT"}),"\u3001",(0,i.jsx)(n.code,{children:"HS_PORT"}),"\u548C",(0,i.jsx)(n.code,{children:"PG_PORT"})," \u56DB\u4E2A\u5BF9\u5916\u7AEF\u53E3\uFF0C\u5206\u522B\u4E0E",(0,i.jsx)(n.code,{children:"regression-conf.groovy"}),"\u4E2D\u7684",(0,i.jsx)(n.code,{children:"hive2HdfsPort"}),"\u3001",(0,i.jsx)(n.code,{children:"hive2HmsPort"}),"\u3001",(0,i.jsx)(n.code,{children:"hive2ServerPort"}),"\u548C",(0,i.jsx)(n.code,{children:"hive2PgPort"}),"\u76F8\u5BF9\u5E94\u3002\u524D\u4E24\u4E2A\u4E3Ahadoop\u914D\u7F6E\u7684 defaultFs \u548C Hive metastore \u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 8020 \u548C 9083\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hive-3x_settings.env"}),"\uFF1AHive3\u521D\u59CB\u5316\u914D\u7F6E\u6587\u4EF6\u7684\u811A\u672C\uFF0C",(0,i.jsx)(n.code,{children:"run-thirdparties-docker.sh"})," \u542F\u52A8\u65F6\u4F1A\u81EA\u52A8\u8C03\u7528\u8FD9\u4E2A\u811A\u672C\u3002\u53EF\u4EE5\u5728\u5176\u4E2D\u4FEE\u6539\uFF1A",(0,i.jsx)(n.code,{children:"FS_PORT"}),"\u3001",(0,i.jsx)(n.code,{children:"HMS_PORT"}),"\u3001",(0,i.jsx)(n.code,{children:"HS_PORT"}),"\u548C",(0,i.jsx)(n.code,{children:"PG_PORT"})," \u56DB\u4E2A\u5BF9\u5916\u7AEF\u53E3\uFF0C\u5206\u522B\u4E0E",(0,i.jsx)(n.code,{children:"regression-conf.groovy"}),"\u4E2D\u7684",(0,i.jsx)(n.code,{children:"hive3HdfsPort"}),"\u3001",(0,i.jsx)(n.code,{children:"hive3HmsPort"}),"\u3001",(0,i.jsx)(n.code,{children:"hive3ServerPort"}),"\u548C",(0,i.jsx)(n.code,{children:"hive3PgPort"}),"\u76F8\u5BF9\u5E94\u3002\u524D\u4E24\u4E2A\u4E3Ahadoop\u914D\u7F6E\u7684 defaultFs \u548C Hive metastore \u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 8320 \u548C 9383\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"scripts/"})," \u76EE\u5F55\u4F1A\u5728 container \u542F\u52A8\u540E\u6302\u8F7D\u5230 container \u4E2D\u3002\u5176\u4E2D\u7684\u6587\u4EF6\u5185\u5BB9\u65E0\u9700\u4FEE\u6539\u3002\u4F46\u987B\u6CE8\u610F\uFF0C\u5728\u542F\u52A8 container \u4E4B\u524D\uFF0C\u9700\u8981\u5148\u4E0B\u8F7D\u9884\u5236\u6587\u4EF6\uFF1A"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5C06 ",(0,i.jsx)(n.code,{children:"https://doris-regression-hk.oss-cn-hongkong.aliyuncs.com/regression/datalake/pipeline_data/tpch1.db.tar.gz"})," \u6587\u4EF6\u4E0B\u8F7D\u5230 ",(0,i.jsx)(n.code,{children:"scripts/"})," \u76EE\u5F55\u5E76\u89E3\u538B\u5373\u53EF\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Elasticsearch"}),"\n",(0,i.jsx)(n.p,{children:"\u5305\u62EC ES6\uFF0CES7\uFF0CES8 \u4E09\u4E2A\u7248\u672C\u7684 docker \u955C\u50CF\uFF0C\u5B58\u653E\u5728 docker/thirdparties/docker-compose/elasticsearch/ \u4E0B\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"es.yaml.tpl"}),"\uFF1ADocker compose \u6587\u4EF6\u6A21\u677F\u3002\u5305\u62EC ES6\uFF0CES7\uFF0CES8 \u4E09\u4E2A\u7248\u672C\u3002\u65E0\u9700\u4FEE\u6539\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"es.env"}),"\uFF1A\u914D\u7F6E\u6587\u4EF6\uFF0C\u9700\u914D\u7F6E ES \u7684\u7AEF\u53E3\u53F7\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scripts"})," \u76EE\u5F55\u4E0B\u5B58\u653E\u4E86\u542F\u52A8\u955C\u50CF\u540E\u7684\u521D\u59CB\u5316\u811A\u672C\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Oracle"}),"\n",(0,i.jsx)(n.p,{children:"\u63D0\u4F9B Oracle 11 \u955C\u50CF\uFF0C\u5B58\u653E\u5728 docker/thirdparties/docker-compose/oracle/ \u4E0B\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"oracle-11.yaml.tpl"}),"\uFF1ADocker compose \u6587\u4EF6\u6A21\u677F\u3002\u65E0\u9700\u4FEE\u6539\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"oracle-11.env"}),"\uFF1A\u914D\u7F6E Oracle \u5BF9\u5916\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 1521\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"SQLServer"}),"\n",(0,i.jsx)(n.p,{children:"\u63D0\u4F9B SQLServer 2022 \u955C\u50CF\uFF0C\u5B58\u653E\u5728 docker/thirdparties/docker-compose/sqlserver/ \u4E0B\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sqlserver.yaml.tpl"}),"\uFF1ADocker compose \u6587\u4EF6\u6A21\u677F\u3002\u65E0\u9700\u4FEE\u6539\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sqlserver.env"}),"\uFF1A\u914D\u7F6E SQLServer \u5BF9\u5916\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 1433\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"ClickHouse"}),"\n",(0,i.jsx)(n.p,{children:"\u63D0\u4F9B ClickHouse 22 \u955C\u50CF\uFF0C\u5B58\u653E\u5728 docker/thirdparties/docker-compose/clickhouse/ \u4E0B\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"clickhouse.yaml.tpl"}),"\uFF1ADocker compose \u6587\u4EF6\u6A21\u677F\u3002\u65E0\u9700\u4FEE\u6539\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"clickhouse.env"}),"\uFF1A\u914D\u7F6E ClickHouse \u5BF9\u5916\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 8123\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Iceberg"}),"\n",(0,i.jsx)(n.p,{children:"\u63D0\u4F9B Iceberg + Spark + Minio \u955C\u50CF\u7EC4\u5408\u3002\u5B58\u653E\u5728 docker/thirdparties/docker-compose/iceberg/ \u4E0B\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"iceberg.yaml.tpl"}),"\uFF1ADocker compose \u6587\u4EF6\u6A21\u677F\u3002\u65E0\u9700\u4FEE\u6539\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"entrypoint.sh.tpl"}),"\uFF1A\u955C\u50CF\u542F\u52A8\u540E\u7684\u521D\u59CB\u5316\u811A\u672C\u6A21\u677F\u3002\u65E0\u9700\u4FEE\u6539\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"spark-defaults.conf.tpl"}),"\uFF1ASpark \u7684\u914D\u7F6E\u6587\u4EF6\u6A21\u677F\u3002\u65E0\u9700\u4FEE\u6539\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"iceberg.env"}),"\uFF1A\u5BF9\u5916\u7AEF\u53E3\u914D\u7F6E\u6587\u4EF6\uFF0C\u9700\u4FEE\u6539\u5404\u4E2A\u5BF9\u5916\u7AEF\u53E3\uFF0C\u907F\u514D\u7AEF\u53E3\u51B2\u7A81\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u542F\u52A8\u540E\uFF0C\u53EF\u4EE5\u901A\u8FC7\u5982\u4E0B\u547D\u4EE4\u542F\u52A8 spark-sql"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"docker exec -it doris-xx-spark-iceberg spark-sql"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5176\u4E2D ",(0,i.jsx)(n.code,{children:"doris-xx-spark-iceberg"})," \u4E3A container \u540D\u79F0\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"spark-sql iceberg \u64CD\u4F5C\u793A\u4F8B\uFF1A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"create database db1;\nshow databases;\ncreate table db1.test1(k1 bigint, k2 bigint, k3 string) partitioned by (k1);\ninsert into db1.test1 values(1,2,'abc');\nselect * from db1.test1;\nquit;\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4E5F\u53EF\u4EE5\u901A\u8FC7 spark-shell \u8FDB\u884C\u8BBF\u95EE\uFF1A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'docker exec -it doris-xx-spark-iceberg spark-shell\n\nspark.sql(s"create database db1")\nspark.sql(s"show databases").show()\nspark.sql(s"create table db1.test1(k1 bigint, k2 bigint, k3 string) partitioned by (k1)").show()\nspark.sql(s"show tables from db1").show()\nspark.sql(s"insert into db1.test1 values(1,2,\'abc\')").show()\nspark.sql(s"select * from db1.test1").show()\n:q\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u66F4\u591A\u4F7F\u7528\u65B9\u5F0F\u53EF\u53C2\u9605 ",(0,i.jsx)(n.a,{href:"https://tabular.io/blog/docker-spark-and-iceberg/",children:"Tabular \u5B98\u65B9\u6587\u6863"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Hudi"}),"\n",(0,i.jsx)(n.p,{children:"Hudi \u76F8\u5173\u7684 Docker compose \u6587\u4EF6\u5B58\u653E\u5728 docker/thirdparties/docker-compose/hudi \u4E0B\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hudi.yaml.tpl"}),"\uFF1ADocker compose \u6587\u4EF6\u6A21\u677F\uFF0C\u65E0\u9700\u4FEE\u6539\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hadoop.env"}),"\uFF1A\u914D\u7F6E\u6587\u4EF6\u7684\u6A21\u677F\uFF0C\u65E0\u9700\u4FEE\u6539\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"scripts/"})," \u76EE\u5F55\u4F1A\u5728 container \u542F\u52A8\u540E\u6302\u8F7D\u5230 container \u4E2D\u3002\u5176\u4E2D\u7684\u6587\u4EF6\u5185\u5BB9\u65E0\u9700\u4FEE\u6539\u3002\u4F46\u987B\u6CE8\u610F\uFF0C\u5728\u542F\u52A8 container \u4E4B\u524D\uFF0C\u9700\u8981\u5148\u4E0B\u8F7D\u9884\u5236\u6587\u4EF6\uFF1A\n\u5C06 ",(0,i.jsx)(n.code,{children:"https://doris-build-hk-1308700295.cos.ap-hongkong.myqcloud.com/regression/load/hudi/hudi_docker_compose_attached_file.zip"})," \u6587\u4EF6\u4E0B\u8F7D\u5230 ",(0,i.jsx)(n.code,{children:"scripts/"})," \u76EE\u5F55\u5E76\u89E3\u538B\u5373\u53EF\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u542F\u52A8\u524D\uFF0C\u53EF\u4EE5\u5C06\u4EE5\u4E0B\u8BBE\u7F6E\u6DFB\u52A0\u5230",(0,i.jsx)(n.code,{children:"/etc/hosts"}),"\u4E2D\uFF0C\u4EE5\u907F\u514D\u51FA\u73B0",(0,i.jsx)(n.code,{children:"UnknownHostException"}),"\u9519\u8BEF"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"127.0.0.1 adhoc-1\n127.0.0.1 adhoc-2\n127.0.0.1 namenode\n127.0.0.1 datanode1\n127.0.0.1 hiveserver\n127.0.0.1 hivemetastore\n127.0.0.1 sparkmaster\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u542F\u52A8\u540E\uFF0C\u53EF\u4EE5\u901A\u8FC7\u5982\u4E0B\u547D\u4EE4\u542F\u52A8 hive query"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"docker exec -it adhoc-2 /bin/bash\n\nbeeline -u jdbc:hive2://hiveserver:10000 \\\n--hiveconf hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat \\\n--hiveconf hive.stats.autogather=false\n\nshow tables;\nshow partitions stock_ticks_mor_rt;\nselect symbol, max(ts) from stock_ticks_cow group by symbol HAVING symbol = 'GOOG';\nselect symbol, max(ts) from stock_ticks_mor_ro group by symbol HAVING symbol = 'GOOG';\nexit;\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4E5F\u53EF\u4EE5\u901A\u8FC7 spark-shell \u8FDB\u884C\u8BBF\u95EE\uFF1A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'docker exec -it adhoc-1 /bin/bash\n\n$SPARK_INSTALL/bin/spark-shell \\\n  --jars /var/scripts/hudi_docker_compose_attached_file/jar/hoodie-hive-sync-bundle.jar \\\n  --master local[2] \\\n  --driver-class-path $HADOOP_CONF_DIR \\\n  --conf spark.sql.hive.convertMetastoreParquet=false \\\n  --deploy-mode client \\\n  --driver-memory 1G \\\n  --executor-memory 3G \\\n  --num-executors 1\n\nspark.sql("show tables").show(100, false)\nspark.sql("select symbol, max(ts) from stock_ticks_cow group by symbol HAVING symbol = \'GOOG\'").show(100, false)\nspark.sql("select `_hoodie_commit_time`, symbol, ts, volume, open, close  from stock_ticks_cow where  symbol = \'GOOG\'").show(100, false)\nspark.sql("select symbol, max(ts) from stock_ticks_mor_ro group by symbol HAVING symbol = \'GOOG\'").show(100, false)\nspark.sql("select symbol, max(ts) from stock_ticks_mor_rt group by symbol HAVING symbol = \'GOOG\'").show(100, false)\nspark.sql("select `_hoodie_commit_time`, symbol, ts, volume, open, close  from stock_ticks_mor_ro where  symbol = \'GOOG\'").show(100, false)\n:q\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u66F4\u591A\u4F7F\u7528\u65B9\u5F0F\u53EF\u53C2\u9605 ",(0,i.jsx)(n.a,{href:"https://hudi.apache.org/docs/docker_demo",children:"Hudi \u5B98\u65B9\u6587\u6863"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Trino\nTrino \u76F8\u5173\u7684 Docker compose \u6587\u4EF6\u5B58\u653E\u5728 docker/thirdparties/docker-compose/trino \u4E0B\u3002\n\u6A21\u7248\u6587\u4EF6\uFF1A"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"gen_env.sh.tpl \uFF1A\u7528\u4E8E\u751F\u6210 HDFS\u76F8\u5173\u7AEF\u53E3\u53F7\uFF0C\u65E0\u9700\u4FEE\u6539\uFF0C\u82E5\u51FA\u73B0\u7AEF\u53E3\u51B2\u7A81\uFF0C\u53EF\u4EE5\u5BF9\u7AEF\u53E3\u53F7\u8FDB\u884C\u4FEE\u6539\u3002"}),"\n",(0,i.jsx)(n.li,{children:"hive.properties.tpl \uFF1A\u7528\u4E8E\u914D\u7F6Etrino catalog \u4FE1\u606F\uFF0C\u65E0\u9700\u4FEE\u6539\u3002"}),"\n",(0,i.jsx)(n.li,{children:"trino_hive.env.tpl \uFF1AHive \u7684\u73AF\u5883\u914D\u7F6E\u4FE1\u606F\uFF0C\u65E0\u9700\u4FEE\u6539\u3002"}),"\n",(0,i.jsx)(n.li,{children:"trino_hive.yaml.tpl \uFF1ADocker compose \u6587\u4EF6\uFF0C\u65E0\u9700\u4FEE\u6539\u3002\n\u542F\u52A8 Trino docker \u540E\uFF0C\u4F1A\u914D\u7F6E\u4E00\u5957 Trino + hive catalog \u73AF\u5883\uFF0C\u6B64\u65F6 Trino \u62E5\u6709\u4E24\u4E2Acatalog"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"hive"}),"\n",(0,i.jsx)(n.li,{children:"tpch\uFF08trino docker \u81EA\u5E26\uFF09"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u66F4\u591A\u4F7F\u7528\u65B9\u5F0F\u53EF\u53C2\u9605 ",(0,i.jsx)(n.a,{href:"https://trino.io/docs/current/installation/containers.html",children:"Trino \u5B98\u65B9\u6587\u6863"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8FD0\u884C\u56DE\u5F52\u6D4B\u8BD5"}),"\n",(0,i.jsxs)(n.p,{children:["\u5916\u8868\u76F8\u5173\u7684\u56DE\u5F52\u6D4B\u8BD5\u9ED8\u8BA4\u662F\u5173\u95ED\u7684\uFF0C\u53EF\u4EE5\u4FEE\u6539 ",(0,i.jsx)(n.code,{children:"regression-test/conf/regression-conf.groovy"})," \u4E2D\u7684\u914D\u7F6E\u6765\u5F00\u542F\uFF0C\u76F8\u5173\u914D\u7F6E\u4E3E\u4F8B\u5982\u4E0B\uFF1A"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enableJdbcTest"}),"\uFF1A\u5F00\u542F jdbc \u5916\u8868\u6D4B\u8BD5\uFF0C\u9700\u8981\u542F\u52A8 MySQL \u548C Postgresql \u7684 container\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mysql_57_port"})," \u548C ",(0,i.jsx)(n.code,{children:"pg_14_port"})," \u5206\u522B\u5BF9\u5E94 MySQL \u548C Postgresql \u7684\u5BF9\u5916\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 3316 \u548C 5442\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enableHiveTest"}),"\uFF1A\u5F00\u542F hive \u5916\u8868\u6D4B\u8BD5\uFF0C\u9700\u8981\u542F\u52A8 hive \u7684 container\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hive2HmsPort"})," \u5BF9\u5E94 hive2 metastore \u7684\u5BF9\u5916\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 9083\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hive2HdfsPort"})," \u5BF9\u5E94 hive2 hdfs namenode \u7684\u5BF9\u5916\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 8020\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enableEsTest"}),"\uFF1A\u5F00\u542F es \u5916\u8868\u6D4B\u8BD5\u3002\u9700\u8981\u542F\u52A8 es \u7684 container\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"es_6_port"}),"\uFF1AES6 \u7684\u7AEF\u53E3\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"es_7_port"}),"\uFF1AES7 \u7684\u7AEF\u53E3\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"es_8_port"}),"\uFF1AES8 \u7684\u7AEF\u53E3\u3002"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return o},a:function(){return l}});var r=s(667294);let i={},t=r.createContext(i);function l(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);