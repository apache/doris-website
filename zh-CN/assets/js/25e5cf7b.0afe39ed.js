"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["493225"],{919344:function(e,n,i){i.r(n),i.d(n,{default:()=>a,frontMatter:()=>c,metadata:()=>r,assets:()=>o,toc:()=>d,contentTitle:()=>t});var r=JSON.parse('{"id":"query-acceleration/optimization-technology-principle/runtime-filter","title":"Runtime Filter","description":"Runtime Filter \u4E3B\u8981\u5206\u4E3A\u4E24\u79CD\uFF0CJoin Runtime Filter \u4E0E TopN Runtime Filter\u3002\u672C\u6587\u5C06\u8BE6\u7EC6\u4ECB\u7ECD\u4E24\u7C7B Runtime Filter \u7684\u5DE5\u4F5C\u539F\u7406\u3001\u4F7F\u7528\u6307\u5357\u4E0E\u4F18\u5316\u65B9\u6CD5\u3002","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/query-acceleration/optimization-technology-principle/runtime-filter.md","sourceDirName":"query-acceleration/optimization-technology-principle","slug":"/query-acceleration/optimization-technology-principle/runtime-filter","permalink":"/zh-CN/docs/dev/query-acceleration/optimization-technology-principle/runtime-filter","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Runtime Filter","language":"zh-CN"},"sidebar":"docs","previous":{"title":"Pipeline \u6267\u884C\u5F15\u64CE","permalink":"/zh-CN/docs/dev/query-acceleration/optimization-technology-principle/pipeline-execution-engine"},"next":{"title":"TOPN \u67E5\u8BE2\u4F18\u5316","permalink":"/zh-CN/docs/dev/query-acceleration/optimization-technology-principle/topn-optimization"}}'),s=i("785893"),l=i("250065");let c={title:"Runtime Filter",language:"zh-CN"},t=void 0,o={},d=[{value:"Join Runtime Filter",id:"join-runtime-filter",level:2},{value:"\u5DE5\u4F5C\u539F\u7406",id:"\u5DE5\u4F5C\u539F\u7406",level:3},{value:"Filter \u7C7B\u578B",id:"filter-\u7C7B\u578B",level:3},{value:"\u67E5\u770B Join Runtime Filter",id:"\u67E5\u770B-join-runtime-filter",level:3},{value:"\u8C03\u4F18",id:"\u8C03\u4F18",level:3},{value:"TopN Runtime Filter",id:"topn-runtime-filter",level:2},{value:"\u5DE5\u4F5C\u539F\u7406",id:"\u5DE5\u4F5C\u539F\u7406-1",level:3},{value:"\u67E5\u770B TopN Runtime Filter",id:"\u67E5\u770B-topn-runtime-filter",level:3},{value:"\u8C03\u4F18",id:"\u8C03\u4F18-1",level:3}];function h(e){let n={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Runtime Filter \u4E3B\u8981\u5206\u4E3A\u4E24\u79CD\uFF0CJoin Runtime Filter \u4E0E TopN Runtime Filter\u3002\u672C\u6587\u5C06\u8BE6\u7EC6\u4ECB\u7ECD\u4E24\u7C7B Runtime Filter \u7684\u5DE5\u4F5C\u539F\u7406\u3001\u4F7F\u7528\u6307\u5357\u4E0E\u4F18\u5316\u65B9\u6CD5\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"join-runtime-filter",children:"Join Runtime Filter"}),"\n",(0,s.jsx)(n.p,{children:"Join Runtime Filter (\u4EE5\u4E0B\u7B80\u79F0 JRF) \u662F\u4E00\u79CD\u4F18\u5316\u6280\u672F\uFF0C\u5B83\u6839\u636E\u8FD0\u884C\u65F6\u6570\u636E\u5728 Join \u8282\u70B9\u901A\u8FC7 Join \u6761\u4EF6\u52A8\u6001\u751F\u6210 Filter\u3002\u6B64\u6280\u672F\u4E0D\u4EC5\u80FD\u964D\u4F4E Join Probe \u7684\u89C4\u6A21\uFF0C\u8FD8\u80FD\u6709\u6548\u51CF\u5C11\u6570\u636E IO \u548C\u7F51\u7EDC\u4F20\u8F93\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"\u5DE5\u4F5C\u539F\u7406",children:"\u5DE5\u4F5C\u539F\u7406"}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4EEC\u4EE5\u4E00\u4E2A\u7C7B\u4F3C TPC-H Schema \u4E0A\u7684 Join \u4E3A\u4F8B\uFF0C\u6765\u8BF4\u660E JRF \u7684\u5DE5\u4F5C\u539F\u7406\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5047\u8BBE\u6570\u636E\u5E93\u4E2D\u6709\u4E24\u5F20\u8868\uFF1A"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u8BA2\u5355\u8868\uFF08orders\uFF09\uFF0C\u5305\u542B 1 \u4EBF\u884C\u6570\u636E\uFF0C\u8BB0\u5F55\u8BA2\u5355\u53F7 (o_orderkey)\u3001\u5BA2\u6237\u7F16\u53F7 (o_custkey) \u4EE5\u53CA\u8BA2\u5355\u7684\u5176\u5B83\u4FE1\u606F\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5BA2\u6237\u8868\uFF08customer\uFF09\uFF0C\u5305\u542B 10 \u4E07\u884C\u6570\u636E\uFF0C\u8BB0\u5F55\u5BA2\u6237\u7F16\u53F7 (c_custkey)\u3001\u5BA2\u6237\u56FD\u7C4D (c_nation) \u4EE5\u53CA\u5BA2\u6237\u7684\u5176\u5B83\u4FE1\u606F\u3002\u8BE5\u8868\u5171\u8BB0\u5F55\u4E86 25 \u4E2A\u56FD\u5BB6\u7684\u5BA2\u6237\uFF0C\u6BCF\u4E2A\u56FD\u5BB6\u7EA6\u6709 4 \u5343\u5BA2\u6237\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u7EDF\u8BA1\u5BA2\u6237\u6765\u81EA\u4E2D\u56FD\u7684\u8BA2\u5355\u6570\u91CF\uFF0C\u67E5\u8BE2\u8BED\u53E5\u5982\u4E0B\uFF1A"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'select count(*)\nfrom orders join customer on o_custkey = c_custkey\nwhere c_nation = "china"\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u6B64\u67E5\u8BE2\u7684\u6267\u884C\u8BA1\u5212\u4E3B\u4F53\u662F\u4E00\u4E2A Join\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Join Runtime Filter",src:i(912182).Z+"",width:"1280",height:"901"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u6CA1\u6709 JRF \u7684\u60C5\u51B5\u4E0B\uFF0CScan \u8282\u70B9\u4F1A\u626B\u63CF orders \u8868\uFF0C\u8BFB\u5165 1 \u4EBF\u884C\u6570\u636E\uFF0CJoin \u8282\u70B9\u5219\u5BF9\u8FD9 1 \u4EBF\u884C\u6570\u636E\u8FDB\u884C Hash Probe\uFF0C\u6700\u540E\u751F\u6210 Join \u7ED3\u679C\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. \u4F18\u5316\u601D\u8DEF"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8FC7\u6EE4\u6761\u4EF6 ",(0,s.jsx)(n.code,{children:'c_nation = "china"'})," \u4F1A\u8FC7\u6EE4\u6389\u6240\u6709\u975E\u4E2D\u56FD\u7684\u5BA2\u6237\uFF0C\u56E0\u6B64\u53C2\u4E0E Join \u7684 customer \u53EA\u662F customer \u8868\u7684\u4E00\u90E8\u5206\uFF08\u7EA6 1/25\uFF09\u3002\u540E\u7EED\u7684 Join \u6761\u4EF6\u4E3A ",(0,s.jsx)(n.code,{children:"o_custkey = c_custkey"}),"\uFF0C\u6240\u4EE5\u6211\u4EEC\u9700\u8981\u5173\u6CE8\u8FC7\u6EE4\u7ED3\u679C\u4E2D ",(0,s.jsx)(n.code,{children:"c_custkey"})," \u5217\u6709\u54EA\u4E9B\u88AB\u9009\u4E2D\u7684 custkey\u3002\u5C06\u8FC7\u6EE4\u540E\u7684 ",(0,s.jsx)(n.code,{children:"c_custkey"})," \u8BB0\u4E3A\u96C6\u5408 A\u3002",(0,s.jsx)(n.strong,{children:"\u5728\u4E0B\u6587\u4E2D\uFF0C\u6211\u4EEC\u7528\u96C6\u5408 A \u4E13\u95E8\u6307\u4EE3\u53C2\u4E0E Join \u7684"})," ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"c_custkey"})})," ",(0,s.jsx)(n.strong,{children:"\u96C6\u5408\u3002"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679C\u5C06\u96C6\u5408 A \u4F5C\u4E3A\u4E00\u4E2A in \u6761\u4EF6\u63A8\u7ED9 orders \u8868\uFF0C\u90A3\u4E48 orders \u8868\u7684 Scan \u8282\u70B9\u5C31\u53EF\u4EE5\u5BF9 orders \u8FDB\u884C\u8FC7\u6EE4\u3002\u8FD9\u5C31\u7C7B\u4F3C\u589E\u52A0\u4E86\u4E00\u4E2A\u8FC7\u6EE4\u6761\u4EF6 ",(0,s.jsx)(n.code,{children:"c_custkey in (c001, c003)"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u57FA\u4E8E\u4EE5\u4E0A\u7684\u4F18\u5316\u601D\u8DEF\uFF0CSQL \u53EF\u4EE5\u4F18\u5316\u4E3A\uFF1A"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'select count(*)\nfrom orders join customer on o_custkey = c_custkey\nwhere c_nation = "china" and o_custkey in (c001, c003)\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u4F18\u5316\u540E\u7684\u6267\u884C\u8BA1\u5212\u5982\u4E0B\u56FE\u6240\u793A\uFF1A"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"join-runtime-filter-2",src:i(130542).Z+"",width:"1280",height:"893"})}),"\n",(0,s.jsx)(n.p,{children:"\u53EF\u4EE5\u770B\u5230\uFF0C\u901A\u8FC7\u589E\u52A0 Orders \u8868\u4E0A\u7684\u8FC7\u6EE4\u6761\u4EF6\uFF0C\u5B9E\u9645\u53C2\u4E0E Join \u7684 Orders \u884C\u6570\u4ECE 1 \u4EBF\u4E0B\u964D\u5230 40 \u4E07\uFF0C\u67E5\u8BE2\u901F\u5EA6\u5F97\u5230\u5927\u5E45\u63D0\u5347\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. \u5B9E\u73B0\u65B9\u6CD5"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4E0A\u8FF0\u4F18\u5316\u6548\u679C\u663E\u8457\uFF0C\u4F46\u4F18\u5316\u5668\u5E76\u4E0D\u77E5\u9053\u5B9E\u9645\u88AB\u9009\u4E2D\u7684 ",(0,s.jsx)(n.code,{children:"c_custkey"}),"\uFF0C\u5373\u96C6\u5408 A\u3002\u56E0\u6B64\uFF0C\u4F18\u5316\u5668\u65E0\u6CD5\u5728\u4F18\u5316\u9636\u6BB5\u9759\u6001\u5206\u6790\u751F\u6210\u4E00\u4E2A\u56FA\u5B9A\u7684 in-predicate \u8FC7\u6EE4\u7B97\u5B50\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u5B9E\u9645\u5E94\u7528\u4E2D\uFF0C\u6211\u4EEC\u4F1A\u5728 Join \u8282\u70B9\u6536\u96C6\u53F3\u4FA7\u6570\u636E\u540E\uFF0C\u8FD0\u884C\u65F6\u751F\u6210\u96C6\u5408 A\uFF0C\u5E76\u5C06\u96C6\u5408 A \u4E0B\u63A8\u7ED9 orders \u8868\u7684 scan \u8282\u70B9\u3002\u6211\u4EEC\u901A\u5E38\u5C06\u8FD9\u4E2A JRF \u8BB0\u4E3A\uFF1A",(0,s.jsx)(n.code,{children:"RF(c_custkey -> [o_custkey])"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"Doris \u662F\u4E00\u4E2A\u5206\u5E03\u5F0F\u6570\u636E\u5E93\uFF0C\u4E3A\u4E86\u6EE1\u8DB3\u5206\u5E03\u5F0F\u573A\u666F\u7684\u9700\u6C42\uFF0CJRF \u8FD8\u9700\u8981\u8FDB\u884C\u4E00\u6B21\u5408\u5E76\u3002\u5047\u8BBE\u4E0A\u8FF0\u4F8B\u5B50\u4E2D\u7684 Join \u662F\u4E00\u4E2A Shuffle Join\uFF0C\u90A3\u4E48\u8FD9\u4E2A Join \u6709\u591A\u4E2A Instance\uFF0C\u6BCF\u4E2A Join \u53EA\u5904\u7406 orders \u548C customer \u8868\u7684\u4E00\u4E2A\u5206\u7247\u3002\u56E0\u6B64\uFF0C\u6BCF\u4E2A Join Instance \u90FD\u53EA\u5F97\u5230\u4E86\u96C6\u5408 A \u7684\u4E00\u90E8\u5206\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u5F53\u524D Doris \u7684\u7248\u672C\u4E2D\uFF0C\u6211\u4EEC\u4F1A\u9009\u51FA\u4E00\u4E2A\u8282\u70B9\u4F5C\u4E3A Runtime Filter Manager\u3002\u6BCF\u4E2A Join Instance \u6839\u636E\u5404\u81EA\u5206\u7247\u4E2D\u7684 ",(0,s.jsx)(n.code,{children:"c_custkey"})," \u751F\u6210 Partial JRF\uFF0C\u5E76\u53D1\u9001\u7ED9 Manager\u3002Manager \u6536\u96C6\u6240\u6709 Partial JRF \u540E\uFF0C\u5408\u5E76\u751F\u6210 Global JRF\uFF0C\u518D\u5C06 Global JRF \u53D1\u9001\u7ED9 orders \u8868\u7684\u76F8\u5173 Scan Instance\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u751F\u6210 Global JRF \u7684\u6D41\u7A0B\u5982\u4E0B\u56FE\u6240\u793A\uFF1A"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Global JRF",src:i(83575).Z+"",width:"1280",height:"836"})}),"\n",(0,s.jsx)(n.h3,{id:"filter-\u7C7B\u578B",children:"Filter \u7C7B\u578B"}),"\n",(0,s.jsx)(n.p,{children:"\u6709\u591A\u79CD\u6570\u636E\u7ED3\u6784\u5747\u53EF\u7528\u4E8E\u5B9E\u73B0 JRF\uFF0C\u4F46\u5B83\u4EEC\u5728\u751F\u6210\u3001\u5408\u5E76\u3001\u4F20\u8F93\u3001\u5E94\u7528\u7B49\u65B9\u9762\u6548\u7387\u5404\u5F02\uFF0C\u56E0\u6B64\u5404\u81EA\u9002\u7528\u4E8E\u4E0D\u540C\u7684\u573A\u666F\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. In Filter"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8FD9\u662F\u5B9E\u73B0 JRF \u7684\u6700\u7B80\u5355\u65B9\u5F0F\u3002\u4EE5\u4E4B\u524D\u7684\u4F8B\u5B50\u4E3A\u4F8B\uFF0C\u4F7F\u7528 In Filter \u65F6\uFF0C\u6267\u884C\u5F15\u64CE\u4F1A\u5728\u5DE6\u8868\u4E0A\u751F\u6210\u8C13\u8BCD ",(0,s.jsx)(n.code,{children:"o_custkey in (...A \u4E2D\u5143\u7D20\u5217\u8868...)"}),"\u3002\u901A\u8FC7\u8FD9\u4E2A In \u8FC7\u6EE4\u6761\u4EF6\uFF0C\u53EF\u4EE5\u5BF9 orders \u8868\u8FDB\u884C\u8FC7\u6EE4\u3002\u5F53\u96C6\u5408 A \u4E2D\u5143\u7D20\u6570\u91CF\u8F83\u5C11\u65F6\uFF0CIn Filter \u7684\u6548\u7387\u8F83\u9AD8\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u7136\u800C\uFF0C\u5F53\u96C6\u5408 A \u4E2D\u5143\u7D20\u6570\u91CF\u8FC7\u5927\u65F6\uFF0C\u4F7F\u7528 In Filter \u4F1A\u5E26\u6765\u6027\u80FD\u95EE\u9898\uFF1A"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u9996\u5148\uFF0C\u751F\u6210 In Filter \u7684\u6210\u672C\u8F83\u9AD8\uFF0C\u5C24\u5176\u662F\u5728\u9700\u8981\u8FDB\u884C JRF \u5408\u5E76\u7684\u60C5\u51B5\u4E0B\u3002\u56E0\u4E3A\u4ECE\u4E0D\u540C\u6570\u636E\u5206\u7247\u5BF9\u5E94\u7684 Join \u8282\u70B9\u4E2D\u6536\u96C6\u7684\u503C\u53EF\u80FD\u4F1A\u6709\u91CD\u590D\uFF0C\u4F8B\u5982\uFF0C\u5982\u679C ",(0,s.jsx)(n.code,{children:"c_custkey"})," \u4E0D\u662F\u8868\u7684\u4E3B\u952E\uFF0C\u90A3\u4E48 ",(0,s.jsx)(n.code,{children:"c001"}),"\u3001",(0,s.jsx)(n.code,{children:"c003"})," \u8FD9\u6837\u7684 ",(0,s.jsx)(n.code,{children:"c_custkey"})," \u53EF\u80FD\u51FA\u73B0\u591A\u6B21\uFF0C\u8FD9\u65F6\u5C31\u9700\u8981\u8FDB\u884C\u53BB\u91CD\u64CD\u4F5C\uFF0C\u800C\u8FD9\u4E2A\u8FC7\u7A0B\u6BD4\u8F83\u8017\u65F6\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5176\u6B21\uFF0C\u5F53\u96C6\u5408 A \u5143\u7D20\u8F83\u591A\u65F6\uFF0CJoin \u8282\u70B9\u4E0E orders \u8868\u7684 Scan \u8282\u70B9\u4E4B\u95F4\u4F20\u8F93\u6570\u636E\u7684\u4EE3\u4EF7\u4E5F\u8F83\u9AD8\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u6700\u540E\uFF0Corders \u8868\u7684 Scan \u8282\u70B9\u6267\u884C In \u8C13\u8BCD\u4E5F\u4F1A\u6D88\u8017\u65F6\u95F4\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u57FA\u4E8E\u4E0A\u8FF0\u8003\u8651\uFF0C\u6211\u4EEC\u5F15\u5165\u4E86 Bloom Filter\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Bloom Filter"})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679C\u5BF9 Bloom Filter \u4E0D\u592A\u4E86\u89E3\uFF0C\u53EF\u4EE5\u5C06\u5176\u7406\u89E3\u4E3A\u4E00\u4E2A\u54C8\u5E0C\u8868\u3002\u7B80\u5355\u6765\u8BF4\uFF0CBloom Filter \u5C31\u662F\u4E00\u7EC4\u53E0\u52A0\u7684\u54C8\u5E0C\u8868\u3002\u4F7F\u7528 Bloom Filter\uFF08\u6216\u54C8\u5E0C\u8868\uFF09\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u5229\u7528\u4E86\u4EE5\u4E0B\u6027\u8D28\uFF1A"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u57FA\u4E8E\u96C6\u5408 A \u751F\u6210\u54C8\u5E0C\u8868 T\uFF0C\u5982\u679C\u4E00\u4E2A\u5143\u7D20",(0,s.jsx)(n.strong,{children:"\u4E0D\u5728"}),"\u54C8\u5E0C\u8868 T \u4E2D\uFF0C\u90A3\u4E48\u53EF\u4EE5\u65AD\u5B9A\u8FD9\u4E2A\u5143\u7D20\u4E5F\u4E0D\u5728\u96C6\u5408 A \u4E2D\u3002\u53CD\u4E4B\uFF0C\u5219\u4E0D\u6210\u7ACB\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u56E0\u6B64\uFF0C\u5982\u679C\u4E00\u4E2A ",(0,s.jsx)(n.code,{children:"o_orderkey"})," \u88AB Bloom Filter \u8FC7\u6EE4\u6389\uFF0C\u90A3\u4E48\u53EF\u4EE5\u65AD\u5B9A\u5728 Join \u7684\u53F3\u4FA7\u6CA1\u6709\u76F8\u7B49\u7684 ",(0,s.jsx)(n.code,{children:"c_custkey"}),"\u3002\u4F46\u7531\u4E8E\u54C8\u5E0C\u78B0\u649E\uFF0C\u4E00\u4E9B ",(0,s.jsx)(n.code,{children:"o_custkey"})," \u5373\u4F7F\u6CA1\u6709\u76F8\u7B49\u7684 ",(0,s.jsx)(n.code,{children:"c_custkey"}),"\uFF0C\u4E5F\u53EF\u80FD\u901A\u8FC7 Bloom Filter\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6240\u4EE5\uFF0C\u867D\u7136 Bloom Filter \u4E0D\u80FD\u5B9E\u73B0\u7CBE\u51C6\u8FC7\u6EE4\uFF0C\u4F46\u4ECD\u7136\u80FD\u8FBE\u5230\u4E00\u5B9A\u7684\u8FC7\u6EE4\u6548\u679C\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u54C8\u5E0C\u8868\u7684\u6876\u6570\u91CF\u51B3\u5B9A\u4E86\u8FC7\u6EE4\u7684\u51C6\u786E\u7387\u3002\u6876\u6570\u91CF\u8D8A\u5927\uFF0CFilter \u7684\u5927\u5C0F\u8D8A\u5927\uFF0C\u51C6\u786E\u6027\u8D8A\u9AD8\uFF0C\u4F46\u751F\u6210\u3001\u4F20\u8F93\u3001\u4F7F\u7528\u7684\u8BA1\u7B97\u4EE3\u4EF7\u4E5F\u8D8A\u5927\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u56E0\u6B64\uFF0CBloom Filter \u7684\u5927\u5C0F\u4E5F\u9700\u8981\u5728\u8FC7\u6EE4\u6548\u679C\u548C\u4F7F\u7528\u4EE3\u4EF7\u4E4B\u95F4\u53D6\u5F97\u5E73\u8861\u3002\u57FA\u4E8E\u6B64\uFF0C\u6211\u4EEC\u8BBE\u7F6E\u4E86\u4E00\u7EC4\u53EF\u914D\u53C2\u6570\u6765\u7EA6\u675F Bloom Filter \u7684\u6700\u5927\u548C\u6700\u5C0F\u503C\uFF0C\u5206\u522B\u662F ",(0,s.jsx)(n.code,{children:"RUNTIME_BLOOM_FILTER_MIN_SIZE"})," \u548C ",(0,s.jsx)(n.code,{children:"RUNTIME_BLOOM_FILTER_MAX_SIZE"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. Min/Max Filter"})}),"\n",(0,s.jsx)(n.p,{children:"\u9664\u4E86 Bloom Filter \u5916\uFF0C\u8FD8\u6709 Min-Max Filter \u53EF\u7528\u4E8E\u8FDB\u884C\u6A21\u7CCA\u8FC7\u6EE4\u3002\u5982\u679C\u6570\u636E\u5217\u662F\u6709\u5E8F\u7684\uFF0C\u90A3\u4E48 Min-Max Filter \u4F1A\u6709\u5F88\u597D\u7684\u8FC7\u6EE4\u6548\u679C\u3002\u6B64\u5916\uFF0C\u751F\u6210\u3001\u5408\u5E76\u3001\u4F7F\u7528 Min-Max Filter \u7684\u4EE3\u4EF7\u4E5F\u8FDC\u4F4E\u4E8E In Filter \u548C Bloom Filter\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5BF9\u4E8E\u975E\u7B49\u503C\u7684 Join\uFF0CIn Filter \u548C Bloom Filter \u90FD\u65E0\u6CD5\u5DE5\u4F5C\uFF0C\u4F46 Min-Max Filter \u4ECD\u7136\u53EF\u4EE5\u7EE7\u7EED\u53D1\u6325\u4F5C\u7528\u3002\u5047\u8BBE\u6211\u4EEC\u5C06\u4E0A\u4F8B\u4E2D\u7684\u67E5\u8BE2\u4FEE\u6539\u4E3A\uFF1A"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'select count(*)\nfrom orders join customer on o_custkey > c_custkey\nwhere c_name = "China"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u90A3\u4E48\u53EF\u4EE5\u9009\u51FA\u8FC7\u6EE4\u540E\u6700\u5927\u7684 ",(0,s.jsx)(n.code,{children:"c_custkey"}),"\uFF0C\u8BB0\u4E3A n\uFF0C\u5E76\u5C06 n \u4F20\u7ED9 orders \u8868\u7684 scan \u8282\u70B9\u3002scan \u8282\u70B9\u5219\u4F1A\u53EA\u8F93\u51FA ",(0,s.jsx)(n.code,{children:"o_custkey > n"})," \u7684\u884C\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u67E5\u770B-join-runtime-filter",children:"\u67E5\u770B Join Runtime Filter"}),"\n",(0,s.jsxs)(n.p,{children:["\u67E5\u770B\u4E00\u4E2A Query \u4E0A\u751F\u6210\u4E86\u54EA\u4E9B JRF\uFF0C\u53EF\u4EE5\u901A\u8FC7 ",(0,s.jsx)(n.code,{children:"explain"})," / ",(0,s.jsx)(n.code,{children:"explain shape plan"})," / ",(0,s.jsx)(n.code,{children:"explain physical plan"})," \u547D\u4EE4\u6765\u67E5\u770B\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4EEC\u4EE5 TPC-H Schema \u4E3A\u4F8B\uFF0C\u8BE6\u7EC6\u8BF4\u660E\u901A\u8FC7\u8FD9\u4E09\u4E2A\u547D\u4EE4\u5982\u4F55\u67E5\u770B JRF\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"select count(*) from orders join customer on o_custkey=c_custkey;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. Explain"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u4F20\u7EDF Explain \u6587\u672C\u4E2D\uFF0CJRF\uFF08Join Reference File\uFF09\u7684\u4FE1\u606F\u5206\u5E03\u901A\u5E38\u51FA\u73B0\u5728 Join \u8282\u70B9\u548C Scan \u8282\u70B9\u4E2D\uFF0C\u5177\u4F53\u5C55\u793A\u5982\u4E0B\u56FE\u6240\u793A\uFF1A"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"4: VHASH JOIN(258)  \n| join op: INNER JOIN(PARTITIONED)[]  \n|  equal join conjunct: (o_custkey[#10] = c_custkey[#0])  \n|  runtime filters: RF000[bloom] <- c_custkey[#0] (150000000/134217728/16777216)  \n|  cardinality=1,500,000,000  \n|  vec output tuple id: 3  \n|  output tuple id: 3  \n|  vIntermediate tuple ids: 2  \n|  hash output slot ids: 10  \n|  final projections: o_custkey[#17]  \n|  final project output tuple id: 3  \n|  distribute expr lists: o_custkey[#10]\n|  distribute expr lists: c_custkey[#0]  \n|  \n|---1: VEXCHANGE  \n|      offset: 0  \n|      distribute expr lists: c_custkey[#0]   \n3: VEXCHANGE  \n|  offset: 0  \n|  distribute expr lists:  \n  \nPLAN FRAGMENT 2  \n| PARTITION: HASH_PARTITIONED: o_orderkey[#8]  \n| HAS_COLO_PLAN_NODE: false  \n| STREAM DATA SINK  \n|   EXCHANGE ID: 03  \n|   HASH_PARTITIONED: o_custkey[#10]  \n  \n2: VOlapScanNode(242)  \n|  TABLE: regression_test_nereids_tpch_shape_sf1000_p0.orders(orders)  \n|  PREAGGREGATION: ON  \n|  runtime filters: RF000[bloom] -> o_custkey[#10]  \n|  partitions=1/1 (orders)  \n|  tablets=96/96, tabletList=54990,54992,54994 ...  \n|  cardinality=0, avgRowSize=0.0, numNodes=1  \n|  pushAggOp=NONE\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Join \u7AEF\uFF1A",(0,s.jsx)(n.code,{children:"runtime filters: RF000[bloom] <- c_custkey[#0] (150000000/134217728/16777216)"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u8FD9\u8868\u793A\u751F\u6210\u4E86\u4E00\u4E2A Bloom Filter\uFF0C\u7F16\u53F7 000\uFF0C\u5B83\u4EE5 ",(0,s.jsx)(n.code,{children:"c_custkey"})," \u5B57\u6BB5\u4F5C\u4E3A\u8F93\u5165\u751F\u6210 JRF\u3002\u540E\u9762\u7684\u4E09\u4E2A\u6570\u5B57\u548C Bloom Filter Size \u8BA1\u7B97\u76F8\u5173\uFF0C\u6211\u4EEC\u53EF\u4EE5\u6682\u65F6\u5FFD\u7565\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Scan \u7AEF\uFF1A",(0,s.jsx)(n.code,{children:"runtime filters: RF000[bloom] -> o_custkey[#10]"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u8FD9\u8868\u793A 000 \u53F7 JRF \u5C06\u4F5C\u7528\u5728 orders \u8868\u7684 Scan \u8282\u70B9\u4E0A\uFF0C\u6211\u4EEC\u7528 JRF \u5BF9 ",(0,s.jsx)(n.code,{children:"o_custkey"})," \u5B57\u6BB5\u8FDB\u884C\u8FC7\u6EE4\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Explain Shape Plan"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728 Explain Plan \u7CFB\u5217\u4E2D\uFF0C\u6211\u4EEC\u4EE5 Shape Plan \u4E3A\u4F8B\u8BF4\u660E\u5982\u4F55\u67E5\u770B JRF\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"mysql> explain shape plan select count(*) from orders join customer on o_custkey=c_custkey where c_nationkey=5;  \n+--------------------------------------------------------------------------------------------------------------------------+\nExplain String(Nereids Planner)                                                                                            \uFF5C\n+--------------------------------------------------------------------------------------------------------------------------+\nPhysicalResultSink                                                                                                         \uFF5C  \n--hashAgg[GLOBAL]                                                                                                          \uFF5C  \n----PhysicalDistribute[DistributionSpecGather]                                                                             \uFF5C   \n------hashAgg[LOCAL]                                                                                                       \uFF5C \n--------PhysicalProject                                                                                                    \uFF5C\n----------hashJoin[INNER_JOIN shuffle]                                                                                     \uFF5C\n------------hashCondition=((orders.o_custkey=customer.c_custkey)) otherCondition=() buildRFs:RF0 c_custkey->[o_custkey]    \uFF5C  \n--------------PhysicalProject                                                                                              \uFF5C  \n----------------Physical0lapScan[orders] apply RFs: RF0                                                                    \uFF5C\n--------------PhysicalProject                                                                                              \uFF5C \n----------------filter((customer.c_nationkey=5))                                                                           \uFF5C \n------------------Physical0lapScan[customer]                                                                               \uFF5C\n+--------------------------------------------------------------------------------------------------------------------------+\n11 rows in set (0.02 sec)\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u4E0A\u56FE\u6240\u793A\uFF1A"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Join \u7AEF\uFF1A",(0,s.jsx)(n.code,{children:"build RFs: RF0 c_custkey -> [o_custkey] "}),"\u8868\u793A\u6211\u4EEC\u4EE5 ",(0,s.jsx)(n.code,{children:"c_custkey"})," \u5217\u7684\u6570\u636E\u4F5C\u4E3A\u8F93\u5165\uFF0C\u751F\u6210\u4E00\u4E2A\u4F5C\u7528\u5230 ",(0,s.jsx)(n.code,{children:"o_custkey"})," \u7684 JRF\uFF0C\u7F16\u53F7 0\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["scan \u7AEF\uFF1A",(0,s.jsx)(n.code,{children:"PhysicalOlapScan[orders] apply RFs"}),"\uFF1ARF0 \u8868\u793A orders \u8868\u88AB RF0 \u8FC7\u6EE4\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. Profile"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u5B9E\u9645\u6267\u884C\u4E2D\uFF0CBE \u4F1A\u5C06 JRF \u7684\u4F7F\u7528\u60C5\u51B5\u8F93\u51FA\u5230 Profile\uFF08\u9700\u8981 ",(0,s.jsx)(n.code,{children:"set enable_profile=true"}),"\uFF09\u3002\u6211\u4EEC\u4ECD\u7136\u4EE5\u4E0A\u9762\u7684 SQL \u4E3A\u4F8B\uFF0C\u5728 Profile \u4E2D\u67E5\u770B JRF \u6267\u884C\u7684\u5B9E\u9645\u60C5\u51B5\u3002"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Join \u7AEF"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"HASH_JOIN_SINK_OPERATOR  (id=3  ,  nereids_id=367):(ExecTime:  703.905us)\n    -  JoinType:  INNER_JOIN\n    \u3002\u3002\u3002\n    -  BuildRows:  617\n    \u3002\u3002\u3002\n    -  RuntimeFilterComputeTime:  70.741us\n    -  RuntimeFilterInitTime:  10.882us\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u8FD9\u662F Join \u7684 Build \u4FA7 Profile\u3002\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u751F\u6210 JRF \u8017\u65F6 70.741us\uFF0CJRF \u6709 617 \u884C\u6570\u636E\u4F5C\u4E3A\u8F93\u5165\u3002JRF \u7684 Size \u548C\u7C7B\u578B\u7531 Scan \u7AEF\u5C55\u793A\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Scan \u7AEF"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"OLAP_SCAN_OPERATOR  (id=2.  nereids_id=351.  table  name  =  orders(orders)):(ExecTime:  13.32ms)\n              -  RuntimeFilters:  :  RuntimeFilter:  (id  =  0,  type  =  bloomfilter,  need_local_merge:  false,  is_broadcast:  true,  build_bf_cardinality:  false,  \n              \u3002\u3002\u3002\n              -  RuntimeFilterInfo:  \n                  -  filter  id  =  0  filtered:  714.761K  (714761)\n                  -  filter  id  =  0  input:  747.862K  (747862)\n              \u3002\u3002\u3002\n              -  WaitForRuntimeFilter:  6.317ms\n            RuntimeFilter:  (id  =  0,  type  =  bloomfilter):\n                  -  Info:  [IsPushDown  =  true,  RuntimeFilterState  =  READY,  HasRemoteTarget  =  false,  HasLocalTarget  =  true,  Ignored  =  false]\n                  -  RealRuntimeFilterType:  bloomfilter\n                  -  BloomFilterSize:  1024\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u8FD9\u4E2A\u90E8\u5206\uFF0C\u6211\u4EEC\u9700\u8981\u5173\u6CE8\u4EE5\u4E0B\u51E0\u70B9\u4FE1\u606F\uFF1A"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u7B2C 5/6 \u884C\uFF0C\u663E\u793A\u8FD9\u4E2A JRF \u7684\u8F93\u5165\u548C\u8FC7\u6EE4\u6389\u7684\u884C\u6570\u3002\u5982\u679C Filtered \u884C\u6570\u8D8A\u5927\uFF0C\u90A3\u4E48\u8FD9\u4E2A JRF \u7684\u6548\u679C\u8D8A\u597D\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u7B2C 10 \u884C\uFF0C",(0,s.jsx)(n.code,{children:"IsPushDown = true"}),"\uFF0C\u8868\u793A JRF \u8BA1\u7B97\u5DF2\u7ECF\u4E0B\u63A8\u5230\u5B58\u50A8\u5C42\u3002\u5982\u679C\u4E0B\u63A8\u5230\u5B58\u50A8\u5C42\uFF0C\u90A3\u4E48\u6709\u5229\u4E8E\u5B58\u50A8\u5C42\u5B9E\u73B0\u5EF6\u8FDF\u7269\u5316\uFF0C\u53EF\u4EE5\u51CF\u5C11 IO\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u7B2C 10 \u884C\uFF0C",(0,s.jsx)(n.code,{children:"RuntimeFilterState = READY"}),"\uFF0C\u8868\u793A Scan \u8282\u70B9\u662F\u5426\u5E94\u7528\u4E86 JRF\u3002\u56E0\u4E3A JRF \u91C7\u7528 Try-best \u673A\u5236\uFF0C\u5982\u679C JRF \u751F\u6210\u9700\u8981\u5F88\u957F\u65F6\u95F4\uFF0C\u90A3\u4E48 Scan \u8282\u70B9\u5728\u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\u540E\u5F00\u59CB\u626B\u63CF\u6570\u636E\uFF0C\u8FD9\u6837\u8F93\u51FA\u7684\u6570\u636E\u53EF\u80FD\u6CA1\u6709\u7ECF\u8FC7 JRF \u7684\u8FC7\u6EE4\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u7B2C 12 \u884C\uFF0C",(0,s.jsx)(n.code,{children:"BloomFilterSize: 1024"}),"\uFF0C\u8FD9\u662F\u4E00\u4E2A Bloom Filter\uFF0C\u5B83\u7684 size \u662F 1024 \u5B57\u8282\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u8C03\u4F18",children:"\u8C03\u4F18"}),"\n",(0,s.jsx)(n.p,{children:"\u5173\u4E8E Join Runtime Filter \u8C03\u4F18\uFF0C\u5728\u7EDD\u5927\u591A\u6570\u60C5\u51B5\u4E0B\u529F\u80FD\u4E3A\u81EA\u9002\u5E94\uFF0C\u7528\u6237\u4E0D\u9700\u8981\u624B\u52A8\u8C03\u4F18\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. \u5F00\u5173 JRF"})}),"\n",(0,s.jsxs)(n.p,{children:["Session \u53D8\u91CF ",(0,s.jsx)(n.code,{children:"runtime_filter_mode"})," \u53EF\u4EE5\u63A7\u5236\u662F\u5426\u5F00\u542F JRF\u3002"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u6253\u5F00 JRF\uFF1A",(0,s.jsx)(n.code,{children:"set runtime_filter_mode = GLOBAL"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u5173\u95ED JRF\uFF1A",(0,s.jsx)(n.code,{children:"set runtime_filter_mode = OFF"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. \u8BBE\u5B9A JRF Type"})}),"\n",(0,s.jsxs)(n.p,{children:["Session \u53D8\u91CF ",(0,s.jsx)(n.code,{children:"runtime_filter_type"})," \u53EF\u4EE5\u63A7\u5236 JRF \u7684\u7C7B\u578B\uFF0C\u5305\u62EC\uFF1A"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"IN(1)"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"BLOOM(2)"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"MIN_MAX(4)"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"IN_OR_BLOOM(8)"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"IN_OR_BLOOM"})," Filter \u53EF\u4EE5\u8BA9 BE \u6839\u636E\u5B9E\u9645\u6570\u636E\u884C\u6570\u81EA\u9002\u5E94\u9009\u62E9\u751F\u6210 ",(0,s.jsx)(n.code,{children:"IN"})," Filter \u8FD8\u662F ",(0,s.jsx)(n.code,{children:"BLOOM"})," Filter\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["JRF type \u53EF\u4EE5\u53E0\u52A0\uFF0C\u5373\u6839\u636E\u4E00\u4E2A Join \u6761\u4EF6\u751F\u6210\u591A\u4E2A\u7C7B\u578B\u7684 JRF\u3002\u62EC\u53F7\u4E2D\u7684\u6574\u6570\u8868\u793A Runtime Filter Type \u7684\u679A\u4E3E\u503C\u3002\u5982\u679C\u5E0C\u671B\u751F\u6210\u591A\u4E2A Type \u7684 JRF\uFF0C\u90A3\u4E48\u5C06 ",(0,s.jsx)(n.code,{children:"runtime_filter_type"})," \u8BBE\u7F6E\u4E3A\u5BF9\u5E94\u679A\u4E3E\u503C\u4E4B\u548C\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4F8B\u5982\uFF0C",(0,s.jsx)(n.code,{children:"set runtime_filter_type = 6"}),"\uFF0C\u90A3\u4E48\u5C06\u540C\u65F6\u4E3A\u6BCF\u4E2A Join \u6761\u4EF6\u751F\u6210 ",(0,s.jsx)(n.code,{children:"BLOOM"})," Filter \u548C ",(0,s.jsx)(n.code,{children:"MIN_MAX"})," Filter\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u518D\u6BD4\u5982\uFF0C\u5728 2.1 \u7248\u672C\u4E2D\uFF0C",(0,s.jsx)(n.code,{children:"runtime_filter_type"})," \u7684\u9ED8\u8BA4\u503C\u662F 12\uFF0C\u5373\u540C\u65F6\u751F\u6210 ",(0,s.jsx)(n.code,{children:"MIN_MAX"})," Filter \u548C ",(0,s.jsx)(n.code,{children:"IN_OR_BLOOM"}),"Filter\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. \u8BBE\u5B9A\u7B49\u5F85\u65F6\u95F4"})}),"\n",(0,s.jsxs)(n.p,{children:["\u524D\u9762\u63D0\u5230 JRF \u4F7F\u7528\u7684\u662F Try-best \u673A\u5236\uFF0CScan \u8282\u70B9\u542F\u52A8\u524D\u4F1A\u7B49\u5F85 JRF\u3002Doris \u7CFB\u7EDF\u6839\u636E\u8FD0\u884C\u65F6\u72B6\u6001\u8BA1\u7B97\u7B49\u5F85\u65F6\u95F4\u3002\u4F46\u5728\u4E00\u4E9B\u7279\u6B8A\u60C5\u51B5\u4E0B\uFF0C\u53EF\u80FD\u7B49\u5F85\u65F6\u95F4\u4E0D\u591F\uFF0C\u5BFC\u81F4 JRF \u6CA1\u6709\u751F\u6548\uFF0C\u90A3\u4E48 Scan \u8282\u70B9\u7684\u8F93\u51FA\u6570\u636E\u884C\u6570\u4F1A\u6BD4\u9884\u671F\u591A\u3002\u524D\u9762\u6211\u4EEC\u5DF2\u7ECF\u5728 Profile \u90E8\u5206\u4ECB\u7ECD\u4E86\u5982\u4F55\u5224\u65AD\u662F\u5426\u7B49\u5230\u4E86 JRF\u3002\u5982\u679C Profile \u4E2D Scan \u8282\u70B9 ",(0,s.jsx)(n.code,{children:"RuntimeFilterState = false"}),"\uFF0C\u90A3\u4E48\u7528\u6237\u53EF\u4EE5\u624B\u52A8\u8BBE\u7F6E\u4E00\u4E2A\u66F4\u957F\u7684\u7B49\u5F85\u65F6\u95F4\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["Session \u53D8\u91CF ",(0,s.jsx)(n.code,{children:"runtime_filter_wait_time_ms"})," \u53EF\u4EE5\u63A7\u5236 Scan \u8282\u70B9\u7B49\u5F85 JRF \u7684\u65F6\u95F4\u3002\u9ED8\u8BA4\u503C\u662F 1000 \u6BEB\u79D2\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"4. \u88C1\u526A JRF"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\uFF0CJRF \u53EF\u80FD\u6CA1\u6709\u8FC7\u6EE4\u6027\u3002\u6BD4\u5982 ",(0,s.jsx)(n.code,{children:"orders"})," \u8868\u548C ",(0,s.jsx)(n.code,{children:"customer"})," \u8868\u5B58\u5728\u4E3B\u5916\u952E\u5173\u7CFB\uFF0C\u4F46 ",(0,s.jsx)(n.code,{children:"customer"})," \u8868\u4E0A\u6CA1\u6709\u8FC7\u6EE4\u6761\u4EF6\uFF0C\u90A3\u4E48 JRF \u7684\u8F93\u5165\u662F\u5168\u4F53 ",(0,s.jsx)(n.code,{children:"custkey"}),"\uFF0C\u90A3\u4E48 ",(0,s.jsx)(n.code,{children:"orders"})," \u8868\u4E2D\u7684\u6240\u6709\u884C\u90FD\u80FD\u901A\u8FC7 JRF \u8FC7\u6EE4\u3002\u4F18\u5316\u5668\u4F1A\u6839\u636E\u5217\u7EDF\u8BA1\u4FE1\u606F\u5224\u65AD JRF \u7684\u6709\u6548\u6027\u8FDB\u884C\u88C1\u526A\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["Session \u53D8\u91CF ",(0,s.jsx)(n.code,{children:"enable_runtime_filter_prune = true/false"})," \u53EF\u4EE5\u63A7\u5236\u662F\u5426\u8FDB\u884C\u88C1\u526A\u3002\u9ED8\u8BA4\u503C\u4E3A ",(0,s.jsx)(n.code,{children:"true"}),"\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"topn-runtime-filter",children:"TopN Runtime Filter"}),"\n",(0,s.jsx)(n.h3,{id:"\u5DE5\u4F5C\u539F\u7406-1",children:"\u5DE5\u4F5C\u539F\u7406"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728 Doris \u4E2D\uFF0C\u6570\u636E\u662F\u4EE5\u5206\u5757\u6D41\u5F0F\u7684\u65B9\u5F0F\u8FDB\u884C\u5904\u7406\u7684\u3002\u56E0\u6B64\uFF0C\u5F53 SQL \u8BED\u53E5\u4E2D\u5305\u542B ",(0,s.jsx)(n.code,{children:"topN"})," \u7B97\u5B50\u65F6\uFF0CDoris \u5E76\u4E0D\u4F1A\u8BA1\u7B97\u6240\u6709\u7ED3\u679C\uFF0C\u800C\u662F\u4F1A\u751F\u6210\u4E00\u4E2A\u52A8\u6001\u7684 Filter \u6765\u63D0\u524D\u5BF9\u6570\u636E\u8FDB\u884C\u8FC7\u6EE4\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u4EE5\u4E0B\u9762 SQL \u8BED\u53E5\u4E3E\u4F8B\uFF1A"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"select o_orderkey from orders order by o_orderdate limit 5;\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6B64 SQL \u8BED\u53E5\u7684\u6267\u884C\u8BA1\u5212\u5982\u4E0B\u56FE\u6240\u793A\uFF1A"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"mysql> explain select o_orderkey from orders order by o_orderdate limit 5;\n+-----------------------------------------------------+\n| Explain String(Nereids Planner)                     |\n+-----------------------------------------------------+\n| PLAN FRAGMENT 0                                     |\n|   OUTPUT EXPRS:                                     |\n|     o_orderkey[#11]                                 |\n|   PARTITION: UNPARTITIONED                          |\n|                                                     |\n|   HAS_COLO_PLAN_NODE: false                         |\n|                                                     |\n|   VRESULT SINK                                      |\n|      MYSQL_PROTOCAL                                 |\n|                                                     |\n|   2:VMERGING-EXCHANGE                               |\n|      offset: 0                                      |\n|      limit: 5                                       |\n|      final projections: o_orderkey[#9]              |\n|      final project output tuple id: 2               |\n|      distribute expr lists:                         |\n|                                                     |\n| PLAN FRAGMENT 1                                     |\n|                                                     |\n|   PARTITION: HASH_PARTITIONED: O_ORDERKEY[#0]       |\n|                                                     |\n|   HAS_COLO_PLAN_NODE: false                         |\n|                                                     |\n|   STREAM DATA SINK                                  |\n|     EXCHANGE ID: 02                                 |\n|     UNPARTITIONED                                   |\n|                                                     |\n|   1:VTOP-N(119)                                     |\n|   |  order by: o_orderdate[#10] ASC                 |\n|   |  TOPN OPT                                       |\n|   |  offset: 0                                      |\n|   |  limit: 5                                       |\n|   |  distribute expr lists: O_ORDERKEY[#0]          |\n|   |                                                 |\n|   0:VOlapScanNode(113)                              |\n|      TABLE: tpch.orders(orders), PREAGGREGATION: ON |\n|      TOPN OPT:1                                     |\n|      partitions=1/1 (orders)                        |\n|      tablets=3/3, tabletList=135112,135114,135116   |\n|      cardinality=150000, avgRowSize=0.0, numNodes=1 |\n|      pushAggOp=NONE                                 |\n+-----------------------------------------------------+\n41 rows in set (0.06 sec)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u6CA1\u6709 ",(0,s.jsx)(n.code,{children:"topn filter"})," \u7684\u60C5\u51B5\u4E0B\uFF0Cscan \u8282\u70B9\u4F1A\u4F9D\u6B21\u8BFB\u5165 ",(0,s.jsx)(n.code,{children:"orders"})," \u8868\u7684\u6BCF\u4E2A\u6570\u636E\u5757\uFF0C\u5E76\u5C06\u8FD9\u4E9B\u6570\u636E\u5757\u4F20\u9012\u7ED9 TopN \u8282\u70B9\u3002TopN \u8282\u70B9\u901A\u8FC7\u5806\u6392\u5E8F\u7EF4\u62A4\u7740\u5F53\u524D\u5DF2\u626B\u63CF\u6570\u636E ",(0,s.jsx)(n.code,{children:"orders"})," \u8868\u4E2D\u6392\u540D\u524D 5 \u884C\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u7531\u4E8E\u4E00\u4E2A\u6570\u636E Block \u5927\u7EA6\u5305\u542B 1024 \u884C\u6570\u636E\uFF0C\u56E0\u6B64\u5728 TopN \u5904\u7406\u4E86\u7B2C\u4E00\u4E2A\u6570\u636E\u5757\u540E\uFF0C\u5C31\u80FD\u627E\u5230\u8BE5\u6570\u636E\u5757\u4E2D\u6392\u540D\u7B2C 5 \u7684\u884C\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u5047\u8BBE\u8FD9\u4E2A ",(0,s.jsx)(n.code,{children:"o_orderdate"})," \u662F ",(0,s.jsx)(n.code,{children:"1995-01-01"}),"\uFF0C\u90A3\u4E48 scan \u8282\u70B9\u5728\u8F93\u51FA\u7B2C\u4E8C\u4E2A\u6570\u636E\u5757\u65F6\uFF0C\u5C31\u53EF\u4EE5\u4F7F\u7528 ",(0,s.jsx)(n.code,{children:"1995-01-01"})," \u4F5C\u4E3A\u8FC7\u6EE4\u6761\u4EF6\uFF0C",(0,s.jsx)(n.code,{children:"o_orderdate"})," \u5927\u4E8E ",(0,s.jsx)(n.code,{children:"1995-01-01"})," \u7684\u884C\u5219\u4E0D\u9700\u8981\u518D\u53D1\u9001\u7ED9 TopN \u8282\u70B9\u8FDB\u884C\u8BA1\u7B97\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u8FD9\u4E2A\u9608\u503C\u4F1A\u8FDB\u884C\u52A8\u6001\u66F4\u65B0\uFF0C\u4F8B\u5982\uFF0CTopN \u5728\u5904\u7406\u7B2C\u4E8C\u4E2A\u7ECF\u8FC7\u6B64\u9608\u503C\u8FC7\u6EE4\u7684\u6570\u636E\u5757\u65F6\uFF0C\u5982\u679C\u53D1\u73B0\u4E86\u66F4\u5C0F\u7684 ",(0,s.jsx)(n.code,{children:"o_orderdate"}),"\uFF0C\u90A3\u4E48 TopN \u4F1A\u5C06\u9608\u503C\u66F4\u65B0\u4E3A\u7B2C\u4E00\u4E2A\u548C\u7B2C\u4E8C\u4E2A\u6570\u636E\u5757\u4E2D\u6392\u540D\u7B2C 5 \u7684 ",(0,s.jsx)(n.code,{children:"o_orderdate"}),"\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u67E5\u770B-topn-runtime-filter",children:"\u67E5\u770B TopN Runtime Filter"}),"\n",(0,s.jsx)(n.p,{children:"\u901A\u8FC7 Explain \u547D\u4EE4\uFF0C\u6211\u4EEC\u53EF\u4EE5\u67E5\u770B\u4F18\u5316\u5668\u89C4\u5212\u7684 TopN runtime filter\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"1:VTOP-N(119)\n| order by: o_orderdate[#10] ASC  \n| TOPN OPT  \n| offset: 0\n| limit: 5  \n| distribute expr lists: O_ORDERKEY[#0]  \n|\n \n0:VLapScanNode[113]  \n    TABLE: regression_test_nereids_tpch_p0.(orders), PREAGGREGATION: ON  \n    TOPN OPT: 1  \n    partitions=1/1 (orders)  \n    tablets=3/3, tabletList=135112,135114,135116  \n    cardinality=150000, avgRowSize=0.0, numNodes=1  \n    pushAggOp: NONE\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u4E0A\u8FF0\u4F8B\u5B50\u6240\u793A\uFF1A"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["TopN \u8282\u70B9\u4E0A\u4F1A\u663E\u793A ",(0,s.jsx)(n.code,{children:"TOPN OPT"}),"\uFF0C\u8868\u793A\u8FD9\u4E2A TopN \u8282\u70B9\u4F1A\u4EA7\u751F\u4E00\u4E2A TopN Runtime Filter\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Scan \u8282\u70B9\u4E0A\u4F1A\u6807\u6CE8\u5B83\u4F7F\u7528\u7684 TopN Runtime Filter \u662F\u7531\u54EA\u4E2A TopN \u8282\u70B9\u4EA7\u751F\u7684\u3002\u6BD4\u5982\uFF0C\u4F8B\u5B50\u4E2D 11 \u884C\uFF0C\u8868\u793A ",(0,s.jsx)(n.code,{children:"orders"})," \u8868\u7684 Scan \u8282\u70B9\u5C06\u4F7F\u7528\u7F16\u53F7\u4E3A 1 \u7684 TopN \u8282\u70B9\u751F\u6210\u7684 Runtime Filter\uFF0C\u56E0\u6B64\u5728 Plan \u4E2D\u663E\u793A\u4E3A ",(0,s.jsx)(n.code,{children:"TOPN OPT: 1"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4F5C\u4E3A\u4E00\u4E2A\u5206\u5E03\u5F0F\u6570\u636E\u5E93\uFF0CDoris \u8FD8\u9700\u8981\u8003\u8651 TopN \u8282\u70B9\u548C Scan \u8282\u70B9\u5B9E\u9645\u8FD0\u884C\u7684\u7269\u7406\u673A\u5668\u3002\u56E0\u4E3A\u8DE8 BE \u901A\u4FE1\u7684\u4EE3\u4EF7\u6BD4\u8F83\u9AD8\uFF0C\u6240\u4EE5 BE \u4F1A",(0,s.jsx)(n.strong,{children:"\u81EA\u9002\u5E94\u5730"}),"\u51B3\u5B9A\u662F\u5426\u4F7F\u7528 TopN Runtime Filter\uFF0C\u4EE5\u53CA\u4F7F\u7528\u7684\u8303\u56F4\u3002\u5F53\u524D\uFF0C\u6211\u4EEC\u5B9E\u73B0\u4E86 BE \u7EA7\u522B\u7684 TopN Runtime Filter\uFF0C\u5373 TopN \u548C Scan \u5728\u540C\u4E00\u4E2A BE \u91CC\u3002\u8FD9\u662F\u56E0\u4E3A TopN Runtime Filter \u9608\u503C\u7684\u66F4\u65B0\u53EA\u9700\u8981\u7EBF\u7A0B\u95F4\u901A\u4FE1\uFF0C\u4EE3\u4EF7\u6BD4\u8F83\u4F4E\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u8C03\u4F18-1",children:"\u8C03\u4F18"}),"\n",(0,s.jsxs)(n.p,{children:["Session \u53D8\u91CF ",(0,s.jsx)(n.code,{children:"topn_filter_ratio"})," \u53EF\u4EE5\u63A7\u5236\u662F\u5426\u751F\u6210 TopN Runtime Filter\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679C SQL \u4E2D ",(0,s.jsx)(n.code,{children:"limit"})," \u7684\u6570\u91CF\u8D8A\u5C11\uFF0C\u90A3\u4E48 TopN Runtime Filter \u7684\u8FC7\u6EE4\u6027\u5C31\u8D8A\u5F3A\u3002\u56E0\u6B64\uFF0C\u7CFB\u7EDF\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u53EA\u6709\u5728 ",(0,s.jsx)(n.code,{children:"limit"})," \u6570\u91CF\u5C0F\u4E8E \u8868\u4E2D\u6570\u636E\u7684\u4E00\u534A \u65F6\uFF0C\u624D\u4F1A\u542F\u7528\u751F\u6210\u5BF9\u5E94\u7684 TopN Runtime Filter\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4F8B\u5982\uFF0C\u5982\u679C\u8BBE\u7F6E ",(0,s.jsx)(n.code,{children:"set topn_filter_ratio=0"}),"\uFF0C\u90A3\u4E48\u6267\u884C\u4EE5\u4E0B\u67E5\u8BE2\u5C31\u4E0D\u4F1A\u751F\u6210 TopN Runtime Filter\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"select o_orderkey from orders order by o_orderdate limit 20;\n"})})]})}function a(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},83575:function(e,n,i){i.d(n,{Z:function(){return r}});let r=i.p+"assets/images/global-JRF-f4ce94b2113981f437259b92d75a8b69.jpg"},912182:function(e,n,i){i.d(n,{Z:function(){return r}});let r=i.p+"assets/images/join-runtime-filter-1-67d6c6e148fa738cfef92960af57ee9d.jpg"},130542:function(e,n,i){i.d(n,{Z:function(){return r}});let r=i.p+"assets/images/join-runtime-filter-2-5a91a3c43d68ad12e9cc1c5814c72fc0.jpg"},250065:function(e,n,i){i.d(n,{Z:function(){return t},a:function(){return c}});var r=i(667294);let s={},l=r.createContext(s);function c(e){let n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);