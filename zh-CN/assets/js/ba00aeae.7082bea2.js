"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["196422"],{727278:function(n,e,s){s.r(e),s.d(e,{default:()=>o,frontMatter:()=>r,metadata:()=>l,assets:()=>c,toc:()=>h,contentTitle:()=>t});var l=JSON.parse('{"id":"query-data/udf/python-user-defined-function","title":"Python UDF, UDAF, UDWF, UDTF","description":"Python UDF \u4E3A\u7528\u6237\u63D0\u4F9B\u4F7F\u7528 Python \u8BED\u8A00\u7F16\u5199 UDF \u7684\u63A5\u53E3\uFF0C\u4EE5\u65B9\u4FBF\u7528\u6237\u4F7F\u7528 Python \u8BED\u8A00\u8FDB\u884C\u81EA\u5B9A\u4E49\u51FD\u6570\u7684\u6267\u884C\u3002 Doris \u652F\u6301\u4F7F\u7528 Python \u7F16\u5199 UDF\u3001UDAF \u548C UDTF\u3002\u4E0B\u6587\u5982\u65E0\u7279\u6B8A\u8BF4\u660E\uFF0C\u4F7F\u7528 UDF \u7EDF\u79F0\u6240\u6709\u7528\u6237\u81EA\u5B9A\u4E49\u51FD\u6570\u3002","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/query-data/udf/python-user-defined-function.md","sourceDirName":"query-data/udf","slug":"/query-data/udf/python-user-defined-function","permalink":"/zh-CN/docs/dev/query-data/udf/python-user-defined-function","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Python UDF, UDAF, UDWF, UDTF","language":"zh-CN","description":"Python UDF \u4E3A\u7528\u6237\u63D0\u4F9B\u4F7F\u7528 Python \u8BED\u8A00\u7F16\u5199 UDF \u7684\u63A5\u53E3\uFF0C\u4EE5\u65B9\u4FBF\u7528\u6237\u4F7F\u7528 Python \u8BED\u8A00\u8FDB\u884C\u81EA\u5B9A\u4E49\u51FD\u6570\u7684\u6267\u884C\u3002 Doris \u652F\u6301\u4F7F\u7528 Python \u7F16\u5199 UDF\u3001UDAF \u548C UDTF\u3002\u4E0B\u6587\u5982\u65E0\u7279\u6B8A\u8BF4\u660E\uFF0C\u4F7F\u7528 UDF \u7EDF\u79F0\u6240\u6709\u7528\u6237\u81EA\u5B9A\u4E49\u51FD\u6570\u3002"},"sidebar":"docs","previous":{"title":"Java UDF, UDAF, UDWF, UDTF","permalink":"/zh-CN/docs/dev/query-data/udf/java-user-defined-function"},"next":{"title":"\u590D\u6742\u7C7B\u578B\u67E5\u8BE2","permalink":"/zh-CN/docs/dev/query-data/complex-type"}}'),d=s("785893"),i=s("250065");let r={title:"Python UDF, UDAF, UDWF, UDTF",language:"zh-CN",description:"Python UDF \u4E3A\u7528\u6237\u63D0\u4F9B\u4F7F\u7528 Python \u8BED\u8A00\u7F16\u5199 UDF \u7684\u63A5\u53E3\uFF0C\u4EE5\u65B9\u4FBF\u7528\u6237\u4F7F\u7528 Python \u8BED\u8A00\u8FDB\u884C\u81EA\u5B9A\u4E49\u51FD\u6570\u7684\u6267\u884C\u3002 Doris \u652F\u6301\u4F7F\u7528 Python \u7F16\u5199 UDF\u3001UDAF \u548C UDTF\u3002\u4E0B\u6587\u5982\u65E0\u7279\u6B8A\u8BF4\u660E\uFF0C\u4F7F\u7528 UDF \u7EDF\u79F0\u6240\u6709\u7528\u6237\u81EA\u5B9A\u4E49\u51FD\u6570\u3002"},t=void 0,c={},h=[{value:"Python UDF",id:"python-udf",level:2},{value:"\u521B\u5EFA Python UDF",id:"\u521B\u5EFA-python-udf",level:3},{value:"\u5185\u8054\u6A21\u5F0F (Inline Mode)",id:"\u5185\u8054\u6A21\u5F0F-inline-mode",level:4},{value:"\u6A21\u5757\u6A21\u5F0F (Module Mode)",id:"\u6A21\u5757\u6A21\u5F0F-module-mode",level:4},{value:"\u5220\u9664 Python UDF",id:"\u5220\u9664-python-udf",level:3},{value:"\u53C2\u6570\u8BF4\u660E",id:"\u53C2\u6570\u8BF4\u660E",level:3},{value:"CREATE FUNCTION \u53C2\u6570",id:"create-function-\u53C2\u6570",level:4},{value:"PROPERTIES \u53C2\u6570",id:"properties-\u53C2\u6570",level:4},{value:"\u8FD0\u884C\u65F6\u7248\u672C\u8BF4\u660E",id:"\u8FD0\u884C\u65F6\u7248\u672C\u8BF4\u660E",level:4},{value:"\u6570\u636E\u7C7B\u578B\u6620\u5C04",id:"\u6570\u636E\u7C7B\u578B\u6620\u5C04",level:3},{value:"NULL \u503C\u5904\u7406",id:"null-\u503C\u5904\u7406",level:4},{value:"\u5411\u91CF\u5316\u6A21\u5F0F",id:"\u5411\u91CF\u5316\u6A21\u5F0F",level:3},{value:"\u57FA\u672C\u793A\u4F8B",id:"\u57FA\u672C\u793A\u4F8B",level:4},{value:"\u5411\u91CF\u5316\u6A21\u5F0F\u7684\u4F18\u52BF",id:"\u5411\u91CF\u5316\u6A21\u5F0F\u7684\u4F18\u52BF",level:4},{value:"\u4F7F\u7528\u5411\u91CF\u5316\u51FD\u6570",id:"\u4F7F\u7528\u5411\u91CF\u5316\u51FD\u6570",level:4},{value:"\u590D\u6742\u6570\u636E\u7C7B\u578B\u5904\u7406",id:"\u590D\u6742\u6570\u636E\u7C7B\u578B\u5904\u7406",level:3},{value:"ARRAY \u7C7B\u578B",id:"array-\u7C7B\u578B",level:4},{value:"MAP \u7C7B\u578B",id:"map-\u7C7B\u578B",level:4},{value:"STRUCT \u7C7B\u578B",id:"struct-\u7C7B\u578B",level:4},{value:"\u5B9E\u9645\u5E94\u7528\u573A\u666F",id:"\u5B9E\u9645\u5E94\u7528\u573A\u666F",level:3},{value:"\u573A\u666F 1: \u6570\u636E\u8131\u654F",id:"\u573A\u666F-1-\u6570\u636E\u8131\u654F",level:4},{value:"\u573A\u666F 2: \u5B57\u7B26\u4E32\u76F8\u4F3C\u5EA6\u8BA1\u7B97",id:"\u573A\u666F-2-\u5B57\u7B26\u4E32\u76F8\u4F3C\u5EA6\u8BA1\u7B97",level:4},{value:"\u573A\u666F 3: \u65E5\u671F\u8BA1\u7B97",id:"\u573A\u666F-3-\u65E5\u671F\u8BA1\u7B97",level:4},{value:"\u573A\u666F 4: \u8EAB\u4EFD\u8BC1\u53F7\u6821\u9A8C",id:"\u573A\u666F-4-\u8EAB\u4EFD\u8BC1\u53F7\u6821\u9A8C",level:4},{value:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE",id:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE",level:3},{value:"1. \u4F18\u5148\u4F7F\u7528\u5411\u91CF\u5316\u6A21\u5F0F",id:"1-\u4F18\u5148\u4F7F\u7528\u5411\u91CF\u5316\u6A21\u5F0F",level:4},{value:"2. \u4F7F\u7528\u6A21\u5757\u6A21\u5F0F\u7BA1\u7406\u590D\u6742\u903B\u8F91",id:"2-\u4F7F\u7528\u6A21\u5757\u6A21\u5F0F\u7BA1\u7406\u590D\u6742\u903B\u8F91",level:4},{value:"3. \u907F\u514D\u5728\u51FD\u6570\u4E2D\u6267\u884C I/O \u64CD\u4F5C",id:"3-\u907F\u514D\u5728\u51FD\u6570\u4E2D\u6267\u884C-io-\u64CD\u4F5C",level:4},{value:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879",id:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879",level:3},{value:"1. Python \u7248\u672C\u652F\u6301",id:"1-python-\u7248\u672C\u652F\u6301",level:4},{value:"2. \u4F9D\u8D56\u5E93",id:"2-\u4F9D\u8D56\u5E93",level:4},{value:"3. \u6027\u80FD\u8003\u8651",id:"3-\u6027\u80FD\u8003\u8651",level:4},{value:"4. \u5B89\u5168\u6027",id:"4-\u5B89\u5168\u6027",level:4},{value:"5. \u8D44\u6E90\u9650\u5236",id:"5-\u8D44\u6E90\u9650\u5236",level:4},{value:"\u5E38\u89C1\u95EE\u9898",id:"\u5E38\u89C1\u95EE\u9898",level:3},{value:"Q1: \u5982\u4F55\u5728 Python UDF \u4E2D\u4F7F\u7528\u7B2C\u4E09\u65B9\u5E93?",id:"q1-\u5982\u4F55\u5728-python-udf-\u4E2D\u4F7F\u7528\u7B2C\u4E09\u65B9\u5E93",level:4},{value:"Q2: Python UDF \u662F\u5426\u652F\u6301\u9012\u5F52\u51FD\u6570?",id:"q2-python-udf-\u662F\u5426\u652F\u6301\u9012\u5F52\u51FD\u6570",level:4},{value:"Q3: \u5982\u4F55\u8C03\u8BD5 Python UDF?",id:"q3-\u5982\u4F55\u8C03\u8BD5-python-udf",level:4},{value:"Q4: Python UDF \u662F\u5426\u652F\u6301\u5168\u5C40\u53D8\u91CF?",id:"q4-python-udf-\u662F\u5426\u652F\u6301\u5168\u5C40\u53D8\u91CF",level:4},{value:"Q5: \u5982\u4F55\u66F4\u65B0\u5DF2\u5B58\u5728\u7684 Python UDF?",id:"q5-\u5982\u4F55\u66F4\u65B0\u5DF2\u5B58\u5728\u7684-python-udf",level:4},{value:"Q6: Python UDF \u80FD\u5426\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90?",id:"q6-python-udf-\u80FD\u5426\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90",level:4},{value:"Python UDAF",id:"python-udaf",level:2},{value:"UDAF \u57FA\u672C\u6982\u5FF5",id:"udaf-\u57FA\u672C\u6982\u5FF5",level:3},{value:"\u805A\u5408\u51FD\u6570\u7684\u751F\u547D\u5468\u671F",id:"\u805A\u5408\u51FD\u6570\u7684\u751F\u547D\u5468\u671F",level:4},{value:"\u5FC5\u9700\u7684\u7C7B\u65B9\u6CD5\u548C\u5C5E\u6027",id:"\u5FC5\u9700\u7684\u7C7B\u65B9\u6CD5\u548C\u5C5E\u6027",level:4},{value:"\u57FA\u672C\u8BED\u6CD5",id:"\u57FA\u672C\u8BED\u6CD5",level:3},{value:"\u521B\u5EFA Python UDAF",id:"\u521B\u5EFA-python-udaf",level:4},{value:"\u5185\u8054\u6A21\u5F0F (Inline Mode)",id:"\u5185\u8054\u6A21\u5F0F-inline-mode-1",level:5},{value:"\u6A21\u5757\u6A21\u5F0F (Module Mode)",id:"\u6A21\u5757\u6A21\u5F0F-module-mode-1",level:5},{value:"\u5220\u9664 Python UDAF",id:"\u5220\u9664-python-udaf",level:4},{value:"\u53C2\u6570\u8BF4\u660E",id:"\u53C2\u6570\u8BF4\u660E-1",level:3},{value:"CREATE AGGREGATE FUNCTION \u53C2\u6570",id:"create-aggregate-function-\u53C2\u6570",level:4},{value:"PROPERTIES \u53C2\u6570",id:"properties-\u53C2\u6570-1",level:4},{value:"runtime_version \u8BF4\u660E",id:"runtime_version-\u8BF4\u660E",level:4},{value:"\u7A97\u53E3\u51FD\u6570 (Window Functions)",id:"\u7A97\u53E3\u51FD\u6570-window-functions",level:3},{value:"\u6570\u636E\u7C7B\u578B\u6620\u5C04",id:"\u6570\u636E\u7C7B\u578B\u6620\u5C04-1",level:3},{value:"NULL \u503C\u5904\u7406",id:"null-\u503C\u5904\u7406-1",level:4},{value:"\u5B9E\u9645\u5E94\u7528\u573A\u666F",id:"\u5B9E\u9645\u5E94\u7528\u573A\u666F-1",level:3},{value:"\u573A\u666F 1: \u8BA1\u7B97\u767E\u5206\u4F4D\u6570",id:"\u573A\u666F-1-\u8BA1\u7B97\u767E\u5206\u4F4D\u6570",level:4},{value:"\u573A\u666F 2: \u5B57\u7B26\u4E32\u53BB\u91CD\u5408\u5E76",id:"\u573A\u666F-2-\u5B57\u7B26\u4E32\u53BB\u91CD\u5408\u5E76",level:4},{value:"\u573A\u666F 3: \u79FB\u52A8\u5E73\u5747",id:"\u573A\u666F-3-\u79FB\u52A8\u5E73\u5747",level:4},{value:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE",id:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE-1",level:3},{value:"1. \u4F18\u5316\u72B6\u6001\u5BF9\u8C61\u5927\u5C0F",id:"1-\u4F18\u5316\u72B6\u6001\u5BF9\u8C61\u5927\u5C0F",level:4},{value:"2. \u51CF\u5C11\u5BF9\u8C61\u521B\u5EFA",id:"2-\u51CF\u5C11\u5BF9\u8C61\u521B\u5EFA",level:4},{value:"3. \u7B80\u5316 merge \u903B\u8F91",id:"3-\u7B80\u5316-merge-\u903B\u8F91",level:4},{value:"4. \u4F7F\u7528\u589E\u91CF\u8BA1\u7B97",id:"4-\u4F7F\u7528\u589E\u91CF\u8BA1\u7B97",level:4},{value:"5. \u907F\u514D\u4F7F\u7528\u5916\u90E8\u8D44\u6E90",id:"5-\u907F\u514D\u4F7F\u7528\u5916\u90E8\u8D44\u6E90",level:4},{value:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879",id:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879-1",level:3},{value:"1. \u6027\u80FD\u8003\u8651",id:"1-\u6027\u80FD\u8003\u8651",level:4},{value:"2. \u72B6\u6001\u5E8F\u5217\u5316",id:"2-\u72B6\u6001\u5E8F\u5217\u5316",level:4},{value:"3. \u5185\u5B58\u9650\u5236",id:"3-\u5185\u5B58\u9650\u5236",level:4},{value:"4. \u51FD\u6570\u547D\u540D",id:"4-\u51FD\u6570\u547D\u540D",level:4},{value:"5. \u73AF\u5883\u4E00\u81F4\u6027",id:"5-\u73AF\u5883\u4E00\u81F4\u6027",level:4},{value:"\u5E38\u89C1\u95EE\u9898 FAQ",id:"\u5E38\u89C1\u95EE\u9898-faq",level:3},{value:"Q1: UDAF \u548C UDF \u7684\u533A\u522B\u662F\u4EC0\u4E48?",id:"q1-udaf-\u548C-udf-\u7684\u533A\u522B\u662F\u4EC0\u4E48",level:4},{value:"Q2: aggregate_state \u5C5E\u6027\u7684\u4F5C\u7528\u662F\u4EC0\u4E48?",id:"q2-aggregate_state-\u5C5E\u6027\u7684\u4F5C\u7528\u662F\u4EC0\u4E48",level:4},{value:"Q3: UDAF \u53EF\u4EE5\u5728\u7A97\u53E3\u51FD\u6570\u4E2D\u4F7F\u7528\u5417?",id:"q3-udaf-\u53EF\u4EE5\u5728\u7A97\u53E3\u51FD\u6570\u4E2D\u4F7F\u7528\u5417",level:4},{value:"Q4: merge \u65B9\u6CD5\u4EC0\u4E48\u65F6\u5019\u4F1A\u88AB\u8C03\u7528?",id:"q4-merge-\u65B9\u6CD5\u4EC0\u4E48\u65F6\u5019\u4F1A\u88AB\u8C03\u7528",level:4},{value:"Python UDTF",id:"python-udtf",level:2},{value:"UDTF \u57FA\u672C\u6982\u5FF5",id:"udtf-\u57FA\u672C\u6982\u5FF5",level:3},{value:"\u8868\u51FD\u6570\u7684\u6267\u884C\u65B9\u5F0F",id:"\u8868\u51FD\u6570\u7684\u6267\u884C\u65B9\u5F0F",level:4},{value:"\u51FD\u6570\u8981\u6C42",id:"\u51FD\u6570\u8981\u6C42",level:4},{value:"\u8F93\u51FA\u65B9\u5F0F",id:"\u8F93\u51FA\u65B9\u5F0F",level:4},{value:"\u57FA\u672C\u8BED\u6CD5",id:"\u57FA\u672C\u8BED\u6CD5-1",level:3},{value:"\u521B\u5EFA Python UDTF",id:"\u521B\u5EFA-python-udtf",level:4},{value:"\u5185\u8054\u6A21\u5F0F (Inline Mode)",id:"\u5185\u8054\u6A21\u5F0F-inline-mode-2",level:5},{value:"\u6A21\u5757\u6A21\u5F0F (Module Mode)",id:"\u6A21\u5757\u6A21\u5F0F-module-mode-2",level:5},{value:"\u5220\u9664 Python UDTF",id:"\u5220\u9664-python-udtf",level:4},{value:"\u4FEE\u6539 Python UDTF",id:"\u4FEE\u6539-python-udtf",level:4},{value:"\u53C2\u6570\u8BF4\u660E",id:"\u53C2\u6570\u8BF4\u660E-2",level:3},{value:"CREATE TABLES FUNCTION \u53C2\u6570",id:"create-tables-function-\u53C2\u6570",level:4},{value:"PROPERTIES \u53C2\u6570",id:"properties-\u53C2\u6570-2",level:4},{value:"runtime_version \u8BF4\u660E",id:"runtime_version-\u8BF4\u660E-1",level:4},{value:"\u6570\u636E\u7C7B\u578B\u6620\u5C04",id:"\u6570\u636E\u7C7B\u578B\u6620\u5C04-2",level:3},{value:"NULL \u503C\u5904\u7406",id:"null-\u503C\u5904\u7406-2",level:4},{value:"\u5B9E\u9645\u5E94\u7528\u573A\u666F",id:"\u5B9E\u9645\u5E94\u7528\u573A\u666F-2",level:3},{value:"\u573A\u666F 1: CSV \u6570\u636E\u89E3\u6790",id:"\u573A\u666F-1-csv-\u6570\u636E\u89E3\u6790",level:4},{value:"\u573A\u666F 2: \u65E5\u671F\u8303\u56F4\u751F\u6210",id:"\u573A\u666F-2-\u65E5\u671F\u8303\u56F4\u751F\u6210",level:4},{value:"\u573A\u666F 3: \u6587\u672C\u5206\u8BCD",id:"\u573A\u666F-3-\u6587\u672C\u5206\u8BCD",level:4},{value:"\u573A\u666F 4: URL \u53C2\u6570\u89E3\u6790",id:"\u573A\u666F-4-url-\u53C2\u6570\u89E3\u6790",level:4},{value:"\u573A\u666F 5: IP \u8303\u56F4\u5C55\u5F00",id:"\u573A\u666F-5-ip-\u8303\u56F4\u5C55\u5F00",level:4},{value:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE",id:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE-2",level:3},{value:"1. \u63A7\u5236\u8F93\u51FA\u884C\u6570",id:"1-\u63A7\u5236\u8F93\u51FA\u884C\u6570",level:4},{value:"2. \u907F\u514D\u91CD\u590D\u8BA1\u7B97",id:"2-\u907F\u514D\u91CD\u590D\u8BA1\u7B97",level:4},{value:"3. \u4F7F\u7528\u751F\u6210\u5668\u8868\u8FBE\u5F0F",id:"3-\u4F7F\u7528\u751F\u6210\u5668\u8868\u8FBE\u5F0F",level:4},{value:"4. \u907F\u514D\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90",id:"4-\u907F\u514D\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90",level:4},{value:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879",id:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879-2",level:3},{value:"1. \u65E0\u72B6\u6001\u9650\u5236",id:"1-\u65E0\u72B6\u6001\u9650\u5236",level:4},{value:"2. \u6027\u80FD\u8003\u8651",id:"2-\u6027\u80FD\u8003\u8651",level:4},{value:"3. \u8F93\u51FA\u7C7B\u578B\u56FA\u5B9A",id:"3-\u8F93\u51FA\u7C7B\u578B\u56FA\u5B9A",level:4},{value:"4. \u51FD\u6570\u547D\u540D",id:"4-\u51FD\u6570\u547D\u540D-1",level:4},{value:"5. \u73AF\u5883\u4E00\u81F4\u6027",id:"5-\u73AF\u5883\u4E00\u81F4\u6027-1",level:4},{value:"\u5E38\u89C1\u95EE\u9898 FAQ",id:"\u5E38\u89C1\u95EE\u9898-faq-1",level:3},{value:"Q1: UDTF \u548C UDF \u7684\u533A\u522B\u662F\u4EC0\u4E48?",id:"q1-udtf-\u548C-udf-\u7684\u533A\u522B\u662F\u4EC0\u4E48",level:4},{value:"Q2: \u5982\u4F55\u8F93\u51FA\u591A\u5217?",id:"q2-\u5982\u4F55\u8F93\u51FA\u591A\u5217",level:4},{value:"Q3: \u4E3A\u4EC0\u4E48\u6211\u7684 UDTF \u6CA1\u6709\u8F93\u51FA?",id:"q3-\u4E3A\u4EC0\u4E48\u6211\u7684-udtf-\u6CA1\u6709\u8F93\u51FA",level:4},{value:"Q4: UDTF \u53EF\u4EE5\u7EF4\u62A4\u72B6\u6001\u5417?",id:"q4-udtf-\u53EF\u4EE5\u7EF4\u62A4\u72B6\u6001\u5417",level:4},{value:"Q5: \u5982\u4F55\u9650\u5236 UDTF \u7684\u8F93\u51FA\u884C\u6570?",id:"q5-\u5982\u4F55\u9650\u5236-udtf-\u7684\u8F93\u51FA\u884C\u6570",level:4},{value:"Q6: UDTF \u8F93\u51FA\u7684\u6570\u636E\u7C7B\u578B\u6709\u9650\u5236\u5417?",id:"q6-udtf-\u8F93\u51FA\u7684\u6570\u636E\u7C7B\u578B\u6709\u9650\u5236\u5417",level:4},{value:"Q7: \u53EF\u4EE5\u5728 UDTF \u4E2D\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90\u5417?",id:"q7-\u53EF\u4EE5\u5728-udtf-\u4E2D\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90\u5417",level:4},{value:"Python UDF/UDAF/UDTF \u73AF\u5883\u914D\u7F6E\u4E0E\u591A\u7248\u672C\u7BA1\u7406",id:"python-udfudafudtf-\u73AF\u5883\u914D\u7F6E\u4E0E\u591A\u7248\u672C\u7BA1\u7406",level:2},{value:"Python \u73AF\u5883\u7BA1\u7406",id:"python-\u73AF\u5883\u7BA1\u7406",level:3},{value:"\u7B2C\u4E09\u65B9\u5E93\u7684\u5B89\u88C5\u4E0E\u4F7F\u7528",id:"\u7B2C\u4E09\u65B9\u5E93\u7684\u5B89\u88C5\u4E0E\u4F7F\u7528",level:3},{value:"\u5B89\u88C5\u6B65\u9AA4",id:"\u5B89\u88C5\u6B65\u9AA4",level:4},{value:"\u6CE8\u610F\u4E8B\u9879",id:"\u6CE8\u610F\u4E8B\u9879",level:4},{value:"BE \u914D\u7F6E\u53C2\u6570",id:"be-\u914D\u7F6E\u53C2\u6570",level:3},{value:"\u914D\u7F6E\u53C2\u6570\u8BF4\u660E",id:"\u914D\u7F6E\u53C2\u6570\u8BF4\u660E",level:4},{value:"\u65B9\u5F0F\u4E00: \u4F7F\u7528 Conda \u7BA1\u7406 Python \u73AF\u5883",id:"\u65B9\u5F0F\u4E00-\u4F7F\u7528-conda-\u7BA1\u7406-python-\u73AF\u5883",level:3},{value:"1. \u914D\u7F6E BE",id:"1-\u914D\u7F6E-be",level:4},{value:"2. \u73AF\u5883\u67E5\u627E\u89C4\u5219",id:"2-\u73AF\u5883\u67E5\u627E\u89C4\u5219",level:4},{value:"3. \u76EE\u5F55\u7ED3\u6784\u793A\u610F\u56FE",id:"3-\u76EE\u5F55\u7ED3\u6784\u793A\u610F\u56FE",level:4},{value:"4. \u521B\u5EFA Conda \u73AF\u5883",id:"4-\u521B\u5EFA-conda-\u73AF\u5883",level:4},{value:"5. \u5728 UDF \u4E2D\u4F7F\u7528",id:"5-\u5728-udf-\u4E2D\u4F7F\u7528",level:4},{value:"\u65B9\u5F0F\u4E8C: \u4F7F\u7528 Venv \u7BA1\u7406 Python \u73AF\u5883",id:"\u65B9\u5F0F\u4E8C-\u4F7F\u7528-venv-\u7BA1\u7406-python-\u73AF\u5883",level:3},{value:"1. \u914D\u7F6E BE",id:"1-\u914D\u7F6E-be-1",level:4},{value:"2. \u914D\u7F6E\u53C2\u6570\u8BF4\u660E",id:"2-\u914D\u7F6E\u53C2\u6570\u8BF4\u660E",level:4},{value:"3. \u76EE\u5F55\u7ED3\u6784\u793A\u610F\u56FE",id:"3-\u76EE\u5F55\u7ED3\u6784\u793A\u610F\u56FE-1",level:4},{value:"4. \u521B\u5EFA Venv \u73AF\u5883",id:"4-\u521B\u5EFA-venv-\u73AF\u5883",level:4},{value:"5. \u5728 UDF \u4E2D\u4F7F\u7528",id:"5-\u5728-udf-\u4E2D\u4F7F\u7528-1",level:4},{value:"\u73AF\u5883\u7BA1\u7406\u6700\u4F73\u5B9E\u8DF5",id:"\u73AF\u5883\u7BA1\u7406\u6700\u4F73\u5B9E\u8DF5",level:3},{value:"1. \u9009\u62E9\u5408\u9002\u7684\u7BA1\u7406\u65B9\u5F0F",id:"1-\u9009\u62E9\u5408\u9002\u7684\u7BA1\u7406\u65B9\u5F0F",level:4},{value:"2. \u73AF\u5883\u4E00\u81F4\u6027\u8981\u6C42",id:"2-\u73AF\u5883\u4E00\u81F4\u6027\u8981\u6C42",level:4},{value:"\u6CE8\u610F\u4E8B\u9879",id:"\u6CE8\u610F\u4E8B\u9879-1",level:3},{value:"1. \u914D\u7F6E\u4FEE\u6539\u751F\u6548",id:"1-\u914D\u7F6E\u4FEE\u6539\u751F\u6548",level:4},{value:"2. \u8DEF\u5F84\u9A8C\u8BC1",id:"2-\u8DEF\u5F84\u9A8C\u8BC1",level:4},{value:"3. \u6743\u9650\u8BBE\u7F6E",id:"3-\u6743\u9650\u8BBE\u7F6E",level:4},{value:"4. \u8D44\u6E90\u9650\u5236",id:"4-\u8D44\u6E90\u9650\u5236",level:4},{value:"\u73AF\u5883\u9A8C\u8BC1",id:"\u73AF\u5883\u9A8C\u8BC1",level:3},{value:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5",id:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5",level:3},{value:"Q1: UDF \u8C03\u7528\u65F6\u63D0\u793A &quot;Python environment not found&quot;",id:"q1-udf-\u8C03\u7528\u65F6\u63D0\u793A-python-environment-not-found",level:4},{value:"Q2: UDF \u8C03\u7528\u65F6\u63D0\u793A &quot;ModuleNotFoundError: No module named &#39;xxx&#39;&quot;",id:"q2-udf-\u8C03\u7528\u65F6\u63D0\u793A-modulenotfounderror-no-module-named-xxx",level:4},{value:"Q3: \u4E0D\u540C BE \u8282\u70B9\u6267\u884C\u7ED3\u679C\u4E0D\u4E00\u81F4",id:"q3-\u4E0D\u540C-be-\u8282\u70B9\u6267\u884C\u7ED3\u679C\u4E0D\u4E00\u81F4",level:4},{value:"Q4: \u4FEE\u6539 be.conf \u540E\u672A\u751F\u6548",id:"q4-\u4FEE\u6539-beconf-\u540E\u672A\u751F\u6548",level:4},{value:"\u4F7F\u7528\u9650\u5236",id:"\u4F7F\u7528\u9650\u5236",level:3}];function a(n){let e={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...n.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.h2,{id:"python-udf",children:"Python UDF"}),"\n",(0,d.jsx)(e.p,{children:"Python UDF (User Defined Function) \u662F Apache Doris \u63D0\u4F9B\u7684\u81EA\u5B9A\u4E49\u6807\u91CF\u51FD\u6570\u6269\u5C55\u673A\u5236\uFF0C\u5141\u8BB8\u7528\u6237\u4F7F\u7528 Python \u8BED\u8A00\u7F16\u5199\u81EA\u5B9A\u4E49\u51FD\u6570\uFF0C\u7528\u4E8E\u6570\u636E\u67E5\u8BE2\u548C\u5904\u7406\u3002\u901A\u8FC7 Python UDF\uFF0C\u7528\u6237\u53EF\u4EE5\u7075\u6D3B\u5730\u5B9E\u73B0\u590D\u6742\u7684\u4E1A\u52A1\u903B\u8F91\uFF0C\u5904\u7406\u5404\u79CD\u6570\u636E\u7C7B\u578B\uFF0C\u5E76\u5145\u5206\u5229\u7528 Python \u4E30\u5BCC\u7684\u751F\u6001\u5E93\u3002"}),"\n",(0,d.jsx)(e.p,{children:"Python UDF \u652F\u6301\u4E24\u79CD\u6267\u884C\u6A21\u5F0F:"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u6807\u91CF\u6A21\u5F0F (Scalar Mode)"}),": \u9010\u884C\u5904\u7406\u6570\u636E\uFF0C\u9002\u7528\u4E8E\u7B80\u5355\u7684\u8F6C\u6362\u548C\u8BA1\u7B97"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5411\u91CF\u5316\u6A21\u5F0F (Vectorized Mode)"}),": \u6279\u91CF\u5904\u7406\u6570\u636E\uFF0C\u5229\u7528 Pandas \u8FDB\u884C\u9AD8\u6027\u80FD\u8BA1\u7B97"]}),"\n"]}),"\n",(0,d.jsxs)(e.admonition,{title:"\u63D0\u793A",type:"tip",children:[(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u73AF\u5883\u4F9D\u8D56"}),": \u4F7F\u7528 Python UDF \u524D\uFF0C\u5FC5\u987B\u5728\u6240\u6709 BE \u8282\u70B9\u7684 Python \u73AF\u5883\u4E2D\u9884\u5148\u5B89\u88C5 ",(0,d.jsx)(e.strong,{children:(0,d.jsx)(e.code,{children:"pandas"})})," \u548C ",(0,d.jsx)(e.strong,{children:(0,d.jsx)(e.code,{children:"pyarrow"})})," \u4E24\u4E2A\u5E93\uFF0C\u8FD9\u662F Doris Python UDF \u529F\u80FD\u7684\u5F3A\u5236\u4F9D\u8D56\u3002\u8BE6\u89C1 ",(0,d.jsx)(e.a,{href:"python-user-defined-function#python-udfudafudtf-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86",children:"Python UDF \u73AF\u5883\u914D\u7F6E"}),"\u3002"]}),(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u65E5\u5FD7\u8DEF\u5F84"}),": Python UDF Server \u7684\u8FD0\u884C\u65E5\u5FD7\u4F4D\u4E8E ",(0,d.jsx)(e.code,{children:"output/be/log/python_udf_output.log"}),"\u3002\u7528\u6237\u53EF\u4EE5\u5728\u8BE5\u65E5\u5FD7\u4E2D\u67E5\u770B Python Server \u7684\u8FD0\u884C\u60C5\u51B5\u3001\u51FD\u6570\u6267\u884C\u4FE1\u606F\u548C\u8C03\u8BD5\u9519\u8BEF\u3002"]})]}),"\n",(0,d.jsx)(e.h3,{id:"\u521B\u5EFA-python-udf",children:"\u521B\u5EFA Python UDF"}),"\n",(0,d.jsxs)(e.p,{children:["Python UDF \u652F\u6301\u4E24\u79CD\u521B\u5EFA\u65B9\u5F0F: ",(0,d.jsx)(e.code,{children:"\u5185\u8054\u6A21\u5F0F (Inline)"})," \u548C ",(0,d.jsx)(e.code,{children:"\u6A21\u5757\u6A21\u5F0F (Module)"}),"\u3002"]}),"\n",(0,d.jsx)(e.admonition,{title:"\u6CE8\u610F",type:"caution",children:(0,d.jsxs)(e.p,{children:["\u5982\u679C\u540C\u65F6\u6307\u5B9A\u4E86 ",(0,d.jsx)(e.code,{children:"file"})," \u53C2\u6570\u548C ",(0,d.jsx)(e.code,{children:"AS $$"})," \u5185\u8054 Python \u4EE3\u7801\uFF0CDoris \u5C06\u4F1A\u4F18\u5148\u52A0\u8F7D",(0,d.jsx)(e.strong,{children:"\u5185\u8054 Python \u4EE3\u7801"}),"\uFF0C\u91C7\u7528\u5185\u8054\u6A21\u5F0F\u8FD0\u884C Python UDF\u3002"]})}),"\n",(0,d.jsx)(e.h4,{id:"\u5185\u8054\u6A21\u5F0F-inline-mode",children:"\u5185\u8054\u6A21\u5F0F (Inline Mode)"}),"\n",(0,d.jsx)(e.p,{children:"\u5185\u8054\u6A21\u5F0F\u5141\u8BB8\u76F4\u63A5\u5728 SQL \u4E2D\u7F16\u5199 Python \u4EE3\u7801\uFF0C\u9002\u5408\u7B80\u5355\u7684\u51FD\u6570\u903B\u8F91\u3002"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u8BED\u6CD5"}),":"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'CREATE FUNCTION function_name(parameter_type1, parameter_type2, ...)\nRETURNS return_type\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "entry_function_name",\n    "runtime_version" = "python_version",\n    "always_nullable" = "true|false"\n)\nAS $$\ndef entry_function_name(param1, param2, ...):\n    # Python code here\n    return result\n$$;\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 1: \u6574\u6570\u52A0\u6CD5"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_add(INT, INT);\n\nCREATE FUNCTION py_add(INT, INT)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12"\n)\nAS $$\ndef evaluate(a, b):\n    return a + b\n$$;\n\nSELECT py_add(10, 20) AS result; -- \u7ED3\u679C: 30\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 2: \u5B57\u7B26\u4E32\u62FC\u63A5"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_concat(STRING, STRING);\n\nCREATE FUNCTION py_concat(STRING, STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12"\n)\nAS $$\ndef evaluate(s1, s2):\n    if s1 is None or s2 is None:\n        return None\n    return s1 + s2\n$$;\n\nSELECT py_concat(\'Hello\', \' World\') AS result; -- \u7ED3\u679C: Hello World\nSELECT py_concat(NULL, \' World\') AS result; -- \u7ED3\u679C: NULL\nSELECT py_concat(\'Hello\', NULL) AS result; -- \u7ED3\u679C: NULL\n'})}),"\n",(0,d.jsx)(e.h4,{id:"\u6A21\u5757\u6A21\u5F0F-module-mode",children:"\u6A21\u5757\u6A21\u5F0F (Module Mode)"}),"\n",(0,d.jsxs)(e.p,{children:["\u6A21\u5757\u6A21\u5F0F\u9002\u5408\u590D\u6742\u7684\u51FD\u6570\u903B\u8F91\uFF0C\u9700\u8981\u5C06 Python \u4EE3\u7801\u6253\u5305\u6210 ",(0,d.jsx)(e.code,{children:".zip"})," \u538B\u7F29\u5305\uFF0C\u5E76\u5728\u51FD\u6570\u521B\u5EFA\u65F6\u5F15\u7528\u3002"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 1: \u7F16\u5199 Python \u6A21\u5757"})}),"\n",(0,d.jsxs)(e.p,{children:["\u521B\u5EFA ",(0,d.jsx)(e.code,{children:"python_udf_scalar_ops.py"})," \u6587\u4EF6:"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:'def add_three_numbers(a, b, c):\n    """Add three numbers"""\n    if a is None or b is None or c is None:\n        return None\n    return a + b + c\n\ndef reverse_string(s):\n    """Reverse a string"""\n    if s is None:\n        return None\n    return s[::-1]\n\ndef is_prime(n):\n    """Check if a number is prime"""\n    if n is None or n < 2:\n        return False\n    if n == 2:\n        return True\n    if n % 2 == 0:\n        return False\n    import math\n    for i in range(3, int(math.sqrt(n)) + 1, 2):\n        if n % i == 0:\n            return False\n    return True\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 2: \u6253\u5305 Python \u6A21\u5757"})}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u5FC5\u987B"}),"\u5C06 Python \u6587\u4EF6\u6253\u5305\u6210 ",(0,d.jsx)(e.code,{children:".zip"})," \u683C\u5F0F(\u5373\u4F7F\u53EA\u6709\u5355\u4E2A\u6587\u4EF6):"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"zip python_udf_scalar_ops.zip python_udf_scalar_ops.py\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u5982\u679C\u6709\u591A\u4E2A Python \u6587\u4EF6:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"zip python_udf_scalar_ops.zip python_udf_scalar_ops.py utils.py helper.py ...\n"})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 3: \u8BBE\u7F6E Python \u6A21\u5757\u538B\u7F29\u5305\u7684\u8DEF\u5F84"})}),"\n",(0,d.jsxs)(e.p,{children:["Python \u6A21\u5757\u538B\u7F29\u5305\u652F\u6301\u591A\u79CD\u90E8\u7F72\u65B9\u5F0F\uFF0C\u5747\u901A\u8FC7 ",(0,d.jsx)(e.code,{children:"file"})," \u53C2\u6570\u6307\u5B9A ",(0,d.jsx)(e.code,{children:".zip"})," \u5305\u7684\u8DEF\u5F84:"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u65B9\u5F0F 1: \u672C\u5730\u6587\u4EF6\u7CFB\u7EDF"})," (\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"file://"})," \u534F\u8BAE)"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'"file" = "file:///path/to/python_udf_scalar_ops.zip"\n'})}),"\n",(0,d.jsxs)(e.p,{children:["\u9002\u7528\u4E8E ",(0,d.jsx)(e.code,{children:".zip"})," \u5305\u5DF2\u5B58\u653E\u5728 BE \u8282\u70B9\u672C\u5730\u6587\u4EF6\u7CFB\u7EDF\u7684\u573A\u666F\u3002"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u65B9\u5F0F 2: HTTP/HTTPS \u8FDC\u7A0B\u4E0B\u8F7D"})," (\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"http://"})," \u6216 ",(0,d.jsx)(e.code,{children:"https://"})," \u534F\u8BAE)"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'"file" = "http://example.com/udf/python_udf_scalar_ops.zip"\n"file" = "https://s3.amazonaws.com/bucket/python_udf_scalar_ops.zip"\n'})}),"\n",(0,d.jsxs)(e.p,{children:["\u9002\u7528\u4E8E\u4ECE\u5BF9\u8C61\u5B58\u50A8(\u5982 S3\u3001OSS\u3001COS \u7B49)\u6216 HTTP \u670D\u52A1\u5668\u4E0B\u8F7D ",(0,d.jsx)(e.code,{children:".zip"})," \u5305\u7684\u573A\u666F\u3002Doris \u4F1A\u81EA\u52A8\u4E0B\u8F7D\u5E76\u7F13\u5B58\u5230\u672C\u5730\u3002"]}),"\n",(0,d.jsx)(e.admonition,{title:"\u6CE8\u610F",type:"caution",children:(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u4F7F\u7528\u8FDC\u7A0B\u4E0B\u8F7D\u65B9\u5F0F\u65F6\uFF0C\u9700\u786E\u4FDD\u6240\u6709 BE \u8282\u70B9\u90FD\u80FD\u8BBF\u95EE\u8BE5 URL"}),"\n",(0,d.jsx)(e.li,{children:"\u9996\u6B21\u8C03\u7528\u65F6\u4F1A\u4E0B\u8F7D\u6587\u4EF6\uFF0C\u53EF\u80FD\u6709\u4E00\u5B9A\u5EF6\u8FDF"}),"\n",(0,d.jsx)(e.li,{children:"\u6587\u4EF6\u4F1A\u88AB\u7F13\u5B58\uFF0C\u540E\u7EED\u8C03\u7528\u65E0\u9700\u91CD\u590D\u4E0B\u8F7D"}),"\n"]})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 4: \u8BBE\u7F6E symbol \u53C2\u6570"})}),"\n",(0,d.jsxs)(e.p,{children:["\u5728\u6A21\u5757\u6A21\u5F0F\u4E0B\uFF0C",(0,d.jsx)(e.code,{children:"symbol"})," \u53C2\u6570\u7528\u4E8E\u6307\u5B9A\u51FD\u6570\u5728 ZIP \u5305\u4E2D\u7684\u4F4D\u7F6E\uFF0C\u683C\u5F0F\u4E3A:"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{children:"[package_name.]module_name.func_name\n"})}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u53C2\u6570\u8BF4\u660E"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"package_name"}),"(\u53EF\u9009): ZIP \u538B\u7F29\u5305\u5185\u9876\u5C42 Python \u5305\u7684\u540D\u79F0\u3002\u82E5\u51FD\u6570\u4F4D\u4E8E\u5305\u7684\u6839\u6A21\u5757\u4E0B\uFF0C\u6216\u8005 ZIP \u538B\u7F29\u5305\u4E2D\u65E0 package\uFF0C\u5219\u53EF\u7701\u7565"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"module_name"}),"(\u5FC5\u586B): \u5305\u542B\u76EE\u6807\u51FD\u6570\u7684 Python \u6A21\u5757\u6587\u4EF6\u540D(\u4E0D\u542B ",(0,d.jsx)(e.code,{children:".py"})," \u540E\u7F00)"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"func_name"}),"(\u5FC5\u586B): \u7528\u6237\u5B9A\u4E49\u7684\u51FD\u6570\u540D"]}),"\n"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u89E3\u6790\u89C4\u5219"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["Doris \u4F1A\u5C06 ",(0,d.jsx)(e.code,{children:"symbol"})," \u5B57\u7B26\u4E32\u6309 ",(0,d.jsx)(e.code,{children:"."})," \u5206\u5272:\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u5982\u679C\u5F97\u5230",(0,d.jsx)(e.strong,{children:"\u4E24\u4E2A"}),"\u5B50\u5B57\u7B26\u4E32\uFF0C\u5206\u522B\u4E3A ",(0,d.jsx)(e.code,{children:"module_name"})," \u548C ",(0,d.jsx)(e.code,{children:"func_name"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u5982\u679C\u5F97\u5230",(0,d.jsx)(e.strong,{children:"\u4E09\u4E2A\u53CA\u4EE5\u4E0A"}),"\u7684\u5B50\u5B57\u7B26\u4E32\uFF0C\u5F00\u5934\u4E3A ",(0,d.jsx)(e.code,{children:"package_name"}),"\uFF0C\u4E2D\u95F4\u4E3A ",(0,d.jsx)(e.code,{children:"module_name"}),"\uFF0C\u7ED3\u5C3E\u4E3A ",(0,d.jsx)(e.code,{children:"func_name"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"module_name"})," \u90E8\u5206\u4F5C\u4E3A\u6A21\u5757\u8DEF\u5F84\uFF0C\u7528\u4E8E\u901A\u8FC7 ",(0,d.jsx)(e.code,{children:"importlib"})," \u52A8\u6001\u5BFC\u5165"]}),"\n",(0,d.jsxs)(e.li,{children:["\u82E5\u6307\u5B9A\u4E86 ",(0,d.jsx)(e.code,{children:"package_name"}),"\uFF0C\u5219\u6574\u4E2A\u8DEF\u5F84\u9700\u6784\u6210\u4E00\u4E2A\u5408\u6CD5\u7684 Python \u5BFC\u5165\u8DEF\u5F84\uFF0C\u4E14 ZIP \u5305\u7ED3\u6784\u5FC5\u987B\u4E0E\u8BE5\u8DEF\u5F84\u4E00\u81F4"]}),"\n"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u793A\u4F8B\u8BF4\u660E"}),":"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B A: \u65E0\u5305\u7ED3\u6784(\u4E24\u6BB5\u5F0F)"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{children:'ZIP \u7ED3\u6784:\nmath_ops.py\n\nsymbol = "math_ops.add"\n'})}),"\n",(0,d.jsxs)(e.p,{children:["\u8868\u793A\u51FD\u6570 ",(0,d.jsx)(e.code,{children:"add"})," \u5B9A\u4E49\u5728 ZIP \u5305\u6839\u76EE\u5F55\u4E0B\u7684 ",(0,d.jsx)(e.code,{children:"math_ops.py"})," \u6587\u4EF6\u4E2D\u3002"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B B: \u6709\u5305\u7ED3\u6784(\u4E09\u6BB5\u5F0F)"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{children:'ZIP \u7ED3\u6784:\nmylib/\n\u251C\u2500\u2500 __init__.py\n\u2514\u2500\u2500 string_helper.py\n\nsymbol = "mylib.string_helper.split_text"\n'})}),"\n",(0,d.jsxs)(e.p,{children:["\u8868\u793A\u51FD\u6570 ",(0,d.jsx)(e.code,{children:"split_text"})," \u5B9A\u4E49\u5728 ",(0,d.jsx)(e.code,{children:"mylib/string_helper.py"})," \u6587\u4EF6\u4E2D\uFF0C\u5176\u4E2D:"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"package_name"})," = ",(0,d.jsx)(e.code,{children:"mylib"})]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"module_name"})," = ",(0,d.jsx)(e.code,{children:"string_helper"})]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"func_name"})," = ",(0,d.jsx)(e.code,{children:"split_text"})]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B C: \u5D4C\u5957\u5305\u7ED3\u6784(\u56DB\u6BB5\u5F0F)"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{children:'ZIP \u7ED3\u6784:\nmylib/\n\u251C\u2500\u2500 __init__.py\n\u2514\u2500\u2500 utils/\n    \u251C\u2500\u2500 __init__.py\n    \u2514\u2500\u2500 string_helper.py\n\nsymbol = "mylib.utils.string_helper.split_text"\n'})}),"\n",(0,d.jsxs)(e.p,{children:["\u8868\u793A\u51FD\u6570 ",(0,d.jsx)(e.code,{children:"split_text"})," \u5B9A\u4E49\u5728 ",(0,d.jsx)(e.code,{children:"mylib/utils/string_helper.py"})," \u6587\u4EF6\u4E2D\uFF0C\u5176\u4E2D:"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"package_name"})," = ",(0,d.jsx)(e.code,{children:"mylib"})]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"module_name"})," = ",(0,d.jsx)(e.code,{children:"utils.string_helper"})]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"func_name"})," = ",(0,d.jsx)(e.code,{children:"split_text"})]}),"\n"]}),"\n",(0,d.jsxs)(e.blockquote,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u6CE8\u610F"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u82E5 ",(0,d.jsx)(e.code,{children:"symbol"})," \u683C\u5F0F\u4E0D\u5408\u6CD5(\u5982\u7F3A\u5C11\u51FD\u6570\u540D\u3001\u6A21\u5757\u540D\u4E3A\u7A7A\u3001\u8DEF\u5F84\u4E2D\u5B58\u5728\u7A7A\u7EC4\u4EF6\u7B49)\uFF0CDoris \u5C06\u5728\u51FD\u6570\u8C03\u7528\u65F6\u62A5\u9519"]}),"\n",(0,d.jsxs)(e.li,{children:["ZIP \u5305\u5185\u7684\u76EE\u5F55\u7ED3\u6784\u5FC5\u987B\u4E0E ",(0,d.jsx)(e.code,{children:"symbol"})," \u6307\u5B9A\u7684\u8DEF\u5F84\u4E00\u81F4"]}),"\n",(0,d.jsxs)(e.li,{children:["\u6BCF\u4E2A\u5305\u76EE\u5F55\u4E0B\u90FD\u9700\u8981\u5305\u542B ",(0,d.jsx)(e.code,{children:"__init__.py"})," \u6587\u4EF6(\u53EF\u4EE5\u4E3A\u7A7A)"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 5: \u521B\u5EFA UDF \u51FD\u6570"})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 1: \u4F7F\u7528\u672C\u5730\u6587\u4EF6(\u65E0\u5305\u7ED3\u6784)"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_add_three(INT, INT, INT);\nDROP FUNCTION IF EXISTS py_reverse(STRING);\nDROP FUNCTION IF EXISTS py_is_prime(INT);\n\nCREATE FUNCTION py_add_three(INT, INT, INT)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.add_three_numbers",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE FUNCTION py_reverse(STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.reverse_string",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE FUNCTION py_is_prime(INT)\nRETURNS BOOLEAN\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.is_prime",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 2: \u4F7F\u7528 HTTP/HTTPS \u8FDC\u7A0B\u6587\u4EF6"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_add_three(INT, INT, INT);\nDROP FUNCTION IF EXISTS py_reverse(STRING);\nDROP FUNCTION IF EXISTS py_is_prime(INT);\n\nCREATE FUNCTION py_add_three(INT, INT, INT)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "https://your-storage.com/udf/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.add_three_numbers",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE FUNCTION py_reverse(STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "https://your-storage.com/udf/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.reverse_string",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE FUNCTION py_is_prime(INT)\nRETURNS BOOLEAN\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "https://your-storage.com/udf/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.is_prime",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 3: \u4F7F\u7528\u5305\u7ED3\u6784"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_multiply(INT);\n\n-- ZIP \u7ED3\u6784: my_udf/__init__.py, my_udf/math_ops.py\nCREATE FUNCTION py_multiply(INT)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/my_udf.zip",\n    "symbol" = "my_udf.math_ops.multiply_by_two",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 6: \u4F7F\u7528\u51FD\u6570"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"SELECT py_add_three(10, 20, 30) AS sum_result; -- \u7ED3\u679C: 60\nSELECT py_reverse('hello') AS reversed; -- \u7ED3\u679C: olleh\nSELECT py_is_prime(17) AS is_prime; -- \u7ED3\u679C: true\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u5220\u9664-python-udf",children:"\u5220\u9664 Python UDF"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"-- \u8BED\u6CD5\nDROP FUNCTION IF EXISTS function_name(parameter_type1, parameter_type2, ...);\n\n-- \u793A\u4F8B\nDROP FUNCTION IF EXISTS py_add_three(INT, INT, INT);\nDROP FUNCTION IF EXISTS py_reverse(STRING);\nDROP FUNCTION IF EXISTS py_is_prime(INT);\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u53C2\u6570\u8BF4\u660E",children:"\u53C2\u6570\u8BF4\u660E"}),"\n",(0,d.jsx)(e.h4,{id:"create-function-\u53C2\u6570",children:"CREATE FUNCTION \u53C2\u6570"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u53C2\u6570"}),(0,d.jsx)(e.th,{children:"\u662F\u5426\u5FC5\u9700"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"function_name"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"\u51FD\u6570\u540D\u79F0\uFF0C\u9700\u8981\u7B26\u5408\u6807\u8BC6\u7B26\u547D\u540D\u89C4\u5219"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"parameter_type"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"\u53C2\u6570\u7C7B\u578B\u5217\u8868\uFF0C\u652F\u6301 Doris \u7684\u5404\u79CD\u6570\u636E\u7C7B\u578B"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"return_type"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"\u8FD4\u56DE\u503C\u7C7B\u578B"})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"properties-\u53C2\u6570",children:"PROPERTIES \u53C2\u6570"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u53C2\u6570"}),(0,d.jsx)(e.th,{children:"\u662F\u5426\u5FC5\u9700"}),(0,d.jsx)(e.th,{children:"\u9ED8\u8BA4\u503C"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"type"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["\u56FA\u5B9A\u4E3A ",(0,d.jsx)(e.code,{children:'"PYTHON_UDF"'})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"symbol"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["Python \u51FD\u6570\u5165\u53E3\u540D\u79F0\u3002",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.strong,{children:"\u5185\u8054\u6A21\u5F0F"}),": \u76F4\u63A5\u5199\u51FD\u6570\u540D\uFF0C\u5982 ",(0,d.jsx)(e.code,{children:'"evaluate"'}),(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.strong,{children:"\u6A21\u5757\u6A21\u5F0F"}),": \u683C\u5F0F\u4E3A ",(0,d.jsx)(e.code,{children:"[package_name.]module_name.func_name"}),"\uFF0C\u8BE6\u89C1\u6A21\u5757\u6A21\u5F0F\u8BF4\u660E"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"file"})}),(0,d.jsx)(e.td,{children:"\u5426"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["Python ",(0,d.jsx)(e.code,{children:".zip"})," \u5305\u8DEF\u5F84\uFF0C\u4EC5\u6A21\u5757\u6A21\u5F0F\u9700\u8981\u3002\u652F\u6301\u4E09\u79CD\u534F\u8BAE:",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.code,{children:"file://"})," - \u672C\u5730\u6587\u4EF6\u7CFB\u7EDF\u8DEF\u5F84",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.code,{children:"http://"})," - HTTP \u8FDC\u7A0B\u4E0B\u8F7D",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.code,{children:"https://"})," - HTTPS \u8FDC\u7A0B\u4E0B\u8F7D"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"runtime_version"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["Python \u8FD0\u884C\u65F6\u7248\u672C\uFF0C\u5982 ",(0,d.jsx)(e.code,{children:'"3.10.12"'}),"\uFF0C\u9700\u586B\u5199\u5B8C\u6574\u7684\u7248\u672C\u53F7"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"always_nullable"})}),(0,d.jsx)(e.td,{children:"\u5426"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"true"})}),(0,d.jsx)(e.td,{children:"\u662F\u5426\u603B\u662F\u8FD4\u56DE\u53EF\u7A7A\u7ED3\u679C"})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"\u8FD0\u884C\u65F6\u7248\u672C\u8BF4\u660E",children:"\u8FD0\u884C\u65F6\u7248\u672C\u8BF4\u660E"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u652F\u6301 Python 3.x \u7248\u672C"}),"\n",(0,d.jsxs)(e.li,{children:["\u9700\u8981\u6307\u5B9A\u5B8C\u6574\u7248\u672C\u53F7(\u5982 ",(0,d.jsx)(e.code,{children:'"3.10.12"'}),")\uFF0C\u4E0D\u80FD\u53EA\u586B\u5199\u4E3B\u6B21\u7248\u672C\u53F7(\u5982 ",(0,d.jsx)(e.code,{children:'"3.10"'}),")"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5982\u679C\u4E0D\u6307\u5B9A ",(0,d.jsx)(e.code,{children:"runtime_version"}),"\uFF0C\u51FD\u6570\u8C03\u7528\u65F6\u5C06\u62A5\u9519"]}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u6570\u636E\u7C7B\u578B\u6620\u5C04",children:"\u6570\u636E\u7C7B\u578B\u6620\u5C04"}),"\n",(0,d.jsx)(e.p,{children:"\u4E0B\u8868\u5217\u51FA\u4E86 Doris \u6570\u636E\u7C7B\u578B\u4E0E Python \u7C7B\u578B\u4E4B\u95F4\u7684\u6620\u5C04\u5173\u7CFB\uFF1A"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u7C7B\u578B\u5206\u7C7B"}),(0,d.jsx)(e.th,{children:"Doris \u7C7B\u578B"}),(0,d.jsx)(e.th,{children:"Python \u7C7B\u578B"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u7A7A\u7C7B\u578B"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"NULL"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"None"})}),(0,d.jsx)(e.td,{children:"\u7A7A\u503C"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u5E03\u5C14\u7C7B\u578B"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"BOOLEAN"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"bool"})}),(0,d.jsx)(e.td,{children:"\u5E03\u5C14\u503C"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u6574\u6570\u7C7B\u578B"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"TINYINT"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"int"})}),(0,d.jsx)(e.td,{children:"8 \u4F4D\u6574\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"SMALLINT"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"int"})}),(0,d.jsx)(e.td,{children:"16 \u4F4D\u6574\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"INT"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"int"})}),(0,d.jsx)(e.td,{children:"32 \u4F4D\u6574\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"BIGINT"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"int"})}),(0,d.jsx)(e.td,{children:"64 \u4F4D\u6574\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"LARGEINT"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"int"})}),(0,d.jsx)(e.td,{children:"128 \u4F4D\u6574\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u6D6E\u70B9\u7C7B\u578B"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"FLOAT"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"float"})}),(0,d.jsx)(e.td,{children:"32 \u4F4D\u6D6E\u70B9\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"DOUBLE"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"float"})}),(0,d.jsx)(e.td,{children:"64 \u4F4D\u6D6E\u70B9\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"TIME"})," / ",(0,d.jsx)(e.code,{children:"TIMEV2"})]}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"float"})}),(0,d.jsx)(e.td,{children:"\u65F6\u95F4\u7C7B\u578B(\u4EE5\u6D6E\u70B9\u6570\u8868\u793A)"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u5B57\u7B26\u4E32\u7C7B\u578B"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"CHAR"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"str"})}),(0,d.jsx)(e.td,{children:"\u5B9A\u957F\u5B57\u7B26\u4E32"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"VARCHAR"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"str"})}),(0,d.jsx)(e.td,{children:"\u53D8\u957F\u5B57\u7B26\u4E32"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"STRING"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"str"})}),(0,d.jsx)(e.td,{children:"\u5B57\u7B26\u4E32"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"JSONB"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"str"})}),(0,d.jsx)(e.td,{children:"JSON \u4E8C\u8FDB\u5236\u683C\u5F0F(\u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32)"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"VARIANT"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"str"})}),(0,d.jsx)(e.td,{children:"\u53D8\u4F53\u7C7B\u578B(\u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32)"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"DATE"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"str"})}),(0,d.jsxs)(e.td,{children:["\u65E5\u671F\u5B57\u7B26\u4E32\uFF0C\u683C\u5F0F\u4E3A ",(0,d.jsx)(e.code,{children:"'YYYY-MM-DD'"})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"DATETIME"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"str"})}),(0,d.jsxs)(e.td,{children:["\u65E5\u671F\u65F6\u95F4\u5B57\u7B26\u4E32\uFF0C\u683C\u5F0F\u4E3A ",(0,d.jsx)(e.code,{children:"'YYYY-MM-DD HH:MM:SS'"})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u65E5\u671F\u65F6\u95F4\u7C7B\u578B"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"DATEV2"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"datetime.date"})}),(0,d.jsx)(e.td,{children:"\u65E5\u671F\u5BF9\u8C61"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"DATETIMEV2"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"datetime.datetime"})}),(0,d.jsx)(e.td,{children:"\u65E5\u671F\u65F6\u95F4\u5BF9\u8C61"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"TIMESTAMPTZ"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"datetime.datetime"})}),(0,d.jsx)(e.td,{children:"\u5E26\u65F6\u533A\u7684\u65E5\u671F\u65F6\u95F4\u5BF9\u8C61"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"Decimal \u7C7B\u578B"}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"DECIMAL"})," / ",(0,d.jsx)(e.code,{children:"DECIMALV2"})]}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"decimal.Decimal"})}),(0,d.jsx)(e.td,{children:"\u9AD8\u7CBE\u5EA6\u5C0F\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"DECIMAL32"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"decimal.Decimal"})}),(0,d.jsx)(e.td,{children:"32 \u4F4D\u5B9A\u70B9\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"DECIMAL64"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"decimal.Decimal"})}),(0,d.jsx)(e.td,{children:"64 \u4F4D\u5B9A\u70B9\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"DECIMAL128"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"decimal.Decimal"})}),(0,d.jsx)(e.td,{children:"128 \u4F4D\u5B9A\u70B9\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"DECIMAL256"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"decimal.Decimal"})}),(0,d.jsx)(e.td,{children:"256 \u4F4D\u5B9A\u70B9\u6570"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"IP \u7C7B\u578B"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"IPV4"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"ipaddress.IPv4Address"})}),(0,d.jsx)(e.td,{children:"IPv4 \u5730\u5740"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"IPV6"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"ipaddress.IPv6Address"})}),(0,d.jsx)(e.td,{children:"IPv6 \u5730\u5740"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u4E8C\u8FDB\u5236\u7C7B\u578B"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"BITMAP"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"bytes"})}),(0,d.jsx)(e.td,{children:"\u4F4D\u56FE\u6570\u636E\uFF08\u6682\u4E0D\u652F\u6301\u8BE5\u7C7B\u578B\uFF09"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"HLL"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"bytes"})}),(0,d.jsx)(e.td,{children:"HyperLogLog \u6570\u636E\uFF08\u6682\u4E0D\u652F\u6301\u8BE5\u7C7B\u578B\uFF09"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"QUANTILE_STATE"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"bytes"})}),(0,d.jsx)(e.td,{children:"\u5206\u4F4D\u6570\u72B6\u6001\u6570\u636E\uFF08\u6682\u4E0D\u652F\u6301\u8BE5\u7C7B\u578B\uFF09"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u590D\u6742\u6570\u636E\u7C7B\u578B"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"ARRAY<T>"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"list"})}),(0,d.jsx)(e.td,{children:"\u6570\u7EC4\uFF0C\u5143\u7D20\u7C7B\u578B\u4E3A T"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"MAP<K,V>"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"dict"})}),(0,d.jsx)(e.td,{children:"\u5B57\u5178\uFF0C\u952E\u7C7B\u578B\u4E3A K\uFF0C\u503C\u7C7B\u578B\u4E3A V"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"STRUCT<f1:T1, f2:T2, ...>"})}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"dict"})}),(0,d.jsx)(e.td,{children:"\u7ED3\u6784\u4F53\uFF0C\u5B57\u6BB5\u540D\u4E3A\u952E\uFF0C\u5B57\u6BB5\u503C\u4E3A\u503C"})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"null-\u503C\u5904\u7406",children:"NULL \u503C\u5904\u7406"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["Doris \u7684 ",(0,d.jsx)(e.code,{children:"NULL"})," \u503C\u5728 Python \u4E2D\u6620\u5C04\u4E3A ",(0,d.jsx)(e.code,{children:"None"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u5982\u679C\u51FD\u6570\u53C2\u6570\u4E3A ",(0,d.jsx)(e.code,{children:"NULL"}),"\uFF0CPython \u51FD\u6570\u63A5\u6536\u5230\u7684\u662F ",(0,d.jsx)(e.code,{children:"None"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u5982\u679C Python \u51FD\u6570\u8FD4\u56DE ",(0,d.jsx)(e.code,{children:"None"}),"\uFF0CDoris \u5C06\u5176\u89C6\u4E3A ",(0,d.jsx)(e.code,{children:"NULL"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u5EFA\u8BAE\u5728\u51FD\u6570\u4E2D\u663E\u5F0F\u5904\u7406 ",(0,d.jsx)(e.code,{children:"None"})," \u503C\uFF0C\u907F\u514D\u8FD0\u884C\u65F6\u9519\u8BEF"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:"\u793A\u4F8B:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_safe_divide(DOUBLE, DOUBLE);\n\nCREATE FUNCTION py_safe_divide(DOUBLE, DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(a, b):\n    if a is None or b is None:\n        return None\n    if b == 0:\n        return None\n    return a / b\n$$;\n\nSELECT py_safe_divide(10.0, 2.0);   -- \u7ED3\u679C: 5.0\nSELECT py_safe_divide(10.0, 0.0);   -- \u7ED3\u679C: NULL\nSELECT py_safe_divide(10.0, NULL);  -- \u7ED3\u679C: NULL\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u5411\u91CF\u5316\u6A21\u5F0F",children:"\u5411\u91CF\u5316\u6A21\u5F0F"}),"\n",(0,d.jsxs)(e.p,{children:["\u5411\u91CF\u5316\u6A21\u5F0F\u4F7F\u7528 Pandas \u6279\u91CF\u5904\u7406\u6570\u636E\uFF0C\u6027\u80FD\u4F18\u4E8E\u6807\u91CF\u6A21\u5F0F\u3002\u5728\u5411\u91CF\u5316\u6A21\u5F0F\u4E0B\uFF0C\u51FD\u6570\u53C2\u6570\u4E3A ",(0,d.jsx)(e.code,{children:"pandas.Series"})," \u5BF9\u8C61\uFF0C\u8FD4\u56DE\u503C\u4E5F\u5E94\u4E3A ",(0,d.jsx)(e.code,{children:"pandas.Series"}),"\u3002"]}),"\n",(0,d.jsx)(e.admonition,{title:"\u6CE8\u610F",type:"caution",children:(0,d.jsxs)(e.p,{children:["\u4E3A\u786E\u4FDD\u7CFB\u7EDF\u6B63\u786E\u8BC6\u522B\u5411\u91CF\u5316\u6A21\u5F0F\uFF0C\u8BF7\u5728\u51FD\u6570\u7B7E\u540D\u4E2D\u4F7F\u7528\u7C7B\u578B\u6CE8\u89E3(\u5982 ",(0,d.jsx)(e.code,{children:"a: pd.Series"}),")\u5E76\u5728\u51FD\u6570\u903B\u8F91\u4E2D\u76F4\u63A5\u64CD\u4F5C\u6279\u91CF\u6570\u636E\u7ED3\u6784\u3002\u82E5\u672A\u660E\u786E\u4F7F\u7528\u5411\u91CF\u5316\u7C7B\u578B\uFF0C\u7CFB\u7EDF\u5C06\u56DE\u9000\u5230\u6807\u91CF\u6A21\u5F0F(Scalar Mode)\u3002"]})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:"## \u5411\u91CF\u5316\u6A21\u5F0F\ndef add(a: pd.Series, b: pd.Series) -> pd.Series:\n    return a + b + 1\n\n## \u6807\u91CF\u6A21\u5F0F\ndef add(a, b):\n    return a + b + 1\n"})}),"\n",(0,d.jsx)(e.h4,{id:"\u57FA\u672C\u793A\u4F8B",children:"\u57FA\u672C\u793A\u4F8B"}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 1: \u5411\u91CF\u5316\u6574\u6570\u52A0\u6CD5"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_vec_add(INT, INT);\n\nCREATE FUNCTION py_vec_add(INT, INT)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "add",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nimport pandas as pd\n\ndef add(a: pd.Series, b: pd.Series) -> pd.Series:\n    return a + b + 1\n$$;\n\nSELECT py_vec_add(1, 2); -- \u7ED3\u679C: 4\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 2: \u5411\u91CF\u5316\u5B57\u7B26\u4E32\u5904\u7406"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_vec_upper(STRING);\n\nCREATE FUNCTION py_vec_upper(STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "to_upper",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nimport pandas as pd\n\ndef to_upper(s: pd.Series) -> pd.Series:\n    return s.str.upper()\n$$;\n\nSELECT py_vec_upper(\'hello\'); -- \u7ED3\u679C: \'HELLO\'\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 3: \u5411\u91CF\u5316\u6570\u5B66\u8FD0\u7B97"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_vec_sqrt(DOUBLE);\n\nCREATE FUNCTION py_vec_sqrt(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "sqrt",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nimport pandas as pd\nimport numpy as np\n\ndef sqrt(x: pd.Series) -> pd.Series:\n    return np.sqrt(x)\n$$;\n\nSELECT py_vec_sqrt(16); -- \u7ED3\u679C: 4.0\n'})}),"\n",(0,d.jsx)(e.h4,{id:"\u5411\u91CF\u5316\u6A21\u5F0F\u7684\u4F18\u52BF",children:"\u5411\u91CF\u5316\u6A21\u5F0F\u7684\u4F18\u52BF"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u6027\u80FD\u4F18\u5316"}),": \u6279\u91CF\u5904\u7406\u6570\u636E\uFF0C\u51CF\u5C11 Python \u4E0E Doris \u4E4B\u95F4\u7684\u4EA4\u4E92\u6B21\u6570"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5229\u7528 Pandas/NumPy"}),": \u5145\u5206\u53D1\u6325\u5411\u91CF\u5316\u8BA1\u7B97\u7684\u6027\u80FD\u4F18\u52BF"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u7B80\u6D01\u4EE3\u7801"}),": \u4F7F\u7528 Pandas API \u53EF\u4EE5\u66F4\u7B80\u6D01\u5730\u8868\u8FBE\u590D\u6742\u903B\u8F91"]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"\u4F7F\u7528\u5411\u91CF\u5316\u51FD\u6570",children:"\u4F7F\u7528\u5411\u91CF\u5316\u51FD\u6570"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"DROP TABLE IF EXISTS test_table;\n\nCREATE TABLE test_table (\n    id INT,\n    value INT,\n    text STRING,\n    score DOUBLE\n) ENGINE=OLAP\nDUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO test_table VALUES\n(1, 10, 'hello', 85.5),\n(2, 20, 'world', 92.0),\n(3, 30, 'python', 78.3);\n\nSELECT \n    id,\n    py_vec_add(value, value) AS sum_result,\n    py_vec_upper(text) AS upper_text,\n    py_vec_sqrt(score) AS sqrt_score\nFROM test_table;\n\n+------+------------+------------+-------------------+\n| id   | sum_result | upper_text | sqrt_score        |\n+------+------------+------------+-------------------+\n|    1 |         21 | HELLO      | 9.246621004453464 |\n|    2 |         41 | WORLD      | 9.591663046625438 |\n|    3 |         61 | PYTHON     | 8.848728722251575 |\n+------+------------+------------+-------------------+\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u590D\u6742\u6570\u636E\u7C7B\u578B\u5904\u7406",children:"\u590D\u6742\u6570\u636E\u7C7B\u578B\u5904\u7406"}),"\n",(0,d.jsx)(e.h4,{id:"array-\u7C7B\u578B",children:"ARRAY \u7C7B\u578B"}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B: \u6570\u7EC4\u5143\u7D20\u6C42\u548C"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_array_sum(ARRAY<INT>);\n\nCREATE FUNCTION py_array_sum(ARRAY<INT>)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(arr):\n    """ Doris\u4E2D\u7684ARRAY\u7C7B\u578B\u5BF9\u5E94Python\u4E2D\u7684list """\n    if arr is None:\n        return None\n    return sum(arr)\n$$;\n\nSELECT py_array_sum([1, 2, 3, 4, 5]) AS result; -- \u7ED3\u679C: 15\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B: \u6570\u7EC4\u8FC7\u6EE4"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_array_filter_positive(ARRAY<INT>);\n\nCREATE FUNCTION py_array_filter_positive(ARRAY<INT>)\nRETURNS ARRAY<INT>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(arr):\n    if arr is None:\n        return None\n    return [x for x in arr if x > 0]\n$$;\n\nSELECT py_array_filter_positive([1, -2, 3, -4, 5]) AS result; -- \u7ED3\u679C: [1, 3, 5]\n'})}),"\n",(0,d.jsx)(e.h4,{id:"map-\u7C7B\u578B",children:"MAP \u7C7B\u578B"}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B: \u83B7\u53D6 MAP \u7684\u952E\u6570\u91CF"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_map_size(MAP<STRING, INT>);\n\nCREATE FUNCTION py_map_size(MAP<STRING, INT>)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(m):\n    """ Doris\u4E2D\u7684MAP\u7C7B\u578B\u5BF9\u5E94Python\u4E2D\u7684dict """\n    if m is None:\n        return None\n    return len(m)\n$$;\n\nSELECT py_map_size({\'a\': 1, \'b\': 2, \'c\': 3}) AS result; -- \u7ED3\u679C: 3\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B: \u83B7\u53D6 MAP \u4E2D\u7684\u503C"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_map_get(MAP<STRING, STRING>, STRING);\n\nCREATE FUNCTION py_map_get(MAP<STRING, STRING>, STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(m, key):\n    if m is None or key is None:\n        return None\n    return m.get(key)\n$$;\n\nSELECT py_map_get({\'name\': \'Alice\', \'age\': \'30\'}, \'name\') AS result; -- \u7ED3\u679C: Alice\n'})}),"\n",(0,d.jsx)(e.h4,{id:"struct-\u7C7B\u578B",children:"STRUCT \u7C7B\u578B"}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B: \u8BBF\u95EE STRUCT \u5B57\u6BB5"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_struct_get_name(STRUCT<name: STRING, age: INT>);\n\nCREATE FUNCTION py_struct_get_name(STRUCT<name: STRING, age: INT>)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(s):\n    """ Doris\u4E2D\u7684STRUCT\u7C7B\u578B\u5BF9\u5E94Python\u4E2D\u7684dict """\n    if s is None:\n        return None\n    return s.get(\'name\')\n$$;\n\nSELECT py_struct_get_name({\'Alice\', 30}) AS result; -- \u7ED3\u679C: Alice\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u5B9E\u9645\u5E94\u7528\u573A\u666F",children:"\u5B9E\u9645\u5E94\u7528\u573A\u666F"}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-1-\u6570\u636E\u8131\u654F",children:"\u573A\u666F 1: \u6570\u636E\u8131\u654F"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_mask_email(STRING);\n\nCREATE FUNCTION py_mask_email(STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12"\n)\nAS $$\ndef evaluate(email):\n    if email is None or \'@\' not in email:\n        return None\n    parts = email.split(\'@\')\n    if len(parts[0]) <= 1:\n        return email\n    masked_user = parts[0][0] + \'***\'\n    return f"{masked_user}@{parts[1]}"\n$$;\n\nSELECT py_mask_email(\'user@example.com\') AS masked; -- \u7ED3\u679C: u***@example.com\n'})}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-2-\u5B57\u7B26\u4E32\u76F8\u4F3C\u5EA6\u8BA1\u7B97",children:"\u573A\u666F 2: \u5B57\u7B26\u4E32\u76F8\u4F3C\u5EA6\u8BA1\u7B97"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_levenshtein_distance(STRING, STRING);\n\nCREATE FUNCTION py_levenshtein_distance(STRING, STRING)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12"\n)\nAS $$\ndef evaluate(s1, s2):\n    if s1 is None or s2 is None:\n        return None\n    if len(s1) < len(s2):\n        return evaluate(s2, s1)\n    if len(s2) == 0:\n        return len(s1)\n    \n    previous_row = range(len(s2) + 1)\n    for i, c1 in enumerate(s1):\n        current_row = [i + 1]\n        for j, c2 in enumerate(s2):\n            insertions = previous_row[j + 1] + 1\n            deletions = current_row[j] + 1\n            substitutions = previous_row[j] + (c1 != c2)\n            current_row.append(min(insertions, deletions, substitutions))\n        previous_row = current_row\n    \n    return previous_row[-1]\n$$;\n\nSELECT py_levenshtein_distance(\'kitten\', \'sitting\') AS distance; -- \u7ED3\u679C: 3\n'})}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-3-\u65E5\u671F\u8BA1\u7B97",children:"\u573A\u666F 3: \u65E5\u671F\u8BA1\u7B97"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_days_between(DATE, DATE);\n\nCREATE FUNCTION py_days_between(DATE, DATE)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12"\n)\nAS $$\nfrom datetime import datetime\n\ndef evaluate(date1_str, date2_str):\n    if date1_str is None or date2_str is None:\n        return None\n    try:\n        d1 = datetime.strptime(str(date1_str), \'%Y-%m-%d\')\n        d2 = datetime.strptime(str(date2_str), \'%Y-%m-%d\')\n        return abs((d2 - d1).days)\n    except:\n        return None\n$$;\n\nSELECT py_days_between(\'2024-01-01\', \'2024-12-31\') AS days; -- \u7ED3\u679C: 365\n'})}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-4-\u8EAB\u4EFD\u8BC1\u53F7\u6821\u9A8C",children:"\u573A\u666F 4: \u8EAB\u4EFD\u8BC1\u53F7\u6821\u9A8C"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS py_validate_id_card(STRING);\n\nCREATE FUNCTION py_validate_id_card(STRING)\nRETURNS BOOLEAN\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"evaluate\",\n    \"runtime_version\" = \"3.10.12\"\n)\nAS $$\ndef evaluate(id_card):\n    if id_card is None or len(id_card) != 18:\n        return False\n    \n    # \u6821\u9A8C\u524D17\u4F4D\u662F\u5426\u4E3A\u6570\u5B57\n    if not id_card[:17].isdigit():\n        return False\n    \n    # \u6821\u9A8C\u7801\u6743\u91CD\n    weights = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2]\n    check_codes = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2']\n    \n    # \u8BA1\u7B97\u6821\u9A8C\u7801\n    total = sum(int(id_card[i]) * weights[i] for i in range(17))\n    check_code = check_codes[total % 11]\n    \n    return id_card[17].upper() == check_code\n$$;\n\nSELECT py_validate_id_card('11010519491231002X') AS is_valid; -- \u7ED3\u679C: True\n\nSELECT py_validate_id_card('110105194912310021x') AS is_valid; -- \u7ED3\u679C: False\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE",children:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE"}),"\n",(0,d.jsx)(e.h4,{id:"1-\u4F18\u5148\u4F7F\u7528\u5411\u91CF\u5316\u6A21\u5F0F",children:"1. \u4F18\u5148\u4F7F\u7528\u5411\u91CF\u5316\u6A21\u5F0F"}),"\n",(0,d.jsx)(e.p,{children:"\u5411\u91CF\u5316\u6A21\u5F0F\u6027\u80FD\u663E\u8457\u4F18\u4E8E\u6807\u91CF\u6A21\u5F0F:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:"# \u6807\u91CF\u6A21\u5F0F - \u9010\u884C\u5904\u7406\ndef scalar_process(x):\n    return x * 2\n\n# \u5411\u91CF\u5316\u6A21\u5F0F - \u6279\u91CF\u5904\u7406\nimport pandas as pd\ndef vector_process(x: pd.Series) -> pd.Series:\n    return x * 2\n"})}),"\n",(0,d.jsx)(e.h4,{id:"2-\u4F7F\u7528\u6A21\u5757\u6A21\u5F0F\u7BA1\u7406\u590D\u6742\u903B\u8F91",children:"2. \u4F7F\u7528\u6A21\u5757\u6A21\u5F0F\u7BA1\u7406\u590D\u6742\u903B\u8F91"}),"\n",(0,d.jsx)(e.p,{children:"\u5C06\u590D\u6742\u7684\u51FD\u6570\u903B\u8F91\u653E\u5728\u72EC\u7ACB\u7684 Python \u6587\u4EF6\u4E2D\uFF0C\u4FBF\u4E8E\u7EF4\u62A4\u548C\u590D\u7528\u3002"}),"\n",(0,d.jsx)(e.h4,{id:"3-\u907F\u514D\u5728\u51FD\u6570\u4E2D\u6267\u884C-io-\u64CD\u4F5C",children:"3. \u907F\u514D\u5728\u51FD\u6570\u4E2D\u6267\u884C I/O \u64CD\u4F5C"}),"\n",(0,d.jsx)(e.p,{children:"\u4E0D\u5EFA\u8BAE\u5728 UDF \u4E2D\u8FDB\u884C\u6587\u4EF6\u8BFB\u5199\u3001\u7F51\u7EDC\u8BF7\u6C42\u7B49 I/O \u64CD\u4F5C\uFF0C\u8FD9\u4F1A\u4E25\u91CD\u5F71\u54CD\u6027\u80FD\u3002"}),"\n",(0,d.jsx)(e.h3,{id:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879",children:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,d.jsx)(e.h4,{id:"1-python-\u7248\u672C\u652F\u6301",children:"1. Python \u7248\u672C\u652F\u6301"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u4EC5\u652F\u6301 Python 3.x \u7248\u672C"}),"\n",(0,d.jsx)(e.li,{children:"\u5EFA\u8BAE\u4F7F\u7528 Python 3.10 \u6216\u66F4\u9AD8\u7248\u672C"}),"\n",(0,d.jsx)(e.li,{children:"\u786E\u4FDD Doris \u96C6\u7FA4\u5DF2\u5B89\u88C5\u5BF9\u5E94\u7684 Python \u8FD0\u884C\u65F6"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"2-\u4F9D\u8D56\u5E93",children:"2. \u4F9D\u8D56\u5E93"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u5185\u7F6E\u652F\u6301 Python \u6807\u51C6\u5E93"}),"\n",(0,d.jsx)(e.li,{children:"\u5982\u9700\u4F7F\u7528\u7B2C\u4E09\u65B9\u5E93\uFF0C\u9700\u8981\u5728\u96C6\u7FA4\u73AF\u5883\u4E2D\u9884\u5148\u5B89\u88C5"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"3-\u6027\u80FD\u8003\u8651",children:"3. \u6027\u80FD\u8003\u8651"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"Python UDF \u6027\u80FD\u4F4E\u4E8E Doris \u5185\u7F6E\u51FD\u6570(C++ \u5B9E\u73B0)"}),"\n",(0,d.jsx)(e.li,{children:"\u5BF9\u4E8E\u6027\u80FD\u654F\u611F\u573A\u666F\uFF0C\u5EFA\u8BAE\u4F18\u5148\u8003\u8651 Doris \u5185\u7F6E\u51FD\u6570"}),"\n",(0,d.jsx)(e.li,{children:"\u5927\u6570\u636E\u91CF\u573A\u666F\u5EFA\u8BAE\u4F7F\u7528\u5411\u91CF\u5316\u6A21\u5F0F"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"4-\u5B89\u5168\u6027",children:"4. \u5B89\u5168\u6027"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"UDF \u4EE3\u7801\u5728 Doris \u8FDB\u7A0B\u4E2D\u6267\u884C\uFF0C\u9700\u8981\u786E\u4FDD\u4EE3\u7801\u5B89\u5168\u53EF\u4FE1"}),"\n",(0,d.jsx)(e.li,{children:"\u907F\u514D\u5728 UDF \u4E2D\u6267\u884C\u5371\u9669\u64CD\u4F5C(\u5982\u7CFB\u7EDF\u547D\u4EE4\u3001\u6587\u4EF6\u5220\u9664\u7B49)"}),"\n",(0,d.jsx)(e.li,{children:"\u751F\u4EA7\u73AF\u5883\u5EFA\u8BAE\u5BF9 UDF \u4EE3\u7801\u8FDB\u884C\u5BA1\u6838"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"5-\u8D44\u6E90\u9650\u5236",children:"5. \u8D44\u6E90\u9650\u5236"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"UDF \u6267\u884C\u4F1A\u5360\u7528 BE \u8282\u70B9\u7684 CPU \u548C\u5185\u5B58\u8D44\u6E90"}),"\n",(0,d.jsx)(e.li,{children:"\u5927\u91CF\u4F7F\u7528 UDF \u53EF\u80FD\u5F71\u54CD\u96C6\u7FA4\u6574\u4F53\u6027\u80FD"}),"\n",(0,d.jsx)(e.li,{children:"\u5EFA\u8BAE\u76D1\u63A7 UDF \u7684\u8D44\u6E90\u6D88\u8017\u60C5\u51B5"}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u5E38\u89C1\u95EE\u9898",children:"\u5E38\u89C1\u95EE\u9898"}),"\n",(0,d.jsx)(e.h4,{id:"q1-\u5982\u4F55\u5728-python-udf-\u4E2D\u4F7F\u7528\u7B2C\u4E09\u65B9\u5E93",children:"Q1: \u5982\u4F55\u5728 Python UDF \u4E2D\u4F7F\u7528\u7B2C\u4E09\u65B9\u5E93?"}),"\n",(0,d.jsx)(e.p,{children:"A: \u9700\u8981\u5728\u6240\u6709 BE \u8282\u70B9\u4E0A\u5B89\u88C5\u5BF9\u5E94\u7684 Python \u5E93\u3002\u4F8B\u5982:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"pip3 install numpy pandas\nconda install numpy pandas\n"})}),"\n",(0,d.jsx)(e.h4,{id:"q2-python-udf-\u662F\u5426\u652F\u6301\u9012\u5F52\u51FD\u6570",children:"Q2: Python UDF \u662F\u5426\u652F\u6301\u9012\u5F52\u51FD\u6570?"}),"\n",(0,d.jsx)(e.p,{children:"A: \u652F\u6301\uFF0C\u4F46\u9700\u8981\u6CE8\u610F\u9012\u5F52\u6DF1\u5EA6\uFF0C\u907F\u514D\u6808\u6EA2\u51FA\u3002"}),"\n",(0,d.jsx)(e.h4,{id:"q3-\u5982\u4F55\u8C03\u8BD5-python-udf",children:"Q3: \u5982\u4F55\u8C03\u8BD5 Python UDF?"}),"\n",(0,d.jsx)(e.p,{children:"A: \u53EF\u4EE5\u5728\u672C\u5730 Python \u73AF\u5883\u4E2D\u5148\u8C03\u8BD5\u51FD\u6570\u903B\u8F91\uFF0C\u786E\u4FDD\u65E0\u8BEF\u540E\u518D\u521B\u5EFA UDF\u3002\u53EF\u4EE5\u67E5\u770B BE \u65E5\u5FD7\u83B7\u53D6\u9519\u8BEF\u4FE1\u606F\u3002"}),"\n",(0,d.jsx)(e.h4,{id:"q4-python-udf-\u662F\u5426\u652F\u6301\u5168\u5C40\u53D8\u91CF",children:"Q4: Python UDF \u662F\u5426\u652F\u6301\u5168\u5C40\u53D8\u91CF?"}),"\n",(0,d.jsx)(e.p,{children:"A: \u652F\u6301\uFF0C\u4F46\u4E0D\u5EFA\u8BAE\u4F7F\u7528\u5168\u5C40\u53D8\u91CF\uFF0C\u56E0\u4E3A\u5728\u5206\u5E03\u5F0F\u73AF\u5883\u4E2D\u5168\u5C40\u53D8\u91CF\u7684\u884C\u4E3A\u53EF\u80FD\u4E0D\u7B26\u5408\u9884\u671F\u3002"}),"\n",(0,d.jsx)(e.h4,{id:"q5-\u5982\u4F55\u66F4\u65B0\u5DF2\u5B58\u5728\u7684-python-udf",children:"Q5: \u5982\u4F55\u66F4\u65B0\u5DF2\u5B58\u5728\u7684 Python UDF?"}),"\n",(0,d.jsx)(e.p,{children:"A: \u5148\u5220\u9664\u65E7\u7684 UDF\uFF0C\u518D\u521B\u5EFA\u65B0\u7684:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS function_name(parameter_types);\nCREATE FUNCTION function_name(...) ...;\n"})}),"\n",(0,d.jsx)(e.h4,{id:"q6-python-udf-\u80FD\u5426\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90",children:"Q6: Python UDF \u80FD\u5426\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90?"}),"\n",(0,d.jsxs)(e.p,{children:["A: \u6280\u672F\u4E0A\u53EF\u4EE5\uFF0C\u4F46",(0,d.jsx)(e.strong,{children:"\u5F3A\u70C8\u4E0D\u5EFA\u8BAE"}),"\u3002Python UDF \u4E2D\u53EF\u4EE5\u4F7F\u7528\u7F51\u7EDC\u8BF7\u6C42\u5E93(\u5982 ",(0,d.jsx)(e.code,{children:"requests"}),")\u8BBF\u95EE\u5916\u90E8 API\u3001\u6570\u636E\u5E93\u7B49\uFF0C\u4F46\u8FD9\u4F1A\u4E25\u91CD\u5F71\u54CD\u6027\u80FD\u548C\u7A33\u5B9A\u6027\u3002\u539F\u56E0\u5305\u62EC:"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u7F51\u7EDC\u5EF6\u8FDF\u4F1A\u5BFC\u81F4\u67E5\u8BE2\u53D8\u6162"}),"\n",(0,d.jsx)(e.li,{children:"\u5916\u90E8\u670D\u52A1\u4E0D\u53EF\u7528\u65F6\u4F1A\u5BFC\u81F4 UDF \u5931\u8D25"}),"\n",(0,d.jsx)(e.li,{children:"\u5927\u91CF\u5E76\u53D1\u8BF7\u6C42\u53EF\u80FD\u9020\u6210\u5916\u90E8\u670D\u52A1\u538B\u529B"}),"\n",(0,d.jsx)(e.li,{children:"\u96BE\u4EE5\u63A7\u5236\u8D85\u65F6\u548C\u9519\u8BEF\u5904\u7406"}),"\n"]}),"\n",(0,d.jsx)(e.h2,{id:"python-udaf",children:"Python UDAF"}),"\n",(0,d.jsx)(e.p,{children:"Python UDAF (User Defined Aggregate Function) \u662F Apache Doris \u63D0\u4F9B\u7684\u81EA\u5B9A\u4E49\u805A\u5408\u51FD\u6570\u6269\u5C55\u673A\u5236\uFF0C\u5141\u8BB8\u7528\u6237\u4F7F\u7528 Python \u8BED\u8A00\u7F16\u5199\u81EA\u5B9A\u4E49\u805A\u5408\u51FD\u6570\uFF0C\u7528\u4E8E\u6570\u636E\u5206\u7EC4\u805A\u5408\u548C\u7A97\u53E3\u8BA1\u7B97\u3002\u901A\u8FC7 Python UDAF\uFF0C\u7528\u6237\u53EF\u4EE5\u7075\u6D3B\u5730\u5B9E\u73B0\u590D\u6742\u7684\u805A\u5408\u903B\u8F91\uFF0C\u5982\u7EDF\u8BA1\u5206\u6790\u3001\u6570\u636E\u6536\u96C6\u3001\u81EA\u5B9A\u4E49\u6307\u6807\u8BA1\u7B97\u7B49\u3002"}),"\n",(0,d.jsx)(e.p,{children:"Python UDAF \u7684\u6838\u5FC3\u7279\u70B9:"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5206\u5E03\u5F0F\u805A\u5408"}),": \u652F\u6301\u5206\u5E03\u5F0F\u73AF\u5883\u4E0B\u7684\u6570\u636E\u805A\u5408\uFF0C\u81EA\u52A8\u5904\u7406\u6570\u636E\u7684\u5206\u533A\u3001\u5408\u5E76\u548C\u6700\u7EC8\u8BA1\u7B97"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u72B6\u6001\u7BA1\u7406"}),": \u901A\u8FC7\u7C7B\u5B9E\u4F8B\u7EF4\u62A4\u805A\u5408\u72B6\u6001\uFF0C\u652F\u6301\u590D\u6742\u7684\u72B6\u6001\u5BF9\u8C61"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u7A97\u53E3\u51FD\u6570\u652F\u6301"}),": \u53EF\u7528\u4E8E\u7A97\u53E3\u51FD\u6570 (OVER \u5B50\u53E5)\uFF0C\u5B9E\u73B0\u79FB\u52A8\u805A\u5408\u3001\u6392\u540D\u7B49\u9AD8\u7EA7\u529F\u80FD"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u7075\u6D3B\u6027\u5F3A"}),": \u53EF\u5B9E\u73B0\u4EFB\u610F\u590D\u6742\u7684\u805A\u5408\u903B\u8F91\uFF0C\u4E0D\u53D7\u5185\u7F6E\u805A\u5408\u51FD\u6570\u9650\u5236"]}),"\n"]}),"\n",(0,d.jsxs)(e.admonition,{title:"\u63D0\u793A",type:"tip",children:[(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u73AF\u5883\u4F9D\u8D56"}),": \u4F7F\u7528 Python UDAF \u524D\uFF0C\u5FC5\u987B\u5728\u6240\u6709 BE \u8282\u70B9\u7684 Python \u73AF\u5883\u4E2D\u9884\u5148\u5B89\u88C5 ",(0,d.jsx)(e.strong,{children:(0,d.jsx)(e.code,{children:"pandas"})})," \u548C ",(0,d.jsx)(e.strong,{children:(0,d.jsx)(e.code,{children:"pyarrow"})})," \u4E24\u4E2A\u5E93\uFF0C\u8FD9\u662F Doris Python UDAF \u529F\u80FD\u7684\u5F3A\u5236\u4F9D\u8D56\u3002\u8BE6\u89C1 ",(0,d.jsx)(e.a,{href:"python-user-defined-function#python-udfudafudtf-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86",children:"Python UDAF \u73AF\u5883\u914D\u7F6E"}),"\u3002"]}),(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u65E5\u5FD7\u8DEF\u5F84"}),": Python UDAF Server \u7684\u8FD0\u884C\u65E5\u5FD7\u4F4D\u4E8E ",(0,d.jsx)(e.code,{children:"output/be/log/python_udf_output.log"}),"\u3002\u7528\u6237\u53EF\u4EE5\u5728\u8BE5\u65E5\u5FD7\u4E2D\u67E5\u770B Python Server \u7684\u8FD0\u884C\u60C5\u51B5\u3001\u805A\u5408\u51FD\u6570\u6267\u884C\u4FE1\u606F\u548C\u8C03\u8BD5\u9519\u8BEF\u3002"]})]}),"\n",(0,d.jsx)(e.h3,{id:"udaf-\u57FA\u672C\u6982\u5FF5",children:"UDAF \u57FA\u672C\u6982\u5FF5"}),"\n",(0,d.jsx)(e.h4,{id:"\u805A\u5408\u51FD\u6570\u7684\u751F\u547D\u5468\u671F",children:"\u805A\u5408\u51FD\u6570\u7684\u751F\u547D\u5468\u671F"}),"\n",(0,d.jsx)(e.p,{children:"Python UDAF \u901A\u8FC7\u7C7B\u6765\u5B9E\u73B0\uFF0C\u4E00\u4E2A\u805A\u5408\u51FD\u6570\u7684\u6267\u884C\u5305\u542B\u4EE5\u4E0B\u9636\u6BB5:"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsxs)(e.strong,{children:["\u521D\u59CB\u5316 (",(0,d.jsx)(e.strong,{children:"init"}),")"]}),": \u521B\u5EFA\u805A\u5408\u72B6\u6001\u5BF9\u8C61\uFF0C\u521D\u59CB\u5316\u72B6\u6001\u53D8\u91CF"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u7D2F\u79EF (accumulate)"}),": \u5904\u7406\u5355\u884C\u6570\u636E\uFF0C\u66F4\u65B0\u805A\u5408\u72B6\u6001"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5408\u5E76 (merge)"}),": \u5408\u5E76\u591A\u4E2A\u5206\u533A\u7684\u805A\u5408\u72B6\u6001\uFF08\u5206\u5E03\u5F0F\u573A\u666F\uFF09"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5B8C\u6210 (finish)"}),": \u8BA1\u7B97\u5E76\u8FD4\u56DE\u6700\u7EC8\u805A\u5408\u7ED3\u679C"]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"\u5FC5\u9700\u7684\u7C7B\u65B9\u6CD5\u548C\u5C5E\u6027",children:"\u5FC5\u9700\u7684\u7C7B\u65B9\u6CD5\u548C\u5C5E\u6027"}),"\n",(0,d.jsx)(e.p,{children:"\u4E00\u4E2A\u5B8C\u6574\u7684 Python UDAF \u7C7B\u5FC5\u987B\u5B9E\u73B0\u4EE5\u4E0B\u65B9\u6CD5:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u65B9\u6CD5/\u5C5E\u6027"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"}),(0,d.jsx)(e.th,{children:"\u662F\u5426\u5FC5\u9700"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"__init__(self)"})}),(0,d.jsx)(e.td,{children:"\u521D\u59CB\u5316\u805A\u5408\u72B6\u6001"}),(0,d.jsx)(e.td,{children:"\u662F"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"accumulate(self, *args)"})}),(0,d.jsx)(e.td,{children:"\u7D2F\u79EF\u5355\u884C\u6570\u636E"}),(0,d.jsx)(e.td,{children:"\u662F"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"merge(self, other_state)"})}),(0,d.jsx)(e.td,{children:"\u5408\u5E76\u5176\u4ED6\u5206\u533A\u7684\u72B6\u6001"}),(0,d.jsx)(e.td,{children:"\u662F"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"finish(self)"})}),(0,d.jsx)(e.td,{children:"\u8FD4\u56DE\u6700\u7EC8\u805A\u5408\u7ED3\u679C"}),(0,d.jsx)(e.td,{children:"\u662F"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"aggregate_state"})," (\u5C5E\u6027)"]}),(0,d.jsxs)(e.td,{children:["\u8FD4\u56DE\u53EF\u5E8F\u5217\u5316\u7684\u805A\u5408\u72B6\u6001\uFF0C",(0,d.jsx)(e.strong,{children:"\u5FC5\u987B\u652F\u6301 pickle \u5E8F\u5217\u5316"})]}),(0,d.jsx)(e.td,{children:"\u662F"})]})]})]}),"\n",(0,d.jsx)(e.h3,{id:"\u57FA\u672C\u8BED\u6CD5",children:"\u57FA\u672C\u8BED\u6CD5"}),"\n",(0,d.jsx)(e.h4,{id:"\u521B\u5EFA-python-udaf",children:"\u521B\u5EFA Python UDAF"}),"\n",(0,d.jsxs)(e.p,{children:["Python UDAF \u652F\u6301\u4E24\u79CD\u521B\u5EFA\u65B9\u5F0F:",(0,d.jsx)(e.code,{children:"\u5185\u8054\u6A21\u5F0F (Inline)"})," \u548C ",(0,d.jsx)(e.code,{children:"\u6A21\u5757\u6A21\u5F0F (Module)"}),"\u3002"]}),"\n",(0,d.jsx)(e.admonition,{title:"\u6CE8\u610F",type:"tip",children:(0,d.jsxs)(e.p,{children:["\u5982\u679C\u540C\u65F6\u6307\u5B9A\u4E86 ",(0,d.jsx)(e.code,{children:"file"})," \u53C2\u6570\u548C ",(0,d.jsx)(e.code,{children:"AS $$"})," \u5185\u8054 Python \u4EE3\u7801\uFF0CDoris \u5C06\u4F1A",(0,d.jsx)(e.strong,{children:"\u4F18\u5148\u52A0\u8F7D\u5185\u8054 Python \u4EE3\u7801"}),"\uFF0C\u91C7\u7528\u5185\u8054\u6A21\u5F0F\u8FD0\u884C Python UDAF\u3002"]})}),"\n",(0,d.jsx)(e.h5,{id:"\u5185\u8054\u6A21\u5F0F-inline-mode-1",children:"\u5185\u8054\u6A21\u5F0F (Inline Mode)"}),"\n",(0,d.jsx)(e.p,{children:"\u5185\u8054\u6A21\u5F0F\u5141\u8BB8\u76F4\u63A5\u5728 SQL \u4E2D\u7F16\u5199 Python \u7C7B\uFF0C\u9002\u5408\u7B80\u5355\u7684\u805A\u5408\u903B\u8F91\u3002"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u8BED\u6CD5"}),":"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'CREATE AGGREGATE FUNCTION function_name(parameter_type1, parameter_type2, ...)\nRETURNS return_type\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "ClassName",\n    "runtime_version" = "python_version",\n    "always_nullable" = "true|false"\n)\nAS $$\nclass ClassName:\n    def __init__(self):\n        # \u521D\u59CB\u5316\u72B6\u6001\u53D8\u91CF\n        \n    @property\n    def aggregate_state(self):\n        # \u8FD4\u56DE\u53EF\u5E8F\u5217\u5316\u7684\u72B6\u6001\n        \n    def accumulate(self, *args):\n        # \u7D2F\u79EF\u6570\u636E\n        \n    def merge(self, other_state):\n        # \u5408\u5E76\u72B6\u6001\n        \n    def finish(self):\n        # \u8FD4\u56DE\u6700\u7EC8\u7ED3\u679C\n$$;\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 1: \u6C42\u548C\u805A\u5408"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP TABLE IF EXISTS sales;\n\nCREATE TABLE IF NOT EXISTS sales (\n    id INT,\n    category VARCHAR(50),\n    amount INT\n) DUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 1\nPROPERTIES("replication_num" = "1");\n\nINSERT INTO sales VALUES \n(1, \'Electronics\', 1000),\n(2, \'Electronics\', 1500),\n(3, \'Books\', 200),\n(4, \'Books\', 300),\n(5, \'Clothing\', 500),\n(6, \'Clothing\', 800),\n(7, \'Electronics\', 2000),\n(8, \'Books\', 150);\n\nDROP FUNCTION IF EXISTS py_sum(INT);\n\nCREATE AGGREGATE FUNCTION py_sum(INT)\nRETURNS BIGINT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "SumUDAF",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nclass SumUDAF:\n    def __init__(self):\n        self.total = 0\n    \n    @property\n    def aggregate_state(self):\n        return self.total\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.total += value\n    \n    def merge(self, other_state):\n        self.total += other_state\n    \n    def finish(self):\n        return self.total\n$$;\n\nSELECT category, py_sum(amount) as total_amount\nFROM sales\nGROUP BY category\nORDER BY category;\n\n+-------------+--------------+\n| category    | total_amount |\n+-------------+--------------+\n| Books       |          650 |\n| Clothing    |         1300 |\n| Electronics |         4500 |\n+-------------+--------------+\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 2: \u5E73\u5747\u503C\u805A\u5408"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"DROP TABLE IF EXISTS employees;\n\nCREATE TABLE IF NOT EXISTS employees (\n    id INT,\n    name VARCHAR(100),\n    department VARCHAR(50),\n    salary DOUBLE\n) DUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO employees VALUES \n(1, 'Alice', 'Engineering', 80000.0),\n(2, 'Bob', 'Engineering', 90000.0),\n(3, 'Charlie', 'Sales', 60000.0),\n(4, 'David', 'Sales', 80000.0),\n(5, 'Eve', 'HR', 50000.0),\n(6, 'Frank', 'Engineering', 70000.0),\n(7, 'Grace', 'HR', 70000.0);\n\nDROP FUNCTION IF EXISTS py_avg(DOUBLE);\n\nCREATE AGGREGATE FUNCTION py_avg(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"AvgUDAF\",\n    \"runtime_version\" = \"3.10.12\",\n    \"always_nullable\" = \"true\"\n)\nAS $$\nclass AvgUDAF:\n    def __init__(self):\n        self.sum = 0.0\n        self.count = 0\n    \n    @property\n    def aggregate_state(self):\n        return (self.sum, self.count)\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.sum += value\n            self.count += 1\n    \n    def merge(self, other_state):\n        other_sum, other_count = other_state\n        self.sum += other_sum\n        self.count += other_count\n    \n    def finish(self):\n        if self.count == 0:\n            return None\n        return self.sum / self.count\n$$;\n\nSELECT department, py_avg(salary) as avg_salary\nFROM employees\nGROUP BY department\nORDER BY department;\n\n+-------------+------------+\n| department  | avg_salary |\n+-------------+------------+\n| Engineering |      80000 |\n| HR          |      60000 |\n| Sales       |      70000 |\n+-------------+------------+\n"})}),"\n",(0,d.jsx)(e.h5,{id:"\u6A21\u5757\u6A21\u5F0F-module-mode-1",children:"\u6A21\u5757\u6A21\u5F0F (Module Mode)"}),"\n",(0,d.jsxs)(e.p,{children:["\u6A21\u5757\u6A21\u5F0F\u9002\u5408\u590D\u6742\u7684\u805A\u5408\u903B\u8F91\uFF0C\u9700\u8981\u5C06 Python \u4EE3\u7801\u6253\u5305\u6210 ",(0,d.jsx)(e.code,{children:".zip"})," \u538B\u7F29\u5305\uFF0C\u5E76\u5728\u51FD\u6570\u521B\u5EFA\u65F6\u5F15\u7528\u3002"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 1: \u7F16\u5199 Python \u6A21\u5757"})}),"\n",(0,d.jsxs)(e.p,{children:["\u521B\u5EFA ",(0,d.jsx)(e.code,{children:"stats_udaf.py"})," \u6587\u4EF6:"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:'import math\n\nclass VarianceUDAF:\n    """\u8BA1\u7B97\u603B\u4F53\u65B9\u5DEE"""\n    \n    def __init__(self):\n        self.count = 0\n        self.sum_val = 0.0\n        self.sum_sq = 0.0\n    \n    @property\n    def aggregate_state(self):\n        return (self.count, self.sum_val, self.sum_sq)\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.count += 1\n            self.sum_val += value\n            self.sum_sq += value * value\n    \n    def merge(self, other_state):\n        other_count,  other_sum,  other_sum_sq = other_state\n        self.count += other_count\n        self.sum_val += other_sum\n        self.sum_sq += other_sum_sq\n    \n    def finish(self):\n        if self.count == 0:\n            return None\n        mean = self.sum_val / self.count\n        variance = (self.sum_sq / self.count) - (mean * mean)\n        return variance\n\n\nclass StdDevUDAF:\n    """\u8BA1\u7B97\u603B\u4F53\u6807\u51C6\u5DEE"""\n    \n    def __init__(self):\n        self.count = 0\n        self.sum_val = 0.0\n        self.sum_sq = 0.0\n    \n    @property\n    def aggregate_state(self):\n        return (self.count, self.sum_val, self.sum_sq)\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.count += 1\n            self.sum_val += value\n            self.sum_sq += value * value\n    \n    def merge(self, other_state):\n        other_count, other_sum, other_sum_sq = other_state\n        self.count += other_count\n        self.sum_val += other_sum\n        self.sum_sq += other_sum_sq\n    \n    def finish(self):\n        if self.count == 0:\n            return None\n        mean = self.sum_val / self.count\n        variance = (self.sum_sq / self.count) - (mean * mean)\n        return math.sqrt(max(0, variance))\n\n\nclass MedianUDAF:\n    """\u8BA1\u7B97\u4E2D\u4F4D\u6570"""\n    \n    def __init__(self):\n        self.values = []\n    \n    @property\n    def aggregate_state(self):\n        return self.values\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.values.append(value)\n    \n    def merge(self, other_state):\n        if other_state:\n            self.values.extend(other_state)\n    \n    def finish(self):\n        if not self.values:\n            return None\n        sorted_vals = sorted(self.values)\n        n = len(sorted_vals)\n        if n % 2 == 0:\n            return (sorted_vals[n//2 - 1] + sorted_vals[n//2]) / 2.0\n        else:\n            return sorted_vals[n//2]\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 2: \u6253\u5305 Python \u6A21\u5757"})}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u5FC5\u987B"}),"\u5C06 Python \u6587\u4EF6\u6253\u5305\u6210 ",(0,d.jsx)(e.code,{children:".zip"})," \u683C\u5F0F(\u5373\u4F7F\u53EA\u6709\u5355\u4E2A\u6587\u4EF6):"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"zip stats_udaf.zip stats_udaf.py\n"})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 3: \u8BBE\u7F6E Python \u6A21\u5757\u538B\u7F29\u5305\u7684\u8DEF\u5F84"})}),"\n",(0,d.jsxs)(e.p,{children:["\u652F\u6301\u591A\u79CD\u90E8\u7F72\u65B9\u5F0F\uFF0C\u901A\u8FC7 ",(0,d.jsx)(e.code,{children:"file"})," \u53C2\u6570\u6307\u5B9A ",(0,d.jsx)(e.code,{children:".zip"})," \u5305\u7684\u8DEF\u5F84:"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u65B9\u5F0F 1: \u672C\u5730\u6587\u4EF6\u7CFB\u7EDF"})," (\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"file://"})," \u534F\u8BAE)"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'"file" = "file:///path/to/stats_udaf.zip"\n'})}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u65B9\u5F0F 2: HTTP/HTTPS \u8FDC\u7A0B\u4E0B\u8F7D"})," (\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"http://"})," \u6216 ",(0,d.jsx)(e.code,{children:"https://"})," \u534F\u8BAE)"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'"file" = "http://example.com/udaf/stats_udaf.zip"\n"file" = "https://s3.amazonaws.com/bucket/stats_udaf.zip"\n'})}),"\n",(0,d.jsxs)(e.blockquote,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u6CE8\u610F"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u4F7F\u7528\u8FDC\u7A0B\u4E0B\u8F7D\u65B9\u5F0F\u65F6\uFF0C\u9700\u786E\u4FDD\u6240\u6709 BE \u8282\u70B9\u90FD\u80FD\u8BBF\u95EE\u8BE5 URL"}),"\n",(0,d.jsx)(e.li,{children:"\u9996\u6B21\u8C03\u7528\u65F6\u4F1A\u4E0B\u8F7D\u6587\u4EF6\uFF0C\u53EF\u80FD\u6709\u4E00\u5B9A\u5EF6\u8FDF"}),"\n",(0,d.jsx)(e.li,{children:"\u6587\u4EF6\u4F1A\u88AB\u7F13\u5B58\uFF0C\u540E\u7EED\u8C03\u7528\u65E0\u9700\u91CD\u590D\u4E0B\u8F7D"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 4: \u8BBE\u7F6E symbol \u53C2\u6570"})}),"\n",(0,d.jsxs)(e.p,{children:["\u5728\u6A21\u5757\u6A21\u5F0F\u4E0B\uFF0C",(0,d.jsx)(e.code,{children:"symbol"})," \u53C2\u6570\u7528\u4E8E\u6307\u5B9A\u7C7B\u5728 ZIP \u5305\u4E2D\u7684\u4F4D\u7F6E\uFF0C\u683C\u5F0F\u4E3A:"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{children:"[package_name.]module_name.ClassName\n"})}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u53C2\u6570\u8BF4\u660E"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"package_name"}),"(\u53EF\u9009): ZIP \u538B\u7F29\u5305\u5185\u9876\u5C42 Python \u5305\u7684\u540D\u79F0"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"module_name"}),"(\u5FC5\u586B): \u5305\u542B\u76EE\u6807\u7C7B\u7684 Python \u6A21\u5757\u6587\u4EF6\u540D(\u4E0D\u542B ",(0,d.jsx)(e.code,{children:".py"})," \u540E\u7F00)"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"ClassName"}),"(\u5FC5\u586B): UDAF \u7C7B\u540D"]}),"\n"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u89E3\u6790\u89C4\u5219"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["Doris \u4F1A\u5C06 ",(0,d.jsx)(e.code,{children:"symbol"})," \u5B57\u7B26\u4E32\u6309 ",(0,d.jsx)(e.code,{children:"."})," \u5206\u5272:\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u5982\u679C\u5F97\u5230",(0,d.jsx)(e.strong,{children:"\u4E24\u4E2A"}),"\u5B50\u5B57\u7B26\u4E32\uFF0C\u5206\u522B\u4E3A ",(0,d.jsx)(e.code,{children:"module_name"})," \u548C ",(0,d.jsx)(e.code,{children:"ClassName"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u5982\u679C\u5F97\u5230",(0,d.jsx)(e.strong,{children:"\u4E09\u4E2A\u53CA\u4EE5\u4E0A"}),"\u7684\u5B50\u5B57\u7B26\u4E32\uFF0C\u5F00\u5934\u4E3A ",(0,d.jsx)(e.code,{children:"package_name"}),"\uFF0C\u4E2D\u95F4\u4E3A ",(0,d.jsx)(e.code,{children:"module_name"}),"\uFF0C\u7ED3\u5C3E\u4E3A ",(0,d.jsx)(e.code,{children:"ClassName"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 5: \u521B\u5EFA UDAF \u51FD\u6570"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_variance(DOUBLE);\nDROP FUNCTION IF EXISTS py_stddev(DOUBLE);\nDROP FUNCTION IF EXISTS py_median(DOUBLE);\n\nCREATE AGGREGATE FUNCTION py_variance(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/stats_udaf.zip",\n    "symbol" = "stats_udaf.VarianceUDAF",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE AGGREGATE FUNCTION py_stddev(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/stats_udaf.zip",\n    "symbol" = "stats_udaf.StdDevUDAF",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE AGGREGATE FUNCTION py_median(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/stats_udaf.zip",\n    "symbol" = "stats_udaf.MedianUDAF",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 6: \u4F7F\u7528\u51FD\u6570"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"DROP TABLE IF EXISTS exam_results;\n\nCREATE TABLE IF NOT EXISTS exam_results (\n    id INT,\n    student_name VARCHAR(100),\n    category VARCHAR(50),\n    score DOUBLE\n) DUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO exam_results VALUES \n(1, 'Alice', 'Math', 85.0),\n(2, 'Bob', 'Math', 92.0),\n(3, 'Charlie', 'Math', 78.0),\n(4, 'David', 'Math', 88.0),\n(5, 'Eve', 'Math', 95.0),\n(6, 'Frank', 'English', 75.0),\n(7, 'Grace', 'English', 82.0),\n(8, 'Henry', 'English', 88.0),\n(9, 'Iris', 'English', 79.0),\n(10, 'Jack', 'Physics', 90.0),\n(11, 'Kate', 'Physics', 85.0),\n(12, 'Lily', 'Physics', 92.0),\n(13, 'Mike', 'Physics', 88.0);\n\nSELECT \n    category,\n    py_variance(score) as variance,\n    py_stddev(score) as std_dev,\n    py_median(score) as median\nFROM exam_results\nGROUP BY category\nORDER BY category;\n\n+----------+-------------------+-------------------+--------+\n| category | variance          | std_dev           | median |\n+----------+-------------------+-------------------+--------+\n| English  |              22.5 | 4.743416490252569 |   80.5 |\n| Math     | 34.64000000000033 | 5.885575587824892 |     88 |\n| Physics  |            6.6875 |  2.58602010819715 |     89 |\n+----------+-------------------+-------------------+--------+\n"})}),"\n",(0,d.jsx)(e.h4,{id:"\u5220\u9664-python-udaf",children:"\u5220\u9664 Python UDAF"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"-- \u8BED\u6CD5\nDROP FUNCTION IF EXISTS function_name(parameter_types);\n\n-- \u793A\u4F8B\nDROP FUNCTION IF EXISTS py_sum(INT);\nDROP FUNCTION IF EXISTS py_avg(DOUBLE);\nDROP FUNCTION IF EXISTS py_variance(DOUBLE);\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u53C2\u6570\u8BF4\u660E-1",children:"\u53C2\u6570\u8BF4\u660E"}),"\n",(0,d.jsx)(e.h4,{id:"create-aggregate-function-\u53C2\u6570",children:"CREATE AGGREGATE FUNCTION \u53C2\u6570"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u53C2\u6570"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"function_name"})}),(0,d.jsx)(e.td,{children:"\u51FD\u6570\u540D\u79F0\uFF0C\u9075\u5FAA SQL \u6807\u8BC6\u7B26\u547D\u540D\u89C4\u5219"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"parameter_types"})}),(0,d.jsxs)(e.td,{children:["\u53C2\u6570\u7C7B\u578B\u5217\u8868\uFF0C\u5982 ",(0,d.jsx)(e.code,{children:"INT"}),"\uFF0C ",(0,d.jsx)(e.code,{children:"DOUBLE"}),"\uFF0C ",(0,d.jsx)(e.code,{children:"STRING"})," \u7B49"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"RETURNS return_type"})}),(0,d.jsx)(e.td,{children:"\u8FD4\u56DE\u503C\u7C7B\u578B"})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"properties-\u53C2\u6570-1",children:"PROPERTIES \u53C2\u6570"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u53C2\u6570"}),(0,d.jsx)(e.th,{children:"\u662F\u5426\u5FC5\u9700"}),(0,d.jsx)(e.th,{children:"\u9ED8\u8BA4\u503C"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"type"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["\u56FA\u5B9A\u4E3A ",(0,d.jsx)(e.code,{children:'"PYTHON_UDF"'})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"symbol"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["Python \u7C7B\u540D\u3002",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.strong,{children:"\u5185\u8054\u6A21\u5F0F"}),": \u76F4\u63A5\u5199\u7C7B\u540D\uFF0C\u5982 ",(0,d.jsx)(e.code,{children:'"SumUDAF"'}),(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.strong,{children:"\u6A21\u5757\u6A21\u5F0F"}),": \u683C\u5F0F\u4E3A ",(0,d.jsx)(e.code,{children:"[package_name.]module_name.ClassName"})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"file"})}),(0,d.jsx)(e.td,{children:"\u5426"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["Python ",(0,d.jsx)(e.code,{children:".zip"})," \u5305\u8DEF\u5F84\uFF0C\u4EC5\u6A21\u5757\u6A21\u5F0F\u9700\u8981\u3002\u652F\u6301\u4E09\u79CD\u534F\u8BAE:",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.code,{children:"file://"})," - \u672C\u5730\u6587\u4EF6\u7CFB\u7EDF\u8DEF\u5F84",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.code,{children:"http://"})," - HTTP \u8FDC\u7A0B\u4E0B\u8F7D",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.code,{children:"https://"})," - HTTPS \u8FDC\u7A0B\u4E0B\u8F7D"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"runtime_version"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["Python \u8FD0\u884C\u65F6\u7248\u672C\uFF0C\u5982 ",(0,d.jsx)(e.code,{children:'"3.10.12"'})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"always_nullable"})}),(0,d.jsx)(e.td,{children:"\u5426"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"true"})}),(0,d.jsx)(e.td,{children:"\u662F\u5426\u603B\u662F\u8FD4\u56DE\u53EF\u7A7A\u7ED3\u679C"})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"runtime_version-\u8BF4\u660E",children:"runtime_version \u8BF4\u660E"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u5FC5\u987B\u586B\u5199 Python \u7248\u672C\u7684",(0,d.jsx)(e.strong,{children:"\u5B8C\u6574\u7248\u672C\u53F7"}),"\uFF0C\u683C\u5F0F\u4E3A ",(0,d.jsx)(e.code,{children:"x.x.x"})," \u6216 ",(0,d.jsx)(e.code,{children:"x.x.xx"})]}),"\n",(0,d.jsx)(e.li,{children:"Doris \u4F1A\u5728\u914D\u7F6E\u7684 Python \u73AF\u5883\u4E2D\u67E5\u627E\u5339\u914D\u8BE5\u7248\u672C\u7684\u89E3\u91CA\u5668"}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u7A97\u53E3\u51FD\u6570-window-functions",children:"\u7A97\u53E3\u51FD\u6570 (Window Functions)"}),"\n",(0,d.jsx)(e.p,{children:"Python UDAF \u53EF\u4EE5\u4E0E\u7A97\u53E3\u51FD\u6570 (OVER \u5B50\u53E5) \u7ED3\u5408\u4F7F\u7528:"}),"\n",(0,d.jsxs)(e.blockquote,{children:["\n",(0,d.jsx)(e.p,{children:"\u82E5\u5C06 Python UDAF \u7528\u4E8E\u7A97\u53E3\u51FD\u6570\uFF08OVER \u5B50\u53E5\uFF09, Doris \u4F1A\u5728\u8BA1\u7B97\u6BCF\u4E2A window frame \u540E\u8C03\u7528 UDAF \u7684 reset \u65B9\u6CD5\uFF0C\u9700\u8981\u5728\u7C7B\u4E2D\u5B9E\u73B0\u5B83\u4EE5\u5C06\u805A\u5408\u72B6\u6001\u91CD\u7F6E\u4E3A\u521D\u59CB\u503C"}),"\n"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"DROP TABLE IF EXISTS daily_sales_data;\n\nCREATE TABLE IF NOT EXISTS daily_sales_data (\n    sales_date DATE,\n    daily_sales DOUBLE\n) DUPLICATE KEY(sales_date)\nDISTRIBUTED BY HASH(sales_date) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO daily_sales_data VALUES \n('2024-01-01', 1000),\n('2024-01-01', 800),\n('2024-01-02', 1200),\n('2024-01-02', 950),\n('2024-01-03', 900),\n('2024-01-03', 1100),\n('2024-01-04', 1500),\n('2024-01-04', 850),\n('2024-01-05', 1100),\n('2024-01-05', 1300);\n\nDROP FUNCTION IF EXISTS py_running_sum(DOUBLE);\n\nCREATE AGGREGATE FUNCTION py_running_sum(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"RunningSumUDAF\",\n    \"runtime_version\" = \"3.10.12\",\n    \"always_nullable\" = \"true\"\n)\nAS $$\nclass RunningSumUDAF:\n    def __init__(self):\n        self.total = 0.0\n\n    def reset(self):\n        self.total = 0.0\n    \n    @property\n    def aggregate_state(self):\n        return self.total\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.total += value\n    \n    def merge(self, other_state):\n        self.total += other_state\n    \n    def finish(self):\n        return self.total\n$$;\n\nSELECT \n    sales_date,\n    daily_sales,\n    py_running_sum(daily_sales) OVER (\n        ORDER BY sales_date \n        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW\n    ) as last_3_days_sum\nFROM daily_sales_data\nORDER BY sales_date;\n\n+------------+-------------+-----------------+\n| sales_date | daily_sales | last_3_days_sum |\n+------------+-------------+-----------------+\n| 2024-01-01 |         800 |             800 |\n| 2024-01-01 |        1000 |            1800 |\n| 2024-01-02 |         950 |            2750 |\n| 2024-01-02 |        1200 |            3150 |\n| 2024-01-03 |        1100 |            3250 |\n| 2024-01-03 |         900 |            3200 |\n| 2024-01-04 |         850 |            2850 |\n| 2024-01-04 |        1500 |            3250 |\n| 2024-01-05 |        1300 |            3650 |\n| 2024-01-05 |        1100 |            3900 |\n+------------+-------------+-----------------+\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u6570\u636E\u7C7B\u578B\u6620\u5C04-1",children:"\u6570\u636E\u7C7B\u578B\u6620\u5C04"}),"\n",(0,d.jsx)(e.p,{children:"Python UDAF \u4F7F\u7528\u4E0E Python UDF \u5B8C\u5168\u76F8\u540C\u7684\u6570\u636E\u7C7B\u578B\u6620\u5C04\u89C4\u5219\uFF0C\u5305\u62EC\u6574\u6570\u3001\u6D6E\u70B9\u3001\u5B57\u7B26\u4E32\u3001\u65E5\u671F\u65F6\u95F4\u3001Decimal\u3001\u5E03\u5C14\u7B49\u6240\u6709\u7C7B\u578B\u3002"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u8BE6\u7EC6\u7684\u6570\u636E\u7C7B\u578B\u6620\u5C04\u5173\u7CFB\u8BF7\u53C2\u8003"}),": ",(0,d.jsx)(e.a,{href:"python-user-defined-function#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E6%98%A0%E5%B0%84",children:"\u6570\u636E\u7C7B\u578B\u6620\u5C04"})]}),"\n",(0,d.jsx)(e.h4,{id:"null-\u503C\u5904\u7406-1",children:"NULL \u503C\u5904\u7406"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["Doris \u4F1A\u5C06 SQL \u4E2D\u7684 ",(0,d.jsx)(e.code,{children:"NULL"})," \u503C\u6620\u5C04\u4E3A Python \u7684 ",(0,d.jsx)(e.code,{children:"None"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u5728 ",(0,d.jsx)(e.code,{children:"accumulate"})," \u65B9\u6CD5\u4E2D\uFF0C\u9700\u8981\u68C0\u67E5\u53C2\u6570\u662F\u5426\u4E3A ",(0,d.jsx)(e.code,{children:"None"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u805A\u5408\u51FD\u6570\u53EF\u4EE5\u8FD4\u56DE ",(0,d.jsx)(e.code,{children:"None"})," \u8868\u793A\u7ED3\u679C\u4E3A ",(0,d.jsx)(e.code,{children:"NULL"})]}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u5B9E\u9645\u5E94\u7528\u573A\u666F-1",children:"\u5B9E\u9645\u5E94\u7528\u573A\u666F"}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-1-\u8BA1\u7B97\u767E\u5206\u4F4D\u6570",children:"\u573A\u666F 1: \u8BA1\u7B97\u767E\u5206\u4F4D\u6570"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS py_percentile(DOUBLE, INT);\n\nCREATE AGGREGATE FUNCTION py_percentile(DOUBLE, INT)\nRETURNS DOUBLE\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"PercentileUDAF\",\n    \"runtime_version\" = \"3.10.12\",\n    \"always_nullable\" = \"true\"\n)\nAS $$\nclass PercentileUDAF:\n    \"\"\"\u8BA1\u7B97\u767E\u5206\u4F4D\u6570\uFF0C\u7B2C\u4E8C\u4E2A\u53C2\u6570\u4E3A\u767E\u5206\u4F4D(0-100)\"\"\"\n    \n    def __init__(self):\n        self.values = []\n        self.percentile = 50  # \u9ED8\u8BA4\u4E2D\u4F4D\u6570\n    \n    @property\n    def aggregate_state(self):\n        return self.values\n    \n    def accumulate(self, value, percentile):\n        if value is not None:\n            self.values.append(value)\n        if percentile is not None:\n            self.percentile = percentile\n    \n    def merge(self, other_state):\n        if other_state:\n            self.values.extend(other_state)\n    \n    def finish(self):\n        if not self.values:\n            return None\n        sorted_vals = sorted(self.values)\n        n = len(sorted_vals)\n        k = (n - 1) * (self.percentile / 100.0)\n        f = int(k)\n        c = k - f\n        if f + 1 < n:\n            return sorted_vals[f] + (sorted_vals[f + 1] - sorted_vals[f]) * c\n        else:\n            return sorted_vals[f]\n$$;\n\nDROP TABLE IF EXISTS api_logs;\n\nCREATE TABLE IF NOT EXISTS api_logs (\n    log_id INT,\n    api_name VARCHAR(100),\n    category VARCHAR(50),\n    response_time DOUBLE\n) DUPLICATE KEY(log_id)\nDISTRIBUTED BY HASH(log_id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO api_logs VALUES \n(1, '/api/users', 'User', 120.5),\n(2, '/api/users', 'User', 95.3),\n(3, '/api/users', 'User', 150.0),\n(4, '/api/users', 'User', 80.2),\n(5, '/api/users', 'User', 200.8),\n(6, '/api/orders', 'Order', 250.0),\n(7, '/api/orders', 'Order', 180.5),\n(8, '/api/orders', 'Order', 300.2),\n(9, '/api/orders', 'Order', 220.0),\n(10, '/api/products', 'Product', 50.0),\n(11, '/api/products', 'Product', 60.5),\n(12, '/api/products', 'Product', 45.0),\n(13, '/api/products', 'Product', 70.2),\n(14, '/api/products', 'Product', 55.8);\n\nSELECT \n    category,\n    py_percentile(response_time, 25) as p25,\n    py_percentile(response_time, 50) as p50,\n    py_percentile(response_time, 75) as p75,\n    py_percentile(response_time, 95) as p95\nFROM api_logs\nGROUP BY category\nORDER BY category;\n\n+----------+-------+-------+-------+-------+\n| category | p25   | p50   | p75   | p95   |\n+----------+-------+-------+-------+-------+\n| Order    |   235 |   235 |   235 |   235 |\n| Product  |  55.8 |  55.8 |  55.8 |  55.8 |\n| User     | 120.5 | 120.5 | 120.5 | 120.5 |\n+----------+-------+-------+-------+-------+\n"})}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-2-\u5B57\u7B26\u4E32\u53BB\u91CD\u5408\u5E76",children:"\u573A\u666F 2: \u5B57\u7B26\u4E32\u53BB\u91CD\u5408\u5E76"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS py_collect_set(STRING);\n\nCREATE AGGREGATE FUNCTION py_collect_set(STRING)\nRETURNS STRING\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"CollectSetUDAF\",\n    \"runtime_version\" = \"3.10.12\",\n    \"always_nullable\" = \"true\"\n)\nAS $$\nclass CollectSetUDAF:\n    \"\"\"\u53BB\u91CD\u6536\u96C6\u5B57\u7B26\u4E32\uFF0C\u8FD4\u56DE\u9017\u53F7\u5206\u9694\u7684\u5B57\u7B26\u4E32\"\"\"\n    \n    def __init__(self):\n        self.items = set()\n    \n    @property\n    def aggregate_state(self):\n        return list(self.items)\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.items.add(value)\n    \n    def merge(self, other_state):\n        if other_state:\n            self.items.update(other_state)\n    \n    def finish(self):\n        if not self.items:\n            return None\n        return ','.join(sorted(self.items))\n$$;\n\nDROP TABLE IF EXISTS page_views;\n\nCREATE TABLE IF NOT EXISTS page_views (\n    view_id INT,\n    user_id INT,\n    page_url VARCHAR(200),\n    view_time DATETIME\n) DUPLICATE KEY(view_id)\nDISTRIBUTED BY HASH(view_id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO page_views VALUES \n(1, 1001, '/home', '2024-01-01 10:00:00'),\n(2, 1001, '/products', '2024-01-01 10:05:00'),\n(3, 1001, '/home', '2024-01-01 10:10:00'),\n(4, 1001, '/cart', '2024-01-01 10:15:00'),\n(5, 1002, '/home', '2024-01-01 11:00:00'),\n(6, 1002, '/about', '2024-01-01 11:05:00'),\n(7, 1002, '/products', '2024-01-01 11:10:00'),\n(8, 1003, '/products', '2024-01-01 12:00:00'),\n(9, 1003, '/products', '2024-01-01 12:05:00'),\n(10, 1003, '/cart', '2024-01-01 12:10:00'),\n(11, 1003, '/checkout', '2024-01-01 12:15:00');\n\nSELECT \n    user_id,\n    py_collect_set(page_url) as visited_pages\nFROM page_views\nGROUP BY user_id\nORDER BY user_id;\n\n+---------+---------------------------+\n| user_id | visited_pages             |\n+---------+---------------------------+\n|    1001 | /cart,/home,/products     |\n|    1002 | /about,/home,/products    |\n|    1003 | /cart,/checkout,/products |\n+---------+---------------------------+\n"})}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-3-\u79FB\u52A8\u5E73\u5747",children:"\u573A\u666F 3: \u79FB\u52A8\u5E73\u5747"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"DROP TABLE IF EXISTS daily_sales;\n\nCREATE TABLE IF NOT EXISTS daily_sales (\n    id INT,\n    date DATE,\n    sales DOUBLE\n) DUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO daily_sales VALUES \n(1, '2024-01-01', 1000.0),\n(2, '2024-01-02', 1200.0),\n(3, '2024-01-03', 900.0),\n(4, '2024-01-04', 1500.0),\n(5, '2024-01-05', 1100.0),\n(6, '2024-01-06', 1300.0),\n(7, '2024-01-07', 1400.0),\n(8, '2024-01-08', 1000.0),\n(9, '2024-01-09', 1600.0),\n(10, '2024-01-10', 1250.0);\n\nSELECT \n    date,\n    sales,\n    py_avg(sales) OVER (\n        ORDER BY date \n        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n    ) as moving_avg_7days\nFROM daily_sales\nORDER BY date;\n\n+------------+-------+-------------------+\n| date       | sales | moving_avg_7days  |\n+------------+-------+-------------------+\n| 2024-01-01 |  1000 |              1000 |\n| 2024-01-02 |  1200 |              1100 |\n| 2024-01-03 |   900 | 1033.333333333333 |\n| 2024-01-04 |  1500 |              1150 |\n| 2024-01-05 |  1100 |              1140 |\n| 2024-01-06 |  1300 | 1166.666666666667 |\n| 2024-01-07 |  1400 |              1200 |\n| 2024-01-08 |  1000 |              1200 |\n| 2024-01-09 |  1600 | 1257.142857142857 |\n| 2024-01-10 |  1250 | 1307.142857142857 |\n+------------+-------+-------------------+\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE-1",children:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE"}),"\n",(0,d.jsx)(e.h4,{id:"1-\u4F18\u5316\u72B6\u6001\u5BF9\u8C61\u5927\u5C0F",children:"1. \u4F18\u5316\u72B6\u6001\u5BF9\u8C61\u5927\u5C0F"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u907F\u514D\u5728\u72B6\u6001\u5BF9\u8C61\u4E2D\u5B58\u50A8\u5927\u91CF\u539F\u59CB\u6570\u636E"}),"\n",(0,d.jsx)(e.li,{children:"\u5C3D\u91CF\u4F7F\u7528\u805A\u5408\u540E\u7684\u7EDF\u8BA1\u91CF\u800C\u4E0D\u662F\u5B8C\u6574\u6570\u636E\u5217\u8868"}),"\n",(0,d.jsx)(e.li,{children:"\u5BF9\u4E8E\u5FC5\u987B\u5B58\u50A8\u6570\u636E\u7684\u573A\u666F(\u5982\u4E2D\u4F4D\u6570)\uFF0C\u8003\u8651\u91C7\u6837\u6216\u9650\u5236\u6570\u636E\u91CF"}),"\n"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u4E0D\u63A8\u8350\u5982\u4E0B\u7528\u6CD5"}),":"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:"class BadMedianUDAF:\n    def __init__(self):\n        self.all_values = []  # \u53EF\u80FD\u975E\u5E38\u5927\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.all_values.append(value)\n"})}),"\n",(0,d.jsx)(e.h4,{id:"2-\u51CF\u5C11\u5BF9\u8C61\u521B\u5EFA",children:"2. \u51CF\u5C11\u5BF9\u8C61\u521B\u5EFA"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u590D\u7528\u72B6\u6001\u5BF9\u8C61\uFF0C\u907F\u514D\u9891\u7E41\u521B\u5EFA\u65B0\u5BF9\u8C61"}),"\n",(0,d.jsx)(e.li,{children:"\u4F7F\u7528\u539F\u59CB\u6570\u636E\u7C7B\u578B\u800C\u975E\u590D\u6742\u5BF9\u8C61"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"3-\u7B80\u5316-merge-\u903B\u8F91",children:"3. \u7B80\u5316 merge \u903B\u8F91"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"merge"})," \u65B9\u6CD5\u5728\u5206\u5E03\u5F0F\u73AF\u5883\u4E0B\u4F1A\u88AB\u9891\u7E41\u8C03\u7528"]}),"\n",(0,d.jsx)(e.li,{children:"\u786E\u4FDD merge \u64CD\u4F5C\u9AD8\u6548\u4E14\u6B63\u786E"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"4-\u4F7F\u7528\u589E\u91CF\u8BA1\u7B97",children:"4. \u4F7F\u7528\u589E\u91CF\u8BA1\u7B97"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u5BF9\u4E8E\u53EF\u4EE5\u589E\u91CF\u8BA1\u7B97\u7684\u6307\u6807(\u5982\u5E73\u5747\u503C)\uFF0C\u4F7F\u7528\u589E\u91CF\u65B9\u5F0F\u800C\u975E\u5B58\u50A8\u6240\u6709\u6570\u636E"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"5-\u907F\u514D\u4F7F\u7528\u5916\u90E8\u8D44\u6E90",children:"5. \u907F\u514D\u4F7F\u7528\u5916\u90E8\u8D44\u6E90"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u4E0D\u8981\u5728 UDAF \u4E2D\u8BBF\u95EE\u6570\u636E\u5E93\u6216\u5916\u90E8 API"}),"\n",(0,d.jsx)(e.li,{children:"\u6240\u6709\u8BA1\u7B97\u5E94\u57FA\u4E8E\u4F20\u5165\u7684\u6570\u636E\u548C\u5185\u90E8\u72B6\u6001"}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879-1",children:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,d.jsx)(e.h4,{id:"1-\u6027\u80FD\u8003\u8651",children:"1. \u6027\u80FD\u8003\u8651"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"Python UDAF \u6027\u80FD\u4F4E\u4E8E\u5185\u7F6E\u805A\u5408\u51FD\u6570"}),"\n",(0,d.jsx)(e.li,{children:"\u5EFA\u8BAE\u7528\u4E8E\u903B\u8F91\u590D\u6742\u4F46\u6570\u636E\u91CF\u9002\u4E2D\u7684\u573A\u666F"}),"\n",(0,d.jsx)(e.li,{children:"\u5927\u6570\u636E\u91CF\u573A\u666F\u4F18\u5148\u8003\u8651\u4F7F\u7528\u5185\u7F6E\u51FD\u6570\u6216\u4F18\u5316 UDAF \u5B9E\u73B0"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"2-\u72B6\u6001\u5E8F\u5217\u5316",children:"2. \u72B6\u6001\u5E8F\u5217\u5316"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"aggregate_state"})," \u8FD4\u56DE\u7684\u5BF9\u8C61",(0,d.jsx)(e.strong,{children:"\u5FC5\u987B\u652F\u6301 pickle \u5E8F\u5217\u5316"})]}),"\n",(0,d.jsx)(e.li,{children:"\u652F\u6301\u7684\u7C7B\u578B\uFF1A\u57FA\u672C\u7C7B\u578B\uFF08int\u3001float\u3001str\u3001bool\uFF09\u3001\u5217\u8868\u3001\u5B57\u5178\u3001\u5143\u7EC4\u3001set\uFF0C\u4EE5\u53CA\u652F\u6301 pickle \u5E8F\u5217\u5316\u7684\u81EA\u5B9A\u4E49\u7C7B\u5B9E\u4F8B"}),"\n",(0,d.jsx)(e.li,{children:"\u4E0D\u652F\u6301\uFF1A\u6587\u4EF6\u53E5\u67C4\u3001\u6570\u636E\u5E93\u8FDE\u63A5\u3001socket \u8FDE\u63A5\u3001\u7EBF\u7A0B\u9501\u7B49\u4E0D\u53EF pickle \u5E8F\u5217\u5316\u7684\u5BF9\u8C61"}),"\n",(0,d.jsx)(e.li,{children:"\u5982\u679C\u72B6\u6001\u5BF9\u8C61\u4E0D\u80FD\u88AB pickle \u5E8F\u5217\u5316\uFF0C\u51FD\u6570\u6267\u884C\u65F6\u4F1A\u62A5\u9519"}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5EFA\u8BAE\u4F18\u5148\u4F7F\u7528\u5185\u7F6E\u7C7B\u578B"}),"\uFF08dict\u3001list\u3001tuple\uFF09\u4F5C\u4E3A\u72B6\u6001\u5BF9\u8C61\uFF0C\u4EE5\u786E\u4FDD\u517C\u5BB9\u6027\u548C\u53EF\u7EF4\u62A4\u6027"]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"3-\u5185\u5B58\u9650\u5236",children:"3. \u5185\u5B58\u9650\u5236"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u72B6\u6001\u5BF9\u8C61\u4F1A\u5360\u7528\u5185\u5B58\uFF0C\u907F\u514D\u5B58\u50A8\u8FC7\u591A\u6570\u636E"}),"\n",(0,d.jsx)(e.li,{children:"\u5927\u72B6\u6001\u5BF9\u8C61\u4F1A\u5F71\u54CD\u6027\u80FD\u548C\u7A33\u5B9A\u6027"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"4-\u51FD\u6570\u547D\u540D",children:"4. \u51FD\u6570\u547D\u540D"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u540C\u4E00\u51FD\u6570\u540D\u5728\u4E0D\u540C\u6570\u636E\u5E93\u4E2D\u53EF\u91CD\u590D\u5B9A\u4E49"}),"\n",(0,d.jsxs)(e.li,{children:["\u8C03\u7528\u65F6\u9700\u6307\u5B9A\u6570\u636E\u5E93\u540D (\u5982 ",(0,d.jsx)(e.code,{children:"db.func()"}),") \u4EE5\u907F\u514D\u6B67\u4E49"]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"5-\u73AF\u5883\u4E00\u81F4\u6027",children:"5. \u73AF\u5883\u4E00\u81F4\u6027"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u6240\u6709 BE \u8282\u70B9\u7684 Python \u73AF\u5883\u5FC5\u987B\u4E00\u81F4"}),"\n",(0,d.jsx)(e.li,{children:"\u5305\u62EC Python \u7248\u672C\u3001\u4F9D\u8D56\u5305\u7248\u672C\u3001\u73AF\u5883\u914D\u7F6E"}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u5E38\u89C1\u95EE\u9898-faq",children:"\u5E38\u89C1\u95EE\u9898 FAQ"}),"\n",(0,d.jsx)(e.h4,{id:"q1-udaf-\u548C-udf-\u7684\u533A\u522B\u662F\u4EC0\u4E48",children:"Q1: UDAF \u548C UDF \u7684\u533A\u522B\u662F\u4EC0\u4E48?"}),"\n",(0,d.jsxs)(e.p,{children:["A: ",(0,d.jsx)(e.strong,{children:"UDF"}),"\u7528\u4E8E\u5904\u7406\u5355\u884C\u6570\u636E\uFF0C\u8FD4\u56DE\u5355\u884C\u7ED3\u679C\u3002\u6BCF\u884C\u8C03\u7528\u4E00\u6B21\u51FD\u6570\u3002 ",(0,d.jsx)(e.strong,{children:"UDAF"}),"\u7528\u4E8E\u5904\u7406\u591A\u884C\u6570\u636E\uFF0C\u8FD4\u56DE\u5355\u4E2A\u805A\u5408\u7ED3\u679C\u3002\u914D\u5408 GROUP BY \u4F7F\u7528\u3002"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"-- UDF: \u6BCF\u884C\u90FD\u4F1A\u8C03\u7528\nSELECT id, py_upper(name) FROM users;\n\n-- UDAF: \u6BCF\u7EC4\u8C03\u7528\u4E00\u6B21\nSELECT category, py_sum(amount) FROM sales GROUP BY category;\n"})}),"\n",(0,d.jsx)(e.h4,{id:"q2-aggregate_state-\u5C5E\u6027\u7684\u4F5C\u7528\u662F\u4EC0\u4E48",children:"Q2: aggregate_state \u5C5E\u6027\u7684\u4F5C\u7528\u662F\u4EC0\u4E48?"}),"\n",(0,d.jsxs)(e.p,{children:["A: ",(0,d.jsx)(e.code,{children:"aggregate_state"})," \u7528\u4E8E\u5728\u5206\u5E03\u5F0F\u73AF\u5883\u4E0B\u5E8F\u5217\u5316\u548C\u4F20\u8F93\u805A\u5408\u72B6\u6001:"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5E8F\u5217\u5316"}),": \u5C06\u72B6\u6001\u5BF9\u8C61\u8F6C\u6362\u4E3A\u53EF\u4F20\u8F93\u7684\u683C\u5F0F\uFF0C\u4F7F\u7528 ",(0,d.jsx)(e.strong,{children:"pickle \u534F\u8BAE"}),"\u8FDB\u884C\u5E8F\u5217\u5316"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5408\u5E76"}),": \u5728\u4E0D\u540C\u8282\u70B9\u95F4\u5408\u5E76\u90E8\u5206\u805A\u5408\u7ED3\u679C"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5FC5\u987B\u652F\u6301 pickle \u5E8F\u5217\u5316"}),": \u53EF\u4EE5\u8FD4\u56DE\u57FA\u672C\u7C7B\u578B\u3001\u5217\u8868\u3001\u5B57\u5178\u3001\u5143\u7EC4\u3001set\uFF0C\u4EE5\u53CA\u652F\u6301 pickle \u5E8F\u5217\u5316\u7684\u81EA\u5B9A\u4E49\u7C7B\u5B9E\u4F8B"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u7981\u6B62\u8FD4\u56DE"}),": \u6587\u4EF6\u53E5\u67C4\u3001\u6570\u636E\u5E93\u8FDE\u63A5\u3001socket \u8FDE\u63A5\u3001\u7EBF\u7A0B\u9501\u7B49\u4E0D\u53EF pickle \u5E8F\u5217\u5316\u7684\u5BF9\u8C61\uFF0C\u5426\u5219\u51FD\u6570\u6267\u884C\u4F1A\u62A5\u9519"]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"q3-udaf-\u53EF\u4EE5\u5728\u7A97\u53E3\u51FD\u6570\u4E2D\u4F7F\u7528\u5417",children:"Q3: UDAF \u53EF\u4EE5\u5728\u7A97\u53E3\u51FD\u6570\u4E2D\u4F7F\u7528\u5417?"}),"\n",(0,d.jsx)(e.p,{children:"A: \u53EF\u4EE5\u3002Python UDAF \u5B8C\u5168\u652F\u6301\u7A97\u53E3\u51FD\u6570 (OVER \u5B50\u53E5)\u3002"}),"\n",(0,d.jsx)(e.h4,{id:"q4-merge-\u65B9\u6CD5\u4EC0\u4E48\u65F6\u5019\u4F1A\u88AB\u8C03\u7528",children:"Q4: merge \u65B9\u6CD5\u4EC0\u4E48\u65F6\u5019\u4F1A\u88AB\u8C03\u7528?"}),"\n",(0,d.jsxs)(e.p,{children:["A: ",(0,d.jsx)(e.code,{children:"merge"})," \u65B9\u6CD5\u5728\u4EE5\u4E0B\u60C5\u51B5\u88AB\u8C03\u7528:"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5206\u5E03\u5F0F\u805A\u5408"}),": \u5408\u5E76\u4E0D\u540C BE \u8282\u70B9\u7684\u90E8\u5206\u805A\u5408\u7ED3\u679C"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5E76\u884C\u5904\u7406"}),": \u5408\u5E76\u540C\u4E00\u8282\u70B9\u5185\u4E0D\u540C\u7EBF\u7A0B\u7684\u90E8\u5206\u7ED3\u679C"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u7A97\u53E3\u51FD\u6570"}),": \u5408\u5E76\u7A97\u53E3\u6846\u67B6\u5185\u7684\u90E8\u5206\u7ED3\u679C"]}),"\n"]}),"\n",(0,d.jsxs)(e.p,{children:["\u56E0\u6B64 ",(0,d.jsx)(e.code,{children:"merge"})," \u7684\u5B9E\u73B0\u5FC5\u987B\u6B63\u786E\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4\u7ED3\u679C\u9519\u8BEF\u3002"]}),"\n",(0,d.jsx)(e.h2,{id:"python-udtf",children:"Python UDTF"}),"\n",(0,d.jsx)(e.p,{children:"Python UDTF (User Defined Table Function) \u662F Apache Doris \u63D0\u4F9B\u7684\u81EA\u5B9A\u4E49\u8868\u51FD\u6570\u6269\u5C55\u673A\u5236\uFF0C\u5141\u8BB8\u7528\u6237\u4F7F\u7528 Python \u8BED\u8A00\u7F16\u5199\u81EA\u5B9A\u4E49\u8868\u51FD\u6570\uFF0C\u7528\u4E8E\u5C06\u5355\u884C\u6570\u636E\u8F6C\u6362\u4E3A\u591A\u884C\u8F93\u51FA\u3002\u901A\u8FC7 Python UDTF\uFF0C\u7528\u6237\u53EF\u4EE5\u7075\u6D3B\u5730\u5B9E\u73B0\u6570\u636E\u62C6\u5206\u3001\u5C55\u5F00\u3001\u751F\u6210\u7B49\u590D\u6742\u903B\u8F91\u3002"}),"\n",(0,d.jsx)(e.p,{children:"Python UDTF \u7684\u6838\u5FC3\u7279\u70B9:"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u4E00\u884C\u8F6C\u591A\u884C"}),": \u63A5\u6536\u5355\u884C\u8F93\u5165\uFF0C\u8F93\u51FA\u96F6\u884C\u3001\u4E00\u884C\u6216\u591A\u884C\u7ED3\u679C"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u7075\u6D3B\u7684\u8F93\u51FA\u7ED3\u6784"}),": \u53EF\u4EE5\u5B9A\u4E49\u4EFB\u610F\u6570\u91CF\u548C\u7C7B\u578B\u7684\u8F93\u51FA\u5217\uFF0C\u652F\u6301\u7B80\u5355\u7C7B\u578B\u548C\u590D\u6742 STRUCT \u7C7B\u578B"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u4FA7\u89C6\u56FE\u652F\u6301"}),": \u914D\u5408 ",(0,d.jsx)(e.code,{children:"LATERAL VIEW"})," \u4F7F\u7528\uFF0C\u5B9E\u73B0\u6570\u636E\u5C55\u5F00\u548C\u5173\u8054"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u51FD\u6570\u5F0F\u7F16\u7A0B"}),": \u4F7F\u7528 Python \u51FD\u6570\u548C ",(0,d.jsx)(e.code,{children:"yield"})," \u8BED\u53E5\uFF0C\u7B80\u6D01\u76F4\u89C2"]}),"\n"]}),"\n",(0,d.jsxs)(e.admonition,{title:"\u63D0\u793A",type:"tip",children:[(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u73AF\u5883\u4F9D\u8D56"}),": \u4F7F\u7528 Python UDTF \u524D\uFF0C\u5FC5\u987B\u5728\u6240\u6709 BE \u8282\u70B9\u7684 Python \u73AF\u5883\u4E2D\u9884\u5148\u5B89\u88C5 ",(0,d.jsx)(e.strong,{children:(0,d.jsx)(e.code,{children:"pandas"})})," \u548C ",(0,d.jsx)(e.strong,{children:(0,d.jsx)(e.code,{children:"pyarrow"})})," \u4E24\u4E2A\u5E93\uFF0C\u8FD9\u662F Doris Python UDTF \u529F\u80FD\u7684\u5F3A\u5236\u4F9D\u8D56\u3002\u8BE6\u89C1 ",(0,d.jsx)(e.a,{href:"python-user-defined-function#python-udfudafudtf-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86",children:"Python UDTF \u73AF\u5883\u914D\u7F6E"}),"\u3002"]}),(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u65E5\u5FD7\u8DEF\u5F84"}),": Python UDTF Server \u7684\u8FD0\u884C\u65E5\u5FD7\u4F4D\u4E8E ",(0,d.jsx)(e.code,{children:"output/be/log/python_udf_output.log"}),"\u3002\u7528\u6237\u53EF\u4EE5\u5728\u8BE5\u65E5\u5FD7\u4E2D\u67E5\u770B Python Server \u7684\u8FD0\u884C\u60C5\u51B5\u3001\u805A\u5408\u51FD\u6570\u6267\u884C\u4FE1\u606F\u548C\u8C03\u8BD5\u9519\u8BEF\u3002"]})]}),"\n",(0,d.jsx)(e.h3,{id:"udtf-\u57FA\u672C\u6982\u5FF5",children:"UDTF \u57FA\u672C\u6982\u5FF5"}),"\n",(0,d.jsx)(e.h4,{id:"\u8868\u51FD\u6570\u7684\u6267\u884C\u65B9\u5F0F",children:"\u8868\u51FD\u6570\u7684\u6267\u884C\u65B9\u5F0F"}),"\n",(0,d.jsxs)(e.p,{children:["Python UDTF \u901A\u8FC7",(0,d.jsx)(e.strong,{children:"\u51FD\u6570"}),"\u5B9E\u73B0\uFF08\u800C\u975E\u7C7B\uFF09\uFF0C\u51FD\u6570\u7684\u6267\u884C\u6D41\u7A0B\u5982\u4E0B:"]}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u63A5\u6536\u8F93\u5165"}),": \u51FD\u6570\u63A5\u6536\u5355\u884C\u6570\u636E\u7684\u5404\u5217\u503C\u4F5C\u4E3A\u53C2\u6570"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5904\u7406\u4E0E\u4EA7\u51FA"}),": \u901A\u8FC7 ",(0,d.jsx)(e.code,{children:"yield"})," \u8BED\u53E5\u4EA7\u51FA\u96F6\u884C\u6216\u591A\u884C\u7ED3\u679C"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u65E0\u72B6\u6001"}),": \u6BCF\u6B21\u51FD\u6570\u8C03\u7528\u72EC\u7ACB\u5904\u7406\u4E00\u884C\uFF0C\u4E0D\u4FDD\u7559\u4E0A\u4E00\u884C\u7684\u72B6\u6001"]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"\u51FD\u6570\u8981\u6C42",children:"\u51FD\u6570\u8981\u6C42"}),"\n",(0,d.jsx)(e.p,{children:"Python UDTF \u51FD\u6570\u5FC5\u987B\u6EE1\u8DB3\u4EE5\u4E0B\u8981\u6C42:"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u4F7F\u7528 yield \u4EA7\u51FA\u7ED3\u679C"}),": \u901A\u8FC7 ",(0,d.jsx)(e.code,{children:"yield"})," \u8BED\u53E5\u4EA7\u51FA\u8F93\u51FA\u884C"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u53C2\u6570\u7C7B\u578B\u5BF9\u5E94"}),": \u51FD\u6570\u53C2\u6570\u4E0E SQL \u4E2D\u5B9A\u4E49\u7684\u53C2\u6570\u7C7B\u578B\u5BF9\u5E94"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u8F93\u51FA\u683C\u5F0F\u5339\u914D"}),": ",(0,d.jsx)(e.code,{children:"yield"})," \u7684\u6570\u636E\u683C\u5F0F\u5FC5\u987B\u4E0E ",(0,d.jsx)(e.code,{children:"RETURNS ARRAY<...>"})," \u5B9A\u4E49\u4E00\u81F4"]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"\u8F93\u51FA\u65B9\u5F0F",children:"\u8F93\u51FA\u65B9\u5F0F"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5355\u5217\u8F93\u51FA"}),": ",(0,d.jsx)(e.code,{children:"yield value"})," \u4EA7\u51FA\u5355\u4E2A\u503C"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u591A\u5217\u8F93\u51FA"}),": ",(0,d.jsx)(e.code,{children:"yield (value1, value2, ...)"})," \u4EA7\u51FA\u591A\u4E2A\u503C\u7684\u5143\u7EC4"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u6761\u4EF6\u8DF3\u8FC7"}),": \u4E0D\u8C03\u7528 ",(0,d.jsx)(e.code,{children:"yield"}),"\uFF0C\u8BE5\u884C\u4E0D\u4EA7\u751F\u4EFB\u4F55\u8F93\u51FA"]}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u57FA\u672C\u8BED\u6CD5-1",children:"\u57FA\u672C\u8BED\u6CD5"}),"\n",(0,d.jsx)(e.h4,{id:"\u521B\u5EFA-python-udtf",children:"\u521B\u5EFA Python UDTF"}),"\n",(0,d.jsx)(e.p,{children:"Python UDTF \u652F\u6301\u4E24\u79CD\u521B\u5EFA\u65B9\u5F0F:\u5185\u8054\u6A21\u5F0F (Inline) \u548C\u6A21\u5757\u6A21\u5F0F (Module)\u3002"}),"\n",(0,d.jsx)(e.admonition,{title:"\u6CE8\u610F",type:"caution",children:(0,d.jsxs)(e.p,{children:["\u5982\u679C\u540C\u65F6\u6307\u5B9A\u4E86 ",(0,d.jsx)(e.code,{children:"file"})," \u53C2\u6570\u548C ",(0,d.jsx)(e.code,{children:"AS $$"})," \u5185\u8054 Python \u4EE3\u7801\uFF0CDoris \u5C06\u4F1A",(0,d.jsx)(e.strong,{children:"\u4F18\u5148\u52A0\u8F7D\u5185\u8054 Python \u4EE3\u7801"}),"\uFF0C\u91C7\u7528\u5185\u8054\u6A21\u5F0F\u8FD0\u884C Python UDTF\u3002"]})}),"\n",(0,d.jsx)(e.h5,{id:"\u5185\u8054\u6A21\u5F0F-inline-mode-2",children:"\u5185\u8054\u6A21\u5F0F (Inline Mode)"}),"\n",(0,d.jsx)(e.p,{children:"\u5185\u8054\u6A21\u5F0F\u5141\u8BB8\u76F4\u63A5\u5728 SQL \u4E2D\u7F16\u5199 Python \u51FD\u6570\uFF0C\u9002\u5408\u7B80\u5355\u7684\u8868\u51FD\u6570\u903B\u8F91\u3002"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u8BED\u6CD5"}),":"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'CREATE TABLES FUNCTION function_name(parameter_type1, parameter_type2, ...)\nRETURNS ARRAY<return_type>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "function_name",\n    "runtime_version" = "python_version",\n    "always_nullable" = "true|false"\n)\nAS $$\ndef function_name(param1, param2, ...):\n    \'\'\'\u51FD\u6570\u8BF4\u660E\'\'\'\n    # \u5904\u7406\u903B\u8F91\n    yield result  # \u5355\u5217\u8F93\u51FA\n    # \u6216\n    yield (result1, result2, ...)  # \u591A\u5217\u8F93\u51FA\n$$;\n'})}),"\n",(0,d.jsxs)(e.blockquote,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u91CD\u8981\u8BED\u6CD5\u8BF4\u660E"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"CREATE TABLES FUNCTION"}),"\uFF08\u6CE8\u610F\u662F ",(0,d.jsx)(e.strong,{children:"TABLES"}),"\uFF0C\u590D\u6570\u5F62\u5F0F\uFF09"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5355\u5217\u8F93\u51FA: ",(0,d.jsx)(e.code,{children:"ARRAY<\u7C7B\u578B>"}),"\uFF0C\u5982 ",(0,d.jsx)(e.code,{children:"ARRAY<INT>"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u591A\u5217\u8F93\u51FA: ",(0,d.jsx)(e.code,{children:"ARRAY<STRUCT<col1:type1, col2:type2, ...>>"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 1: \u5B57\u7B26\u4E32\u5206\u5272\uFF08\u5355\u5217\u8F93\u51FA\uFF09"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_split(STRING, STRING);\n\nCREATE TABLES FUNCTION py_split(STRING, STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "split_string_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef split_string_udtf(text, delimiter):\n    \'\'\'\u5C06\u5B57\u7B26\u4E32\u6309\u5206\u9694\u7B26\u5206\u5272\u4E3A\u591A\u884C\'\'\'\n    if text is not None and delimiter is not None:\n        parts = text.split(delimiter)\n        for part in parts:\n            # \u4E5F\u652F\u6301 yield (part.strip(),) \n            yield part.strip()\n$$;\n\nSELECT part\nFROM (SELECT \'apple,banana,orange\' as fruits) t\nLATERAL VIEW py_split(fruits, \',\') tmp AS part;\n\n+--------+\n| part   |\n+--------+\n| apple  |\n| banana |\n| orange |\n+--------+\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 2: \u751F\u6210\u6570\u5B57\u5E8F\u5217\uFF08\u5355\u5217\u8F93\u51FA\uFF09"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_range(INT, INT);\n\nCREATE TABLES FUNCTION py_range(INT, INT)\nRETURNS ARRAY<INT>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "generate_series_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef generate_series_udtf(start, end):\n    \'\'\'\u751F\u6210\u4ECE start \u5230 end \u7684\u6574\u6570\u5E8F\u5217\'\'\'\n    if start is not None and end is not None:\n        for i in range(start, end + 1):\n            yield i\n$$;\n\nSELECT num\nFROM (SELECT 1 as start_val, 5 as end_val) t\nLATERAL VIEW py_range(start_val, end_val) tmp AS num;\n\n+------+\n| num  |\n+------+\n|    1 |\n|    2 |\n|    3 |\n|    4 |\n|    5 |\n+------+\n\nSELECT date_add(\'2024-01-01\', n) as date\nFROM (SELECT 0 as start_val, 6 as end_val) t\nLATERAL VIEW py_range(start_val, end_val) tmp AS n;\n\n+------------+\n| date       |\n+------------+\n| 2024-01-01 |\n| 2024-01-02 |\n| 2024-01-03 |\n| 2024-01-04 |\n| 2024-01-05 |\n| 2024-01-06 |\n| 2024-01-07 |\n+------------+\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 3: \u591A\u5217\u8F93\u51FA\uFF08STRUCT\uFF09"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_duplicate(STRING, INT);\n\nCREATE TABLES FUNCTION py_duplicate(STRING, INT)\nRETURNS ARRAY<STRUCT<output:STRING, idx:INT>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "duplicate_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef duplicate_udtf(text, n):\n    \'\'\'\u5C06\u6587\u672C\u590D\u5236 n \u6B21\uFF0C\u6BCF\u6B21\u5E26\u5E8F\u53F7\'\'\'\n    if text is not None and n is not None:\n        for i in range(n):\n            yield (text, i + 1)\n$$;\n\nSELECT output, idx\nFROM (SELECT \'Hello\' as text, 3 as times) t\nLATERAL VIEW py_duplicate(text, times) tmp AS output, idx;\n\n+--------+------+\n| output | idx  |\n+--------+------+\n| Hello  |    1 |\n| Hello  |    2 |\n| Hello  |    3 |\n+--------+------+\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 4: \u7B1B\u5361\u5C14\u79EF\uFF08\u591A\u5217 STRUCT\uFF09"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_cartesian(STRING, STRING);\n\nCREATE TABLES FUNCTION py_cartesian(STRING, STRING)\nRETURNS ARRAY<STRUCT<item1:STRING, item2:STRING>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "cartesian_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef cartesian_udtf(list1, list2):\n    \'\'\'\u751F\u6210\u4E24\u4E2A\u5217\u8868\u7684\u7B1B\u5361\u5C14\u79EF\'\'\'\n    if list1 is not None and list2 is not None:\n        items1 = [x.strip() for x in list1.split(\',\')]\n        items2 = [y.strip() for y in list2.split(\',\')]\n        for x in items1:\n            for y in items2:\n                yield (x, y)\n$$;\n\nSELECT item1, item2\nFROM (SELECT \'A,B\' as list1, \'X,Y,Z\' as list2) t\nLATERAL VIEW py_cartesian(list1, list2) tmp AS item1, item2;\n\n+-------+-------+\n| item1 | item2 |\n+-------+-------+\n| A     | X     |\n| A     | Y     |\n| A     | Z     |\n| B     | X     |\n| B     | Y     |\n| B     | Z     |\n+-------+-------+\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u793A\u4F8B 5: JSON \u6570\u7EC4\u89E3\u6790"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_explode_json(STRING);\n\nCREATE TABLES FUNCTION py_explode_json(STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "explode_json_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nimport json\n\ndef explode_json_udtf(json_str):\n    \'\'\'\u89E3\u6790 JSON \u6570\u7EC4\uFF0C\u6BCF\u4E2A\u5143\u7D20\u8F93\u51FA\u4E00\u884C\'\'\'\n    if json_str is not None:\n        try:\n            data = json.loads(json_str)\n            if isinstance(data, list):\n                for item in data:\n                    yield (str(item),)\n        except:\n            pass  # \u89E3\u6790\u5931\u8D25\u5219\u8DF3\u8FC7\n$$;\n\nSELECT element\nFROM (SELECT \'["apple", "banana", "cherry"]\' as json_data) t\nLATERAL VIEW py_explode_json(json_data) tmp AS element;\n\n+---------+\n| element |\n+---------+\n| apple   |\n| banana  |\n| cherry  |\n+---------+\n'})}),"\n",(0,d.jsx)(e.h5,{id:"\u6A21\u5757\u6A21\u5F0F-module-mode-2",children:"\u6A21\u5757\u6A21\u5F0F (Module Mode)"}),"\n",(0,d.jsxs)(e.p,{children:["\u6A21\u5757\u6A21\u5F0F\u9002\u5408\u590D\u6742\u7684\u8868\u51FD\u6570\u903B\u8F91\uFF0C\u9700\u8981\u5C06 Python \u4EE3\u7801\u6253\u5305\u6210 ",(0,d.jsx)(e.code,{children:".zip"})," \u538B\u7F29\u5305\uFF0C\u5E76\u5728\u51FD\u6570\u521B\u5EFA\u65F6\u5F15\u7528\u3002"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 1: \u7F16\u5199 Python \u6A21\u5757"})}),"\n",(0,d.jsxs)(e.p,{children:["\u521B\u5EFA ",(0,d.jsx)(e.code,{children:"text_udtf.py"})," \u6587\u4EF6:"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:'import json\nimport re\n\ndef split_lines_udtf(text):\n    """\u6309\u884C\u5206\u5272\u6587\u672C"""\n    if text:\n        lines = text.split(\'\\n\')\n        for line in lines:\n            line = line.strip()\n            if line:  # \u8FC7\u6EE4\u7A7A\u884C\n                yield (line,)\n\n\ndef extract_emails_udtf(text):\n    """\u63D0\u53D6\u6587\u672C\u4E2D\u7684\u6240\u6709\u90AE\u7BB1\u5730\u5740"""\n    if text:\n        email_pattern = r\'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}\'\n        emails = re.findall(email_pattern, text)\n        for email in emails:\n            yield (email,)\n\n\ndef parse_json_object_udtf(json_str):\n    """\u89E3\u6790 JSON \u5BF9\u8C61\uFF0C\u8F93\u51FA\u952E\u503C\u5BF9"""\n    if json_str:\n        try:\n            data = json.loads(json_str)\n            if isinstance(data, dict):\n                for key, value in data.items():\n                    yield (key, str(value))\n        except:\n            pass\n\n\ndef expand_json_array_udtf(json_str):\n    """\u5C55\u5F00 JSON \u6570\u7EC4\u4E2D\u7684\u5BF9\u8C61\uFF0C\u8F93\u51FA\u7ED3\u6784\u5316\u6570\u636E"""\n    if json_str:\n        try:\n            data = json.loads(json_str)\n            if isinstance(data, list):\n                for item in data:\n                    if isinstance(item, dict):\n                        # \u5047\u8BBE\u6BCF\u4E2A\u5BF9\u8C61\u90FD\u6709 id, name, score \u5B57\u6BB5\n                        item_id = item.get(\'id\')\n                        name = item.get(\'name\')\n                        score = item.get(\'score\')\n                        yield (item_id, name, score)\n        except:\n            pass\n\n\ndef ngram_udtf(text, n):\n    """\u751F\u6210 N-gram \u8BCD\u7EC4"""\n    if text and n and n > 0:\n        words = text.split()\n        for i in range(len(words) - n + 1):\n            ngram = \' \'.join(words[i:i+n])\n            yield (ngram,)\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 2: \u6253\u5305 Python \u6A21\u5757"})}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u5FC5\u987B"}),"\u5C06 Python \u6587\u4EF6\u6253\u5305\u6210 ",(0,d.jsx)(e.code,{children:".zip"})," \u683C\u5F0F(\u5373\u4F7F\u53EA\u6709\u5355\u4E2A\u6587\u4EF6):"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"zip text_udtf.zip text_udtf.py\n"})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 3: \u8BBE\u7F6E Python \u6A21\u5757\u538B\u7F29\u5305\u7684\u8DEF\u5F84"})}),"\n",(0,d.jsxs)(e.p,{children:["\u652F\u6301\u591A\u79CD\u90E8\u7F72\u65B9\u5F0F\uFF0C\u901A\u8FC7 ",(0,d.jsx)(e.code,{children:"file"})," \u53C2\u6570\u6307\u5B9A ",(0,d.jsx)(e.code,{children:".zip"})," \u5305\u7684\u8DEF\u5F84:"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u65B9\u5F0F 1: \u672C\u5730\u6587\u4EF6\u7CFB\u7EDF"})," (\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"file://"})," \u534F\u8BAE)"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'"file" = "file:///path/to/text_udtf.zip"\n'})}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u65B9\u5F0F 2: HTTP/HTTPS \u8FDC\u7A0B\u4E0B\u8F7D"})," (\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"http://"})," \u6216 ",(0,d.jsx)(e.code,{children:"https://"})," \u534F\u8BAE)"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'"file" = "http://example.com/udtf/text_udtf.zip"\n"file" = "https://s3.amazonaws.com/bucket/text_udtf.zip"\n'})}),"\n",(0,d.jsx)(e.admonition,{title:"\u6CE8\u610F",type:"caution",children:(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u4F7F\u7528\u8FDC\u7A0B\u4E0B\u8F7D\u65B9\u5F0F\u65F6\uFF0C\u9700\u786E\u4FDD\u6240\u6709 BE \u8282\u70B9\u90FD\u80FD\u8BBF\u95EE\u8BE5 URL"}),"\n",(0,d.jsx)(e.li,{children:"\u9996\u6B21\u8C03\u7528\u65F6\u4F1A\u4E0B\u8F7D\u6587\u4EF6\uFF0C\u53EF\u80FD\u6709\u4E00\u5B9A\u5EF6\u8FDF"}),"\n",(0,d.jsx)(e.li,{children:"\u6587\u4EF6\u4F1A\u88AB\u7F13\u5B58\uFF0C\u540E\u7EED\u8C03\u7528\u65E0\u9700\u91CD\u590D\u4E0B\u8F7D"}),"\n"]})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 4: \u8BBE\u7F6E symbol \u53C2\u6570"})}),"\n",(0,d.jsxs)(e.p,{children:["\u5728\u6A21\u5757\u6A21\u5F0F\u4E0B\uFF0C",(0,d.jsx)(e.code,{children:"symbol"})," \u53C2\u6570\u7528\u4E8E\u6307\u5B9A\u51FD\u6570\u5728 ZIP \u5305\u4E2D\u7684\u4F4D\u7F6E\uFF0C\u683C\u5F0F\u4E3A:"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{children:"[package_name.]module_name.function_name\n"})}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u53C2\u6570\u8BF4\u660E"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"package_name"}),"(\u53EF\u9009): ZIP \u538B\u7F29\u5305\u5185\u9876\u5C42 Python \u5305\u7684\u540D\u79F0"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"module_name"}),"(\u5FC5\u586B): \u5305\u542B\u76EE\u6807\u51FD\u6570\u7684 Python \u6A21\u5757\u6587\u4EF6\u540D(\u4E0D\u542B ",(0,d.jsx)(e.code,{children:".py"})," \u540E\u7F00)"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"function_name"}),"(\u5FC5\u586B): UDTF \u51FD\u6570\u540D"]}),"\n"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u89E3\u6790\u89C4\u5219"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["Doris \u4F1A\u5C06 ",(0,d.jsx)(e.code,{children:"symbol"})," \u5B57\u7B26\u4E32\u6309 ",(0,d.jsx)(e.code,{children:"."})," \u5206\u5272:\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u5982\u679C\u5F97\u5230",(0,d.jsx)(e.strong,{children:"\u4E24\u4E2A"}),"\u5B50\u5B57\u7B26\u4E32\uFF0C\u5206\u522B\u4E3A ",(0,d.jsx)(e.code,{children:"module_name"})," \u548C ",(0,d.jsx)(e.code,{children:"function_name"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u5982\u679C\u5F97\u5230",(0,d.jsx)(e.strong,{children:"\u4E09\u4E2A\u53CA\u4EE5\u4E0A"}),"\u7684\u5B50\u5B57\u7B26\u4E32\uFF0C\u5F00\u5934\u4E3A ",(0,d.jsx)(e.code,{children:"package_name"}),"\uFF0C\u4E2D\u95F4\u4E3A ",(0,d.jsx)(e.code,{children:"module_name"}),"\uFF0C\u7ED3\u5C3E\u4E3A ",(0,d.jsx)(e.code,{children:"function_name"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 5: \u521B\u5EFA UDTF \u51FD\u6570"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_split_lines(STRING);\nDROP FUNCTION IF EXISTS py_extract_emails(STRING);\nDROP FUNCTION IF EXISTS py_parse_json(STRING);\nDROP FUNCTION IF EXISTS py_expand_json(STRING);\nDROP FUNCTION IF EXISTS py_ngram(STRING, INT);\n\nCREATE TABLES FUNCTION py_split_lines(STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/text_udtf.zip",\n    "symbol" = "text_udtf.split_lines_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE TABLES FUNCTION py_extract_emails(STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/text_udtf.zip",\n    "symbol" = "text_udtf.extract_emails_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE TABLES FUNCTION py_parse_json(STRING)\nRETURNS ARRAY<STRUCT<k:STRING, v:STRING>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/text_udtf.zip",\n    "symbol" = "text_udtf.parse_json_object_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE TABLES FUNCTION py_expand_json(STRING)\nRETURNS ARRAY<STRUCT<id:INT, name:STRING, score:DOUBLE>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/text_udtf.zip",\n    "symbol" = "text_udtf.expand_json_array_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE TABLES FUNCTION py_ngram(STRING, INT)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/text_udtf.zip",\n    "symbol" = "text_udtf.ngram_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6B65\u9AA4 6: \u4F7F\u7528\u51FD\u6570"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'SELECT line\nFROM (SELECT \'Line 1\\nLine 2\\nLine 3\' as text) t\nLATERAL VIEW py_split_lines(text) tmp AS line;\n\n+--------+\n| line   |\n+--------+\n| Line 1 |\n| Line 2 |\n| Line 3 |\n+--------+\n\nSELECT email\nFROM (SELECT \'Contact us at support@example.com or sales@company.org\' as content) t\nLATERAL VIEW py_extract_emails(content) tmp AS email;\n\n+---------------------+\n| email               |\n+---------------------+\n| support@example.com |\n| sales@company.org   |\n+---------------------+\n\nSELECT k, v\nFROM (SELECT \'{"name": "Alice", "age": "25"}\' as json_data) t\nLATERAL VIEW py_parse_json(json_data) tmp AS k, v;\n\n+------+-------+\n| k    | v     |\n+------+-------+\n| name | Alice |\n| age  | 25    |\n+------+-------+\n\nSELECT id, name, score\nFROM (\n    SELECT \'[{"id": 1, "name": "Alice", "score": 95.5}, {"id": 2, "name": "Bob", "score": 88.0}]\' as data\n) t\nLATERAL VIEW py_expand_json(data) tmp AS id, name, score;\n\n+------+-------+-------+\n| id   | name  | score |\n+------+-------+-------+\n|    1 | Alice |  95.5 |\n|    2 | Bob   |    88 |\n+------+-------+-------+\n\nSELECT ngram\nFROM (SELECT \'Apache Doris is a fast database\' as text) t\nLATERAL VIEW py_ngram(text, 2) tmp AS ngram;\n\n+---------------+\n| ngram         |\n+---------------+\n| Apache Doris  |\n| Doris is      |\n| is a          |\n| a fast        |\n| fast database |\n+---------------+\n'})}),"\n",(0,d.jsx)(e.h4,{id:"\u5220\u9664-python-udtf",children:"\u5220\u9664 Python UDTF"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"-- \u8BED\u6CD5\nDROP FUNCTION IF EXISTS function_name(parameter_types);\n\n-- \u793A\u4F8B\nDROP FUNCTION IF EXISTS py_split(STRING, STRING);\nDROP FUNCTION IF EXISTS py_range(INT, INT);\nDROP FUNCTION IF EXISTS py_explode_json(STRING);\n"})}),"\n",(0,d.jsx)(e.h4,{id:"\u4FEE\u6539-python-udtf",children:"\u4FEE\u6539 Python UDTF"}),"\n",(0,d.jsx)(e.p,{children:"Doris \u4E0D\u652F\u6301\u76F4\u63A5\u4FEE\u6539\u5DF2\u6709\u51FD\u6570\uFF0C\u9700\u8981\u5148\u5220\u9664\u518D\u91CD\u65B0\u521B\u5EFA:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS py_split(STRING, STRING);\nCREATE TABLES FUNCTION py_split(STRING, STRING) ...;\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u53C2\u6570\u8BF4\u660E-2",children:"\u53C2\u6570\u8BF4\u660E"}),"\n",(0,d.jsx)(e.h4,{id:"create-tables-function-\u53C2\u6570",children:"CREATE TABLES FUNCTION \u53C2\u6570"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u53C2\u6570"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"function_name"})}),(0,d.jsx)(e.td,{children:"\u51FD\u6570\u540D\u79F0\uFF0C\u9075\u5FAA SQL \u6807\u8BC6\u7B26\u547D\u540D\u89C4\u5219"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"parameter_types"})}),(0,d.jsxs)(e.td,{children:["\u53C2\u6570\u7C7B\u578B\u5217\u8868\uFF0C\u5982 ",(0,d.jsx)(e.code,{children:"INT"}),"\uFF0C ",(0,d.jsx)(e.code,{children:"STRING"}),"\uFF0C ",(0,d.jsx)(e.code,{children:"DOUBLE"})," \u7B49"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"RETURNS ARRAY<...>"})}),(0,d.jsxs)(e.td,{children:["\u8FD4\u56DE\u7684\u6570\u7EC4\u7C7B\u578B\uFF0C\u5B9A\u4E49\u8F93\u51FA\u7ED3\u6784",(0,d.jsx)(e.br,{}),"\u2022 \u5355\u5217: ",(0,d.jsx)(e.code,{children:"ARRAY<\u7C7B\u578B>"}),(0,d.jsx)(e.br,{}),"\u2022 \u591A\u5217: ",(0,d.jsx)(e.code,{children:"ARRAY<STRUCT<col1:type1, col2:type2, ...>>"})]})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"properties-\u53C2\u6570-2",children:"PROPERTIES \u53C2\u6570"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u53C2\u6570"}),(0,d.jsx)(e.th,{children:"\u662F\u5426\u5FC5\u9700"}),(0,d.jsx)(e.th,{children:"\u9ED8\u8BA4\u503C"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"type"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["\u56FA\u5B9A\u4E3A ",(0,d.jsx)(e.code,{children:'"PYTHON_UDF"'})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"symbol"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["Python \u51FD\u6570\u540D\u3002",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.strong,{children:"\u5185\u8054\u6A21\u5F0F"}),": \u76F4\u63A5\u5199\u51FD\u6570\u540D\uFF0C\u5982 ",(0,d.jsx)(e.code,{children:'"split_string_udtf"'}),(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.strong,{children:"\u6A21\u5757\u6A21\u5F0F"}),": \u683C\u5F0F\u4E3A ",(0,d.jsx)(e.code,{children:"[package_name.]module_name.function_name"})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"file"})}),(0,d.jsx)(e.td,{children:"\u5426"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["Python ",(0,d.jsx)(e.code,{children:".zip"})," \u5305\u8DEF\u5F84\uFF0C\u4EC5\u6A21\u5757\u6A21\u5F0F\u9700\u8981\u3002\u652F\u6301\u4E09\u79CD\u534F\u8BAE:",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.code,{children:"file://"})," - \u672C\u5730\u6587\u4EF6\u7CFB\u7EDF\u8DEF\u5F84",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.code,{children:"http://"})," - HTTP \u8FDC\u7A0B\u4E0B\u8F7D",(0,d.jsx)(e.br,{}),"\u2022 ",(0,d.jsx)(e.code,{children:"https://"})," - HTTPS \u8FDC\u7A0B\u4E0B\u8F7D"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"runtime_version"})}),(0,d.jsx)(e.td,{children:"\u662F"}),(0,d.jsx)(e.td,{children:"-"}),(0,d.jsxs)(e.td,{children:["Python \u8FD0\u884C\u65F6\u7248\u672C\uFF0C\u5982 ",(0,d.jsx)(e.code,{children:'"3.10.12"'})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"always_nullable"})}),(0,d.jsx)(e.td,{children:"\u5426"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"true"})}),(0,d.jsx)(e.td,{children:"\u662F\u5426\u603B\u662F\u8FD4\u56DE\u53EF\u7A7A\u7ED3\u679C"})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"runtime_version-\u8BF4\u660E-1",children:"runtime_version \u8BF4\u660E"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u5FC5\u987B\u586B\u5199 Python \u7248\u672C\u7684",(0,d.jsx)(e.strong,{children:"\u5B8C\u6574\u7248\u672C\u53F7"}),"\uFF0C\u683C\u5F0F\u4E3A ",(0,d.jsx)(e.code,{children:"x.x.x"})," \u6216 ",(0,d.jsx)(e.code,{children:"x.x.xx"})]}),"\n",(0,d.jsx)(e.li,{children:"Doris \u4F1A\u5728\u914D\u7F6E\u7684 Python \u73AF\u5883\u4E2D\u67E5\u627E\u5339\u914D\u8BE5\u7248\u672C\u7684\u89E3\u91CA\u5668"}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u6570\u636E\u7C7B\u578B\u6620\u5C04-2",children:"\u6570\u636E\u7C7B\u578B\u6620\u5C04"}),"\n",(0,d.jsx)(e.p,{children:"Python UDTF \u4F7F\u7528\u4E0E Python UDF \u5B8C\u5168\u76F8\u540C\u7684\u6570\u636E\u7C7B\u578B\u6620\u5C04\u89C4\u5219\uFF0C\u5305\u62EC\u6574\u6570\u3001\u6D6E\u70B9\u3001\u5B57\u7B26\u4E32\u3001\u65E5\u671F\u65F6\u95F4\u3001Decimal\u3001\u5E03\u5C14\u3001\u6570\u7EC4\u3001STRUCT \u7B49\u6240\u6709\u7C7B\u578B\u3002"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u8BE6\u7EC6\u7684\u6570\u636E\u7C7B\u578B\u6620\u5C04\u5173\u7CFB\u8BF7\u53C2\u8003"}),": ",(0,d.jsx)(e.a,{href:"python-user-defined-function#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E6%98%A0%E5%B0%84",children:"\u6570\u636E\u7C7B\u578B\u6620\u5C04"})]}),"\n",(0,d.jsx)(e.h4,{id:"null-\u503C\u5904\u7406-2",children:"NULL \u503C\u5904\u7406"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["Doris \u4F1A\u5C06 SQL \u4E2D\u7684 ",(0,d.jsx)(e.code,{children:"NULL"})," \u503C\u6620\u5C04\u4E3A Python \u7684 ",(0,d.jsx)(e.code,{children:"None"})]}),"\n",(0,d.jsxs)(e.li,{children:["\u5728\u51FD\u6570\u4E2D\uFF0C\u9700\u8981\u68C0\u67E5\u53C2\u6570\u662F\u5426\u4E3A ",(0,d.jsx)(e.code,{children:"None"})]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"yield"})," \u4EA7\u51FA\u7684\u503C\u53EF\u4EE5\u5305\u542B ",(0,d.jsx)(e.code,{children:"None"}),"\uFF0C\u8868\u793A\u8BE5\u5217\u4E3A ",(0,d.jsx)(e.code,{children:"NULL"})]}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u5B9E\u9645\u5E94\u7528\u573A\u666F-2",children:"\u5B9E\u9645\u5E94\u7528\u573A\u666F"}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-1-csv-\u6570\u636E\u89E3\u6790",children:"\u573A\u666F 1: CSV \u6570\u636E\u89E3\u6790"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_parse_csv(STRING);\n\nCREATE TABLES FUNCTION py_parse_csv(STRING)\nRETURNS ARRAY<STRUCT<name:STRING, age:INT, city:STRING>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "parse_csv_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef parse_csv_udtf(csv_data):\n    \'\'\'\u89E3\u6790 CSV \u683C\u5F0F\u7684\u591A\u884C\u6570\u636E\'\'\'\n    if csv_data is None:\n        return\n    lines = csv_data.strip().split(\'\\n\')\n    for line in lines:\n        parts = line.split(\',\')\n        if len(parts) >= 3:\n            name = parts[0].strip()\n            age = int(parts[1].strip()) if parts[1].strip().isdigit() else None\n            city = parts[2].strip()\n            yield (name, age, city)\n$$;\n\nSELECT name, age, city\nFROM (\n    SELECT \'Alice,25,Beijing\\nBob,30,Shanghai\\nCharlie,28,Guangzhou\' as data\n) t\nLATERAL VIEW py_parse_csv(data) tmp AS name, age, city;\n\n+---------+------+-----------+\n| name    | age  | city      |\n+---------+------+-----------+\n| Alice   |   25 | Beijing   |\n| Bob     |   30 | Shanghai  |\n| Charlie |   28 | Guangzhou |\n+---------+------+-----------+\n'})}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-2-\u65E5\u671F\u8303\u56F4\u751F\u6210",children:"\u573A\u666F 2: \u65E5\u671F\u8303\u56F4\u751F\u6210"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS py_date_range(STRING, STRING);\n\nCREATE TABLES FUNCTION py_date_range(STRING, STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"date_range_udtf\",\n    \"runtime_version\" = \"3.10.12\",\n    \"always_nullable\" = \"true\"\n)\nAS $$\nfrom datetime import datetime, timedelta\n\ndef date_range_udtf(start_date, end_date):\n    '''\u751F\u6210\u65E5\u671F\u8303\u56F4'''\n    if start_date is None or end_date is None:\n        return\n    try:\n        start = datetime.strptime(start_date, '%Y-%m-%d')\n        end = datetime.strptime(end_date, '%Y-%m-%d')\n        current = start\n        while current <= end:\n            yield (current.strftime('%Y-%m-%d'),)\n            current += timedelta(days=1)\n    except:\n        pass\n$$;\n\nSELECT date\nFROM (SELECT '2024-01-01' as start_date, '2024-01-07' as end_date) t\nLATERAL VIEW py_date_range(start_date, end_date) tmp AS date;\n\n+------------+\n| date       |\n+------------+\n| 2024-01-01 |\n| 2024-01-02 |\n| 2024-01-03 |\n| 2024-01-04 |\n| 2024-01-05 |\n| 2024-01-06 |\n| 2024-01-07 |\n+------------+\n"})}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-3-\u6587\u672C\u5206\u8BCD",children:"\u573A\u666F 3: \u6587\u672C\u5206\u8BCD"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_tokenize(STRING);\n\nCREATE TABLES FUNCTION py_tokenize(STRING)\nRETURNS ARRAY<STRUCT<word:STRING, position:INT>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "tokenize_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nimport re\n\ndef tokenize_udtf(text):\n    \'\'\'\u5C06\u6587\u672C\u5206\u8BCD\uFF0C\u8F93\u51FA\u5355\u8BCD\u548C\u4F4D\u7F6E\'\'\'\n    if text is None:\n        return\n    # \u4F7F\u7528\u6B63\u5219\u63D0\u53D6\u5355\u8BCD\n    words = re.findall(r\'\\b\\w+\\b\', text.lower())\n    for i, word in enumerate(words, 1):\n        if len(word) >= 2:  # \u8FC7\u6EE4\u5355\u5B57\u7B26\n            yield (word, i)\n$$;\n\nSELECT word, position\nFROM (SELECT \'Apache Doris is a fast OLAP database\' as text) t\nLATERAL VIEW py_tokenize(text) tmp AS word, position;\n\n+----------+----------+\n| word     | position |\n+----------+----------+\n| apache   |        1 |\n| doris    |        2 |\n| is       |        3 |\n| fast     |        5 |\n| olap     |        6 |\n| database |        7 |\n+----------+----------+\n'})}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-4-url-\u53C2\u6570\u89E3\u6790",children:"\u573A\u666F 4: URL \u53C2\u6570\u89E3\u6790"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_parse_url_params(STRING);\n\nCREATE TABLES FUNCTION py_parse_url_params(STRING)\nRETURNS ARRAY<STRUCT<param_name:STRING, param_value:STRING>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "parse_url_params_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nfrom urllib.parse import urlparse, parse_qs\n\ndef parse_url_params_udtf(url):\n    \'\'\'\u89E3\u6790 URL \u53C2\u6570\'\'\'\n    if url is None:\n        return\n    try:\n        parsed = urlparse(url)\n        params = parse_qs(parsed.query)\n        for key, values in params.items():\n            for value in values:\n                yield (key, value)\n    except:\n        pass\n$$;\n\nSELECT param_name, param_value\nFROM (\n    SELECT \'https://example.com/page?id=123&category=tech&tag=python&tag=database\' as url\n) t\nLATERAL VIEW py_parse_url_params(url) tmp AS param_name, param_value;\n\n+------------+-------------+\n| param_name | param_value |\n+------------+-------------+\n| id         | 123         |\n| category   | tech        |\n| tag        | python      |\n| tag        | database    |\n+------------+-------------+\n'})}),"\n",(0,d.jsx)(e.h4,{id:"\u573A\u666F-5-ip-\u8303\u56F4\u5C55\u5F00",children:"\u573A\u666F 5: IP \u8303\u56F4\u5C55\u5F00"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_expand_ip_range(STRING, STRING);\n\nCREATE TABLES FUNCTION py_expand_ip_range(STRING, STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "expand_ip_range_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef expand_ip_range_udtf(start_ip, end_ip):\n    \'\'\'\u5C55\u5F00 IP \u5730\u5740\u8303\u56F4\uFF08\u4EC5\u652F\u6301\u6700\u540E\u4E00\u6BB5\uFF09\'\'\'\n    if start_ip is None or end_ip is None:\n        return\n    try:\n        # \u5047\u8BBE\u683C\u5F0F: 192.168.1.10 \u5230 192.168.1.20\n        start_parts = start_ip.split(\'.\')\n        end_parts = end_ip.split(\'.\')\n        \n        if len(start_parts) == 4 and len(end_parts) == 4:\n            # \u53EA\u5C55\u5F00\u6700\u540E\u4E00\u6BB5\n            if start_parts[:3] == end_parts[:3]:\n                prefix = \'.\'.join(start_parts[:3])\n                start_num = int(start_parts[3])\n                end_num = int(end_parts[3])\n                for i in range(start_num, end_num + 1):\n                    yield (f"{prefix}.{i}",)\n    except:\n        pass\n$$;\n\nSELECT ip\nFROM (SELECT \'192.168.1.10\' as start_ip, \'192.168.1.15\' as end_ip) t\nLATERAL VIEW py_expand_ip_range(start_ip, end_ip) tmp AS ip;\n\n+--------------+\n| ip           |\n+--------------+\n| 192.168.1.10 |\n| 192.168.1.11 |\n| 192.168.1.12 |\n| 192.168.1.13 |\n| 192.168.1.14 |\n| 192.168.1.15 |\n+--------------+\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE-2",children:"\u6027\u80FD\u4F18\u5316\u5EFA\u8BAE"}),"\n",(0,d.jsx)(e.h4,{id:"1-\u63A7\u5236\u8F93\u51FA\u884C\u6570",children:"1. \u63A7\u5236\u8F93\u51FA\u884C\u6570"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u5BF9\u4E8E\u53EF\u80FD\u4EA7\u751F\u5927\u91CF\u8F93\u51FA\u7684\u573A\u666F\uFF0C\u8BBE\u7F6E\u5408\u7406\u7684\u4E0A\u9650"}),"\n",(0,d.jsx)(e.li,{children:"\u907F\u514D\u7B1B\u5361\u5C14\u79EF\u7206\u70B8"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"2-\u907F\u514D\u91CD\u590D\u8BA1\u7B97",children:"2. \u907F\u514D\u91CD\u590D\u8BA1\u7B97"}),"\n",(0,d.jsx)(e.p,{children:"\u5982\u679C\u9700\u8981\u591A\u6B21\u4F7F\u7528\u540C\u4E00\u4E2A\u8BA1\u7B97\u7ED3\u679C\uFF0C\u9884\u5148\u8BA1\u7B97:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:"# \u4E0D\u63A8\u8350\ndef bad_split_udtf(text):\n    for i in range(len(text.split(','))):  # \u6BCF\u6B21\u90FD split\n        parts = text.split(',')\n        yield (parts[i],)\n\n# \u63A8\u8350\ndef good_split_udtf(text):\n    parts = text.split(',')  # \u53EA split \u4E00\u6B21\n    for part in parts:\n        yield (part,)\n"})}),"\n",(0,d.jsx)(e.h4,{id:"3-\u4F7F\u7528\u751F\u6210\u5668\u8868\u8FBE\u5F0F",children:"3. \u4F7F\u7528\u751F\u6210\u5668\u8868\u8FBE\u5F0F"}),"\n",(0,d.jsx)(e.p,{children:"\u5229\u7528 Python \u7684\u751F\u6210\u5668\u7279\u6027\uFF0C\u907F\u514D\u521B\u5EFA\u4E2D\u95F4\u5217\u8868:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:"# \u4E0D\u63A8\u8350\ndef bad_filter_udtf(text, delimiter):\n    parts = text.split(delimiter)\n    filtered = [p.strip() for p in parts if p.strip()]  # \u521B\u5EFA\u5217\u8868\n    for part in filtered:\n        yield (part,)\n\n# \u63A8\u8350\ndef good_filter_udtf(text, delimiter):\n    parts = text.split(delimiter)\n    for part in parts:\n        part = part.strip()\n        if part:  # \u76F4\u63A5\u8FC7\u6EE4\n            yield (part,)\n"})}),"\n",(0,d.jsx)(e.h4,{id:"4-\u907F\u514D\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90",children:"4. \u907F\u514D\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u4E0D\u8981\u5728 UDTF \u4E2D\u8BBF\u95EE\u6570\u636E\u5E93\u3001\u6587\u4EF6\u3001\u7F51\u7EDC"}),"\n",(0,d.jsx)(e.li,{children:"\u6240\u6709\u5904\u7406\u5E94\u57FA\u4E8E\u8F93\u5165\u53C2\u6570"}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879-2",children:"\u9650\u5236\u4E0E\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,d.jsx)(e.h4,{id:"1-\u65E0\u72B6\u6001\u9650\u5236",children:"1. \u65E0\u72B6\u6001\u9650\u5236"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["Python UDTF \u662F",(0,d.jsx)(e.strong,{children:"\u65E0\u72B6\u6001"}),"\u7684\uFF0C\u6BCF\u6B21\u51FD\u6570\u8C03\u7528\u72EC\u7ACB\u5904\u7406\u4E00\u884C"]}),"\n",(0,d.jsx)(e.li,{children:"\u4E0D\u80FD\u5728\u591A\u6B21\u8C03\u7528\u4E4B\u95F4\u4FDD\u7559\u72B6\u6001"}),"\n",(0,d.jsx)(e.li,{children:"\u5982\u679C\u9700\u8981\u8DE8\u884C\u805A\u5408\uFF0C\u5E94\u4F7F\u7528 UDAF"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"2-\u6027\u80FD\u8003\u8651",children:"2. \u6027\u80FD\u8003\u8651"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"Python UDTF \u6027\u80FD\u4F4E\u4E8E\u5185\u7F6E\u8868\u51FD\u6570"}),"\n",(0,d.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u903B\u8F91\u590D\u6742\u4F46\u6570\u636E\u91CF\u9002\u4E2D\u7684\u573A\u666F"}),"\n",(0,d.jsx)(e.li,{children:"\u5927\u6570\u636E\u91CF\u573A\u666F\u4F18\u5148\u8003\u8651\u4F18\u5316\u6216\u4F7F\u7528\u5185\u7F6E\u51FD\u6570"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"3-\u8F93\u51FA\u7C7B\u578B\u56FA\u5B9A",children:"3. \u8F93\u51FA\u7C7B\u578B\u56FA\u5B9A"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"RETURNS ARRAY<...>"})," \u5B9A\u4E49\u7684\u7C7B\u578B\u662F\u56FA\u5B9A\u7684"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"yield"})," \u4EA7\u51FA\u7684\u503C\u5FC5\u987B\u4E0E\u5B9A\u4E49\u5339\u914D"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5355\u5217: ",(0,d.jsx)(e.code,{children:"yield value"}),"\u6216",(0,d.jsx)(e.code,{children:"yield (value,)"}),"\uFF0C\u591A\u5217: ",(0,d.jsx)(e.code,{children:"yield (value1, value2, ...)"})]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"4-\u51FD\u6570\u547D\u540D-1",children:"4. \u51FD\u6570\u547D\u540D"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u540C\u4E00\u51FD\u6570\u540D\u5728\u4E0D\u540C\u6570\u636E\u5E93\u4E2D\u53EF\u91CD\u590D\u5B9A\u4E49"}),"\n",(0,d.jsx)(e.li,{children:"\u8C03\u7528\u65F6\u5EFA\u8BAE\u6307\u5B9A\u6570\u636E\u5E93\u540D\u4EE5\u907F\u514D\u6B67\u4E49"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"5-\u73AF\u5883\u4E00\u81F4\u6027-1",children:"5. \u73AF\u5883\u4E00\u81F4\u6027"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u6240\u6709 BE \u8282\u70B9\u7684 Python \u73AF\u5883\u5FC5\u987B\u4E00\u81F4"}),"\n",(0,d.jsx)(e.li,{children:"\u5305\u62EC Python \u7248\u672C\u3001\u4F9D\u8D56\u5305\u7248\u672C\u3001\u73AF\u5883\u914D\u7F6E"}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u5E38\u89C1\u95EE\u9898-faq-1",children:"\u5E38\u89C1\u95EE\u9898 FAQ"}),"\n",(0,d.jsx)(e.h4,{id:"q1-udtf-\u548C-udf-\u7684\u533A\u522B\u662F\u4EC0\u4E48",children:"Q1: UDTF \u548C UDF \u7684\u533A\u522B\u662F\u4EC0\u4E48?"}),"\n",(0,d.jsxs)(e.p,{children:["A: ",(0,d.jsx)(e.strong,{children:"UDF"})," \u8F93\u5165\u5355\u884C\uFF0C\u8F93\u51FA\u5355\u884C\uFF0C\u4E3A\u4E00\u5BF9\u4E00\u5173\u7CFB\u3002",(0,d.jsx)(e.strong,{children:"UDTF"})," \u8F93\u5165\u5355\u884C\uFF0C\u8F93\u51FA\u96F6\u884C\u6216\u591A\u884C\uFF0C\u4E3A\u4E00\u5BF9\u591A\u5173\u7CFB\u3002"]}),"\n",(0,d.jsx)(e.p,{children:"\u793A\u4F8B:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"SELECT py_upper(name) FROM users;\n\nSELECT tag FROM users LATERAL VIEW py_split(tags, ',') tmp AS tag;\n"})}),"\n",(0,d.jsx)(e.h4,{id:"q2-\u5982\u4F55\u8F93\u51FA\u591A\u5217",children:"Q2: \u5982\u4F55\u8F93\u51FA\u591A\u5217?"}),"\n",(0,d.jsxs)(e.p,{children:["A: \u591A\u5217\u8F93\u51FA\u4F7F\u7528 STRUCT \u5B9A\u4E49\u8FD4\u56DE\u7C7B\u578B\uFF0C\u5E76\u5728 ",(0,d.jsx)(e.code,{children:"yield"})," \u65F6\u4EA7\u51FA\u5143\u7EC4:"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"CREATE TABLES FUNCTION func(...)\nRETURNS ARRAY<STRUCT<col1:INT, col2:STRING>>\n...\n\ndef func(...):\n    yield (123, 'hello')  # \u5BF9\u5E94 col1 \u548C col2\n"})}),"\n",(0,d.jsx)(e.h4,{id:"q3-\u4E3A\u4EC0\u4E48\u6211\u7684-udtf-\u6CA1\u6709\u8F93\u51FA",children:"Q3: \u4E3A\u4EC0\u4E48\u6211\u7684 UDTF \u6CA1\u6709\u8F93\u51FA?"}),"\n",(0,d.jsx)(e.p,{children:"A: \u53EF\u80FD\u7684\u539F\u56E0:"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u672A\u8C03\u7528 yield"}),": \u786E\u4FDD\u5728\u51FD\u6570\u4E2D\u8C03\u7528\u4E86 ",(0,d.jsx)(e.code,{children:"yield"})]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u6761\u4EF6\u8FC7\u6EE4"}),": \u6240\u6709\u6570\u636E\u90FD\u88AB\u8FC7\u6EE4\u6389\u4E86"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u5F02\u5E38\u88AB\u6355\u83B7"}),": \u68C0\u67E5\u662F\u5426\u6709 try-except \u541E\u6389\u4E86\u9519\u8BEF"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"NULL \u8F93\u5165"}),": \u8F93\u5165\u662F NULL \u4E14\u51FD\u6570\u76F4\u63A5\u8FD4\u56DE"]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"q4-udtf-\u53EF\u4EE5\u7EF4\u62A4\u72B6\u6001\u5417",children:"Q4: UDTF \u53EF\u4EE5\u7EF4\u62A4\u72B6\u6001\u5417?"}),"\n",(0,d.jsx)(e.p,{children:"A: \u4E0D\u80FD\u3002Python UDTF \u662F\u65E0\u72B6\u6001\u7684\uFF0C\u6BCF\u6B21\u51FD\u6570\u8C03\u7528\u72EC\u7ACB\u5904\u7406\u4E00\u884C\u3002\u5982\u679C\u9700\u8981\u8DE8\u884C\u805A\u5408\u6216\u7EF4\u62A4\u72B6\u6001\uFF0C\u5E94\u4F7F\u7528 Python UDAF\u3002"}),"\n",(0,d.jsx)(e.h4,{id:"q5-\u5982\u4F55\u9650\u5236-udtf-\u7684\u8F93\u51FA\u884C\u6570",children:"Q5: \u5982\u4F55\u9650\u5236 UDTF \u7684\u8F93\u51FA\u884C\u6570?"}),"\n",(0,d.jsx)(e.p,{children:"A: \u5728\u51FD\u6570\u4E2D\u6DFB\u52A0\u8BA1\u6570\u5668\u6216\u6761\u4EF6\u5224\u65AD:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:"def limited_udtf(data):\n    max_rows = 1000\n    count = 0\n    for item in data.split(','):\n        if count >= max_rows:\n            break\n        yield (item,)\n        count += 1\n"})}),"\n",(0,d.jsx)(e.h4,{id:"q6-udtf-\u8F93\u51FA\u7684\u6570\u636E\u7C7B\u578B\u6709\u9650\u5236\u5417",children:"Q6: UDTF \u8F93\u51FA\u7684\u6570\u636E\u7C7B\u578B\u6709\u9650\u5236\u5417?"}),"\n",(0,d.jsxs)(e.p,{children:["A: UDTF \u652F\u6301\u6240\u6709 Doris \u6570\u636E\u7C7B\u578B\uFF0C\u5305\u62EC\u57FA\u672C\u7C7B\u578B\uFF08INT\u3001STRING\u3001DOUBLE \u7B49\uFF09\u548C\u590D\u6742\u7C7B\u578B\uFF08ARRAY\u3001STRUCT\u3001MAP \u7B49\uFF09\u3002\u8F93\u51FA\u7C7B\u578B\u5FC5\u987B\u5728 ",(0,d.jsx)(e.code,{children:"RETURNS ARRAY<...>"})," \u4E2D\u660E\u786E\u5B9A\u4E49\u3002"]}),"\n",(0,d.jsx)(e.h4,{id:"q7-\u53EF\u4EE5\u5728-udtf-\u4E2D\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90\u5417",children:"Q7: \u53EF\u4EE5\u5728 UDTF \u4E2D\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90\u5417?"}),"\n",(0,d.jsxs)(e.p,{children:["A: \u6280\u672F\u4E0A\u53EF\u4EE5\uFF0C\u4F46",(0,d.jsx)(e.strong,{children:"\u5F3A\u70C8\u4E0D\u63A8\u8350"}),"\u3002UDTF \u5E94\u8BE5\u662F\u7EAF\u51FD\u6570\u5F0F\u7684\uFF0C\u53EA\u57FA\u4E8E\u8F93\u5165\u53C2\u6570\u8FDB\u884C\u5904\u7406\u3002\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90\uFF08\u6570\u636E\u5E93\u3001\u6587\u4EF6\u3001\u7F51\u7EDC\uFF09\u4F1A\u5BFC\u81F4\u6027\u80FD\u95EE\u9898\u548C\u4E0D\u53EF\u9884\u6D4B\u7684\u884C\u4E3A\u3002"]}),"\n",(0,d.jsx)(e.h2,{id:"python-udfudafudtf-\u73AF\u5883\u914D\u7F6E\u4E0E\u591A\u7248\u672C\u7BA1\u7406",children:"Python UDF/UDAF/UDTF \u73AF\u5883\u914D\u7F6E\u4E0E\u591A\u7248\u672C\u7BA1\u7406"}),"\n",(0,d.jsx)(e.h3,{id:"python-\u73AF\u5883\u7BA1\u7406",children:"Python \u73AF\u5883\u7BA1\u7406"}),"\n",(0,d.jsxs)(e.p,{children:["\u5728\u4F7F\u7528 Python UDF/UDAF/UDTF \u4E4B\u524D\uFF0C\u8BF7\u786E\u4FDD Doris \u7684 Backend (BE) \u8282\u70B9\u5DF2\u6B63\u786E\u914D\u7F6E Python \u8FD0\u884C\u73AF\u5883\u3002Doris \u652F\u6301\u901A\u8FC7 ",(0,d.jsx)(e.strong,{children:"Conda"})," \u6216 ",(0,d.jsx)(e.strong,{children:"Virtual Environment (venv)"})," \u7BA1\u7406 Python \u73AF\u5883\uFF0C\u5141\u8BB8\u4E0D\u540C\u7684 UDF \u4F7F\u7528\u4E0D\u540C\u7248\u672C\u7684 Python \u89E3\u91CA\u5668\u548C\u4F9D\u8D56\u5E93\u3002"]}),"\n",(0,d.jsx)(e.p,{children:"Doris \u63D0\u4F9B\u4E24\u79CD Python \u73AF\u5883\u7BA1\u7406\u65B9\u5F0F:"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"Conda \u6A21\u5F0F"}),": \u4F7F\u7528 Miniconda/Anaconda \u7BA1\u7406\u591A\u7248\u672C\u73AF\u5883"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"Venv \u6A21\u5F0F"}),": \u4F7F\u7528 Python \u5185\u7F6E\u7684\u865A\u62DF\u73AF\u5883 (venv) \u7BA1\u7406\u591A\u7248\u672C\u73AF\u5883"]}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u7B2C\u4E09\u65B9\u5E93\u7684\u5B89\u88C5\u4E0E\u4F7F\u7528",children:"\u7B2C\u4E09\u65B9\u5E93\u7684\u5B89\u88C5\u4E0E\u4F7F\u7528"}),"\n",(0,d.jsxs)(e.p,{children:["Python UDF\u3001UDAF\u3001UDTF \u90FD\u53EF\u4EE5\u4F7F\u7528\u7B2C\u4E09\u65B9\u5E93\u3002\u4F46\u7531\u4E8E Doris \u7684\u5206\u5E03\u5F0F\u7279\u6027\uFF0C\u9700\u8981\u5728",(0,d.jsx)(e.strong,{children:"\u6240\u6709 BE \u8282\u70B9"}),"\u4E0A\u7EDF\u4E00\u5B89\u88C5\u7B2C\u4E09\u65B9\u5E93\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4\u90E8\u5206\u8282\u70B9\u6267\u884C\u5931\u8D25\u3002"]}),"\n",(0,d.jsx)(e.h4,{id:"\u5B89\u88C5\u6B65\u9AA4",children:"\u5B89\u88C5\u6B65\u9AA4"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u5728\u6BCF\u4E2A BE \u8282\u70B9\u4E0A\u5B89\u88C5\u4F9D\u8D56"}),":"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"# \u4F7F\u7528 pip \u5B89\u88C5\npip install numpy pandas requests\n\n# \u6216\u4F7F\u7528 conda \u5B89\u88C5\nconda install numpy pandas requests -y\n"})}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u5728\u51FD\u6570\u4E2D\u5BFC\u5165\u5E76\u4F7F\u7528"}),":"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:"import numpy as np\nimport pandas as pd\n\n# \u5728 UDF/UDAF/UDTF \u51FD\u6570\u4E2D\u4F7F\u7528\ndef my_function(x):\n    return np.sqrt(x)\n"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"\u6CE8\u610F\u4E8B\u9879",children:"\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsxs)(e.strong,{children:[(0,d.jsx)(e.code,{children:"pandas"})," \u548C ",(0,d.jsx)(e.code,{children:"pyarrow"})," \u662F\u5F3A\u5236\u4F9D\u8D56"]}),"\uFF0C\u5FC5\u987B\u5728\u6240\u6709 Python \u73AF\u5883\u4E2D\u9884\u5148\u5B89\u88C5\uFF0C\u5426\u5219 Python UDF/UDAF/UDTF \u65E0\u6CD5\u8FD0\u884C"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5FC5\u987B\u5728",(0,d.jsx)(e.strong,{children:"\u6240\u6709 BE \u8282\u70B9"}),"\u4E0A\u5B89\u88C5\u76F8\u540C\u7248\u672C\u7684\u4F9D\u8D56\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4\u90E8\u5206\u8282\u70B9\u6267\u884C\u5931\u8D25"]}),"\n",(0,d.jsx)(e.li,{children:"\u5B89\u88C5\u8DEF\u5F84\u8981\u4E0E\u5BF9\u5E94 UDF/UDAF/UDTF \u4F7F\u7528\u7684 Python \u8FD0\u884C\u65F6\u73AF\u5883\u4E00\u81F4"}),"\n",(0,d.jsx)(e.li,{children:"\u5EFA\u8BAE\u4F7F\u7528\u865A\u62DF\u73AF\u5883\u6216 Conda \u73AF\u5883\u7BA1\u7406\u4F9D\u8D56\uFF0C\u907F\u514D\u4E0E\u7CFB\u7EDF Python \u73AF\u5883\u51B2\u7A81"}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"be-\u914D\u7F6E\u53C2\u6570",children:"BE \u914D\u7F6E\u53C2\u6570"}),"\n",(0,d.jsxs)(e.p,{children:["\u5728\u6240\u6709 BE \u8282\u70B9\u7684 ",(0,d.jsx)(e.code,{children:"be.conf"})," \u914D\u7F6E\u6587\u4EF6\u4E2D\u8BBE\u7F6E\u4EE5\u4E0B\u53C2\u6570\uFF0C\u5E76",(0,d.jsx)(e.strong,{children:"\u91CD\u542F BE"})," \u4F7F\u914D\u7F6E\u751F\u6548\u3002"]}),"\n",(0,d.jsx)(e.h4,{id:"\u914D\u7F6E\u53C2\u6570\u8BF4\u660E",children:"\u914D\u7F6E\u53C2\u6570\u8BF4\u660E"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u53C2\u6570\u540D"}),(0,d.jsx)(e.th,{children:"\u7C7B\u578B"}),(0,d.jsx)(e.th,{children:"\u53EF\u9009\u503C"}),(0,d.jsx)(e.th,{children:"\u9ED8\u8BA4\u503C"}),(0,d.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"enable_python_udf_support"})}),(0,d.jsx)(e.td,{children:"bool"}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"true"})," / ",(0,d.jsx)(e.code,{children:"false"})]}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"false"})}),(0,d.jsx)(e.td,{children:"\u662F\u5426\u542F\u7528 Python UDF \u529F\u80FD"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"python_env_mode"})}),(0,d.jsx)(e.td,{children:"string"}),(0,d.jsxs)(e.td,{children:[(0,d.jsx)(e.code,{children:"conda"})," / ",(0,d.jsx)(e.code,{children:"venv"})]}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:'""'})}),(0,d.jsx)(e.td,{children:"Python \u591A\u7248\u672C\u73AF\u5883\u7BA1\u7406\u65B9\u5F0F"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"python_conda_root_path"})}),(0,d.jsx)(e.td,{children:"string"}),(0,d.jsx)(e.td,{children:"\u76EE\u5F55\u8DEF\u5F84"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:'""'})}),(0,d.jsxs)(e.td,{children:["Miniconda \u7684\u6839\u76EE\u5F55",(0,d.jsx)(e.br,{}),"\u4EC5\u5728 ",(0,d.jsx)(e.code,{children:"python_env_mode = conda"})," \u65F6\u751F\u6548"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"python_venv_root_path"})}),(0,d.jsx)(e.td,{children:"string"}),(0,d.jsx)(e.td,{children:"\u76EE\u5F55\u8DEF\u5F84"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"${DORIS_HOME}/lib/udf/python"})}),(0,d.jsxs)(e.td,{children:["venv \u591A\u7248\u672C\u7BA1\u7406\u7684\u6839\u76EE\u5F55",(0,d.jsx)(e.br,{}),"\u4EC5\u5728 ",(0,d.jsx)(e.code,{children:"python_env_mode = venv"})," \u65F6\u751F\u6548"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"python_venv_interpreter_paths"})}),(0,d.jsx)(e.td,{children:"string"}),(0,d.jsxs)(e.td,{children:["\u8DEF\u5F84\u5217\u8868(\u7528 ",(0,d.jsx)(e.code,{children:":"})," \u5206\u9694)"]}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:'""'})}),(0,d.jsxs)(e.td,{children:["\u53EF\u7528 Python \u89E3\u91CA\u5668\u7684\u76EE\u5F55\u5217\u8868",(0,d.jsx)(e.br,{}),"\u4EC5\u5728 ",(0,d.jsx)(e.code,{children:"python_env_mode = venv"})," \u65F6\u751F\u6548"]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"max_python_process_num"})}),(0,d.jsx)(e.td,{children:"int32"}),(0,d.jsx)(e.td,{children:"\u6574\u6570"}),(0,d.jsx)(e.td,{children:(0,d.jsx)(e.code,{children:"0"})}),(0,d.jsxs)(e.td,{children:["Python Server \u8FDB\u7A0B\u6C60\u6700\u591A\u8FD0\u884C\u7684\u8FDB\u7A0B\u6570",(0,d.jsx)(e.br,{}),(0,d.jsx)(e.code,{children:"0"})," \u8868\u793A\u4F7F\u7528 CPU \u6838\u6570\u4F5C\u4E3A\u9ED8\u8BA4\u503C\uFF0C\u7528\u6237\u53EF\u4EE5\u8BBE\u7F6E\u5176\u4ED6\u6B63\u6574\u6570\u8986\u76D6\u9ED8\u8BA4\u503C"]})]})]})]}),"\n",(0,d.jsx)(e.h3,{id:"\u65B9\u5F0F\u4E00-\u4F7F\u7528-conda-\u7BA1\u7406-python-\u73AF\u5883",children:"\u65B9\u5F0F\u4E00: \u4F7F\u7528 Conda \u7BA1\u7406 Python \u73AF\u5883"}),"\n",(0,d.jsx)(e.h4,{id:"1-\u914D\u7F6E-be",children:"1. \u914D\u7F6E BE"}),"\n",(0,d.jsxs)(e.p,{children:["\u5728 ",(0,d.jsx)(e.code,{children:"be.conf"})," \u4E2D\u6DFB\u52A0\u4EE5\u4E0B\u914D\u7F6E:"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-properties",children:"## be.conf\nenable_python_udf_support = true\npython_env_mode = conda\npython_conda_root_path = /path/to/miniconda3\n"})}),"\n",(0,d.jsx)(e.h4,{id:"2-\u73AF\u5883\u67E5\u627E\u89C4\u5219",children:"2. \u73AF\u5883\u67E5\u627E\u89C4\u5219"}),"\n",(0,d.jsxs)(e.p,{children:["Doris \u4F1A\u5728 ",(0,d.jsx)(e.code,{children:"${python_conda_root_path}/envs/"})," \u76EE\u5F55\u4E0B\u67E5\u627E\u4E0E UDF \u4E2D ",(0,d.jsx)(e.code,{children:"runtime_version"})," \u5339\u914D\u7684 Conda \u73AF\u5883\u3002"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u5339\u914D\u89C4\u5219"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"runtime_version"})," ",(0,d.jsx)(e.strong,{children:"\u5FC5\u987B\u586B\u5199 Python \u7248\u672C\u7684\u5B8C\u6574\u7248\u672C\u53F7"}),"\uFF0C\u683C\u5F0F\u4E3A ",(0,d.jsx)(e.code,{children:"x.x.x"})," \u6216 ",(0,d.jsx)(e.code,{children:"x.x.xx"}),"\uFF0C\u4F8B\u5982 ",(0,d.jsx)(e.code,{children:'"3.9.18"'}),"\u3001",(0,d.jsx)(e.code,{children:'"3.12.11"'})]}),"\n",(0,d.jsxs)(e.li,{children:["Doris \u4F1A\u904D\u5386\u6240\u6709 Conda \u73AF\u5883\uFF0C\u68C0\u67E5\u6BCF\u4E2A\u73AF\u5883\u4E2D Python \u89E3\u91CA\u5668\u7684\u5B9E\u9645\u7248\u672C\u662F\u5426\u4E0E ",(0,d.jsx)(e.code,{children:"runtime_version"})," \u5B8C\u5168\u5339\u914D"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5982\u679C\u627E\u4E0D\u5230\u5339\u914D\u7684\u73AF\u5883\uFF0C\u5219\u4F1A\u62A5\u9519: ",(0,d.jsx)(e.code,{children:"Python environment with version x.x.x not found"})]}),"\n"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u793A\u4F8B"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["UDF \u4E2D\u6307\u5B9A ",(0,d.jsx)(e.code,{children:'runtime_version = "3.9.18"'}),"\uFF0CDoris \u4F1A\u5728\u6240\u6709\u73AF\u5883\u4E2D\u67E5\u627E Python \u7248\u672C\u4E3A 3.9.18 \u7684\u73AF\u5883"]}),"\n",(0,d.jsxs)(e.li,{children:["\u73AF\u5883\u540D\u79F0\u53EF\u4EE5\u662F\u4EFB\u610F\u7684 (\u5982 ",(0,d.jsx)(e.code,{children:"py39"}),"\u3001",(0,d.jsx)(e.code,{children:"my-env"}),"\u3001",(0,d.jsx)(e.code,{children:"data-science"})," \u7B49)\uFF0C\u53EA\u8981\u8BE5\u73AF\u5883\u4E2D\u7684 Python \u7248\u672C\u4E3A 3.9.18 \u5373\u53EF"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5FC5\u987B\u586B\u5199\u5B8C\u6574\u7248\u672C\u53F7\uFF0C\u4E0D\u80FD\u4F7F\u7528\u7248\u672C\u524D\u7F00\uFF0C\u5982 ",(0,d.jsx)(e.code,{children:'"3.9"'})," \u6216 ",(0,d.jsx)(e.code,{children:'"3.12"'})]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"3-\u76EE\u5F55\u7ED3\u6784\u793A\u610F\u56FE",children:"3. \u76EE\u5F55\u7ED3\u6784\u793A\u610F\u56FE"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{children:"## Doris BE \u8282\u70B9\u6587\u4EF6\u7CFB\u7EDF\u7ED3\u6784 (Conda \u6A21\u5F0F)\n\n/path/to/miniconda3                  \u2190 python_conda_root_path (\u7531 be.conf \u914D\u7F6E)\n\u2502\n\u251C\u2500\u2500 bin/\n\u2502   \u251C\u2500\u2500 conda                        \u2190 conda \u547D\u4EE4\u884C\u5DE5\u5177 (\u8FD0\u7EF4\u4F7F\u7528)\n\u2502   \u2514\u2500\u2500 ...                          \u2190 \u5176\u4ED6 conda \u5DE5\u5177\n\u2502\n\u251C\u2500\u2500 envs/                            \u2190 \u6240\u6709 Conda \u73AF\u5883\u5B58\u653E\u76EE\u5F55\n\u2502   \u2502\n\u2502   \u251C\u2500\u2500 py39/                        \u2190 Conda \u73AF\u5883 1 (\u7528\u6237\u521B\u5EFA)\n\u2502   \u2502   \u251C\u2500\u2500 bin/\n\u2502   \u2502   \u2502   \u251C\u2500\u2500 python               \u2190 Python 3.9 \u89E3\u91CA\u5668 (Doris \u76F4\u63A5\u8C03\u7528)\n\u2502   \u2502   \u2502   \u251C\u2500\u2500 pip\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502   \u251C\u2500\u2500 lib/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 python3.9/\n\u2502   \u2502   \u2502       \u2514\u2500\u2500 site-packages/   \u2190 \u8BE5\u73AF\u5883\u7684\u7B2C\u4E09\u65B9\u4F9D\u8D56 (\u5982 pandas\uFF0C pyarrow)\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502\n\u2502   \u251C\u2500\u2500 py312/                       \u2190 Conda \u73AF\u5883 2 (\u7528\u6237\u521B\u5EFA)\n\u2502   \u2502   \u251C\u2500\u2500 bin/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 python               \u2190 Python 3.12 \u89E3\u91CA\u5668\n\u2502   \u2502   \u2514\u2500\u2500 lib/\n\u2502   \u2502       \u2514\u2500\u2500 python3.12/\n\u2502   \u2502           \u2514\u2500\u2500 site-packages/   \u2190 \u9884\u88C5\u7684\u4F9D\u8D56 (\u5982 torch\uFF0C sklearn)\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 ml-env/                      \u2190 \u8BED\u4E49\u5316\u73AF\u5883\u540D (\u63A8\u8350)\n\u2502       \u251C\u2500\u2500 bin/\n\u2502       \u2502   \u2514\u2500\u2500 python               \u2190 \u53EF\u80FD\u662F Python 3.12 + GPU \u4F9D\u8D56\n\u2502       \u2514\u2500\u2500 lib/\n\u2502           \u2514\u2500\u2500 python3.12/\n\u2502               \u2514\u2500\u2500 site-packages/\n\u2502\n\u2514\u2500\u2500 ...\n"})}),"\n",(0,d.jsx)(e.h4,{id:"4-\u521B\u5EFA-conda-\u73AF\u5883",children:"4. \u521B\u5EFA Conda \u73AF\u5883"}),"\n",(0,d.jsx)(e.admonition,{title:"\u6CE8\u610F",type:"caution",children:(0,d.jsxs)(e.p,{children:["Doris Python UDF/UDAF/UDTF \u529F\u80FD",(0,d.jsx)(e.strong,{children:"\u5F3A\u5236\u4F9D\u8D56"})," ",(0,d.jsx)(e.code,{children:"pandas"})," \u548C ",(0,d.jsx)(e.code,{children:"pyarrow"})," \u4E24\u4E2A\u5E93,",(0,d.jsx)(e.strong,{children:"\u5FC5\u987B"}),"\u5728\u6240\u6709 Python \u73AF\u5883\u4E2D\u9884\u5148\u5B89\u88C5\u8FD9\u4E24\u4E2A\u4F9D\u8D56,\u5426\u5219 UDF \u5C06\u65E0\u6CD5\u6B63\u5E38\u8FD0\u884C\u3002"]})}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u5728\u6240\u6709 BE \u8282\u70B9\u4E0A"}),"\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\u521B\u5EFA Python \u73AF\u5883:"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"# \u5B89\u88C5 Miniconda (\u5982\u679C\u5C1A\u672A\u5B89\u88C5)\nwget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh\nbash Miniconda3-latest-Linux-x86_64.sh -b -p /opt/miniconda3\n\n# \u521B\u5EFA Python 3.9.18 \u73AF\u5883\u5E76\u5B89\u88C5\u5FC5\u9700\u7684\u4F9D\u8D56 (\u73AF\u5883\u540D\u53EF\u81EA\u5B9A\u4E49)\n/opt/miniconda3/bin/conda create -n py39 python=3.9.18 pandas pyarrow -y\n\n# \u521B\u5EFA Python 3.12.11 \u73AF\u5883\u5E76\u9884\u88C5\u4F9D\u8D56 (\u91CD\u8981: Python \u7248\u672C\u5FC5\u987B\u7CBE\u786E\u6307\u5B9A,\u4E14\u5FC5\u987B\u5B89\u88C5 pandas \u548C pyarrow)\n/opt/miniconda3/bin/conda create -n py312 python=3.12.11 pandas pyarrow numpy -y\n\n# \u6FC0\u6D3B\u73AF\u5883\u5E76\u5B89\u88C5\u989D\u5916\u4F9D\u8D56\nsource /opt/miniconda3/bin/activate py39\nconda install requests beautifulsoup4 -y\nconda deactivate\n\n# \u9A8C\u8BC1\u73AF\u5883\u4E2D\u7684 Python \u7248\u672C\n/opt/miniconda3/envs/py39/bin/python --version     # \u5E94\u8F93\u51FA: Python 3.9.18\n/opt/miniconda3/envs/py312/bin/python --version    # \u5E94\u8F93\u51FA: Python 3.12.11\n"})}),"\n",(0,d.jsx)(e.h4,{id:"5-\u5728-udf-\u4E2D\u4F7F\u7528",children:"5. \u5728 UDF \u4E2D\u4F7F\u7528"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'-- \u4F7F\u7528 Python 3.12.11 \u73AF\u5883\nCREATE FUNCTION py_ml_predict(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.12.11",  -- \u5FC5\u987B\u6307\u5B9A\u5B8C\u6574\u7248\u672C\u53F7\uFF0C\u5339\u914D Python 3.12.11\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(x):\n    # \u53EF\u4EE5\u4F7F\u7528 Python 3.12.11 \u73AF\u5883\u4E2D\u5B89\u88C5\u7684\u5E93\n    return x * 2\n$$;\n\n-- \u6CE8\u610F: \u65E0\u8BBA\u73AF\u5883\u540D\u662F py312 \u8FD8\u662F ml-env\uFF0C\u53EA\u8981 Python \u7248\u672C\u662F 3.12.11\uFF0C\u90FD\u53EF\u4EE5\u4F7F\u7528\n-- runtime_version \u53EA\u5173\u6CE8 Python \u7248\u672C\uFF0C\u4E0D\u5173\u6CE8\u73AF\u5883\u540D\u79F0\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u65B9\u5F0F\u4E8C-\u4F7F\u7528-venv-\u7BA1\u7406-python-\u73AF\u5883",children:"\u65B9\u5F0F\u4E8C: \u4F7F\u7528 Venv \u7BA1\u7406 Python \u73AF\u5883"}),"\n",(0,d.jsx)(e.h4,{id:"1-\u914D\u7F6E-be-1",children:"1. \u914D\u7F6E BE"}),"\n",(0,d.jsxs)(e.p,{children:["\u5728 ",(0,d.jsx)(e.code,{children:"be.conf"})," \u4E2D\u6DFB\u52A0\u4EE5\u4E0B\u914D\u7F6E:"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-properties",children:"## be.conf\nenable_python_udf_support = true\npython_env_mode = venv\npython_venv_root_path = /doris/python_envs\npython_venv_interpreter_paths = /opt/python3.9/bin/python3.9:/opt/python3.12/bin/python3.12\n"})}),"\n",(0,d.jsx)(e.h4,{id:"2-\u914D\u7F6E\u53C2\u6570\u8BF4\u660E",children:"2. \u914D\u7F6E\u53C2\u6570\u8BF4\u660E"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:(0,d.jsx)(e.code,{children:"python_venv_root_path"})}),": \u865A\u62DF\u73AF\u5883\u7684\u6839\u76EE\u5F55\uFF0C\u6240\u6709 venv \u73AF\u5883\u90FD\u5C06\u521B\u5EFA\u5728\u6B64\u76EE\u5F55\u4E0B"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:(0,d.jsx)(e.code,{children:"python_venv_interpreter_paths"})}),": \u4EE5\u82F1\u6587\u5192\u53F7 ",(0,d.jsx)(e.code,{children:":"})," \u5206\u9694\u7684 Python \u89E3\u91CA\u5668\u7EDD\u5BF9\u8DEF\u5F84\u5217\u8868\u3002Doris \u4F1A\u68C0\u67E5\u6BCF\u4E2A\u89E3\u91CA\u5668\u7684\u7248\u672C\uFF0C\u5E76\u6839\u636E UDF \u4E2D\u6307\u5B9A\u7684 ",(0,d.jsx)(e.code,{children:"runtime_version"})," (\u5B8C\u6574\u7248\u672C\u53F7\uFF0C\u5982 ",(0,d.jsx)(e.code,{children:'"3.9.18"'}),") \u5339\u914D\u5BF9\u5E94\u7684\u89E3\u91CA\u5668"]}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"3-\u76EE\u5F55\u7ED3\u6784\u793A\u610F\u56FE-1",children:"3. \u76EE\u5F55\u7ED3\u6784\u793A\u610F\u56FE"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{children:'## Doris BE \u914D\u7F6E (be.conf)\npython_venv_interpreter_paths = "/opt/python3.9/bin/python3.9:/opt/python3.12/bin/python3.12"\npython_venv_root_path = /doris/python_envs\n\n/opt/python3.9/bin/python3.9                \u2190 \u7CFB\u7EDF\u9884\u88C5 Python 3.9\n/opt/python3.12/bin/python3.12              \u2190 \u7CFB\u7EDF\u9884\u88C5 Python 3.12\n\n/doris/python_envs/                         \u2190 \u6240\u6709\u865A\u62DF\u73AF\u5883\u7684\u6839\u76EE\u5F55 (python_venv_root_path)\n\u2502\n\u251C\u2500\u2500 python3.9.18/                           \u2190 \u73AF\u5883 ID = Python \u5B8C\u6574\u7248\u672C\n\u2502   \u251C\u2500\u2500 bin/\n\u2502   \u2502   \u251C\u2500\u2500 python\n\u2502   \u2502   \u2514\u2500\u2500 pip\n\u2502   \u2514\u2500\u2500 lib/python3.9/site-packages/\n\u2502       \u251C\u2500\u2500 pandas==2.1.0\n\u2502       \u2514\u2500\u2500 pyarrow==15.0.0\n\u2502\n\u251C\u2500\u2500 python3.12.11/                          \u2190 Python 3.12.11 \u73AF\u5883\n\u2502   \u251C\u2500\u2500 bin/\n\u2502   \u2502   \u251C\u2500\u2500 python\n\u2502   \u2502   \u2514\u2500\u2500 pip\n\u2502   \u2514\u2500\u2500 lib/python3.12/site-packages/\n\u2502       \u251C\u2500\u2500 pandas==2.1.0\n\u2502       \u2514\u2500\u2500 pyarrow==15.0.0\n\u2502\n\u2514\u2500\u2500 python3.12.10/                          \u2190 Python 3.12.10 \u73AF\u5883\n    \u2514\u2500\u2500 ...\n'})}),"\n",(0,d.jsx)(e.h4,{id:"4-\u521B\u5EFA-venv-\u73AF\u5883",children:"4. \u521B\u5EFA Venv \u73AF\u5883"}),"\n",(0,d.jsx)(e.admonition,{title:"\u6CE8\u610F",type:"caution",children:(0,d.jsxs)(e.p,{children:["Doris Python UDF/UDAF/UDTF \u529F\u80FD",(0,d.jsx)(e.strong,{children:"\u5F3A\u5236\u4F9D\u8D56"})," ",(0,d.jsx)(e.code,{children:"pandas"})," \u548C ",(0,d.jsx)(e.code,{children:"pyarrow"})," \u4E24\u4E2A\u5E93,",(0,d.jsx)(e.strong,{children:"\u5FC5\u987B"}),"\u5728\u6240\u6709 Python \u73AF\u5883\u4E2D\u9884\u5148\u5B89\u88C5\u8FD9\u4E24\u4E2A\u4F9D\u8D56,\u5426\u5219 UDF \u5C06\u65E0\u6CD5\u6B63\u5E38\u8FD0\u884C\u3002"]})}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u5728\u6240\u6709 BE \u8282\u70B9\u4E0A"}),"\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4:"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"# \u521B\u5EFA\u865A\u62DF\u73AF\u5883\u6839\u76EE\u5F55\nmkdir -p /doris/python_envs\n\n# \u4F7F\u7528 Python 3.9 \u521B\u5EFA\u865A\u62DF\u73AF\u5883\n/opt/python3.9/bin/python3.9 -m venv /doris/python_envs/python3.9.18\n\n# \u6FC0\u6D3B\u73AF\u5883\u5E76\u5B89\u88C5\u5FC5\u9700\u7684\u4F9D\u8D56 (pandas \u548C pyarrow \u5FC5\u987B\u5B89\u88C5)\nsource /doris/python_envs/python3.9.18/bin/activate\npip install pandas pyarrow numpy\ndeactivate\n\n# \u4F7F\u7528 Python 3.12 \u521B\u5EFA\u865A\u62DF\u73AF\u5883\n/opt/python3.12/bin/python3.12 -m venv /doris/python_envs/python3.12.11\n\n# \u6FC0\u6D3B\u73AF\u5883\u5E76\u5B89\u88C5\u5FC5\u9700\u7684\u4F9D\u8D56 (pandas \u548C pyarrow \u5FC5\u987B\u5B89\u88C5)\nsource /doris/python_envs/python3.12.11/bin/activate\npip install pandas pyarrow numpy scikit-learn\ndeactivate\n"})}),"\n",(0,d.jsx)(e.h4,{id:"5-\u5728-udf-\u4E2D\u4F7F\u7528-1",children:"5. \u5728 UDF \u4E2D\u4F7F\u7528"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'-- \u4F7F\u7528 Python 3.9.18 \u73AF\u5883\nCREATE FUNCTION py_clean_text(STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.9.18",  -- \u5FC5\u987B\u6307\u5B9A\u5B8C\u6574\u7248\u672C\u53F7\uFF0C\u5339\u914D Python 3.9.18\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(text):\n    return text.strip().upper()\n$$;\n\n-- \u4F7F\u7528 Python 3.12.11 \u73AF\u5883\nCREATE FUNCTION py_calculate(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.12.11",  -- \u5FC5\u987B\u6307\u5B9A\u5B8C\u6574\u7248\u672C\u53F7\uFF0C\u5339\u914D Python 3.12.11\n    "always_nullable" = "true"\n)\nAS $$\nimport numpy as np\n\ndef evaluate(x):\n    return np.sqrt(x)\n$$;\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u73AF\u5883\u7BA1\u7406\u6700\u4F73\u5B9E\u8DF5",children:"\u73AF\u5883\u7BA1\u7406\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,d.jsx)(e.h4,{id:"1-\u9009\u62E9\u5408\u9002\u7684\u7BA1\u7406\u65B9\u5F0F",children:"1. \u9009\u62E9\u5408\u9002\u7684\u7BA1\u7406\u65B9\u5F0F"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u573A\u666F"}),(0,d.jsx)(e.th,{children:"\u63A8\u8350\u65B9\u5F0F"}),(0,d.jsx)(e.th,{children:"\u539F\u56E0"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u9700\u8981\u9891\u7E41\u5207\u6362 Python \u7248\u672C"}),(0,d.jsx)(e.td,{children:"Conda"}),(0,d.jsx)(e.td,{children:"\u73AF\u5883\u9694\u79BB\u6027\u597D\uFF0C\u4F9D\u8D56\u7BA1\u7406\u7B80\u5355"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u5DF2\u6709 Conda \u73AF\u5883"}),(0,d.jsx)(e.td,{children:"Conda"}),(0,d.jsx)(e.td,{children:"\u53EF\u76F4\u63A5\u590D\u7528\u73B0\u6709\u73AF\u5883"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u7CFB\u7EDF\u8D44\u6E90\u6709\u9650"}),(0,d.jsx)(e.td,{children:"Venv"}),(0,d.jsx)(e.td,{children:"\u5360\u7528\u7A7A\u95F4\u5C0F\uFF0C\u542F\u52A8\u5FEB"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"\u5DF2\u6709 Python \u7CFB\u7EDF\u73AF\u5883"}),(0,d.jsx)(e.td,{children:"Venv"}),(0,d.jsx)(e.td,{children:"\u65E0\u9700\u989D\u5916\u5B89\u88C5 Conda"})]})]})]}),"\n",(0,d.jsx)(e.h4,{id:"2-\u73AF\u5883\u4E00\u81F4\u6027\u8981\u6C42",children:"2. \u73AF\u5883\u4E00\u81F4\u6027\u8981\u6C42"}),"\n",(0,d.jsxs)(e.admonition,{title:"\u6CE8\u610F",type:"caution",children:[(0,d.jsxs)(e.p,{children:["\u6240\u6709 BE \u8282\u70B9\u5FC5\u987B\u914D\u7F6E",(0,d.jsx)(e.strong,{children:"\u5B8C\u5168\u76F8\u540C"}),"\u7684 Python \u73AF\u5883\uFF0C\u5305\u62EC:"]}),(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"Python \u7248\u672C\u5FC5\u987B\u4E00\u81F4"}),"\n",(0,d.jsx)(e.li,{children:"\u5DF2\u5B89\u88C5\u7684\u4F9D\u8D56\u5305\u53CA\u5176\u7248\u672C\u5FC5\u987B\u4E00\u81F4"}),"\n",(0,d.jsx)(e.li,{children:"\u73AF\u5883\u76EE\u5F55\u8DEF\u5F84\u5FC5\u987B\u4E00\u81F4"}),"\n"]})]}),"\n",(0,d.jsx)(e.h3,{id:"\u6CE8\u610F\u4E8B\u9879-1",children:"\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,d.jsx)(e.h4,{id:"1-\u914D\u7F6E\u4FEE\u6539\u751F\u6548",children:"1. \u914D\u7F6E\u4FEE\u6539\u751F\u6548"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4FEE\u6539 ",(0,d.jsx)(e.code,{children:"be.conf"})," \u540E\uFF0C",(0,d.jsx)(e.strong,{children:"\u5FC5\u987B\u91CD\u542F BE \u8FDB\u7A0B"}),"\u624D\u80FD\u751F\u6548"]}),"\n",(0,d.jsx)(e.li,{children:"\u91CD\u542F\u524D\u8BF7\u786E\u4FDD\u914D\u7F6E\u6B63\u786E\uFF0C\u907F\u514D\u670D\u52A1\u4E2D\u65AD"}),"\n"]}),"\n",(0,d.jsx)(e.h4,{id:"2-\u8DEF\u5F84\u9A8C\u8BC1",children:"2. \u8DEF\u5F84\u9A8C\u8BC1"}),"\n",(0,d.jsx)(e.p,{children:"\u914D\u7F6E\u524D\u8BF7\u786E\u4FDD\u8DEF\u5F84\u6B63\u786E:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"# Conda \u6A21\u5F0F: \u9A8C\u8BC1 conda \u8DEF\u5F84\nls -la /opt/miniconda3/bin/conda\n/opt/miniconda3/bin/conda env list\n\n# Venv \u6A21\u5F0F: \u9A8C\u8BC1\u89E3\u91CA\u5668\u8DEF\u5F84\n/opt/python3.9/bin/python3.9 --version\n/opt/python3.12/bin/python3.12 --version\n"})}),"\n",(0,d.jsx)(e.h4,{id:"3-\u6743\u9650\u8BBE\u7F6E",children:"3. \u6743\u9650\u8BBE\u7F6E"}),"\n",(0,d.jsx)(e.p,{children:"\u786E\u4FDD Doris BE \u8FDB\u7A0B\u6709\u6743\u9650\u8BBF\u95EE Python \u73AF\u5883\u76EE\u5F55:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"# Conda \u6A21\u5F0F\nchmod -R 755 /opt/miniconda3\n\n# Venv \u6A21\u5F0F\nchmod -R 755 /doris/python_envs\nchown -R doris:doris /doris/python_envs  # \u5047\u8BBE BE \u8FDB\u7A0B\u7528\u6237\u4E3A doris\n"})}),"\n",(0,d.jsx)(e.h4,{id:"4-\u8D44\u6E90\u9650\u5236",children:"4. \u8D44\u6E90\u9650\u5236"}),"\n",(0,d.jsx)(e.p,{children:"\u6839\u636E\u5B9E\u9645\u9700\u6C42\u8C03\u6574 Python \u8FDB\u7A0B\u6C60\u53C2\u6570:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-properties",children:"## \u786E\u8BA4\u4F7F\u7528 CPU \u6838\u6570\uFF08\u63A8\u8350\uFF0Cmax_python_process_num = 0\uFF09\nmax_python_process_num = 0\n\n## \u9AD8\u5E76\u53D1\u573A\u666F\uFF0C\u624B\u52A8\u6307\u5B9A\u8FDB\u7A0B\u6570\nmax_python_process_num = 128\n\n## \u8D44\u6E90\u53D7\u9650\u573A\u666F\uFF0C\u9650\u5236\u8FDB\u7A0B\u6570\nmax_python_process_num = 32\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u73AF\u5883\u9A8C\u8BC1",children:"\u73AF\u5883\u9A8C\u8BC1"}),"\n",(0,d.jsx)(e.p,{children:"\u5728\u6BCF\u4E2A BE \u8282\u70B9\u4E0A\u9A8C\u8BC1\u73AF\u5883\u662F\u5426\u6B63\u786E:"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:'# Conda \u6A21\u5F0F\n/opt/miniconda3/envs/py39/bin/python --version\n/opt/miniconda3/envs/py39/bin/python -c "import pandas; print(pandas.__version__)"\n\n# Venv \u6A21\u5F0F\n/doris/python_envs/python3.9.18/bin/python --version\n/doris/python_envs/python3.9.18/bin/python -c "import pandas; print(pandas.__version__)"\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5",children:"\u5E38\u89C1\u95EE\u9898\u6392\u67E5"}),"\n",(0,d.jsx)(e.h4,{id:"q1-udf-\u8C03\u7528\u65F6\u63D0\u793A-python-environment-not-found",children:'Q1: UDF \u8C03\u7528\u65F6\u63D0\u793A "Python environment not found"'}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u539F\u56E0"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"runtime_version"})," \u6307\u5B9A\u7684\u7248\u672C\u5728\u7CFB\u7EDF\u4E2D\u4E0D\u5B58\u5728"]}),"\n",(0,d.jsx)(e.li,{children:"\u73AF\u5883\u8DEF\u5F84\u914D\u7F6E\u4E0D\u6B63\u786E"}),"\n"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),":"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"# \u68C0\u67E5 Conda \u73AF\u5883\u5217\u8868\nconda env list\n\n# \u68C0\u67E5 Venv \u89E3\u91CA\u5668\u662F\u5426\u5B58\u5728\nls -la /opt/python3.9/bin/python3.9\n\n# \u68C0\u67E5 BE \u914D\u7F6E\ngrep python /path/to/be.conf\n"})}),"\n",(0,d.jsx)(e.h4,{id:"q2-udf-\u8C03\u7528\u65F6\u63D0\u793A-modulenotfounderror-no-module-named-xxx",children:"Q2: UDF \u8C03\u7528\u65F6\u63D0\u793A \"ModuleNotFoundError: No module named 'xxx'\""}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u539F\u56E0"}),": Python \u73AF\u5883\u4E2D\u672A\u5B89\u88C5\u6240\u9700\u4F9D\u8D56\u5305"]}),"\n",(0,d.jsx)(e.h4,{id:"q3-\u4E0D\u540C-be-\u8282\u70B9\u6267\u884C\u7ED3\u679C\u4E0D\u4E00\u81F4",children:"Q3: \u4E0D\u540C BE \u8282\u70B9\u6267\u884C\u7ED3\u679C\u4E0D\u4E00\u81F4"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u539F\u56E0"}),": \u5404 BE \u8282\u70B9\u7684 Python \u73AF\u5883\u6216\u4F9D\u8D56\u7248\u672C\u4E0D\u4E00\u81F4"]}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),":"]}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsx)(e.li,{children:"\u68C0\u67E5\u6240\u6709\u8282\u70B9\u7684 Python \u7248\u672C\u548C\u4F9D\u8D56\u7248\u672C"}),"\n",(0,d.jsx)(e.li,{children:"\u9A8C\u8BC1\u6240\u6709\u8282\u70B9\u73AF\u5883\u4E00\u81F4\u6027"}),"\n",(0,d.jsxs)(e.li,{children:["\u7EDF\u4E00\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"requirements.txt"}),"\uFF08pip\uFF09\u6216 ",(0,d.jsx)(e.code,{children:"environment.yml"}),"\uFF08Conda\uFF09\u90E8\u7F72\u73AF\u5883\uFF0C\u5E38\u89C1\u7528\u6CD5\u793A\u4F8B\uFF1A"]}),"\n"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"requirements.txt"}),"\uFF08pip\uFF09:"]}),"\n"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"# \u5728\u5F00\u53D1\u73AF\u5883\u4E2D\u5BFC\u51FA\u4F9D\u8D56\npip freeze > requirements.txt\n# \u5728 BE \u8282\u70B9\u4E0A\u4F7F\u7528\u76EE\u6807 Python \u5B89\u88C5\u4F9D\u8D56\n/path/to/python -m pip install -r requirements.txt\n"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"environment.yml"}),"\uFF08Conda\uFF09:"]}),"\n"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"# \u5BFC\u51FA\u4F9D\u8D56\nconda env export --from-history -n py312 -f environment.yml\n# \u5728 BE \u8282\u70B9\u4E0A\u521B\u5EFA\u73AF\u5883\nconda env create -f environment.yml -n py312\n# \u6216\u66F4\u65B0\u5DF2\u6709\u73AF\u5883\nconda env update -f environment.yml -n py312\n"})}),"\n",(0,d.jsx)(e.admonition,{title:"\u6CE8\u610F",type:"caution",children:(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u5FC5\u987B\u786E\u4FDD ",(0,d.jsx)(e.code,{children:"pandas"})," \u548C ",(0,d.jsx)(e.code,{children:"pyarrow"})," \u51FA\u73B0\u5728\u4F9D\u8D56\u6587\u4EF6\u4E2D\uFF0C\u5E76\u5728\u6240\u6709 BE \u8282\u70B9\u4E2D\u5B89\u88C5\u76F8\u540C\u7248\u672C"]}),"\n",(0,d.jsxs)(e.li,{children:["\u5B89\u88C5\u65F6\u52A1\u5FC5\u4F7F\u7528\u4E0E Doris \u914D\u7F6E\u4E00\u81F4\u7684 Python \u89E3\u91CA\u5668\u6216 Conda \u8DEF\u5F84\uFF08\u4F8B\u5982 ",(0,d.jsx)(e.code,{children:"/opt/miniconda3/bin/conda"})," \u6216\u6307\u5B9A\u7684 venv \u89E3\u91CA\u5668\uFF09"]}),"\n",(0,d.jsx)(e.li,{children:"\u5EFA\u8BAE\u5C06\u4F9D\u8D56\u6587\u4EF6\u7EB3\u5165\u7248\u672C\u63A7\u5236\u6216\u653E\u5165\u5171\u4EAB\u5B58\u50A8\uFF0C\u7531\u8FD0\u7EF4\u7EDF\u4E00\u5206\u53D1\u5230\u6240\u6709 BE \u8282\u70B9"}),"\n",(0,d.jsxs)(e.li,{children:["\u66F4\u591A\u53C2\u8003\uFF1A",(0,d.jsx)(e.a,{href:"https://pip.pypa.io/en/stable/cli/pip/",children:"pip \u5B98\u65B9\u6587\u6863"}),"\uFF0C",(0,d.jsx)(e.a,{href:"https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#exporting-the-environment",children:"Conda \u73AF\u5883\u5BFC\u51FA/\u5BFC\u5165\u8BF4\u660E"})]}),"\n"]})}),"\n",(0,d.jsx)(e.h4,{id:"q4-\u4FEE\u6539-beconf-\u540E\u672A\u751F\u6548",children:"Q4: \u4FEE\u6539 be.conf \u540E\u672A\u751F\u6548"}),"\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u53EF\u80FD\u7684\u539F\u56E0"}),": \u672A\u91CD\u542F BE \u8FDB\u7A0B"]}),"\n",(0,d.jsx)(e.h3,{id:"\u4F7F\u7528\u9650\u5236",children:"\u4F7F\u7528\u9650\u5236"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u6027\u80FD\u8003\u8651"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"Python UDF \u6027\u80FD\u4F4E\u4E8E\u5185\u7F6E\u51FD\u6570\uFF0C\u5EFA\u8BAE\u7528\u4E8E\u903B\u8F91\u590D\u6742\u4F46\u6570\u636E\u91CF\u4E0D\u5927\u7684\u573A\u666F"}),"\n",(0,d.jsx)(e.li,{children:"\u5BF9\u4E8E\u5927\u6570\u636E\u91CF\u5904\u7406\uFF0C\u4F18\u5148\u8003\u8651\u5411\u91CF\u5316\u6A21\u5F0F"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u7C7B\u578B\u9650\u5236"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u4E0D\u652F\u6301 HLL\u3001Bitmap \u7B49\u7279\u6B8A\u7C7B\u578B"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u73AF\u5883\u9694\u79BB"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u540C\u4E00\u51FD\u6570\u540D\u5728\u4E0D\u540C\u6570\u636E\u5E93\u4E2D\u53EF\u91CD\u590D\u5B9A\u4E49"}),"\n",(0,d.jsxs)(e.li,{children:["\u8C03\u7528\u65F6\u9700\u6307\u5B9A\u6570\u636E\u5E93\u540D (\u5982 ",(0,d.jsx)(e.code,{children:"db.func()"}),") \u4EE5\u907F\u514D\u6B67\u4E49"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsxs)(e.p,{children:[(0,d.jsx)(e.strong,{children:"\u5E76\u53D1\u9650\u5236"}),":"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["Python UDF \u901A\u8FC7\u8FDB\u7A0B\u6C60\u6267\u884C\uFF0C\u5E76\u53D1\u6570\u53D7 ",(0,d.jsx)(e.code,{children:"max_python_process_num"})," \u9650\u5236"]}),"\n",(0,d.jsx)(e.li,{children:"\u9AD8\u5E76\u53D1\u573A\u666F\u9700\u9002\u5F53\u8C03\u5927\u8BE5\u53C2\u6570"}),"\n"]}),"\n"]}),"\n"]})]})}function o(n={}){let{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(a,{...n})}):a(n)}},250065:function(n,e,s){s.d(e,{Z:function(){return t},a:function(){return r}});var l=s(667294);let d={},i=l.createContext(d);function r(n){let e=l.useContext(i);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:r(n.components),l.createElement(i.Provider,{value:e},n.children)}}}]);