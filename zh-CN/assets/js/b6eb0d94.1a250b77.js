"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["405527"],{964743:function(e,s,n){n.r(s),n.d(s,{default:()=>p,frontMatter:()=>l,metadata:()=>r,assets:()=>o,toc:()=>d,contentTitle:()=>t});var r=JSON.parse('{"id":"admin-manual/privilege-ldap/certificate","title":"MySQL \u5B89\u5168\u4F20\u8F93","description":"\u52A0\u5BC6\u8FDE\u63A5 FE","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-2.0/admin-manual/privilege-ldap/certificate.md","sourceDirName":"admin-manual/privilege-ldap","slug":"/admin-manual/privilege-ldap/certificate","permalink":"/zh-CN/docs/2.0/admin-manual/privilege-ldap/certificate","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"MySQL \u5B89\u5168\u4F20\u8F93","language":"zh-CN"},"sidebar":"docs","previous":{"title":"\u8BA4\u8BC1\u548C\u9274\u6743","permalink":"/zh-CN/docs/2.0/admin-manual/privilege-ldap/user-privilege"},"next":{"title":"HTTP \u5B89\u5168\u4F20\u8F93","permalink":"/zh-CN/docs/2.0/admin-manual/privilege-ldap/fe-certificate"}}'),c=n("785893"),i=n("250065");let l={title:"MySQL \u5B89\u5168\u4F20\u8F93",language:"zh-CN"},t=void 0,o={},d=[{value:"\u52A0\u5BC6\u8FDE\u63A5 FE",id:"\u52A0\u5BC6\u8FDE\u63A5-fe",level:2},{value:"SSL\u5BC6\u94A5\u8BC1\u4E66\u914D\u7F6E",id:"ssl\u5BC6\u94A5\u8BC1\u4E66\u914D\u7F6E",level:2},{value:"\u81EA\u5B9A\u4E49\u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6",id:"\u81EA\u5B9A\u4E49\u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6",level:2}];function a(e){let s={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.h2,{id:"\u52A0\u5BC6\u8FDE\u63A5-fe",children:"\u52A0\u5BC6\u8FDE\u63A5 FE"}),"\n",(0,c.jsxs)(s.p,{children:["Doris\u652F\u6301\u57FA\u4E8ESSL\u7684\u52A0\u5BC6\u8FDE\u63A5\uFF0C\u5F53\u524D\u652F\u6301TLS1.2\uFF0CTLS1.3\u534F\u8BAE\uFF0C\u53EF\u4EE5\u901A\u8FC7\u4EE5\u4E0B\u914D\u7F6E\u5F00\u542FDoris\u7684SSL\u6A21\u5F0F\uFF1A\n\u4FEE\u6539FE\u914D\u7F6E\u6587\u4EF6",(0,c.jsx)(s.code,{children:"conf/fe.conf"}),"\uFF0C\u6DFB\u52A0",(0,c.jsx)(s.code,{children:"enable_ssl = true"}),"\u5373\u53EF\u3002"]}),"\n",(0,c.jsxs)(s.p,{children:["\u63A5\u4E0B\u6765\u901A\u8FC7",(0,c.jsx)(s.code,{children:"mysql"}),"\u5BA2\u6237\u7AEF\u8FDE\u63A5Doris\uFF0Cmysql\u652F\u6301\u4E09\u79CDSSL\u6A21\u5F0F\uFF1A"]}),"\n",(0,c.jsxs)(s.p,{children:["1.",(0,c.jsx)(s.code,{children:"mysql -uroot -P9030 -h127.0.0.1"}),"\u4E0E",(0,c.jsx)(s.code,{children:"mysql --ssl-mode=PREFERRED -uroot -P9030 -h127.0.0.1"}),"\u4E00\u6837\uFF0C\u90FD\u662F\u4E00\u5F00\u59CB\u8BD5\u56FE\u5EFA\u7ACBSSL\u52A0\u5BC6\u8FDE\u63A5\uFF0C\u5982\u679C\u5931\u8D25\uFF0C\u5219\u5C1D\u8BD5\u4F7F\u7528\u666E\u901A\u8FDE\u63A5\u3002"]}),"\n",(0,c.jsxs)(s.p,{children:["2.",(0,c.jsx)(s.code,{children:"mysql --ssl-mode=DISABLE -uroot -P9030 -h127.0.0.1"}),"\uFF0C\u4E0D\u4F7F\u7528SSL\u52A0\u5BC6\u8FDE\u63A5\uFF0C\u76F4\u63A5\u4F7F\u7528\u666E\u901A\u8FDE\u63A5\u3002"]}),"\n",(0,c.jsxs)(s.p,{children:["3.",(0,c.jsx)(s.code,{children:"mysql --ssl-mode=REQUIRED -uroot -P9030 -h127.0.0.1"}),"\uFF0C\u5F3A\u5236\u4F7F\u7528SSL\u52A0\u5BC6\u8FDE\u63A5\u3002"]}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsxs)(s.p,{children:["\u6CE8\u610F\uFF1A\n",(0,c.jsx)(s.code,{children:"--ssl-mode"}),"\u53C2\u6570\u662Fmysql5.7.11\u7248\u672C\u5F15\u5165\u7684\uFF0C\u4F4E\u4E8E\u6B64\u7248\u672C\u7684mysql\u5BA2\u6237\u7AEF\u8BF7\u53C2\u8003",(0,c.jsx)(s.a,{href:"https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-connp-props-security.html",children:"\u8FD9\u91CC"}),"\u3002\nDoris\u5F00\u542FSSL\u52A0\u5BC6\u8FDE\u63A5\u9700\u8981\u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6\u9A8C\u8BC1\uFF0C\u9ED8\u8BA4\u7684\u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6\u4F4D\u4E8E",(0,c.jsx)(s.code,{children:"Doris/fe/mysql_ssl_default_certificate/certificate.p12"}),"\uFF0C\u9ED8\u8BA4\u5BC6\u7801\u4E3A",(0,c.jsx)(s.code,{children:"doris"}),"\uFF0C\u60A8\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539FE\u914D\u7F6E\u6587\u4EF6",(0,c.jsx)(s.code,{children:"conf/fe.conf"}),"\uFF0C\u6DFB\u52A0",(0,c.jsx)(s.code,{children:"mysql_ssl_default_certificate = /path/to/your/certificate"}),"\u4FEE\u6539\u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6\uFF0C\u540C\u65F6\u4E5F\u53EF\u4EE5\u901A\u8FC7",(0,c.jsx)(s.code,{children:"mysql_ssl_default_certificate_password = your_password"}),"\u6DFB\u52A0\u5BF9\u5E94\u60A8\u81EA\u5B9A\u4E49\u5BC6\u94A5\u4E66\u6587\u4EF6\u7684\u5BC6\u7801\u3002"]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["Doris\u8FD8\u652F\u6301mTLS\uFF1A\n\u4FEE\u6539FE\u914D\u7F6E\u6587\u4EF6",(0,c.jsx)(s.code,{children:"conf/fe.conf"}),"\uFF0C\u6DFB\u52A0",(0,c.jsx)(s.code,{children:"ssl_force_client_auth=true"}),"\u5373\u53EF\u3002"]}),"\n",(0,c.jsxs)(s.p,{children:["\u63A5\u4E0B\u6765\u53EF\u4EE5\u901A\u8FC7",(0,c.jsx)(s.code,{children:"mysql"}),"\u5BA2\u6237\u7AEF\u8FDE\u63A5Doris\uFF1A"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.code,{children:"mysql -ssl-mode=VERIFY_CA -uroot -P9030 -h127.0.0.1 --tls-version=TLSv1.2 --ssl-ca=/path/to/your/ca --ssl-cert=/path/to/your/cert --ssl-key=/path/to/your/key"})}),"\n",(0,c.jsxs)(s.p,{children:["\u9ED8\u8BA4\u7684ca\uFF0Ccert\uFF0Ckey\u6587\u4EF6\u4F4D\u4E8E",(0,c.jsx)(s.code,{children:"Doris/conf/mysql_ssl_default_certificate/client_certificate/"}),"\uFF0C\u5206\u522B\u53EB\u505A",(0,c.jsx)(s.code,{children:"ca.pem"}),"\uFF0C",(0,c.jsx)(s.code,{children:"client-cert.pem"}),"\uFF0C",(0,c.jsx)(s.code,{children:"client-key.pem"}),"\u3002"]}),"\n",(0,c.jsx)(s.p,{children:"\u4F60\u4E5F\u53EF\u4EE5\u901A\u8FC7openssl\u6216\u8005keytool\u751F\u6210\u81EA\u5DF1\u7684\u8BC1\u4E66\u6587\u4EF6\u3002"}),"\n",(0,c.jsx)(s.h2,{id:"ssl\u5BC6\u94A5\u8BC1\u4E66\u914D\u7F6E",children:"SSL\u5BC6\u94A5\u8BC1\u4E66\u914D\u7F6E"}),"\n",(0,c.jsx)(s.p,{children:"Doris \u5F00\u542F SSL \u529F\u80FD\u9700\u8981\u914D\u7F6E CA \u5BC6\u94A5\u8BC1\u4E66\u548C Server \u7AEF\u5BC6\u94A5\u8BC1\u4E66\uFF0C\u5982\u9700\u5F00\u542F\u53CC\u5411\u8BA4\u8BC1\uFF0C\u8FD8\u9700\u751F\u6210 Client \u7AEF\u5BC6\u94A5\u8BC1\u4E66\uFF1A"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["\u9ED8\u8BA4\u7684 CA \u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6\u4F4D\u4E8E",(0,c.jsx)(s.code,{children:"Doris/fe/mysql_ssl_default_certificate/ca_certificate.p12"}),"\uFF0C\u9ED8\u8BA4\u5BC6\u7801\u4E3A",(0,c.jsx)(s.code,{children:"doris"}),"\uFF0C\u60A8\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539 FE \u914D\u7F6E\u6587\u4EF6",(0,c.jsx)(s.code,{children:"conf/fe.conf"}),"\uFF0C\u6DFB\u52A0",(0,c.jsx)(s.code,{children:"mysql_ssl_default_ca_certificate = /path/to/your/certificate"}),"\u4FEE\u6539 CA \u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6\uFF0C\u540C\u65F6\u4E5F\u53EF\u4EE5\u901A\u8FC7",(0,c.jsx)(s.code,{children:"mysql_ssl_default_ca_certificate_password = your_password"}),"\u6DFB\u52A0\u5BF9\u5E94\u60A8\u81EA\u5B9A\u4E49\u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6\u7684\u5BC6\u7801\u3002"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["\u9ED8\u8BA4\u7684 Server \u7AEF\u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6\u4F4D\u4E8E",(0,c.jsx)(s.code,{children:"Doris/fe/mysql_ssl_default_certificate/server_certificate.p12"}),"\uFF0C\u9ED8\u8BA4\u5BC6\u7801\u4E3A",(0,c.jsx)(s.code,{children:"doris"}),"\uFF0C\u60A8\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539 FE \u914D\u7F6E\u6587\u4EF6",(0,c.jsx)(s.code,{children:"conf/fe.conf"}),"\uFF0C\u6DFB\u52A0",(0,c.jsx)(s.code,{children:"mysql_ssl_default_server_certificate = /path/to/your/certificate"}),"\u4FEE\u6539 Server \u7AEF\u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6\uFF0C\u540C\u65F6\u4E5F\u53EF\u4EE5\u901A\u8FC7",(0,c.jsx)(s.code,{children:"mysql_ssl_default_server_certificate_password = your_password"}),"\u6DFB\u52A0\u5BF9\u5E94\u60A8\u81EA\u5B9A\u4E49\u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6\u7684\u5BC6\u7801\u3002"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["\u9ED8\u8BA4\u751F\u6210\u4E86\u4E00\u4EFD Client \u7AEF\u7684\u5BC6\u94A5\u8BC1\u4E66\uFF0C\u5206\u522B\u5B58\u653E\u5728",(0,c.jsx)(s.code,{children:"Doris/fe/mysql_ssl_default_certificate/client-key.pem"}),"\u548C",(0,c.jsx)(s.code,{children:"Doris/fe/mysql_ssl_default_certificate/client_certificate/"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(s.h2,{id:"\u81EA\u5B9A\u4E49\u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6",children:"\u81EA\u5B9A\u4E49\u5BC6\u94A5\u8BC1\u4E66\u6587\u4EF6"}),"\n",(0,c.jsxs)(s.p,{children:["\u9664\u4E86 Doris \u9ED8\u8BA4\u7684\u8BC1\u4E66\u6587\u4EF6\uFF0C\u60A8\u4E5F\u53EF\u4EE5\u901A\u8FC7",(0,c.jsx)(s.code,{children:"openssl"}),"\u751F\u6210\u81EA\u5B9A\u4E49\u7684\u8BC1\u4E66\u6587\u4EF6\u3002\u6B65\u9AA4\u53C2\u8003",(0,c.jsx)(s.a,{href:"https://dev.mysql.com/doc/refman/8.0/en/creating-ssl-files-using-openssl.html",children:"MySQL \u751F\u6210 SSL \u8BC1\u4E66"}),"\n\u5177\u4F53\u5982\u4E0B\uFF1A"]}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsx)(s.li,{children:"\u751F\u6210 CA\u3001Server \u7AEF\u548C Client \u7AEF\u7684\u5BC6\u94A5\u548C\u8BC1\u4E66"}),"\n"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-shell",children:"# \u751F\u6210 CA certificate\nopenssl genrsa 2048 > ca-key.pem\nopenssl req -new -x509 -nodes -days 3600 \\\n        -key ca-key.pem -out ca.pem\n\n# \u751F\u6210 server certificate, \u5E76\u7528\u4E0A\u8FF0 CA \u7B7E\u540D\n# server-cert.pem = public key, server-key.pem = private key\nopenssl req -newkey rsa:2048 -days 3600 \\\n        -nodes -keyout server-key.pem -out server-req.pem\nopenssl rsa -in server-key.pem -out server-key.pem\nopenssl x509 -req -in server-req.pem -days 3600 \\\n        -CA ca.pem -CAkey ca-key.pem -set_serial 01 -out server-cert.pem\n\n# \u751F\u6210 client certificate, \u5E76\u7528\u4E0A\u8FF0 CA \u7B7E\u540D\n# client-cert.pem = public key, client-key.pem = private key\nopenssl req -newkey rsa:2048 -days 3600 \\\n        -nodes -keyout client-key.pem -out client-req.pem\nopenssl rsa -in client-key.pem -out client-key.pem\nopenssl x509 -req -in client-req.pem -days 3600 \\\n        -CA ca.pem -CAkey ca-key.pem -set_serial 01 -out client-cert.pem\n"})}),"\n",(0,c.jsxs)(s.ol,{start:"2",children:["\n",(0,c.jsx)(s.li,{children:"\u9A8C\u8BC1\u521B\u5EFA\u7684\u8BC1\u4E66\u3002"}),"\n"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-shell",children:"openssl verify -CAfile ca.pem server-cert.pem client-cert.pem\n"})}),"\n",(0,c.jsxs)(s.ol,{start:"3",children:["\n",(0,c.jsx)(s.li,{children:"\u5C06\u60A8\u7684 CA \u5BC6\u94A5\u548C\u8BC1\u4E66\u548C Server \u7AEF\u5BC6\u94A5\u548C\u8BC1\u4E66\u5206\u522B\u5408\u5E76\u5230 PKCS#12 (P12) \u5305\u4E2D\u3002\u60A8\u4E5F\u53EF\u4EE5\u6307\u5B9A\u67D0\u4E2A\u8BC1\u4E66\u683C\u5F0F\uFF0C\u9ED8\u8BA4 PKCS12\uFF0C\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539 conf/fe.conf \u914D\u7F6E\u6587\u4EF6\uFF0C\u6DFB\u52A0\u53C2\u6570 ssl_trust_store_type \u6307\u5B9A\u8BC1\u4E66\u683C\u5F0F"}),"\n"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-shell",children:"# \u6253\u5305 CA \u5BC6\u94A5\u548C\u8BC1\u4E66\nopenssl pkcs12 -inkey ca-key.pem -in ca.pem -export -out ca_certificate.p12\n\n# \u6253\u5305 Server \u7AEF\u5BC6\u94A5\u548C\u8BC1\u4E66\nopenssl pkcs12 -inkey server-key.pem -in server-cert.pem -export -out server_certificate.p12\n"})}),"\n",(0,c.jsx)(s.admonition,{title:"Note",type:"info",children:(0,c.jsx)(s.p,{children:(0,c.jsx)(s.a,{href:"https://www.ibm.com/docs/en/api-connect/2018.x?topic=overview-generating-self-signed-certificate-using-openssl",children:"\u53C2\u8003\u6587\u6863"})})})]})}function p(e={}){let{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},250065:function(e,s,n){n.d(s,{Z:function(){return t},a:function(){return l}});var r=n(667294);let c={},i=r.createContext(c);function l(e){let s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);