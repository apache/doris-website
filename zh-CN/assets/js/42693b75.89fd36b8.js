"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["547985"],{167436:function(e,n,s){s.r(n),s.d(n,{default:()=>p,frontMatter:()=>i,metadata:()=>o,assets:()=>t,toc:()=>c,contentTitle:()=>l});var o=JSON.parse('{"id":"install/cluster-deployment/k8s-deploy/install-config-cluster","title":"\u914D\u7F6E Doris \u96C6\u7FA4","description":"\u914D\u7F6E\u6570\u636E\u53CA\u6301\u4E45\u5316\u5B58\u50A8","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-2.0/install/cluster-deployment/k8s-deploy/install-config-cluster.md","sourceDirName":"install/cluster-deployment/k8s-deploy","slug":"/install/cluster-deployment/k8s-deploy/install-config-cluster","permalink":"/zh-CN/docs/2.0/install/cluster-deployment/k8s-deploy/install-config-cluster","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"\u914D\u7F6E Doris \u96C6\u7FA4","language":"zh-CN"},"sidebar":"docs","previous":{"title":"\u90E8\u7F72 Doris Operator","permalink":"/zh-CN/docs/2.0/install/cluster-deployment/k8s-deploy/install-operator"},"next":{"title":"\u90E8\u7F72 Doris \u96C6\u7FA4","permalink":"/zh-CN/docs/2.0/install/cluster-deployment/k8s-deploy/install-doris-cluster"}}'),a=s("785893"),r=s("250065");let i={title:"\u914D\u7F6E Doris \u96C6\u7FA4",language:"zh-CN"},l=void 0,t={},c=[{value:"\u914D\u7F6E\u6570\u636E\u53CA\u6301\u4E45\u5316\u5B58\u50A8",id:"\u914D\u7F6E\u6570\u636E\u53CA\u6301\u4E45\u5316\u5B58\u50A8",level:2},{value:"\u6301\u4E45\u5316\u76EE\u5F55\u7C7B\u578B",id:"\u6301\u4E45\u5316\u76EE\u5F55\u7C7B\u578B",level:3},{value:"\u6570\u636E\u6301\u4E45\u5316\u5230\u7F51\u7EDC PV",id:"\u6570\u636E\u6301\u4E45\u5316\u5230\u7F51\u7EDC-pv",level:3},{value:"\u96C6\u7FA4\u90E8\u7F72\u914D\u7F6E",id:"\u96C6\u7FA4\u90E8\u7F72\u914D\u7F6E",level:2},{value:"\u96C6\u7FA4\u540D\u79F0",id:"\u96C6\u7FA4\u540D\u79F0",level:3},{value:"\u955C\u50CF\u7248\u672C",id:"\u955C\u50CF\u7248\u672C",level:3},{value:"\u96C6\u7FA4\u62D3\u6251",id:"\u96C6\u7FA4\u62D3\u6251",level:3},{value:"\u670D\u52A1\u914D\u7F6E",id:"\u670D\u52A1\u914D\u7F6E",level:3},{value:"\u96C6\u7FA4\u53C2\u6570\u914D\u7F6E",id:"\u96C6\u7FA4\u53C2\u6570\u914D\u7F6E",level:2},{value:"FE ConfigMap",id:"fe-configmap",level:3},{value:"BE ConfigMap",id:"be-configmap",level:3},{value:"\u4E3A conf \u76EE\u5F55\u6DFB\u52A0\u5916\u90E8\u914D\u7F6E\u6587\u4EF6",id:"\u4E3A-conf-\u76EE\u5F55\u6DFB\u52A0\u5916\u90E8\u914D\u7F6E\u6587\u4EF6",level:3},{value:"\u4E3A BE \u914D\u7F6E\u591A\u76D8\u5B58\u50A8",id:"\u4E3A-be-\u914D\u7F6E\u591A\u76D8\u5B58\u50A8",level:3}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"\u914D\u7F6E\u6570\u636E\u53CA\u6301\u4E45\u5316\u5B58\u50A8",children:"\u914D\u7F6E\u6570\u636E\u53CA\u6301\u4E45\u5316\u5B58\u50A8"}),"\n",(0,a.jsxs)(n.p,{children:["\u5728 Doris \u96C6\u7FA4\u4E2D\uFF0C\u5305\u62EC FE\u3001BE\u3001CN \u548C\u76D1\u63A7\u7EC4\u4EF6\u5728\u5185\u7684\u7EC4\u4EF6\u90FD\u9700\u8981\u5C06\u6570\u636E\u6301\u4E45\u5316\u5230\u7269\u7406\u5B58\u50A8\u4E2D\u3002Kubernetes \u63D0\u4F9B\u4E86 ",(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/storage/persistent-volumes/",children:"Persistent Volumes"})," \u7684\u80FD\u529B\u5C06\u6570\u636E\u6301\u4E45\u5316\u5230\u7269\u7406\u5B58\u50A8\u4E2D\u3002\u5728 Kubernetes \u73AF\u5883\u4E2D\uFF0C\u4E3B\u8981\u5B58\u5728\u4E24\u79CD\u7C7B\u578B\u7684 Persistent Volumes\uFF1A"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u672C\u5730 PV \u5B58\u50A8\uFF08Local Persistent Volumes\uFF09\uFF1A\u672C\u5730 PV \u662F Kubernetes \u76F4\u63A5\u4F7F\u7528\u5BBF\u4E3B\u673A\u7684\u672C\u5730\u78C1\u76D8\u76EE\u5F55\u6765\u6301\u4E45\u5316\u5B58\u50A8\u5BB9\u5668\u7684\u6570\u636E\u3002\u672C\u5730 PV \u63D0\u4F9B\u66F4\u5C0F\u7684\u7F51\u7EDC\u5EF6\u8FDF\uFF0C\u5728\u4F7F\u7528 SSD \u7B49\u9AD8\u6027\u80FD\u786C\u76D8\u65F6\uFF0C\u53EF\u4EE5\u63D0\u4F9B\u66F4\u597D\u7684\u8BFB\u5199\u80FD\u529B\u3002\u7531\u4E8E\u672C\u5730 PV \u4E0E\u5BBF\u4E3B\u673A\u7ED1\u5B9A\uFF0C\u5728\u5BBF\u4E3B\u673A\u51FA\u73B0\u6545\u969C\u65F6\uFF0C\u672C\u5730 PV \u8FDB\u884C\u6545\u969C\u6F02\u79FB\u3002"}),"\n",(0,a.jsx)(n.li,{children:"\u7F51\u7EDC PV \u5B58\u50A8\uFF08Network Persistent Volumes\uFF09\uFF1A\u7F51\u7EDC PV \u662F\u901A\u8FC7\u7F51\u7EDC\u8BBF\u95EE\u7684\u5B58\u50A8\u8D44\u6E90\u3002\u7F51\u7EDC PV \u53EF\u4EE5\u88AB\u96C6\u7FA4\u4E2D\u7684\u4EFB\u4E00\u8282\u70B9\u8BBF\u95EE\uFF0C\u5728\u5BBF\u4E3B\u673A\u51FA\u73B0\u6545\u969C\u65F6\uFF0C\u7F51\u7EDC PV \u53EF\u4EE5\u6302\u8F7D\u5230\u5176\u4ED6\u8282\u70B9\u7EE7\u7EED\u4F7F\u7528\u3002"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"StorageClass \u53EF\u4EE5\u7528\u4E8E\u5B9A\u4E49 PV \u7684\u7C7B\u578B\u548C\u884C\u4E3A\uFF0C\u901A\u8FC7 StorageClass \u53EF\u4EE5\u5C06\u78C1\u76D8\u8D44\u6E90\u4E0E\u5BB9\u5668\u89E3\u8026\uFF0C\u4ECE\u800C\u5B9E\u73B0\u6570\u636E\u7684\u6301\u4E45\u6027\u4E0E\u53EF\u9760\u6027\u3002\u5728 Doris Operator \u4E2D\uFF0C\u5728 Kubernetes \u4E0A\u90E8\u7F72 Doris\uFF0C\u53EF\u4EE5\u652F\u6301\u672C\u5730 PV \u4E0E\u7F51\u7EDC PV\uFF0C\u53EF\u4EE5\u6839\u636E\u4E1A\u52A1\u9700\u6C42\u8FDB\u884C\u9009\u62E9\u3002"}),"\n",(0,a.jsx)(n.admonition,{title:"\u6CE8\u610F",type:"caution",children:(0,a.jsx)(n.p,{children:"\u5EFA\u8BAE\u5728\u90E8\u7F72\u65F6\u5C06\u6570\u636E\u6301\u4E45\u5316\u5230\u5B58\u50A8\u4E2D\u3002\n\u5982\u679C\u90E8\u7F72\u65F6\u672A\u914D\u7F6E PersistentVolumeClaim\uFF0CDoris Operator \u9ED8\u8BA4\u4F1A\u4F7F\u7528 emptyDir \u6A21\u5F0F\u6765\u5B58\u50A8\u5143\u6570\u636E\u3001\u6570\u636E\u4EE5\u53CA\u65E5\u5FD7\u3002\u5F53 pod \u91CD\u542F\u65F6\uFF0C\u76F8\u5173\u6570\u636E\u4F1A\u4E22\u5931\u6389\u3002"})}),"\n",(0,a.jsx)(n.h3,{id:"\u6301\u4E45\u5316\u76EE\u5F55\u7C7B\u578B",children:"\u6301\u4E45\u5316\u76EE\u5F55\u7C7B\u578B"}),"\n",(0,a.jsx)(n.p,{children:"\u5728 Doris \u4E2D\uFF0C\u5EFA\u8BAE\u6301\u4E45\u5316\u5B58\u50A8\u4EE5\u4E0B\u76EE\u5F55\uFF1A"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"FE \u8282\u70B9\uFF1Adoris-meta\u3001log"}),"\n",(0,a.jsx)(n.li,{children:"BE \u8282\u70B9\uFF1Astorage\u3001log"}),"\n",(0,a.jsx)(n.li,{children:"CN \u8282\u70B9\uFF1Astorage\u3001log"}),"\n",(0,a.jsx)(n.li,{children:"Broker \u8282\u70B9\uFF1Alog"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u5728 Doris \u4E2D\u5B58\u5728\u591A\u79CD\u65E5\u5FD7\u7C7B\u578B\uFF0C\u5982 INFO \u65E5\u5FD7\u3001OUT \u65E5\u5FD7\u3001GC \u65E5\u5FD7\u4EE5\u53CA\u5BA1\u8BA1\u65E5\u5FD7\u3002Doris Operator \u53EF\u4EE5\u5C06\u65E5\u5FD7\u540C\u65F6\u8F93\u51FA\u5230 console \u4E0E\u6307\u5B9A\u76EE\u5F55\u4E0B\u3002\u5982\u679C\u7528\u6237\u7684 Kubernetes \u6709\u5B8C\u6574\u7684\u65E5\u5FD7\u6536\u96C6\u80FD\u529B\uFF0C\u53EF\u4EE5\u901A\u8FC7 console \u8F93\u51FA\u6765\u6536\u96C6 Doris \u7684 INFO \u65E5\u5FD7\u3002\u5EFA\u8BAE\u5C06 Doris \u7684\u6240\u6709\u65E5\u5FD7\u901A\u8FC7 PVC \u914D\u7F6E\u6301\u4E45\u5316\u5230\u6307\u5B9A\u5B58\u50A8\u4E2D\uFF0C\u8FD9\u5C06\u6709\u52A9\u4E8E\u95EE\u9898\u7684\u5B9A\u4F4D\u4E0E\u6392\u67E5\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"\u6570\u636E\u6301\u4E45\u5316\u5230\u7F51\u7EDC-pv",children:"\u6570\u636E\u6301\u4E45\u5316\u5230\u7F51\u7EDC PV"}),"\n",(0,a.jsxs)(n.p,{children:["Doris Operator \u4F7F\u7528 Kubernetes \u9ED8\u8BA4\u7684 StorageClass \u6765\u652F\u6301 FE \u4E0E BE \u7684\u5B58\u50A8\u3002\u5728 DorisCluster \u7684 CR \u4E2D\uFF0C\u901A\u4FEE\u6539 StorageClass \u6307\u5B9A ",(0,a.jsx)(n.code,{children:"persistentVolumeClaimSpec.storageClassName"}),"\uFF0C\u53EF\u4EE5\u914D\u7F6E\u6307\u5B9A\u7684\u7F51\u7EDC PV\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"persistentVolumes:\n    - mountPath: /opt/apache-doris/fe/doris-meta\n      name: storage0\n      persistentVolumeClaimSpec:\n        # when use specific storageclass, the storageClassName should reConfig, example as annotation.\n        storageClassName: ${your_storageclass}\n        accessModes:\n        - ReadWriteOnce\n        resources:\n          # notice: if the storage size less 5G, fe will not start normal.\n          requests:\n            storage: 100Gi\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"FE \u914D\u7F6E\u6301\u4E45\u5316\u5B58\u50A8"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u90E8\u7F72\u96C6\u7FA4\u65F6\uFF0C\u5EFA\u8BAE\u5BF9 FE \u4E2D\u7684 doris-meta \u4E0E log \u76EE\u5F55\u505A\u6301\u4E45\u5316\u5B58\u50A8\u3002doris-meta \u7528\u6237\u5B58\u653E\u5143\u6570\u636E\uFF0C\u4E00\u822C\u5728\u51E0\u767E MB \u5230\u51E0\u5341 GB\uFF0C\u5EFA\u8BAE\u9884\u7559 100GB\u3002log \u76EE\u5F55\u7528\u6765\u5B58\u653E FE \u65E5\u5FD7\uFF0C\u4E00\u822C\u5EFA\u8BAE\u9884\u7559 50GB\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u4E0B\u4F8B\u4E2D FE \u4F7F\u7528 StorageClass \u6302\u8F7D\u4E86\u5143\u6570\u636E\u5B58\u50A8\u4E0E\u65E5\u5FD7\u5B58\u50A8\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"feSpec:\n    persistentVolumes:\n    - name: fe-meta\n      mountPath: /opt/apache-doris/fe/doris-meta\n      persistentVolumeClaimSpec:\n        storageClassName: ${storageClassName}\n        accessModes:\n        - ReadWriteOnce\n        resources:\n          requests:\n            storage: 50Gi\n    - name: fe-log            \n      mountPath: /opt/apache-doris/fe/log\n      persistentVolumeClaimSpec:\n        storageClassName: ${storageClassName}\n        accessModes:\n        - ReadWriteOnce\n        resources:\n          requests:\n            storage: 100Gi\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5176\u4E2D\uFF0C\u9700\u8981\u5728 ${storageClassName} \u6307\u5B9A ",(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/",children:"StorageClass"})," \u7684\u540D\u79F0\u3002\u53EF\u4EE5\u901A\u8FC7 \u4EE5\u4E0B\u547D\u4EE4\u67E5\u770B\u5F53\u524D Kubernetes \u96C6\u7FA4\u5185\u652F\u6301\u7684 StorageClass\uFF1A"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl get sc\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u8FD4\u56DE\u7ED3\u679C\u5982\u4E0B\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"NAME                          PROVISIONER                    RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE\nopenebs-hostpath              openebs.io/local               Delete          WaitForFirstConsumer   false                  212d\nopenebs-device                openebs.io/local               Delete          WaitForFirstConsumer   false                  212d\nopenebs-jiva-csi-default      jiva.csi.openebs.io            Delete          Immediate              true                   212d\nlocal-storage                 kubernetes.io/no-provisioner   Delete          WaitForFirstConsumer   false                  149d\nmicrok8s-hostpath (default)   microk8s.io/hostpath           Delete          Immediate              false                  219d\ndoris-storage                 openebs.io/local               Delete          WaitForFirstConsumer   false                  54d\n"})}),"\n",(0,a.jsxs)(n.admonition,{title:"\u63D0\u793A",type:"tip",children:[(0,a.jsxs)(n.p,{children:["\u53EF\u4EE5\u901A\u8FC7\u914D\u7F6E ",(0,a.jsx)(n.a,{href:"#fe-configmap",children:"ConfigMap"})," \u4FEE\u6539\u9ED8\u8BA4\u7684\u5143\u6570\u636E\u8DEF\u5F84\u4E0E\u65E5\u5FD7\u8DEF\u5F84\uFF1A"]}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"fe-meta \u7684 mounthPath \u914D\u7F6E\u9700\u8981\u4E0E ConfigMap \u4E2D\u7684 meta_dir \u53D8\u91CF\u914D\u7F6E\u8DEF\u5F84\u4E00\u81F4\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u5143\u6570\u636E\u4F1A\u5199\u5165  /opt/apache-doris/fe/doris-meta \u76EE\u5F55\u4E0B\uFF1B"}),"\n",(0,a.jsx)(n.li,{children:"fe-log \u7684 mounthPath \u914D\u7F6E\u9700\u8981\u4E0E ConfigMap \u4E2D\u7684 LOG_DIR \u53D8\u91CF\u8DEF\u5F84\u4E00\u81F4\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u65E5\u5FD7\u6570\u636E\u4F1A\u5199\u5165\u5230 /opt/apache-doris/fe/log \u76EE\u5F55\u4E0B\u3002"}),"\n"]})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"BE \u914D\u7F6E\u6301\u4E45\u5316\u5B58\u50A8"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u90E8\u7F72\u96C6\u7FA4\u65F6\uFF0C\u5EFA\u8BAE\u5BF9 BE \u4E2D\u7684 storage \u4E0E log \u76EE\u5F55\u505A\u6301\u4E45\u5316\u5B58\u50A8\u3002storage \u7528\u6237\u5B58\u653E\u6570\u636E\uFF0C\u9700\u8981\u6839\u636E\u4E1A\u52A1\u6570\u636E\u91CF\u8861\u91CF\u3002log \u76EE\u5F55\u7528\u6765\u5B58\u653E FE \u65E5\u5FD7\uFF0C\u4E00\u822C\u5EFA\u8BAE\u9884\u7559 50GB\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u4E0B\u4F8B\u4E2D BE \u4F7F\u7528 StorageClass \u6302\u8F7D\u4E86\u6570\u636E\u5B58\u50A8\u4E0E\u65E5\u5FD7\u5B58\u50A8\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"beSpec:\n  persistentVolumes:\n  - mountPath: /opt/apache-doris/be/storage\n    name: be-storage\n    persistentVolumeClaimSpec:\n      storageClassName: {storageClassName}\n      accessModes:\n        - ReadWriteOnce\n      resources:\n        requests:\n          storage: 1Ti\n  - mountPath: /opt/apache-doris/be/log\n    name: belog\n    persistentVolumeClaimSpec:\n      storageClassName: {storageClassName}\n      accessModes:\n      - ReadWriteOnce\n      resources:\n        requests:\n          storage: 100Gi\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u96C6\u7FA4\u90E8\u7F72\u914D\u7F6E",children:"\u96C6\u7FA4\u90E8\u7F72\u914D\u7F6E"}),"\n",(0,a.jsx)(n.h3,{id:"\u96C6\u7FA4\u540D\u79F0",children:"\u96C6\u7FA4\u540D\u79F0"}),"\n",(0,a.jsx)(n.p,{children:"\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539 DorisCluster Custom Resource \u4E2D\u7684 metadata.name \u6765\u914D\u7F6E\u96C6\u7FA4\u540D\u79F0\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"\u955C\u50CF\u7248\u672C",children:"\u955C\u50CF\u7248\u672C"}),"\n",(0,a.jsxs)(n.p,{children:["\u5728\u90E8\u7F72 Doris \u96C6\u7FA4\u65F6\uFF0C\u53EF\u4EE5\u6307\u5B9A\u96C6\u7FA4\u7684\u7248\u672C\u3002\u90E8\u7F72\u96C6\u7FA4\u65F6\u5E94\u8BE5\u4FDD\u8BC1\u96C6\u7FA4\u4E2D\u7684\u5404\u4E2A\u7EC4\u4EF6\u7248\u672C\u4E00\u81F4\u3002\u901A\u8FC7\u4FEE\u6539 ",(0,a.jsx)(n.code,{children:"spec.{feSpec|beSpec}.image"})," \u914D\u7F6E\u5404\u4E2A\u7EC4\u4EF6\u7684\u7248\u672C\u3002"]}),"\n",(0,a.jsx)(n.h3,{id:"\u96C6\u7FA4\u62D3\u6251",children:"\u96C6\u7FA4\u62D3\u6251"}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u90E8\u7F72 Doris \u96C6\u7FA4\u524D\uFF0C\u9700\u8981\u6839\u636E\u4E1A\u52A1\u89C4\u5212\u96C6\u7FA4\u7684\u62D3\u6251\u7ED3\u6784\u3002\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539 spec.{feSpec|beSpec}.replicas \u914D\u7F6E\u5404\u4E2A\u7EC4\u4EF6\u7684\u8282\u70B9\u6570\u3002\u57FA\u4E8E\u751F\u4EA7\u8282\u70B9\u7684\u6570\u636E\u9AD8\u53EF\u7528\u539F\u5219\uFF0CDoris Operator \u89C4\u5B9A\u96C6\u7FA4\u4E2D Kubernetes \u96C6\u7FA4\u4E2D\u81F3\u5C11\u6709 3 \u4E2A\u8282\u70B9\u3002\u540C\u65F6\uFF0C\u4E3A\u4E86\u4FDD\u8BC1\u96C6\u7FA4\u7684\u53EF\u7528\u6027\uFF0C\u5EFA\u8BAE\u81F3\u5C11\u90E8\u7F72 3 \u4E2A FE \u4E0E BE \u8282\u70B9\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"\u670D\u52A1\u914D\u7F6E",children:"\u670D\u52A1\u914D\u7F6E"}),"\n",(0,a.jsxs)(n.p,{children:["Kubernetes \u63D0\u4F9B\u4E0D\u540C\u7684 Serivce \u65B9\u5F0F\u66B4\u9732 Doris \u7684\u5BF9\u5916\u8BBF\u95EE\u63A5\u53E3\uFF0C\u5982 ",(0,a.jsx)(n.code,{children:"ClusterIP"}),"\u3001",(0,a.jsx)(n.code,{children:"NodePort"}),"\u3001",(0,a.jsx)(n.code,{children:"LoadBalancer"})," \u7B49\u3002"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"ClusterIP"})}),"\n",(0,a.jsx)(n.p,{children:"ClusterIP \u7C7B\u578B\u7684 service \u4F1A\u5728\u96C6\u7FA4\u5185\u90E8\u521B\u5EFA\u865A\u62DF IP\u3002\u901A\u8FC7 ClusterIP \u53EA\u80FD\u5728 Kubernetes \u96C6\u7FA4\u5185\u8BBF\u95EE\uFF0C\u5BF9\u5916\u4E0D\u53EF\u89C1\u3002\u5728 Doris Custom Resource \u4E2D\uFF0C\u9ED8\u8BA4\u4F7F\u7528 ClusterIP \u7C7B\u578B\u7684 Service\u3002"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"NodePort"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5728\u6CA1\u6709 LoadBalancer \u65F6\uFF0C\u53EF\u4EE5\u901A\u8FC7 NodePort \u66B4\u9732\u3002NodePort \u662F\u901A\u8FC7\u8282\u70B9\u7684 IP \u548C\u9759\u6001\u7AEF\u53E3\u66B4\u9732\u670D\u52A1\u3002\u901A\u8FC7\u8BF7\u6C42 ",(0,a.jsx)(n.code,{children:"NodeIP + NodePort"}),"\uFF0C\u53EF\u4EE5\u4ECE\u96C6\u7FA4\u7684\u5916\u90E8\u8BBF\u95EE\u4E00\u4E2A NodePort \u670D\u52A1\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"...\nfeSpec:\n  replicas: 3\n  service:\n    type: NodePort\n...\nbeSpec:\n  replicas: 3\n  service:\n    type: NodePort\n...\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u96C6\u7FA4\u53C2\u6570\u914D\u7F6E",children:"\u96C6\u7FA4\u53C2\u6570\u914D\u7F6E"}),"\n",(0,a.jsxs)(n.p,{children:["Doris \u5728 Kubernetes \u4F7F\u7528 ",(0,a.jsx)(n.code,{children:"ConfigMap"})," \u5B9E\u73B0\u914D\u7F6E\u6587\u4EF6\u548C\u670D\u52A1\u89E3\u8026\u3002Doris \u7EC4\u4EF6\u7684\u6240\u6709\u8282\u70B9\u5728 Kubernetes \u4F7F\u7528 ConfigMap \u4F5C\u4E3A\u7EDF\u4E00\u5316\u914D\u7F6E\u7BA1\u7406\uFF0C\u7EC4\u4EF6\u7684\u6240\u6709\u8282\u70B9\u90FD\u4F7F\u7528\u76F8\u540C\u7684\u914D\u7F6E\u4FE1\u606F\u542F\u52A8\u3002\u5728 ConfigMap \u4E2D\u4F7F\u7528\u952E\u503C\u5BF9\u7684\u65B9\u5F0F\u5B58\u50A8 Doris \u7684\u7CFB\u7EDF\u53C2\u6570\u3002\u5728\u90E8\u7F72 doris \u96C6\u7FA4\u65F6\uFF0C\u9700\u8981\u63D0\u524D\u5728\u76F8\u540C namespace \u4E0B\u90E8\u7F72 ConfigMap\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"\u5728 Doris Cluster \u7684 CR \u4E2D\uFF0C\u63D0\u4F9B ConfigMapInfo \u5B9A\u4E49\u7ED9\u5404\u4E2A\u7EC4\u4EF6\u6302\u8F7D\u914D\u7F6E\u4FE1\u606F\u3002ConfigMapInfo \u5305\u542B\u4E24\u4E2A\u53D8\u91CF\uFF1A"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"ConfigMapName \u8868\u793A\u60F3\u8981\u4F7F\u7528\u7684 ConfigMap \u7684\u540D\u79F0"}),"\n",(0,a.jsx)(n.li,{children:"ResolveKey \u8868\u793A\u5BF9\u5E94\u7684\u914D\u7F6E\u6587\u4EF6\uFF0CFE \u914D\u7F6E\u9009\u62E9 fe.conf\uFF0CBE \u914D\u7F6E\u9009\u62E9 be.conf"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"fe-configmap",children:"FE ConfigMap"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u5B9A\u4E49 FE ConfigMap"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u4F7F\u7528 ConfigMap \u5B9A\u4E49 FE \u914D\u7F6E\u65F6\uFF0C\u9700\u8981\u5148\u5B9A\u4E49\u5E76\u4E0B\u53D1 ConfigMap \u5230 Kubernetes \u96C6\u7FA4\u4E2D\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u4E0B\u4F8B\u4E2D\u5B9A\u4E49\u4E86\u540D\u4E3A fe-conf \u7684 ConfigMap\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: fe-conf\n  labels:\n    app.kubernetes.io/component: fe\ndata:\n  fe.conf: |\n    CUR_DATE=`date +%Y%m%d-%H%M%S`\n\n    # the output dir of stderr and stdout\n    LOG_DIR = ${DORIS_HOME}/log\n\n    JAVA_OPTS="-Djavax.security.auth.useSubjectCredsOnly=false -Xss4m -Xmx8192m -XX:+UseMembar -XX:SurvivorRatio=8 -XX:MaxTenuringThreshold=7 -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:+CMSClassUnloadingEnabled -XX:-CMSParallelRemarkEnabled -XX:CMSInitiatingOccupancyFraction=80 -XX:SoftRefLRUPolicyMSPerMB=0 -Xloggc:$DORIS_HOME/log/fe.gc.log.$CUR_DATE"\n\n    # For jdk 9+, this JAVA_OPTS will be used as default JVM options\n    JAVA_OPTS_FOR_JDK_9="-Djavax.security.auth.useSubjectCredsOnly=false -Xss4m -Xmx8192m -XX:SurvivorRatio=8 -XX:MaxTenuringThreshold=7 -XX:+CMSClassUnloadingEnabled -XX:-CMSParallelRemarkEnabled -XX:CMSInitiatingOccupancyFraction=80 -XX:SoftRefLRUPolicyMSPerMB=0 -Xlog:gc*:$DORIS_HOME/log/fe.gc.log.$CUR_DATE:time"\n\n    # INFO, WARN, ERROR, FATAL\n    sys_log_level = INFO\n\n    # NORMAL, BRIEF, ASYNC\n    sys_log_mode = NORMAL\n\n    # Default dirs to put jdbc drivers,default value is ${DORIS_HOME}/jdbc_drivers\n    # jdbc_drivers_dir = ${DORIS_HOME}/jdbc_drivers\n\n    http_port = 8030\n    rpc_port = 9020\n    query_port = 9030\n    edit_log_port = 9010\n    enable_fqdn_mode = true\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u5176\u4E2D\uFF0C\u5728 metadata.name \u4E2D\u5B9A\u4E49 FE ConfigMap \u7684\u540D\u5B57\uFF0C\u5728 data \u4E2D\u5B9A\u4E49 fe.conf \u4E2D\u7684\u6570\u636E\u5E93\u914D\u7F6E\u3002\n\u81EA\u5DF1\u914D\u7F6E\u7684 ",(0,a.jsx)(n.code,{children:"fe.conf"})," \u4E00\u5B9A\u8981\u6DFB\u52A0 ",(0,a.jsx)(n.code,{children:"enable_fqdn_mode = true"})]}),"\n",(0,a.jsxs)(n.admonition,{title:"\u63D0\u793A",type:"tip",children:[(0,a.jsx)(n.p,{children:"\u5728 ConfigMap \u4E2D\u4F7F\u7528 data \u5B57\u6BB5\u5B58\u50A8\u952E\u503C\u5BF9\u3002\u5728\u4E0A\u8FF0 FE ConfigMap \u4E2D\uFF1A"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["fe.conf \u662F\u952E\u503C\u5BF9\u4E2D\u7684 key\uFF0C\u4F7F\u7528 ",(0,a.jsx)(n.code,{children:"|"})," \u8868\u793A\u5C06\u4FDD\u7559\u540E\u7EED\u5B57\u7B26\u4E32\u4E2D\u7684\u6362\u884C\u7B26\u548C\u7F29\u8FDB"]}),"\n",(0,a.jsxs)(n.li,{children:["\u540E\u7EED\u914D\u7F6E\u4E3A\u952E\u503C\u5BF9\u4E2D\u7684 value\uFF0C\u4E0E fe.conf \u6587\u4EF6\u4E2D\u7684\u914D\u7F6E\u76F8\u540C\n\u5728 data \u5B57\u6BB5\u4E2D\uFF0C\u7531\u4E8E\u4F7F\u7528\u4E86 ",(0,a.jsx)(n.code,{children:"|"})," \u7B26\u53F7\u4FDD\u7559\u540E\u7EED\u5B57\u7B26\u4E32\u683C\u5F0F\uFF0C\u540E\u7EED\u7684\u914D\u7F6E\u4E2D\u9700\u8981\u4FDD\u6301\u4E24\u4E2A\u7A7A\u683C\u7F29\u8FDB\u3002"]}),"\n"]})]}),"\n",(0,a.jsxs)(n.p,{children:["\u5728\u5B9A\u4E49 FE ConfigMap \u540E\uFF0C\u9700\u8981\u901A\u8FC7 ",(0,a.jsx)(n.code,{children:"kubectl apply"})," \u547D\u4EE4\u4E0B\u53D1\u3002"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u4F7F\u7528 FE ConfigMap"})}),"\n",(0,a.jsx)(n.p,{children:"\u5982\u679C\u9700\u8981\u4F7F\u7528 FE ConfigMap\uFF0C\u9700\u8981\u518D Doris Cluster \u7684 RC \u4E2D\u901A\u8FC7 spec.feSpec.configMapInfo \u6307\u5B9A\u5B9A\u4E49\u7684 ConfigMap\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"kind: DorisCluster\nmetadata:\n  name: doriscluster-sample-configmap\nspec:\n  feSpec:\n    configMapInfo:\n      configMapName: {feConfigMapName}\n      resolveKey: fe.conf\n...\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5C06\u4E0A\u4F8B\u4E2D\u7684 ${feConfigMapName} \u66FF\u6362\u4E3A fe-conf \u8868\u793A\u4F7F\u7528\u4E0A\u4F8B\u4E2D\u5B9A\u4E49\u7684 FE ConfigMap\u3002\u5BF9\u4E8E FE ConfigMap\uFF0C\u9700\u8981\u4FDD\u6301 resolveKey \u5B57\u6BB5\u56FA\u5B9A\u4E3A ",(0,a.jsx)(n.code,{children:"fe.conf"}),"\u3002"]}),"\n",(0,a.jsx)(n.h3,{id:"be-configmap",children:"BE ConfigMap"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u5B9A\u4E49 BE ConfigMap"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u4F7F\u7528 ConfigMap \u5B9A\u4E49 BE \u914D\u7F6E\u65F6\uFF0C\u9700\u8981\u5148\u5B9A\u4E49\u5E76\u4E0B\u53D1 ConfigMap \u5230 Kubernetes \u96C6\u7FA4\u4E2D\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u4E0B\u4F8B\u4E2D\u5B9A\u4E49\u4E86\u540D\u4E3A be-conf \u7684 ConfigMap\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: be-conf\n  labels:\n    app.kubernetes.io/component: be\ndata:\n  be.conf: |\n    CUR_DATE=`date +%Y%m%d-%H%M%S`\n\n    PPROF_TMPDIR="$DORIS_HOME/log/"\n\n    JAVA_OPTS="-Xmx1024m -DlogPath=$DORIS_HOME/log/jni.log -Xloggc:$DORIS_HOME/log/be.gc.log.$CUR_DATE -Djavax.security.auth.useSubjectCredsOnly=false -Dsun.java.command=DorisBE -XX:-CriticalJNINatives -DJDBC_MIN_POOL=1 -DJDBC_MAX_POOL=100 -DJDBC_MAX_IDLE_TIME=300000 -DJDBC_MAX_WAIT_TIME=5000"\n\n    # For jdk 9+, this JAVA_OPTS will be used as default JVM options\n    JAVA_OPTS_FOR_JDK_9="-Xmx1024m -DlogPath=$DORIS_HOME/log/jni.log -Xlog:gc:$DORIS_HOME/log/be.gc.log.$CUR_DATE -Djavax.security.auth.useSubjectCredsOnly=false -Dsun.java.command=DorisBE -XX:-CriticalJNINatives -DJDBC_MIN_POOL=1 -DJDBC_MAX_POOL=100 -DJDBC_MAX_IDLE_TIME=300000 -DJDBC_MAX_WAIT_TIME=5000"\n\n    # since 1.2, the JAVA_HOME need to be set to run BE process.\n    # JAVA_HOME=/path/to/jdk/\n\n    # https://github.com/apache/doris/blob/master/docs/zh-CN/community/developer-guide/debug-tool.md#jemalloc-heap-profile\n    # https://jemalloc.net/jemalloc.3.html\n    JEMALLOC_CONF="percpu_arena:percpu,background_thread:true,metadata_thp:auto,muzzy_decay_ms:15000,dirty_decay_ms:15000,oversize_threshold:0,lg_tcache_max:20,prof:false,lg_prof_interval:32,lg_prof_sample:19,prof_gdump:false,prof_accum:false,prof_leak:false,prof_final:false"\n    JEMALLOC_PROF_PRFIX=""\n\n    # INFO, WARNING, ERROR, FATAL\n    sys_log_level = INFO\n\n    # ports for admin, web, heartbeat service\n    be_port = 9060\n    webserver_port = 8040\n    heartbeat_service_port = 9050\n    brpc_port = 8060\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u5176\u4E2D\uFF0C\u5728 metadata.name \u4E2D\u5B9A\u4E49 BE ConfigMap \u7684\u540D\u5B57\uFF0C\u5728 data \u4E2D\u5B9A\u4E49 be.conf \u4E2D\u7684\u6570\u636E\u5E93\u914D\u7F6E\u3002"}),"\n",(0,a.jsxs)(n.admonition,{title:"\u63D0\u793A",type:"tip",children:[(0,a.jsx)(n.p,{children:"\u5728 ConfigMap \u4E2D\u4F7F\u7528 data \u5B57\u6BB5\u5B58\u50A8\u952E\u503C\u5BF9\u3002\u5728\u4E0A\u8FF0 BE ConfigMap \u4E2D\uFF1A"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["be.conf \u662F\u952E\u503C\u5BF9\u4E2D\u7684 key\uFF0C\u4F7F\u7528 ",(0,a.jsx)(n.code,{children:"|"})," \u8868\u793A\u5C06\u4FDD\u7559\u540E\u7EED\u5B57\u7B26\u4E32\u4E2D\u7684\u6362\u884C\u7B26\u548C\u7F29\u8FDB"]}),"\n",(0,a.jsxs)(n.li,{children:["\u540E\u7EED\u914D\u7F6E\u4E3A\u952E\u503C\u5BF9\u4E2D\u7684 value\uFF0C\u4E0E be.conf \u6587\u4EF6\u4E2D\u7684\u914D\u7F6E\u76F8\u540C\n\u5728 data \u5B57\u6BB5\u4E2D\uFF0C\u7531\u4E8E\u4F7F\u7528\u4E86 ",(0,a.jsx)(n.code,{children:"|"})," \u7B26\u53F7\u4FDD\u7559\u540E\u7EED\u5B57\u7B26\u4E32\u683C\u5F0F\uFF0C\u540E\u7EED\u7684\u914D\u7F6E\u4E2D\u9700\u8981\u4FDD\u6301\u4E24\u4E2A\u7A7A\u683C\u7F29\u8FDB\u3002"]}),"\n"]})]}),"\n",(0,a.jsxs)(n.p,{children:["\u5728\u5B9A\u4E49 BE ConfigMap \u540E\uFF0C\u9700\u8981\u901A\u8FC7 ",(0,a.jsx)(n.code,{children:"kubectl apply"})," \u547D\u4EE4\u4E0B\u53D1\u3002"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u4F7F\u7528 BE ConfigMap"})}),"\n",(0,a.jsx)(n.p,{children:"\u5982\u679C\u9700\u8981\u4F7F\u7528 BE ConfigMap\uFF0C\u9700\u8981\u518D Doris Cluster \u7684 RC \u4E2D\u901A\u8FC7 spec.beSpec.configMapInfo \u6307\u5B9A\u5B9A\u4E49\u7684 ConfigMap\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"kind: DorisCluster\nmetadata:\n  name: doriscluster-sample-configmap\nspec:\n  beSpec:\n    configMapInfo:\n      configMapName: {beConfigMapName}\n      resolveKey: be.conf\n...\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5C06\u4E0A\u4F8B\u4E2D\u7684 ${beConfigMapName} \u66FF\u6362\u4E3A be-conf \u8868\u793A\u4F7F\u7528\u4E0A\u4F8B\u4E2D\u5B9A\u4E49\u7684 BE ConfigMap\u3002\u5BF9\u4E8E BE ConfigMap\uFF0C\u9700\u8981\u4FDD\u6301 resolveKey \u5B57\u6BB5\u56FA\u5B9A\u4E3A ",(0,a.jsx)(n.code,{children:"be.conf"}),"\u3002"]}),"\n",(0,a.jsx)(n.h3,{id:"\u4E3A-conf-\u76EE\u5F55\u6DFB\u52A0\u5916\u90E8\u914D\u7F6E\u6587\u4EF6",children:"\u4E3A conf \u76EE\u5F55\u6DFB\u52A0\u5916\u90E8\u914D\u7F6E\u6587\u4EF6"}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u4F7F\u7528 Catalog \u529F\u80FD\u8BBF\u95EE\u5916\u90E8\u6570\u636E\u6E90\u65F6\uFF0C\u9700\u8981\u5C06\u76F8\u5173\u914D\u7F6E\u6587\u4EF6\u6DFB\u52A0\u5230 Doris \u8282\u70B9\u7684 conf \u76EE\u5F55\u4E0B\uFF0C\u5982\u5728\u8BBF\u95EE hive catalog \u65F6\uFF0C\u9700\u8981\u5C06 core-site.xml\uFF0Chdfs-site.xml \u4E0E hive-site.xml \u6587\u4EF6\u653E\u5230 FE \u4E0E BE \u7684 conf \u76EE\u5F55\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u5728 Kubernetes \u73AF\u5883\u4E2D\uFF0C\u9700\u8981\u5C06 catalog \u7684\u76F8\u5173\u914D\u7F6E\u6587\u4EF6\uFF0C\u4EE5 ConfigMap \u7684\u5F62\u5F0F\u52A0\u8F7D\u5230 Doris \u4E2D\u3002\u4E0B\u4F8B\u5C55\u793A\u4E86\u5C06 core-site.xml \u6587\u4EF6\u52A0\u8F7D\u5230 BE\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: be-configmap\n  labels:\n    app.kubernetes.io/component: be\ndata:\n  be.conf: |\n    be_port = 9060\n    webserver_port = 8040\n    heartbeat_service_port = 9050\n    brpc_port = 8060\n  core-site.xml: |\n    <?xml version="1.0" encoding="UTF-8"?>\n    <?xml-stylesheet type="text/xsl" href="configuration.xsl"?>\n    <configuration>\n      <property>\n      <name>hadoop.security.authentication</name>\n        <value>kerberos</value>\n      </property>\n    </configuration>\n    ...\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u5176\u4E2D\uFF0C\u5728 data \u5B57\u6BB5\u4E2D\u5B58\u50A8\u4E86\u914D\u7F6E\u7684\u952E\u503C\u5BF9\uFF0C\u5728\u4E0A\u4F8B\u4E2D\u5B58\u50A8\u4E86 key \u5206\u522B\u4E3A be.conf \u4E0E core-site.xml \u7684\u952E\u503C\u5BF9\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u5728 data \u5B57\u6BB5\u4E2D\uFF0C\u9700\u8981\u6EE1\u8DB3\u4EE5\u4E0B\u7684\u952E\u503C\u7ED3\u6784\u6620\u5C04\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"data:\n filename_1: |\n   config_string\n filename_2: |\n   config_string\n filename_3: |\n   config_string\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u4E3A-be-\u914D\u7F6E\u591A\u76D8\u5B58\u50A8",children:"\u4E3A BE \u914D\u7F6E\u591A\u76D8\u5B58\u50A8"}),"\n",(0,a.jsxs)(n.p,{children:["Doris \u652F\u6301\u4E3A BE \u6302\u8F7D\u591A\u5757 PV\u3002\u901A\u8FC7\u914D\u7F6E BE \u53C2\u6570 ",(0,a.jsx)(n.code,{children:"storage_root_path"})," \u53EF\u4EE5\u6307\u5B9A BE \u4F7F\u7528\u591A\u76D8\u5B58\u50A8\u3002\u5728 Kubernetes \u73AF\u5883\u4E2D\uFF0C\u53EF\u4EE5\u5728 DorisCluster CR \u4E2D\u5BF9 pv \u8FDB\u884C\u6620\u5C04\uFF0C\u901A\u8FC7 ConfigMap \u4E3A BE \u914D\u7F6E ",(0,a.jsx)(n.code,{children:"storage_root_path"})," \u53C2\u6570\u3002"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u4E3A BE \u591A\u76D8\u5B58\u50A8\u914D\u7F6E pv \u6620\u5C04"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5728 DorisCluster CR \u6587\u4EF6\u4E2D\uFF0C\u76F8\u6BD4\u4E8E\u5355\u76D8\u914D\u7F6E\uFF0C\u9700\u8981\u6DFB\u52A0 ",(0,a.jsx)(n.code,{children:"configMapInfo"})," \u4E0E ",(0,a.jsx)(n.code,{children:"persistentVolumeClaimSpec"})," \u7684\u63CF\u8FF0\uFF1A"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\u901A\u8FC7 ",(0,a.jsx)(n.code,{children:"configMapInfo"})," \u914D\u7F6E\u53EF\u4EE5\u6807\u8BC6\u4F7F\u7528\u76F8\u540C namespace \u4E0B\u7684\u6307\u5B9A ConfigMap\uFF0CresolveKey \u56FA\u5B9A\u4E3A be.conf"]}),"\n",(0,a.jsxs)(n.li,{children:["\u901A\u8FC7 ",(0,a.jsx)(n.code,{children:"persistentVolumeClaimSpec"})," \u53EF\u4EE5\u4E3A BE \u5B58\u50A8\u76EE\u5F55\u914D\u7F6E\u591A\u4E2A pv \u6620\u5C04"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u4E0B\u4F8B\u4E2D\u4E3A BE \u914D\u7F6E\u4E86\u4E24\u5757\u76D8\u7684 pv  \u6620\u5C04\uFF1A"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"...\n  beSpec:\n    replicas: 3\n    image: selectdb/doris.be-ubuntu:2.0.2\n    limits:\n      cpu: 8\n      memory: 16Gi\n    requests:\n      cpu: 8\n      memory: 16Gi\n    configMapInfo:\n      configMapName: be-configmap\n      resolveKey: be.conf\n    persistentVolumes:\n    - mountPath: /opt/apache-doris/be/storage1\n      name: storage2\n      persistentVolumeClaimSpec:\n        # when use specific storageclass, the storageClassName should reConfig, example as annotation.\n        #storageClassName: openebs-jiva-csi-default\n        accessModes:\n        - ReadWriteOnce\n        resources:\n          requests:\n            storage: 100Gi\n    - mountPath: /opt/apache-doris/be/storage2\n      name: storage3\n      persistentVolumeClaimSpec:\n        # when use specific storageclass, the storageClassName should reConfig, example as annotation.\n        #storageClassName: openebs-jiva-csi-default\n        accessModes:\n        - ReadWriteOnce\n        resources:\n          requests:\n            storage: 100Gi\n    - mountPath: /opt/apache-doris/be/log\n      name: storage4\n      persistentVolumeClaimSpec:\n        # when use specific storageclass, the storageClassName should reConfig, example as annotation.\n        #storageClassName: openebs-jiva-csi-default\n        accessModes:\n        - ReadWriteOnce\n        resources:\n          requests:\n            storage: 100Gi\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u4E0A\u4F8B\u4E2D Doris \u96C6\u7FA4\u6307\u5B9A\u4E86\u591A\u76D8\u5B58\u50A8"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["beSpec.persistentVolumes \u4EE5\u6570\u7EC4\u7684\u65B9\u5F0F\u6307\u5B9A\u4E86\u591A\u5757 pv\uFF0C\u6620\u5C04\u4E86 ",(0,a.jsx)(n.code,{children:"/opt/apache-doris/be/storage{1,2}"})," \u4E24\u4E2A\u6570\u636E\u5B58\u50A8 pv"]}),"\n",(0,a.jsxs)(n.li,{children:["beSpec.configMapInfo \u4E2D\u6307\u5B9A\u4E86\u9700\u8981\u6302\u8F7D\u540D\u4E3A ",(0,a.jsx)(n.code,{children:"be-configmap"})," \u7684 ConfigMap"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u914D\u7F6E BE ConfigMap \u6307\u5B9A storage_root_path \u53C2\u6570"})}),"\n",(0,a.jsx)(n.p,{children:"\u6839\u636E DorisCluster CR \u4E2D\u6307\u5B9A\u7684 BE ConfigMap \u540D\uFF0C\u9700\u8981\u521B\u5EFA\u76F8\u5E94\u7684 ConfigMap \u5E76\u6307\u5B9A storage_root_path \u53C2\u6570\u3002"}),"\n",(0,a.jsxs)(n.p,{children:["\u4E0B\u4F8B\u4E2D\u5728\u540D\u4E3A ",(0,a.jsx)(n.code,{children:"be-configmap"})," \u7684 ConfigMap \u4E2D\u6307\u5B9A\u4E86 ",(0,a.jsx)(n.code,{children:"storage_root_path"})," \u53C2\u6570\u4F7F\u7528\u4E24\u5757\u76D8\uFF1A"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: be-configmap\n  labels:\n    app.kubernetes.io/component: be\ndata:\n  be.conf: |\n    CUR_DATE=`date +%Y%m%d-%H%M%S`\n\n    PPROF_TMPDIR="$DORIS_HOME/log/"\n\n    JAVA_OPTS="-Xmx1024m -DlogPath=$DORIS_HOME/log/jni.log -Xloggc:$DORIS_HOME/log/be.gc.log.$CUR_DATE -Djavax.security.auth.useSubjectCredsOnly=false -Dsun.java.command=DorisBE -XX:-CriticalJNINatives -DJDBC_MIN_POOL=1 -DJDBC_MAX_POOL=100 -DJDBC_MAX_IDLE_TIME=300000 -DJDBC_MAX_WAIT_TIME=5000"\n\n    # For jdk 9+, this JAVA_OPTS will be used as default JVM options\n    JAVA_OPTS_FOR_JDK_9="-Xmx1024m -DlogPath=$DORIS_HOME/log/jni.log -Xlog:gc:$DORIS_HOME/log/be.gc.log.$CUR_DATE -Djavax.security.auth.useSubjectCredsOnly=false -Dsun.java.command=DorisBE -XX:-CriticalJNINatives -DJDBC_MIN_POOL=1 -DJDBC_MAX_POOL=100 -DJDBC_MAX_IDLE_TIME=300000 -DJDBC_MAX_WAIT_TIME=5000"\n\n    # since 1.2, the JAVA_HOME need to be set to run BE process.\n    # JAVA_HOME=/path/to/jdk/\n\n    # https://github.com/apache/doris/blob/master/docs/zh-CN/community/developer-guide/debug-tool.md#jemalloc-heap-profile\n    # https://jemalloc.net/jemalloc.3.html\n    JEMALLOC_CONF="percpu_arena:percpu,background_thread:true,metadata_thp:auto,muzzy_decay_ms:15000,dirty_decay_ms:15000,oversize_threshold:0,lg_tcache_max:20,prof:false,lg_prof_interval:32,lg_prof_sample:19,prof_gdump:false,prof_accum:false,prof_leak:false,prof_final:false"\n    JEMALLOC_PROF_PRFIX=""\n\n    # INFO, WARNING, ERROR, FATAL\n    sys_log_level = INFO\n\n    # ports for admin, web, heartbeat service\n    be_port = 9060\n    webserver_port = 8040\n    heartbeat_service_port = 9050\n    brpc_port = 8060\n    \n    storage_root_path = /opt/apache-doris/be/storage,medium:ssd;/opt/apache-doris/be/storage1,medium:ssd\n'})}),"\n",(0,a.jsxs)(n.admonition,{title:"\u6CE8\u610F",type:"caution",children:[(0,a.jsx)(n.p,{children:"\u5728\u521B\u5EFA BE ConfigMap \u65F6\uFF0C\u9700\u8981\u6CE8\u610F\u4EE5\u4E0B\u4E8B\u9879\uFF1A"}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"metadata.name \u9700\u8981\u4E0E DorisCluster CR \u4E2D beSpec.configMapInfo.configMapName \u76F8\u540C\uFF0C\u8868\u793A\u8BE5\u96C6\u7FA4\u4F7F\u7528\u6307\u5B9A\u7684 ConfigMap\uFF1B"}),"\n",(0,a.jsx)(n.li,{children:"ConfigMap \u4E2D\u7684 storage_root_path \u53C2\u6570\u8981\u4E0E DorisCluster CR \u4E2D\u7684 persistentVolume \u6570\u636E\u76D8\u4E00\u4E00\u5BF9\u5E94\u3002"}),"\n"]})]})]})}function p(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return l},a:function(){return i}});var o=s(667294);let a={},r=o.createContext(a);function i(e){let n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);