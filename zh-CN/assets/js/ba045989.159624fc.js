"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["797418"],{378119:function(e,s,r){r.r(s),r.d(s,{default:()=>u,frontMatter:()=>l,metadata:()=>o,assets:()=>i,toc:()=>d,contentTitle:()=>c});var o=JSON.parse('{"id":"install/cluster-deployment/k8s-deploy/operator-deploy","title":"Deploy Doris on Kubernetes","description":"Doris-Operator is software extension to Kubernetes that make use of custom resource to manage Doris and it components. It provides DorisCluster a Kubernetes CustomResourceDefinition for user to custom resource.","source":"@site/versioned_docs/version-2.0/install/cluster-deployment/k8s-deploy/operator-deploy.md","sourceDirName":"install/cluster-deployment/k8s-deploy","slug":"/install/cluster-deployment/k8s-deploy/operator-deploy","permalink":"/zh-CN/docs/2.0/install/cluster-deployment/k8s-deploy/operator-deploy","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"Deploy Doris on Kubernetes","language":"en"}}'),n=r("785893"),t=r("250065");let l={title:"Deploy Doris on Kubernetes",language:"en"},c=void 0,i={},d=[{value:"Deploy Doris on Kubernetes",id:"deploy-doris-on-kubernetes",level:2},{value:"Start Kubernetes",id:"start-kubernetes",level:3},{value:"Deploy Doris-Operator on Kubernetes",id:"deploy-doris-operator-on-kubernetes",level:3},{value:"Start Doris on Kubernetes",id:"start-doris-on-kubernetes",level:3},{value:"Use Doris Cluster",id:"use-doris-cluster",level:3}];function a(e){let s={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(s.p,{children:["Doris-Operator is software extension to Kubernetes that make use of custom resource to manage Doris and it components. It provides ",(0,n.jsx)(s.a,{href:"https://github.com/apache/doris-operator/blob/master/config/crd/bases/doris.selectdb.com_dorisclusters.yaml",children:"DorisCluster"})," a Kubernetes ",(0,n.jsx)(s.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/extend-resources/custom-resource-definition-v1/",children:"CustomResourceDefinition"})," for user to custom resource."]}),"\n",(0,n.jsx)(s.h2,{id:"deploy-doris-on-kubernetes",children:"Deploy Doris on Kubernetes"}),"\n",(0,n.jsx)(s.h3,{id:"start-kubernetes",children:"Start Kubernetes"}),"\n",(0,n.jsx)(s.p,{children:"Having a Kubernetes environment is the premise to deploy Doris on Kubernetes. If you already have it, please ignore this step.\nHosted Kubernetes on cloud platform or set-up by yourself are all good choice."}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Hosted EKS"})}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["Check that the following ",(0,n.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html",children:"command-line"})," tools are installed in your environment:"]}),"\n"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Install and configure AWS command-line tool AWS CLI."}),"\n",(0,n.jsx)(s.li,{children:"Install EKS cluster command-line tool eksctl."}),"\n",(0,n.jsx)(s.li,{children:"Install Kubernetes cluster command-line tool kubectl."}),"\n"]}),"\n",(0,n.jsxs)(s.ol,{start:"2",children:["\n",(0,n.jsx)(s.li,{children:"Use one of the following methods to create an EKS cluster:"}),"\n"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html",children:"Use eksctl to quickly create an EKS cluster"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/getting-started-console.html",children:"Manually create an EKS cluster with the AWS console and AWS CLI"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Hosted GKE"}),(0,n.jsx)(s.br,{}),"\nComplete all the ",(0,n.jsx)(s.a,{href:"https://cloud.google.com/kubernetes-engine/docs/deploy-app-cluster#before-you-begin",children:"prerequisites"})," when ",(0,n.jsx)(s.a,{href:"https://cloud.google.com/kubernetes-engine/docs/deploy-app-cluster#create_cluster",children:"create a GKE cluster"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Create as Kubernetes recommend"}),(0,n.jsx)(s.br,{}),"\nKubernetes official documents recommends some ways to set up Kubernetes, as ",(0,n.jsx)(s.a,{href:"https://minikube.sigs.k8s.io/docs/start/",children:"minikube"}),",",(0,n.jsx)(s.a,{href:"https://kops.sigs.k8s.io/",children:"kOps"}),"."]}),"\n",(0,n.jsx)(s.h3,{id:"deploy-doris-operator-on-kubernetes",children:"Deploy Doris-Operator on Kubernetes"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsxs)(s.strong,{children:["1. Apply the ",(0,n.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#customresourcedefinitions",children:"Custom Resource Definition(CRD)"})]})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"kubectl apply -f https://raw.githubusercontent.com/apache/doris-operator/master/config/crd/bases/doris.selectdb.com_dorisclusters.yaml    \n"})}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"2. Install Doris-Operator"}),(0,n.jsx)(s.br,{}),"\nIf you want to use the defaults operator resource:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"kubectl apply -f https://raw.githubusercontent.com/apache/doris-operator/master/config/operator/operator.yaml\n"})}),"\n",(0,n.jsxs)(s.p,{children:["The user defined deployment in github repo are simply:",(0,n.jsx)(s.br,{}),"\nInstead of using the command below, apply your local version of the Operator manifest to the cluster when you custom operator resource."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"kubectl apply -f operator.yaml  \n"})}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"3. Validate The Operator is Running"}),(0,n.jsx)(s.br,{}),"\nUsing the command ",(0,n.jsx)(s.code,{children:"kubectl -n {namespace} get pods"})," get the status of deployed operator."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:" kubectl -n doris get pods\n NAME                              READY   STATUS    RESTARTS        AGE\n doris-operator-5b9f7f57bf-tsvjz   1/1     Running   66 (164m ago)   6d22h\n"})}),"\n",(0,n.jsxs)(s.p,{children:["Expected result, the Pod ",(0,n.jsx)(s.code,{children:"STATUS"})," is ",(0,n.jsx)(s.code,{children:"Running"})," and all containers in Pod are all ",(0,n.jsx)(s.code,{children:"READY"}),"."]}),"\n",(0,n.jsx)(s.h3,{id:"start-doris-on-kubernetes",children:"Start Doris on Kubernetes"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"1. Initialize Doris Cluster"}),(0,n.jsx)(s.br,{}),"\nUser can directly deploy Doris by ",(0,n.jsx)(s.a,{href:"https://github.com/apache/doris-operator/tree/master/doc/examples",children:"examples"})," provided by Doris-Operator. Below is the command:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"kubectl apply -f https://raw.githubusercontent.com/apache/doris-operator/master/doc/examples/doriscluster-sample.yaml  \n"})}),"\n",(0,n.jsxs)(s.p,{children:["Or download ",(0,n.jsx)(s.a,{href:"https://github.com/apache/doris-operator/tree/master/doc/examples/doriscluster-sample.yaml",children:"doriscluster-sample"})," a custom resource that tells the Operator how to configure the Kubernetes cluster, and custom resource as ",(0,n.jsx)(s.a,{href:"https://github.com/apache/doris-operator/blob/master/doc/api.md",children:"api.md"})," and\n",(0,n.jsx)(s.a,{href:"https://github.com/aapche/doris-operator/tree/master/doc/how_to_use.md",children:"how_to_use"})," docs. Instead of using the command below, apply the customized resource."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"kubeectl apply -f doriscluster-sample.yaml  \n"})}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"2. Validate Doris Cluster Status"}),(0,n.jsx)(s.br,{}),"\nUsing the command ",(0,n.jsx)(s.code,{children:"kubectl -n {namespace} get pods"})," check pods status."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"kubectl get pods\n  NAME                       READY   STATUS    RESTARTS   AGE\n  doriscluster-sample-fe-0   1/1     Running   0          20m\n  doriscluster-sample-be-0   1/1     Running   0          19m\n"})}),"\n",(0,n.jsxs)(s.p,{children:["All Pods created by DorisCluster resource should be in ",(0,n.jsx)(s.code,{children:"Running"})," STATUS, and each pod's containers should be ",(0,n.jsx)(s.code,{children:"RREADY"}),"."]}),"\n",(0,n.jsx)(s.h3,{id:"use-doris-cluster",children:"Use Doris Cluster"}),"\n",(0,n.jsxs)(s.p,{children:["On kubernetes Doris-Operator provide ",(0,n.jsx)(s.code,{children:"Service"})," a resource build in kubernetes for access to Doris."]}),"\n",(0,n.jsxs)(s.p,{children:["The command ",(0,n.jsx)(s.code,{children:'kubectl -n {namespace} get svc -l "app.doris.ownerreference/name={dorisCluster.Name}"'})," used to get ",(0,n.jsx)(s.code,{children:"service"})," created by Doris-Operator. ",(0,n.jsx)(s.code,{children:"dorisCluster.Nmae"})," is the name of DorisCluster resource deployed by step 1."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:'kubectl -n default get svc -l "app.doris.ownerreference/name=doriscluster-sample"\nNAME                              TYPE        CLUSTER-IP       EXTERNAL-IP                                           PORT(S)                               AGE\ndoriscluster-sample-fe-internal   ClusterIP   None             <none>                                                9030/TCP                              30m\ndoriscluster-sample-fe-service    ClusterIP   10.152.183.37    a7509284bf3784983a596c6eec7fc212-618xxxxxx.com        8030/TCP,9020/TCP,9030/TCP,9010/TCP   30m\ndoriscluster-sample-be-internal   ClusterIP   None             <none>                                                9050/TCP                              29m\ndoriscluster-sample-be-service    ClusterIP   10.152.183.141   <none>                                                9060/TCP,8040/TCP,9050/TCP,8060/TCP   29m\n'})}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Use SQL Client for Access"}),(0,n.jsx)(s.br,{}),"\nService created by Doris-Operator have two types, suffix is ",(0,n.jsx)(s.code,{children:"-internal"})," or ",(0,n.jsx)(s.code,{children:"-service"}),". Service have the ",(0,n.jsx)(s.code,{children:"-internal"})," suffix for communicating in Doris components, Service have ",(0,n.jsx)(s.code,{children:"-service"})," suffix for user to access."]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:["In Kubernetes",(0,n.jsx)(s.br,{}),"\nIn kubernetes, Using ",(0,n.jsx)(s.code,{children:"CLUSTER-IP"}),"  is recommended. For example, the fe service's ",(0,n.jsx)(s.code,{children:"CLUSTER-IP"}),"  is ",(0,n.jsx)(s.code,{children:"10.152.183.37"})," that displayed by above command. Using below command to access fe service."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"mysql -h 10.152.183.37 -uroot -P9030\n"})}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:["Out Kubernetes",(0,n.jsx)(s.br,{}),"\nUsing ",(0,n.jsx)(s.code,{children:"EXTERNAL-IP"})," to access fe from Kubernetes external. In default, Doris-Operator not provided ",(0,n.jsx)(s.code,{children:"EXTERNAL-IP"})," mode. If you want to use ",(0,n.jsx)(s.code,{children:"EXTERNAL-IP"}),", should custom resource ",(0,n.jsx)(s.code,{children:"Service"})," field, reference the doc ",(0,n.jsx)(s.a,{href:"https://github.com/selectdb/doris-operator/blob/master/doc/api.md",children:"api.md"})," to deploy."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.admonition,{type:"tip",children:(0,n.jsxs)(s.p,{children:["If the doc not cover your requirements, Pleaser reference the docs ",(0,n.jsx)(s.a,{href:"https://github.com/selectdb/doris-operator/tree/master/doc/how_to_use.md",children:"how_to_use.md"})," and ",(0,n.jsx)(s.a,{href:"https://github.com/selectdb/doris-operator/blob/master/doc/api.md",children:"api.md"})," to custom ",(0,n.jsx)(s.code,{children:"DorisCluster"})," resource to deploy."]})})]})}function u(e={}){let{wrapper:s}={...(0,t.a)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},250065:function(e,s,r){r.d(s,{Z:function(){return c},a:function(){return l}});var o=r(667294);let n={},t=o.createContext(n);function l(e){let s=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),o.createElement(t.Provider,{value:s},e.children)}}}]);