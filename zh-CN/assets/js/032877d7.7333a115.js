"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["256546"],{61264:function(e,s,n){n.r(s),n.d(s,{default:()=>h,frontMatter:()=>c,metadata:()=>i,assets:()=>a,toc:()=>t,contentTitle:()=>o});var i=JSON.parse('{"id":"lakehouse/best-practices/doris-nessie","title":"\u96C6\u6210 Nessie","description":"\u672C\u6587\u5C06\u5E26\u60A8\u4E86\u89E3\u5982\u4F55\u5C06 Apache Doris \u4E0E Nessie \u96C6\u6210\uFF0C\u5B9E\u73B0\u5BF9 Iceberg \u6570\u636E\u7684\u9AD8\u6548\u67E5\u8BE2\u548C\u7BA1\u7406\u3002\u6211\u4EEC\u5C06\u9010\u6B65\u5E26\u60A8\u5B8C\u6210\u4ECE\u73AF\u5883\u51C6\u5907\u5230\u6700\u7EC8\u67E5\u8BE2\u7684\u6574\u4E2A\u8FC7\u7A0B\u3002","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-3.x/lakehouse/best-practices/doris-nessie.md","sourceDirName":"lakehouse/best-practices","slug":"/lakehouse/best-practices/doris-nessie","permalink":"/zh-CN/docs/3.x/lakehouse/best-practices/doris-nessie","draft":false,"unlisted":false,"tags":[],"version":"3.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"\u96C6\u6210 Nessie","language":"zh-CN","description":"\u672C\u6587\u5C06\u5E26\u60A8\u4E86\u89E3\u5982\u4F55\u5C06 Apache Doris \u4E0E Nessie \u96C6\u6210\uFF0C\u5B9E\u73B0\u5BF9 Iceberg \u6570\u636E\u7684\u9AD8\u6548\u67E5\u8BE2\u548C\u7BA1\u7406\u3002\u6211\u4EEC\u5C06\u9010\u6B65\u5E26\u60A8\u5B8C\u6210\u4ECE\u73AF\u5883\u51C6\u5907\u5230\u6700\u7EC8\u67E5\u8BE2\u7684\u6574\u4E2A\u8FC7\u7A0B\u3002"},"sidebar":"docs","previous":{"title":"\u96C6\u6210 Lakekeeper","permalink":"/zh-CN/docs/3.x/lakehouse/best-practices/doris-lakekeeper"},"next":{"title":"\u96C6\u6210\u963F\u91CC\u4E91 DLF Rest Catalog","permalink":"/zh-CN/docs/3.x/lakehouse/best-practices/doris-dlf-paimon"}}'),r=n("785893"),l=n("250065");let c={title:"\u96C6\u6210 Nessie",language:"zh-CN",description:"\u672C\u6587\u5C06\u5E26\u60A8\u4E86\u89E3\u5982\u4F55\u5C06 Apache Doris \u4E0E Nessie \u96C6\u6210\uFF0C\u5B9E\u73B0\u5BF9 Iceberg \u6570\u636E\u7684\u9AD8\u6548\u67E5\u8BE2\u548C\u7BA1\u7406\u3002\u6211\u4EEC\u5C06\u9010\u6B65\u5E26\u60A8\u5B8C\u6210\u4ECE\u73AF\u5883\u51C6\u5907\u5230\u6700\u7EC8\u67E5\u8BE2\u7684\u6574\u4E2A\u8FC7\u7A0B\u3002"},o=void 0,a={},t=[{value:"1. AWS \u73AF\u5883\u51C6\u5907",id:"1-aws-\u73AF\u5883\u51C6\u5907",level:2},{value:"1.1 \u521B\u5EFA S3 \u5B58\u50A8\u6876",id:"11-\u521B\u5EFA-s3-\u5B58\u50A8\u6876",level:3},{value:"1.2 \u521B\u5EFA\u7528\u4E8E\u5BF9\u8C61\u5B58\u50A8\u8BBF\u95EE\u7684 IAM \u89D2\u8272\uFF08\u53EF\u9009\uFF09",id:"12-\u521B\u5EFA\u7528\u4E8E\u5BF9\u8C61\u5B58\u50A8\u8BBF\u95EE\u7684-iam-\u89D2\u8272\u53EF\u9009",level:3},{value:"2. Nessie \u90E8\u7F72\u548C Warehouse \u914D\u7F6E",id:"2-nessie-\u90E8\u7F72\u548C-warehouse-\u914D\u7F6E",level:2},{value:"2.1 \u4F7F\u7528 Docker Compose \u90E8\u7F72 Nessie\uFF08Credential Vending \u6A21\u5F0F\uFF09",id:"21-\u4F7F\u7528-docker-compose-\u90E8\u7F72-nessiecredential-vending-\u6A21\u5F0F",level:3},{value:"2.2 \u4F7F\u7528 Docker Compose \u90E8\u7F72 Nessie\uFF08\u9759\u6001\u51ED\u8BC1\u6A21\u5F0F\uFF09",id:"22-\u4F7F\u7528-docker-compose-\u90E8\u7F72-nessie\u9759\u6001\u51ED\u8BC1\u6A21\u5F0F",level:3},{value:"3. Doris \u8FDE\u63A5 Nessie",id:"3-doris-\u8FDE\u63A5-nessie",level:2},{value:"\u65B9\u5F0F\u4E00\uFF1A\u4E34\u65F6\u5B58\u50A8\u51ED\u8BC1\uFF08Credential Vending\uFF09",id:"\u65B9\u5F0F\u4E00\u4E34\u65F6\u5B58\u50A8\u51ED\u8BC1credential-vending",level:3},{value:"\u65B9\u5F0F\u4E8C\uFF1A\u9759\u6001\u5B58\u50A8\u51ED\u8BC1\uFF08AK/SK\uFF09",id:"\u65B9\u5F0F\u4E8C\u9759\u6001\u5B58\u50A8\u51ED\u8BC1aksk",level:3},{value:"4. \u5728 Doris \u4E2D\u9A8C\u8BC1\u8FDE\u63A5",id:"4-\u5728-doris-\u4E2D\u9A8C\u8BC1\u8FDE\u63A5",level:2}];function d(e){let s={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.a,{href:"https://projectnessie.org/",children:"Nessie"})," \u662F\u4E00\u4E2A\u5F00\u6E90\u7684\u6570\u636E\u6E56\u4E8B\u52A1\u76EE\u5F55\uFF0C\u4E3A\u60A8\u7684\u6570\u636E\u63D0\u4F9B\u7C7B\u4F3C Git \u7684\u7248\u672C\u63A7\u5236\u529F\u80FD\u3002\u5B83\u5B9E\u73B0\u4E86 Iceberg REST Catalog \u89C4\u8303\uFF0C\u652F\u6301\u8DE8\u591A\u79CD\u8868\u683C\u5F0F\uFF08\u5305\u62EC Apache Iceberg\uFF09\u7684\u5206\u652F\u3001\u6807\u7B7E\u548C\u65F6\u95F4\u65C5\u884C\u7B49\u529F\u80FD\u3002"]}),"\n",(0,r.jsx)(s.p,{children:"\u672C\u6587\u5C06\u5E26\u60A8\u4E86\u89E3\u5982\u4F55\u5C06 Apache Doris \u4E0E Nessie \u96C6\u6210\uFF0C\u5B9E\u73B0\u5BF9 Iceberg \u6570\u636E\u7684\u9AD8\u6548\u67E5\u8BE2\u548C\u7BA1\u7406\u3002\u6211\u4EEC\u5C06\u9010\u6B65\u5E26\u60A8\u5B8C\u6210\u4ECE\u73AF\u5883\u51C6\u5907\u5230\u6700\u7EC8\u67E5\u8BE2\u7684\u6574\u4E2A\u8FC7\u7A0B\u3002"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"\u901A\u8FC7\u672C\u6587\u6863\uFF0C\u60A8\u5C06\u5B66\u4E60\uFF1A"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"AWS \u73AF\u5883\u51C6\u5907"}),"\uFF1A\u5982\u4F55\u5728 AWS \u4E2D\u521B\u5EFA\u548C\u914D\u7F6E S3 \u5B58\u50A8\u6876\uFF0C\u5E76\u4E3A Nessie \u51C6\u5907\u5FC5\u8981\u7684 IAM \u89D2\u8272\u548C\u7B56\u7565\uFF0C\u4F7F Nessie \u80FD\u591F\u8BBF\u95EE S3 \u5E76\u5411 Doris \u5206\u53D1\u8BBF\u95EE\u51ED\u8BC1\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Nessie \u90E8\u7F72\u548C\u914D\u7F6E"}),"\uFF1A\u5982\u4F55\u4F7F\u7528 Docker Compose \u90E8\u7F72 Nessie \u670D\u52A1\uFF0C\u5E76\u914D\u7F6E Warehouse \u4E3A Doris \u63D0\u4F9B\u5143\u6570\u636E\u8BBF\u95EE\u7AEF\u70B9\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Doris \u8FDE\u63A5 Nessie"}),"\uFF1A\u5982\u4F55\u4F7F\u7528 Doris \u901A\u8FC7 Nessie \u8BBF\u95EE Iceberg \u6570\u636E\u8FDB\u884C\u8BFB\u5199\u64CD\u4F5C\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"1-aws-\u73AF\u5883\u51C6\u5907",children:"1. AWS \u73AF\u5883\u51C6\u5907"}),"\n",(0,r.jsx)(s.p,{children:"\u5728\u5F00\u59CB\u4E4B\u524D\uFF0C\u6211\u4EEC\u9700\u8981\u5728 AWS \u4E0A\u51C6\u5907 S3 \u5B58\u50A8\u6876\u548C\u76F8\u5E94\u7684 IAM \u89D2\u8272\uFF0C\u8FD9\u662F Nessie \u7BA1\u7406\u6570\u636E\u548C Doris \u8BBF\u95EE\u6570\u636E\u7684\u57FA\u7840\u3002"}),"\n",(0,r.jsx)(s.h3,{id:"11-\u521B\u5EFA-s3-\u5B58\u50A8\u6876",children:"1.1 \u521B\u5EFA S3 \u5B58\u50A8\u6876"}),"\n",(0,r.jsxs)(s.p,{children:["\u9996\u5148\uFF0C\u6211\u4EEC\u521B\u5EFA\u4E00\u4E2A\u540D\u4E3A ",(0,r.jsx)(s.code,{children:"nessie-doris-demo"})," \u7684 S3 \u5B58\u50A8\u6876\uFF0C\u7528\u4E8E\u5B58\u50A8\u7A0D\u540E\u5C06\u521B\u5EFA\u7684 Iceberg \u8868\u6570\u636E\u3002"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# \u521B\u5EFA S3 \u5B58\u50A8\u6876\naws s3 mb s3://nessie-doris-demo --region us-east-1\n# \u9A8C\u8BC1\u5B58\u50A8\u6876\u521B\u5EFA\u6210\u529F\naws s3 ls | grep nessie-doris-demo\n"})}),"\n",(0,r.jsx)(s.h3,{id:"12-\u521B\u5EFA\u7528\u4E8E\u5BF9\u8C61\u5B58\u50A8\u8BBF\u95EE\u7684-iam-\u89D2\u8272\u53EF\u9009",children:"1.2 \u521B\u5EFA\u7528\u4E8E\u5BF9\u8C61\u5B58\u50A8\u8BBF\u95EE\u7684 IAM \u89D2\u8272\uFF08\u53EF\u9009\uFF09"}),"\n",(0,r.jsx)(s.p,{children:"\u5982\u679C\u60A8\u8BA1\u5212\u4F7F\u7528 Credential Vending \u6A21\u5F0F\uFF0C\u9700\u8981\u521B\u5EFA\u4E00\u4E2A IAM \u89D2\u8272\u4F9B Nessie \u901A\u8FC7 STS AssumeRole \u673A\u5236\u4F7F\u7528\u3002\u8FD9\u79CD\u8BBE\u8BA1\u9075\u5FAA\u6700\u5C0F\u6743\u9650\u539F\u5219\u548C\u804C\u8D23\u5206\u79BB\u7684\u5B89\u5168\u6700\u4F73\u5B9E\u8DF5\u3002"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"\u521B\u5EFA\u4FE1\u4EFB\u7B56\u7565\u6587\u4EF6"}),"\n",(0,r.jsxs)(s.p,{children:["\u521B\u5EFA ",(0,r.jsx)(s.code,{children:"nessie-trust-policy.json"})," \u6587\u4EF6\uFF1A"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'cat > nessie-trust-policy.json << \'EOF\'\n{\n    "Version": "2012-10-17",\n    "Statement": [\n    {\n        "Effect": "Allow",\n        "Principal": {\n            "AWS": "arn:aws:iam::YOUR_ACCOUNT_ID:user/YOUR_USER"\n        },\n        "Action": "sts:AssumeRole"\n    }\n    ]\n}\nEOF\n'})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["\u6CE8\u610F\uFF1A\u8BF7\u5C06 YOUR_ACCOUNT_ID \u66FF\u6362\u4E3A\u60A8\u7684\u5B9E\u9645 AWS \u8D26\u6237 ID\uFF0C\u53EF\u901A\u8FC7 ",(0,r.jsx)(s.code,{children:"aws sts get-caller-identity --query Account --output text"})," \u83B7\u53D6\u3002\u5C06 YOUR_USER \u66FF\u6362\u4E3A\u5B9E\u9645\u7684 IAM \u7528\u6237\u540D\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"\u521B\u5EFA IAM \u89D2\u8272"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'aws iam create-role \\\n    --role-name nessie-sts-role \\\n    --assume-role-policy-document file://nessie-trust-policy.json \\\n    --description "IAM Role for Nessie to access S3 storage"\n'})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"\u9644\u52A0 S3 \u8BBF\u95EE\u6743\u9650\u7B56\u7565"}),"\n",(0,r.jsxs)(s.p,{children:["\u521B\u5EFA ",(0,r.jsx)(s.code,{children:"nessie-s3-policy.json"})," \u6587\u4EF6\uFF1A"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'cat > nessie-s3-policy.json << \'EOF\'\n{\n    "Version": "2012-10-17",\n    "Statement": [{\n        "Effect": "Allow",\n        "Action": [\n            "s3:ListBucket",\n            "s3:GetBucketLocation",\n            "s3:ListBucketMultipartUploads",\n            "s3:ListMultipartUploadParts",\n            "s3:AbortMultipartUpload",\n            "s3:GetObject",\n            "s3:PutObject",\n            "s3:DeleteObject"\n        ],\n        "Resource": [\n            "arn:aws:s3:::nessie-doris-demo",\n            "arn:aws:s3:::nessie-doris-demo/*"\n        ]\n    }]\n}\nEOF\n'})}),"\n",(0,r.jsx)(s.p,{children:"\u5C06\u7B56\u7565\u9644\u52A0\u5230\u89D2\u8272\uFF1A"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"aws iam put-role-policy \\\n    --role-name nessie-sts-role \\\n    --policy-name nessie-s3-access \\\n    --policy-document file://nessie-s3-policy.json\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"\u4E3A\u7528\u6237\u6388\u4E88 AssumeRole \u6743\u9650"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'cat > user-assume-policy.json << \'EOF\'\n{\n    "Version": "2012-10-17",\n    "Statement": [{\n        "Effect": "Allow",\n        "Action": "sts:AssumeRole",\n        "Resource": "arn:aws:iam::YOUR_ACCOUNT_ID:role/nessie-sts-role"\n    }]\n}\nEOF\n\naws iam put-user-policy \\\n    --user-name YOUR_USER \\\n    --policy-name allow-assume-nessie-role \\\n    --policy-document file://user-assume-policy.json\n'})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"\u9A8C\u8BC1\u521B\u5EFA\u7ED3\u679C"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"aws iam get-role --role-name nessie-sts-role\naws iam list-role-policies --role-name nessie-sts-role\n\n# \u9A8C\u8BC1 AssumeRole \u53EF\u7528\naws sts assume-role \\\n    --role-arn arn:aws:iam::YOUR_ACCOUNT_ID:role/nessie-sts-role \\\n    --role-session-name nessie-test\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"2-nessie-\u90E8\u7F72\u548C-warehouse-\u914D\u7F6E",children:"2. Nessie \u90E8\u7F72\u548C Warehouse \u914D\u7F6E"}),"\n",(0,r.jsx)(s.p,{children:"\u73AF\u5883\u51C6\u5907\u5B8C\u6210\u540E\uFF0C\u6211\u4EEC\u5F00\u59CB\u90E8\u7F72 Nessie \u670D\u52A1\u5E76\u914D\u7F6E Warehouse\u3002"}),"\n",(0,r.jsx)(s.h3,{id:"21-\u4F7F\u7528-docker-compose-\u90E8\u7F72-nessiecredential-vending-\u6A21\u5F0F",children:"2.1 \u4F7F\u7528 Docker Compose \u90E8\u7F72 Nessie\uFF08Credential Vending \u6A21\u5F0F\uFF09"}),"\n",(0,r.jsxs)(s.p,{children:["\u8FD9\u662F",(0,r.jsx)(s.strong,{children:"\u6700\u63A8\u8350"}),"\u7684\u90E8\u7F72\u65B9\u5F0F\uFF0C\u901A\u8FC7\u4E34\u65F6\u51ED\u8BC1\u589E\u5F3A\u5B89\u5168\u6027\u3002"]}),"\n",(0,r.jsxs)(s.p,{children:["\u521B\u5EFA ",(0,r.jsx)(s.code,{children:".env"})," \u6587\u4EF6\u5B58\u50A8 AWS \u51ED\u8BC1\uFF1A"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"AWS_ACCESS_KEY_ID=YOUR_ACCESS_KEY\nAWS_SECRET_ACCESS_KEY=YOUR_SECRET_KEY\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\u521B\u5EFA ",(0,r.jsx)(s.code,{children:"docker-compose.yml"})," \u6587\u4EF6\uFF1A"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'version: "3.8"\n\nservices:\n  postgres:\n    image: postgres:16\n    environment:\n      POSTGRES_DB: nessie\n      POSTGRES_USER: nessie\n      POSTGRES_PASSWORD: nessie\n    ports:\n      - "5432:5432"\n    volumes:\n      - pgdata:/var/lib/postgresql/data\n\n  nessie:\n    image: ghcr.io/projectnessie/nessie:0.106.0-java\n    depends_on:\n      - postgres\n    ports:\n      - "19120:19120"\n    environment:\n      JAVA_OPTS_APPEND: >-\n        -Dnessie.version.store.type=JDBC2\n        -Dnessie.version.store.persist.jdbc.datasource=postgresql\n        -Dquarkus.datasource.postgresql.jdbc.url=jdbc:postgresql://postgres:5432/nessie\n        -Dquarkus.datasource.postgresql.username=nessie\n        -Dquarkus.datasource.postgresql.password=nessie\n        -Dnessie.catalog.default-warehouse=nessie-warehouse\n        -Dnessie.catalog.warehouses.nessie-warehouse.location=s3://nessie-doris-demo/warehouse\n        -Dnessie.catalog.service.s3.default-options.region=us-east-1\n        -Dnessie.catalog.service.s3.default-options.auth-type=APPLICATION_GLOBAL\n        -Dnessie.catalog.service.s3.default-options.server-iam.enabled=true\n        -Dnessie.catalog.service.s3.default-options.server-iam.assume-role=arn:aws:iam::YOUR_ACCOUNT_ID:role/nessie-sts-role\n        -Dnessie.catalog.service.s3.default-options.server-iam.role-session-name=nessie-doris\n      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}\n      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}\n\nvolumes:\n  pgdata:\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Credential Vending \u5173\u952E\u914D\u7F6E\u53C2\u6570\uFF1A"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"\u53C2\u6570"}),(0,r.jsx)(s.th,{children:"\u63CF\u8FF0"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"nessie.version.store.type"})}),(0,r.jsx)(s.td,{children:"\u7248\u672C\u5B58\u50A8\u7C7B\u578B\uFF0C\u4F7F\u7528 JDBC2 \u4F5C\u4E3A PostgreSQL \u540E\u7AEF\u3002"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"nessie.catalog.default-warehouse"})}),(0,r.jsx)(s.td,{children:"\u9ED8\u8BA4 Warehouse \u540D\u79F0\u3002"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"nessie.catalog.warehouses.<name>.location"})}),(0,r.jsx)(s.td,{children:"\u5B58\u50A8 Iceberg \u8868\u6570\u636E\u7684 S3 \u4F4D\u7F6E\u3002"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"server-iam.enabled"})}),(0,r.jsxs)(s.td,{children:["\u8BBE\u7F6E\u4E3A ",(0,r.jsx)(s.code,{children:"true"})," \u4EE5\u542F\u7528 Credential Vending\u3002"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"server-iam.assume-role"})}),(0,r.jsx)(s.td,{children:"Nessie \u5C06\u7528\u4E8E\u8BBF\u95EE S3 \u7684 IAM \u89D2\u8272 ARN\u3002"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"server-iam.role-session-name"})}),(0,r.jsx)(s.td,{children:"\u89D2\u8272\u4F1A\u8BDD\u540D\u79F0\u3002"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"auth-type"})}),(0,r.jsxs)(s.td,{children:["\u8BBE\u7F6E\u4E3A ",(0,r.jsx)(s.code,{children:"APPLICATION_GLOBAL"})," \u4EE5\u4F7F\u7528\u5E94\u7528\u7A0B\u5E8F\u7EA7\u522B\u51ED\u8BC1\u3002"]})]})]})]}),"\n",(0,r.jsx)(s.p,{children:"\u542F\u52A8 Nessie\uFF1A"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker compose up -d\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\u542F\u52A8\u540E\uFF0C\u60A8\u53EF\u4EE5\u901A\u8FC7 ",(0,r.jsx)(s.code,{children:"http://YOUR_HOST_IP:19120"})," \u8BBF\u95EE Nessie API\u3002"]}),"\n",(0,r.jsx)(s.h3,{id:"22-\u4F7F\u7528-docker-compose-\u90E8\u7F72-nessie\u9759\u6001\u51ED\u8BC1\u6A21\u5F0F",children:"2.2 \u4F7F\u7528 Docker Compose \u90E8\u7F72 Nessie\uFF08\u9759\u6001\u51ED\u8BC1\u6A21\u5F0F\uFF09"}),"\n",(0,r.jsx)(s.p,{children:"\u5982\u679C\u60A8\u4E0D\u9700\u8981 Credential Vending\uFF0C\u53EF\u4EE5\u4F7F\u7528\u9759\u6001\u51ED\u8BC1\u6A21\u5F0F\u8FDB\u884C\u5FEB\u901F\u6D4B\u8BD5\uFF1A"}),"\n",(0,r.jsxs)(s.p,{children:["\u521B\u5EFA ",(0,r.jsx)(s.code,{children:".env"})," \u6587\u4EF6\u5B58\u50A8 AWS \u51ED\u8BC1\uFF1A"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"AWS_ACCESS_KEY_ID=YOUR_ACCESS_KEY\nAWS_SECRET_ACCESS_KEY=YOUR_SECRET_KEY\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\u521B\u5EFA ",(0,r.jsx)(s.code,{children:"docker-compose.yml"})," \u6587\u4EF6\uFF1A"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'version: "3.8"\n\nservices:\n  postgres:\n    image: postgres:16\n    environment:\n      POSTGRES_DB: nessie\n      POSTGRES_USER: nessie\n      POSTGRES_PASSWORD: nessie\n    ports:\n      - "5432:5432"\n    volumes:\n      - pgdata:/var/lib/postgresql/data\n\n  nessie:\n    image: ghcr.io/projectnessie/nessie:0.106.0-java\n    depends_on:\n      - postgres\n    ports:\n      - "19120:19120"\n    environment:\n      JAVA_OPTS_APPEND: >-\n        -Dnessie.version.store.type=JDBC2\n        -Dnessie.version.store.persist.jdbc.datasource=postgresql\n        -Dquarkus.datasource.postgresql.jdbc.url=jdbc:postgresql://postgres:5432/nessie\n        -Dquarkus.datasource.postgresql.username=nessie\n        -Dquarkus.datasource.postgresql.password=nessie\n\n        -Dnessie.catalog.default-warehouse=nessie-warehouse\n        -Dnessie.catalog.warehouses.nessie-warehouse.location=s3://nessie-doris-demo/warehouse\n\n        -Dnessie.catalog.service.s3.default-options.region=us-east-1\n        -Dnessie.catalog.service.s3.default-options.access-key=urn:nessie-secret:quarkus:my-secrets-default\n        -Dmy-secrets-default.name=${AWS_ACCESS_KEY_ID}\n        -Dmy-secrets-default.secret=${AWS_SECRET_ACCESS_KEY}\n\n    env_file:\n      - .env\n\nvolumes:\n  pgdata:\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"\u5173\u952E\u914D\u7F6E\u53C2\u6570\uFF1A"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"\u53C2\u6570"}),(0,r.jsx)(s.th,{children:"\u63CF\u8FF0"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"nessie.version.store.type"})}),(0,r.jsx)(s.td,{children:"\u7248\u672C\u5B58\u50A8\u7C7B\u578B\uFF0C\u4F7F\u7528 JDBC2 \u4F5C\u4E3A PostgreSQL \u540E\u7AEF\u3002"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"nessie.catalog.default-warehouse"})}),(0,r.jsx)(s.td,{children:"\u9ED8\u8BA4 Warehouse \u540D\u79F0\u3002"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"nessie.catalog.warehouses.<name>.location"})}),(0,r.jsx)(s.td,{children:"\u5B58\u50A8 Iceberg \u8868\u6570\u636E\u7684 S3 \u4F4D\u7F6E\u3002"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"nessie.catalog.service.s3.default-options.region"})}),(0,r.jsx)(s.td,{children:"S3 \u5B58\u50A8\u6876\u7684 AWS \u533A\u57DF\u3002"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"3-doris-\u8FDE\u63A5-nessie",children:"3. Doris \u8FDE\u63A5 Nessie"}),"\n",(0,r.jsx)(s.p,{children:"\u73B0\u5728\uFF0C\u6211\u4EEC\u5C06\u5728 Doris \u4E2D\u521B\u5EFA\u4E00\u4E2A\u8FDE\u63A5\u5230 Nessie \u670D\u52A1\u7684 Iceberg Catalog\u3002"}),"\n",(0,r.jsx)(s.h3,{id:"\u65B9\u5F0F\u4E00\u4E34\u65F6\u5B58\u50A8\u51ED\u8BC1credential-vending",children:"\u65B9\u5F0F\u4E00\uFF1A\u4E34\u65F6\u5B58\u50A8\u51ED\u8BC1\uFF08Credential Vending\uFF09"}),"\n",(0,r.jsxs)(s.p,{children:["\u8FD9\u662F",(0,r.jsx)(s.strong,{children:"\u6700\u63A8\u8350"}),"\u7684\u65B9\u5F0F\u3002\u5F53\u9700\u8981\u5728 S3 \u4E0A\u8BFB\u5199\u6570\u636E\u6587\u4EF6\u65F6\uFF0CDoris \u4F1A\u4ECE Nessie \u8BF7\u6C42\u4E00\u4E2A\u4E34\u65F6\u7684\u3001\u6700\u5C0F\u6743\u9650\u7684 S3 \u8BBF\u95EE\u51ED\u8BC1\u3002"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"CREATE CATALOG nessie_vc PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://YOUR_NESSIE_HOST:19120/iceberg/main',\n    'warehouse' = 'nessie-warehouse',\n    's3.endpoint' = 'https://s3.us-east-1.amazonaws.com',\n    's3.region' = 'us-east-1',\n    -- \u542F\u7528 credential vending\n    'iceberg.rest.vended-credentials-enabled' = 'true'\n);\n"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["\u6CE8\u610F\uFF1ANessie REST Catalog URI \u683C\u5F0F\u4E3A ",(0,r.jsx)(s.code,{children:"http://HOST:PORT/iceberg/{branch}"}),"\uFF0C\u5176\u4E2D ",(0,r.jsx)(s.code,{children:"main"})," \u662F\u9ED8\u8BA4\u5206\u652F\u540D\u79F0\u3002"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"\u65B9\u5F0F\u4E8C\u9759\u6001\u5B58\u50A8\u51ED\u8BC1aksk",children:"\u65B9\u5F0F\u4E8C\uFF1A\u9759\u6001\u5B58\u50A8\u51ED\u8BC1\uFF08AK/SK\uFF09"}),"\n",(0,r.jsx)(s.p,{children:"\u5728\u8FD9\u79CD\u65B9\u5F0F\u4E2D\uFF0CDoris \u76F4\u63A5\u4F7F\u7528\u914D\u7F6E\u4E2D\u786C\u7F16\u7801\u7684\u9759\u6001 AK/SK \u8BBF\u95EE\u5BF9\u8C61\u5B58\u50A8\u3002\u8FD9\u79CD\u65B9\u6CD5\u914D\u7F6E\u7B80\u5355\uFF0C\u9002\u5408\u5FEB\u901F\u6D4B\u8BD5\uFF0C\u4F46\u5B89\u5168\u6027\u8F83\u4F4E\u3002"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"CREATE CATALOG nessie_static PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://YOUR_NESSIE_HOST:19120/iceberg/main',\n    'warehouse' = 'nessie-warehouse',\n    -- \u76F4\u63A5\u63D0\u4F9B S3 \u8BBF\u95EE\u5BC6\u94A5\n    's3.access_key' = 'YOUR_ACCESS_KEY',\n    's3.secret_key' = 'YOUR_SECRET_KEY',\n    's3.endpoint' = 'https://s3.us-east-1.amazonaws.com',\n    's3.region' = 'us-east-1'\n);\n"})}),"\n",(0,r.jsx)(s.h2,{id:"4-\u5728-doris-\u4E2D\u9A8C\u8BC1\u8FDE\u63A5",children:"4. \u5728 Doris \u4E2D\u9A8C\u8BC1\u8FDE\u63A5"}),"\n",(0,r.jsx)(s.p,{children:"\u65E0\u8BBA\u60A8\u4F7F\u7528\u54EA\u79CD\u65B9\u5F0F\u521B\u5EFA Catalog\uFF0C\u90FD\u53EF\u4EE5\u901A\u8FC7\u4EE5\u4E0B SQL \u9A8C\u8BC1\u7AEF\u5230\u7AEF\u8FDE\u63A5\u3002"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"-- \u5207\u6362\u5230 Catalog\nUSE nessie_vc;\n\n-- \u521B\u5EFA\u547D\u540D\u7A7A\u95F4\uFF08\u6570\u636E\u5E93\uFF09\nCREATE DATABASE demo;\nUSE demo;\n\n-- \u521B\u5EFA Iceberg \u8868\nCREATE TABLE my_iceberg_table (\n  id INT,\n  name STRING\n)\nPROPERTIES (\n  'write-format'='parquet'\n);\n\n-- \u63D2\u5165\u6570\u636E\nINSERT INTO my_iceberg_table VALUES (1, 'alice'), (2, 'bob');\n\n-- \u67E5\u8BE2\u6570\u636E\nSELECT * FROM my_iceberg_table;\n-- \u9884\u671F\u7ED3\u679C\uFF1A\n-- +------+-------+\n-- | id   | name  |\n-- +------+-------+\n-- | 1    | alice |\n-- | 2    | bob   |\n-- +------+-------+\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u5982\u679C\u4EE5\u4E0A\u6240\u6709\u64CD\u4F5C\u90FD\u6210\u529F\u5B8C\u6210\uFF0C\u606D\u559C\u60A8\uFF01\u60A8\u5DF2\u6210\u529F\u5EFA\u7ACB\u5B8C\u6574\u7684\u6570\u636E\u6E56\u7BA1\u9053\uFF1ADoris -> Nessie -> S3\u3002"}),"\n",(0,r.jsx)(s.p,{children:"\u6709\u5173\u4F7F\u7528 Doris \u7BA1\u7406 Iceberg \u8868\u7684\u66F4\u591A\u4FE1\u606F\uFF0C\u8BF7\u8BBF\u95EE\uFF1A"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://doris.apache.org/zh-CN/docs/lakehouse/catalogs/iceberg-catalog",children:"https://doris.apache.org/zh-CN/docs/lakehouse/catalogs/iceberg-catalog"})})]})}function h(e={}){let{wrapper:s}={...(0,l.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},250065:function(e,s,n){n.d(s,{Z:function(){return o},a:function(){return c}});var i=n(667294);let r={},l=i.createContext(r);function c(e){let s=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(l.Provider,{value:s},e.children)}}}]);