"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["932398"],{662122:function(n,r,e){e.r(r),e.d(r,{default:()=>h,frontMatter:()=>d,metadata:()=>s,assets:()=>i,toc:()=>a,contentTitle:()=>c});var s=JSON.parse('{"id":"admin-manual/workload-management/workload-group","title":"Workload Group","description":"Workload Group \u662F\u4E00\u79CD\u8FDB\u7A0B\u5185\u5B9E\u73B0\u7684\u5BF9\u8D1F\u8F7D\u8FDB\u884C\u903B\u8F91\u9694\u79BB\u7684\u673A\u5236\uFF0C\u5B83\u901A\u8FC7\u5BF9 BE \u8FDB\u7A0B\u5185\u7684\u8D44\u6E90\uFF08CPU\uFF0CIO\uFF0CMemory\uFF09\u8FDB\u884C\u7EC6\u7C92\u5EA6\u7684\u5212\u5206\u6216\u8005\u9650\u5236\uFF0C\u8FBE\u5230\u8D44\u6E90\u9694\u79BB\u7684\u76EE\u7684\uFF0C\u5B83\u7684\u539F\u7406\u5982\u4E0B\u56FE\u6240\u793A\uFF1A","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-2.1/admin-manual/workload-management/workload-group.md","sourceDirName":"admin-manual/workload-management","slug":"/admin-manual/workload-management/workload-group","permalink":"/zh-CN/docs/2.1/admin-manual/workload-management/workload-group","draft":false,"unlisted":false,"tags":[],"version":"2.1","frontMatter":{"title":"Workload Group","language":"zh-CN"},"sidebar":"docs","previous":{"title":"Resource Group","permalink":"/zh-CN/docs/2.1/admin-manual/workload-management/resource-group"},"next":{"title":"\u5DE5\u4F5C\u8D1F\u8F7D\u5206\u6790\u4E0E\u8BCA\u65AD","permalink":"/zh-CN/docs/2.1/admin-manual/workload-management/analysis-diagnosis"}}'),o=e("785893"),l=e("250065");let d={title:"Workload Group",language:"zh-CN"},c=void 0,i={},a=[{value:"\u7248\u672C\u8BF4\u660E",id:"\u7248\u672C\u8BF4\u660E",level:2},{value:"\u914D\u7F6E workload group",id:"\u914D\u7F6E-workload-group",level:2},{value:"\u914D\u7F6E CGroup \u73AF\u5883",id:"\u914D\u7F6E-cgroup-\u73AF\u5883",level:3},{value:"\u5728\u5BB9\u5668\u4E2D\u4F7F\u7528 Workload Group \u7684\u6CE8\u610F\u4E8B\u9879",id:"\u5728\u5BB9\u5668\u4E2D\u4F7F\u7528-workload-group-\u7684\u6CE8\u610F\u4E8B\u9879",level:4},{value:"\u521B\u5EFA Workload Group",id:"\u521B\u5EFA-workload-group",level:3},{value:"Workload Group \u5C5E\u6027",id:"workload-group-\u5C5E\u6027",level:3},{value:"\u4E3A\u7528\u6237\u8BBE\u7F6E Workload Group",id:"\u4E3A\u7528\u6237\u8BBE\u7F6E-workload-group",level:2},{value:"\u67E5\u770B Workload Group",id:"\u67E5\u770B-workload-group",level:2},{value:"\u4FEE\u6539 Workload Group",id:"\u4FEE\u6539-workload-group",level:2},{value:"\u5220\u9664 Workload Group",id:"\u5220\u9664-workload-group",level:2},{value:"CPU \u8F6F\u786C\u9650\u6A21\u5F0F\u5207\u6362\u7684\u8BF4\u660E",id:"cpu-\u8F6F\u786C\u9650\u6A21\u5F0F\u5207\u6362\u7684\u8BF4\u660E",level:2},{value:"\u6548\u679C\u6D4B\u8BD5",id:"\u6548\u679C\u6D4B\u8BD5",level:2},{value:"\u5185\u5B58\u786C\u9650",id:"\u5185\u5B58\u786C\u9650",level:3},{value:"CPU \u786C\u9650",id:"cpu-\u786C\u9650",level:3},{value:"\u672C\u5730 IO \u786C\u9650",id:"\u672C\u5730-io-\u786C\u9650",level:3},{value:"\u8FDC\u7A0B IO \u786C\u9650",id:"\u8FDC\u7A0B-io-\u786C\u9650",level:3},{value:"\u5E38\u89C1\u95EE\u9898",id:"\u5E38\u89C1\u95EE\u9898",level:2}];function p(n){let r={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.a)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.p,{children:"Workload Group \u662F\u4E00\u79CD\u8FDB\u7A0B\u5185\u5B9E\u73B0\u7684\u5BF9\u8D1F\u8F7D\u8FDB\u884C\u903B\u8F91\u9694\u79BB\u7684\u673A\u5236\uFF0C\u5B83\u901A\u8FC7\u5BF9 BE \u8FDB\u7A0B\u5185\u7684\u8D44\u6E90\uFF08CPU\uFF0CIO\uFF0CMemory\uFF09\u8FDB\u884C\u7EC6\u7C92\u5EA6\u7684\u5212\u5206\u6216\u8005\u9650\u5236\uFF0C\u8FBE\u5230\u8D44\u6E90\u9694\u79BB\u7684\u76EE\u7684\uFF0C\u5B83\u7684\u539F\u7406\u5982\u4E0B\u56FE\u6240\u793A\uFF1A"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{alt:"workload_group",src:e(356631).Z+"",width:"1618",height:"554"})}),"\n",(0,o.jsx)(r.p,{children:"\u76EE\u524D\u652F\u6301\u7684\u9694\u79BB\u80FD\u529B\u5305\u62EC\uFF1A"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"\u7BA1\u7406 CPU \u8D44\u6E90\uFF0C\u652F\u6301 CPU \u786C\u9650\u548C CPU \u8F6F\u9650;"}),"\n",(0,o.jsx)(r.li,{children:"\u7BA1\u7406\u5185\u5B58\u8D44\u6E90\uFF0C\u652F\u6301\u5185\u5B58\u786C\u9650\u548C\u5185\u5B58\u8F6F\u9650;"}),"\n",(0,o.jsx)(r.li,{children:"\u7BA1\u7406 IO \u8D44\u6E90\uFF0C\u5305\u62EC\u8BFB\u672C\u5730\u6587\u4EF6\u548C\u8FDC\u7A0B\u6587\u4EF6\u4EA7\u751F\u7684 IO\u3002"}),"\n"]}),"\n",(0,o.jsxs)(r.admonition,{type:"tip",children:[(0,o.jsx)(r.p,{children:"Workload Group \u63D0\u4F9B\u8FDB\u7A0B\u5185\u7684\u8D44\u6E90\u9694\u79BB\u80FD\u529B\uFF0C\u4E0E\u8FDB\u7A0B\u95F4\u7684\u8D44\u6E90\u9694\u79BB\u65B9\u5F0F\uFF08 Resource Group, Compute Group \uFF09\u5B58\u5728\u4EE5\u4E0B\u533A\u522B\uFF1A"}),(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsx)(r.li,{children:"\u8FDB\u7A0B\u5185\u7684\u8D44\u6E90\u9694\u79BB\u65E0\u6CD5\u505A\u5230\u5F7B\u5E95\u7684\u9694\u79BB\u6027\uFF0C\u6BD4\u5982\u9AD8\u8D1F\u8F7D\u67E5\u8BE2\u548C\u4F4E\u8D1F\u8F7D\u67E5\u8BE2\u5728\u540C\u4E00\u4E2A\u8FDB\u7A0B\u5185\u8FD0\u884C\uFF0C\u5373\u4F7F\u901A\u8FC7 Workload Group \u5BF9\u9AD8\u8D1F\u8F7D\u5206\u7EC4\u7684 CPU \u4F7F\u7528\u8FDB\u884C\u9650\u5236\u4F7F\u5F97\u6574\u4F53\u7684 CPU \u4F7F\u7528\u5728\u5408\u7406\u8303\u56F4\u5185\uFF0C\n\u90A3\u4E48\u4F4E\u8D1F\u8F7D\u5206\u7EC4\u7684\u5EF6\u8FDF\u4E5F\u96BE\u514D\u4F1A\u53D7\u5230\u5F71\u54CD\uFF0C\u4F46\u76F8\u6BD4\u4E8E\u4E0D\u505A CPU \u7BA1\u63A7\u7684\u60C5\u51B5\u4F1A\u6709\u66F4\u597D\u7684\u8868\u73B0\u3002\u8FD9\u662F\u7531\u4E8E\u8FDB\u7A0B\u5185\u90E8\u96BE\u514D\u5B58\u5728\u4E00\u4E9B\u65E0\u6CD5\u9694\u79BB\u7684\u516C\u5171\u7EC4\u4EF6\uFF0C\u6BD4\u5982\u516C\u5171\u7684\u7F13\u5B58\u548C\u516C\u5171\u7684 RPC \u7EBF\u7A0B\u6C60\u3002"}),"\n",(0,o.jsx)(r.li,{children:"\u5728\u505A\u8D44\u6E90\u9694\u79BB\u65B9\u6848\u7684\u9009\u62E9\u65F6\uFF0C\u5177\u4F53\u4F7F\u7528 Workload Group \u8FD8\u662F\u57FA\u4E8E\u8FDB\u7A0B\u7684\u8D44\u6E90\u9694\u79BB\u65B9\u6848\uFF08\u4E5F\u5C31\u662F\u628A\u9700\u8981\u9694\u79BB\u7684\u8D1F\u8F7D\u653E\u5230\u4E0D\u540C\u7684\u8FDB\u7A0B\uFF09\uFF0C\u4E3B\u8981\u53D6\u51B3\u4E8E\u9694\u79BB\u6027\u548C\u6210\u672C\u7684\u6743\u8861\uFF0C\u53EF\u4EE5\u5BB9\u5FCD\u4E00\u5B9A\u7684\u5EF6\u8FDF\u4F46\u662F\u504F\u597D\u4F4E\u6210\u672C\u7684\u573A\u666F\uFF0C\u53EF\u4EE5\u9009\u62E9 Workload Group \u7684\u9694\u79BB\u65B9\u6848\uFF1B\n\u671F\u671B\u5B8C\u5168\u7684\u9694\u79BB\u6027\u540C\u65F6\u53EF\u4EE5\u63A5\u53D7\u66F4\u9AD8\u7684\u6210\u672C\uFF0C\u90A3\u4E48\u53EF\u4EE5\u9009\u62E9\u57FA\u4E8E\u8FDB\u7A0B\u7684\u8D44\u6E90\u9694\u79BB\u65B9\u6848\uFF0C\u4F8B\u5982 Resource Group \u6216\u8005 Compute Group\uFF0C\u628A\u9AD8\u4F18\u8D1F\u8F7D\u5212\u5206\u5230\u72EC\u7ACB\u7684 BE \u8282\u70B9\u4E0A\u5C31\u53EF\u4EE5\u505A\u5230\u6BD4\u8F83\u5F7B\u5E95\u7684\u9694\u79BB\u3002"}),"\n"]})]}),"\n",(0,o.jsx)(r.h2,{id:"\u7248\u672C\u8BF4\u660E",children:"\u7248\u672C\u8BF4\u660E"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u81EA Doris 2.0 \u7248\u672C\u5F00\u59CB\u63D0\u4F9B Workload Group \u529F\u80FD\u3002\u5728 Doris 2.0 \u7248\u672C\u4E2D\uFF0CWorkload Group \u529F\u80FD\u4E0D\u4F9D\u8D56\u4E8E CGroup\uFF0C\u800C Doris 2.1 \u7248\u672C\u4E2D\u9700\u8981\u4F9D\u8D56 CGroup\u3002"}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4ECE Doris 1.2 \u5347\u7EA7\u5230 2.0\uFF1A\u5EFA\u8BAE\u96C6\u7FA4\u5347\u7EA7\u5B8C\u6210\u540E\uFF0C\u518D\u5F00\u542F Workload Group \u529F\u80FD\u3002\u53EA\u5347\u7EA7\u90E8\u5206 follower FE \u8282\u70B9\uFF0C\u53EF\u80FD\u4F1A\u56E0\u4E3A\u672A\u5347\u7EA7\u7684 FE \u8282\u70B9\u6CA1\u6709 Workload Group \u7684\u5143\u6570\u636E\u4FE1\u606F\uFF0C\u5BFC\u81F4\u5DF2\u5347\u7EA7\u7684 follower FE \u8282\u70B9\u67E5\u8BE2\u5931\u8D25\u3002"}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4ECE Doris 2.0 \u5347\u7EA7\u5230 2.1\uFF1A\u7531\u4E8E 2.1 \u7248\u672C\u7684 Workload Group \u529F\u80FD\u4F9D\u8D56\u4E8E CGroup\uFF0C\u9700\u8981\u5148\u914D\u7F6E CGroup \u73AF\u5883\uFF0C\u518D\u5347\u7EA7\u5230 Doris 2.1 \u7248\u672C\u3002"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"\u914D\u7F6E-workload-group",children:"\u914D\u7F6E workload group"}),"\n",(0,o.jsx)(r.h3,{id:"\u914D\u7F6E-cgroup-\u73AF\u5883",children:"\u914D\u7F6E CGroup \u73AF\u5883"}),"\n",(0,o.jsx)(r.p,{children:"Workload Group \u652F\u6301\u5BF9\u4E8E CPU\uFF0C\u5185\u5B58\uFF0CIO \u8D44\u6E90\u7684\u7BA1\u7406\uFF0C\u5176\u4E2D\u5BF9\u4E8E CPU \u7684\u7BA1\u7406\u4F9D\u8D56 CGroup \u7EC4\u4EF6\uFF1B\u5982\u679C\u671F\u671B\u4F7F\u7528 Workload Group \u7BA1\u7406 CPU \u8D44\u6E90\uFF0C\u90A3\u4E48\u9996\u5148\u9700\u8981\u8FDB\u884C CGroup \u73AF\u5883\u7684\u914D\u7F6E\u3002"}),"\n",(0,o.jsx)(r.p,{children:"\u4EE5\u4E0B\u4E3A CGroup \u73AF\u5883\u914D\u7F6E\u6D41\u7A0B\uFF1A"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\u9996\u5148\u786E\u8BA4 BE \u6240\u5728\u8282\u70B9\u662F\u5426\u5DF2\u7ECF\u5B89\u88C5\u597D CGroup\uFF0C\u8F93\u51FA\u7ED3\u679C\u4E2D",(0,o.jsx)(r.code,{children:"cgroup"})," \u4EE3\u8868\u76EE\u524D\u7684\u73AF\u5883\u5DF2\u7ECF\u5B89\u88C5 CGroup V1\uFF0C",(0,o.jsx)(r.code,{children:"cgroup2"})," \u4EE3\u8868\u76EE\u524D\u7684\u73AF\u5883\u5DF2\u5B89\u88C5 CGroup V2\uFF0C\u81F3\u4E8E\u5177\u4F53\u662F\u54EA\u4E2A\u7248\u672C\u751F\u6548\uFF0C\u53EF\u4EE5\u901A\u8FC7\u4E0B\u4E00\u6B65\u786E\u8BA4\u3002"]}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"cat /proc/filesystems | grep cgroup\nnodev	cgroup\nnodev	cgroup2\nnodev	cgroupfs\n"})}),"\n",(0,o.jsxs)(r.ol,{start:"2",children:["\n",(0,o.jsx)(r.li,{children:"\u901A\u8FC7\u8DEF\u5F84\u540D\u79F0\u53EF\u4EE5\u786E\u8BA4\u76EE\u524D\u751F\u6548\u7684 CGroup \u7248\u672C\u3002"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"\u5982\u679C\u5B58\u5728\u8FD9\u4E2A\u8DEF\u5F84\u8BF4\u660E\u76EE\u524D\u751F\u6548\u7684\u662Fcgroup v1\n/sys/fs/cgroup/cpu/\n\n\n\u5982\u679C\u5B58\u5728\u8FD9\u4E2A\u8DEF\u5F84\u8BF4\u660E\u76EE\u524D\u751F\u6548\u7684\u662Fcgroup v2\n/sys/fs/cgroup/cgroup.controllers\n"})}),"\n",(0,o.jsxs)(r.ol,{start:"3",children:["\n",(0,o.jsx)(r.li,{children:"\u5728 CGroup \u8DEF\u5F84\u4E0B\u65B0\u5EFA\u4E00\u4E2A\u540D\u4E3A doris \u7684\u76EE\u5F55\uFF0C\u8FD9\u4E2A\u76EE\u5F55\u540D\u7528\u6237\u53EF\u4EE5\u81EA\u884C\u6307\u5B9A"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"\u5982\u679C\u662Fcgroup v1\u5C31\u5728cpu\u76EE\u5F55\u4E0B\u65B0\u5EFA\nmkdir /sys/fs/cgroup/cpu/doris\n\n\n\u5982\u679C\u662Fcgroup v2\u5C31\u5728\u76F4\u63A5\u5728cgroup\u76EE\u5F55\u4E0B\u65B0\u5EFA\nmkdir /sys/fs/cgroup/doris\n"})}),"\n",(0,o.jsxs)(r.ol,{start:"4",children:["\n",(0,o.jsx)(r.li,{children:"\u9700\u8981\u4FDD\u8BC1 Doris \u7684 BE \u8FDB\u7A0B\u5BF9\u4E8E\u8FD9\u4E2A\u76EE\u5F55\u6709\u8BFB/\u5199/\u6267\u884C\u6743\u9650"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"// \u5982\u679C\u662FCGroup v1\uFF0C\u90A3\u4E48\u547D\u4EE4\u5982\u4E0B:\n// 1. \u4FEE\u6539\u8FD9\u4E2A\u76EE\u5F55\u7684\u6743\u9650\u4E3A\u53EF\u8BFB\u53EF\u5199\u53EF\u6267\u884C\nchmod 770 /sys/fs/cgroup/cpu/doris\n// 2. \u628A\u8FD9\u4E2A\u76EE\u5F55\u7684\u5F52\u5C5E\u5212\u5206\u7ED9doris\u7684\u8D26\u6237\nchown -R doris:doris /sys/fs/cgroup/cpu/doris\n\n\n// \u5982\u679C\u662FCGroup v2\uFF0C\u90A3\u4E48\u547D\u4EE4\u5982\u4E0B:\n// 1. \u4FEE\u6539\u8FD9\u4E2A\u76EE\u5F55\u7684\u6743\u9650\u4E3A\u53EF\u8BFB\u53EF\u5199\u53EF\u6267\u884C\nchmod 770 /sys/fs/cgroup/doris\n// 2. \u628A\u8FD9\u4E2A\u76EE\u5F55\u7684\u5F52\u5C5E\u5212\u5206\u7ED9doris\u7684\u8D26\u6237\nchown -R doris:doris /sys/fs/cgroup/doris\n"})}),"\n",(0,o.jsxs)(r.ol,{start:"5",children:["\n",(0,o.jsx)(r.li,{children:"\u5982\u679C\u76EE\u524D\u73AF\u5883\u91CC\u751F\u6548\u7684\u662F CGroup v2 \u7248\u672C\uFF0C\u90A3\u4E48\u8FD8\u9700\u8981\u8FDB\u884C\u4EE5\u4E0B\u4E24\u6B65\u64CD\u4F5C\u3002\u5982\u679C\u662F CGroup v1 \u90A3\u4E48\u53EF\u4EE5\u8DF3\u8FC7\u5F53\u524D\u6B65\u9AA4\u3002"}),"\n"]}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"\u4FEE\u6539\u6839\u76EE\u5F55\u4E0B\u7684 cgroup.procs \u6587\u4EF6\u6743\u9650\uFF0C\u8FD9\u662F\u56E0\u4E3A CGroup v2 \u5BF9\u4E8E\u6743\u9650\u7BA1\u63A7\u6BD4\u8F83\u4E25\u683C\uFF0C\u9700\u8981\u5177\u5907\u6839\u76EE\u5F55\u7684 cgroup.procs \u6587\u4EF6\u7684\u5199\u6743\u9650\u624D\u80FD\u5B9E\u73B0\u8FDB\u7A0B\u5728 CGroup \u76EE\u5F55\u4E4B\u95F4\u7684\u79FB\u52A8\u3002"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"chmod a+w /sys/fs/cgroup/cgroup.procs\n"})}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"\u5728 CGroup V2 \u4E2D\uFF0Ccgroup.controllers \u4FDD\u5B58\u4E86\u5F53\u524D\u76EE\u5F55\u53EF\u7528\u7684\u63A7\u5236\u5668\uFF0Ccgroup.subtree_control \u4FDD\u5B58\u4E86\u5F53\u524D\u76EE\u5F55\u7684\u5B50\u76EE\u5F55\u7684\u53EF\u7528\u63A7\u5236\u5668\u3002\n\u56E0\u6B64\u9700\u8981\u786E\u8BA4 doris \u76EE\u5F55\u662F\u5426\u5DF2\u7ECF\u542F\u7528 cpu \u63A7\u5236\u5668\uFF0C\u5982\u679C doris \u76EE\u5F55\u4E0B\u7684 cgroup.controllers \u4E2D\u4E0D\u5305\u542B cpu\uFF0C\u90A3\u4E48\u8BF4\u660E cpu \u63A7\u5236\u5668\u672A\u542F\u7528\uFF0C\u53EF\u4EE5\u5728 doris \u76EE\u5F55\u4E2D\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\uFF0C\n\u8FD9\u4E2A\u547D\u4EE4\u662F\u901A\u8FC7\u4FEE\u6539\u7236\u7EA7\u76EE\u5F55\u7684 cgroup.subtree_control \u6587\u4EF6\u4F7F\u5F97 doris \u76EE\u5F55\u53EF\u4EE5\u4F7F\u7528 cpu \u63A7\u5236\u5668\u3002"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"// \u9884\u671F\u8BE5\u547D\u4EE4\u6267\u884C\u5B8C\u6210\u4E4B\u540E\uFF0C\u53EF\u4EE5\u5728 doris \u76EE\u5F55\u4E0B\u770B\u5230 cpu.max \u6587\u4EF6\uFF0C\u4E14 cgroup.controllers \u7684\u8F93\u51FA\u5305\u542B cpu\u3002\n// \u5982\u679C\u8BE5\u547D\u4EE4\u6267\u884C\u5931\u8D25\uFF0C\u5219\u8BF4\u660E doris \u76EE\u5F55\u7684\u7236\u7EA7\u76EE\u5F55\u4E5F\u672A\u542F\u7528 cpu \u63A7\u5236\u5668\uFF0C\u9700\u8981\u4E3A\u7236\u7EA7\u76EE\u5F55\u542F\u7528 cpu \u63A7\u5236\u5668\u3002\necho +cpu > ../cgroup.subtree_control\n"})}),"\n",(0,o.jsxs)(r.ol,{start:"6",children:["\n",(0,o.jsx)(r.li,{children:"\u4FEE\u6539 BE \u7684\u914D\u7F6E\uFF0C\u6307\u5B9A cgroup \u7684\u8DEF\u5F84"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"\u5982\u679C\u662FCgroup v1\uFF0C\u90A3\u4E48\u914D\u7F6E\u8DEF\u5F84\u5982\u4E0B\ndoris_cgroup_cpu_path = /sys/fs/cgroup/cpu/doris\n\n\u5982\u679C\u662FCgroup v2\uFF0C\u90A3\u4E48\u914D\u7F6E\u8DEF\u5F84\u5982\u4E0B\ndoris_cgroup_cpu_path = /sys/fs/cgroup/doris\n"})}),"\n",(0,o.jsxs)(r.ol,{start:"7",children:["\n",(0,o.jsx)(r.li,{children:'\u91CD\u542F BE\uFF0C\u5728\u65E5\u5FD7\uFF08be.INFO\uFF09\u53EF\u4EE5\u770B\u5230"add thread xxx to group"\u7684\u5B57\u6837\u4EE3\u8868\u914D\u7F6E\u6210\u529F'}),"\n"]}),"\n",(0,o.jsx)(r.admonition,{type:"tip",children:(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsx)(r.li,{children:"\u5EFA\u8BAE\u5355\u53F0\u673A\u5668\u4E0A\u53EA\u90E8\u7F72\u4E00\u4E2A BE \u5B9E\u4F8B\uFF0C\u76EE\u524D\u7684 Workload Group \u529F\u80FD\u4E0D\u652F\u6301\u4E00\u4E2A\u673A\u5668\u4E0A\u90E8\u7F72\u591A\u4E2A BE\uFF1B"}),"\n",(0,o.jsx)(r.li,{children:"\u5F53\u673A\u5668\u91CD\u542F\u4E4B\u540E\uFF0CCGroup \u8DEF\u5F84\u4E0B\u7684\u6240\u6709\u914D\u7F6E\u5C31\u4F1A\u6E05\u7A7A\u3002\u5982\u679C\u671F\u671B CGroup \u914D\u7F6E\u6301\u4E45\u5316\uFF0C\u53EF\u4EE5\u4F7F\u7528 systemd \u628A\u64CD\u4F5C\u8BBE\u7F6E\u6210\u7CFB\u7EDF\u7684\u81EA\u5B9A\u4E49\u670D\u52A1\uFF0C\u8FD9\u6837\u5728\u6BCF\u6B21\u673A\u5668\u91CD\u542F\u7684\u65F6\u53EF\u4EE5\u81EA\u52A8\u5B8C\u6210\u521B\u5EFA\u548C\u6388\u6743\u64CD\u4F5C"}),"\n",(0,o.jsx)(r.li,{children:"\u5982\u679C\u662F\u5728\u5BB9\u5668\u5185\u4F7F\u7528 CGroup\uFF0C\u9700\u8981\u5BB9\u5668\u5177\u5907\u64CD\u4F5C\u5BBF\u4E3B\u673A\u7684\u6743\u9650\u3002"}),"\n"]})}),"\n",(0,o.jsx)(r.h4,{id:"\u5728\u5BB9\u5668\u4E2D\u4F7F\u7528-workload-group-\u7684\u6CE8\u610F\u4E8B\u9879",children:"\u5728\u5BB9\u5668\u4E2D\u4F7F\u7528 Workload Group \u7684\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,o.jsx)(r.p,{children:"Workload \u7684 CPU \u7BA1\u7406\u662F\u57FA\u4E8E CGroup \u5B9E\u73B0\u7684\uFF0C\u5982\u679C\u671F\u671B\u5728\u5BB9\u5668\u4E2D\u4F7F\u7528 Workload Group\uFF0C\u90A3\u4E48\u9700\u8981\u4EE5\u7279\u6743\u6A21\u5F0F\u542F\u52A8\u5BB9\u5668\uFF0C\u5BB9\u5668\u5185\u7684 Doris \u8FDB\u7A0B\u624D\u80FD\u5177\u5907\u8BFB\u5199\u5BBF\u4E3B\u673A CGroup \u6587\u4EF6\u7684\u6743\u9650\u3002\n\u5F53 Doris \u5728\u5BB9\u5668\u5185\u8FD0\u884C\u65F6\uFF0CWorkload Group \u7684 CPU \u8D44\u6E90\u7528\u91CF\u662F\u5728\u5BB9\u5668\u53EF\u7528\u8D44\u6E90\u7684\u60C5\u51B5\u4E0B\u518D\u5212\u5206\u7684\uFF0C\u4F8B\u5982\u5BBF\u4E3B\u673A\u6574\u673A\u662F 64 \u6838\uFF0C\u5BB9\u5668\u88AB\u5206\u914D\u4E86 8 \u4E2A\u6838\u7684\u8D44\u6E90\uFF0CWorkload Group \u914D\u7F6E\u7684 CPU \u786C\u9650\u4E3A 50%\uFF0C\n\u90A3\u4E48 Workload Group \u5B9E\u9645\u53EF\u7528\u6838\u6570\u4E3A 4 \u4E2A\uFF088 \u6838 * 50%\uFF09\u3002"}),"\n",(0,o.jsx)(r.p,{children:"WorkloadGroup \u7684\u5185\u5B58\u7BA1\u7406\u548C IO \u7BA1\u7406\u529F\u80FD\u662F Doris \u5185\u90E8\u5B9E\u73B0\uFF0C\u4E0D\u4F9D\u8D56\u5916\u90E8\u7EC4\u4EF6\uFF0C\u56E0\u6B64\u5728\u5BB9\u5668\u548C\u7269\u7406\u673A\u4E0A\u90E8\u7F72\u4F7F\u7528\u5E76\u6CA1\u6709\u533A\u522B\u3002"}),"\n",(0,o.jsx)(r.p,{children:"\u5982\u679C\u8981\u5728 K8S \u4E0A\u4F7F\u7528 Doris\uFF0C\u5EFA\u8BAE\u4F7F\u7528 Doris Operator \u8FDB\u884C\u90E8\u7F72\uFF0C\u53EF\u4EE5\u5C4F\u853D\u5E95\u5C42\u7684\u6743\u9650\u7EC6\u8282\u95EE\u9898\u3002"}),"\n",(0,o.jsx)(r.h3,{id:"\u521B\u5EFA-workload-group",children:"\u521B\u5EFA Workload Group"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:'mysql [information_schema]>create workload group if not exists g1\n    -> properties (\n    ->     "cpu_share"="1024"\n    -> );\nQuery OK, 0 rows affected (0.03 sec)\n\n'})}),"\n",(0,o.jsxs)(r.p,{children:["\u53EF\u4EE5\u53C2\u8003 ",(0,o.jsx)(r.a,{href:"../../sql-manual/sql-statements/cluster-management/compute-management/CREATE-WORKLOAD-GROUP",children:"CREATE-WORKLOAD-GROUP"}),"\u3002"]}),"\n",(0,o.jsxs)(r.p,{children:["\u6B64\u65F6\u914D\u7F6E\u7684 CPU \u9650\u5236\u4E3A\u8F6F\u9650\u3002\u81EA 2.1 \u7248\u672C\u8D77\uFF0C\u7CFB\u7EDF\u4F1A\u81EA\u52A8\u521B\u5EFA\u4E00\u4E2A\u540D\u4E3A",(0,o.jsx)(r.code,{children:"normal"}),"\u7684 group\uFF0C\u4E0D\u53EF\u5220\u9664\u3002"]}),"\n",(0,o.jsx)(r.h3,{id:"workload-group-\u5C5E\u6027",children:"Workload Group \u5C5E\u6027"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(r.table,{children:[(0,o.jsx)(r.thead,{children:(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.th,{children:"\u5C5E\u6027\u540D\u79F0"}),(0,o.jsx)(r.th,{children:"\u6570\u636E\u7C7B\u578B"}),(0,o.jsx)(r.th,{children:"\u9ED8\u8BA4\u503C"}),(0,o.jsx)(r.th,{children:"\u53D6\u503C\u8303\u56F4"}),(0,o.jsx)(r.th,{children:"\u8BF4\u660E"})]})}),(0,o.jsxs)(r.tbody,{children:[(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"cpu_share"}),(0,o.jsx)(r.td,{children:"\u6574\u578B"}),(0,o.jsx)(r.td,{children:"-1"}),(0,o.jsx)(r.td,{children:"[1, 10000]"}),(0,o.jsx)(r.td,{children:"\u53EF\u9009\uFF0CCPU \u8F6F\u9650\u6A21\u5F0F\u4E0B\u751F\u6548\uFF0C\u53D6\u503C\u8303\u56F4\u548C\u4F7F\u7528\u7684 CGroup \u7248\u672C\u6709\u5173\uFF0C\u4E0B\u6587\u6709\u8BE6\u7EC6\u63CF\u8FF0\u3002cpu_share \u4EE3\u8868\u4E86 Workload Group \u53EF\u83B7\u5F97 CPU \u65F6\u95F4\u7684\u6743\u91CD\uFF0C\u503C\u8D8A\u5927\uFF0C\u53EF\u83B7\u5F97\u7684 CPU \u65F6\u95F4\u8D8A\u591A\u3002\u4F8B\u5982\uFF0C\u7528\u6237\u521B\u5EFA\u4E86 3 \u4E2A Workload Group g-a\u3001g-b \u548C g-c\uFF0Ccpu_share \u5206\u522B\u4E3A 10\u300130\u300140\uFF0C\u67D0\u4E00\u65F6\u523B g-a \u548C g-b \u6B63\u5728\u8DD1\u4EFB\u52A1\uFF0C\u800C g-c \u6CA1\u6709\u4EFB\u52A1\uFF0C\u6B64\u65F6 g-a \u53EF\u83B7\u5F97 25% (10 / (10 + 30)) \u7684 CPU \u8D44\u6E90\uFF0C\u800C g-b \u53EF\u83B7\u5F97 75% \u7684 CPU \u8D44\u6E90\u3002\u5982\u679C\u7CFB\u7EDF\u53EA\u6709\u4E00\u4E2A Workload Group \u6B63\u5728\u8FD0\u884C\uFF0C\u5219\u4E0D\u7BA1\u5176 cpu_share \u7684\u503C\u4E3A\u591A\u5C11\uFF0C\u5B83\u90FD\u53EF\u83B7\u53D6\u5168\u90E8\u7684 CPU \u8D44\u6E90\u3002"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"memory_limit"}),(0,o.jsx)(r.td,{children:"\u6D6E\u70B9"}),(0,o.jsx)(r.td,{children:"-1"}),(0,o.jsx)(r.td,{children:"(0%, 100%]"}),(0,o.jsx)(r.td,{children:"\u53EF\u9009\uFF0C\u5F00\u542F\u5185\u5B58\u786C\u9650\u65F6\u4EE3\u8868\u5F53\u524D Workload Group \u6700\u5927\u53EF\u7528\u5185\u5B58\u767E\u5206\u6BD4\uFF0C\u9ED8\u8BA4\u503C\u4EE3\u8868\u4E0D\u9650\u5236\u5185\u5B58\u3002\u6240\u6709 Workload Group \u7684 memory_limit \u7D2F\u52A0\u503C\u4E0D\u53EF\u4EE5\u8D85\u8FC7 100%\uFF0C\u901A\u5E38\u4E0E enable_memory_overcommit \u5C5E\u6027\u914D\u5408\u4F7F\u7528\u3002\u5982\u679C\u4E00\u4E2A\u673A\u5668\u7684\u5185\u5B58\u4E3A 64G\uFF0CWorkload Group \u7684 memory_limit \u914D\u7F6E\u4E3A 50%\uFF0C\u90A3\u4E48\u8BE5 group \u7684\u5B9E\u9645\u7269\u7406\u5185\u5B58=64G * 90% * 50%= 28.8G\uFF0C\u8FD9\u91CC\u7684 90% \u662F BE \u8FDB\u7A0B\u53EF\u7528\u5185\u5B58\u914D\u7F6E\u7684\u9ED8\u8BA4\u503C\u3002"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"enable_memory_overcommit"}),(0,o.jsx)(r.td,{children:"\u5E03\u5C14"}),(0,o.jsx)(r.td,{children:"true"}),(0,o.jsx)(r.td,{children:"true, false"}),(0,o.jsx)(r.td,{children:"\u53EF\u9009\uFF0C\u7528\u4E8E\u63A7\u5236\u5F53\u524D Workload Group \u7684\u5185\u5B58\u9650\u5236\u662F\u786C\u9650\u8FD8\u662F\u8F6F\u9650\uFF0C\u9ED8\u8BA4\u4E3A true\u3002\u5982\u679C\u8BBE\u7F6E\u4E3A false\uFF0C\u5219\u8BE5 workload group \u4E3A\u5185\u5B58\u786C\u9694\u79BB\uFF0C\u7CFB\u7EDF\u68C0\u6D4B\u5230 workload group \u5185\u5B58\u4F7F\u7528\u8D85\u51FA\u9650\u5236\u540E\u5C06\u7ACB\u5373 cancel \u7EC4\u5185\u5185\u5B58\u5360\u7528\u6700\u5927\u7684\u82E5\u5E72\u4E2A\u4EFB\u52A1\uFF0C\u4EE5\u91CA\u653E\u8D85\u51FA\u7684\u5185\u5B58\uFF1B\u5982\u679C\u8BBE\u7F6E\u4E3A true\uFF0C\u5219\u8BE5 Workload Group \u4E3A\u5185\u5B58\u8F6F\u9694\u79BB\uFF0C\u5982\u679C\u7CFB\u7EDF\u6709\u7A7A\u95F2\u5185\u5B58\u8D44\u6E90\u5219\u8BE5 Workload Group \u5728\u8D85\u51FA memory_limit \u7684\u9650\u5236\u540E\u53EF\u7EE7\u7EED\u4F7F\u7528\u7CFB\u7EDF\u5185\u5B58\uFF0C\u5728\u7CFB\u7EDF\u603B\u5185\u5B58\u7D27\u5F20\u65F6\u4F1A cancel \u7EC4\u5185\u5185\u5B58\u5360\u7528\u6700\u5927\u7684\u82E5\u5E72\u4E2A\u4EFB\u52A1\uFF0C\u91CA\u653E\u90E8\u5206\u8D85\u51FA\u7684\u5185\u5B58\u4EE5\u7F13\u89E3\u7CFB\u7EDF\u5185\u5B58\u538B\u529B\u3002\u5EFA\u8BAE\u6240\u6709 workload group \u7684 memory_limit \u603B\u548C\u4F4E\u4E8E 100%\uFF0C\u4E3A BE \u8FDB\u7A0B\u4E2D\u7684\u5176\u4ED6\u7EC4\u4EF6\u4FDD\u7559\u4E00\u4E9B\u5185\u5B58\u3002"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"cpu_hard_limit"}),(0,o.jsx)(r.td,{children:"\u6574\u578B"}),(0,o.jsx)(r.td,{children:"-1"}),(0,o.jsx)(r.td,{children:"[1%, 100%]"}),(0,o.jsx)(r.td,{children:"\u53EF\u9009\uFF0CCPU \u786C\u9650\u5236\u6A21\u5F0F\u4E0B\u751F\u6548\uFF0CWorkload Group \u6700\u5927\u53EF\u7528 CPU \u767E\u5206\u6BD4\uFF0C\u4E0D\u7BA1\u5F53\u524D\u673A\u5668\u7684 CPU \u8D44\u6E90\u662F\u5426\u88AB\u7528\u6EE1\uFF0CWorkload Group \u7684\u6700\u5927 CPU \u7528\u91CF\u90FD\u4E0D\u80FD\u8D85\u8FC7 cpu_hard_limit\uFF0C\u6240\u6709 Workload Group \u7684 cpu_hard_limit \u7D2F\u52A0\u503C\u4E0D\u80FD\u8D85\u8FC7 100%\u30022.1 \u7248\u672C\u65B0\u589E\u5C5E\u6027\uFF0C2.0 \u7248\u672C\u4E0D\u652F\u6301\u8BE5\u529F\u80FD\u3002"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"max_concurrency"}),(0,o.jsx)(r.td,{children:"\u6574\u578B"}),(0,o.jsx)(r.td,{children:"2147483647"}),(0,o.jsx)(r.td,{children:"[0, 2147483647]"}),(0,o.jsx)(r.td,{children:"\u53EF\u9009\uFF0C\u6700\u5927\u67E5\u8BE2\u5E76\u53D1\u6570\uFF0C\u9ED8\u8BA4\u503C\u4E3A\u6574\u578B\u6700\u5927\u503C\uFF0C\u4E5F\u5C31\u662F\u4E0D\u505A\u5E76\u53D1\u7684\u9650\u5236\u3002\u8FD0\u884C\u4E2D\u7684\u67E5\u8BE2\u6570\u91CF\u8FBE\u5230\u6700\u5927\u5E76\u53D1\u65F6\uFF0C\u65B0\u6765\u7684\u67E5\u8BE2\u4F1A\u8FDB\u5165\u6392\u961F\u7684\u903B\u8F91\u3002"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"max_queue_size"}),(0,o.jsx)(r.td,{children:"\u6574\u578B"}),(0,o.jsx)(r.td,{children:"0"}),(0,o.jsx)(r.td,{children:"[0, 2147483647]"}),(0,o.jsx)(r.td,{children:"\u53EF\u9009\uFF0C\u67E5\u8BE2\u6392\u961F\u961F\u5217\u7684\u957F\u5EA6\uFF0C\u5F53\u6392\u961F\u961F\u5217\u5DF2\u6EE1\u65F6\uFF0C\u65B0\u6765\u7684\u67E5\u8BE2\u4F1A\u88AB\u62D2\u7EDD\u3002\u9ED8\u8BA4\u503C\u4E3A 0\uFF0C\u542B\u4E49\u662F\u4E0D\u6392\u961F\u3002\u5F53\u6392\u961F\u961F\u5217\u5DF2\u6EE1\u65F6\uFF0C\u65B0\u6765\u7684\u67E5\u8BE2\u4F1A\u76F4\u63A5\u5931\u8D25\u3002"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"queue_timeout"}),(0,o.jsx)(r.td,{children:"\u6574\u578B"}),(0,o.jsx)(r.td,{children:"0"}),(0,o.jsx)(r.td,{children:"[0, 2147483647]"}),(0,o.jsx)(r.td,{children:"\u53EF\u9009\uFF0C\u67E5\u8BE2\u5728\u6392\u961F\u961F\u5217\u4E2D\u7684\u6700\u5927\u7B49\u5F85\u65F6\u95F4\uFF0C\u5355\u4F4D\u4E3A\u6BEB\u79D2\u3002\u5982\u679C\u67E5\u8BE2\u5728\u961F\u5217\u4E2D\u7684\u6392\u961F\u65F6\u95F4\u8D85\u8FC7\u8FD9\u4E2A\u503C\uFF0C\u90A3\u4E48\u5C31\u4F1A\u76F4\u63A5\u629B\u51FA\u5F02\u5E38\u7ED9\u5BA2\u6237\u7AEF\u3002\u9ED8\u8BA4\u503C\u4E3A 0\uFF0C\u542B\u4E49\u662F\u4E0D\u6392\u961F\uFF0C\u67E5\u8BE2\u8FDB\u5165\u961F\u5217\u540E\u7ACB\u5373\u8FD4\u56DE\u5931\u8D25\u3002"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"scan_thread_num"}),(0,o.jsx)(r.td,{children:"\u6574\u578B"}),(0,o.jsx)(r.td,{children:"-1"}),(0,o.jsx)(r.td,{children:"[1, 2147483647]"}),(0,o.jsxs)(r.td,{children:["\u53EF\u9009\uFF0C\u5F53\u524D workload group \u7528\u4E8E scan \u7684\u7EBF\u7A0B\u4E2A\u6570\u3002\u5F53\u8BE5\u5C5E\u6027\u4E3A -1\uFF0C\u542B\u4E49\u662F\u4E0D\u751F\u6548\uFF0C\u6B64\u65F6\u5728 BE \u4E0A\u7684\u5B9E\u9645\u53D6\u503C\u4E3A BE \u914D\u7F6E\u4E2D\u7684",(0,o.jsx)(r.code,{children:"doris_scanner_thread_pool_thread_num"}),"\u3002"]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"max_remote_scan_thread_num"}),(0,o.jsx)(r.td,{children:"\u6574\u578B"}),(0,o.jsx)(r.td,{children:"-1"}),(0,o.jsx)(r.td,{children:"[1, 2147483647]"}),(0,o.jsx)(r.td,{children:"\u53EF\u9009\uFF0C\u8BFB\u5916\u90E8\u6570\u636E\u6E90\u7684 scan \u7EBF\u7A0B\u6C60\u7684\u6700\u5927\u7EBF\u7A0B\u6570\u3002\u5F53\u8BE5\u5C5E\u6027\u4E3A -1 \u65F6\uFF0C\u5B9E\u9645\u7684\u7EBF\u7A0B\u6570\u7531 BE \u81EA\u884C\u51B3\u5B9A\uFF0C\u901A\u5E38\u548C\u6838\u6570\u76F8\u5173\u3002"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"min_remote_scan_thread_num"}),(0,o.jsx)(r.td,{children:"\u6574\u578B"}),(0,o.jsx)(r.td,{children:"-1"}),(0,o.jsx)(r.td,{children:"[1, 2147483647]"}),(0,o.jsx)(r.td,{children:"\u53EF\u9009\uFF0C\u8BFB\u5916\u90E8\u6570\u636E\u6E90\u7684 scan \u7EBF\u7A0B\u6C60\u7684\u6700\u5C0F\u7EBF\u7A0B\u6570\u3002\u5F53\u8BE5\u5C5E\u6027\u4E3A -1 \u65F6\uFF0C\u5B9E\u9645\u7684\u7EBF\u7A0B\u6570\u7531 BE \u81EA\u884C\u51B3\u5B9A\uFF0C\u901A\u5E38\u548C\u6838\u6570\u76F8\u5173\u3002"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"tag"}),(0,o.jsx)(r.td,{children:"\u5B57\u7B26\u4E32"}),(0,o.jsx)(r.td,{children:"\u7A7A"}),(0,o.jsx)(r.td,{children:"-"}),(0,o.jsx)(r.td,{children:"\u8BE5\u529F\u80FD\u5DF2\u5E9F\u5F03\uFF0C\u4E0D\u63A8\u8350\u751F\u4EA7\u73AF\u5883\u4F7F\u7528; \u4E3A Workload Group \u6307\u5B9A\u5206\u7EC4\u6807\u7B7E\uFF0C\u76F8\u540C\u6807\u7B7E\u7684 Workload Group \u8D44\u6E90\u7D2F\u52A0\u503C\u4E0D\u80FD\u8D85\u8FC7 100%\uFF1B\u5982\u679C\u671F\u671B\u6307\u5B9A\u591A\u4E2A\u503C\uFF0C\u53EF\u4EE5\u4F7F\u7528\u82F1\u6587\u9017\u53F7\u5206\u9694\u3002"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"read_bytes_per_second"}),(0,o.jsx)(r.td,{children:"\u6574\u578B"}),(0,o.jsx)(r.td,{children:"-1"}),(0,o.jsx)(r.td,{children:"[1, 9223372036854775807]"}),(0,o.jsx)(r.td,{children:"\u53EF\u9009\uFF0C\u542B\u4E49\u4E3A\u8BFB Doris \u5185\u8868\u65F6\u7684\u6700\u5927 IO \u541E\u5410\uFF0C\u9ED8\u8BA4\u503C\u4E3A -1\uFF0C\u4E5F\u5C31\u662F\u4E0D\u9650\u5236 IO \u5E26\u5BBD\u3002\u9700\u8981\u6CE8\u610F\u7684\u662F\u8FD9\u4E2A\u503C\u5E76\u4E0D\u7ED1\u5B9A\u78C1\u76D8\uFF0C\u800C\u662F\u7ED1\u5B9A\u6587\u4EF6\u5939\u3002\u6BD4\u5982\u4E3A Doris \u914D\u7F6E\u4E86 2 \u4E2A\u6587\u4EF6\u5939\u7528\u4E8E\u5B58\u653E\u5185\u8868\u6570\u636E\uFF0C\u90A3\u4E48\u6BCF\u4E2A\u6587\u4EF6\u5939\u7684\u6700\u5927\u8BFB IO \u4E0D\u4F1A\u8D85\u8FC7\u8BE5\u503C\uFF0C\u5982\u679C\u8FD9 2 \u4E2A\u6587\u4EF6\u5939\u90FD\u914D\u7F6E\u5230\u540C\u4E00\u5757\u76D8\u4E0A\uFF0C\u6700\u5927\u541E\u5410\u63A7\u5236\u5C31\u4F1A\u53D8\u6210 2 \u500D\u7684 read_bytes_per_second\u3002\u843D\u76D8\u7684\u6587\u4EF6\u76EE\u5F55\u4E5F\u53D7\u8BE5\u503C\u7684\u7EA6\u675F\u3002"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"remote_read_bytes_per_second"}),(0,o.jsx)(r.td,{children:"\u6574\u578B"}),(0,o.jsx)(r.td,{children:"-1"}),(0,o.jsx)(r.td,{children:"[1, 9223372036854775807]"}),(0,o.jsx)(r.td,{children:"\u53EF\u9009\uFF0C\u542B\u4E49\u4E3A\u8BFB Doris \u5916\u8868\u65F6\u7684\u6700\u5927 IO \u541E\u5410\uFF0C\u9ED8\u8BA4\u503C\u4E3A -1\uFF0C\u4E5F\u5C31\u662F\u4E0D\u9650\u5236 IO \u5E26\u5BBD\u3002"})]})]})]}),"\n",(0,o.jsx)(r.admonition,{type:"tip",children:(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u76EE\u524D\u6682\u4E0D\u652F\u6301 CPU \u7684\u8F6F\u9650\u548C\u786C\u9650\u7684\u540C\u65F6\u4F7F\u7528\uFF0C\u4E00\u4E2A\u96C6\u7FA4\u67D0\u4E00\u65F6\u523B\u53EA\u80FD\u662F\u8F6F\u9650\u6216\u8005\u786C\u9650\uFF0C\u4E0B\u6587\u4E2D\u4F1A\u63CF\u8FF0\u5207\u6362\u65B9\u6CD5\u3002"}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u6240\u6709\u5C5E\u6027\u5747\u4E3A\u53EF\u9009\uFF0C\u4F46\u662F\u5728\u521B\u5EFA Workload Group \u65F6\u9700\u8981\u6307\u5B9A\u81F3\u5C11\u4E00\u4E2A\u5C5E\u6027\u3002"}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u9700\u8981\u6CE8\u610F CGroup v1 CGroup v2 \u7248\u672C CPU \u8F6F\u9650\u9ED8\u8BA4\u503C\u662F\u6709\u533A\u522B\u7684\uFF0CCGroup v1 \u7684 CPU \u8F6F\u9650\u9ED8\u8BA4\u503C\u4E3A 1024\uFF0C\u53D6\u503C\u8303\u56F4\u4E3A 2 \u5230 262144\u3002\u800C CGroup v2 \u7684 CPU \u8F6F\u9650\u9ED8\u8BA4\u503C\u4E3A 100\uFF0C\u53D6\u503C\u8303\u56F4\u662F 1 \u5230 10000\u3002\n\u5982\u679C\u8F6F\u9650\u586B\u4E86\u4E00\u4E2A\u8D85\u51FA\u8303\u56F4\u7684\u503C\uFF0C\u8FD9\u4F1A\u5BFC\u81F4 CPU \u8F6F\u9650\u5728 BE \u4FEE\u6539\u5931\u8D25\u3002\u5982\u679C\u5728 CGroup v1 \u7684\u73AF\u5883\u4E0A\u5982\u679C\u6309\u7167 CGroup v2 \u7684\u9ED8\u8BA4\u503C 100 \u8BBE\u7F6E\uFF0C\u8FD9\u53EF\u80FD\u5BFC\u81F4\u8FD9\u4E2A workload group \u7684\u4F18\u5148\u7EA7\u5728\u8BE5\u673A\u5668\u4E0A\u662F\u6700\u4F4E\u7684\u3002"}),"\n"]}),"\n"]})}),"\n",(0,o.jsx)(r.h2,{id:"\u4E3A\u7528\u6237\u8BBE\u7F6E-workload-group",children:"\u4E3A\u7528\u6237\u8BBE\u7F6E Workload Group"}),"\n",(0,o.jsx)(r.p,{children:"\u5728\u628A\u7528\u6237\u7ED1\u5B9A\u5230\u67D0\u4E2A Workload Group \u4E4B\u524D\uFF0C\u9700\u8981\u5148\u786E\u5B9A\u8BE5\u7528\u6237\u662F\u5426\u5177\u6709\u67D0\u4E2A Workload Group \u7684\u6743\u9650\u3002\n\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E2A\u7528\u6237\u67E5\u770B information_schema.workload_groups \u7CFB\u7EDF\u8868\uFF0C\u8FD4\u56DE\u7684\u7ED3\u679C\u5C31\u662F\u5F53\u524D\u7528\u6237\u6709\u6743\u9650\u4F7F\u7528\u7684 Workload Group\u3002\n\u4E0B\u9762\u7684\u67E5\u8BE2\u7ED3\u679C\u4EE3\u8868\u5F53\u524D\u7528\u6237\u53EF\u4EE5\u4F7F\u7528 g1 \u4E0E normal Workload Group\uFF1A"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"SELECT name FROM information_schema.workload_groups;\n+--------+\n| name   |\n+--------+\n| normal |\n| g1     |\n+--------+\n"})}),"\n",(0,o.jsx)(r.p,{children:"\u5982\u679C\u65E0\u6CD5\u770B\u5230 g1 Workload Group\uFF0C\u53EF\u4EE5\u4F7F\u7528 ADMIN \u8D26\u6237\u6267\u884C GRANT \u8BED\u53E5\u4E3A\u7528\u6237\u6388\u6743\u3002\u4F8B\u5982\uFF1A"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"GRANT USAGE_PRIV ON WORKLOAD GROUP 'g1' TO 'user_1'@'%';\n"})}),"\n",(0,o.jsxs)(r.p,{children:["\u8FD9\u4E2A\u8BED\u53E5\u7684\u542B\u4E49\u662F\u628A\u540D\u4E3A g1 \u7684 Workload Group \u7684\u4F7F\u7528\u6743\u9650\u6388\u4E88\u7ED9\u540D\u4E3A user_1 \u7684\u8D26\u6237\u3002\n\u66F4\u591A\u6388\u6743\u64CD\u4F5C\u53EF\u4EE5\u53C2\u8003",(0,o.jsx)(r.a,{href:"../../sql-manual/sql-statements/account-management/GRANT-TO",children:"grant \u8BED\u53E5"}),"\u3002"]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u4E24\u79CD\u7ED1\u5B9A\u65B9\u5F0F"})}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\u901A\u8FC7\u8BBE\u7F6E user property \u5C06 user \u9ED8\u8BA4\u7ED1\u5B9A\u5230 workload group\uFF0C\u9ED8\u8BA4\u4E3A",(0,o.jsx)(r.code,{children:"normal"}),"\uFF0C\u9700\u8981\u6CE8\u610F\u7684\u8FD9\u91CC\u7684 value \u4E0D\u80FD\u586B\u7A7A\uFF0C\u5426\u5219\u8BED\u53E5\u4F1A\u6267\u884C\u5931\u8D25\u3002"]}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"set property 'default_workload_group' = 'g1';\n"})}),"\n",(0,o.jsx)(r.p,{children:"\u6267\u884C\u5B8C\u8BE5\u8BED\u53E5\u540E\uFF0C\u5F53\u524D\u7528\u6237\u7684\u67E5\u8BE2\u5C06\u9ED8\u8BA4\u4F7F\u7528'g1'\u3002"}),"\n",(0,o.jsxs)(r.ol,{start:"2",children:["\n",(0,o.jsx)(r.li,{children:"\u901A\u8FC7 session \u53D8\u91CF\u6307\u5B9A workload group, \u9ED8\u8BA4\u4E3A\u7A7A\uFF1A"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"set workload_group = 'g1';\n"})}),"\n",(0,o.jsx)(r.p,{children:"\u5F53\u540C\u65F6\u4F7F\u7528\u4E86\u4E24\u79CD\u65B9\u5F0F\u65F6\u4E3A\u7528\u6237\u6307\u5B9A\u4E86 Workload Group\uFF0Csession \u53D8\u91CF\u7684\u4F18\u5148\u7EA7\u8981\u9AD8\u4E8E user property\u3002"}),"\n",(0,o.jsx)(r.h2,{id:"\u67E5\u770B-workload-group",children:"\u67E5\u770B Workload Group"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsx)(r.li,{children:"\u901A\u8FC7 show \u8BED\u53E5\u67E5\u770B"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"show workload groups;\n"})}),"\n",(0,o.jsxs)(r.p,{children:["\u53EF\u4EE5\u53C2\u8003",(0,o.jsx)(r.a,{href:"../../sql-manual/sql-statements/cluster-management/compute-management/SHOW-WORKLOAD-GROUPS",children:"SHOW-WORKLOAD-GROUPS"}),"\u3002"]}),"\n",(0,o.jsxs)(r.ol,{start:"2",children:["\n",(0,o.jsx)(r.li,{children:"\u901A\u8FC7\u7CFB\u7EDF\u8868\u67E5\u770B"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"mysql [information_schema]>select * from information_schema.workload_groups where name='g1';\n+-------+------+-----------+--------------+--------------------------+-----------------+----------------+---------------+----------------+-----------------+----------------------------+----------------------------+----------------------+-----------------------+------+-----------------------+------------------------------+\n| ID    | NAME | CPU_SHARE | MEMORY_LIMIT | ENABLE_MEMORY_OVERCOMMIT | MAX_CONCURRENCY | MAX_QUEUE_SIZE | QUEUE_TIMEOUT | CPU_HARD_LIMIT | SCAN_THREAD_NUM | MAX_REMOTE_SCAN_THREAD_NUM | MIN_REMOTE_SCAN_THREAD_NUM | MEMORY_LOW_WATERMARK | MEMORY_HIGH_WATERMARK | TAG  | READ_BYTES_PER_SECOND | REMOTE_READ_BYTES_PER_SECOND |\n+-------+------+-----------+--------------+--------------------------+-----------------+----------------+---------------+----------------+-----------------+----------------------------+----------------------------+----------------------+-----------------------+------+-----------------------+------------------------------+\n| 14009 | g1   |      1024 | -1           | true                     |      2147483647 |              0 |             0 | -1             |              -1 |                         -1 |                         -1 | 50%                  | 80%                   |      |                    -1 |                           -1 |\n+-------+------+-----------+--------------+--------------------------+-----------------+----------------+---------------+----------------+-----------------+----------------------------+----------------------------+----------------------+-----------------------+------+-----------------------+------------------------------+\n1 row in set (0.05 sec)\n"})}),"\n",(0,o.jsx)(r.h2,{id:"\u4FEE\u6539-workload-group",children:"\u4FEE\u6539 Workload Group"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"mysql [information_schema]>alter workload group g1 properties('cpu_share'='2048');\nQuery OK, 0 rows affected (0.00 sec\n\nmysql [information_schema]>select cpu_share from information_schema.workload_groups where name='g1';\n+-----------+\n| cpu_share |\n+-----------+\n|      2048 |\n+-----------+\n1 row in set (0.02 sec)\n\n"})}),"\n",(0,o.jsxs)(r.p,{children:["\u53EF\u4EE5\u53C2\u8003\uFF1A",(0,o.jsx)(r.a,{href:"../../sql-manual/sql-statements/cluster-management/compute-management/ALTER-WORKLOAD-GROUP",children:"ALTER-WORKLOAD-GROUP"}),"\u3002"]}),"\n",(0,o.jsx)(r.h2,{id:"\u5220\u9664-workload-group",children:"\u5220\u9664 Workload Group"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"mysql [information_schema]>drop workload group g1;\nQuery OK, 0 rows affected (0.01 sec)\n"})}),"\n",(0,o.jsxs)(r.p,{children:["\u53EF\u4EE5\u53C2\u8003\uFF1A",(0,o.jsx)(r.a,{href:"../../sql-manual/sql-statements/cluster-management/compute-management/DROP-WORKLOAD-GROUP",children:"DROP-WORKLOAD-GROUP"}),"\u3002"]}),"\n",(0,o.jsx)(r.h2,{id:"cpu-\u8F6F\u786C\u9650\u6A21\u5F0F\u5207\u6362\u7684\u8BF4\u660E",children:"CPU \u8F6F\u786C\u9650\u6A21\u5F0F\u5207\u6362\u7684\u8BF4\u660E"}),"\n",(0,o.jsx)(r.p,{children:"\u76EE\u524D Doris \u6682\u4E0D\u652F\u6301\u540C\u65F6\u8FD0\u884C CPU \u7684\u8F6F\u9650\u548C\u786C\u9650\uFF0C\u4E00\u4E2A Doris \u96C6\u7FA4\u5728\u4EFB\u610F\u65F6\u523B\u53EA\u80FD\u662F CPU \u8F6F\u9650\u6216\u8005 CPU \u786C\u9650\u3002\n\u7528\u6237\u53EF\u4EE5\u5728\u4E24\u79CD\u6A21\u5F0F\u4E4B\u95F4\u8FDB\u884C\u5207\u6362\uFF0C\u5207\u6362\u65B9\u6CD5\u5982\u4E0B\uFF1A"}),"\n",(0,o.jsx)(r.p,{children:"1 \u5047\u5982\u5F53\u524D\u7684\u96C6\u7FA4\u914D\u7F6E\u662F\u9ED8\u8BA4\u7684 CPU \u8F6F\u9650\uFF0C\u671F\u671B\u6539\u6210 CPU \u7684\u786C\u9650\uFF0C\u9700\u8981\u628A Workload Group \u7684 cpu_hard_limit \u53C2\u6570\u4FEE\u6539\u6210\u4E00\u4E2A\u6709\u6548\u7684\u503C"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"alter workload group test_group properties ( 'cpu_hard_limit'='20%' );\n"})}),"\n",(0,o.jsx)(r.p,{children:"\u96C6\u7FA4\u4E2D\u6240\u6709\u7684 Workload Group \u90FD\u9700\u8981\u4FEE\u6539\uFF0C\u6240\u6709 Workload Group \u7684 cpu_hard_limit \u7684\u7D2F\u52A0\u503C\u4E0D\u80FD\u8D85\u8FC7 100% \u3002"}),"\n",(0,o.jsx)(r.p,{children:"\u7531\u4E8E CPU \u7684\u786C\u9650\u65E0\u6CD5\u7ED9\u51FA\u4E00\u4E2A\u6709\u6548\u7684\u9ED8\u8BA4\u503C\uFF0C\u56E0\u6B64\u5982\u679C\u53EA\u6253\u5F00\u5F00\u5173\u4F46\u662F\u4E0D\u4FEE\u6539\u5C5E\u6027\uFF0C\u90A3\u4E48 CPU \u7684\u786C\u9650\u4E5F\u65E0\u6CD5\u751F\u6548\u3002"}),"\n",(0,o.jsx)(r.p,{children:"2 \u5728\u6240\u6709 FE \u4E2D\u6253\u5F00 CPU \u786C\u9650\u7684\u5F00\u5173"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:'1 \u4FEE\u6539\u78C1\u76D8\u4E0Afe.conf\u7684\u914D\u7F6E\nexperimental_enable_cpu_hard_limit = true\n2 \u4FEE\u6539\u5185\u5B58\u4E2D\u7684\u914D\u7F6E\nADMIN SET FRONTEND CONFIG ("enable_cpu_hard_limit" = "true");\n'})}),"\n",(0,o.jsx)(r.p,{children:"\u5982\u679C\u7528\u6237\u671F\u671B\u4ECE CPU \u7684\u786C\u9650\u5207\u6362\u56DE CPU \u7684\u8F6F\u9650\uFF0C\u9700\u8981\u5728\u6240\u6709 FE \u4FEE\u6539 enable_cpu_hard_limit \u7684\u503C\u4E3A false \u5373\u53EF\u3002\nCPU \u8F6F\u9650\u7684\u5C5E\u6027 cpu_share \u9ED8\u8BA4\u4F1A\u586B\u5145\u4E00\u4E2A\u6709\u6548\u503C 1024(\u5982\u679C\u4E4B\u524D\u672A\u6307\u5B9A cpu_share \u7684\u503C)\uFF0C\u7528\u6237\u53EF\u4EE5\u6839\u636E group \u7684\u4F18\u5148\u7EA7\u5BF9 cpu_share \u7684\u503C\u8FDB\u884C\u91CD\u65B0\u8C03\u6574\u3002"}),"\n",(0,o.jsx)(r.h2,{id:"\u6548\u679C\u6D4B\u8BD5",children:"\u6548\u679C\u6D4B\u8BD5"}),"\n",(0,o.jsx)(r.h3,{id:"\u5185\u5B58\u786C\u9650",children:"\u5185\u5B58\u786C\u9650"}),"\n",(0,o.jsx)(r.p,{children:"Adhoc \u7C7B\u67E5\u8BE2\u901A\u5E38\u8F93\u5165\u7684 SQL \u4E0D\u786E\u5B9A\uFF0C\u4F7F\u7528\u7684\u5185\u5B58\u8D44\u6E90\u4E5F\u4E0D\u786E\u5B9A\uFF0C\u56E0\u6B64\u5B58\u5728\u5C11\u6570\u67E5\u8BE2\u5360\u7528\u5F88\u5927\u5185\u5B58\u7684\u98CE\u9669\u3002\n\u53EF\u4EE5\u5BF9\u8FD9\u7C7B\u8D1F\u8F7D\u53EF\u4EE5\u5212\u5206\u5230\u72EC\u7ACB\u7684\u5206\u7EC4\uFF0C\u901A\u8FC7 Workload Group \u5BF9\u5185\u5B58\u7684\u786C\u9650\u7684\u529F\u80FD\uFF0C\u907F\u514D\u7A81\u53D1\u6027\u7684\u5927\u67E5\u8BE2\u5360\u6EE1\u6240\u6709\u5185\u5B58\uFF0C\u5BFC\u81F4\u5176\u4ED6\u67E5\u8BE2\u6CA1\u6709\u53EF\u7528\u5185\u5B58\u6216\u8005 OOM\u3002\n\u5F53\u8FD9\u4E2A Workload Group \u7684\u5185\u5B58\u4F7F\u7528\u8D85\u8FC7\u914D\u7F6E\u7684\u786C\u9650\u503C\u65F6\uFF0C\u4F1A\u901A\u8FC7\u6740\u6B7B\u67E5\u8BE2\u7684\u65B9\u5F0F\u91CA\u653E\u5185\u5B58\uFF0C\u907F\u514D\u8FDB\u7A0B\u5185\u5B58\u88AB\u6253\u6EE1\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6D4B\u8BD5\u73AF\u5883"})}),"\n",(0,o.jsx)(r.p,{children:"1FE\uFF0C1BE\uFF0CBE \u914D\u7F6E\u4E3A 96 \u6838\uFF0C\u5185\u5B58\u5927\u5C0F\u4E3A 375G\u3002"}),"\n",(0,o.jsx)(r.p,{children:"\u6D4B\u8BD5\u6570\u636E\u96C6\u4E3A clickbench\uFF0C\u6D4B\u8BD5\u65B9\u6CD5\u4E3A\u4F7F\u7528 jmeter \u8D77\u4E09\u5E76\u53D1\u6267\u884C q29\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6D4B\u8BD5\u4E0D\u5F00\u542F Workload Group \u7684\u5185\u5B58\u786C\u9650"})}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u67E5\u770B\u8FDB\u7A0B\u4F7F\u7528\u5185\u5B58\u3002ps \u547D\u4EE4\u8F93\u51FA\u7B2C\u56DB\u5217\u4EE3\u8868\u8FDB\u7A0B\u4F7F\u7528\u7684\u7269\u7406\u5185\u5B58\u7684\u7528\u91CF\uFF0C\u5355\u4F4D\u4E3A kb\uFF0C\u53EF\u4EE5\u770B\u5230\u5F53\u524D\u6D4B\u8BD5\u8D1F\u8F7D\u4E0B\uFF0C\u8FDB\u7A0B\u7684\u5185\u5B58\u4F7F\u7528\u4E3A 7.7G \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         2.0 7896792\n[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         2.0 7929692\n[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         2.0 8101232\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4F7F\u7528 Doris \u7CFB\u7EDF\u8868\u67E5\u770B\u5F53\u524D Workload Group \u7684\u5185\u5B58\u7528\u91CF\uFF0CWorkload Group \u7684\u5185\u5B58\u7528\u91CF\u4E3A 5.8G \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"mysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+-------------------+\n| wg_mem_used_mb    |\n+-------------------+\n| 5797.524360656738 |\n+-------------------+\n1 row in set (0.01 sec)\n\nmysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+-------------------+\n| wg_mem_used_mb    |\n+-------------------+\n| 5840.246627807617 |\n+-------------------+\n1 row in set (0.02 sec)\n\nmysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+-------------------+\n| wg_mem_used_mb    |\n+-------------------+\n| 5878.394917488098 |\n+-------------------+\n1 row in set (0.02 sec)\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u8FD9\u91CC\u53EF\u4EE5\u770B\u5230\u8FDB\u7A0B\u7684\u5185\u5B58\u4F7F\u7528\u901A\u5E38\u8981\u8FDC\u5927\u4E8E\u4E00\u4E2A Workload Group \u7684\u5185\u5B58\u7528\u91CF\uFF0C\u5373\u4F7F\u8FDB\u7A0B\u5185\u53EA\u6709\u4E00\u4E2A Workload Group \u5728\u8DD1\uFF0C\u8FD9\u662F\u56E0\u4E3A Workload Group \u53EA\u7EDF\u8BA1\u4E86\u67E5\u8BE2\u548C\u90E8\u5206\u5BFC\u5165\u7684\u5185\u5B58\uFF0C\u8FDB\u7A0B\u5185\u7684\u5176\u4ED6\u7EC4\u4EF6\u6BD4\u5982\u5143\u6570\u636E\uFF0C\u5404\u79CD Cache \u7684\u5185\u5B58\u662F\u4E0D\u8BA1\u7B97 Workload Group \u5185\u7684\uFF0C\u4E5F\u4E0D\u7531 Workload Group \u7BA1\u7406\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6D4B\u8BD5\u5F00\u542F Workload Group \u7684\u5185\u5B58\u786C\u9650"})}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u6267\u884C SQL \u547D\u4EE4\u4FEE\u6539\u5185\u5B58\u914D\u7F6E\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"alter workload group g2 properties('memory_limit'='0.5%');\nalter workload group g2 properties('enable_memory_overcommit'='false');\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u6267\u884C\u540C\u6837\u7684\u6D4B\u8BD5\uFF0C\u67E5\u770B\u7CFB\u7EDF\u8868\u7684\u5185\u5B58\u7528\u91CF\uFF0C\u5185\u5B58\u7528\u91CF\u4E3A 1.5G \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"mysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+--------------------+\n| wg_mem_used_mb     |\n+--------------------+\n| 1575.3877239227295 |\n+--------------------+\n1 row in set (0.02 sec)\n\nmysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+------------------+\n| wg_mem_used_mb   |\n+------------------+\n| 1668.77405834198 |\n+------------------+\n1 row in set (0.01 sec)\n\nmysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+--------------------+\n| wg_mem_used_mb     |\n+--------------------+\n| 499.96760272979736 |\n+--------------------+\n1 row in set (0.01 sec)\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4F7F\u7528 ps \u547D\u4EE4\u67E5\u770B\u8FDB\u7A0B\u7684\u5185\u5B58\u7528\u91CF\uFF0C\u5185\u5B58\u7528\u91CF\u4E3A 3.8G \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         1.0 4071364\n[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         1.0 4059012\n[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         1.0 4057068\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u540C\u65F6\u5BA2\u6237\u7AEF\u4F1A\u89C2\u5BDF\u5230\u5927\u91CF\u7531\u4E8E\u5185\u5B58\u4E0D\u8DB3\u5BFC\u81F4\u7684\u67E5\u8BE2\u5931\u8D25\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:'1724074250162,14126,1c_sql,HY000 1105,"java.sql.SQLException: errCode = 2, detailMessage = (127.0.0.1)[MEM_LIMIT_EXCEEDED]GC wg for hard limit, wg id:11201, name:g2, used:1.71 GB, limit:1.69 GB, backend:10.16.10.8. cancel top memory used tracker <Query#Id=4a0689936c444ac8-a0d01a50b944f6e7> consumption 1.71 GB. details:process memory used 3.01 GB exceed soft limit 304.41 GB or sys available memory 101.16 GB less than warning water mark 12.80 GB., Execute again after enough memory, details see be.INFO.",\u5E76\u53D1 1-3,text,false,,444,0,3,3,null,0,0,0\n'})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u8FD9\u4E2A\u62A5\u9519\u4FE1\u606F\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0CWorkload Group \u4F7F\u7528\u4E86 1.7G \u7684\u5185\u5B58\uFF0C\u4F46\u662F Workload Group \u7684\u9650\u5236\u662F 1.69G\uFF0C\u8FD9\u91CC\u7684\u8BA1\u7B97\u65B9\u5F0F\u662F\u8FD9\u6837\u7684 1.69G = \u7269\u7406\u673A\u5185\u5B58 (375) * mem_limit(be.conf \u4E2D\u7684\u503C\uFF0C\u9ED8\u8BA4\u4E3A 0.9) * 0.5%\uFF08Workload Group \u7684\u914D\u7F6E\uFF09\n\u4E5F\u5C31\u662F\u8BF4\uFF0CWorkload Group \u4E2D\u914D\u7F6E\u7684\u5185\u5B58\u767E\u5206\u6BD4\u662F\u57FA\u4E8E Doris \u8FDB\u7A0B\u53EF\u7528\u5185\u5B58\u518D\u6B21\u8FDB\u884C\u8BA1\u7B97\u7684\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u4F7F\u7528\u5EFA\u8BAE"})}),"\n",(0,o.jsx)(r.p,{children:"\u5982\u4E0A\u6587\u6D4B\u8BD5\uFF0C\u786C\u9650\u53EF\u4EE5\u63A7\u5236 Workload Group \u7684\u5185\u5B58\u4F7F\u7528\uFF0C\u4F46\u5374\u662F\u901A\u8FC7\u6740\u6B7B\u67E5\u8BE2\u7684\u65B9\u5F0F\u91CA\u653E\u5185\u5B58\uFF0C\u8FD9\u5BF9\u7528\u6237\u6765\u8BF4\u4F53\u9A8C\u4F1A\u975E\u5E38\u4E0D\u53CB\u597D\uFF0C\u6781\u7AEF\u60C5\u51B5\u4E0B\u53EF\u80FD\u4F1A\u5BFC\u81F4\u6240\u6709\u67E5\u8BE2\u90FD\u5931\u8D25\u3002\n\u56E0\u6B64\u5728\u751F\u4EA7\u73AF\u5883\u4E2D\u63A8\u8350\u5185\u5B58\u786C\u9650\u914D\u5408\u67E5\u8BE2\u6392\u961F\u7684\u529F\u80FD\u4E00\u8D77\u4F7F\u7528\uFF0C\u53EF\u4EE5\u5728\u9650\u5236\u5185\u5B58\u4F7F\u7528\u7684\u540C\u65F6\u4FDD\u8BC1\u67E5\u8BE2\u7684\u6210\u529F\u7387\u3002"}),"\n",(0,o.jsx)(r.h3,{id:"cpu-\u786C\u9650",children:"CPU \u786C\u9650"}),"\n",(0,o.jsx)(r.p,{children:"Doris \u7684\u8D1F\u8F7D\u5927\u4F53\u53EF\u4EE5\u5206\u4E3A\u4E09\u7C7B\uFF1A"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsx)(r.li,{children:"\u6838\u5FC3\u62A5\u8868\u67E5\u8BE2\uFF0C\u901A\u5E38\u7ED9\u516C\u53F8\u9AD8\u5C42\u67E5\u770B\u62A5\u8868\u4F7F\u7528\uFF0C\u8D1F\u8F7D\u4E0D\u4E00\u5B9A\u5F88\u9AD8\uFF0C\u4F46\u662F\u5BF9\u53EF\u7528\u6027\u8981\u6C42\u8F83\u9AD8\uFF0C\u8FD9\u7C7B\u67E5\u8BE2\u53EF\u4EE5\u5212\u5206\u5230\u4E00\u4E2A\u5206\u7EC4\uFF0C\u914D\u7F6E\u8F83\u9AD8\u4F18\u5148\u7EA7\u7684\u8F6F\u9650\uFF0C\u4FDD\u8BC1 CPU \u8D44\u6E90\u4E0D\u591F\u65F6\u53EF\u4EE5\u83B7\u5F97\u66F4\u591A\u7684 CPU \u8D44\u6E90\u3002"}),"\n",(0,o.jsx)(r.li,{children:"Adhoc \u7C7B\u67E5\u8BE2\uFF0C\u8FD9\u7C7B\u67E5\u8BE2\u901A\u5E38\u504F\u63A2\u7D22\u5206\u6790\uFF0CSQL \u6BD4\u8F83\u968F\u673A\uFF0C\u5177\u4F53\u7684\u8D44\u6E90\u7528\u91CF\u4E5F\u6BD4\u8F83\u672A\u77E5\uFF0C\u4F18\u5148\u7EA7\u901A\u5E38\u4E0D\u9AD8\u3002\u56E0\u6B64\u53EF\u4EE5\u4F7F\u7528 CPU \u786C\u9650\u8FDB\u884C\u7BA1\u7406\uFF0C\u5E76\u914D\u7F6E\u8F83\u4F4E\u7684\u503C\uFF0C\u907F\u514D\u5360\u7528\u8FC7\u591A CPU \u8D44\u6E90\u964D\u4F4E\u96C6\u7FA4\u53EF\u7528\u6027\u3002"}),"\n",(0,o.jsx)(r.li,{children:"ETL \u7C7B\u67E5\u8BE2\uFF0C\u8FD9\u7C7B\u67E5\u8BE2\u7684 SQL \u6BD4\u8F83\u56FA\u5B9A\uFF0C\u8D44\u6E90\u7528\u91CF\u901A\u5E38\u4E5F\u6BD4\u8F83\u7A33\u5B9A\uFF0C\u5076\u5C14\u4F1A\u51FA\u73B0\u4E0A\u6E38\u6570\u636E\u91CF\u589E\u957F\u5BFC\u81F4\u8D44\u6E90\u7528\u91CF\u66B4\u6DA8\u7684\u60C5\u51B5\uFF0C\u56E0\u6B64\u53EF\u4EE5\u4F7F\u7528 CPU \u786C\u9650\u8FDB\u884C\u914D\u7F6E\u3002"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u4E0D\u540C\u7684\u8D1F\u8F7D\u5BF9 CPU \u7684\u6D88\u8017\u4E0D\u4E00\u6837\uFF0C\u7528\u6237\u5BF9\u54CD\u5E94\u5EF6\u65F6\u7684\u9700\u6C42\u4E5F\u4E0D\u4E00\u6837\u3002\u5F53 BE \u7684 CPU \u88AB\u7528\u7684\u5F88\u6EE1\u65F6\uFF0C\u53EF\u7528\u6027\u4F1A\u53D8\u5DEE\uFF0C\u54CD\u5E94\u5EF6\u65F6\u4F1A\u53D8\u9AD8\u3002\u6BD4\u5982\u53EF\u80FD\u4E00\u4E2A Adhoc \u7684\u5206\u6790\u7C7B\u67E5\u8BE2\u628A\u6574\u4E2A\u96C6\u7FA4\u7684 CPU \u6253\u6EE1\uFF0C\u5BFC\u81F4\u6838\u5FC3\u62A5\u8868\u7684\u5EF6\u65F6\u53D8\u5927\uFF0C\u5F71\u54CD\u5230\u4E86 SLA\u3002\u6240\u4EE5\u9700\u8981 CPU \u9694\u79BB\u673A\u5236\u6765\u5BF9\u4E0D\u540C\u7684\u4E1A\u52A1\u8FDB\u884C\u9694\u79BB\uFF0C\u4FDD\u969C\u96C6\u7FA4\u7684\u53EF\u7528\u6027\u548C SLA\u3002\nWorkload Group \u652F\u6301 CPU \u7684\u8F6F\u9650\u548C\u786C\u9650\uFF0C\u76EE\u524D\u6BD4\u8F83\u63A8\u8350\u5728\u7EBF\u4E0A\u73AF\u5883\u628A Workload Group \u914D\u7F6E\u6210\u786C\u9650\u3002\u539F\u56E0\u662F CPU \u7684\u8F6F\u9650\u901A\u5E38\u5728 CPU \u88AB\u6253\u6EE1\u65F6\u624D\u80FD\u4F53\u73B0\u51FA\u4F18\u5148\u7EA7\u7684\u4F5C\u7528\uFF0C\u4F46\u662F\u5728 CPU \u88AB\u7528\u6EE1\u65F6\uFF0CDoris \u7684\u5185\u90E8\u7EC4\u4EF6\uFF08\u4F8B\u5982 rpc \u7EC4\u4EF6\uFF09\u4EE5\u53CA\u64CD\u4F5C\u7CFB\u7EDF\u53EF\u7528\u7684 CPU \u4F1A\u51CF\u5C11\uFF0C\u6B64\u65F6\u96C6\u7FA4\u6574\u4F53\u7684\u53EF\u7528\u6027\u662F\u4E0B\u964D\u6BD4\u8F83\u4E25\u91CD\u7684\uFF0C\u56E0\u6B64\u751F\u4EA7\u73AF\u5883\u901A\u5E38\u9700\u8981\u907F\u514D CPU \u8D44\u6E90\u88AB\u6253\u6EE1\u7684\u60C5\u51B5\uFF0C\u5F53\u7136\u5176\u4ED6\u8D44\u6E90\u4E5F\u4E00\u6837\uFF0C\u5185\u5B58\u8D44\u6E90\u540C\u7406\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6D4B\u8BD5\u73AF\u5883"})}),"\n",(0,o.jsx)(r.p,{children:"1FE\uFF0C1BE\uFF0C96 \u6838\u673A\u5668\u3002\n\u6570\u636E\u96C6\u4E3A clickbench\uFF0C\u6D4B\u8BD5 sql \u4E3A q29\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u53D1\u8D77\u6D4B\u8BD5"})}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4F7F\u7528 jmeter \u53D1\u8D77 3 \u5E76\u53D1\u67E5\u8BE2\uFF0C\u628A BE \u8FDB\u7A0B\u7684 CPU \u4F7F\u7528\u538B\u5230\u6BD4\u8F83\u9AD8\u7684\u4F7F\u7528\u7387\uFF0C\u8FD9\u91CC\u6D4B\u8BD5\u7684\u673A\u5668\u662F 96 \u6838\uFF0C\u4F7F\u7528 top \u547D\u4EE4\u770B\u5230 BE \u8FDB\u7A0B CPU \u4F7F\u7528\u7387\u4E3A 7600% \u7684\u542B\u4E49\u662F\u8BE5\u8FDB\u7A0B\u76EE\u524D\u4F7F\u7528\u4E2D\u7684\u6838\u6570\u662F 76 \u4E2A\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{alt:"use workload group cpu",src:e(53982).Z+"",width:"962",height:"146"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4FEE\u6539\u4F7F\u7528\u4E2D\u7684 Workload Group \u7684 CPU \u786C\u9650\u4E3A 10%\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"alter workload group g2 properties('cpu_hard_limit'='10%');\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u96C6\u7FA4\u5F00\u542F\u786C\u9650\u6A21\u5F0F\uFF0C\u6B64\u65F6\u96C6\u7FA4\u4E2D\u6240\u6709 Group \u90FD\u4F1A\u5207\u6362\u4E3A\u786C\u9650\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:'ADMIN SET FRONTEND CONFIG ("enable_cpu_hard_limit" = "true");\n'})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u91CD\u65B0\u538B\u6D4B\u67E5\u8BE2\u8D1F\u8F7D\uFF0C\u53EF\u4EE5\u770B\u5230\u5F53\u524D\u8FDB\u7A0B\u53EA\u80FD\u4F7F\u7528 9 \u5230 10 \u4E2A\u6838\uFF0C\u5360\u603B\u6838\u6570\u7684 10% \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{alt:"use workload group cpu",src:e(665930).Z+"",width:"1138",height:"180"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u8FD9\u91CC\u7684\u6D4B\u8BD5\u6700\u597D\u4F7F\u7528\u67E5\u8BE2\u8D1F\u8F7D\u4F1A\u6BD4\u8F83\u80FD\u4F53\u73B0\u51FA\u6548\u679C\uFF0C\u56E0\u4E3A\u5982\u679C\u662F\u9AD8\u541E\u5410\u5BFC\u5165\u7684\u8BDD\uFF0C\u53EF\u80FD\u4F1A\u89E6\u53D1 Compaction\uFF0C\u4F7F\u5F97\u5B9E\u9645\u89C2\u6D4B\u7684\u503C\u8981\u6BD4 Workload Group \u914D\u7F6E\u7684\u503C\u5927\u3002\u800C Compaction \u7684\u8D1F\u8F7D\u76EE\u524D\u662F\u6CA1\u6709\u5F52\u5165 Workload Group \u7684\u7BA1\u7406\u7684\u3002"}),"\n",(0,o.jsxs)(r.ol,{start:"5",children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u9664\u4E86\u4F7F\u7528 Linux \u7684\u7CFB\u7EDF\u547D\u4EE4\u5916\uFF0C\u8FD8\u53EF\u4EE5\u901A\u8FC7\u4F7F\u7528 Doris \u7684\u7CFB\u7EDF\u8868\u89C2\u5BDF Group \u76EE\u524D\u7684 CPU \u4F7F\u7528\u4E3A 10% \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"mysql [information_schema]>select CPU_USAGE_PERCENT from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+-------------------+\n| CPU_USAGE_PERCENT |\n+-------------------+\n|              9.57 |\n+-------------------+\n1 row in set (0.02 sec)\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6CE8\u610F\u4E8B\u9879"})}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsx)(r.li,{children:"\u5728\u5B9E\u9645\u914D\u7F6E\u7684\u65F6\u5019\uFF0C\u6240\u6709 Group \u7684 CPU \u7D2F\u52A0\u503C\u6700\u597D\u4E0D\u8981\u6B63\u597D\u7B49\u4E8E 100%\uFF0C\u8FD9\u4E3B\u8981\u662F\u4E3A\u4E86\u4FDD\u8BC1\u4F4E\u5EF6\u8FDF\u573A\u666F\u7684\u53EF\u7528\u6027\u3002\u56E0\u4E3A\u9700\u8981\u8BA9\u51FA\u4E00\u90E8\u5206\u8D44\u6E90\u7ED9\u5176\u4ED6\u7EC4\u4EF6\u4F7F\u7528\u3002\u5F53\u7136\u5982\u679C\u5BF9\u5EF6\u8FDF\u4E0D\u662F\u5F88\u654F\u611F\u7684\u573A\u666F\uFF0C\u671F\u671B\u6700\u9AD8\u7684\u8D44\u6E90\u5229\u7528\u7387\uFF0C\u90A3\u4E48\u53EF\u4EE5\u8003\u8651\u6240\u6709 Group \u7684 CPU \u7D2F\u52A0\u503C\u914D\u7F6E\u7B49\u4E8E 100%\u3002"}),"\n",(0,o.jsx)(r.li,{children:"\u76EE\u524D FE \u5411 BE \u540C\u6B65 Workload Group \u5143\u6570\u636E\u7684\u65F6\u95F4\u95F4\u9694\u4E3A 30 \u79D2\uFF0C\u56E0\u6B64\u5BF9\u4E8E Workload Group \u7684\u53D8\u66F4\u6700\u5927\u9700\u8981\u7B49\u5F85 30 \u79D2\u624D\u80FD\u751F\u6548\u3002"}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"\u672C\u5730-io-\u786C\u9650",children:"\u672C\u5730 IO \u786C\u9650"}),"\n",(0,o.jsx)(r.p,{children:"OLAP \u7CFB\u7EDF\u5728\u505A ETL \u6216\u8005\u5927\u7684 Adhoc \u67E5\u8BE2\u65F6\uFF0C\u9700\u8981\u8BFB\u53D6\u5927\u91CF\u7684\u6570\u636E\uFF0CDoris \u4E3A\u4E86\u52A0\u901F\u6570\u636E\u5206\u6790\u8FC7\u7A0B\uFF0C\u5185\u90E8\u4F1A\u4F7F\u7528\u591A\u7EBF\u7A0B\u5E76\u884C\u7684\u65B9\u5F0F\u5BF9\u591A\u4E2A\u78C1\u76D8\u6587\u4EF6\u626B\u63CF\uFF0C\u4F1A\u4EA7\u751F\u5DE8\u5927\u7684\u78C1\u76D8 IO\uFF0C\u5C31\u4F1A\u5BF9\u5176\u4ED6\u7684\u67E5\u8BE2\uFF08\u6BD4\u5982\u62A5\u8868\u5206\u6790\uFF09\u4EA7\u751F\u5F71\u54CD\u3002\n\u53EF\u4EE5\u901A\u8FC7 Workload Group \u5BF9\u79BB\u7EBF\u7684 ETL \u6570\u636E\u5904\u7406\u548C\u5728\u7EBF\u7684\u62A5\u8868\u67E5\u8BE2\u505A\u5206\u7EC4\uFF0C\u9650\u5236\u79BB\u7EBF\u6570\u636E\u5904\u7406 IO \u5E26\u5BBD\u7684\u65B9\u5F0F\uFF0C\u964D\u4F4E\u5B83\u5BF9\u5728\u7EBF\u62A5\u8868\u5206\u6790\u7684\u5F71\u54CD\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6D4B\u8BD5\u73AF\u5883"})}),"\n",(0,o.jsx)(r.p,{children:"1FE,1BE, \u914D\u7F6E\u4E3A 96 \u6838\u3002"}),"\n",(0,o.jsx)(r.p,{children:"\u6D4B\u8BD5\u6570\u636E\u96C6\u4E3A clickbench\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u4E0D\u5F00\u542F IO \u786C\u9650\u6D4B\u8BD5"})}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u5173\u95ED\u7F13\u5B58\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"// \u6E05\u7A7A\u64CD\u4F5C\u7CFB\u7EDF\u7F13\u5B58\nsync; echo 3 > /proc/sys/vm/drop_caches\n\n// \u7981\u7528 BE \u7684 page cache\ndisable_storage_page_cache = true\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u5BF9 clickbench \u7684\u8868\u6267\u884C\u5168\u8868\u626B\u63CF\uFF0C\u6267\u884C\u5355\u5E76\u53D1\u67E5\u8BE2\u5373\u53EF\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"set dry_run_query = true;\nselect * from hits.hits;\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u901A\u8FC7 Doris \u7684\u5185\u8868\u67E5\u770B\u5F53\u524D Group \u7684\u6700\u5927\u541E\u5410\u4E3A 3GB \u6BCF\u79D2\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"mysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 1146.6208400726318 |\n+--------------------+\n1 row in set (0.03 sec)\n\nmysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 3496.2762966156006 |\n+--------------------+\n1 row in set (0.04 sec)\n\nmysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 2192.7690029144287 |\n+--------------------+\n1 row in set (0.02 sec)\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4F7F\u7528 pidstat \u547D\u4EE4\u67E5\u770B\u8FDB\u7A0B IO\uFF0C\u56FE\u4E2D\u7B2C\u4E00\u5217\u662F\u8FDB\u7A0B id\uFF0C\u7B2C\u4E8C\u5217\u662F\u8BFB IO \u7684\u541E\u5410\uFF08\u5355\u4F4D\u662F kb/s\uFF09\u3002\u53EF\u4EE5\u770B\u5230\u4E0D\u9650\u5236 IO \u65F6\uFF0C\u6700\u5927\u541E\u5410\u4E3A 2G \u6BCF\u79D2\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{alt:"use workload group io",src:e(715719).Z+"",width:"814",height:"1080"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u5F00\u542F IO \u786C\u9650\u540E\u6D4B\u8BD5"})}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u5173\u95ED\u7F13\u5B58\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"// \u6E05\u7A7A\u64CD\u4F5C\u7CFB\u7EDF\u7F13\u5B58\nsync; echo 3 > /proc/sys/vm/drop_caches\n\n// \u7981\u7528 BE \u7684 page cache\ndisable_storage_page_cache = true\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4FEE\u6539 Workload Group \u7684\u914D\u7F6E\uFF0C\u9650\u5236\u6BCF\u79D2\u6700\u5927\u541E\u5410\u4E3A 100M\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"// \u9650\u5236\u5F53\u524D Group \u7684\u8BFB\u541E\u5410\u4E3A\u6BCF\u79D2 100M\nalter workload group g2 properties('read_bytes_per_second'='104857600');\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4F7F\u7528 Doris \u7CFB\u7EDF\u8868\u67E5\u770B Workload Group \u7684\u6700\u5927 IO \u541E\u5410\u4E3A\u6BCF\u79D2 98M\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"mysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 97.94296646118164  |\n+--------------------+\n1 row in set (0.03 sec)\n\nmysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 98.37584781646729  |\n+--------------------+\n1 row in set (0.04 sec)\n\nmysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 98.06641292572021  |\n+--------------------+\n1 row in set (0.02 sec)\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4F7F\u7528 pid \u5DE5\u5177\u67E5\u770B\u8FDB\u7A0B\u6700\u5927 IO \u541E\u5410\u4E3A\u6BCF\u79D2 131M\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{alt:"use workload group io",src:e(579239).Z+"",width:"808",height:"676"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6CE8\u610F\u4E8B\u9879"})}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u7CFB\u7EDF\u8868\u4E2D\u7684 LOCAL_SCAN_BYTES_PER_SECOND \u5B57\u6BB5\u4EE3\u8868\u7684\u662F\u5F53\u524D Workload Group \u5728\u8FDB\u7A0B\u7C92\u5EA6\u7684\u7EDF\u8BA1\u6C47\u603B\u503C\uFF0C\u6BD4\u5982\u914D\u7F6E\u4E86 12 \u4E2A\u6587\u4EF6\u8DEF\u5F84\uFF0C\u90A3\u4E48 LOCAL_SCAN_BYTES_PER_SECOND \u5C31\u662F\u8FD9 12 \u4E2A\u6587\u4EF6\u8DEF\u5F84 IO \u7684\u6700\u5927\u503C\uFF0C\u5982\u679C\u671F\u671B\u67E5\u770B\u6BCF\u4E2A\u6587\u4EF6\u8DEF\u5F84\u5206\u522B\u7684 IO \u541E\u5410\uFF0C\u53EF\u4EE5\u5728 grafana \u76D1\u63A7\u67E5\u770B\u660E\u7EC6\u7684\u503C\u3002"}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u7531\u4E8E\u64CD\u4F5C\u7CFB\u7EDF\u548C Doris \u7684 Page Cache \u7684\u5B58\u5728\uFF0C\u901A\u8FC7 linux \u7684 IO \u76D1\u63A7\u811A\u672C\u770B\u5230\u7684 IO \u901A\u5E38\u8981\u6BD4\u7CFB\u7EDF\u8868\u770B\u5230\u7684\u8981\u5C0F\u3002"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"\u8FDC\u7A0B-io-\u786C\u9650",children:"\u8FDC\u7A0B IO \u786C\u9650"}),"\n",(0,o.jsx)(r.p,{children:"BrokerLoad \u548C S3Load \u662F\u5E38\u7528\u7684\u5927\u6279\u91CF\u6570\u636E\u5BFC\u5165\u65B9\u5F0F\uFF0C\u7528\u6237\u53EF\u4EE5\u628A\u6570\u636E\u5148\u4E0A\u4F20\u5230 HDFS \u6216\u8005 S3\uFF0C\u7136\u540E\u901A\u8FC7 Brokerload \u548C S3Load \u5BF9\u6570\u636E\u8FDB\u884C\u5E76\u884C\u5BFC\u5165\u3002Doris \u4E3A\u4E86\u52A0\u5FEB\u5BFC\u5165\u901F\u5EA6\uFF0C\u4F1A\u4F7F\u7528\u591A\u7EBF\u7A0B\u5E76\u884C\u7684\u65B9\u5F0F\u4ECE HDFS/S3 \u62C9\u53D6\u6570\u636E\uFF0C\u6B64\u65F6\u4F1A\u5BF9 HDFS/S3 \u4EA7\u751F\u5DE8\u5927\u7684\u538B\u529B\uFF0C\u4F1A\u5BFC\u81F4 HDFS/S3 \u4E0A\u8FD0\u884C\u7684\u522B\u7684\u4F5C\u4E1A\u4E0D\u7A33\u5B9A\u3002\n\u53EF\u4EE5\u901A\u8FC7 Workload Group \u8FDC\u7A0B IO \u7684\u9650\u5236\u529F\u80FD\u6765\u9650\u5236\u5BFC\u5165\u8FC7\u7A0B\u4E2D\u5BF9 HDFS/S3 \u7684\u5E26\u5BBD\uFF0C\u964D\u4F4E\u5BF9\u5176\u4ED6\u4E1A\u52A1\u7684\u5F71\u54CD\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6D4B\u8BD5\u73AF\u5883"})}),"\n",(0,o.jsx)(r.p,{children:"1FE\uFF0C1BE \u90E8\u7F72\u5728\u540C\u4E00\u53F0\u673A\u5668\uFF0C\u914D\u7F6E\u4E3A 16 \u6838 64G \u5185\u5B58\u3002\u6D4B\u8BD5\u6570\u636E\u4E3A clickbench \u6570\u636E\u96C6\uFF0C\u6D4B\u8BD5\u524D\u9700\u8981\u628A\u6570\u636E\u96C6\u4E0A\u4F20\u5230 S3 \u4E0A\u3002\u8003\u8651\u5230\u4E0A\u4F20\u65F6\u95F4\u7684\u95EE\u9898\uFF0C\u6211\u4EEC\u53EA\u53D6\u5176\u4E2D\u7684 1 \u5343\u4E07\u884C\u6570\u636E\u4E0A\u4F20\uFF0C\u7136\u540E\u4F7F\u7528 tvf \u7684\u529F\u80FD\u67E5\u8BE2 s3 \u7684\u6570\u636E\u3002"}),"\n",(0,o.jsx)(r.p,{children:"\u4E0A\u4F20\u6210\u529F\u540E\u53EF\u4EE5\u4F7F\u7528\u547D\u4EE4\u67E5\u770B Schema \u4FE1\u606F\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:'```sql\n// \u67E5\u770Bschema\nDESC FUNCTION s3 (\n    "URI" = "https://bucketname/1kw.tsv",\n    "s3.access_key"= "ak",\n    "s3.secret_key" = "sk",\n    "format" = "csv",\n    "use_path_style"="true"\n);\n```\n'})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6D4B\u8BD5\u4E0D\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684 IO"})}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u53D1\u8D77\u5355\u5E76\u53D1\u6D4B\u8BD5\uFF0C\u5168\u8868\u626B\u63CF clickbench \u8868\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:'// \u8BBE\u7F6E\u53EA scan \u6570\u636E\uFF0C\u4E0D\u8FD4\u56DE\u7ED3\u679C\nset dry_run_query = true;\n\n// \u4F7F\u7528 tvf \u67E5\u8BE2 s3 \u7684\u6570\u636E\nSELECT * FROM s3(\n    "URI" = "https://bucketname/1kw.tsv",\n    "s3.access_key"= "ak",\n    "s3.secret_key" = "sk",\n    "format" = "csv",\n    "use_path_style"="true"\n);\n'})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4F7F\u7528\u7CFB\u7EDF\u8868\u67E5\u770B\u6B64\u65F6\u7684\u8FDC\u7A0B IO \u541E\u5410\u3002\u53EF\u4EE5\u770B\u5230\u8FD9\u4E2A\u67E5\u8BE2\u7684\u8FDC\u7A0B IO \u541E\u5410\u4E3A 837M \u6BCF\u79D2\uFF0C\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u8FD9\u91CC\u7684\u5B9E\u9645 IO \u541E\u5410\u53D7\u73AF\u5883\u5F71\u54CD\u8F83\u5927\uFF0C\u5982\u679C BE \u6240\u5728\u7684\u673A\u5668\u8FDE\u63A5\u5916\u90E8\u5B58\u50A8\u7684\u5E26\u5BBD\u6BD4\u8F83\u4F4E\uFF0C\u90A3\u4E48\u53EF\u80FD\u5B9E\u9645\u7684\u541E\u5410\u4F1A\u5C0F\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"MySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     837 |\n+---------+\n1 row in set (0.104 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     867 |\n+---------+\n1 row in set (0.070 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     867 |\n+---------+\n1 row in set (0.186 sec)\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4F7F\u7528 sar(sar -n DEV 1 3600) \u547D\u4EE4\u67E5\u770B\u673A\u5668\u7684\u7F51\u7EDC\u5E26\u5BBD\uFF0C\u53EF\u4EE5\u770B\u5230\u673A\u5668\u7EA7\u522B\u6700\u5927\u7F51\u7EDC\u5E26\u5BBD\u4E3A 1033M \u6BCF\u79D2\u3002\n\u8F93\u51FA\u7684\u7B2C\u4E00\u5217\u4E3A\u5F53\u524D\u673A\u5668\u67D0\u4E2A\u7F51\u5361\u6BCF\u79D2\u63A5\u6536\u7684\u5B57\u8282\u6570\uFF0C\u5355\u4F4D\u4E3A KB \u6BCF\u79D2\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{alt:"use workload group rio",src:e(716653).Z+"",width:"960",height:"436"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6D4B\u8BD5\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684 IO"})}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4FEE\u6539 Workload Group \u7684\u914D\u7F6E\uFF0C\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684 IO \u541E\u5410\u4E3A 100M \u6BCF\u79D2\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"alter workload group normal properties('remote_read_bytes_per_second'='104857600');\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u53D1\u8D77\u5355\u5E76\u53D1\u626B\u5168\u8868\u7684\u67E5\u8BE2\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:'// \u8BBE\u7F6E\u53EA scan \u6570\u636E\uFF0C\u4E0D\u8FD4\u56DE\u7ED3\u679C\nset dry_run_query = true;\n\n// \u4F7F\u7528 tvf \u67E5\u8BE2 s3 \u7684\u6570\u636E\nSELECT * FROM s3(\n    "URI" = "https://bucketname/1kw.tsv",\n    "s3.access_key"= "ak",\n    "s3.secret_key" = "sk",\n    "format" = "csv",\n    "use_path_style"="true"\n);\n'})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4F7F\u7528\u7CFB\u7EDF\u8868\u67E5\u770B\u6B64\u65F6\u7684\u8FDC\u7A0B\u8BFB IO \u541E\u5410\uFF0C\u6B64\u65F6\u7684 IO \u541E\u5410\u5728 100M \u5DE6\u53F3\uFF0C\u4F1A\u6709\u4E00\u5B9A\u7684\u6CE2\u52A8\uFF0C\u8FD9\u4E2A\u6CE2\u52A8\u662F\u53D7\u76EE\u524D\u7B97\u6CD5\u8BBE\u8BA1\u7684\u5F71\u54CD\uFF0C\u901A\u5E38\u4F1A\u6709\u4E00\u4E2A\u9AD8\u5CF0\uFF0C\u4F46\u4E0D\u4F1A\u6301\u7EED\u5F88\u957F\u65F6\u95F4\uFF0C\u5C5E\u4E8E\u6B63\u5E38\u60C5\u51B5\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"MySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|      56 |\n+---------+\n1 row in set (0.010 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     131 |\n+---------+\n1 row in set (0.009 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     111 |\n+---------+\n1 row in set (0.009 sec)\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"\u4F7F\u7528 sar \u547D\u4EE4\uFF08sar -n DEV 1 3600\uFF09\u67E5\u770B\u76EE\u524D\u7684\u7F51\u5361\u63A5\u6536\u6D41\u91CF\uFF0C\u7B2C\u4E00\u5217\u4E3A\u6BCF\u79D2\u63A5\u6536\u7684\u6570\u636E\u91CF\uFF0C\u53EF\u4EE5\u770B\u5230\u6700\u5927\u503C\u53D8\u6210\u4E86 207M \u6BCF\u79D2\uFF0C\u8BF4\u660E\u8BFB IO \u7684\u9650\u5236\u662F\u751F\u6548\u7684\uFF0C\u4F46\u662F\u7531\u4E8E sar \u547D\u4EE4\u770B\u5230\u7684\u662F\u673A\u5668\u7EA7\u522B\u7684\u6D41\u91CF\uFF0C\u56E0\u6B64\u8981\u6BD4 Doris \u7EDF\u8BA1\u5230\u7684\u4F1A\u5927\u4E00\u4E9B\u3002"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{alt:"use workload group rio",src:e(674967).Z+"",width:"864",height:"472"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"\u5E38\u89C1\u95EE\u9898",children:"\u5E38\u89C1\u95EE\u9898"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsx)(r.li,{children:"\u4E3A\u4EC0\u4E48\u914D\u7F6E\u4E86 CPU \u7684\u786C\u9650\u4F46\u662F\u6CA1\u6709\u751F\u6548\uFF1F"}),"\n"]}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["\u901A\u5E38\u6709\u4EE5\u4E0B\u51E0\u79CD\u539F\u56E0\uFF1A\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["\u73AF\u5883\u521D\u59CB\u5316\u5931\u8D25\uFF0C\u9700\u8981\u68C0\u67E5 Doris CGroup \u8DEF\u5F84\u4E0B\u7684\u4E24\u4E2A\u914D\u7F6E\u6587\u4EF6\uFF0C\u8FD9\u91CC\u4EE5 CGroup V1 \u7248\u672C\u4E3A\u4F8B\uFF0C\u5982\u679C\u7528\u6237\u6307\u5B9A\u7684 Doris \u7684 CGroup \u8DEF\u5F84\u4E3A",(0,o.jsx)(r.code,{children:"/sys/fs/cgroup/cpu/doris/"}),"\uFF0C\n\u90A3\u4E48\u9996\u5148\u9700\u8981\u53BB\u67E5\u770B",(0,o.jsx)(r.code,{children:"/sys/fs/cgroup/cpu/doris/query/1/tasks"}),"\u6587\u4EF6\u7684\u5185\u5BB9\u662F\u5426\u5305\u542B\u5BF9\u5E94 Workload Group \u7684\u7EBF\u7A0B\u53F7\uFF0C\u8DEF\u5F84\u4E2D\u7684 1 \u4EE3\u8868\u7684\u662F Workload Group \u7684 id\uFF0C\u53EF\u4EE5\u901A\u8FC7",(0,o.jsx)(r.code,{children:"top -H -b -n 1 -p pid"}),"\u7684\u547D\u4EE4\u83B7\u5F97\u8BE5\nWorkload Group \u7684\u7EBF\u7A0B\u53F7\uFF0C\u901A\u8FC7\u5BF9\u6BD4\u786E\u8BA4\u8BE5 Workload Group \u7684\u7EBF\u7A0B\u53F7\u90FD\u5199\u5165\u5230 tasks \u6587\u4EF6\u4E2D\uFF1B\u7136\u540E\u662F\u770B\u4E0B",(0,o.jsx)(r.code,{children:"/sys/fs/cgroup/cpu/doris/query/1/cpu.cfs_quota_us"}),"\u6587\u4EF6\u7684\u503C\u662F\u5426\u4E3A -1\uFF0C\u5982\u679C\u4E3A -1 \u5C31\u8BF4\u660E CPU \u786C\u9650\u7684\u914D\u7F6E\u6CA1\u6709\u751F\u6548\u3002"]}),"\n",(0,o.jsxs)(r.li,{children:["Doris BE \u8FDB\u7A0B\u7684 CPU \u4F7F\u7528\u7387\u9AD8\u4E8E Workload Group \u914D\u7F6E\u7684 CPU \u786C\u9650\uFF0C\u8FD9\u79CD\u60C5\u51B5\u662F\u7B26\u5408\u9884\u671F\u7684\uFF0C\u56E0\u4E3A Workload Group \u53EF\u4EE5\u7BA1\u7406\u7684 CPU \u4E3B\u8981\u662F\u67E5\u8BE2\u7EBF\u7A0B\u548C\u5BFC\u5165\u7684 memtable \u4E0B\u5237\u7EBF\u7A0B\uFF0C\u4F46\u662F BE \u8FDB\u7A0B\u5185\u901A\u5E38\u8FD8\u4F1A\u6709\u5176\u4ED6\u7EC4\u4EF6\u4E5F\u4F1A\u6D88\u8017 CPU\uFF0C\n\u6BD4\u5982 Compaction\uFF0C\u56E0\u6B64\u8FDB\u7A0B\u7684 CPU \u4F7F\u7528\u901A\u5E38\u8981\u9AD8\u4E8E Workload Group \u7684\u914D\u7F6E\u3002\u53EF\u4EE5\u521B\u5EFA\u4E00\u4E2A\u6D4B\u8BD5\u7684 Workload Group\uFF0C\u53EA\u538B\u6D4B\u67E5\u8BE2\u8D1F\u8F7D\uFF0C\u7136\u540E\u901A\u8FC7\u7CFB\u7EDF\u8868",(0,o.jsx)(r.code,{children:"information_schema.workload_group_resource_usage"}),"\u67E5\u770B Workload Group \u7684\nCPU \u4F7F\u7528\uFF0C\u8FD9\u4E2A\u8868\u53EA\u8BB0\u5F55\u4E86 Workload Group \u7684 CPU \u4F7F\u7528\u7387\uFF0C\u4ECE 2.1.6 \u7248\u672C\u5F00\u59CB\u652F\u6301\u3002"]}),"\n",(0,o.jsxs)(r.li,{children:["\u6709\u7528\u6237\u914D\u7F6E\u4E86\u53C2\u6570",(0,o.jsx)(r.code,{children:"cpu_resource_limit"}),"\uFF0C\u9996\u5148\u901A\u8FC7\u6267\u884C",(0,o.jsx)(r.code,{children:"show property for jack like 'cpu_resource_limit';"}),"\u786E\u8BA4\u7528\u6237 jack \u5C5E\u6027\u4E2D\u662F\u5426\u8BBE\u7F6E\u4E86\u8BE5\u53C2\u6570\uFF1B\n\u7136\u540E\u901A\u8FC7\u6267\u884C",(0,o.jsx)(r.code,{children:"show variables like 'cpu_resource_limit'"})," \u786E\u8BA4session\u53D8\u91CF\u4E2D\u662F\u5426\u8BBE\u7F6E\u4E86\u8BE5\u53C2\u6570\uFF1B\u8BE5\u53C2\u6570\u9ED8\u8BA4\u503C\u4E3A-1\uFF0C\u4EE3\u8868\u672A\u8BBE\u7F6E\u3002\n\u914D\u7F6E\u4E86\u8FD9\u4E2A\u53C2\u6570\u4E4B\u540E\uFF0C\u67E5\u8BE2\u8D70\u7684\u662F\u72EC\u7ACB\u7684\u7EBF\u7A0B\u6C60\uFF0C\u8BE5\u7EBF\u7A0B\u6C60\u4E0D\u53D7 Workload Group \u7684\u7BA1\u7406\u3002\u76F4\u63A5\u4FEE\u6539\u8FD9\u4E2A\u53C2\u6570\u53EF\u80FD\u4F1A\u5F71\u54CD\u751F\u4EA7\u73AF\u5883\u7684\u7A33\u5B9A\u6027\uFF0C\n\u53EF\u4EE5\u8003\u8651\u9010\u6B65\u7684\u628A\u914D\u7F6E\u4E86\u8BE5\u53C2\u6570\u7684\u67E5\u8BE2\u8D1F\u8F7D\u8FC1\u79FB\u5230 Workload Group \u4E2D\u7BA1\u7406\uFF0C\u8FD9\u4E2A\u53C2\u6570\u76EE\u524D\u7684\u5E73\u66FF\u662F session \u53D8\u91CF ",(0,o.jsx)(r.code,{children:"num_scanner_threads"})," \u3002\u4E3B\u8981\u6D41\u7A0B\u662F\uFF0C\u5148\u628A\u914D\u7F6E\u4E86 ",(0,o.jsx)(r.code,{children:"cpu_resource_limit"})," \u7684\u7528\u6237\u5206\u6210\u82E5\u5E72\u6279\u6B21\uFF0C\n\u8FC1\u79FB\u7B2C\u4E00\u6279\u7528\u6237\u7684\u65F6\u5019\uFF0C\u9996\u5148\u4FEE\u6539\u8FD9\u90E8\u5206\u7528\u6237\u7684 session \u53D8\u91CF ",(0,o.jsx)(r.code,{children:"num_scanner_threads"})," \u4E3A 1\uFF0C\u7136\u540E\u4E3A\u8FD9\u4E9B\u7528\u6237\u6307\u5B9A Workload Group\uFF0C\u63A5\u7740\u628A ",(0,o.jsx)(r.code,{children:"cpu_resource_limit"})," \u4FEE\u6539\u4E3A -1\uFF0C\n\u89C2\u5BDF\u4E00\u6BB5\u65F6\u95F4\u96C6\u7FA4\u662F\u5426\u7A33\u5B9A\uFF0C\u5982\u679C\u7A33\u5B9A\u5C31\u7EE7\u7EED\u8FC1\u79FB\u4E0B\u4E00\u6279\u7528\u6237\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(r.ol,{start:"2",children:["\n",(0,o.jsx)(r.li,{children:"\u4E3A\u4EC0\u4E48\u9ED8\u8BA4\u7684 Workload Group \u7684\u4E2A\u6570\u88AB\u9650\u5236\u4E3A 15 \u4E2A\uFF1F"}),"\n"]}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["Workload Group \u4E3B\u8981\u662F\u5BF9\u5355\u673A\u8D44\u6E90\u7684\u5212\u5206\uFF0C\u4E00\u4E2A\u673A\u5668\u4E0A\u5982\u679C\u5212\u5206\u4E86\u8FC7\u591A\u7684 Workload Group\uFF0C\u90A3\u4E48\u6BCF\u4E2A Workload Group \u90FD\u53EA\u80FD\u5206\u5230\u5F88\u5C11\u7684\u8D44\u6E90\u3002\n\u5982\u679C\u4E1A\u52A1\u786E\u5B9E\u9700\u8981\u5EFA\u8FD9\u4E48\u591A\u7684 Workload Group\uFF0C\u90A3\u4E48\u53EF\u4EE5\u8003\u8651\u628A\u4E00\u4E2A\u96C6\u7FA4\u5212\u5206\u4E3A\u591A\u7EC4\u4E0D\u540C\u7684 BE\uFF0C\u7136\u540E\u4E3A\u6BCF\u7EC4 BE \u521B\u5EFA\u4E0D\u540C\u7684 Workload Group\u3002\n\u4E5F\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539 FE \u7684\u914D\u7F6E ",(0,o.jsx)(r.code,{children:"workload_group_max_num"})," \u6765\u4E34\u65F6\u7ED5\u5F00\u8FD9\u4E2A\u9650\u5236\u3002"]}),"\n"]}),"\n",(0,o.jsxs)(r.ol,{start:"3",children:["\n",(0,o.jsx)(r.li,{children:'\u4E3A\u4EC0\u4E48\u914D\u7F6E\u4E86\u8F83\u591A Workload Group \u4E4B\u540E\u4F1A\u62A5\u9519"Resource temporarily unavailable"\uFF1F'}),"\n"]}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"\u6BCF\u4E2A Workload Group \u90FD\u662F\u4E00\u7EC4\u72EC\u7ACB\u7684\u7EBF\u7A0B\u6C60\uFF0C\u521B\u5EFA\u8FC7\u591A\u7684 Workload Group \u53EF\u80FD\u4F1A\u5BFC\u81F4 BE \u8FDB\u7A0B\u5C1D\u8BD5\u542F\u52A8\u8FC7\u591A\u7684\u7EBF\u7A0B\uFF0C\u8D85\u8FC7\u64CD\u4F5C\u7CFB\u7EDF\u5141\u8BB8\u7684\u8FDB\u7A0B\u7684\u53EF\u7528\u7EBF\u7A0B\u6570\u4E0A\u9650\u3002\n\u9047\u5230\u8FD9\u4E2A\u95EE\u9898\u901A\u5E38\u4FEE\u6539\u64CD\u4F5C\u7CFB\u7EDF\u7684\u73AF\u5883\u914D\u7F6E\uFF0C\u5141\u8BB8 BE \u8FDB\u7A0B\u53EF\u4EE5\u521B\u5EFA\u66F4\u591A\u7684\u7EBF\u7A0B\u3002"}),"\n"]})]})}function h(n={}){let{wrapper:r}={...(0,l.a)(),...n.components};return r?(0,o.jsx)(r,{...n,children:(0,o.jsx)(p,{...n})}):p(n)}},53982:function(n,r,e){e.d(r,{Z:function(){return s}});let s=e.p+"assets/images/use_wg_cpu_1-6211d7170720ad508590d94cf72724e3.png"},665930:function(n,r,e){e.d(r,{Z:function(){return s}});let s=e.p+"assets/images/use_wg_cpu_2-03419ba3e02b1980179a1af557d41d1c.png"},715719:function(n,r,e){e.d(r,{Z:function(){return s}});let s=e.p+"assets/images/use_wg_io_1-15b5d3e97f7ccf7f914eef0e6bf55cd4.png"},579239:function(n,r,e){e.d(r,{Z:function(){return s}});let s=e.p+"assets/images/use_wg_io_2-2202fea206c596a3879c6660ada71037.png"},716653:function(n,r,e){e.d(r,{Z:function(){return s}});let s=e.p+"assets/images/use_wg_rio_1-e3ae321d5e709bb0ba21b9572d2bce1f.png"},674967:function(n,r,e){e.d(r,{Z:function(){return s}});let s=e.p+"assets/images/use_wg_rio_2-7511c9afedf43b931909b18e529f00ea.png"},356631:function(n,r,e){e.d(r,{Z:function(){return s}});let s=e.p+"assets/images/workload_group_arch-8a340fcf78d446415148216722775065.png"},250065:function(n,r,e){e.d(r,{Z:function(){return c},a:function(){return d}});var s=e(667294);let o={},l=s.createContext(o);function d(n){let r=s.useContext(l);return s.useMemo(function(){return"function"==typeof n?n(r):{...r,...n}},[r,n])}function c(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:d(n.components),s.createElement(l.Provider,{value:r},n.children)}}}]);