"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["107172"],{514348:function(e,a,l){l.r(a),l.d(a,{default:()=>h,frontMatter:()=>o,metadata:()=>c,assets:()=>t,toc:()=>d,contentTitle:()=>i});var c=JSON.parse('{"id":"admin-manual/trouble-shooting/memory-management/memory-analysis/jemalloc-memory-analysis","title":"Jemalloc \u5185\u5B58\u5206\u6790","description":"Doris \u9ED8\u8BA4\u4F7F\u7528 Jemalloc \u4F5C\u4E3A\u901A\u7528\u5185\u5B58\u5206\u914D\u5668\uFF0CJemalloc \u81EA\u8EAB\u5360\u7528\u7684\u5185\u5B58\u5305\u62EC Cache \u548C Metadata \u4E24\u90E8\u5206\uFF0C\u5176\u4E2D Cache \u5305\u62EC Thread Cache \u548C Dirty Page \u4E24\u90E8\u5206\uFF0C","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-2.1/admin-manual/trouble-shooting/memory-management/memory-analysis/jemalloc-memory-analysis.md","sourceDirName":"admin-manual/trouble-shooting/memory-management/memory-analysis","slug":"/admin-manual/trouble-shooting/memory-management/memory-analysis/jemalloc-memory-analysis","permalink":"/zh-CN/docs/2.1/admin-manual/trouble-shooting/memory-management/memory-analysis/jemalloc-memory-analysis","draft":false,"unlisted":false,"tags":[],"version":"2.1","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Jemalloc \u5185\u5B58\u5206\u6790","language":"zh-CN","description":"Doris \u9ED8\u8BA4\u4F7F\u7528 Jemalloc \u4F5C\u4E3A\u901A\u7528\u5185\u5B58\u5206\u914D\u5668\uFF0CJemalloc \u81EA\u8EAB\u5360\u7528\u7684\u5185\u5B58\u5305\u62EC Cache \u548C Metadata \u4E24\u90E8\u5206\uFF0C\u5176\u4E2D Cache \u5305\u62EC Thread Cache \u548C Dirty Page \u4E24\u90E8\u5206\uFF0C"},"sidebar":"docs","previous":{"title":"\u5185\u5B58\u95EE\u9898 FAQ","permalink":"/zh-CN/docs/2.1/admin-manual/trouble-shooting/memory-management/memory-issue-faq"},"next":{"title":"\u5168\u5C40\u5185\u5B58\u5206\u6790","permalink":"/zh-CN/docs/2.1/admin-manual/trouble-shooting/memory-management/memory-analysis/global-memory-analysis"}}'),n=l("785893"),r=l("250065");let o={title:"Jemalloc \u5185\u5B58\u5206\u6790",language:"zh-CN",description:"Doris \u9ED8\u8BA4\u4F7F\u7528 Jemalloc \u4F5C\u4E3A\u901A\u7528\u5185\u5B58\u5206\u914D\u5668\uFF0CJemalloc \u81EA\u8EAB\u5360\u7528\u7684\u5185\u5B58\u5305\u62EC Cache \u548C Metadata \u4E24\u90E8\u5206\uFF0C\u5176\u4E2D Cache \u5305\u62EC Thread Cache \u548C Dirty Page \u4E24\u90E8\u5206\uFF0C"},i=void 0,t={},d=[{value:"Jemalloc Cache \u5185\u5B58\u5206\u6790",id:"jemalloc-cache-\u5185\u5B58\u5206\u6790",level:2},{value:"Jemalloc Cache \u67E5\u770B\u65B9\u6CD5",id:"jemalloc-cache-\u67E5\u770B\u65B9\u6CD5",level:3},{value:"Thread Cache \u5185\u5B58\u8FC7\u5927",id:"thread-cache-\u5185\u5B58\u8FC7\u5927",level:3},{value:"Dirty Page \u5185\u5B58\u8FC7\u5927",id:"dirty-page-\u5185\u5B58\u8FC7\u5927",level:3},{value:"Jemalloc Metadata \u5185\u5B58\u5206\u6790",id:"jemalloc-metadata-\u5185\u5B58\u5206\u6790",level:2},{value:"Jemalloc Metadata \u67E5\u770B\u65B9\u6CD5",id:"jemalloc-metadata-\u67E5\u770B\u65B9\u6CD5",level:3},{value:"Jemalloc Metadata \u5185\u5B58\u8FC7\u5927",id:"jemalloc-metadata-\u5185\u5B58\u8FC7\u5927",level:3}];function s(e){let a={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.p,{children:"Doris \u9ED8\u8BA4\u4F7F\u7528 Jemalloc \u4F5C\u4E3A\u901A\u7528\u5185\u5B58\u5206\u914D\u5668\uFF0CJemalloc \u81EA\u8EAB\u5360\u7528\u7684\u5185\u5B58\u5305\u62EC Cache \u548C Metadata \u4E24\u90E8\u5206\uFF0C\u5176\u4E2D Cache \u5305\u62EC Thread Cache \u548C Dirty Page \u4E24\u90E8\u5206\uFF0C\u5728 http://{be_host}:{be_web_server_port}/memz \u53EF\u4EE5\u5B9E\u65F6\u67E5\u770B\u5230\u5185\u5B58\u5206\u914D\u5668\u539F\u59CB\u7684 profile\u3002"}),"\n",(0,n.jsx)(a.h2,{id:"jemalloc-cache-\u5185\u5B58\u5206\u6790",children:"Jemalloc Cache \u5185\u5B58\u5206\u6790"}),"\n",(0,n.jsxs)(a.p,{children:["\u5982\u679C\u770B\u5230 ",(0,n.jsx)(a.code,{children:"Label=tc/jemalloc_cache, Type=overview"})," Memory Trakcer \u7684\u503C\u8F83\u5927\uFF0C\u8BF4\u660E Jemalloc \u6216 TCMalloc Cache \u5185\u5B58\u4F7F\u7528\u591A\uFF0CDoris \u4F7F\u7528 Jemalloc \u4F5C\u4E3A\u9ED8\u8BA4\u7684 Allocator\uFF0C\u6240\u4EE5\u8FD9\u91CC\u53EA\u5206\u6790 Jemalloc Cache \u5185\u5B58\u4F7F\u7528\u591A\u7684\u60C5\u51B5\u3002"]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:"MemTrackerLimiter Label=tc/jemalloc_cache, Type=overview, Limit=-1.00 B(-1 B), Used=410.44 MB(430376896 B), Peak=-1.00 B(-1 B)\n"})}),"\n",(0,n.jsxs)(a.blockquote,{children:["\n",(0,n.jsxs)(a.p,{children:["Doris 2.1.6 \u4E4B\u524D ",(0,n.jsx)(a.code,{children:"Label=tc/jemalloc_cache"})," \u8FD8\u5305\u62EC Jemalloc Metadata\uFF0C\u800C\u4E14\u5927\u6982\u7387\u662F\u56E0\u4E3A Jemalloc Metadata \u5185\u5B58\u5360\u7528\u5927\u5BFC\u81F4 ",(0,n.jsx)(a.code,{children:"Label=tc/jemalloc_cache"})," \u8FC7\u5927\uFF0C\u53C2\u8003\u5BF9 ",(0,n.jsx)(a.code,{children:"Label=tc/jemalloc_metadata"})," Memory Tracker \u7684\u5206\u6790\u3002"]}),"\n"]}),"\n",(0,n.jsx)(a.p,{children:"BE \u8FDB\u7A0B\u8FD0\u884C\u8FC7\u7A0B\u4E2D\uFF0CJemalloc Cache \u5305\u62EC\u4E24\u90E8\u5206\u3002"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsxs)(a.p,{children:["Thread Cache\uFF0C\u5728 Thread Cache \u4E2D\u7F13\u5B58\u6307\u5B9A\u6570\u91CF\u7684 Page\uFF0C\u53C2\u8003 ",(0,n.jsx)(a.a,{href:"https://jemalloc.net/jemalloc.3.html#opt.tcache",children:"Jemalloc opt.tcache"}),"\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsx)(a.p,{children:"Dirty Page\uFF0C\u6240\u6709 Arena \u4E2D\u53EF\u4EE5\u88AB\u590D\u7528\u7684\u5185\u5B58 Page\u3002"}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(a.h3,{id:"jemalloc-cache-\u67E5\u770B\u65B9\u6CD5",children:"Jemalloc Cache \u67E5\u770B\u65B9\u6CD5"}),"\n",(0,n.jsxs)(a.p,{children:["\u67E5\u770B Doris BE \u7684 Web \u9875\u9762 ",(0,n.jsx)(a.code,{children:"http://{be_host}:{be_web_server_port}/memz"}),"\uFF08webserver_port \u9ED8\u8BA4 8040\uFF09\u53EF\u4EE5\u83B7\u5F97 Jemalloc Profile\uFF0C\u6839\u636E\u51E0\u7EC4\u5173\u952E\u4FE1\u606F\u89E3\u8BFB Jemalloc Cache \u7684\u4F7F\u7528\u3002"]}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsxs)(a.p,{children:["Jemalloc Profile \u4E2D\u7684 ",(0,n.jsx)(a.code,{children:"tcache_bytes"}),"\u662F Jemalloc Thread Cache \u7684\u603B\u5B57\u8282\u6570\u3002\u5982\u679C ",(0,n.jsx)(a.code,{children:"tcache_bytes"})," \u503C\u8F83\u5927\uFF0C\u8BF4\u660E Jemalloc Thread Cache \u4F7F\u7528\u7684\u5185\u5B58\u8FC7\u5927\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsxs)(a.p,{children:["Jemalloc Profile \u4E2D ",(0,n.jsx)(a.code,{children:"extents"})," \u8868\u4E2D ",(0,n.jsx)(a.code,{children:"dirty"})," \u5217\u7684\u503C\u603B\u548C\u8F83\u5927\uFF0C\u8BF4\u660E Jemalloc Dirty Page \u4F7F\u7528\u7684\u5185\u5B58\u8FC7\u5927\u3002"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(a.h3,{id:"thread-cache-\u5185\u5B58\u8FC7\u5927",children:"Thread Cache \u5185\u5B58\u8FC7\u5927"}),"\n",(0,n.jsx)(a.p,{children:"\u53EF\u80FD\u662F Thread Cache \u7F13\u5B58\u4E86\u5927\u91CF\u5927 Page\uFF0C\u56E0\u4E3A Thread Cache \u7684\u4E0A\u9650\u662F Page \u4E2A\u6570\uFF0C\u800C\u4E0D\u662F Page \u7684\u603B\u5B57\u8282\u6570\u3002"}),"\n",(0,n.jsxs)(a.p,{children:["\u8003\u8651\u51CF\u5C0F ",(0,n.jsx)(a.code,{children:"be.conf"})," \u4E2D ",(0,n.jsx)(a.code,{children:"JEMALLOC_CONF"})," \u7684 ",(0,n.jsx)(a.code,{children:"lg_tcache_max"}),"\uFF0C",(0,n.jsx)(a.code,{children:"lg_tcache_max"})," \u662F\u5141\u8BB8\u7F13\u5B58\u7684 Page \u5B57\u8282\u5927\u5C0F\u4E0A\u9650\uFF0C\u9ED8\u8BA4\u662F 15\uFF0C\u5373 32 KB (2^15)\uFF0C\u8D85\u8FC7\u8FD9\u4E2A\u5927\u5C0F\u7684 Page \u5C06\u4E0D\u4F1A\u7F13\u5B58\u5230 Thread Cache \u4E2D\u3002",(0,n.jsx)(a.code,{children:"lg_tcache_max"})," \u5BF9\u5E94 Jemalloc Profile \u4E2D\u7684 ",(0,n.jsx)(a.code,{children:"Maximum thread-cached size class"}),"\u3002"]}),"\n",(0,n.jsxs)(a.blockquote,{children:["\n",(0,n.jsxs)(a.p,{children:["Doris 2.1 \u4E4B\u524D ",(0,n.jsx)(a.code,{children:"be.conf"})," \u4E2D ",(0,n.jsx)(a.code,{children:"JEMALLOC_CONF"})," \u7684 ",(0,n.jsx)(a.code,{children:"lg_tcache_max"})," \u9ED8\u8BA4\u662F 20\uFF0C\u5728\u67D0\u4E9B\u573A\u666F\u4F1A\u5BFC\u81F4 Jemalloc Cache \u8FC7\u5927\uFF0CDoris 2.1 \u4E4B\u540E\u5DF2\u7ECF\u6539\u56DE\u4E86 Jemalloc \u7684\u9ED8\u8BA4\u503C 15\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(a.p,{children:["\u8FD9\u901A\u5E38\u662F BE \u8FDB\u7A0B\u4E2D\u7684\u67E5\u8BE2\u6216\u5BFC\u5165\u6B63\u5728\u7533\u8BF7\u5927\u91CF\u5927 Size Class \u7684\u5185\u5B58 Page\uFF0C\u6216\u8005\u6267\u884C\u5B8C\u4E00\u4E2A\u5927\u5185\u5B58\u67E5\u8BE2\u6216\u5BFC\u5165\u540E\uFF0CThread Cache \u4E2D\u7F13\u5B58\u4E86\u5927\u91CF\u5927 Size Class \u7684\u5185\u5B58 Page\u3002Thread Cache \u6709\u4E24\u4E2A\u6E05\u7406\u65F6\u673A\uFF0C\u4E00\u662F\u5185\u5B58\u7533\u8BF7\u548C\u91CA\u653E\u5230\u8FBE\u4E00\u5B9A\u6B21\u6570\u65F6\uFF0C\u56DE\u6536\u957F\u65F6\u95F4\u672A\u4F7F\u7528\u7684\u5185\u5B58\u5757\uFF1B\u4E8C\u662F\u7EBF\u7A0B\u9000\u51FA\u65F6\u56DE\u6536\u5168\u90E8 Page\u3002\u6B64\u65F6\u5B58\u5728\u4E00\u4E2A Bad Case\uFF0C\u82E5\u7EBF\u7A0B\u540E\u7EED\u4E00\u76F4\u6CA1\u6709\u6267\u884C\u65B0\u7684\u67E5\u8BE2\u6216\u5BFC\u5165\uFF0C\u4ECE\u6B64\u4E0D\u518D\u5206\u914D\u5185\u5B58\uFF0C\u9677\u5165\u4E00\u79CD\u6240\u8C13\u7684 ",(0,n.jsx)(a.code,{children:"idle"})," \u72B6\u6001\u3002\u7528\u6237\u9884\u671F\u662F\u67E5\u8BE2\u7ED3\u675F\u540E\uFF0C\u5185\u5B58\u662F\u53EF\u4EE5\u91CA\u653E\u6389\u7684\uFF0C\u4F46\u5B9E\u9645\u4E0A\u6B64\u573A\u666F\u4E0B\u82E5\u7EBF\u7A0B\u6CA1\u6709\u9000\u51FA\uFF0CThread Cache \u5E76\u4E0D\u4F1A\u6E05\u7406\u3002"]}),"\n",(0,n.jsx)(a.p,{children:"\u4E0D\u8FC7\u901A\u5E38\u65E0\u9700\u5173\u6CE8 Thread Cache\uFF0C\u5728\u8FDB\u7A0B\u53EF\u7528\u5185\u5B58\u4E0D\u8DB3\u65F6\uFF0C\u82E5 Thread Cache \u7684\u5927\u5C0F\u8D85\u8FC7 1G\uFF0CDoris \u5C06\u624B\u52A8 Flush Thread Cache\u3002"}),"\n",(0,n.jsx)(a.h3,{id:"dirty-page-\u5185\u5B58\u8FC7\u5927",children:"Dirty Page \u5185\u5B58\u8FC7\u5927"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:"extents:        size ind       ndirty        dirty       nmuzzy        muzzy    nretained     retained       ntotal        total\n                4096   0            7        28672            1         4096           21        86016           29       118784\n                8192   1           11        90112            2        16384           11        90112           24       196608\n               12288   2            2        24576            4        49152           45       552960           51       626688\n               16384   3            0            0            1        16384            6        98304            7       114688\n               20480   4            0            0            1        20480            5       102400            6       122880\n               24576   5            0            0           43      1056768            2        49152           45      1105920\n               28672   6            0            0            0            0           13       372736           13       372736\n               32768   7            0            0            1        32768           13       425984           14       458752\n               40960   8            0            0           31      1150976           35      1302528           66      2453504\n               49152   9            4       196608            2        98304            3       139264            9       434176\n               57344  10            0            0            1        57344            9       512000           10       569344\n               65536  11            3       184320            0            0            6       385024            9       569344\n               81920  12            2       147456            3       241664           38      2809856           43      3198976\n               98304  13            0            0            1        86016            6       557056            7       643072\n              114688  14            1       102400            1       106496           15      1642496           17      185139\n"})}),"\n",(0,n.jsxs)(a.p,{children:["\u51CF\u5C0F ",(0,n.jsx)(a.code,{children:"be.conf"})," \u4E2D ",(0,n.jsx)(a.code,{children:"JEMALLOC_CONF"})," \u7684 ",(0,n.jsx)(a.code,{children:"dirty_decay_ms"})," \u5230 2000 ms \u6216\u66F4\u5C0F\uFF0C",(0,n.jsx)(a.code,{children:"be.conf"})," \u4E2D\u9ED8\u8BA4 ",(0,n.jsx)(a.code,{children:"dirty_decay_ms"})," \u4E3A 5000 ms\u3002Jemalloc \u4F1A\u5728 ",(0,n.jsx)(a.code,{children:"dirty_decay_ms"})," \u6307\u5B9A\u7684\u65F6\u95F4\u5185\u4F9D\u7167\u5E73\u6ED1\u68AF\u5EA6\u66F2\u7EBF\u91CA\u653E Dirty Page\uFF0C\u53C2\u8003 ",(0,n.jsx)(a.a,{href:"https://jemalloc.net/jemalloc.3.html#opt.dirty_decay_ms",children:"Jemalloc opt.dirty_decay_ms"}),"\uFF0C\u5F53 BE \u8FDB\u7A0B\u53EF\u7528\u5185\u5B58\u4E0D\u8DB3\u89E6\u53D1 Minor GC \u6216 Full GC \u65F6\u4F1A\u6309\u7167\u4E00\u5B9A\u7B56\u7565\u4E3B\u52A8\u91CA\u653E\u6240\u6709 Dirty Page\u3002"]}),"\n",(0,n.jsxs)(a.blockquote,{children:["\n",(0,n.jsxs)(a.p,{children:["Doris 2.1 \u4E4B\u524D ",(0,n.jsx)(a.code,{children:"be.conf"})," \u4E2D ",(0,n.jsx)(a.code,{children:"JEMALLOC_CONF"})," \u7684 ",(0,n.jsx)(a.code,{children:"dirty_decay_ms"})," \u9ED8\u8BA4\u662F 15000\uFF0C\u5728\u67D0\u4E9B\u573A\u666F\u4F1A\u5BFC\u81F4 Jemalloc Cache \u8FC7\u5927\uFF0CDoris 2.1 \u4E4B\u540E\u9ED8\u8BA4\u503C\u662F 5000\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(a.p,{children:["Jemalloc Profile \u4E2D\u7684 ",(0,n.jsx)(a.code,{children:"extents"})," \u5305\u542B Jemalloc \u6240\u6709 ",(0,n.jsx)(a.code,{children:"arena"})," \u4E2D\u4E0D\u540C Page Size \u7684 Bucket \u7684\u7EDF\u8BA1\u503C\uFF0C\u5176\u4E2D ",(0,n.jsx)(a.code,{children:"ndirty"})," \u662F Dirty Page \u7684\u4E2A\u6570\uFF0C",(0,n.jsx)(a.code,{children:"dirty"})," \u662F Dirty Page \u7684\u5185\u5B58\u603B\u548C\u3002\u53C2\u8003 ",(0,n.jsx)(a.a,{href:"https://jemalloc.net/jemalloc.3.html",children:"Jemalloc"})," \u4E2D\u7684 ",(0,n.jsx)(a.code,{children:"stats.arenas.<i>.extents.<j>.{extent_type}_bytes"})," \u5C06\u6240\u6709 Page Size \u7684 ",(0,n.jsx)(a.code,{children:"dirty"})," \u76F8\u52A0\u5F97\u5230 Jemalloc \u4E2D Dirty Page \u7684\u5185\u5B58\u5B57\u8282\u5927\u5C0F\u3002"]}),"\n",(0,n.jsx)(a.h2,{id:"jemalloc-metadata-\u5185\u5B58\u5206\u6790",children:"Jemalloc Metadata \u5185\u5B58\u5206\u6790"}),"\n",(0,n.jsxs)(a.p,{children:["\u82E5 ",(0,n.jsx)(a.code,{children:"Label=tc/jemalloc_metadata, Type=overview"})," Memory Trakcer \u7684\u503C\u8F83\u5927\uFF0C\u8BF4\u660E Jemalloc \u6216 TCMalloc Metadata \u5185\u5B58\u4F7F\u7528\u591A\uFF0CDoris \u4F7F\u7528 Jemalloc \u4F5C\u4E3A\u9ED8\u8BA4\u7684 Allocator\uFF0C\u6240\u4EE5\u8FD9\u91CC\u53EA\u5206\u6790 Jemalloc Metadata \u5185\u5B58\u4F7F\u7528\u591A\u7684\u60C5\u51B5\u3002"]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:"MemTrackerLimiter Label=tc/jemalloc_metadata, Type=overview, Limit=-1.00 B(-1 B), Used=144 MB(151759440 B), Peak=-1.00 B(-1 B)\n"})}),"\n",(0,n.jsxs)(a.blockquote,{children:["\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.code,{children:"Label=tc/jemalloc_metadata"})," Memory Tracker \u5728 Doris 2.1.6 \u4E4B\u540E\u624D\u88AB\u6DFB\u52A0\uFF0C\u8FC7\u53BB Jemalloc Metadata \u88AB\u5305\u542B\u5728 ",(0,n.jsx)(a.code,{children:"Label=tc/jemalloc_cache"})," Memory Tracker \u4E2D\u3002"]}),"\n"]}),"\n",(0,n.jsx)(a.h3,{id:"jemalloc-metadata-\u67E5\u770B\u65B9\u6CD5",children:"Jemalloc Metadata \u67E5\u770B\u65B9\u6CD5"}),"\n",(0,n.jsxs)(a.p,{children:["\u67E5\u770B Doris BE \u7684 Web \u9875\u9762 ",(0,n.jsx)(a.code,{children:"http://{be_host}:{be_web_server_port}/memz"}),"\uFF08webserver_port \u9ED8\u8BA4 8040\uFF09\u53EF\u4EE5\u83B7\u5F97 Jemalloc Profile\uFF0C\u67E5\u627E Jemalloc Profile \u4E2D\u5173\u4E8E Jemalloc \u6574\u4F53\u7684\u5185\u5B58\u7EDF\u8BA1\u5982\u4E0B\uFF0C\u5176\u4E2D ",(0,n.jsx)(a.code,{children:"metadata"})," \u5C31\u662F Jemalloc Metadata \u7684\u5185\u5B58\u5927\u5C0F\u3002"]}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.code,{children:"Allocated: 2401232080, active: 2526302208, metadata: 535979296 (n_thp 221), resident: 2995621888, mapped: 3221979136, retained: 131542581248"})}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.code,{children:"Allocated"})," Jemalloc \u4E3A BE \u8FDB\u7A0B\u5206\u914D\u7684\u5185\u5B58\u603B\u5B57\u8282\u6570\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.code,{children:"active"})," Jemalloc \u4E3A BE \u8FDB\u7A0B\u5206\u914D\u7684\u6240\u6709 Page \u603B\u5B57\u8282\u6570\uFF0C\u662F Page Size \u7684\u500D\u6570\uFF0C\u901A\u5E38\u5927\u4E8E\u7B49\u4E8E ",(0,n.jsx)(a.code,{children:"Allocated"}),"\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.code,{children:"metadata"})," Jemalloc \u7684\u5143\u6570\u636E\u603B\u5B57\u8282\u6570\uFF0C\u548C\u5206\u914D\u548C\u7F13\u5B58\u7684 Page \u4E2A\u6570\u3001\u5185\u5B58\u788E\u7247 \u7B49\u56E0\u7D20\u90FD\u6709\u5173\uFF0C\u53C2\u8003\u6587\u6863 ",(0,n.jsx)(a.a,{href:"https://jemalloc.net/jemalloc.3.html#stats.metadata",children:"Jemalloc stats.metadata"})]}),"\n"]}),"\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.code,{children:"retained"})," Jemalloc \u4FDD\u7559\u7684\u865A\u62DF\u5185\u5B58\u6620\u5C04\u5927\u5C0F\uFF0C\u4E5F\u6CA1\u6709\u901A\u8FC7 munmap \u6216\u7C7B\u4F3C\u65B9\u6CD5\u8FD4\u56DE\u7ED9\u64CD\u4F5C\u7CFB\u7EDF\uFF0C\u4E5F\u6CA1\u6709\u5F3A\u5173\u8054\u7269\u7406\u5185\u5B58\u3002\u53C2\u8003\u6587\u6863 ",(0,n.jsx)(a.a,{href:"https://jemalloc.net/jemalloc.3.html#stats.retained",children:"Jemalloc stats.retained"})]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(a.h3,{id:"jemalloc-metadata-\u5185\u5B58\u8FC7\u5927",children:"Jemalloc Metadata \u5185\u5B58\u8FC7\u5927"}),"\n",(0,n.jsxs)(a.p,{children:["Jemalloc Metadata \u5927\u5C0F\u548C\u8FDB\u7A0B\u865A\u62DF\u5185\u5B58\u5927\u5C0F\u6B63\u76F8\u5173\uFF0C\u901A\u5E38 Doris BE \u8FDB\u7A0B\u865A\u62DF\u5185\u5B58\u5927\u662F\u56E0\u4E3A Jemalloc \u4FDD\u7559\u4E86\u5927\u91CF\u865A\u62DF\u5185\u5B58\u6620\u5C04\uFF0C\u5373\u4E0A\u9762\u7684 ",(0,n.jsx)(a.code,{children:"retained"}),"\u3002\u8FD4\u56DE\u7ED9 Jemalloc \u7684\u865A\u62DF\u5185\u5B58\u9ED8\u8BA4\u90FD\u4F1A\u7F13\u5B58\u5728 Retained \u4E2D\uFF0C\u7B49\u5F85\u88AB\u590D\u7528\uFF0C\u4E0D\u4F1A\u81EA\u52A8\u91CA\u653E\uFF0C\u4E5F\u65E0\u6CD5\u624B\u52A8\u91CA\u653E\u3002"]}),"\n",(0,n.jsx)(a.p,{children:"\u9020\u6210 Jemalloc Retained \u5927\u7684\u6839\u672C\u539F\u56E0\u662F Doris \u4EE3\u7801\u5C42\u9762\u5185\u5B58\u590D\u7528\u4E0D\u8DB3\uFF0C\u5BFC\u81F4\u9700\u8981\u7533\u8BF7\u5927\u91CF\u865A\u62DF\u5185\u5B58\uFF0C\u8FD9\u4E9B\u865A\u62DF\u5185\u5B58\u91CA\u653E\u540E\u8FDB\u5165 Jemalloc Retained\u3002\u901A\u5E38\u865A\u62DF\u5185\u5B58\u548C Jemalloc Metadata \u5927\u5C0F\u7684\u6BD4\u503C\u5728 300-500 \u4E4B\u95F4\uFF0C\u5373\u82E5\u6709 10T \u7684\u865A\u62DF\u5185\u5B58\uFF0CJemalloc Metadata \u53EF\u80FD\u5360\u7528 20G\u3002"}),"\n",(0,n.jsx)(a.p,{children:"\u5982\u679C\u9047\u5230 Jemalloc Metadata \u548C Retained \u6301\u7EED\u589E\u5927\uFF0C\u4EE5\u53CA\u8FDB\u7A0B\u865A\u62DF\u5185\u5B58\u8FC7\u5927\u7684\u95EE\u9898\uFF0C\u5EFA\u8BAE\u8003\u8651\u5B9A\u65F6\u91CD\u542F Doris BE \u8FDB\u7A0B\uFF0C\u901A\u5E38\u8FD9\u53EA\u4F1A\u5728 Doris BE \u957F\u65F6\u95F4\u8FD0\u884C\u540E\u51FA\u73B0\uFF0C\u800C\u4E14\u53EA\u6709\u5C11\u6570 Doris \u96C6\u7FA4\u4F1A\u9047\u5230\u3002\u76EE\u524D\u6CA1\u6709\u4E0D\u635F\u5931\u6027\u80FD\u7684\u65B9\u6CD5\u964D\u4F4E Jemalloc Retained \u4FDD\u7559\u7684\u865A\u62DF\u5185\u5B58\u6620\u5C04\uFF0CDoris \u6B63\u5728\u6301\u7EED\u4F18\u5316\u5185\u5B58\u4F7F\u7528\u3002"}),"\n",(0,n.jsx)(a.p,{children:"\u5982\u679C\u9891\u7E41\u51FA\u73B0\u4E0A\u8FF0\u95EE\u9898\uFF0C\u53C2\u8003\u4E0B\u9762\u7684\u65B9\u6CD5\u3002"}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsxs)(a.p,{children:["\u4E00\u4E2A\u6839\u672C\u89E3\u51B3\u65B9\u6CD5\u662F\u5173\u95ED Jemalloc Retained \u7F13\u5B58\u865A\u62DF\u5185\u5B58\u6620\u5C04\uFF0C\u5728 ",(0,n.jsx)(a.code,{children:"be.conf"})," \u4E2D ",(0,n.jsx)(a.code,{children:"JEMALLOC_CONF"})," \u540E\u9762\u589E\u52A0 ",(0,n.jsx)(a.code,{children:"retain:false"})," \u540E\u91CD\u542F BE\u3002\u4F46\u67E5\u8BE2\u6027\u80FD\u53EF\u80FD\u4F1A\u660E\u663E\u964D\u4F4E\uFF0C\u6D4B\u8BD5 TPC-H Benchmark \u6027\u80FD\u4F1A\u964D\u4F4E 3 \u500D\u5DE6\u53F3\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsxs)(a.p,{children:["Doris 2.1 \u4E0A\u53EF\u4EE5\u5173\u95ED Pipelinex \u548C Pipeline\uFF0C\u6267\u884C ",(0,n.jsx)(a.code,{children:"set global experimental_enable_pipeline_engine=false; set global experimental_enable_pipeline_x_engine=false;"}),"\uFF0C\u56E0\u4E3A pipelinex \u548C pipeline \u4F1A\u7533\u8BF7\u66F4\u591A\u7684\u865A\u62DF\u5185\u5B58\u3002\u8FD9\u540C\u6837\u4F1A\u5BFC\u81F4\u67E5\u8BE2\u6027\u80FD\u964D\u4F4E\u3002"]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:a}={...(0,r.a)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(s,{...e})}):s(e)}},250065:function(e,a,l){l.d(a,{Z:function(){return i},a:function(){return o}});var c=l(667294);let n={},r=c.createContext(n);function o(e){let a=c.useContext(r);return c.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),c.createElement(r.Provider,{value:a},e.children)}}}]);