<!doctype html><html lang=zh-Hans-CN dir=ltr class="docs-wrapper plugin-docs plugin-id-community docs-version-current docs-doc-page docs-doc-id-developer-guide/debug-tool" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>调试工具 - Apache Doris</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://doris.apache.org/zh-CN/community/developer-guide/debug-tool/><meta data-rh=true property=og:locale content=zh_Hans-CN><meta data-rh=true property=og:locale:alternate content=en_US><meta data-rh=true name=docusaurus_locale content=zh-CN><meta data-rh=true name=docsearch:language content=zh-CN><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-community-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-community-current><meta data-rh=true property=og:title content="调试工具 - Apache Doris"><meta data-rh=true name=description content="介绍 Apache Doris 的常用调试工具和方法，包括 FE 和 BE 的调试技巧，如内存分析、线程分析、性能监控等实用调试手段。"><meta data-rh=true property=og:description content="介绍 Apache Doris 的常用调试工具和方法，包括 FE 和 BE 的调试技巧，如内存分析、线程分析、性能监控等实用调试手段。"><link data-rh=true rel=icon href=/zh-CN/images/favicon.ico><link data-rh=true rel=canonical href=https://doris.apache.org/zh-CN/community/developer-guide/debug-tool/><link data-rh=true rel=alternate href=https://doris.apache.org/community/developer-guide/debug-tool/ hreflang=en-US><link data-rh=true rel=alternate href=https://doris.apache.org/zh-CN/community/developer-guide/debug-tool/ hreflang=zh-Hans-CN><link data-rh=true rel=alternate href=https://doris.apache.org/community/developer-guide/debug-tool/ hreflang=x-default><link rel=alternate type=application/rss+xml href=/zh-CN/blog/rss.xml title="Apache Doris RSS Feed"><link rel=alternate type=application/atom+xml href=/zh-CN/blog/atom.xml title="Apache Doris Atom Feed"><link rel=preconnect href=https://analytics.apache.org/><script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://analytics.apache.org/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","43"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel=stylesheet href=/css/katex.min.css><script src=/js/custom-script.js></script><script async src=https://widget.kapa.ai/kapa-widget.bundle.js data-website-id=a5fb90df-217a-4097-95c0-80490220314b data-modal-title="Apache Doris AI" data-project-name="Apache Doris Website" data-button-hide=true data-modal-override-open-selector=#navbar-ask-ai-btn data-project-logo=https://cdn.selectdb.com/static/doris_1_3c42247c63.png data-modal-image=https://cdn.selectdb.com/static/doris_logo_cc5a30d886.png data-project-color=#11A679 data-modal-disclaimer="This is a custom LLM with access to all [Doris documentation](https://doris.apache.org/docs/4.x/gettingStarted/what-is-apache-doris)." data-consent-required data-consent-screen-disclaimer="By clicking &amp;quot;I agree, let's chat&amp;quot;, you consent to the use of the AI assistant in accordance with kapa.ai's [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google's [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai's and Google's privacy policies." data-bot-protection-mechanism=hcaptcha></script><link rel=stylesheet href=/zh-CN/assets/css/styles.927db6f2.css><script src=/zh-CN/assets/js/runtime~main.0e33774b.js defer></script><script src=/zh-CN/assets/js/main.d5f9a343.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id=__docusaurus><div role=region aria-label=跳到主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><div class=navbar-left><div class="navbar-logo-wrapper flex items-center"><a class=navbar__brand href=/zh-CN/><div class=navbar__logo><img src=/zh-CN/images/logo-doris.svg alt="Apache Doris" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/zh-CN/images/logo-doris.svg alt="Apache Doris" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class=undefined><a href=/zh-CN/docs/4.x/gettingStarted/what-is-apache-doris/ class="navbar__item navbar__link" target=_blank>Docs</a><a class="navbar__item navbar__link" href=/zh-CN/blog/>Blog</a><a class="navbar__item navbar__link" href=/zh-CN/users/>Users</a><a href=https://github.com/apache/doris/discussions target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Discussions</a><a class="navbar__item navbar__link" href=/zh-CN/ecosystem/cluster-management/>Ecosystem</a><a class="navbar__item navbar__link" href=/zh-CN/events/>Events</a><a class="navbar__item navbar__link" href=/zh-CN/community/join-community/>Community</a><a class="navbar__item navbar__link" href=/zh-CN/vendors/>Vendors</a></div></div></div><div class="navbar__items navbar__items--right"><button class="rounded-full flex items-center gap-x-2 px-4 py-[5px] border border-primary bg-[#F0FFF7] text-[1rem]/[1.625rem] font-medium text-[#1D1D1D]" id=navbar-ask-ai-btn><svg width=18 height=18 viewBox="0 0 18 18" fill=none><path d="M7.35457 0.574461C7.42306 0.423027 7.5322 0.292956 7.67018 0.198317C7.80816 0.103677 7.96974 0.04807 8.13742 0.037509C8.30511 0.026948 8.47253 0.0618351 8.62158 0.138397C8.77063 0.21496 8.89564 0.330283 8.98308 0.471896L9.03778 0.574461L9.98672 2.68378C10.8161 4.52515 12.1952 6.07276 13.9397 7.11968L14.2337 7.28972L15.9197 8.2263C16.0536 8.30049 16.1666 8.40653 16.2484 8.53479C16.3302 8.66304 16.3783 8.80945 16.3882 8.96069C16.3981 9.11194 16.3696 9.26323 16.3052 9.40083C16.2408 9.53842 16.1426 9.65796 16.0195 9.74857L15.921 9.81064L14.2337 10.7472C12.454 11.7355 11.0224 13.2365 10.1303 15.0495L9.98672 15.3532L9.03641 17.4625C8.96778 17.6136 8.85866 17.7433 8.72081 17.8377C8.58296 17.9321 8.42162 17.9876 8.25418 17.9982C8.08674 18.0087 7.91956 17.9739 7.77066 17.8976C7.62177 17.8213 7.49681 17.7063 7.40926 17.565L7.35457 17.4625L6.40426 15.3532C5.57484 13.5118 4.19572 11.9643 2.45124 10.9173L2.15726 10.7472L0.471311 9.81064C0.337321 9.73674 0.224189 9.63093 0.142217 9.50285C0.0602439 9.37477 0.0120344 9.22849 0.00197753 9.07732C-0.00807937 8.92615 0.0203358 8.7749 0.0846359 8.63734C0.148936 8.49978 0.247078 8.38028 0.370127 8.28972L0.468577 8.22765L2.15589 7.29107C3.93569 6.30285 5.36732 4.80183 6.25932 2.98877L6.40289 2.68513L7.3532 0.57581L7.35457 0.574461ZM15.6899 0.130465C16.1425 1.14532 16.9145 1.98914 17.8914 2.53668C17.9244 2.55517 17.9518 2.58196 17.9709 2.61432C17.9899 2.64668 18 2.68345 18 2.72089C18 2.75833 17.9899 2.7951 17.9709 2.82745C17.9518 2.85981 17.9244 2.8866 17.8914 2.9051C16.9145 3.45264 16.1425 4.29645 15.6899 5.31131C15.6731 5.3501 15.645 5.38315 15.6093 5.40638C15.5736 5.4296 15.5317 5.44198 15.4889 5.44198C15.4462 5.44198 15.4043 5.4296 15.3686 5.40638C15.3329 5.38315 15.3048 5.3501 15.2879 5.31131C14.8352 4.29695 14.0632 3.45364 13.0865 2.90645C13.0532 2.88805 13.0255 2.86122 13.0062 2.82872C12.9869 2.79622 12.9767 2.75923 12.9767 2.72156C12.9767 2.68389 12.9869 2.6469 13.0062 2.6144C13.0255 2.58191 13.0532 2.55508 13.0865 2.53668C14.0636 1.98879 14.8357 1.14448 15.2879 0.129116C15.305 0.0907214 15.3331 0.0580664 15.3686 0.035138C15.4042 0.0122096 15.4458 0 15.4883 0C15.5308 0 15.5723 0.0122096 15.6079 0.035138C15.6435 0.0580664 15.6715 0.0907214 15.6886 0.129116V0.130465H15.6899Z" fill=#11A679 /></svg>Ask AI</button><a class="navbar__item navbar__link header-right-button-primary navbar-download-mobile" href=/zh-CN/download/>Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg class=icon-language width=16 height=16 viewBox="0 0 16 16" fill=none><path d="M7.75756 14.3L10.5816 6.91667H11.8759L14.7 14.3H13.4057L12.7501 12.4167H9.74113L9.06873 14.3H7.75756ZM10.1109 11.35H12.3467L11.254 8.3H11.2036L10.1109 11.35ZM2.84908 12.45L1.97498 11.5833L5.11841 8.48333C4.72618 8.05 4.38439 7.60267 4.09302 7.14133C3.80165 6.68044 3.54389 6.19444 3.31976 5.68333H4.61412C4.80463 6.06111 5.00635 6.39711 5.21927 6.69133C5.43219 6.986 5.68434 7.29444 5.97571 7.61667C6.43519 7.12778 6.81621 6.62511 7.11879 6.10867C7.42137 5.59178 7.67352 5.03889 7.87523 4.45H1V3.23333H5.33694V2H6.58087V3.23333H10.9178V4.45H9.11916C8.89503 5.18333 8.59805 5.89155 8.22824 6.57467C7.85842 7.25822 7.39895 7.90555 6.84983 8.51667L8.3459 10.0167L7.87523 11.2833L5.95891 9.38333L2.84908 12.45Z" fill=#4C576C /></svg></a><ul class=dropdown__menu><li><a href=/community/developer-guide/debug-tool/ rel="noopener noreferrer" class=dropdown__link lang=en-US>English</a><li><a href=/zh-CN/community/developer-guide/debug-tool/ rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=zh-Hans-CN>中文</a></ul></div><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class="header-right-button-primary navbar-download-desktop font-medium" href=/zh-CN/download/>Download</a></div></div><div class=navbar__bottom><div class=docs-nav-version-locale><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link type=localeDropdown><svg class=icon-language width=16 height=16 viewBox="0 0 16 16" fill=none><path d="M7.75756 14.3L10.5816 6.91667H11.8759L14.7 14.3H13.4057L12.7501 12.4167H9.74113L9.06873 14.3H7.75756ZM10.1109 11.35H12.3467L11.254 8.3H11.2036L10.1109 11.35ZM2.84908 12.45L1.97498 11.5833L5.11841 8.48333C4.72618 8.05 4.38439 7.60267 4.09302 7.14133C3.80165 6.68044 3.54389 6.19444 3.31976 5.68333H4.61412C4.80463 6.06111 5.00635 6.39711 5.21927 6.69133C5.43219 6.986 5.68434 7.29444 5.97571 7.61667C6.43519 7.12778 6.81621 6.62511 7.11879 6.10867C7.42137 5.59178 7.67352 5.03889 7.87523 4.45H1V3.23333H5.33694V2H6.58087V3.23333H10.9178V4.45H9.11916C8.89503 5.18333 8.59805 5.89155 8.22824 6.57467C7.85842 7.25822 7.39895 7.90555 6.84983 8.51667L8.3459 10.0167L7.87523 11.2833L5.95891 9.38333L2.84908 12.45Z" fill=#4C576C /></svg></a><ul class=dropdown__menu><li><a href=/community/developer-guide/debug-tool/ rel="noopener noreferrer" class=dropdown__link lang=en-US>English</a><li><a href=/zh-CN/community/developer-guide/debug-tool/ rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=zh-Hans-CN>中文</a></ul></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_eExm"><div class=docsWrapper_hBAB><button aria-label=回到顶部 class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_mhZE><nav aria-label=文档侧边栏 class="menu thin-scrollbar menu_Y1UP menuWithAnnouncementBar_fPny"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link length=14 href=/zh-CN/community/join-community/>加入社区</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link length=14 href=/zh-CN/community/subscribe-mail-list/>订阅邮件列表</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link length=14 href=/zh-CN/community/feedback/>问题反馈</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link length=14 href=/zh-CN/community/doris-future/>开发者成长计划</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/zh-CN/community/how-to-contribute/contribute-to-doris/>贡献指南</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link length=14 href=/zh-CN/community/release-versioning/>版本规则</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/zh-CN/community/release-and-verify/release-prepare/>版本发布与校验</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/zh-CN/community/source-install/compilation-with-docker/>源码编译</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link length=14 href=/zh-CN/community/security/>安全</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/zh-CN/community/design/doris_storage_optimization/>设计文档</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true href=/zh-CN/community/developer-guide/debug-tool/>开发者手册</a></div><ul style=display:block;overflow:visible;height:auto class="menu__list menu__list_level_2 community_level_2"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page length=18 tabindex=0 href=/zh-CN/community/developer-guide/debug-tool/>调试工具</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/docker-dev/>Doris Docker 快速搭建开发环境</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/benchmark-tool/>Doris BE存储层Benchmark工具</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/pipeline-tracing/>Pipeline Tracing</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/fe-eclipse-dev/>FE 开发环境搭建 - Eclipse</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/fe-profiler/>使用FE profiler生成火焰图</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/arthas/>使用 Arthas 分析 FE 性能</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/fe-idea-dev/>FE 开发环境搭建 - IntelliJ IDEA</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/fe-vscode-dev/>FE 开发环境搭建 - Visual Studio Code (VSCode)</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/be-vscode-dev/>Doris BE开发调试环境 -- vscode</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/be-clion-dev/>Doris BE 开发调试环境 -- clion</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/zh-CN/community/developer-guide/mac-dev/dev-prepare/>Mac Local 开发</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/java-format-code/>Java 代码格式化</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/cpp-format-code/>C++ 代码格式化</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/cpp-diagnostic-code/>C++ 代码分析</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/bitmap-hll-file-format/>Bitmap/HLL 数据格式</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/github-checks/>Github 准入检查</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link length=18 tabindex=0 href=/zh-CN/community/developer-guide/regression-testing/>回归测试</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link length=14 href=/zh-CN/community/team/>Doris 团队</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href=https://cwiki.apache.org/confluence/display/DORIS/Doris+Improvement+Proposals target=_blank rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" length=14>Improvement Proposals<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link length=14 href=/zh-CN/community/thanks/>致谢</a></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_z5aJ"><div class=docItemContainer_c0TR><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=页面路径><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label=主页面 class=breadcrumbs__link href=/zh-CN/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><span class=breadcrumbs__link>开发者手册</span><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>调试工具</span><meta itemprop=position content=2></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type=button class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>调试工具</h1></header>
<p>在 Doris 的使用和开发过程中，经常需要对 Doris 进行调试。本文档介绍了一些常用的调试工具和方法。</p>
<p><strong>注意：文中出现的 BE 二进制文件名称 <code>doris_be</code> 在早期版本中为 <code>palo_be</code>。</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=fe-调试>FE 调试<a href=#fe-调试 class=hash-link aria-label="FE 调试的直接链接" title="FE 调试的直接链接">​</a></h2>
<p>FE 是 Java 进程，以下列举一些常用的 Java 调试命令。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=1-统计当前内存使用明细>1. 统计当前内存使用明细<a href=#1-统计当前内存使用明细 class=hash-link aria-label="1. 统计当前内存使用明细的直接链接" title="1. 统计当前内存使用明细的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">jmap -histo:live pid > 1.jmp</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>该命令可以列举存活对象的内存占用情况并排序（将 pid 替换为 FE 进程 ID）。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain"> num     #instances         #bytes  class name</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">----------------------------------------------</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">   1:         33528       10822024  [B</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">   2:         80106        8662200  [C</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">   3:           143        4688112  [Ljava.util.concurrent.ForkJoinTask;</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">   4:         80563        1933512  java.lang.String</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">   5:         15295        1714968  java.lang.Class</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">   6:         45546        1457472  java.util.concurrent.ConcurrentHashMap$Node</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">   7:         15483        1057416  [Ljava.lang.Object;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>通过该方法可以查看当前存活对象占用的总内存（在文件末尾），以及分析哪些对象占用了更多的内存。</p>
<p><strong>注意：</strong> 该方法因指定了 <code>:live</code> 参数，会触发 FullGC。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=2-查看-jvm-内存使用>2. 查看 JVM 内存使用<a href=#2-查看-jvm-内存使用 class=hash-link aria-label="2. 查看 JVM 内存使用的直接链接" title="2. 查看 JVM 内存使用的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">jstat -gcutil pid 1000 1000</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>该命令可以每隔 1 秒查看一次当前 JVM 各区域的内存使用情况（将 pid 替换为 FE 进程 ID）。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  0.00   0.00  22.61   3.03  95.74  92.77     68    1.249     5    0.794    2.043</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  0.00   0.00  22.61   3.03  95.74  92.77     68    1.249     5    0.794    2.043</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  0.00   0.00  22.61   3.03  95.74  92.77     68    1.249     5    0.794    2.043</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  0.00   0.00  22.92   3.03  95.74  92.77     68    1.249     5    0.794    2.043</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  0.00   0.00  22.92   3.03  95.74  92.77     68    1.249     5    0.794    2.043</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>重点关注 Old 区（O）的占用百分比（如示例中为 3.03%）。如果占用过高，则可能出现 OOM 或 FullGC。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=3-打印-fe-线程堆栈>3. 打印 FE 线程堆栈<a href=#3-打印-fe-线程堆栈 class=hash-link aria-label="3. 打印 FE 线程堆栈的直接链接" title="3. 打印 FE 线程堆栈的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">jstack -l pid > 1.js</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>该命令可以打印当前 FE 的线程堆栈（将 pid 替换为 FE 进程 ID）。</p>
<p><code>-l</code> 参数会同时检测是否存在死锁。该方法可用于查看 FE 线程运行情况、是否存在死锁、定位阻塞位置等问题。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=be-调试>BE 调试<a href=#be-调试 class=hash-link aria-label="BE 调试的直接链接" title="BE 调试的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=内存调试>内存调试<a href=#内存调试 class=hash-link aria-label=内存调试的直接链接 title=内存调试的直接链接>​</a></h3>
<p>内存调试主要关注两个方面：</p>
<ol>
<li><strong>内存使用量是否合理</strong>：内存使用量过大可能是系统存在内存泄漏，或程序内存使用不当。</li>
<li><strong>内存访问是否合法</strong>：是否存在内存越界、非法访问等问题，例如访问非法地址或使用未初始化的内存。</li>
</ol>
<p>针对这些问题，可以使用以下工具进行追踪和分析。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=doris-debug-tools>Doris Debug Tools<a href=#doris-debug-tools class=hash-link aria-label="Doris Debug Tools的直接链接" title="Doris Debug Tools的直接链接">​</a></h4>
<p><a href=https://github.com/morningman/doris-debug-tools target=_blank rel="noopener noreferrer">Doris Debug Tools</a> 提供封装好的 CPU 火焰图和内存分析工具，可以直接下载使用。</p>
<ul>
<li><a href=https://github.com/morningman/doris-debug-tools/releases target=_blank rel="noopener noreferrer">Releases</a></li>
</ul>
<blockquote>
<p>注：非官方工具，仅用于开发调试。</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=jemalloc-heap-profile>Jemalloc Heap Profile<a href=#jemalloc-heap-profile class=hash-link aria-label="Jemalloc Heap Profile的直接链接" title="Jemalloc Heap Profile的直接链接">​</a></h4>
<blockquote>
<p><strong>说明：</strong> Doris 1.2.2 版本开始默认使用 Jemalloc 作为内存分配器。</p>
</blockquote>
<p>Heap Profile 的原理解析可参考 <a href=https://cn.pingcap.com/blog/an-explanation-of-the-heap-profiling-principle/ target=_blank rel="noopener noreferrer">Heap Profiling 原理解析</a>。需要注意的是，Heap Profile 记录的是虚拟内存。</p>
<p>Jemalloc 支持实时和定期两种 Heap Dump 方式，然后使用 <code>jeprof</code> 工具解析生成的 Heap Profile。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=1-实时-heap-dump用于分析实时内存>1. 实时 Heap Dump（用于分析实时内存）<a href=#1-实时-heap-dump用于分析实时内存 class=hash-link aria-label="1. 实时 Heap Dump（用于分析实时内存）的直接链接" title="1. 实时 Heap Dump（用于分析实时内存）的直接链接">​</a></h5>
<p>将 <code>be.conf</code> 中 <code>JEMALLOC_CONF</code> 的 <code>prof:false</code> 修改为 <code>prof:true</code>，将 <code>prof_active:false</code> 修改为 <code>prof_active:true</code>，然后重启 Doris BE。之后使用 Jemalloc Heap Dump HTTP 接口在 BE 机器上生成 Heap Profile 文件。</p>
<blockquote>
<p><strong>版本说明：</strong></p>
<ul>
<li>Doris 2.1.8 和 3.0.4 及之后的版本：<code>JEMALLOC_CONF</code> 中 <code>prof</code> 已默认为 <code>true</code>，无需修改。</li>
<li>Doris 2.1.8 和 3.0.4 之前的版本：<code>JEMALLOC_CONF</code> 中没有 <code>prof_active</code> 选项，只需将 <code>prof:false</code> 修改为 <code>prof:true</code> 即可。</li>
</ul>
</blockquote>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">curl http://be_host:be_webport/jeheap/dump</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>配置说明：</strong></p>
<ul>
<li><strong>Heap Profile 文件目录</strong>：可在 <code>be.conf</code> 中通过 <code>jeprofile_dir</code> 变量配置，默认为 <code>${DORIS_HOME}/log</code>。</li>
<li><strong>采样间隔</strong>：默认为 512KB，通常只记录约 10% 的内存，性能影响通常小于 10%。可以修改 <code>be.conf</code> 中 <code>JEMALLOC_CONF</code> 的 <code>lg_prof_sample</code> 参数（默认为 <code>19</code>，即 2^19 B = 512KB）。减小 <code>lg_prof_sample</code> 可以更频繁采样，使 Heap Profile 更接近真实内存，但会带来更大的性能损耗。</li>
</ul>
<p><strong>性能提示：</strong> 如果在做性能测试，建议保持 <code>prof:false</code> 以避免 Heap Dump 的性能开销。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=2-定期-heap-dump用于长时间观测内存>2. 定期 Heap Dump（用于长时间观测内存）<a href=#2-定期-heap-dump用于长时间观测内存 class=hash-link aria-label="2. 定期 Heap Dump（用于长时间观测内存）的直接链接" title="2. 定期 Heap Dump（用于长时间观测内存）的直接链接">​</a></h5>
<p>将 <code>be.conf</code> 中 <code>JEMALLOC_CONF</code> 的 <code>prof:false</code> 修改为 <code>prof:true</code>。Heap Profile 文件默认保存在 <code>${DORIS_HOME}/log</code> 目录，文件名前缀由 <code>be.conf</code> 中的 <code>JEMALLOC_PROF_PRFIX</code> 指定，默认为 <code>jemalloc_heap_profile_</code>。</p>
<blockquote>
<p><strong>注意：</strong> 在 Doris 2.1.6 之前，<code>JEMALLOC_PROF_PRFIX</code> 为空，需要修改为任意值作为 profile 文件名。</p>
</blockquote>
<p><strong>Dump 触发方式：</strong></p>
<ol>
<li>
<p><strong>内存累计申请一定值时 Dump</strong></p>
<p>将 <code>be.conf</code> 中 <code>JEMALLOC_CONF</code> 的 <code>lg_prof_interval</code> 修改为 <code>34</code>，此时内存累计申请 16GB（2^34 B = 16GB）时会 Dump 一次 profile。可以修改为任意值来调整 Dump 间隔。</p>
<blockquote>
<p><strong>注意：</strong> 在 Doris 2.1.6 之前，<code>lg_prof_interval</code> 默认就是 <code>32</code>。</p>
</blockquote>
</li>
<li>
<p><strong>内存每次达到新高时 Dump</strong></p>
<p>将 <code>be.conf</code> 中 <code>JEMALLOC_CONF</code> 的 <code>prof_gdump</code> 修改为 <code>true</code> 并重启 BE。</p>
</li>
<li>
<p><strong>程序退出时 Dump 并检测内存泄漏</strong></p>
<p>将 <code>be.conf</code> 中 <code>JEMALLOC_CONF</code> 的 <code>prof_leak</code> 和 <code>prof_final</code> 修改为 <code>true</code> 并重启 BE。</p>
</li>
<li>
<p><strong>Dump 内存累计值（growth）而非实时值</strong></p>
<p>将 <code>be.conf</code> 中 <code>JEMALLOC_CONF</code> 的 <code>prof_accum</code> 修改为 <code>true</code> 并重启 BE。使用 <code>jeprof --alloc_space</code> 展示 heap dump 累计值。</p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3-使用-jeprof-解析-heap-profile>3. 使用 <code>jeprof</code> 解析 Heap Profile<a href=#3-使用-jeprof-解析-heap-profile class=hash-link aria-label=3-使用-jeprof-解析-heap-profile的直接链接 title=3-使用-jeprof-解析-heap-profile的直接链接>​</a></h5>
<p>使用 <code>be/bin/jeprof</code> 解析上面 Dump 的 Heap Profile。如果进程内存较大，解析过程可能需要几分钟，请耐心等待。</p>
<p>若 Doris BE 部署路径的 <code>be/bin</code> 目录下没有 <code>jeprof</code> 二进制文件，可以将 <code>doris/tools</code> 目录下的 <code>jeprof</code> 打包后上传到服务器。</p>
<blockquote>
<p><strong>注意事项：</strong></p>
<ul>
<li>需要 addr2line 版本为 2.35.2 及以上，详情见下面的 QA-1。</li>
<li>尽可能在运行 Doris BE 的机器上直接执行 Heap Dump 和 <code>jeprof</code> 解析，详情见下面的 QA-2。</li>
</ul>
</blockquote>
<p><strong>1. 分析单个 Heap Profile 文件</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">jeprof --dot ${DORIS_HOME}/lib/doris_be ${DORIS_HOME}/log/profile_file</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>执行完上述命令后，将终端输出的文本贴到<a href=http://www.webgraphviz.com/ target=_blank rel="noopener noreferrer">在线 dot 绘图网站</a>，生成内存分配图进行分析。</p>
<p>如果服务器方便传输文件，也可以直接生成调用关系图 PDF 文件。需要先安装绘图所需的依赖项：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">yum install ghostscript graphviz</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">jeprof --pdf ${DORIS_HOME}/lib/doris_be ${DORIS_HOME}/log/profile_file > result.pdf</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><a href=http://www.graphviz.org/ target=_blank rel="noopener noreferrer">graphviz</a>：在没有这个库时 pprof 只能转换为 text 格式，但这种方式不易查看。安装后，pprof 可以转换为 SVG、PDF 等格式，调用关系更加清晰。</p>
<p><strong>2. 分析两个 Heap Profile 文件的 diff</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">jeprof --dot ${DORIS_HOME}/lib/doris_be --base=${DORIS_HOME}/log/profile_file ${DORIS_HOME}/log/profile_file2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>通过在一段时间内多次执行 Heap Dump，可以生成多个 heap 文件。选取较早时间的 heap 文件作为 baseline，与较晚时间的 heap 文件进行对比分析 diff。生成调用关系图的方法同上。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=4-常见问题qa>4. 常见问题（QA）<a href=#4-常见问题qa class=hash-link aria-label="4. 常见问题（QA）的直接链接" title="4. 常见问题（QA）的直接链接">​</a></h5>
<p><strong>QA-1：运行 jeprof 后出现大量错误：<code>addr2line: Dwarf Error: found dwarf version xxx, this reader only handles version xxx</code></strong></p>
<p>GCC 11 之后默认使用 DWARF-v5，这要求 Binutils 2.35.2 及以上。Doris Ldb_toolchain 使用了 GCC 11。参考：<a href=https://gcc.gnu.org/gcc-11/changes.html%E3%80%82 target=_blank rel="noopener noreferrer">https://gcc.gnu.org/gcc-11/changes.html。</a></p>
<p>解决方法：升级 addr2line 到 2.35.2 版本。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain"># 下载 addr2line 源码</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">wget https://ftp.gnu.org/gnu/binutils/binutils-2.35.tar.bz2</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># 安装依赖项（如果需要）</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">yum install make gcc gcc-c++ binutils</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># 编译 & 安装 addr2line</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">tar -xvf binutils-2.35.tar.bz2</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cd binutils-2.35</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">./configure --prefix=/usr/local</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">make</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">make install</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># 验证</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">addr2line -h</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># 替换 addr2line</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">chmod +x addr2line</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mv /usr/bin/addr2line /usr/bin/addr2line.bak</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">mv /bin/addr2line /bin/addr2line.bak</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cp addr2line /bin/addr2line</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">cp addr2line /usr/bin/addr2line</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">hash -r</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>注意：</strong> 不能使用 addr2line 2.3.9，该版本可能不兼容，导致内存一直增长。</p>
<p><strong>QA-2：运行 <code>jeprof</code> 后出现大量错误：<code>addr2line: DWARF error: invalid or unhandled FORM value: 0x25</code>，解析后的 Heap 栈都是代码的内存地址而非函数名称</strong></p>
<p>通常是因为执行 Heap Dump 和执行 <code>jeprof</code> 解析 Heap Profile 不在同一台服务器上，导致 <code>jeprof</code> 使用符号表解析函数名称失败。</p>
<p>解决方法：</p>
<ul>
<li>尽可能在同一台机器上完成 Dump Heap 和 <code>jeprof</code> 解析的操作，即尽可能在运行 Doris BE 的机器上直接解析 Heap Profile。</li>
<li>或者确认运行 Doris BE 的机器 Linux 内核版本，将 <code>be/bin/doris_be</code> 二进制文件和 Heap Profile 文件下载到相同内核版本的机器上执行 <code>jeprof</code>。</li>
</ul>
<p><strong>QA-3：如果在运行 Doris BE 的机器上直接解析 Heap Profile 后，Heap 栈依然是代码的内存地址而非函数名称</strong></p>
<p>使用下面的脚本手动解析 Heap Profile，修改这几个变量：</p>
<ul>
<li><code>heap</code>：Heap Profile 的文件名。</li>
<li><code>bin</code>：<code>be/bin/doris_be</code> 二进制文件名。</li>
<li><code>llvm_symbolizer</code>：llvm 符号表解析程序的路径，版本最好是编译 <code>be/bin/doris_be</code> 二进制使用的版本。</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">#!/bin/bash</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">## @brief</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">## @author zhoufei</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">## @email  gavineaglechou@gmail.com</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">## @date   2024-02-24-Sat</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># 1. jeprof --dot ${bin} ${heap} > heap.dot to generate calling profile</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># 2. find base addr and symbol</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># 3. get addr to symble table with llvm-symbolizer</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># 4. replace the addr with symbol</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># heap file name</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">heap=jeheap_dump.1708694081.3443.945778264.heap</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># binary name</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">bin=doris_be_aws.3.0.5</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># path to llvm symbolizer</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">llvm_symbolizer=$HOME/opt/ldb-toolchain-16/bin/llvm-symbolizer</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># output file name</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">out=out.dot</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">vaddr_baddr_symbol=vaddr_baddr_symbol.txt</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">program_name=doris_be</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">jeprof --dot ${bin} ${heap} > ${out}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">baseaddr=$(grep ${program_name} ${heap} | head -n 1 | awk -F'-' '{print $1}')</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">echo "$baseaddr: ${baseaddr}"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">function find_symbol() {</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  local addr="$1"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  "${llvm_symbolizer}" --inlining --obj=${bin} ${addr} | head -n 1 | awk -F'(' '{print $1}'</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">if [ -f ${vaddr_baddr_symbol} ]; then</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  cat ${vaddr_baddr_symbol} | while read vaddr baddr; do</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    symbol=$(find_symbol ${baddr})</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    echo "${vaddr} ${baddr} ${symbol}"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    sed -ri.orig "s/${vaddr}/${symbol}/g" ${out}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  done</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">else # recalculate the addr and</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  grep -oP '0x(\d|[a-f])+' ${out} | xargs -I {} python -c "print('{}', '0x{:x}'.format({} - 0x${baseaddr}))" \</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    | while read vaddr baddr; do</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    symbol=$(find_symbol ${baddr})</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    echo "${vaddr} ${baddr} ${symbol}"</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    sed -ri.orig "s/${vaddr}/${symbol}/g" ${out}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  done | tee ${vaddr_baddr_symbol}</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">fi</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"># vim: et tw=80 ts=2 sw=2 cc=80:</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>QA-4：如果上面所有的方法都不行</strong></p>
<ul>
<li>尝试在运行 Doris BE 的机器上重新编译 <code>be/bin/doris_be</code> 二进制，让编译、运行、<code>jeprof</code> 解析在同一台机器上。</li>
<li>如果上述操作后 Heap 栈依然是代码的内存地址，尝试使用 <code>USE_JEMALLOC=OFF ./build.sh --be</code> 编译使用 TCMalloc 的 Doris BE，然后参考下面的章节使用 TCMalloc Heap Profile 分析内存。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=tcmalloc-heap-profile>TCMalloc Heap Profile<a href=#tcmalloc-heap-profile class=hash-link aria-label="TCMalloc Heap Profile的直接链接" title="TCMalloc Heap Profile的直接链接">​</a></h4>
<blockquote>
<p><strong>说明：</strong> Doris 1.2.1 及之前版本使用 TCMalloc，Doris 1.2.2 版本开始默认使用 Jemalloc。如需切换回 TCMalloc，可使用 <code>USE_JEMALLOC=OFF sh build.sh --be</code> 进行编译。</p>
</blockquote>
<p>当使用 TCMalloc 时，遇到大内存申请会将申请的堆栈打印到 <code>be.out</code> 文件中，一般的表现形式如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">tcmalloc: large alloc 1396277248 bytes == 0x3f3488000 @  0x2af6f63 0x2c4095b 0x134d278 0x134bdcb 0x133d105 0x133d1d0 0x19930ed</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这表示 Doris BE 在该堆栈上尝试申请 <code>1396277248 bytes</code> 的内存。可以通过 <code>addr2line</code> 命令将堆栈还原成可读的信息，具体示例如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">addr2line -e lib/doris_be 0x2af6f63 0x2c4095b 0x134d278 0x134bdcb 0x133d105 0x133d1d0 0x19930ed</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>输出示例：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">/home/ssd0/zc/palo/doris/core/thirdparty/src/gperftools-gperftools-2.7/src/tcmalloc.cc:1335</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">/home/ssd0/zc/palo/doris/core/thirdparty/src/gperftools-gperftools-2.7/src/tcmalloc.cc:1357</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">/home/disk0/baidu-doris/baidu/bdg/doris-baidu/core/be/src/exec/hash_table.cpp:267</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">/home/disk0/baidu-doris/baidu/bdg/doris-baidu/core/be/src/exec/hash_table.hpp:86</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">/home/disk0/baidu-doris/baidu/bdg/doris-baidu/core/be/src/exec/hash_join_node.cpp:239</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">/home/disk0/baidu-doris/baidu/bdg/doris-baidu/core/be/src/exec/hash_join_node.cpp:213</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">thread.cpp:?</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>有时内存申请并非由大内存申请导致，而是通过小内存不断堆积导致。这种情况下无法通过查看日志定位具体的申请信息，就需要通过其他方式来获取信息。</p>
<p>这时可以利用 TCMalloc 的 <a href=https://gperftools.github.io/gperftools/heapprofile.html target=_blank rel="noopener noreferrer">HEAP PROFILE</a> 功能。设置 HEAPPROFILE 功能后，可以获得进程整体的内存申请使用情况。使用方式是在启动 Doris BE 前设置 <code>HEAPPROFILE</code> 环境变量。例如：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">export TCMALLOC_SAMPLE_PARAMETER=64000 HEAP_PROFILE_ALLOCATION_INTERVAL=-1 HEAP_PROFILE_INUSE_INTERVAL=-1 HEAP_PROFILE_TIME_INTERVAL=5 HEAPPROFILE=/tmp/doris_be.hprof</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">./bin/start_be.sh --daemon</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<blockquote>
<p><strong>注意：</strong> HEAPPROFILE 需要是绝对路径，且目录必须已经存在。</p>
</blockquote>
<p>这样，当满足 HEAPPROFILE 的 Dump 条件时，就会将内存的整体使用情况写入到指定路径的文件中。后续可以使用 <code>pprof</code> 工具对输出的内容进行分析。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">pprof --text lib/doris_be /tmp/doris_be.hprof.0012.heap | head -30</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>输出示例：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">Using local file lib/doris_be.</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Using local file /tmp/doris_be.hprof.0012.heap.</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Total: 668.6 MB</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">   610.6  91.3%  91.3%    610.6  91.3% doris::SystemAllocator::allocate_via_malloc (inline)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    18.1   2.7%  94.0%     18.1   2.7% _objalloc_alloc</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">     5.6   0.8%  94.9%     63.4   9.5% doris::RowBatch::RowBatch</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">     5.1   0.8%  95.6%      7.1   1.1% butil::ResourcePool::add_block (inline)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">     3.7   0.5%  96.2%      3.7   0.5% butil::iobuf::create_block (inline)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">     3.4   0.5%  96.7%      3.4   0.5% butil::FlatMap::init</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">     3.2   0.5%  97.2%      5.2   0.8% butil::ObjectPool::add_block (inline)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">     2.6   0.4%  97.6%      2.6   0.4% __gnu_cxx::new_allocator::allocate (inline)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">     2.0   0.3%  97.9%      2.0   0.3% butil::ObjectPool::add_block_group (inline)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">     2.0   0.3%  98.2%      2.0   0.3% butil::ResourcePool::add_block_group (inline)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">     1.7   0.3%  98.4%      1.7   0.3% doris::SegmentReader::_load_index</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>各列的含义：</strong></p>
<ul>
<li><strong>第一列</strong>：函数直接申请的内存大小，单位 MB。</li>
<li><strong>第二列</strong>：第一列的百分比。</li>
<li><strong>第三列</strong>：第二列的累积值。</li>
<li><strong>第四列</strong>：函数及其所有调用的函数总共占用的内存大小，单位 MB。</li>
<li><strong>第五列</strong>：第四列的百分比。</li>
</ul>
<p>当然也可以生成调用关系图片，更加方便分析。例如下面的命令可以生成 SVG 格式的调用关系图：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">pprof --svg lib/doris_be /tmp/doris_be.hprof.0012.heap > heap.svg</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>性能提示：</strong> 开启该选项会影响程序的执行性能，请慎重对线上实例开启。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=pprof-remote-server>pprof Remote Server<a href=#pprof-remote-server class=hash-link aria-label="pprof Remote Server的直接链接" title="pprof Remote Server的直接链接">​</a></h5>
<p>HEAP PROFILE 虽然能够获得全部的内存使用信息，但也有一些限制：1. 需要重启 BE；2. 需要一直开启该功能，导致对进程性能造成持续影响。</p>
<p>对 Doris BE 可以使用动态开启、关闭 heap profile 的方式来分析进程的内存申请情况。Doris 内部支持了 GPerftools 的<a href=https://gperftools.github.io/gperftools/pprof_remote_servers.html target=_blank rel="noopener noreferrer">远程 server 调试</a>。可以通过 <code>pprof</code> 工具直接对远程运行的 Doris BE 进行动态的 HEAP PROFILE。例如，通过以下命令查看 Doris 的内存使用增量：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">pprof --text --seconds=60 http://be_host:be_webport/pprof/heap</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>输出示例：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">Total: 1296.4 MB</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">   484.9  37.4%  37.4%    484.9  37.4% doris::StorageByteBuffer::create</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">   272.2  21.0%  58.4%    273.3  21.1% doris::RowBlock::init</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">   157.5  12.1%  70.5%    157.5  12.1% doris::RowBatch::RowBatch</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    90.7   7.0%  77.5%     90.7   7.0% doris::SystemAllocator::allocate_via_malloc</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    66.6   5.1%  82.7%     66.6   5.1% doris::IntegerColumnReader::init</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    47.9   3.7%  86.4%     47.9   3.7% __gnu_cxx::new_allocator::allocate</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    20.8   1.6%  88.0%     35.4   2.7% doris::SegmentReader::_load_index</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    12.7   1.0%  89.0%     12.7   1.0% doris::DecimalColumnReader::init</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    12.7   1.0%  89.9%     12.7   1.0% doris::LargeIntColumnReader::init</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    12.7   1.0%  90.9%     12.7   1.0% doris::StringColumnDirectReader::init</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    12.3   0.9%  91.9%     12.3   0.9% std::__cxx11::basic_string::_M_mutate</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    10.4   0.8%  92.7%     10.4   0.8% doris::VectorizedRowBatch::VectorizedRowBatch</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    10.0   0.8%  93.4%     10.0   0.8% doris::PlainTextLineReader::PlainTextLineReader</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个命令的输出和查看方式与 HEAP PROFILE 的输出一致。该命令只在执行过程中开启统计，相比 HEAP PROFILE 对进程性能的影响更小。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=lsan内存泄漏检测工具>LSAN（内存泄漏检测工具）<a href=#lsan内存泄漏检测工具 class=hash-link aria-label=LSAN（内存泄漏检测工具）的直接链接 title=LSAN（内存泄漏检测工具）的直接链接>​</a></h4>
<p><a href=https://github.com/google/sanitizers/wiki/AddressSanitizerLeakSanitizer target=_blank rel="noopener noreferrer">LSAN</a> 是一个地址检查工具，GCC 已经集成。在编译代码时开启相应的编译选项，就能够开启该功能。当程序发生可以确定的内存泄漏时，会将泄漏堆栈打印出来。Doris BE 已经集成了该工具，只需在编译时使用如下命令即可生成带有内存泄漏检测版本的 BE 二进制：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">BUILD_TYPE=LSAN ./build.sh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>当系统检测到内存泄漏时，就会在 <code>be.out</code> 中输出对应的信息。为了演示，我们故意在代码中插入一段内存泄漏代码。在 <code>StorageEngine</code> 的 <code>open</code> 函数中插入如下代码：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token operator">*</span><span class="token plain"> leak_buf </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1024</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">strcpy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">leak_buf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"hello world"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">LOG</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> leak_buf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>然后在 <code>be.out</code> 中就能获得如下输出：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">=================================================================</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">==24732==ERROR: LeakSanitizer: detected memory leaks</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">Direct leak of 1024 byte(s) in 1 object(s) allocated from:</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #0 0xd10586 in operator new (unsigned long) ../../../../gcc-7.3.0/libsanitizer/lsan/lsan_interceptors.cc:164</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #1 0xe333a2 in doris::StorageEngine::open(doris::EngineOptions const&, doris::StorageEngine**) /home/ssd0/zc/palo/doris/core/be/src/olap/storage_engine.cpp:104</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #2 0xd3cc96 in main /home/ssd0/zc/palo/doris/core/be/src/service/doris_main.cpp:159</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #3 0x7f573b5eebd4 in __libc_start_main (/opt/compiler/gcc-4.8.2/lib64/libc.so.6+0x21bd4)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">SUMMARY: LeakSanitizer: 1024 byte(s) leaked in 1 allocation(s).</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>从上述输出中可以看到有 1024 个字节被泄漏，并且打印出了内存申请时的堆栈信息。</p>
<p><strong>性能提示：</strong> 开启该选项会影响程序的执行性能，请慎重对线上实例开启。</p>
<p><strong>注意：</strong> 开启 LSAN 后，TCMalloc 会被自动关闭。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=asan地址合法性检测工具>ASAN（地址合法性检测工具）<a href=#asan地址合法性检测工具 class=hash-link aria-label=ASAN（地址合法性检测工具）的直接链接 title=ASAN（地址合法性检测工具）的直接链接>​</a></h4>
<p>除了内存使用不合理、泄漏以外，有时也会发生内存访问非法地址等错误。这时可以借助 <a href=https://github.com/google/sanitizers/wiki/AddressSanitizer target=_blank rel="noopener noreferrer">ASAN</a> 来帮助找到问题的原因。与 LSAN 一样，ASAN 也集成在了 GCC 中。Doris 通过如下方式进行编译就能开启该功能：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">BUILD_TYPE=ASAN ./build.sh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>执行编译生成的二进制文件后，当检测工具发现异常访问时，就会立即退出，并将非法访问的堆栈输出在 <code>be.out</code> 中。对于 ASAN 的输出与 LSAN 使用相同的分析方法。为了演示，我们主动注入一个地址访问错误。仍然在 <code>StorageEngine</code> 的 <code>open</code> 函数中注入一段非法内存访问代码：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token operator">*</span><span class="token plain"> invalid_buf </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1024</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">1025</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    invalid_buf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">LOG</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain"> invalid_buf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>然后在 <code>be.out</code> 中就会获得如下输出：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">=================================================================</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">==23284==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61900008bf80 at pc 0x00000129f56a bp 0x7fff546eed90 sp 0x7fff546eed88</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">WRITE of size 1 at 0x61900008bf80 thread T0</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #0 0x129f569 in doris::StorageEngine::open(doris::EngineOptions const&, doris::StorageEngine**) /home/ssd0/zc/palo/doris/core/be/src/olap/storage_engine.cpp:106</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #1 0xe2c1e3 in main /home/ssd0/zc/palo/doris/core/be/src/service/doris_main.cpp:159</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #2 0x7fa5580fbbd4 in __libc_start_main (/opt/compiler/gcc-4.8.2/lib64/libc.so.6+0x21bd4)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #3 0xd30794  (/home/ssd0/zc/palo/doris/core/output3/be/lib/doris_be+0xd30794)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">0x61900008bf80 is located 0 bytes to the right of 1024-byte region [0x61900008bb80,0x61900008bf80)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">allocated by thread T0 here:</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #0 0xdeb040 in operator new[](unsigned long) ../../../../gcc-7.3.0/libsanitizer/asan/asan_new_delete.cc:82</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #1 0x129f50d in doris::StorageEngine::open(doris::EngineOptions const&, doris::StorageEngine**) /home/ssd0/zc/palo/doris/core/be/src/olap/storage_engine.cpp:104</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #2 0xe2c1e3 in main /home/ssd0/zc/palo/doris/core/be/src/service/doris_main.cpp:159</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">    #3 0x7fa5580fbbd4 in __libc_start_main (/opt/compiler/gcc-4.8.2/lib64/libc.so.6+0x21bd4)</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">SUMMARY: AddressSanitizer: heap-buffer-overflow /home/ssd0/zc/palo/doris/core/be/src/olap/storage_engine.cpp:106 in doris::StorageEngine::open(doris::EngineOptions const&, doris::StorageEngine**)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>从这段信息中可以看到在 <code>0x61900008bf80</code> 这个地址尝试写入一个字节，但该地址是非法的。同时也可以看到 <code>[0x61900008bb80,0x61900008bf80)</code> 这个地址区域的申请堆栈。</p>
<p><strong>性能提示：</strong> 开启该选项会影响程序的执行性能，请慎重对线上实例开启。</p>
<p><strong>注意：</strong> 开启 ASAN 后，TCMalloc 会被自动关闭。</p>
<p>另外，如果 <code>be.out</code> 中输出的堆栈信息没有函数符号，需要手动处理才能获得可读的堆栈信息。可以使用 <a href=https://llvm.org/svn/llvm-project/compiler-rt/trunk/lib/asan/scripts/asan_symbolize.py target=_blank rel="noopener noreferrer">asan_symbolize</a> 脚本来解析 ASAN 的输出，具体使用方式如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">cat be.out | python asan_symbolize.py | c++filt</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>通过上述命令就能获得可读的堆栈信息。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=cpu-调试>CPU 调试<a href=#cpu-调试 class=hash-link aria-label="CPU 调试的直接链接" title="CPU 调试的直接链接">​</a></h3>
<p>当系统的 CPU Idle 很低时，说明 CPU 已经成为主要瓶颈，这时需要分析当前的 CPU 使用情况。对于 Doris BE，有以下几种方式来分析 CPU 瓶颈。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=doris-debug-tools-1>Doris Debug Tools<a href=#doris-debug-tools-1 class=hash-link aria-label="Doris Debug Tools的直接链接" title="Doris Debug Tools的直接链接">​</a></h4>
<p><a href=https://github.com/morningman/doris-debug-tools target=_blank rel="noopener noreferrer">Doris Debug Tools</a> 提供封装好的 CPU 火焰图和内存分析工具，可以直接下载使用。</p>
<ul>
<li><a href=https://github.com/morningman/doris-debug-tools/releases target=_blank rel="noopener noreferrer">Releases</a></li>
</ul>
<blockquote>
<p>注：非官方工具，仅用于开发调试。</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=pprof>pprof<a href=#pprof class=hash-link aria-label=pprof的直接链接 title=pprof的直接链接>​</a></h4>
<p><a href=https://github.com/google/pprof target=_blank rel="noopener noreferrer">pprof</a> 来自 gperftools，用于将 gperftools 产生的内容转换成便于阅读的格式，如 PDF、SVG、Text 等。</p>
<p>由于 Doris 内部已集成并兼容了 GPerf 的 REST 接口，可以通过 <code>pprof</code> 工具分析远程的 Doris BE。具体使用方式如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">pprof --svg --seconds=60 http://be_host:be_webport/pprof/profile > be.svg</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>该命令会生成一张 BE 执行的 CPU 消耗图。</p>
<p><img decoding=async loading=lazy alt="CPU Pprof" src=/zh-CN/assets/images/cpu-pprof-demo-46064afc3672559af190f0698ed9ef52.png width=1196 height=1488 class=img_ev3q></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=perf--flamegraph>perf + FlameGraph<a href=#perf--flamegraph class=hash-link aria-label="perf + FlameGraph的直接链接" title="perf + FlameGraph的直接链接">​</a></h4>
<p>这是一种非常通用的 CPU 分析方式。相比 <code>pprof</code>，这种方式必须要求能够登录到分析对象的物理机上。但相比 pprof 只能定时采样，perf 能够通过不同的事件来完成堆栈信息采集。</p>
<p><strong>工具介绍：</strong></p>
<ul>
<li><a href=https://perf.wiki.kernel.org/index.php/Main_Page target=_blank rel="noopener noreferrer">perf</a>：Linux 内核自带的性能分析工具。<a href=http://www.brendangregg.com/perf.html target=_blank rel="noopener noreferrer">这里</a>有一些 perf 的使用示例。</li>
<li><a href=https://github.com/brendangregg/FlameGraph target=_blank rel="noopener noreferrer">FlameGraph</a>：可视化工具，用于将 perf 的输出以火焰图的形式展示。</li>
</ul>
<p><strong>使用方法：</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">perf record -g -p be_pid -- sleep 60</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>该命令会统计 60 秒钟 BE 的 CPU 运行情况，并生成 <code>perf.data</code> 文件。对于 <code>perf.data</code> 的分析，可以通过 perf 命令进行：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">perf report</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>分析得到的示例：</p>
<p><img decoding=async loading=lazy alt="Perf Report" src=/zh-CN/assets/images/perf-report-demo-5987234ce899968a08be49a29f51acb1.png width=1102 height=412 class=img_ev3q></p>
<p>当然也可以使用 FlameGraph 进行可视化展示：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">perf script | ./FlameGraph/stackcollapse-perf.pl | ./FlameGraph/flamegraph.pl > be.svg</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这样也会生成一张当时运行的 CPU 消耗图。</p>
<p><img decoding=async loading=lazy alt="CPU Flame" src=/zh-CN/assets/images/cpu-flame-demo-727a5b8c32db9b3b129481ac75405b5d.svg width=1200 height=418 class=img_ev3q></div></article><div class="flex items-center text-sm lg:text-base justify-end lg:col mt-10"><a href="https://github.com/apache/doris-website/issues/new?title=Issue on docs&body=Path:false" target=_blank rel="noopener noreferrer" class="lg:mr-6 footerBtn_e3I8"><svg width=20 height=20 viewBox="0 0 20 20" fill=none><path d="M9.48038 2.9C9.71132 2.5 10.2887 2.5 10.5196 2.9L18.1406 16.1C18.3716 16.5 18.0829 17 17.621 17H2.37898C1.9171 17 1.62842 16.5 1.85936 16.1L9.48038 2.9Z" stroke=currentColor stroke-width=1.2 stroke-linecap=round /><path d="M10.5699 7.9516C10.5874 7.5628 10.2769 7.23804 9.88766 7.23804C9.49847 7.23804 9.18796 7.5628 9.20543 7.9516L9.41597 12.6385C9.42731 12.8908 9.63513 13.0895 9.88766 13.0895C10.1402 13.0895 10.348 12.8908 10.3593 12.6385L10.5699 7.9516ZM9.89338 13.7638C9.65338 13.7638 9.44766 13.8323 9.28766 13.9923C9.12766 14.1409 9.04766 14.3352 9.04766 14.5752C9.04766 14.8152 9.12766 15.0095 9.28766 15.1695C9.45909 15.318 9.6648 15.398 9.89338 15.398C10.1219 15.398 10.3162 15.318 10.4762 15.158C10.6477 14.998 10.7277 14.8038 10.7277 14.5752C10.7277 14.3352 10.6477 14.1409 10.4762 13.9923C10.3162 13.8323 10.1219 13.7638 9.89338 13.7638Z" fill=currentColor /></svg> <span class=ml-2>Report issue</span></a></div><nav class="pagination-nav docusaurus-mt-lg" aria-label=文件选项卡><a class="pagination-nav__link pagination-nav__link--prev" href=/zh-CN/community/design/spark_load/><div class=pagination-nav__sublabel>上一页</div><div class=pagination-nav__label>Doris支持spark导入设计文档</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/zh-CN/community/developer-guide/docker-dev/><div class=pagination-nav__sublabel>下一页</div><div class=pagination-nav__label>Doris Docker 快速搭建开发环境</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar toc-container theme-doc-toc-desktop"><div><a href=/zh-CN/><div class="toc-icon-content group"><svg width=21 height=20 fill=currentColor viewBox="0 0 21 20" class=group-hover:text-primary><path fill-rule=evenodd d="M3.835 6.44a1 1 0 0 0-.445.832v8.939c0 .436.354.79.79.79H16.81a.79.79 0 0 0 .79-.79V7.272a1 1 0 0 0-.446-.832L11.05 2.37a1 1 0 0 0-1.11 0zm7.26 4.16a.6.6 0 1 0-1.2 0v3.3a.6.6 0 0 0 1.2 0z" clip-rule=evenodd /></svg><span class=group-hover:text-primary>Doris 首页</span></div></a><div class="cursor-pointer toc-icon-content group"><svg class=group-hover:text-primary width=21 height=20 fill=currentColor viewBox="0 0 21 20"><path d="M15.944 3H5.056C4.2 3 3.5 3.7 3.5 4.556v10.888C3.5 16.3 4.2 17 5.056 17h10.888c.856 0 1.556-.7 1.556-1.556V4.557C17.5 3.7 16.8 3 15.944 3m-5.791 5.998c-.179.575-.384 1.466-.686 2.197-.156.396-.149.327-.266.577l.101-.033c1.04-.29 1.767-.363 2.444-.487-.136-.107-.254-.19-.348-.276-.464-.515-.627-.611-1.245-1.978m5.1 3.297c-.133.147-.366.233-.708.233-.591 0-1.129-.163-1.906-.56-1.338.148-2.761.304-3.562.561q-.06.02-.14.055c-.965 1.648-1.68 2.347-2.31 2.32-.2-.01-.49-.125-.583-.18l-.116-.109-.04-.077a.7.7 0 0 1-.039-.42c.086-.412.529-1.065 1.462-1.649.148-.109.485-.281.796-.429.236-.374.345-.614.643-1.278a23 23 0 0 0 .84-2.443V8.31c-.288-.941-.459-1.58-.171-2.614.07-.296.327-.6.614-.6h.187c.179 0 .35.063.475.188.513.513.272 1.836.015 2.87q-.02.072-.031.109c.311.879.803 1.747 1.293 2.151.202.156.4.335.65.475a9 9 0 0 1 .982-.073c.964 0 1.547.17 1.773.536a.63.63 0 0 1 .093.428.75.75 0 0 1-.218.513m-.492-.65c-.078-.078-.301-.3-1.39-.3-.055 0-.188-.014-.258.064.568.249 1.111.438 1.469.438q.08-.002.148-.016h.03c.04-.015.063-.023.07-.1-.015-.024-.03-.055-.07-.086m-6.846 1.114a3 3 0 0 0-.374.242c-.552.505-.902 1.019-.94 1.314.35-.117.808-.63 1.314-1.556m2.22-5.266.04-.031c.054-.25.092-.517.139-.688l.023-.124c.078-.444.048-.703-.084-.89l-.117-.038q-.03.045-.054.093c-.133.327-.125.978.053 1.678"/></svg><span class="group-hover:text-primary mr-2">下载 PDF</span><div class="ant-spin ant-spin-sm css-1v613y0" aria-live=polite aria-busy=false><span class=ant-spin-dot-holder><span class="ant-spin-dot ant-spin-dot-spin"><i class=ant-spin-dot-item></i><i class=ant-spin-dot-item></i><i class=ant-spin-dot-item></i><i class=ant-spin-dot-item></i></span></span></div></div><a href=https://doris-forum.org.cn target=_blank rel="noopener noreferrer"><div class="toc-icon-content group"><svg width=20 height=20 fill=none viewBox="0 0 20 20" class=group-hover:text-primary><g clip-path=url(#a)><path fill=currentColor fill-rule=evenodd d="M3.75 3a.75.75 0 0 0-.75.75v9.519c0 .414.336.75.75.75h1.884v2.3a.4.4 0 0 0 .595.349l4.577-2.554a.75.75 0 0 1 .366-.095h5.078a.75.75 0 0 0 .75-.75V3.75a.75.75 0 0 0-.75-.75zM7.5 8.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3.5 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m2.5 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2" clip-rule=evenodd /></g><defs><clipPath id=a><path fill=#fff d="M0 0h20v20H0z"/></clipPath></defs></svg> <span class=group-hover:text-primary>技术论坛</span></div></a></div><div><span class="ml-4 title-text">本页导航</span><ul class="table-of-contents table-of-contents__left-border"><li><a href=#fe-调试 class="table-of-contents__link toc-highlight">FE 调试</a><ul><li><a href=#1-统计当前内存使用明细 class="table-of-contents__link toc-highlight">1. 统计当前内存使用明细</a><li><a href=#2-查看-jvm-内存使用 class="table-of-contents__link toc-highlight">2. 查看 JVM 内存使用</a><li><a href=#3-打印-fe-线程堆栈 class="table-of-contents__link toc-highlight">3. 打印 FE 线程堆栈</a></ul><li><a href=#be-调试 class="table-of-contents__link toc-highlight">BE 调试</a><ul><li><a href=#内存调试 class="table-of-contents__link toc-highlight">内存调试</a><li><a href=#cpu-调试 class="table-of-contents__link toc-highlight">CPU 调试</a></ul></ul></div></div></div></div></div></main></div></div></div><div class="footer pt-16 pb-10"><div class=container><div class=footer-box><div class=left><img src=/zh-CN/images/asf_logo_apache.svg alt="" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src=/zh-CN/images/asf_logo_apache.svg alt="" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>ASF</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.apache.org/ target=_blank rel="noopener noreferrer" class=footer__link-item>Foundation<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.apache.org/licenses/ target=_blank rel="noopener noreferrer" class=footer__link-item>License<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.apache.org/events/current-event target=_blank rel="noopener noreferrer" class=footer__link-item>Events<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.apache.org/foundation/sponsorship.html target=_blank rel="noopener noreferrer" class=footer__link-item>Sponsorship<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://privacy.apache.org/policies/privacy-policy-public.html target=_blank rel="noopener noreferrer" class=footer__link-item>Privacy<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.apache.org/security/ target=_blank rel="noopener noreferrer" class=footer__link-item>Security<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.apache.org/foundation/thanks.html target=_blank rel="noopener noreferrer" class=footer__link-item>Thanks<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Resources</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/zh-CN/download/>Download</a><li class=footer__item><a class=footer__link-item href=/zh-CN/blog/>Blog</a><li class=footer__item><a class=footer__link-item href=/zh-CN/ecosystem/cluster-management/>Ecosystem</a><li class=footer__item><a class=footer__link-item href=/zh-CN/users/>Users</a><li class=footer__item><a href=https://github.com/apache/doris/discussions target=_blank rel="noopener noreferrer" class=footer__link-item>Discussions<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/zh-CN/community/how-to-contribute/contribute-to-doris/>How to contribute</a><li class=footer__item><a href=https://github.com/apache/doris/ target=_blank rel="noopener noreferrer" class=footer__link-item>Source code<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a class=footer__link-item href=/zh-CN/community/team/>Doris team</a><li class=footer__item><a href=https://github.com/apache/doris/issues/30669 target=_blank rel="noopener noreferrer" class=footer__link-item>Roadmap<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://cwiki.apache.org/confluence/display/DORIS/Doris+Improvement+Proposals target=_blank rel="noopener noreferrer" class=footer__link-item>Improvement proposal<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div></div></div><div class=right><div class=footer__title>Join the community</div><div class=social-list><div class=social><a href=mailto:dev@doris.apache.org target=_blank title=mail class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><path d="M5.6003 6H26.3997C27.8186 6 28.982 7.10964 29 8.46946L16.0045 15.454L3.01202 8.47829C3.02405 7.11258 4.1784 6 5.6003 6ZM3.01202 11.1508L3 23.5011C3 24.8756 4.16938 26 5.6003 26H26.3997C27.8306 26 29 24.8756 29 23.5011V11.145L16.3111 17.8028C16.1157 17.9058 15.8813 17.9058 15.6889 17.8028L3.01202 11.1508Z" fill=currentColor /></svg></a><a href=https://github.com/apache/doris target=_blank title=github class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><path d="M16.0001 2.66675C8.63342 2.66675 2.66675 8.63341 2.66675 16.0001C2.66524 18.7991 3.54517 21.5276 5.1817 23.7983C6.81824 26.0691 9.12828 27.7668 11.7841 28.6508C12.4508 28.7668 12.7001 28.3668 12.7001 28.0161C12.7001 27.7001 12.6828 26.6508 12.6828 25.5334C9.33342 26.1508 8.46675 24.7174 8.20008 23.9668C8.04942 23.5828 7.40008 22.4001 6.83342 22.0828C6.36675 21.8334 5.70008 21.2161 6.81608 21.2001C7.86675 21.1828 8.61608 22.1668 8.86675 22.5668C10.0668 24.5828 11.9841 24.0161 12.7494 23.6668C12.8668 22.8001 13.2161 22.2174 13.6001 21.8841C10.6334 21.5508 7.53342 20.4001 7.53342 15.3001C7.53342 13.8494 8.04942 12.6507 8.90008 11.7161C8.76675 11.3827 8.30008 10.0161 9.03342 8.18275C9.03342 8.18275 10.1494 7.83342 12.7001 9.55075C13.7855 9.2495 14.907 9.09787 16.0334 9.10008C17.1668 9.10008 18.3001 9.24942 19.3668 9.54942C21.9161 7.81608 23.0334 8.18408 23.0334 8.18408C23.7668 10.0174 23.3001 11.3841 23.1668 11.7174C24.0161 12.6507 24.5334 13.8334 24.5334 15.3001C24.5334 20.4174 21.4174 21.5508 18.4508 21.8841C18.9334 22.3001 19.3508 23.1001 19.3508 24.3508C19.3508 26.1334 19.3334 27.5668 19.3334 28.0174C19.3334 28.3668 19.5841 28.7828 20.2508 28.6494C22.8975 27.7558 25.1973 26.0547 26.8266 23.7856C28.4559 21.5165 29.3327 18.7936 29.3334 16.0001C29.3334 8.63341 23.3668 2.66675 16.0001 2.66675V2.66675Z" fill=currentColor /></svg></a><a href=https://twitter.com/doris_apache target=_blank title=twitter class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><path d="M4.625 4.625H11.2809L27.375 27.375H20.7191L4.625 4.625ZM7.52549 6.10639L21.5236 25.8936H24.4746L10.4764 6.10639H7.52549Z" fill=currentColor /><path d="M14.4268 18.4803L6.53447 27.375H4.625L13.5581 17.2525L14.4268 18.4803ZM18.1299 14.3066L26.7203 4.625H24.7017L17.2525 13.0662L18.1299 14.3066Z" fill=currentColor /></svg></a><a href=https://doris.apache.org/slack title=slack target=_blank class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><g clip-path=url(#clip0_125_278)><path d="M12.5875 16.6906C11.0844 16.6906 9.86562 17.9094 9.86562 19.4125V26.2375C9.86562 26.9594 10.1524 27.6517 10.6628 28.1622C11.1733 28.6726 11.8656 28.9594 12.5875 28.9594C13.3094 28.9594 14.0017 28.6726 14.5122 28.1622C15.0226 27.6517 15.3094 26.9594 15.3094 26.2375V19.4531C15.3094 17.9094 14.0906 16.6906 12.5875 16.6906ZM3 19.4531C3 20.175 3.28677 20.8673 3.79722 21.3778C4.30767 21.8882 4.99999 22.175 5.72187 22.175C6.44376 22.175 7.13608 21.8882 7.64653 21.3778C8.15698 20.8673 8.44375 20.175 8.44375 19.4531V16.7312H5.7625C4.25938 16.6906 3 17.9094 3 19.4531ZM12.5875 3C11.8656 3 11.1733 3.28677 10.6628 3.79722C10.1524 4.30767 9.86562 4.99999 9.86562 5.72187C9.86562 6.44376 10.1524 7.13608 10.6628 7.64653C11.1733 8.15698 11.8656 8.44375 12.5875 8.44375H15.3094V5.72187C15.3094 4.21875 14.0906 3 12.5875 3ZM5.72187 15.3094H12.5469C13.2688 15.3094 13.9611 15.0226 14.4715 14.5122C14.982 14.0017 15.2688 13.3094 15.2688 12.5875C15.2688 11.8656 14.982 11.1733 14.4715 10.6628C13.9611 10.1524 13.2688 9.86562 12.5469 9.86562H5.72187C4.99999 9.86562 4.30767 10.1524 3.79722 10.6628C3.28677 11.1733 3 11.8656 3 12.5875C3 13.3094 3.28677 14.0017 3.79722 14.5122C4.30767 15.0226 4.99999 15.3094 5.72187 15.3094ZM26.2375 9.86562C24.7344 9.86562 23.5156 11.0844 23.5156 12.5875V15.3094H26.2375C26.9594 15.3094 27.6517 15.0226 28.1622 14.5122C28.6726 14.0017 28.9594 13.3094 28.9594 12.5875C28.9594 11.8656 28.6726 11.1733 28.1622 10.6628C27.6517 10.1524 26.9594 9.86562 26.2375 9.86562ZM16.6906 5.72187V12.5875C16.6906 13.3094 16.9774 14.0017 17.4878 14.5122C17.9983 15.0226 18.6906 15.3094 19.4125 15.3094C20.1344 15.3094 20.8267 15.0226 21.3372 14.5122C21.8476 14.0017 22.1344 13.3094 22.1344 12.5875V5.72187C22.1344 4.99999 21.8476 4.30767 21.3372 3.79722C20.8267 3.28677 20.1344 3 19.4125 3C18.6906 3 17.9983 3.28677 17.4878 3.79722C16.9774 4.30767 16.6906 4.99999 16.6906 5.72187ZM22.1344 26.2781C22.1344 24.775 20.9156 23.5562 19.4125 23.5562H16.6906V26.2781C16.6906 27 16.9774 27.6923 17.4878 28.2028C17.9983 28.7132 18.6906 29 19.4125 29C20.1344 29 20.8267 28.7132 21.3372 28.2028C21.8476 27.6923 22.1344 27 22.1344 26.2781ZM26.2781 16.6906H19.4125C18.6906 16.6906 17.9983 16.9774 17.4878 17.4878C16.9774 17.9983 16.6906 18.6906 16.6906 19.4125C16.6906 20.1344 16.9774 20.8267 17.4878 21.3372C17.9983 21.8476 18.6906 22.1344 19.4125 22.1344H26.2375C27.7406 22.1344 28.9594 20.9156 28.9594 19.4125C29 17.9094 27.7812 16.6906 26.2781 16.6906Z" fill=currentColor /></g><defs><clipPath id=clip0_125_278><rect width=26 height=26 fill=currentColor transform="translate(3 3)"/></clipPath></defs></svg></a></div><div class=social><a href=https://www.youtube.com/hashtag/apachedoris title=youtube target=_blank class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><path d="M28.5167 7.83429C28.9436 8.25423 29.2532 8.77539 29.4154 9.34742C29.8205 11.5462 30.0159 13.7775 29.999 16.0121C30.0144 18.2382 29.819 20.4609 29.4154 22.6515C29.2532 23.2235 28.9436 23.7446 28.5167 24.1645C28.0898 24.5845 27.5601 24.889 26.9785 25.0486C24.7728 25.625 16.0124 25.625 16.0124 25.625C16.0124 25.625 7.22652 25.625 5.04638 25.0486C4.46489 24.889 3.9351 24.5845 3.5082 24.1645C3.08132 23.7446 2.77176 23.2235 2.60948 22.6515C2.19736 20.4617 1.9934 18.239 2.00025 16.0121C1.9918 13.7767 2.19577 11.5455 2.60948 9.34742C2.77176 8.77539 3.08132 8.25423 3.5082 7.83429C3.9351 7.41436 4.46489 7.10985 5.04638 6.95021C7.25103 6.36354 16.0124 6.37502 16.0124 6.37502C16.0124 6.37502 24.796 6.37502 26.9785 6.95021C27.5601 7.10985 28.0898 7.41436 28.5167 7.83429ZM12.5 21.25L21.25 16.008L12.5 10.75V21.25Z" fill=currentColor /></svg></a><a href=https://www.linkedin.com/company/doris-apache/ title=linkedin target=_blank class=item><svg width=2rem height=2rem viewBox="0 0 32 32" fill=none><path d="M4.29925 26.9996H9.66738V11.6781H4.29925V26.9996ZM22.1628 11.1949C19.9409 11.1949 18.7157 11.9388 17.3054 13.7407V11.6777H11.9459V26.9996H17.305V18.6738C17.305 16.9168 18.145 15.1982 20.1535 15.1982C22.162 15.1982 22.6559 16.9164 22.6559 18.632V27H28V18.2902C28 12.2386 24.3854 11.1949 22.1628 11.1949ZM6.99325 4C5.3395 4 4 5.21047 4 6.7046C4 8.19759 5.3395 9.40617 6.99325 9.40617C8.6455 9.40617 9.985 8.19722 9.985 6.7046C9.985 5.21047 8.6455 4 6.99325 4Z" fill=white /></svg></a><a href=https://medium.com/@ApacheDoris title=medium target=_blank class=item><svg width=2em height=2em viewBox="0 0 32 32" fill=none><g id=Frame><path id=Vector d="M17.7967 16.5385C17.8029 18.53 16.9746 20.4425 15.4937 21.8559C14.0128 23.2693 12.0004 24.0681 9.89836 24.0769C7.79633 24.0681 5.78391 23.2693 4.30302 21.8559C2.82212 20.4425 1.99383 18.53 2.00003 16.5385C1.99383 14.5469 2.82212 12.6344 4.30302 11.221C5.78391 9.80759 7.79633 9.00878 9.89836 9C12.0004 9.00878 14.0128 9.80759 15.4937 11.221C16.9746 12.6344 17.8029 14.5469 17.7967 16.5385ZM26.4533 16.5385C26.4533 20.4514 24.6917 23.6348 22.51 23.6348C20.3283 23.6348 18.555 20.4514 18.555 16.5385C18.555 12.6255 20.3283 9.44214 22.51 9.44214C24.6917 9.44214 26.4533 12.6255 26.4533 16.5385ZM30 16.5385C30 20.0424 29.3817 22.8942 28.6117 22.8942C27.8417 22.8942 27.2233 20.0424 27.2233 16.5385C27.2233 13.0345 27.8417 10.1827 28.6117 10.1827C29.3817 10.1827 30 13.0345 30 16.5385Z" fill=currentColor /></g></svg></a></div></div></div></div><div class=footer__copyright>Copyright © 2026 The Apache Software Foundation,Licensed under the <a href=https://www.apache.org/licenses/LICENSE-2.0 target=_blank>Apache License, Version 2.0</a>. Apache, Doris, Apache Doris, the Apache feather logo and the Apache Doris logo are trademarks of The Apache Software Foundation.</div></div></div></div>