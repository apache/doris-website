---
{
    "title": "LLM_AGG",
    "language": "en"
}
---

## Description

Aggregates a specific column using a large language model according to user-provided instructions.

## Syntax

`LLM_AGG([<resource_name>], <expr>, <instruction>)`

## Parameter Description

| Parameter         | Description                                             |
| ----------------- | ------------------------------------------------------- |
| `<resource_name>` | The specified resource name, optional.                  |
| `<expr>`          | The text column to aggregate.                           |
| `<instruction>`   | The instruction to execute, only accepts literals.      |

## Return Value

Returns a string containing the aggregation result.

If all input values are NULL, returns NULL.

The result is generated by the language model, so the output is not fixed.

## Example

The following table simulates customer support tickets:
```sql
CREATE TABLE support_tickets (
    ticket_id      BIGINT,
    customer_name  VARCHAR(100),
    subject        VARCHAR(200),
    details        TEXT
)
DUPLICATE KEY(ticket_id)
DISTRIBUTED BY HASH(ticket_id) BUCKETS 5
PROPERTIES (
    "replication_num" = "1"
);

INSERT INTO support_tickets VALUES
(1, 'Alice', 'Login Failure', 'Cannot log in after password reset. Tried clearing cache and different browsers.'),
(2, 'Bob', 'Login Failure', 'Same problem as Alice. Also seeing 502 errors on the SSO page.'),
(3, 'Carol', 'Payment Declined', 'Credit card charged twice but order still shows pending.'),
(4, 'Dave', 'Slow Dashboard', 'Dashboard takes >30 seconds to load since the last release.'),
(5, 'Eve', 'Login Failure', 'Getting redirected back to login after entering 2FA code.');
```

You can use `LLM_AGG` to summarize customer issues by problem subject:
```sql
SELECT
    subject,
    LLM_AGG(
        details,
        'Summarize every ticket detail into one short paragraph of 40 words or less.'
    ) AS ai_summary
FROM support_tickets
GROUP BY subject;
```

```text
+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| subject          | ai_summary                                                                                                                                                                                                |
+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Slow Dashboard   | The dashboard loading time has significantly increased to over 30 seconds following the latest release, indicating a potential issue with the recent update.                                              |
| Login Failure    | User experiences login issues, including redirection post-2FA, inability to log in after password reset despite using different browsers and clearing cache, and encountering 502 errors on the SSO page. |
| Payment Declined | The customer's credit card was charged twice, but the order status remains pending, indicating a potential issue with the transaction processing or system update.                                        |
+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
```