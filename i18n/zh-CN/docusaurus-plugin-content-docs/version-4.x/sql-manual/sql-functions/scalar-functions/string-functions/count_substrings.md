---
{
    "title": "COUNT_SUBSTRINGS",
    "language": "zh-CN",
    "description": "COUNTSUBSTRINGS 函数用于计算一个字符串中指定子串出现的次数。注意：当前实现在每次匹配到子串时，会偏移一个子串长度继续查找。例如，当 str='ccc' 且 pattern='cc' 时，返回结果为 1。"
}
---

## 描述

COUNT_SUBSTRINGS 函数用于计算一个字符串中指定子串出现的次数。注意：当前实现在每次匹配到子串时，会偏移一个子串长度继续查找。例如，当 str='ccc' 且 pattern='cc' 时，返回结果为 1。

## 语法

```sql
COUNT_SUBSTRINGS(<str>, <pattern>[, <start_pos>])
```

## 参数
| 参数          | 说明                                               |
| ------------- | -------------------------------------------------- |
| `<str>`       | 需要检测的字符串。类型：STRING                     |
| `<pattern>`   | 需要匹配的子串。类型：STRING                       |
| `<start_pos>` | 开始搜索的位置（从1开始计数）。类型：INT。可选参数 |

## 返回值

返回 INT 类型，表示子串在字符串中出现的次数。

特殊情况：
- 如果 str 为 NULL，返回 NULL
- 如果 pattern 为空字符串，返回 0
- 如果 str 为空字符串，返回 0
- 如果 start_pos 小于等于0或超出字符串长度范围，返回 0

## 示例

1. 基本用法
```sql
SELECT count_substrings('a1b1c1d', '1');
```
```text
+----------------------------------+
| count_substrings('a1b1c1d', '1') |
+----------------------------------+
|                                3 |
+----------------------------------+
```

2. 连续逗号的情况
```sql
SELECT count_substrings(',,a,b,c,', ',');
```
```text
+-----------------------------------+
| count_substrings(',,a,b,c,', ',') |
+-----------------------------------+
|                                 5 |
+-----------------------------------+
```

3. 重叠子串的情况
```sql
SELECT count_substrings('ccc', 'cc');
```
```text
+--------------------------------+
| count_substrings('ccc', 'cc')  |
+--------------------------------+
|                              1 |
+--------------------------------+
```

4. NULL 值处理
```sql
SELECT count_substrings(NULL, ',');
```
```text
+-----------------------------+
| count_substrings(NULL, ',') |
+-----------------------------+
|                        NULL |
+-----------------------------+
```

5. 空字符串处理
```sql
SELECT count_substrings('a,b,c,abcde', '');
```
```text
+-------------------------------------+
| count_substrings('a,b,c,abcde', '') |
+-------------------------------------+
|                                   0 |
+-------------------------------------+
```

6. 使用起始位置参数
```sql
SELECT count_substrings('ṭṛì ḍḍumai ṭṛì ti ḍḍumannàri', 'ḍḍu', 1), 
       count_substrings('ṭṛì ḍḍumai ṭṛì ti ḍḍumannàri', 'ḍḍu', 6);
```
```text
+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
| count_substrings('ṭṛì ḍḍumai ṭṛì ti ḍḍumannàri', 'ḍḍu', 1)                        | count_substrings('ṭṛì ḍḍumai ṭṛì ti ḍḍumannàri', 'ḍḍu', 6)                        |
+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
|                                                                                 2 |                                                                                 1 |
+-----------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+
```

7. 起始位置超出范围
```sql
SELECT count_substrings('éèêëìíîïðñòó éèêëìíîïðñòó', 'éèê', 0), 
       count_substrings('éèêëìíîïðñòó éèêëìíîïðñòó', 'éèê', 30);
```
```text
+------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+
| count_substrings('éèêëìíîïðñòó éèêëìíîïðñòó', 'éèê', 0)                            | count_substrings('éèêëìíîïðñòó éèêëìíîïðñòó', 'éèê', 30)                            |
+------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+
|                                                                                  0 |                                                                                   0 |
+------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+
```
