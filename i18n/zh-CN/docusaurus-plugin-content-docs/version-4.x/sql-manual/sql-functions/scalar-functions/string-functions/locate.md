---
{
    "title": "LOCATE",
    "language": "zh-CN",
    "description": "LOCATE 函数返回子字符串 substr 在字符串 str 中第一次出现的位置（从 1 开始计数）。如果指定了可选的第三个参数 pos，则从字符串 str 的指定位置开始搜索。该函数是 MySQL 兼容函数，常用于字符串匹配和位置查找。"
}
---

## 描述

LOCATE 函数返回子字符串 substr 在字符串 str 中第一次出现的位置（从 1 开始计数）。如果指定了可选的第三个参数 pos，则从字符串 str 的指定位置开始搜索。该函数是 MySQL 兼容函数，常用于字符串匹配和位置查找。

## 语法

```sql
LOCATE(<substr>, <str> [, <pos>])
```

## 参数

| 参数       | 说明              |
|----------|-----------------|
| `<substr>` | 需要查找的目标子字符串。类型：VARCHAR |
| `<str>`    | 需要被搜索的源字符串。类型：VARCHAR |
| `<pos>`    | 可选参数，搜索的起始位置（从 1 开始计数）。类型：INT |

## 返回值

返回 INT 类型，表示 substr 在 str 中第一次出现的位置（从 1 开始计数）。

查找规则：
- 位置从 1 开始计数（不是从 0）
- 返回第一次匹配的位置
- 如果指定了 pos，则从该位置开始搜索，但返回的位置仍然是相对于字符串开头的绝对位置
- 搜索是大小写敏感的

特殊情况：
- 如果没有找到匹配项，返回 0
- 如果任意参数为 NULL，返回 NULL
- 如果 substr 为空字符串，返回 1（或 pos 的值，如果指定了 pos 且 pos > 1）
- 如果 str 为空字符串而 substr 不为空，返回 0
- 如果 pos 小于 1，返回 0
- 如果 pos 大于 str 的长度，返回 0

## 示例

1. 基本查找
```sql
SELECT LOCATE('bar', 'foobarbar'), LOCATE('xbar', 'foobar'), LOCATE('bar', 'foobarbar', 5);
```
```text
+----------------------------+--------------------------+-------------------------------+
| LOCATE('bar', 'foobarbar') | LOCATE('xbar', 'foobar') | LOCATE('bar', 'foobarbar', 5) |
+----------------------------+--------------------------+-------------------------------+
|                          4 |                        0 |                             7 |
+----------------------------+--------------------------+-------------------------------+
```

2. 查找第一个字符
```sql
SELECT LOCATE('f', 'foobar'), LOCATE('r', 'foobar');
```
```text
+-----------------------+-----------------------+
| LOCATE('f', 'foobar') | LOCATE('r', 'foobar') |
+-----------------------+-----------------------+
|                     1 |                     6 |
+-----------------------+-----------------------+
```

3. 未找到匹配项
```sql
SELECT LOCATE('xyz', 'foobar'), LOCATE('FOO', 'foobar');
```
```text
+-------------------------+-------------------------+
| LOCATE('xyz', 'foobar') | LOCATE('FOO', 'foobar') |
+-------------------------+-------------------------+
|                       0 |                       0 |
+-------------------------+-------------------------+
```

4. NULL 值处理
```sql
SELECT LOCATE(NULL, 'foobar'), LOCATE('foo', NULL), LOCATE(NULL, NULL);
```
```text
+------------------------+----------------------+---------------------+
| LOCATE(NULL, 'foobar') | LOCATE('foo', NULL)  | LOCATE(NULL, NULL)  |
+------------------------+----------------------+---------------------+
|                   NULL |                 NULL |                NULL |
+------------------------+----------------------+---------------------+
```

5. 空字符串处理
```sql
SELECT LOCATE('', 'foobar'), LOCATE('foo', ''), LOCATE('', '');
```
```text
+----------------------+-------------------+----------------+
| LOCATE('', 'foobar') | LOCATE('foo', '') | LOCATE('', '') |
+----------------------+-------------------+----------------+
|                    1 |                 0 |              1 |
+----------------------+-------------------+----------------+
```

6. 指定起始位置
```sql
SELECT LOCATE('o', 'foobar', 1), LOCATE('o', 'foobar', 2), LOCATE('o', 'foobar', 4);
```
```text
+--------------------------+--------------------------+--------------------------+
| LOCATE('o', 'foobar', 1) | LOCATE('o', 'foobar', 2) | LOCATE('o', 'foobar', 4) |
+--------------------------+--------------------------+--------------------------+
|                        2 |                        3 |                        0 |
+--------------------------+--------------------------+--------------------------+
```

7. 边界位置参数
```sql
SELECT LOCATE('foo', 'foobar', 0), LOCATE('foo', 'foobar', -1), LOCATE('foo', 'foobar', 10);
```
```text
+----------------------------+-----------------------------+-----------------------------+
| LOCATE('foo', 'foobar', 0) | LOCATE('foo', 'foobar', -1) | LOCATE('foo', 'foobar', 10) |
+----------------------------+-----------------------------+-----------------------------+
|                          0 |                           0 |                           0 |
+----------------------------+-----------------------------+-----------------------------+
```

8. UTF-8 字符查找
```sql
SELECT LOCATE('ṛì', 'ṭṛì ḍḍumai'), LOCATE('ḍḍu', 'ṭṛì ḍḍumai');
```
```text
+---------------------------+-----------------------------+
| LOCATE('ṛì', 'ṭṛì ḍḍumai') | LOCATE('ḍḍu', 'ṭṛì ḍḍumai') |
+---------------------------+-----------------------------+
|                         2 |                           5 |
+---------------------------+-----------------------------+
```

9. 大小写敏感性
```sql
SELECT LOCATE('BAR', 'foobar'), LOCATE('Bar', 'foobar'), LOCATE('bar', 'fooBAR');
```
```text
+-------------------------+-------------------------+-------------------------+
| LOCATE('BAR', 'foobar') | LOCATE('Bar', 'foobar') | LOCATE('bar', 'fooBAR') |
+-------------------------+-------------------------+-------------------------+
|                       0 |                       0 |                       0 |
+-------------------------+-------------------------+-------------------------+
```

10. 空字符串与位置参数
```sql
SELECT LOCATE('', 'foobar', 3), LOCATE('', 'foobar', 7), LOCATE('', '', 1);
```
```text
+-------------------------+-------------------------+---------------------+
| LOCATE('', 'foobar', 3) | LOCATE('', 'foobar', 7) | LOCATE('', '', 1)   |
+-------------------------+-------------------------+---------------------+
|                       3 |                       0 |                   1 |
+-------------------------+-------------------------+---------------------+
```