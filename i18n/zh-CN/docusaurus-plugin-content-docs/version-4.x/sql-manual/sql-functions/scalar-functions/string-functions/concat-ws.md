---
{
    "title": "CONCAT_WS",
    "language": "zh-CN",
    "description": "CONCATWS 函数（Concatenate With Separator）用于使用指定的分隔符连接多个字符串或数组。与 CONCAT 函数不同，CONCATWS 会自动跳过 NULL 值（但不跳过空字符串），并在非 NULL 值之间插入分隔符。该函数支持字符串参数和数组参数两种模式，"
}
---

## 描述

CONCAT_WS 函数（Concatenate With Separator）用于使用指定的分隔符连接多个字符串或数组。与 CONCAT 函数不同，CONCAT_WS 会自动跳过 NULL 值（但不跳过空字符串），并在非 NULL 值之间插入分隔符。该函数支持字符串参数和数组参数两种模式，在生成 CSV 格式、路径拼接、标签列表等场景中非常有用。

## 语法

```sql
-- 字符串模式
CONCAT_WS(<sep>, <str> [, <str> ...])

-- 数组模式  
CONCAT_WS(<sep>, <array> [, <array> ...])
```

## 参数

| 参数    | 说明              |
|-------|-----------------|
| `<sep>` | 分隔符字符串，用于连接各个部分。类型：VARCHAR |
| `<str>` | 待连接的字符串参数。类型：VARCHAR |
| `<array>` | 待连接的数组参数，数组元素必须为字符串类型。类型：ARRAY&lt;VARCHAR&gt; |

## 返回值

返回 VARCHAR 类型，表示使用分隔符连接后的字符串。

连接规则：
- 使用第一个参数作为分隔符连接后续参数
- 自动跳过 NULL 值，但保留空字符串
- 支持字符串参数或数组参数，但不能混合使用
- 支持 UTF-8 多字节字符作为分隔符和内容

特殊情况：
- 如果分隔符为 NULL，返回 NULL
- 如果所有待连接的参数都是 NULL，返回空字符串
- 数组模式中，跳过数组中的 NULL 元素，但保留空字符串元素
- 多个数组参数中包含 NULL 数组时，返回空字符串
- 不允许字符串参数和数组参数混合使用
## 示例

1. 基本字符串连接
```sql
SELECT CONCAT_WS(',', 'apple', 'banana', 'orange'), CONCAT_WS('-', 'hello', 'world');
```
```text
+-------------------------------------------+----------------------------------+
| CONCAT_WS(',', 'apple', 'banana', 'orange') | CONCAT_WS('-', 'hello', 'world') |
+-------------------------------------------+----------------------------------+
| apple,banana,orange                       | hello-world                      |
+-------------------------------------------+----------------------------------+
```

2. NULL 分隔符处理
```sql
SELECT CONCAT_WS(NULL, 'd', 'is'), CONCAT_WS('or', 'd', NULL, 'is');
```
```text
+----------------------------+----------------------------------+
| CONCAT_WS(NULL, 'd', 'is') | CONCAT_WS('or', 'd', NULL, 'is') |
+----------------------------+----------------------------------+
| NULL                       | doris                            |
+----------------------------+----------------------------------+
```

3. 空字符串处理（保留空字符串）
```sql
SELECT CONCAT_WS('|', 'hello', '', 'world', NULL), CONCAT_WS(',', '', 'test', '');
```
```text
+--------------------------------------------+-------------------------------+
| CONCAT_WS('|', 'hello', '', 'world', NULL) | CONCAT_WS(',', '', 'test', '') |
+--------------------------------------------+-------------------------------+
| hello||world                               | ,test,                        |
+--------------------------------------------+-------------------------------+
```

4. 全部为 NULL 的情况
```sql
SELECT CONCAT_WS('x', NULL, NULL), CONCAT_WS('-', NULL, NULL, NULL);
```
```text
+----------------------------+---------------------------------+
| CONCAT_WS('x', NULL, NULL) | CONCAT_WS('-', NULL, NULL, NULL) |
+----------------------------+---------------------------------+
|                            |                                 |
+----------------------------+---------------------------------+
```

5. 数组模式基本用法
```sql
SELECT CONCAT_WS('or', ['d', 'is']), CONCAT_WS('-', ['apple', 'banana', 'cherry']);
```
```text
+------------------------------+--------------------------------------------+
| CONCAT_WS('or', ['d', 'is']) | CONCAT_WS('-', ['apple', 'banana', 'cherry']) |
+------------------------------+--------------------------------------------+
| doris                        | apple-banana-cherry                        |
+------------------------------+--------------------------------------------+
```

6. 数组中的 NULL 值处理
```sql
SELECT CONCAT_WS('or', ['d', NULL, 'is']), CONCAT_WS(',', [NULL, 'a', 'b', NULL, 'c']);
```
```text
+------------------------------------+------------------------------------------+
| CONCAT_WS('or', ['d', NULL, 'is']) | CONCAT_WS(',', [NULL, 'a', 'b', NULL, 'c']) |
+------------------------------------+------------------------------------------+
| doris                              | a,b,c                                    |
+------------------------------------+------------------------------------------+
```

7. 多个数组连接
```sql
SELECT CONCAT_WS('-', ['a', 'b'], ['c', NULL], ['d']), CONCAT_WS('|', ['x'], ['y', 'z']);
```
```text
+------------------------------------------------+----------------------------------+
| CONCAT_WS('-', ['a', 'b'], ['c', NULL], ['d']) | CONCAT_WS('|', ['x'], ['y', 'z']) |
+------------------------------------------------+----------------------------------+
| a-b-c-d                                        | x|y|z                            |
+------------------------------------------------+----------------------------------+
```

8. 多个数组中包含 NULL 数组
```sql
SELECT CONCAT_WS('-', ['a', 'b'], NULL, ['c', NULL], ['d']);
```
```text
+-----------------------------------------------------+
| CONCAT_WS('-', ['a', 'b'], NULL, ['c', NULL], ['d']) |
+-----------------------------------------------------+
|                                                     |
+-----------------------------------------------------+
```

9. UTF-8 多字节字符处理
```sql
SELECT CONCAT_WS('x', 'ṭṛì', 'ḍḍumai'), CONCAT_WS('→', ['ṭṛì', 'ḍḍumai', 'hello']);
```
```text
+-------------------------------+----------------------------------------------+
| CONCAT_WS('x', 'ṭṛì', 'ḍḍumai') | CONCAT_WS('→', ['ṭṛì', 'ḍḍumai', 'hello']) |
+-------------------------------+----------------------------------------------+
| ṭṛìxḍḍumai                    | ṭṛì→ḍḍumai→hello                          |
+-------------------------------+----------------------------------------------+
```

10. CSV 格式生成和路径拼接
```sql
SELECT CONCAT_WS(',', 'Name', 'Age', 'City'), CONCAT_WS('/', 'home', 'user', 'documents', 'file.txt');
```
```text
+------------------------------------+--------------------------------------------------------+
| CONCAT_WS(',', 'Name', 'Age', 'City') | CONCAT_WS('/', 'home', 'user', 'documents', 'file.txt') |
+------------------------------------+--------------------------------------------------------+
| Name,Age,City                      | home/user/documents/file.txt                          |
+------------------------------------+--------------------------------------------------------+
```