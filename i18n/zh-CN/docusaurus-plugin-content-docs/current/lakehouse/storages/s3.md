---
{
  "title": "S3",
  "language": "zh-CN"
}
---

æœ¬æ–‡æ¡£ç”¨äºä»‹ç»è®¿é—® AWS S3 æ—¶æ‰€éœ€çš„å‚æ•°ã€‚è¿™äº›å‚æ•°é€‚ç”¨äºï¼š

- Catalog å±æ€§ã€‚
- Table Valued Function å±æ€§ã€‚
- Broker Load å±æ€§ã€‚
- Export å±æ€§ã€‚
- Outfile å±æ€§ã€‚

## å‚æ•°æ€»è§ˆ

| å±æ€§åç§°                            | æ›¾ç”¨å | æè¿°                                       | é»˜è®¤å€¼     | æ˜¯å¦å¿…é¡» |
|---------------------------------|-----|------------------------------------------|---------|------|
| `s3.endpoint`                   |     | S3 æœåŠ¡è®¿é—®åœ°å€ï¼Œå¦‚ `s3.us-east-1.amazonaws.com` | æ—        | âœ… æ˜¯  |
| `s3.access_key`                 |     | AWS Access Keyã€‚ç”¨äºèº«ä»½éªŒè¯                    | æ—        | âœ… æ˜¯  |
| `s3.secret_key`                 |     | AWS Secret Keyã€‚ç”¨äºèº«ä»½éªŒè¯                    | æ—        | âœ… æ˜¯  |
| `s3.region`                     |     | S3 æ‰€åœ¨çš„åŒºåŸŸï¼Œä¾‹å¦‚ï¼š`us-east-1`ã€‚å¼ºçƒˆå»ºè®®é…ç½®           | æ—        | å¦    |
| `s3.use_path_style`             |     | æ˜¯å¦ä½¿ç”¨ path-styleï¼ˆè·¯å¾„é£æ ¼ï¼‰è®¿é—®ã€‚                 | `false` | å¦    |
| `s3.connection.maximum`         |     | æœ€å¤§è¿æ¥æ•°ï¼Œé€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯                           | `50`    | å¦    |
| `s3.connection.request.timeout` |     | è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œæ§åˆ¶è¿æ¥è·å–è¶…æ—¶                      | `3000`  | å¦    |
| `s3.connection.timeout`         |     | å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰                            | `1000`  | å¦    |
| `s3.role_arn`                   |     | ä½¿ç”¨ Assume Role æ¨¡å¼æ—¶æŒ‡å®šçš„è§’è‰² ARN              | æ—        | å¦    |
| `s3.external_id`                |     | é…åˆ `s3.role_arn` ä½¿ç”¨çš„ external ID         | æ—        | å¦    |

---

## 1. è®¤è¯é…ç½®ï¼ˆå¿…å¡«ï¼‰

Doris æ”¯æŒä»¥ä¸‹ä¸¤ç§æ–¹å¼è®¿é—® S3ï¼š

---

### 1.1 æ–¹å¼ä¸€ï¼šAccess Key + Secret Keyï¼ˆæ¨èï¼‰

é€‚ç”¨äº AWS S3 æˆ–å…¼å®¹å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ MinIOã€Ceph ç­‰ï¼‰ï¼š

```properties
"s3.access_key"="your-access-key"
"s3.secret_key"="your-secret-key"
"s3.endpoint"="s3.us-east-1.amazonaws.com"
"s3.region"="us-east-1"
```

> å¦‚ä½¿ç”¨ MinIO ç­‰å…¼å®¹æœåŠ¡ï¼Œå»ºè®®åŠ ä¸Šï¼š
> ```properties
> "s3.use_path_style" = "true"
> ```

---

### 1.2 æ–¹å¼äºŒï¼šAssume Role æ¨¡å¼ï¼ˆå¯é€‰ï¼‰

é€‚ç”¨äºè·¨è´¦å·ã€ä¸´æ—¶æˆæƒè®¿é—®ã€‚é€šè¿‡è§’è‰²æˆæƒè‡ªåŠ¨è·å–ä¸´æ—¶å‡­è¯ã€‚

#### å‚æ•°è¯´æ˜ï¼š

| å‚æ•°               | è¯´æ˜                                                                   |
|------------------|----------------------------------------------------------------------|
| `s3.role_arn`    | æŒ‡å®šå¯æ‰®æ¼”çš„ AWS IAM è§’è‰²çš„ ARNï¼Œä¾‹å¦‚ï¼š`arn:aws:iam::123456789012:role/demo-role` |
| `s3.external_id` | å¯é€‰çš„å¤–éƒ¨ IDï¼Œç”¨äºç¬¬ä¸‰æ–¹è®¿é—®å®‰å…¨æ§åˆ¶                                                 |

#### ç¤ºä¾‹ï¼š

```properties
"s3.role_arn"="arn:aws:iam::123456789012:role/demo-role"
"s3.external_id"="external-identifier"
"s3.endpoint"="s3.us-east-1.amazonaws.com"
"s3.region"="us-east-1"
```

> å¦‚æœåŒæ—¶è®¾ç½®äº† Access Key å’Œ Role ARNï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ Access Key æ¨¡å¼ã€‚


---

## 2. ç½‘ç»œè¿æ¥å‚æ•°ï¼ˆå¯é€‰ï¼‰

ç”¨äºæå‡å¹¶å‘æ€§èƒ½ã€é¿å…è¿æ¥é˜»å¡ã€‚

| å‚æ•°                              | è¯´æ˜             | é»˜è®¤å€¼    |
|---------------------------------|----------------|--------|
| `s3.connection.maximum`         | æœ€å¤§è¿æ¥æ•°          | `50`   |
| `s3.connection.request.timeout` | è¯·æ±‚ç­‰å¾…è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ | `3000` |
| `s3.connection.timeout`         | å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰  | `1000` |

---

## 3. ä½¿ç”¨ Path-style è®¿é—®ï¼ˆå…¼å®¹æ€§é€‰é¡¹ï¼‰

éƒ¨åˆ†å…¼å®¹ S3 çš„å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ MinIOï¼‰ä¸æ”¯æŒé»˜è®¤çš„ host-style è®¿é—®æ–¹å¼ï¼Œéœ€å¯ç”¨ï¼š

```properties
"s3.use_path_style"="true"
```

- **Host-style è®¿é—®**ï¼ˆé»˜è®¤ï¼‰: `https://bucket.s3.amazonaws.com`
- **Path-style è®¿é—®**ï¼ˆå¼€å¯åï¼‰: `https://s3.amazonaws.com/bucket`

---

## 4. Directory Bucket é…ç½®ï¼ˆS3 Express One Zoneï¼‰

> ğŸ“Œ è¯¥åŠŸèƒ½è‡ª **3.1.0** èµ·æ”¯æŒã€‚

Amazon S3 Express One Zoneï¼ˆåˆå Directory Bucketï¼‰æä¾›æ›´é«˜æ€§èƒ½ï¼Œä½† endpoint æ ¼å¼ä¸åŒã€‚

### 4.1 endpoint åŒºåˆ«

| ç±»å‹               | ç¤ºä¾‹ endpoint                                  |
|------------------|----------------------------------------------|
| æ™®é€š bucket        | `s3.us-east-1.amazonaws.com`                 |
| Directory Bucket | `s3express-usw2-az1.us-west-2.amazonaws.com` |

æ›´å¤šå¯ç”¨åŒºåŸŸå‚è€ƒï¼š[AWS å®˜æ–¹æ–‡æ¡£](https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-express-Regions-and-Zones.html)

### 4.2 ç¤ºä¾‹é…ç½®

```properties
"s3.access_key"="ak"
"s3.secret_key"="sk"
"s3.endpoint"="s3express-usw2-az1.us-west-2.amazonaws.com"
"s3.region"="us-west-2"
```
