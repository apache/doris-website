---
{
    "title": "REGEXP_POSITION",
    "language": "zh-CN"
}
---

## 描述

REGEXP_POSITION函数可以返回字符串中模式（pattern）首次出现的索引，从起始位置（start）开始搜索（包含起始位置）。若未找到，则返回 -1。

## 语法

```sql
REGEXP_POSITION ( <str>, <pattern> [, <position>] )
```

## 参数

| 参数      | 描述                           |
|---------|------------------------------|
| `<str>` | 该参数为 Varchar 类型。它表示将执行正则表达式匹配的字符串，既可以是字面量字符串，也可以是表中包含字符串值的列                     |
| `<pattern>` | 该参数为 Varchar 类型。它是用于匹配字符串的正则表达式模式，该模式可包含各种正则表达式元字符和构造，用于定义复杂的匹配规则   |
| `<position>` | 可选参数。此参数用于指定在字符串中开始搜索正则表达式匹配的位置，它是一个整数，代表字符串中的字符位置（从 1 开始计数），默认值为 1 |

## 返回值

返回字符串中模式（pattern）首次出现的索引，从起始位置（start）开始搜索（包含起始位置）。特殊情况如下：

- 若任一参数为 NULL，则返回 NULL
- 若起始位置（position）小于 1，则返回 -1

## 示例

普通例子
```sql
SELECT regexp_position('I have 23 apples, 5 pears and 13 oranges', ' ', 0);
```
```text
+---------------------------------------------------------------------+
| regexp_position('I have 23 apples, 5 pears and 13 oranges', ' ', 0) |
+---------------------------------------------------------------------+
|                                                                  -1 |
+---------------------------------------------------------------------+
```

```sql
SELECT regexp_position('I have 23 apples, 5 pears and 13 oranges', ' ', 1);
```
```text
+---------------------------------------------------------------------+
| regexp_position('I have 23 apples, 5 pears and 13 oranges', ' ', 1) |
+---------------------------------------------------------------------+
|                                                                  2 |
+---------------------------------------------------------------------+
```

```sql
SELECT regexp_position('I have 23 apples, 5 pears and 13 oranges', ' ', 4);
```
```text
+---------------------------------------------------------------------+
| regexp_position('I have 23 apples, 5 pears and 13 oranges', ' ', 4) |
+---------------------------------------------------------------------+
|                                                                  7 |
+---------------------------------------------------------------------+
```

正则表达式例子
```sql
SELECT regexp_position('I have 23 apples, 5 pears and 13 oranges', '\\d', 0);
```
```text
+-----------------------------------------------------------------------+
| regexp_position('I have 23 apples, 5 pears and 13 oranges', '\\d', 0) |
+-----------------------------------------------------------------------+
|                                                                    -1 |
+-----------------------------------------------------------------------+
```

```sql
SELECT regexp_position('I have 23 apples, 5 pears and 13 oranges', '\\d', 9);
```
```text
+-----------------------------------------------------------------------+
| regexp_position('I have 23 apples, 5 pears and 13 oranges', '\\d', 9) |
+-----------------------------------------------------------------------+
|                                                                     9 |
+-----------------------------------------------------------------------+
```

中文例子
```sql
SELECT regexp_position('我爱北京天安门', '爱', 1);
```
```text
+----------------------------------------------------+
| regexp_position('我爱北京天安门', '爱', 1)         |
+----------------------------------------------------+
|                                                 4 |
+----------------------------------------------------+
```

涉及到Null的例子
```sql
SELECT regexp_position(null, ' ', 0);
```
```text
+-------------------------------+
| regexp_position(null, ' ', 0) |
+-------------------------------+
|                          NULL |
+-------------------------------+
```

```sql
SELECT regexp_position('abc', null, 0);
```
```text
+---------------------------------+
| regexp_position('abc', null, 0) |
+---------------------------------+
|                            NULL |
+---------------------------------+
```

```sql
SELECT regexp_position(null, null, 0);
```
```text
+--------------------------------+
| regexp_position(null, null, 0) |
+--------------------------------+
|                           NULL |
+--------------------------------+
```

```sql
SELECT regexp_position('abc', 'b', null);
```
```text
+-----------------------------------+
| regexp_position('abc', 'b', null) |
+-----------------------------------+
|                              NULL |
+-----------------------------------+
```

emoji表情包例子
```sql
SELECT regexp_position('😀😊😎', '😀|😊|😎', 0);
```
```text
+------------------------------------------------------+
| regexp_position('😀😊😎', '😀|😊|😎', 0)                         |
+------------------------------------------------------+
|                                                   -1 |
+------------------------------------------------------+
```
```sql
SELECT regexp_position('😀😊😎', '😀|😊|😎', 1);
```
```text
+------------------------------------------------------+
| regexp_position('😀😊😎', '😀|😊|😎', 1)                         |
+------------------------------------------------------+
|                                                   1 |
+------------------------------------------------------+
```
```sql
SELECT regexp_position('😀😊😎', '😀|😊|😎', 2);
```
```text
+------------------------------------------------------+
| regexp_position('😀😊😎', '😀|😊|😎', 2)                         |
+------------------------------------------------------+
|                                                   5 |
+------------------------------------------------------+
```

表中数据的例子
```sql
CREATE TABLE test_regexp_position (
            str varchar(100),                      
            pattern varchar(100),             
            position int,
            num int  -- this colum used to order
        )
        DISTRIBUTED BY HASH(str)
        PROPERTIES (
            "replication_num" = "1"
        );
        
 INSERT INTO test_regexp_position VALUES 
 ('I have 23 apples, 5 pears and 13 oranges', '\\d', 15, 1),
 ('I have 23 apples, 5 pears and 13 oranges', ' ', 3, 2),
 ('I have 23 apples, 5 pears and 13 oranges', '\\b\\d+\\b', 10, 3),
 ('I have 23 apples, 5 pears and 13 oranges', '5', 0, 4),
 ('I have 23 apples, 5 pears and 13 oranges', '5', 25, 5),
 ('我爱北京天安门', '爱', 3, 6),
 ('123AbCdExCx', '([[:lower:]]+)C([[:lower:]]+)', 5, 7),
 (null, null, null, 8),
 ('😀😊😎', '😀|😊|😎', 2, 9);
 
 select regexp_position(str, pattern, position) from test_regexp_position order by num;
```
```text
+------------------------------------------+-------------------------------+----------+-----------------------------------------+
| str                                      | pattern                       | position | regexp_position(str, pattern, position) |
+------------------------------------------+-------------------------------+----------+-----------------------------------------+
| I have 23 apples, 5 pears and 13 oranges | \d                            |       15 |                                      19 |
| I have 23 apples, 5 pears and 13 oranges |                               |        3 |                                       7 |
| I have 23 apples, 5 pears and 13 oranges | \b\d+\b                       |       10 |                                      19 |
| I have 23 apples, 5 pears and 13 oranges | 5                             |        0 |                                      -1 |
| I have 23 apples, 5 pears and 13 oranges | 5                             |       25 |                                      -1 |
| 我爱北京天安门                           | 爱                            |        3 |                                       4 |
| 123AbCdExCx                              | ([[:lower:]]+)C([[:lower:]]+) |        5 |                                       5 |
| NULL                                     | NULL                          |     NULL |                                    NULL |
| 😀😊😎                                         | 😀|😊|😎                            |        2 |                                       5 |
+------------------------------------------+-------------------------------+----------+-----------------------------------------+
```

