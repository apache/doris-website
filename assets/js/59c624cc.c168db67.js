"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["375028"],{219473:function(e,n,r){r.r(n),r.d(n,{default:()=>u,frontMatter:()=>t,metadata:()=>a,assets:()=>c,toc:()=>o,contentTitle:()=>i});var a=JSON.parse('{"id":"sql-manual/sql-functions/scalar-functions/array-functions/array-avg","title":"ARRAY_AVG","description":"array_avg","source":"@site/docs/sql-manual/sql-functions/scalar-functions/array-functions/array-avg.md","sourceDirName":"sql-manual/sql-functions/scalar-functions/array-functions","slug":"/sql-manual/sql-functions/scalar-functions/array-functions/array-avg","permalink":"/docs/dev/sql-manual/sql-functions/scalar-functions/array-functions/array-avg","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"ARRAY_AVG","language":"en"},"sidebar":"docs","previous":{"title":"ARRAY_APPLY","permalink":"/docs/dev/sql-manual/sql-functions/scalar-functions/array-functions/array-apply"},"next":{"title":"ARRAY_COMPACT","permalink":"/docs/dev/sql-manual/sql-functions/scalar-functions/array-functions/array-compact"}}'),l=r("785893"),s=r("250065");let t={title:"ARRAY_AVG",language:"en"},i=void 0,c={},o=[{value:"array_avg",id:"array_avg",level:2},{value:"Description",id:"description",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Return Value",id:"return-value",level:3},{value:"Examples",id:"examples",level:3},{value:"Keywords",id:"keywords",level:3}];function d(e){let n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",t:"t",ul:"ul",version:"version",...(0,s.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"array_avg",children:"array_avg"}),"\n",(0,l.jsx)(n.version,{since:"2.0.0",children:"\n"}),"\n",(0,l.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,l.jsx)(n.p,{children:"Calculates the average of all numeric elements in an array. The function skips null values and non-numeric elements in the array, only calculating the average for valid numeric elements."}),"\n",(0,l.jsx)(n.h2,{id:"syntax",children:"Syntax"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"array_avg(ARRAY<T> arr)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"arr"}),"\uFF1AARRAY",(0,l.jsx)(n.t,{children:" type, the array for which to calculate the average. Supports column names or constant values."})]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Supported types for T:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Numeric types: TINYINT, SMALLINT, INT, BIGINT, LARGEINT, FLOAT, DOUBLE, DECIMAL"}),"\n",(0,l.jsx)(n.li,{children:"String types: CHAR, VARCHAR, STRING (will attempt to convert to numeric)"}),"\n",(0,l.jsx)(n.li,{children:"Boolean type: BOOLEAN (will attempt to convert to numeric)"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"return-value",children:"Return Value"}),"\n",(0,l.jsx)(n.p,{children:"Return type: Automatically selected based on input type"}),"\n",(0,l.jsx)(n.p,{children:"Return value meaning:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Returns the average of all valid numeric elements in the array"}),"\n",(0,l.jsx)(n.li,{children:"NULL: if the array is empty, or all elements are NULL or cannot be converted to numeric"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Usage notes:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"If the array contains other types (such as strings), it will attempt to convert elements to DOUBLE type. Elements that fail conversion will be skipped and not included in the average calculation"}),"\n",(0,l.jsxs)(n.li,{children:["The function will attempt to convert all elements to compatible numeric types for average calculation. The return type of the average is automatically selected based on the input type:\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"When input is DOUBLE or FLOAT, returns DOUBLE"}),"\n",(0,l.jsx)(n.li,{children:"When input is integer types, returns DOUBLE"}),"\n",(0,l.jsx)(n.li,{children:"When input is DECIMAL, returns DECIMAL, maintaining original precision and scale"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Empty arrays return NULL, arrays with only one element return that element's value"}),"\n",(0,l.jsx)(n.li,{children:"If the array is NULL, it will return a type conversion error"}),"\n",(0,l.jsx)(n.li,{children:"Nested arrays, MAP, STRUCT and other complex types are not supported for average calculation, calling will result in an error"}),"\n",(0,l.jsx)(n.li,{children:"For null values in array elements: null elements are not included in the average calculation"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE array_avg_test (\n    id INT,\n    int_array ARRAY<INT>,\n    double_array ARRAY<DOUBLE>,\n    mixed_array ARRAY<STRING>\n)\nDUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 3\nPROPERTIES (\n    \"replication_num\" = \"1\"\n);\n\nINSERT INTO array_avg_test VALUES\n(1, [1, 2, 3, 4, 5], [1.1, 2.2, 3.3, 4.4, 5.5], ['1', '2', '3', '4', '5']),\n(2, [10, 20, 30], [10.5, 20.5, 30.5], ['10', '20', '30']),\n(3, [], [], []),\n(4, NULL, NULL, NULL),\n(5, [1, null, 3, null, 5], [1.1, null, 3.3, null, 5.5], ['1', null, '3', null, '5']);\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Query Examples:"})}),"\n",(0,l.jsx)(n.p,{children:"Calculate the average of double_array:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT array_avg(double_array) FROM array_avg_test WHERE id = 1;\n+-------------------------+\n| array_avg(double_array) |\n+-------------------------+\n|                     3.3 |\n+-------------------------+\n"})}),"\n",(0,l.jsx)(n.p,{children:"Calculate the average of a mixed-type array, strings will be converted to numeric:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT array_avg(mixed_array) FROM array_avg_test WHERE id = 1;\n+------------------------+\n| array_avg(mixed_array) |\n+------------------------+\n|                      3 |\n+------------------------+\n"})}),"\n",(0,l.jsx)(n.p,{children:"Empty array returns NULL:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT array_avg(int_array) FROM array_avg_test WHERE id = 3;\n+----------------------+\n| array_avg(int_array) |\n+----------------------+\n|                 NULL |\n+----------------------+\n"})}),"\n",(0,l.jsx)(n.p,{children:"NULL array returns NULL:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT array_avg(int_array) FROM array_avg_test WHERE id = 4;\n+----------------------+\n| array_avg(int_array) |\n+----------------------+\n|                 NULL |\n+----------------------+\n"})}),"\n",(0,l.jsx)(n.p,{children:"Array containing null values, null elements are not included in calculation:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT array_avg(int_array) FROM array_avg_test WHERE id = 5;\n+----------------------+\n| array_avg(int_array) |\n+----------------------+\n|                    3 |\n+----------------------+\n"})}),"\n",(0,l.jsx)(n.p,{children:"Complex type examples:"}),"\n",(0,l.jsx)(n.p,{children:"Nested array types are not supported, will error:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT array_avg([[1,2,3]]);\nERROR 1105 (HY000): errCode = 2, detailMessage = array_avg([[1, 2, 3]]) does not support type: ARRAY<TINYINT>\n"})}),"\n",(0,l.jsx)(n.p,{children:"Map types are not supported, will error:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT array_avg([{'k':1},{'k':2}]);\nERROR 1105 (HY000): errCode = 2, detailMessage = array_avg([map('k', 1), map('k', 2)]) does not support type: MAP<VARCHAR(1),TINYINT>\n"})}),"\n",(0,l.jsx)(n.p,{children:"Error when parameter count is wrong:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT array_avg([1,2,3], [4,5,6]);\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not found function 'array_avg' which has 2 arity. Candidate functions are: [array_avg(Expression)]\n"})}),"\n",(0,l.jsx)(n.p,{children:"Error when passing non-array type:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT array_avg('not_an_array');\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not find the compatibility function signature: array_avg(VARCHAR(12))\n"})}),"\n",(0,l.jsx)(n.p,{children:"Array is NULL, will return type conversion error"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"mysql> SELECT array_max(NULL);\nERROR 1105 (HY000): errCode = 2, detailMessage = class org.apache.doris.nereids.types.NullType cannot be cast to class org.apache.doris.nereids.types.ArrayType (org.apache.doris.nereids.types.NullType and org.apache.doris.nereids.types.ArrayType are in unnamed module of loader 'app')\n"})}),"\n",(0,l.jsx)(n.h3,{id:"keywords",children:"Keywords"}),"\n",(0,l.jsx)(n.p,{children:"ARRAY, AVG, ARRAY_AVG"})]})}function u(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return i},a:function(){return t}});var a=r(667294);let l={},s=a.createContext(l);function t(e){let n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);