"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["527548"],{17124:function(e,n,t){t.r(n),t.d(n,{default:()=>d,frontMatter:()=>r,metadata:()=>s,assets:()=>l,toc:()=>o,contentTitle:()=>c});var s=JSON.parse('{"id":"query/query-cache/sql-cache-manual","title":"SQL Cache","description":"The SQL statement will hit the cache if it is completely consistent.","source":"@site/versioned_docs/version-2.0/query/query-cache/sql-cache-manual.md","sourceDirName":"query/query-cache","slug":"/query/query-cache/sql-cache-manual","permalink":"/docs/2.0/query/query-cache/sql-cache-manual","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"SQL Cache","language":"en"},"sidebar":"docs","previous":{"title":"Query Caches Overview","permalink":"/docs/2.0/query/query-cache/"},"next":{"title":"Partition Cache","permalink":"/docs/2.0/query/query-cache/partition-cache-manual"}}'),i=t("785893"),a=t("250065");let r={title:"SQL Cache",language:"en"},c="SQL Cache",l={},o=[{value:"Demand scenarios &amp; solutions",id:"demand-scenarios--solutions",level:2},{value:"Design principles",id:"design-principles",level:2},{value:"Usage",id:"usage",level:2},{value:"Cache conditions",id:"cache-conditions",level:2},{value:"Unfinished business",id:"unfinished-business",level:2}];function h(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"sql-cache",children:"SQL Cache"})}),"\n",(0,i.jsx)(n.p,{children:"The SQL statement will hit the cache if it is completely consistent."}),"\n",(0,i.jsx)(n.h2,{id:"demand-scenarios--solutions",children:"Demand scenarios & solutions"}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/docs/2.0/query/query-cache/",children:"Query Caches Overview"})]}),"\n",(0,i.jsx)(n.h2,{id:"design-principles",children:"Design principles"}),"\n",(0,i.jsx)(n.p,{children:"SQLCache stores and obtains the cache based on the SQL signature, the partition ID of the queried table, and the latest version of the partition. The combination of the three determines a cached data set. If any one of them changes, such as the SQL changes, the query fields or conditions are different, or the version changes after the data is updated, the cache will not be hit."}),"\n",(0,i.jsx)(n.p,{children:"If multiple tables are joined, the most recently updated partition ID and latest version number are used. If one of the tables is updated, the partition ID or version number will be different, and the cache will not be hit."}),"\n",(0,i.jsx)(n.p,{children:"SQLCache is more suitable for T+1 update scenarios. Data is updated in the early morning. The first query obtains the results from BE and puts them into the cache. Subsequent queries of the same nature obtain the results from the cache. Real-time update data can also be used, but there may be a problem of low hit rate."}),"\n",(0,i.jsx)(n.p,{children:"Currently supports OlapTable internal table and Hive external table."}),"\n",(0,i.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(n.p,{children:"Make sure cache_enable_sql_mode=true in fe.conf (default is true)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"vim fe/conf/fe.conf\ncache_enable_sql_mode=true\n"})}),"\n",(0,i.jsx)(n.p,{children:"Set variables in MySQL command line"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"MySQL [(none)]> set [global] enable_sql_cache=true;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Note: global is a global variable and does not refer to the current session variable."}),"\n",(0,i.jsx)(n.h2,{id:"cache-conditions",children:"Cache conditions"}),"\n",(0,i.jsx)(n.p,{children:"After the first query, if the following three conditions are met, the query results will be cached."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"(Current time - the last update time of the queried partition) is greater than cache_last_version_interval_second in fe.conf."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The number of query result rows is less than cache_result_max_row_count in fe.conf."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The query result bytes is less than cache_result_max_data_size in fe.conf."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For detailed parameter introduction and unfinished matters, see query-cache.md."}),"\n",(0,i.jsx)(n.h2,{id:"unfinished-business",children:"Unfinished business"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"SQL contains functions that generate random values, such as random(). Using QueryCache will cause the query results to lose their randomness, and the same results will be obtained every time they are executed."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Similar SQL, 2 indicators were queried before, and now 3 indicators are queried. Can the cache of 2 indicators be used? Not currently supported"}),"\n"]}),"\n"]})]})}function d(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return c},a:function(){return r}});var s=t(667294);let i={},a=s.createContext(i);function r(e){let n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);