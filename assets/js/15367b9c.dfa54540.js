"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["628594"],{381050:function(e,r,o){o.r(r),o.d(r,{default:()=>h,frontMatter:()=>l,metadata:()=>n,assets:()=>a,toc:()=>d,contentTitle:()=>i});var n=JSON.parse('{"id":"install/cluster-deployment/k8s-deploy/install-operator","title":"Deploying Doris Operator","description":"Add Doris Cluster resource definition","source":"@site/versioned_docs/version-2.0/install/cluster-deployment/k8s-deploy/install-operator.md","sourceDirName":"install/cluster-deployment/k8s-deploy","slug":"/install/cluster-deployment/k8s-deploy/install-operator","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/install-operator","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"Deploying Doris Operator","language":"en"},"sidebar":"docs","previous":{"title":"Cluster Environment Requirements","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/install-env"},"next":{"title":"Configuring Doris Cluster","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/install-config-cluster"}}'),s=o("785893"),t=o("250065");let l={title:"Deploying Doris Operator",language:"en"},i=void 0,a={},d=[{value:"Add Doris Cluster resource definition",id:"add-doris-cluster-resource-definition",level:2},{value:"Add Doris Operator",id:"add-doris-operator",level:2},{value:"Solution 1: Quickly deploy Doris Operator",id:"solution-1-quickly-deploy-doris-operator",level:3},{value:"Option 2: Customized deployment of Doris Operator",id:"option-2-customized-deployment-of-doris-operator",level:3},{value:"Option 3: Helm deploys Doris Operator",id:"option-3-helm-deploys-doris-operator",level:3},{value:"Check service status",id:"check-service-status",level:2}];function c(e){let r={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h2,{id:"add-doris-cluster-resource-definition",children:"Add Doris Cluster resource definition"}),"\n",(0,s.jsxs)(r.p,{children:["Doris Operator extends Kubernetes with Custom Resource Definition (CRD). The CRD of Doris Cluster encapsulates the description of Doris objects, such as the description of FE or BE. For details, please refer to ",(0,s.jsx)(r.a,{href:"https://github.com/apache/doris-operator/blob/master/doc/api.md",children:"doris-operator-api"}),". Before deploying Doris, you need to create the CRD of Doris Cluster."]}),"\n",(0,s.jsx)(r.p,{children:"Doris Cluster CRD can be deployed in a Kubernetes environment with the following command:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl create -f https://raw.githubusercontent.com/apache/doris-operator/master/config/crd/bases/doris.selectdb.com_dorisclusters.yaml\n"})}),"\n",(0,s.jsx)(r.p,{children:"If there is no external network, download the CRD file to your local computer first:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"wget https://raw.githubusercontent.com/apache/doris-operator/master/config/crd/bases/doris.selectdb.com_dorisclusters.yaml\nkubectl create -f ./doris.selectdb.com_dorisclusters.yaml\n"})}),"\n",(0,s.jsx)(r.p,{children:"The following is the expected output:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"customresourcedefinition.apiextensions.k8s.io/dorisclusters.doris.selectdb.com created\n"})}),"\n",(0,s.jsx)(r.p,{children:"After the Doris Cluster CRD is created, you can view the created CRD with the following command."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl get crd | grep doris\n"})}),"\n",(0,s.jsx)(r.p,{children:"The following is the expected output:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"dorisclusters.doris.selectdb.com                      2024-02-22T16:23:13Z\n"})}),"\n",(0,s.jsx)(r.h2,{id:"add-doris-operator",children:"Add Doris Operator"}),"\n",(0,s.jsx)(r.h3,{id:"solution-1-quickly-deploy-doris-operator",children:"Solution 1: Quickly deploy Doris Operator"}),"\n",(0,s.jsx)(r.p,{children:"You can directly pull the Doris Operator template in the warehouse for quick deployment."}),"\n",(0,s.jsx)(r.p,{children:"Doris Operator can be deployed in a Kubernetes cluster using the following command:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl apply -f https://raw.githubusercontent.com/apache/doris-operator/master/config/operator/operator.yaml\n"})}),"\n",(0,s.jsx)(r.p,{children:"The following is the expected output:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"namespace/doris created\nrole.rbac.authorization.k8s.io/leader-election-role created\nrolebinding.rbac.authorization.k8s.io/leader-election-rolebinding created\nclusterrole.rbac.authorization.k8s.io/doris-operator created\nclusterrolebinding.rbac.authorization.k8s.io/doris-operator-rolebinding created\nserviceaccount/doris-operator created\ndeployment.apps/doris-operator created\n"})}),"\n",(0,s.jsx)(r.h3,{id:"option-2-customized-deployment-of-doris-operator",children:"Option 2: Customized deployment of Doris Operator"}),"\n",(0,s.jsx)(r.p,{children:"After creating the CRD, there are two ways to deploy Doris Operator on the Kubernetes cluster: online and offline deployment."}),"\n",(0,s.jsx)(r.p,{children:"The minimum requirements for deploying operator services are specified in the operator.yaml file. In order to adapt to complex production environments, you can download the operator.yaml file and update the configuration as desired."}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Install Doris Operator online"})}),"\n",(0,s.jsx)(r.p,{children:"After modifying the operator.yaml file, you can deploy the Doris Operator service using the following command:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl apply -f ./operator.yaml\n"})}),"\n",(0,s.jsx)(r.p,{children:"The following is the expected output:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"namespace/doris created\nrole.rbac.authorization.k8s.io/leader-election-role created\nrolebinding.rbac.authorization.k8s.io/leader-election-rolebinding created\nclusterrole.rbac.authorization.k8s.io/doris-operator created\nclusterrolebinding.rbac.authorization.k8s.io/doris-operator-rolebinding created\nserviceaccount/doris-operator created\ndeployment.apps/doris-operator created\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Offline installation of Doris Operator"})}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:"Download the image file required to run the operator"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"If the server is not connected to the external network, you need to download the corresponding operator image file first. Doris Operator uses the following images:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"selectdb/doris.k8s-operator:latest\n"})}),"\n",(0,s.jsx)(r.p,{children:"Run the following command on a server that can connect to the external network to download the image:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"## download doris operator image\ndocker pull selectdb/doris.k8s-operator:latest\n## save the doris operator image as a tar package\ndocker save -o doris.k8s-operator-latest.tar selectdb/doris.k8s-operator:latest\n"})}),"\n",(0,s.jsx)(r.p,{children:"Place the packaged tar file into all Kubernetes nodes and run the following command to upload the image:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"docker load -i doris.k8s-operator-latest.tar\n"})}),"\n",(0,s.jsxs)(r.ol,{start:"2",children:["\n",(0,s.jsx)(r.li,{children:"Configure Doris Operator"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"After downloading the operator.yaml file, you can modify the template according to your production environment expectations."}),"\n",(0,s.jsxs)(r.p,{children:["Doris Operator is a stateless Deployment in the Kubernetes cluster. Items such as ",(0,s.jsx)(r.code,{children:"limits"}),", ",(0,s.jsx)(r.code,{children:"replica"}),", ",(0,s.jsx)(r.code,{children:"label"}),", ",(0,s.jsx)(r.code,{children:"namespace"})," and other items can be modified according to needs. If you need to specify a certain version of the doirs operator image, you can make the following modifications to the operator.yaml file after uploading the image:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:'...\ncontainers:\n  - command:\n      - /dorisoperator\n    args:\n      - --leader-elect\n    image: selectdb/doris.k8s-operator:v1.0.0\n    name: dorisoperator\n    securityContext:\n      allowPrivilegeEscalation: false\n      capabilities:\n        drop:\n          - "ALL"\n  ...\n'})}),"\n",(0,s.jsxs)(r.ol,{start:"3",children:["\n",(0,s.jsx)(r.li,{children:"Install Doris Operator"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"After modifying the Doris Operator template, you can use the apply command to deploy the Operator:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl apply -f ./operator.yaml\n"})}),"\n",(0,s.jsx)(r.p,{children:"The following is the expected output:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"namespace/doris created\nrole.rbac.authorization.k8s.io/leader-election-role created\nrolebinding.rbac.authorization.k8s.io/leader-election-rolebinding created\nclusterrole.rbac.authorization.k8s.io/doris-operator created\nclusterrolebinding.rbac.authorization.k8s.io/doris-operator-rolebinding created\nserviceaccount/doris-operator created\ndeployment.apps/doris-operator created\n"})}),"\n",(0,s.jsx)(r.h3,{id:"option-3-helm-deploys-doris-operator",children:"Option 3: Helm deploys Doris Operator"}),"\n",(0,s.jsx)(r.p,{children:"Helm Chart is an encapsulation of a series of YAML files that describe Kubernetes-related resources. When deploying an application through Helm, you can customize the application's metadata to facilitate application distribution. Chart is a Helm package in TAR format for deploying Kubernetes native applications. Helm Chart can simplify the process of deploying Doris clusters."}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:"Add a deployment warehouse"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Add warehouse online"})}),"\n",(0,s.jsxs)(r.p,{children:["Add the remote repository through the ",(0,s.jsx)(r.code,{children:"repo add"})," command"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"helm repo add doris-repo https://charts.selectdb.com\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Update the latest version of the chart through the ",(0,s.jsx)(r.code,{children:"repo update"})," command"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"helm repo update doris-repo\n"})}),"\n",(0,s.jsxs)(r.ol,{start:"2",children:["\n",(0,s.jsx)(r.li,{children:"Install Doris Operator"}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Doris Operator can be installed in the doris namespace using the default configuration through the ",(0,s.jsx)(r.code,{children:"helm install"})," command."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"helm install operator doris-repo/doris-operator\n"})}),"\n",(0,s.jsxs)(r.p,{children:["If you need to customize the assembly ",(0,s.jsx)(r.a,{href:"https://artifacthub.io/packages/helm/doris/doris-operator?modal=values",children:"values.yaml"}),", you can refer to the following command:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"helm install -f values.yaml operator doris-repo/doris-operator\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Check the deployment status of Pods through the ",(0,s.jsx)(r.code,{children:"kubectl get pods"})," command. When the Doris Operator's Pod is in the Running state and all containers in the Pod are ready, the deployment is successful."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl get pod --namespace doris\n"})}),"\n",(0,s.jsx)(r.p,{children:"The return result is as follows:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"NAME                              READY   STATUS    RESTARTS   AGE\ndoris-operator-866bd449bb-zl5mr   1/1     Running   0          18m\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Add warehouse offline"})}),"\n",(0,s.jsx)(r.p,{children:"If the server cannot connect to the external network, you need to download the chart resources of Doris Operator and Doris Cluster in advance."}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:"Download offline chart resources"}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Download ",(0,s.jsx)(r.code,{children:"doris-operator-{chart_version}.tgz"})," to install Doris Operator chart. If you need to download version 1.4.0 of Doris Operator, you can use the following command:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"wget https://charts.selectdb.com/doris-operator-1.4.0.tgz\n"})}),"\n",(0,s.jsxs)(r.ol,{start:"2",children:["\n",(0,s.jsx)(r.li,{children:"Install Doris Operator"}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Doris Operator can be installed through the ",(0,s.jsx)(r.code,{children:"helm install"})," command."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"helm install operator doris-operator-1.4.0.tgz\n"})}),"\n",(0,s.jsxs)(r.p,{children:["If you need to customize the assembly ",(0,s.jsx)(r.a,{href:"https://artifacthub.io/packages/helm/doris/doris-operator?modal=values",children:"values.yaml"}),", you can refer to the following command:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"helm install -f values.yaml operator doris-operator-1.4.0.tgz\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Check the deployment status of Pods through the ",(0,s.jsx)(r.code,{children:"kubectl get pods"})," command. When the Doris Operator's Pod is in the Running state and all containers in the Pod are ready, the deployment is successful."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl get pod --namespace doris\n"})}),"\n",(0,s.jsx)(r.p,{children:"The return result is as follows:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"NAME                              READY   STATUS    RESTARTS   AGE\ndoris-operator-866bd449bb-zl5mr   1/1     Running   0          18m\n"})}),"\n",(0,s.jsx)(r.h2,{id:"check-service-status",children:"Check service status"}),"\n",(0,s.jsx)(r.p,{children:"After deploying the Operator service, you can check the service status through the following command."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl get pod -n doris\n"})}),"\n",(0,s.jsx)(r.p,{children:"The return result is as follows:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"NAME                              READY   STATUS    RESTARTS   AGE\ndoris-operator-6f47594455-p5tp7   1/1     Running   0          11s\n"})}),"\n",(0,s.jsx)(r.p,{children:"You need to ensure that the STATUS status is Running and the status of all containers in the pod is Ready."})]})}function h(e={}){let{wrapper:r}={...(0,t.a)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},250065:function(e,r,o){o.d(r,{Z:function(){return i},a:function(){return l}});var n=o(667294);let s={},t=n.createContext(s);function l(e){let r=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),n.createElement(t.Provider,{value:r},e.children)}}}]);