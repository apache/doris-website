"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["106848"],{606596:function(e,n,i){i.r(n),i.d(n,{default:()=>h,frontMatter:()=>s,metadata:()=>t,assets:()=>l,toc:()=>d,contentTitle:()=>o});var t=JSON.parse('{"id":"query-acceleration/dictionary","title":"Dictionary Table(Experimental)","description":"Dictionary is a special data structure provided by Doris to speed up JOIN operations. It is built on the basis of ordinary tables,","source":"@site/docs/query-acceleration/dictionary.md","sourceDirName":"query-acceleration","slug":"/query-acceleration/dictionary","permalink":"/docs/dev/query-acceleration/dictionary","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Dictionary Table(Experimental)","language":"en","description":"Dictionary is a special data structure provided by Doris to speed up JOIN operations. It is built on the basis of ordinary tables,"},"sidebar":"docs","previous":{"title":"High-Concurrency Point Query Optimization","permalink":"/docs/dev/query-acceleration/high-concurrent-point-query"},"next":{"title":"Query Profile Analysis","permalink":"/docs/dev/query-acceleration/query-profile"}}'),r=i("785893"),a=i("250065");let s={title:"Dictionary Table(Experimental)",language:"en",description:"Dictionary is a special data structure provided by Doris to speed up JOIN operations. It is built on the basis of ordinary tables,"},o=void 0,l={},d=[{value:"Overview",id:"overview",level:2},{value:"Usage Scenario",id:"usage-scenario",level:2},{value:"Scenario Example",id:"scenario-example",level:3},{value:"Dictionary Table Definition",id:"dictionary-table-definition",level:2},{value:"Basic Grammar",id:"basic-grammar",level:3},{value:"Layout Type",id:"layout-type",level:3},{value:"Property",id:"property",level:3},{value:"Example",id:"example",level:3},{value:"Usage Restrictions",id:"usage-restrictions",level:3},{value:"Use and Management",id:"use-and-management",level:2},{value:"Import (Refresh) Data",id:"import-refresh-data",level:3},{value:"Automatic Import",id:"automatic-import",level:4},{value:"Manual Import",id:"manual-import",level:4},{value:"Attention Points of Import",id:"attention-points-of-import",level:4},{value:"Query Dictionary",id:"query-dictionary",level:3},{value:"Grammar",id:"grammar",level:4},{value:"Query Example",id:"query-example",level:4},{value:"Attention Points of Query",id:"attention-points-of-query",level:4},{value:"Dictionary Management",id:"dictionary-management",level:3},{value:"Config Item",id:"config-item",level:4},{value:"Status Display",id:"status-display",level:3},{value:"Cautionary Notes",id:"cautionary-notes",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function c(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Dictionary is a special data structure provided by Doris to speed up JOIN operations. It is built on the basis of ordinary tables, treating the corresponding columns of the original table as key-value relationships, and pre-loading all the data of these columns into memory to achieve fast lookup operations, thus improving query performance. It is especially suitable for scenarios that require frequent key-value lookups."}),"\n",(0,r.jsx)(n.p,{children:"Naturally, as a key-value lookup solution, dictionary tables do not allow duplicate keys."}),"\n",(0,r.jsx)(n.h2,{id:"usage-scenario",children:"Usage Scenario"}),"\n",(0,r.jsx)(n.p,{children:"The dictionary table is mainly suitable for the following scenarios:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Scenarios where frequent key-value lookups are required"}),"\n",(0,r.jsx)(n.li,{children:"Dimension tables are small and can be fully loaded into memory"}),"\n",(0,r.jsx)(n.li,{children:"Scenarios with relatively low frequency of data updates"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The key-value lookup that originally needed to be implemented using LEFT OUTER JOIN can be completely eliminated with the help of the dictionary table, transforming into a normal function call. Here is a complete scenario example:"}),"\n",(0,r.jsx)(n.h3,{id:"scenario-example",children:"Scenario Example"}),"\n",(0,r.jsxs)(n.p,{children:["In e-commerce systems, the order table (",(0,r.jsx)(n.code,{children:"orders"}),", fact table) records a large amount of transaction data, and it needs to frequently associate with the product table (",(0,r.jsx)(n.code,{children:"products"}),", dimension table) to obtain detailed product information."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Product Dimension Table\nCREATE TABLE products (\n    product_id BIGINT NOT NULL COMMENT \"\u5546\u54C1ID\",\n    product_name VARCHAR(128) NOT NULL COMMENT \"\u5546\u54C1\u540D\u79F0\",\n    brand_name VARCHAR(64) NOT NULL COMMENT \"\u54C1\u724C\u540D\u79F0\",\n    category_name VARCHAR(64) NOT NULL COMMENT \"\u54C1\u7C7B\u540D\u79F0\",\n    retail_price DECIMAL(10,2) NOT NULL COMMENT \"\u96F6\u552E\u4EF7\",\n    update_time DATETIME NOT NULL COMMENT \"\u66F4\u65B0\u65F6\u95F4\"\n)\nDISTRIBUTED BY HASH(`product_id`) BUCKETS 10;\n\n-- Order Fact Table\nCREATE TABLE orders (\n    order_id BIGINT NOT NULL COMMENT \"\u8BA2\u5355ID\",\n    product_id BIGINT NOT NULL COMMENT \"\u5546\u54C1ID\",\n    user_id BIGINT NOT NULL COMMENT \"\u7528\u6237ID\",\n    quantity INT NOT NULL COMMENT \"\u8D2D\u4E70\u6570\u91CF\",\n    actual_price DECIMAL(10,2) NOT NULL COMMENT \"\u5B9E\u9645\u6210\u4EA4\u4EF7\",\n    order_time DATETIME NOT NULL COMMENT \"\u4E0B\u5355\u65F6\u95F4\"\n)\nDISTRIBUTED BY HASH(`order_id`) BUCKETS 32;\n\nINSERT INTO products VALUES\n(1001, 'iPhone 15 Pro 256G \u9ED1\u8272', 'Apple', '\u624B\u673A\u6570\u7801', 8999.00, '2024-01-01 00:00:00'),\n(1002, 'MacBook Pro M3 Max', 'Apple', '\u7535\u8111\u529E\u516C', 19999.00, '2024-01-01 00:00:00'),\n(1003, 'AirPods Pro 2', 'Apple', '\u624B\u673A\u914D\u4EF6', 1999.00, '2024-01-01 00:00:00');\n\nINSERT INTO orders VALUES\n(10001, 1001, 88001, 1, 8899.00, '2024-02-22 10:15:00'),\n(10002, 1002, 88002, 1, 19599.00, '2024-02-22 11:30:00'),\n(10003, 1003, 88001, 2, 1899.00, '2024-02-22 14:20:00');\n"})}),"\n",(0,r.jsx)(n.p,{children:"The following is a set of typical queries. In order to count the order volume and sales of each category, in the past, we needed to use LEFT OUTER JOIN to achieve the function of extracting product information from the product table."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Analyze the order volume and sales revenue of each category\nSELECT \n    p.category_name,\n    p.brand_name,\n    COUNT(DISTINCT o.order_id) as order_count,\n    SUM(o.quantity) as total_quantity,\n    SUM(o.actual_price * o.quantity) as total_amount\nFROM orders o\nLEFT JOIN products p ON o.product_id = p.product_id\nWHERE o.order_time >= '2024-02-22 00:00:00'\nGROUP BY p.category_name, p.brand_name\nORDER BY total_amount DESC;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"+---------------+------------+-------------+----------------+--------------+\n| category_name | brand_name | order_count | total_quantity | total_amount |\n+---------------+------------+-------------+----------------+--------------+\n| \u7535\u8111\u529E\u516C      | Apple      |           1 |              1 |     19599.00 |\n| \u624B\u673A\u6570\u7801      | Apple      |           1 |              1 |      8899.00 |\n| \u624B\u673A\u914D\u4EF6      | Apple      |           1 |              2 |      3798.00 |\n+---------------+------------+-------------+----------------+--------------+\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In such queries, we need to frequently retrieve other information about products using the ",(0,r.jsx)(n.code,{children:"product_id"}),", which essentially involves a KV lookup operation."]}),"\n",(0,r.jsx)(n.p,{children:"By setting up the key-value pair relationships and pre-building the corresponding dictionary tables, we can completely convert previous JOIN operations into lighter key-value lookups, thereby improving SQL execution efficiency:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Create product information dictionary\nCREATE DICTIONARY product_info_dict USING products\n(\n    product_id KEY,\n    product_name VALUE,\n    brand_name VALUE,\n    category_name VALUE,\n    retail_price VALUE\n)\nLAYOUT(HASH_MAP)\nPROPERTIES(\n    'data_lifetime'='300'  -- Considering the frequency of changes in product information, set the update interval to 5 minutes.\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The original query converts the JOIN operation into a ",(0,r.jsx)(n.code,{children:"dict_get"})," function lookup using a dictionary table, which is a lighter KV lookup operation:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'SELECT\n    dict_get("test.product_info_dict", "category_name", o.product_id) as category_name,\n    dict_get("test.product_info_dict", "brand_name", o.product_id) as brand_name,\n    COUNT(DISTINCT o.order_id) as order_count,\n    SUM(o.quantity) as total_quantity,\n    SUM(o.actual_price * o.quantity) as total_amount\nFROM orders o\nWHERE o.order_time >= \'2024-02-22 00:00:00\'\nGROUP BY\n    dict_get("test.product_info_dict", "category_name", o.product_id),\n    dict_get("test.product_info_dict", "brand_name", o.product_id)\nORDER BY total_amount DESC;\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"+---------------+------------+-------------+----------------+--------------+\n| category_name | brand_name | order_count | total_quantity | total_amount |\n+---------------+------------+-------------+----------------+--------------+\n| \u7535\u8111\u529E\u516C      | Apple      |           1 |              1 |     19599.00 |\n| \u624B\u673A\u6570\u7801      | Apple      |           1 |              1 |      8899.00 |\n| \u624B\u673A\u914D\u4EF6      | Apple      |           1 |              2 |      3798.00 |\n+---------------+------------+-------------+----------------+--------------+\n"})}),"\n",(0,r.jsx)(n.h2,{id:"dictionary-table-definition",children:"Dictionary Table Definition"}),"\n",(0,r.jsx)(n.h3,{id:"basic-grammar",children:"Basic Grammar"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE DICTIONARY <dict_name> USING <source_table>\n(\n    <key_column> KEY[,\n    ...,\n    <key_columns> VALUE]\n    <value_column> VALUE[,\n    ...,\n    <value_columns> VALUE]\n)\nLAYOUT(<layout_type>)\nPROPERTIES(\n    "<priority_item_key>" = "<priority_item_value>"[,\n    ...,\n    "<priority_item_key>" = "<priority_item_value>"]\n);\n'})}),"\n",(0,r.jsx)(n.p,{children:"Among:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<dict_name>"}),": The name of the dictionary table"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<source_table>"}),": Source data table"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<key_column>"}),": The column name in the source table that serves as a key"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<value_column>"}),": The column name in the source table that serves as a value"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<layout_type>"}),": The storage layout type of the dictionary table, see later for details."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<priority_item_key>"}),": The name of a certain property of a table"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<priority_item_value>"}),": The value of a certain property of a table"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"<key_column>"})," and ",(0,r.jsx)(n.code,{children:"<value_column>"})," each must have at least one. ",(0,r.jsx)(n.code,{children:"<key_column>"})," does not have to appear before ",(0,r.jsx)(n.code,{children:"<value_column>"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"layout-type",children:"Layout Type"}),"\n",(0,r.jsx)(n.p,{children:"Currently, two layout types are supported:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"HASH_MAP"}),": An implementation based on a hash table, suitable for general key-value lookup scenarios."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"IP_TRIE"}),": An implementation based on a Trie tree, specifically optimized for IP address type lookups. The Key column needs to be represented in CIDR notation for IP addresses, and queries are matched according to CIDR notation."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"property",children:"Property"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Property Name"}),(0,r.jsx)(n.th,{children:"Value Type"}),(0,r.jsx)(n.th,{children:"Meaning"}),(0,r.jsx)(n.th,{children:"Required"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"date_lifetime"})}),(0,r.jsx)(n.td,{children:"Integer, unit in seconds"}),(0,r.jsxs)(n.td,{children:["Data validity period. When the time since the last update of this dictionary exceeds this value and the source table has data changes, it will automatically initiate a import. The import logic is detailed in ",(0,r.jsx)(n.a,{href:"#automatic-import",children:"Automatic Import"})]}),(0,r.jsx)(n.td,{children:"Yes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"skip_null_key"})}),(0,r.jsx)(n.td,{children:"Boolean"}),(0,r.jsxs)(n.td,{children:["If the Key column contains null values when load to a dictionary, skip the row if the value is ",(0,r.jsx)(n.code,{children:"true"}),", otherwise raise an error. The default value is ",(0,r.jsx)(n.code,{children:"false"})]}),(0,r.jsx)(n.td,{children:"No"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"memory_limit"})}),(0,r.jsx)(n.td,{children:"Integer, unit in bytes"}),(0,r.jsxs)(n.td,{children:["The upper limit of memory occupied by this dictionary on a single BE. The deafult value is ",(0,r.jsx)(n.code,{children:"2147483648"}),", which equals to 2GB."]}),(0,r.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Create source data table\nCREATE TABLE source_table (\n    id INT NOT NULL,\n    city VARCHAR(32) NOT NULL,\n    code VARCHAR(32) NOT NULL\n) ENGINE=OLAP\nDISTRIBUTED BY HASH(id) BUCKETS 1;\n\n-- Create dictionary table\nCREATE DICTIONARY city_dict USING source_table\n(\n    city KEY,\n    id VALUE\n)\nLAYOUT(HASH_MAP)\nPROPERTIES('data_lifetime' = '600');\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Based on the table, we can use the dictionary ",(0,r.jsx)(n.code,{children:"city_dict"})," through the ",(0,r.jsx)(n.code,{children:"dict_get"})," function to query the corresponding ",(0,r.jsx)(n.code,{children:"id"})," based on the ",(0,r.jsx)(n.code,{children:"city"})," value in ",(0,r.jsx)(n.code,{children:"source_table"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"usage-restrictions",children:"Usage Restrictions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Key Columns"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The Key column of the IP_TRIE type dictionary must be of Varchar or String type, ",(0,r.jsx)(n.strong,{children:"the values in the Key column must be in CIDR format"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"The dictionary of the IP_TRIE type allows only one Key column."}),"\n",(0,r.jsx)(n.li,{children:"The Key column of the HASH_MAP type dictionary supports all simple types (i.e., excluding all nested types such as Map, Array, etc.)."}),"\n",(0,r.jsxs)(n.li,{children:["As a Key column, ",(0,r.jsx)(n.strong,{children:"there must not be duplicate values in the source table"}),", otherwise an error will be reported when importing dictionary data."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Null Value Handling"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["All columns in the dictionary can be nullable columns, but the Key column should not actually appear with null values. If it does, the behavior depends on the ",(0,r.jsx)(n.code,{children:"skip_null_key"})," in the ",(0,r.jsx)(n.a,{href:"#property",children:"Property"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"use-and-management",children:"Use and Management"}),"\n",(0,r.jsx)(n.h3,{id:"import-refresh-data",children:"Import (Refresh) Data"}),"\n",(0,r.jsx)(n.p,{children:'The dictionary supports automatic and manual import. "import" is also called "refresh" here.'}),"\n",(0,r.jsx)(n.h4,{id:"automatic-import",children:"Automatic Import"}),"\n",(0,r.jsx)(n.p,{children:"Automatic import occurs at the following times:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"After the dictionary is established"}),"\n",(0,r.jsxs)(n.li,{children:["When the dictionary data expires (see ",(0,r.jsx)(n.a,{href:"#property",children:"Property"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"When the BE state shows the lack of the dictionary data (new BE going online, or old BE restarting, etc.)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Doris will check all dictionary data for expiration every ",(0,r.jsx)(n.code,{children:"dictionary_auto_refresh_interval_seconds"})," seconds. When a dictionary has not been updated for more than ",(0,r.jsx)(n.code,{children:"data_lifetime"})," seconds, and the source table data has changed compared to the last import, Doris will automatically submit the import for that dictionary."]}),"\n",(0,r.jsx)(n.p,{children:"If some BEs are missing data and the source table data has not changed compared to the last import, Doris will only fill in the current version of the data on the corresponding BEs, will not submit the refresh task for all BEs, and the dictionary's version will not change."}),"\n",(0,r.jsx)(n.h4,{id:"manual-import",children:"Manual Import"}),"\n",(0,r.jsx)(n.p,{children:"Doris supports manually refreshing dictionary data through the following commands:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"REFRESH DICTIONARY <dict_name>;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Among them, ",(0,r.jsx)(n.code,{children:"<dict_name>"})," is the name of the dictionary to be imported."]}),"\n",(0,r.jsx)(n.h4,{id:"attention-points-of-import",children:"Attention Points of Import"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Only dictionaries that have imported data can be queried."}),"\n",(0,r.jsx)(n.li,{children:"If the Key column has duplicate values during import, the import transaction will fail."}),"\n",(0,r.jsxs)(n.li,{children:["If there is already an ongoing import transaction at the moment (dictionary Status is ",(0,r.jsx)(n.code,{children:"LOADING"}),"), the manual import will fail. Please wait until the ongoing import is completed before proceeding."]}),"\n",(0,r.jsxs)(n.li,{children:["If the size of the imported dictionary exceeds the set ",(0,r.jsx)(n.code,{children:"memory_limit"}),", the import transaction will fail."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"query-dictionary",children:"Query Dictionary"}),"\n",(0,r.jsxs)(n.p,{children:["You can use the ",(0,r.jsx)(n.code,{children:"dict_get"})," and ",(0,r.jsx)(n.code,{children:"dict_get_many"})," functions for dictionary table queries of single Key, Value list and multi Key, Value list respectively."]}),"\n",(0,r.jsx)(n.p,{children:"Please wait until the dictionary is imported before performing the first query to a dictionary."}),"\n",(0,r.jsx)(n.h4,{id:"grammar",children:"Grammar"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'dict_get("<db_name>.<dict_name>", "<query_column>", <query_key_value>);\ndict_get_many("<db_name>.<dict_name>", <query_columns>, <query_key_values>);\n'})}),"\n",(0,r.jsx)(n.p,{children:"Among:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<db_name>"})," is the name of the database where the dictionary is located."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<dict_name>"})," is the name of the dictionary"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<query_column>"})," is the column name for the value column to be queried, with a type of ",(0,r.jsx)(n.code,{children:"VARCHAR"}),", ",(0,r.jsx)(n.strong,{children:"must be a constant"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<query_columns>"})," are the column names for all value columns to be queried, with a type of ",(0,r.jsx)(n.code,{children:"ARRAY<VARCHAR>"}),", ",(0,r.jsx)(n.strong,{children:"must be constants"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<query_key_value>"})," is data for key columns used in queries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<query_key_values>"})," is a STRUCT that contains all Key columns of the data to be queried in a dictionary."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The return type of ",(0,r.jsx)(n.code,{children:"dict_get"})," is the dictionary column type corresponding to ",(0,r.jsx)(n.code,{children:"<query_column>"}),".\nThe return type of ",(0,r.jsx)(n.code,{children:"dict_get_many"})," is a ",(0,r.jsx)(n.a,{href:"../sql-manual/basic-element/sql-data-types/semi-structured/STRUCT",children:"STRUCT"})," corresponding to the types of various dictionary columns in ",(0,r.jsx)(n.code,{children:"<query_columns>"}),"\u3002"]}),"\n",(0,r.jsx)(n.h4,{id:"query-example",children:"Query Example"}),"\n",(0,r.jsxs)(n.p,{children:["The statement queries the dictionary ",(0,r.jsx)(n.code,{children:"city_dict"})," within the ",(0,r.jsx)(n.code,{children:"test_db"})," database, for the corresponding ",(0,r.jsx)(n.code,{children:"id"})," value when the ",(0,r.jsx)(n.code,{children:"key"}),' column value is "Beijing":']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'SELECT dict_get("test_db.city_dict", "id", "Beijing");\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The statement queries the dictionary ",(0,r.jsx)(n.code,{children:"single_key_dict"})," within the ",(0,r.jsx)(n.code,{children:"test_db"})," database, for the corresponding values of ",(0,r.jsx)(n.code,{children:"k1"})," and ",(0,r.jsx)(n.code,{children:"k3"})," when the value of the ",(0,r.jsx)(n.code,{children:"key"})," column is 1:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'SELECT dict_get_many("test_db.single_key_dict", ["k1", "k3"], struct(1));\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The statement queries the dictionary ",(0,r.jsx)(n.code,{children:"multi_key_dict"})," within the ",(0,r.jsx)(n.code,{children:"test_db"})," database, for the corresponding ",(0,r.jsx)(n.code,{children:"k2"})," and ",(0,r.jsx)(n.code,{children:"k3"})," column values when the 2 key column values are 2 and 'ABC' in sequence:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'SELECT dict_get_many("test_db.multi_key_dict", ["k2", "k3"], struct(2, \'ABC\'));\n'})}),"\n",(0,r.jsx)(n.p,{children:"For example, the table creation statement is as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"create table if not exists multi_key_table(\n    k0 int not null,\n    k1 varchar not null,\n    k2 float not null,\n    k3 varchar not null\n)\nDISTRIBUTED BY HASH(`k0`) BUCKETS auto;\n\ncreate dictionary multi_key_dict using multi_key_table\n(\n    k0 KEY,\n    k1 KEY,\n    k2 VALUE,\n    k3 VALUE\n)\nLAYOUT(HASH_MAP)\nPROPERTIES('data_lifetime' = '600');\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then the above statement"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'SELECT dict_get_many("test_db.multi_key_dict", ["k2", "k3"], struct(2, \'ABC\'));\n'})}),"\n",(0,r.jsxs)(n.p,{children:["returns type of ",(0,r.jsx)(n.code,{children:"STRUCT<float, varchar>"}),"\u3002"]}),"\n",(0,r.jsx)(n.h4,{id:"attention-points-of-query",children:"Attention Points of Query"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["When the query Key data does not exist in the dictionary table, ",(0,r.jsx)(n.strong,{children:"or the Key data is null"}),", return null."]}),"\n",(0,r.jsxs)(n.li,{children:["For IP_TRIE type queries, ",(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"<query_key_value>"})," type must be ",(0,r.jsx)(n.code,{children:"IPV4"})," or ",(0,r.jsx)(n.code,{children:"IPV6"})]}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["When using an IP_TRIE type dictionary, the data in the Key column ",(0,r.jsx)(n.code,{children:"<key_column>"})," and the ",(0,r.jsx)(n.code,{children:"<query_key_value>"})," used for querying both support ",(0,r.jsx)(n.code,{children:"IPV4"})," and ",(0,r.jsx)(n.code,{children:"IPV6"})," format data."]}),"\n",(0,r.jsxs)(n.li,{children:["When a specific BE lacks dictionary data due to reasons such as new launch or restart, executing a query using corresponding dictionary on that BE will fail. Whether the query is scheduled to that BE depends on various factors. Reducing the value of the configuration item ",(0,r.jsx)(n.code,{children:"dictionary_auto_refresh_interval_seconds"})," when the FE Master is not under heavy pressure can shorten the time when the dictionary is unavailable."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"dictionary-management",children:"Dictionary Management"}),"\n",(0,r.jsx)(n.p,{children:"The dictionary table supports the following management and viewing statements:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Check the status of all dictionary tables in the current database."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SHOW DICTIONARIES [LIKE <LIKE_NAME>];\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Check the definition of a specific dictionary"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"DESC DICTIONARY <dict_name>;\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Delete dictionary table"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"DROP DICTIONARY <dict_name>;\n"})}),"\n",(0,r.jsx)(n.p,{children:"After deleting the dictionary table, the deleted dictionary may not be removed from BE immediately."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"config-item",children:"Config Item"}),"\n",(0,r.jsx)(n.p,{children:"The dictionary table supports the following configuration items, all of which are FE CONFIG:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dictionary_task_queue_size"})," \u2014\u2014 The queue length of the thread pool for all tasks in the dictionary is not dynamically adjustable. The default value is 1024, and it is generally not necessary to adjust it."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"job_dictionary_task_consumer_thread_num"})," \u2014\u2014 The number of threads in the thread pool for all tasks in the dictionary is not dynamically adjustable. Default value is 3."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dictionary_rpc_timeout_ms"})," \u2014\u2014 The timeout duration for all related RPCs in the dictionary can be dynamically adjusted. The default is 5000 (i.e., 5 seconds), and it generally does not need to be adjusted."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dictionary_auto_refresh_interval_seconds"})," \u2014\u2014 The interval for automatically checking if all dictionary data is up to date is default 5 (seconds), and it can be dynamically adjusted."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"status-display",children:"Status Display"}),"\n",(0,r.jsxs)(n.p,{children:["By using the ",(0,r.jsx)(n.code,{children:"SHOW DICTIONARIES"})," statement, you can view the base table corresponding to the dictionary, the current data version number, and the corresponding status in FE and BE:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"> SHOW DICTIONARIES;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"+--------------+----------------+----------------------------------------------+---------+--------+------------------------------------+------------------------------+\n| DictionaryId | DictionaryName | BaseTableName                                | Version | Status | DataDistribution                   | LastUpdateResult             |\n+--------------+----------------+----------------------------------------------+---------+--------+------------------------------------+------------------------------+\n| 51           | precision_dict | internal.test_refresh_dict.precision_test    | 2       | NORMAL | {10.16.10.2:9767 ver=2 memory=368} | 2025-02-18 09:58:12: succeed |\n| 48           | product_dict   | internal.test_refresh_dict.product_info      | 2       | NORMAL | {10.16.10.2:9767 ver=2 memory=240} | 2025-02-18 09:58:12: succeed |\n| 49           | ip_dict        | internal.test_refresh_dict.ip_info           | 2       | NORMAL | {10.16.10.2:9767 ver=2 memory=194} | 2025-02-18 09:58:12: succeed |\n| 52           | order_dict     | internal.test_refresh_dict.column_order_test | 2       | NORMAL | {10.16.10.2:9767 ver=2 memory=432} | 2025-02-18 09:58:12: succeed |\n| 50           | user_dict      | internal.test_refresh_dict.user_info         | 2       | NORMAL | {10.16.10.2:9767 ver=2 memory=240} | 2025-02-18 09:58:12: succeed |\n+--------------+----------------+----------------------------------------------+---------+--------+------------------------------------+------------------------------+\n"})}),"\n",(0,r.jsx)(n.p,{children:"Among:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Version"})," represents the data version number, which will increment by 1 each time data is imported."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Status"})," represents the dictionary status, meaning as follows:"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Status Name"}),(0,r.jsx)(n.th,{children:"Meaning"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"NORMAL"}),(0,r.jsx)(n.td,{children:"The dictionary is currently normal"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"LOADING"}),(0,r.jsx)(n.td,{children:"The dictionary is currently importing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"OUT_OF_DATE"}),(0,r.jsx)(n.td,{children:"The current dictionary data has expired"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"The dictionary cannot be imported again while it is being imported."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"DataDistribution"})," represents the current status of each BE, including the version number and memory usage size (KB)."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"LastUpdateResult"})," indicates the result of the last import (including automatic and manual), and detailed error message will be displayed here if there are any exceptions."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["To view the column definitions of the dictionary table, you can use ",(0,r.jsx)(n.code,{children:"DESC DICTIONARY"}),". For example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"> DESC DICTIONARY city_code_dict;\n+-------------+-------------+------+-------+\n| Field       | Type        | Null | Key   |\n+-------------+-------------+------+-------+\n| city_name   | varchar(32) | NO   | true  |\n| region_code | varchar(32) | NO   | false |\n+-------------+-------------+------+-------+\n"})}),"\n",(0,r.jsx)(n.h2,{id:"cautionary-notes",children:"Cautionary Notes"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Data consistency"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Each refresh of the dictionary will generate a new version. If the version of the BE record doesn't match the FE version during the query, the query will fail."}),"\n",(0,r.jsxs)(n.li,{children:["Doris does not maintain strong data consistency between dictionary tables and base tables. Users need to properly set the ",(0,r.jsx)(n.code,{children:"data_lifetime"})," of the dictionary to achieve automatic updates, and manually update when necessary based on business logic."]}),"\n",(0,r.jsx)(n.li,{children:"When the source table is deleted by any way, the corresponding dictionary table will also be automatically deleted."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Performance Considerations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Dictionary tables are suitable for relatively static data, such as dimension table data."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Dictionary tables are pure in-memory tables, with full data stored in the memory of all BEs, may occupying a large amount, and it is necessary to weigh memory usage and query performance to choose an appropriate table to derive dictionary."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Reasonable Selection of Key Value Columns:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Choose columns with a moderate cardinality as keys"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Layout Selection:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use HASH_MAP layout for general scenarios"}),"\n",(0,r.jsx)(n.li,{children:"Use IP_TRIE layout for IP address range matching scenarios"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"State Management:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Regularly monitor the memory usage of dictionary tables"}),"\n",(0,r.jsx)(n.li,{children:"Select an appropriate data update interval and manually refresh the dictionary when data expires on the business side"}),"\n",(0,r.jsx)(n.li,{children:"When using dictionary tables, pay attention to the BE memory monitoring to prevent the dictionary tables from being too numerous or too large, occupying excessive memory and causing abnormal BE status."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"HASH_MAP"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Create source data table\nCREATE TABLE cities (\n    city_id INT NOT NULL,\n    city_name VARCHAR(32) NOT NULL,\n    region_code VARCHAR(32) NOT NULL\n) ENGINE=OLAP\nDISTRIBUTED BY HASH(city_id) BUCKETS 1;\n\nINSERT INTO cities VALUES\n(1, 'Beijing', 'BJ'),\n(2, 'Shanghai', 'SH'),\n(3, 'Guangzhou', 'GZ');\n\n-- Create dictionary table\nCREATE DICTIONARY city_code_dict USING cities\n(\n    city_name KEY,\n    region_code VALUE\n)\nLAYOUT(HASH_MAP)\nPROPERTIES('data_lifetime' = '600');\n\n-- Query using a dictionary table\nSELECT dict_get(\"test_refresh_dict.city_code_dict\", \"region_code\", \"Beijing\");\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"+------------------------------------------------------------------------+\n| dict_get('test_refresh_dict.city_code_dict', 'region_code', 'Beijing') |\n+------------------------------------------------------------------------+\n| BJ                                                                     |\n+------------------------------------------------------------------------+\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"IP_TRIE"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE ip_locations (\n    ip_range VARCHAR(30) NOT NULL,\n    country VARCHAR(64) NOT NULL,\n    region VARCHAR(64) NOT NULL,\n    city VARCHAR(64) NOT NULL\n) ENGINE=OLAP\nDISTRIBUTED BY HASH(ip_range) BUCKETS 1;\n\nINSERT INTO ip_locations VALUES\n('1.0.0.0/24', 'United States', 'California', 'Los Angeles'),\n('1.0.1.0/24', 'China', 'Beijing', 'Beijing'),\n('1.0.4.0/24', 'Japan', 'Tokyo', 'Tokyo');\n\n-- Create an IP address dictionary table\nCREATE DICTIONARY ip_location_dict USING ip_locations\n(\n    ip_range KEY,\n    country VALUE,\n    region VALUE,\n    city VALUE\n)\nLAYOUT(IP_TRIE)\nPROPERTIES('data_lifetime' = '600');\n\n-- Query the location information corresponding to the IP address, based on CIDR matching.\nSELECT\n    dict_get(\"test_refresh_dict.ip_location_dict\", \"country\", cast('1.0.0.1' as ipv4)) AS country,\n    dict_get(\"test_refresh_dict.ip_location_dict\", \"region\", cast('1.0.0.2' as ipv4)) AS region,\n    dict_get(\"test_refresh_dict.ip_location_dict\", \"city\", cast('1.0.0.3' as ipv4)) AS city;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"+---------------+------------+-------------+\n| country       | region     | city        |\n+---------------+------------+-------------+\n| United States | California | Los Angeles |\n+---------------+------------+-------------+\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"HASH_MAP with multi-key / multi-value"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Product SKU Dimension Table: Includes basic product attributes\nCREATE TABLE product_sku_info (\n    product_id INT NOT NULL COMMENT \"\u5546\u54C1ID\",\n    color_code VARCHAR(32) NOT NULL COMMENT \"\u989C\u8272\u7F16\u7801\",\n    size_code VARCHAR(32) NOT NULL COMMENT \"\u5C3A\u7801\u7F16\u7801\",\n    product_name VARCHAR(128) NOT NULL COMMENT \"\u5546\u54C1\u540D\u79F0\",\n    color_name VARCHAR(32) NOT NULL COMMENT \"\u989C\u8272\u540D\u79F0\",\n    size_name VARCHAR(32) NOT NULL COMMENT \"\u5C3A\u7801\u540D\u79F0\",\n    stock INT NOT NULL COMMENT \"\u5E93\u5B58\",\n    price DECIMAL(10,2) NOT NULL COMMENT \"\u4EF7\u683C\",\n    update_time DATETIME NOT NULL COMMENT \"\u66F4\u65B0\u65F6\u95F4\"\n)\nDISTRIBUTED BY HASH(`product_id`) BUCKETS 10;\n\n-- Order Details Table: Records actual sales data\nCREATE TABLE order_details (\n    order_id BIGINT NOT NULL COMMENT \"\u8BA2\u5355ID\",\n    product_id INT NOT NULL COMMENT \"\u5546\u54C1ID\",\n    color_code VARCHAR(32) NOT NULL COMMENT \"\u989C\u8272\u7F16\u7801\",\n    size_code VARCHAR(32) NOT NULL COMMENT \"\u5C3A\u7801\u7F16\u7801\",\n    quantity INT NOT NULL COMMENT \"\u8D2D\u4E70\u6570\u91CF\",\n    order_time DATETIME NOT NULL COMMENT \"\u4E0B\u5355\u65F6\u95F4\"\n)\nDISTRIBUTED BY HASH(`order_id`) BUCKETS 10;\n\n-- Insert product SKU data\nINSERT INTO product_sku_info VALUES\n(1001, 'BLK', 'M', 'Nike\u8FD0\u52A8T\u6064', '\u9ED1\u8272', 'M\u7801', 100, 199.00, '2024-02-23 10:00:00'),\n(1001, 'BLK', 'L', 'Nike\u8FD0\u52A8T\u6064', '\u9ED1\u8272', 'L\u7801', 80, 199.00, '2024-02-23 10:00:00'),\n(1001, 'WHT', 'M', 'Nike\u8FD0\u52A8T\u6064', '\u767D\u8272', 'M\u7801', 90, 199.00, '2024-02-23 10:00:00'),\n(1001, 'WHT', 'L', 'Nike\u8FD0\u52A8T\u6064', '\u767D\u8272', 'L\u7801', 70, 199.00, '2024-02-23 10:00:00'),\n(1002, 'RED', 'S', 'Adidas\u8FD0\u52A8\u88E4', '\u7EA2\u8272', 'S\u7801', 50, 299.00, '2024-02-23 10:00:00'),\n(1002, 'RED', 'M', 'Adidas\u8FD0\u52A8\u88E4', '\u7EA2\u8272', 'M\u7801', 60, 299.00, '2024-02-23 10:00:00'),\n(1002, 'BLU', 'S', 'Adidas\u8FD0\u52A8\u88E4', '\u84DD\u8272', 'S\u7801', 55, 299.00, '2024-02-23 10:00:00'),\n(1002, 'BLU', 'M', 'Adidas\u8FD0\u52A8\u88E4', '\u84DD\u8272', 'M\u7801', 65, 299.00, '2024-02-23 10:00:00');\n\n-- Insert order data\nINSERT INTO order_details VALUES\n(10001, 1001, 'BLK', 'M', 2, '2024-02-23 12:01:00'),\n(10002, 1001, 'WHT', 'L', 1, '2024-02-23 12:05:00'),\n(10003, 1002, 'RED', 'S', 1, '2024-02-23 12:10:00'),\n(10004, 1001, 'BLK', 'L', 3, '2024-02-23 12:15:00'),\n(10005, 1002, 'BLU', 'M', 2, '2024-02-23 12:20:00');\n\n-- Create a multi-key multi-value dictionary\nCREATE DICTIONARY sku_dict USING product_sku_info\n(\n    product_id KEY,\n    color_code KEY,\n    size_code KEY,\n    product_name VALUE,\n    color_name VALUE,\n    size_name VALUE,\n    price VALUE,\n    stock VALUE\n)\nLAYOUT(HASH_MAP)\nPROPERTIES('data_lifetime'='300');\n\n-- Query example using dict_get_many: Retrieve order details and SKU information\nWITH order_sku_info AS (\n    SELECT \n        o.order_id,\n        o.quantity,\n        o.order_time,\n        dict_get_many(\"test.sku_dict\", \n            [\"product_name\", \"color_name\", \"size_name\", \"price\", \"stock\"],\n            struct(o.product_id, o.color_code, o.size_code)\n        ) as sku_info\n    FROM order_details o\n    WHERE o.order_time >= '2024-02-23 12:00:00'\n        AND o.order_time < '2024-02-23 13:00:00'\n)\nSELECT \n    order_id,\n    order_time,\n    struct_element(sku_info, 'product_name') as product_name,\n    struct_element(sku_info, 'color_name') as color_name,\n    struct_element(sku_info, 'size_name') as size_name,\n    quantity,\n    struct_element(sku_info, 'price') as unit_price,\n    quantity * struct_element(sku_info, 'price') as total_amount,\n    struct_element(sku_info, 'stock') as current_stock\nFROM order_sku_info\nORDER BY order_time;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"+----------+---------------------+-----------------+------------+-----------+----------+------------+--------------+---------------+\n| order_id | order_time          | product_name    | color_name | size_name | quantity | unit_price | total_amount | current_stock |\n+----------+---------------------+-----------------+------------+-----------+----------+------------+--------------+---------------+\n|    10001 | 2024-02-23 12:01:00 | Nike\u8FD0\u52A8T\u6064     | \u9ED1\u8272       | M\u7801       |        2 |     199.00 |       398.00 |           100 |\n|    10002 | 2024-02-23 12:05:00 | Nike\u8FD0\u52A8T\u6064     | \u767D\u8272       | L\u7801       |        1 |     199.00 |       199.00 |            70 |\n|    10003 | 2024-02-23 12:10:00 | Adidas\u8FD0\u52A8\u88E4    | \u7EA2\u8272       | S\u7801       |        1 |     299.00 |       299.00 |            50 |\n|    10004 | 2024-02-23 12:15:00 | Nike\u8FD0\u52A8T\u6064     | \u9ED1\u8272       | L\u7801       |        3 |     199.00 |       597.00 |            80 |\n|    10005 | 2024-02-23 12:20:00 | Adidas\u8FD0\u52A8\u88E4    | \u84DD\u8272       | M\u7801       |        2 |     299.00 |       598.00 |            65 |\n+----------+---------------------+-----------------+------------+-----------+----------+------------+--------------+---------------+\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:'The query reports an error of "can not find dict name"'}),"\n",(0,r.jsxs)(n.p,{children:["Firstly, confirm the existence of the dictionary by using ",(0,r.jsx)(n.code,{children:"SHOW DICTIONARIES"}),". If it exists, refresh the corresponding dictionary data."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:'The query reports an error of "dict_get() only support IP type for IP_TRIE"'}),"\n",(0,r.jsx)(n.p,{children:"Confirm whether the Key column of the IP_TRIE type dictionary strictly meets to the CIDR format."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:'The importing reports an error of "Version ID is not greater than the existing version ID for the dictionary."'}),"\n",(0,r.jsxs)(n.p,{children:["Delete the corresponding dictionary using the ",(0,r.jsx)(n.code,{children:"DROP DICTIONARY"})," command, recreate it, and then import the data."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"SHOW DICTIONARIES"})," result shows that the dictionary is in a BE version greater than the FE version."]}),"\n",(0,r.jsxs)(n.p,{children:["Delete the corresponding dictionary using the ",(0,r.jsx)(n.code,{children:"DROP DICTIONARY"})," command, recreate it, and then import the data."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:['The importing reports an error of "Dictionary ',(0,r.jsx)(n.code,{children:"X"})," commit version ",(0,r.jsx)(n.code,{children:"Y"}),' failed"']}),"\n",(0,r.jsx)(n.p,{children:"Re-refresh the dictionary."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Contingency Strategy"}),"\n",(0,r.jsxs)(n.p,{children:["For the vast majority of error messages, if normal operation fails, rebuilding the dictionary after ",(0,r.jsx)(n.code,{children:"DROP"})," can resolve the issue."]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return o},a:function(){return s}});var t=i(667294);let r={},a=t.createContext(r);function s(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);