"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["370404"],{454375:function(e,n,r){r.r(n),r.d(n,{default:()=>m,frontMatter:()=>l,metadata:()=>a,assets:()=>u,toc:()=>c,contentTitle:()=>i});var a=JSON.parse('{"id":"sql-manual/sql-functions/scalar-functions/array-functions/array-cum-sum","title":"ARRAY_CUM_SUM","description":"Calculates the cumulative sum of an array. The function traverses the array from left to right,","source":"@site/docs/sql-manual/sql-functions/scalar-functions/array-functions/array-cum-sum.md","sourceDirName":"sql-manual/sql-functions/scalar-functions/array-functions","slug":"/sql-manual/sql-functions/scalar-functions/array-functions/array-cum-sum","permalink":"/docs/dev/sql-manual/sql-functions/scalar-functions/array-functions/array-cum-sum","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"ARRAY_CUM_SUM","language":"en","description":"Calculates the cumulative sum of an array. The function traverses the array from left to right,"},"sidebar":"docs","previous":{"title":"ARRAY_COUNT","permalink":"/docs/dev/sql-manual/sql-functions/scalar-functions/array-functions/array-count"},"next":{"title":"ARRAY_DIFFERENCE","permalink":"/docs/dev/sql-manual/sql-functions/scalar-functions/array-functions/array-difference"}}'),t=r("785893"),s=r("250065");let l={title:"ARRAY_CUM_SUM",language:"en",description:"Calculates the cumulative sum of an array. The function traverses the array from left to right,"},i=void 0,u={},c=[{value:"array_cum_sum",id:"array_cum_sum",level:2},{value:"Description",id:"description",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Return Value",id:"return-value",level:3},{value:"Examples",id:"examples",level:3},{value:"Keywords",id:"keywords",level:3}];function o(e){let n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",version:"version",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"array_cum_sum",children:"array_cum_sum"}),"\n",(0,t.jsx)(n.version,{since:"2.0.0",children:"\n"}),"\n",(0,t.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,t.jsx)(n.p,{children:"Calculates the cumulative sum of an array. The function traverses the array from left to right, calculating the sum of all elements from the beginning to the current position (including the current position), and returns a new array with the same length as the original array."}),"\n",(0,t.jsx)(n.h2,{id:"syntax",children:"Syntax"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"array_cum_sum(ARRAY<T> arr)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"arr"}),"\uFF1AARRAY<T> type, the array to calculate cumulative sum for. Supports column names or constant values."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"T supported types:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Numeric types: TINYINT, SMALLINT, INT, BIGINT, LARGEINT\uFF0CFLOAT, DOUBLE\uFF0CDECIMAL"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"return-value",children:"Return Value"}),"\n",(0,t.jsx)(n.p,{children:"Return type: ARRAY<T>"}),"\n",(0,t.jsx)(n.p,{children:"Return value meaning:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Returns a new array with the same length as the input array, where each position contains the sum of all elements from the beginning to the current position in the original array"}),"\n",(0,t.jsx)(n.li,{children:"NULL: if the input array is NULL"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Usage notes:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If the array contains other types (such as strings etc.), it will attempt to convert elements to DOUBLE type. Elements that fail conversion will result in null."}),"\n",(0,t.jsxs)(n.li,{children:["The function will attempt to convert all elements to compatible numeric types for cumulative sum calculation\uFF0CThe return type of the cumulative sum is automatically selected based on the input type:\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"When input is DOUBLE or FLOAT, returns ARRAY<DOUBLE>"}),"\n",(0,t.jsx)(n.li,{children:"When input is integer type, returns ARRAY<BIGINT> or ARRAY<LARGEINT>"}),"\n",(0,t.jsx)(n.li,{children:"When input is DECIMAL, returns ARRAY<DECIMAL>, maintaining original precision and scale"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"The cumulative sum calculation order is from left to right, where each position contains the sum of all non-null elements before it."}),"\n",(0,t.jsx)(n.li,{children:"Empty array returns empty array, NULL array returns NULL, array with only one element returns the original array."}),"\n",(0,t.jsx)(n.li,{children:"Nested arrays, MAP, STRUCT and other complex types do not support cumulative sum, calling will result in an error."}),"\n",(0,t.jsx)(n.li,{children:"For null values in array elements: Starting from the first non-null value, the null after the cumulative value will be used as 0 to participate in the cumulative sum calculation."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE array_cum_sum_test (\n    id INT,\n    int_array ARRAY<INT>,\n    double_array ARRAY<DOUBLE>\n)\nDUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 3\nPROPERTIES (\n    "replication_num" = "1"\n);\n\nINSERT INTO array_cum_sum_test VALUES\n(1, [1, 2, 3, 4, 5], [1.1, 2.2, 3.3, 4.4, 5.5]),\n(2, [10, 20, 30], [10.5, 20.5, 30.5]),\n(3, [], []),\n(4, NULL, NULL);\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Query examples:"})}),"\n",(0,t.jsx)(n.p,{children:"Cumulative sum of int_array: each position contains the sum of all elements from the beginning to the current position (including the current position)."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum(int_array) FROM array_cum_sum_test WHERE id = 1;\n+-----------------------------+\n| array_cum_sum(int_array)    |\n+-----------------------------+\n| [1, 3, 6, 10, 15]           |\n+-----------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"Cumulative sum of double_array: cumulative sum of floating-point array, result is floating-point."}),"\n",(0,t.jsx)(n.p,{children:'Note that the result at the second position is 3.3000000000000003, which is due to the small error caused by floating-point binary representation precision. 1.1 and 2.2 cannot be precisely represented in binary floating-point (IEEE 754 double), they can only be stored approximately. After adding them together, the error accumulates, resulting in 3.3000000000000003. Subsequent cumulative sums (such as 6.6, 11, 16.5) may appear as "normal values", but they are actually approximate values, just that they match the decimal after rounding. This is a phenomenon that all systems based on IEEE 754 floating-point (including MySQL, Snowflake, Python, JavaScript, etc.) will encounter.'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum(double_array) FROM array_cum_sum_test WHERE id = 1;\n+------------------------------------------+\n| array_cum_sum(double_array)              |\n+------------------------------------------+\n| [1.1, 3.3000000000000003, 6.6, 11, 16.5] |\n+------------------------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"When mixing strings and numbers, elements that can be converted to numbers will participate in the cumulative sum, those that cannot be converted will be null, and the null value be treated as 0 in the cumulative sum calculation."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum(['a', 1, 'b', 2, 'c', 3]);\n+-----------------------------------------+\n| array_cum_sum(['a', 1, 'b', 2, 'c', 3]) |\n+-----------------------------------------+\n| [0, 1, 1, 3, 3, 6]                      |\n+-----------------------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"Empty array returns empty array:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum(int_array) FROM array_cum_sum_test WHERE id = 3;\n+-----------------------------+\n| array_cum_sum(int_array)    |\n+-----------------------------+\n| []                          |\n+-----------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"NULL array returns NULL: returning NULL when the input array is NULL without throwing an error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum(int_array) FROM array_cum_sum_test WHERE id = 4;\n+-----------------------------+\n| array_cum_sum(int_array)    |\n+-----------------------------+\n| NULL                        |\n+-----------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"Array with only one element returns the original array:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum([42]);\n+----------------------+\n| array_cum_sum([42])  |\n+----------------------+\n| [42]                 |\n+----------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"Array containing null values, starting from the first non-null value, the null after the cumulative value will be used as 0 to participate in the cumulative sum calculation."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum([null, 1, null, 3, null, 5]);\n+--------------------------------------------+\n| array_cum_sum([null, 1, null, 3, null, 5]) |\n+--------------------------------------------+\n| [null, 1, 1, 4, 4, 9]                      |\n+--------------------------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"Complex type examples:"}),"\n",(0,t.jsx)(n.p,{children:"Nested array type not supported, throws error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum([[1,2,3]]);\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not find the compatibility function signature: array_cum_sum(ARRAY<ARRAY<TINYINT>>)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Map type not supported, throws error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum([{'k':1},{'k':2}]);\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not find the compatibility function signature: array_cum_sum(ARRAY<MAP<VARCHAR(1),TINYINT>>)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Struct type not supported, throws error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum(array(named_struct('name','Alice','age',20),named_struct('name','Bob','age',30)));\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not find the compatibility function signature: array_cum_sum(ARRAY<STRUCT<name:TEXT,age:TINYINT>>)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Incorrect number of parameters will cause an error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum([1,2,3],[4,5,6]);\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not found function 'array_cum_sum' which has 2 arity. Candidate functions are: [array_cum_sum(Expression)]\n"})}),"\n",(0,t.jsx)(n.p,{children:"Passing non-array type will cause an error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_cum_sum('not_an_array');\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not find the compatibility function signature: array_cum_sum(VARCHAR(12))\n"})}),"\n",(0,t.jsx)(n.h3,{id:"keywords",children:"Keywords"}),"\n",(0,t.jsx)(n.p,{children:"ARRAY, CUM, SUM, CUM_SUM, ARRAY_CUM_SUM"})]})}function m(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return i},a:function(){return l}});var a=r(667294);let t={},s=a.createContext(t);function l(e){let n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);