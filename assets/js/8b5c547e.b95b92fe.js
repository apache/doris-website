"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["238983"],{65410:function(e,n,r){r.r(n),r.d(n,{default:()=>h,frontMatter:()=>s,metadata:()=>i,assets:()=>c,toc:()=>l,contentTitle:()=>o});var i=JSON.parse('{"id":"ai/vector-search/performance","title":"Performance Testing and Analysis","description":"This document introduces the query and ingestion performance of Doris ANN Index. All benchmarks are conducted using VectorDBBench.","source":"@site/versioned_docs/version-4.x/ai/vector-search/performance.md","sourceDirName":"ai/vector-search","slug":"/ai/vector-search/performance","permalink":"/docs/4.x/ai/vector-search/performance","draft":false,"unlisted":false,"tags":[],"version":"4.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Performance Testing and Analysis","language":"en","description":"This document introduces the query and ingestion performance of Doris ANN Index. All benchmarks are conducted using VectorDBBench."},"sidebar":"docs","previous":{"title":"ANN Index Management","permalink":"/docs/4.x/ai/vector-search/index-management"},"next":{"title":"Optimizations Behind Performance","permalink":"/docs/4.x/ai/vector-search/behind-index"}}'),t=r("785893"),a=r("250065");let s={title:"Performance Testing and Analysis",language:"en",description:"This document introduces the query and ingestion performance of Doris ANN Index. All benchmarks are conducted using VectorDBBench."},o=void 0,c={},l=[{value:"Test Environment",id:"test-environment",level:2},{value:"Results",id:"results",level:2},{value:"Analysis",id:"analysis",level:2},{value:"Reproduction",id:"reproduction",level:2}];function d(e){let n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["This document introduces the query and ingestion performance of Doris ANN Index. All benchmarks are conducted using ",(0,t.jsx)(n.a,{href:"https://github.com/zilliztech/VectorDBBench",children:"VectorDBBench"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"test-environment",children:"Test Environment"}),"\n",(0,t.jsx)(n.p,{children:"All machines used in the tests have 16 CPU cores and 64 GB memory, with CPUs of model Intel(R) Xeon(R) Platinum 8369B CPU @ 2.70GHz. FE and BE are co-located on a single 16C64GB machine (note: this is not a recommended production deployment; in production, FE and BE should be deployed separately). The tested version is Apache Doris 4.0.2. The dataset used is VectorDBBench Performance768D1M, which contains 1 million vectors of 768 dimensions."}),"\n",(0,t.jsx)(n.h2,{id:"results",children:"Results"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"performance",src:r(405214).Z+"",width:"1370",height:"1584"})}),"\n",(0,t.jsx)(n.h2,{id:"analysis",children:"Analysis"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"                    \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502        Recall        \u2502\n                    \u2502  (Higher is Better)  \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25B2\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                               / \\\n                              /   \\\n                             /     \\\n                            /       \\\n                           /         \\\n                          /           \\\n             \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n             \u2502                                     \u2502\n             \u2502                                     \u2502\n             \u25BC                                     \u25BC\n \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n \u2502        Query QPS     \u2502                 \u2502    Indexing Throughput \u2502\n \u2502   (Latency / QPS)    \u2502                 \u2502    (Higher is Better)  \u2502\n \u2502 (Lower Latency Better)\u2502                \u2502                         \u2502\n \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.p,{children:"In vector search, a production-ready vector database typically faces a performance \u201Ctriangle\u201D that is hard to maximize across all dimensions simultaneously: query performance (QPS/latency), recall, and indexing throughput. System design often requires trade-offs among these three."}),"\n",(0,t.jsx)(n.p,{children:"Take HNSW (Hierarchical Navigable Small World), the most widely used vector index, as an example. It relies on graph structures to optimize search. There are three key tunable hyperparameters in HNSW:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"max_degree: The maximum out-degree of each node in the graph, determining graph density and connectivity."}),"\n",(0,t.jsx)(n.li,{children:"ef_construction: The candidate set size used during index building. Larger values generally result in higher-quality graphs."}),"\n",(0,t.jsx)(n.li,{children:"hnsw_ef_search: The exploration window size during query time, directly affecting recall and latency."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"In principle, increasing max_degree and ef_construction during index building can significantly improve graph connectivity and navigability, yielding higher recall. A higher-quality graph also allows a smaller hnsw_ef_search at query time, reducing search cost and improving query performance. However, these index-building parameter increases come with trade-offs: index construction requires more compute and memory resources, leading to lower ingestion performance. This is the quintessential trilemma in vector database design."}),"\n",(0,t.jsx)(n.p,{children:"Apache Doris aims to build a more balanced performance triangle for vector search. Through optimizations in the execution engine, storage format improvements, and engineering-level parallel acceleration of HNSW construction, Doris significantly improves overall indexing throughput without sacrificing index quality or high recall."}),"\n",(0,t.jsx)(n.p,{children:"On the Performance768D1M dataset, results show that, under comparable index quality, Apache Doris exhibits notably better ingestion performance than peer systems. More importantly, Doris does not compromise graph quality to gain ingestion speed. In our tests, Apache Doris achieves a QPS of 989.1 while maintaining over 97% recall, striking a strong balance across all three dimensions of the performance triangle."}),"\n",(0,t.jsx)(n.h2,{id:"reproduction",children:"Reproduction"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"NUM_PER_BATCH=500000 vectordbbench doris --host 127.0.0.1 --port 9030 --http-port 8030 --case-type Performance768D1M --db-name vdb --num-concurrency 80 --stream-load-rows-per-batch 500000 --index-prop max_degree=128,ef_construction=256 --session-var hnsw_ef_search=100\n"})})]})}function h(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},405214:function(e,n,r){r.d(n,{Z:function(){return i}});let i=r.p+"assets/images/ann_index_performance_0-da29243f8b5696281efc0413c763d5fa.jpg"},250065:function(e,n,r){r.d(n,{Z:function(){return o},a:function(){return s}});var i=r(667294);let t={},a=i.createContext(t);function s(e){let n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);