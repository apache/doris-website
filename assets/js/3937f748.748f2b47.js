"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["217465"],{421031:function(e,n,r){r.r(n),r.d(n,{default:()=>h,frontMatter:()=>t,metadata:()=>s,assets:()=>o,toc:()=>d,contentTitle:()=>c});var s=JSON.parse('{"id":"compute-storage-decoupled/upgrade","title":"Upgrade","description":"This guide provides step-by-step instructions for upgrading Doris using a storage-compute decoupling architecture (a.k.a. Cloud Mode).","source":"@site/versioned_docs/version-4.x/compute-storage-decoupled/upgrade.md","sourceDirName":"compute-storage-decoupled","slug":"/compute-storage-decoupled/upgrade","permalink":"/docs/4.x/compute-storage-decoupled/upgrade","draft":false,"unlisted":false,"tags":[],"version":"4.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Upgrade","language":"en","description":"This guide provides step-by-step instructions for upgrading Doris using a storage-compute decoupling architecture (a.k.a. Cloud Mode)."},"sidebar":"docs","previous":{"title":"Recycler","permalink":"/docs/4.x/compute-storage-decoupled/recycler"},"next":{"title":"Security Overview","permalink":"/docs/4.x/admin-manual/auth/security-overview"}}'),i=r("785893"),a=r("250065");let t={title:"Upgrade",language:"en",description:"This guide provides step-by-step instructions for upgrading Doris using a storage-compute decoupling architecture (a.k.a. Cloud Mode)."},c=void 0,o={},d=[{value:"Overview",id:"overview",level:2},{value:"Doris Version Description",id:"doris-version-description",level:2},{value:"Upgrade Steps",id:"upgrade-steps",level:2},{value:"Upgrade Instructions",id:"upgrade-instructions",level:3},{value:"Overview of the Upgrade Process",id:"overview-of-the-upgrade-process",level:3},{value:"Upgrade Pre-work",id:"upgrade-pre-work",level:3},{value:"Upgrade Process",id:"upgrade-process",level:3},{value:"1. Upgrade MetaService",id:"1-upgrade-metaservice",level:4},{value:"2. Upgrade Recycler (if have)",id:"2-upgrade-recycler-if-have",level:4},{value:"3. Upgrade BE",id:"3-upgrade-be",level:4},{value:"4. Upgrade FE",id:"4-upgrade-fe",level:4},{value:"FAQ",id:"faq",level:2}];function l(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["This guide provides step-by-step instructions for upgrading Doris using a storage-compute decoupling architecture (a.k.a. Cloud Mode). Upgrades should be performed using the recommended steps in this section for cluster upgrades. Doris cluster upgrades can be carried out using a ",(0,i.jsx)(n.strong,{children:"rolling upgrade"})," method, which does not require all cluster nodes to be shut down for the upgrade, greatly minimizing the impact on applications."]}),"\n",(0,i.jsx)(n.h2,{id:"doris-version-description",children:"Doris Version Description"}),"\n",(0,i.jsx)(n.p,{children:"Doris uses a three numbers separated by dots version format, which can be viewed using the following SQL:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"MySQL [(none)]> select @@version_comment;\n+--------------------------------------------------------+\n| @@version_comment                                      |\n+--------------------------------------------------------+\n| Doris version doris-3.0.3-rc03-43f06a5e26 (Cloud Mode) |\n+--------------------------------------------------------+\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["The 1st number in ",(0,i.jsx)(n.code,{children:"3.0.3"})," represents the major version number, the 2nd number represents the minor version number, and the 3rd number represents the patch version number. In some cases, the version number may become a 4-numbers format, such as ",(0,i.jsx)(n.code,{children:"2.0.2.1"}),", where the last number indicates an emergency bug fix version, which usually means that this patch version has some significant bugs."]}),"\n",(0,i.jsxs)(n.p,{children:["Doris has supported cloud mode deployment since version ",(0,i.jsx)(n.code,{children:"3.0.0"}),". When deployed in this mode, the version number will have a Cloud Mode suffix. If started in the integrated storage and compute (a.k.a. Local) mode, there will be no such suffix."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Once Doris is deployed in cloud mode, it does not support switching back to local mode. Similarly, Doris in local mode does not support switching to cloud mode."}),"\n",(0,i.jsx)(n.p,{children:"In principle, Doris supports upgrading from a lower version to a higher version and downgrading between patch versions. Downgrading between minor or major versions is not allowed."}),"\n",(0,i.jsx)(n.h2,{id:"upgrade-steps",children:"Upgrade Steps"}),"\n",(0,i.jsx)(n.h3,{id:"upgrade-instructions",children:"Upgrade Instructions"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Make sure that your Doris is started in cloud mode. If you are not sure about the current deployment mode of Doris, refer to the instructions in the ",(0,i.jsx)(n.a,{href:"#doris-version-description",children:"previous section"}),".\nFor Doris in local mode, refer to ",(0,i.jsx)(n.a,{href:"../admin-manual/cluster-management/upgrade",children:"Cluster Upgrade"})," for upgrade steps."]}),"\n",(0,i.jsx)(n.li,{children:"Make sure that your Doris data import tasks have a retry mechanism to avoid task failures due to node restarts during the upgrade process."}),"\n",(0,i.jsx)(n.li,{children:"Before upgrading, we recommend checking the status of all Doris components (MetaService, Recycler, Frontend and Backend) to ensure they are operating normally and without exception logs to avoid affecting the upgrade process."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"overview-of-the-upgrade-process",children:"Overview of the Upgrade Process"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Metadata backup"}),"\n",(0,i.jsx)(n.li,{children:"Upgrade MetaService"}),"\n",(0,i.jsx)(n.li,{children:"Upgrade Recycler (if have)"}),"\n",(0,i.jsx)(n.li,{children:"Upgrade BE"}),"\n",(0,i.jsxs)(n.li,{children:["Upgrade FE\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Upgrade Observer FE first"}),"\n",(0,i.jsx)(n.li,{children:"Then upgrade other non-Master FE"}),"\n",(0,i.jsx)(n.li,{children:"Finally, upgrade Master FE"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"upgrade-pre-work",children:"Upgrade Pre-work"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Backup the metadata directory of the Master FE. Usually, the metadata directory is the ",(0,i.jsx)(n.code,{children:"doris-meta"})," directory under the FE home directory. If this directory is empty, it means that you had set another directory to save metadata. You can search for the ",(0,i.jsx)(n.code,{children:"meta_dir"})," in the FE configuration file (conf/fe.conf)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/download",children:"Download"})," the package from the Doris official website. It is recommended to verify the SHA-512 hash to ensure that the package matches the one provided by Doris."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"upgrade-process",children:"Upgrade Process"}),"\n",(0,i.jsx)(n.h4,{id:"1-upgrade-metaservice",children:"1. Upgrade MetaService"}),"\n",(0,i.jsx)(n.p,{children:"Assuming the following environment variables:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"${MS_HOME}"}),": Working directory of MetaService."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"${MS_PACKAGE_DIR}"}),": Directory containing the new MetaService package."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Follow these steps to upgrade each MetaService instance."}),"\n",(0,i.jsx)(n.p,{children:"1.1. Stop the current MetaService:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"cd ${MS_HOME}\nsh bin/stop.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"1.2. Backup the existing MetaService binaries:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"mv ${MS_HOME}/bin bin_backup_$(date +%Y%m%d_%H%M%S)\nmv ${MS_HOME}/lib lib_backup_$(date +%Y%m%d_%H%M%S)\n"})}),"\n",(0,i.jsx)(n.p,{children:"1.3. Deploy the new package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"cp ${MS_PACKAGE_DIR}/bin ${MS_HOME}/bin\ncp ${MS_PACKAGE_DIR}/lib ${MS_HOME}/lib\n"})}),"\n",(0,i.jsx)(n.p,{children:"1.4. Start the new MetaService:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sh ${MS_HOME}/bin/start.sh --daemon\n"})}),"\n",(0,i.jsx)(n.p,{children:"1.5. Check status of the new MetaService:"}),"\n",(0,i.jsxs)(n.p,{children:["Verify that the new MetaService is running and that a new version number is present in ",(0,i.jsx)(n.code,{children:"${MS_HOME}/log/doris_cloud.out"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"2-upgrade-recycler-if-have",children:"2. Upgrade Recycler (if have)"}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsx)(n.p,{children:"If you have not deployed the Recycler component separately, you can skip this step."})}),"\n",(0,i.jsx)(n.p,{children:"Assuming the following environment variables:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"${RECYCLER_HOME}"}),": Working directory of Recycler"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"${MS_PACKAGE_DIR}"}),": Directory containing the new MetaService package, MetaService and Recycler use same package."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Upgrade each Recycler instance by following these steps."}),"\n",(0,i.jsx)(n.p,{children:"2.1. Stop the current Recycler:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"cd ${RECYCLER_HOME}\nsh bin/stop.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"2.2. Backup existing Recycler binary files:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"mv ${RECYCLER_HOME}/bin bin_backup_$(date +%Y%m%d_%H%M%S)\nmv ${RECYCLER_HOME}/lib lib_backup_$(date +%Y%m%d_%H%M%S)\n"})}),"\n",(0,i.jsx)(n.p,{children:"2.3. Deploy the new package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"cp ${RECYCLER_PACKAGE_DIR}/bin ${RECYCLER_HOME}/bin\ncp ${RECYCLER_PACKAGE_DIR}/lib ${RECYCLER_HOME}/lib\n"})}),"\n",(0,i.jsx)(n.p,{children:"2.4. Start the new Recycler:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sh ${RECYCLER_HOME}/bin/start.sh --recycler --daemon\n"})}),"\n",(0,i.jsx)(n.p,{children:"2.5. Check status of the new Recycler:"}),"\n",(0,i.jsxs)(n.p,{children:["Verify that the new MetaService is running and that a new version number is present in ",(0,i.jsx)(n.code,{children:"${RECYCLER_HOME}/log/doris_cloud.out"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"3-upgrade-be",children:"3. Upgrade BE"}),"\n",(0,i.jsx)(n.p,{children:"Verify that all instances of MetaService and Recycler (if installed separately) have been upgraded."}),"\n",(0,i.jsx)(n.p,{children:"Assuming the following environment variables:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"${BE_HOME}"}),": Working directory of BE."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"${BE_PACKAGE_DIR}"}),": Directory containing the new BE package."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Upgrade each BE instance by following these steps."}),"\n",(0,i.jsx)(n.p,{children:"3.1. Stop the current BE:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"cd ${BE_HOME}\nsh bin/stop_be.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"3.2. Backup the existing BE binaries:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"mv ${BE_HOME}/bin bin_backup_$(date +%Y%m%d_%H%M%S)\nmv ${BE_HOME}/lib lib_backup_$(date +%Y%m%d_%H%M%S)\n"})}),"\n",(0,i.jsx)(n.p,{children:"3.3. Deploy the new package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"cp ${BE_PACKAGE_DIR}/bin ${BE_HOME}/bin\ncp ${BE_PACKAGE_DIR}/lib ${BE_HOME}/lib\n"})}),"\n",(0,i.jsx)(n.p,{children:"3.4. Start the new BE:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sh ${BE_HOME}/bin/start_be.sh --daemon\n"})}),"\n",(0,i.jsx)(n.p,{children:"3.5. Check status of the new BE:"}),"\n",(0,i.jsx)(n.p,{children:"Confirm that the new BE is running and operational with the new version. The status and version can be obtained using the following SQL."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"show backends;\n"})}),"\n",(0,i.jsx)(n.h4,{id:"4-upgrade-fe",children:"4. Upgrade FE"}),"\n",(0,i.jsx)(n.p,{children:"Verify that all instances of BE have been upgraded."}),"\n",(0,i.jsx)(n.p,{children:"Assuming the following environment variables:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"${FE_HOME}"}),": Working directory of FE."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"${FE_PACKAGE_DIR}"}),": Directory containing the new FE package."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Upgrade the Frontend (FE) instances in the following order:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Observer FE nodes"}),"\n",(0,i.jsx)(n.li,{children:"Non-master FE nodes"}),"\n",(0,i.jsx)(n.li,{children:"Master FE node"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Upgrade each Frontend (FE) node by following these steps."}),"\n",(0,i.jsx)(n.p,{children:"4.1. Stop the current FE:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"cd ${FE_HOME}\nsh bin/stop_fe.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"4.2. Backup the existing FE binaries:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"mv ${FE_HOME}/bin bin_backup_$(date +%Y%m%d_%H%M%S)\nmv ${FE_HOME}/lib lib_backup_$(date +%Y%m%d_%H%M%S)\n"})}),"\n",(0,i.jsx)(n.p,{children:"4.3. Deploy the new package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"cp ${FE_PACKAGE_DIR}/bin ${FE_HOME}/bin\ncp ${FE_PACKAGE_DIR}/lib ${FE_HOME}/lib\n"})}),"\n",(0,i.jsx)(n.p,{children:"4.4. Start the new FE:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sh ${FE_HOME}/bin/start_fe.sh --daemon\n"})}),"\n",(0,i.jsx)(n.p,{children:"4.5. Check status of the new FE:"}),"\n",(0,i.jsx)(n.p,{children:"Confirm that the new FE is running and operational with the new version. The status and version can be obtained using the following SQL."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"show frontends;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Does Doris in local mode need to turn off the replica balance function before upgrading, and is it necessary for clusters in cloud mode?"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"No. Because in cloud mode, the data is stored on HDFS or S3 services, so there is no need for replica balancing."}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"With a separate MetaService providing metadata services, why is it still necessary to backup metadata for FE?"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Because currently, MetaService saves some metadata, and FE also saves some metadata. For safety reasons, we recommend backing up the metadata for FE."})]})}function h(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return c},a:function(){return t}});var s=r(667294);let i={},a=s.createContext(i);function t(e){let n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);