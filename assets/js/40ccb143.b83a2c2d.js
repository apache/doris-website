"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["654205"],{903682:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>o,metadata:()=>r,assets:()=>a,toc:()=>d,contentTitle:()=>l});var r=JSON.parse('{"id":"faq/load-faq","title":"Load FAQ","description":"Problem Description: Data quality error during loading.","source":"@site/versioned_docs/version-3.x/faq/load-faq.md","sourceDirName":"faq","slug":"/faq/load-faq","permalink":"/docs/3.x/faq/load-faq","draft":false,"unlisted":false,"tags":[],"version":"3.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Load FAQ","language":"en","description":"Problem Description: Data quality error during loading."},"sidebar":"docs","previous":{"title":"Data Integrity FAQ","permalink":"/docs/3.x/faq/correctness-faq"},"next":{"title":"Overview","permalink":"/docs/3.x/sql-manual/basic-element/sql-data-types/data-type-overview"}}'),i=t("785893"),s=t("250065");let o={title:"Load FAQ",language:"en",description:"Problem Description: Data quality error during loading."},l=void 0,a={},d=[{value:"General Load FAQ",id:"general-load-faq",level:2},{value:"Error &quot;[DATA_QUALITY_ERROR] Encountered unqualified data&quot;",id:"error-data_quality_error-encountered-unqualified-data",level:3},{value:"Error &quot;[E-235] Failed to init rowset builder&quot;",id:"error-e-235-failed-to-init-rowset-builder",level:3},{value:"Error &quot;[E-238] Too many segments in rowset&quot;",id:"error-e-238-too-many-segments-in-rowset",level:3},{value:"Error &quot;Transaction commit successfully, BUT data will be visible later&quot;",id:"error-transaction-commit-successfully-but-data-will-be-visible-later",level:3},{value:"Error &quot;Failed to commit kv txn [...] Transaction exceeds byte limit&quot;",id:"error-failed-to-commit-kv-txn--transaction-exceeds-byte-limit",level:3},{value:"Extra &quot;\\r&quot; in the last column of CSV file",id:"extra-r-in-the-last-column-of-csv-file",level:3},{value:"CSV data with quotes imported as null",id:"csv-data-with-quotes-imported-as-null",level:3},{value:"Stream Load",id:"stream-load",level:2},{value:"Reasons for Slow Loading",id:"reasons-for-slow-loading",level:3},{value:"Handling Special Characters in Column Names",id:"handling-special-characters-in-column-names",level:3},{value:"Routine Load",id:"routine-load",level:2},{value:"Major Bug Fixes",id:"major-bug-fixes",level:3},{value:"Default Configuration Optimizations",id:"default-configuration-optimizations",level:3},{value:"Observability Optimizations",id:"observability-optimizations",level:3},{value:"Error &quot;failed to get latest offset&quot;",id:"error-failed-to-get-latest-offset",level:3},{value:"Error &quot;failed to get partition meta: Local:&#39;Broker transport failure&quot;",id:"error-failed-to-get-partition-meta-localbroker-transport-failure",level:3},{value:"Error &quot;Broker: Offset out of range&quot;",id:"error-broker-offset-out-of-range",level:3}];function c(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"general-load-faq",children:"General Load FAQ"}),"\n",(0,i.jsx)(n.h3,{id:"error-data_quality_error-encountered-unqualified-data",children:'Error "[DATA_QUALITY_ERROR] Encountered unqualified data"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem Description"}),": Data quality error during loading."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Stream Load and Insert Into operations will return an error URL, while for Broker Load you can check the error URL through the ",(0,i.jsx)(n.code,{children:"Show Load"})," command."]}),"\n",(0,i.jsx)(n.li,{children:"Use a browser or curl command to access the error URL to view the specific data quality error reasons."}),"\n",(0,i.jsx)(n.li,{children:"Use the strict_mode and max_filter_ratio parameters to control the acceptable error rate."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"error-e-235-failed-to-init-rowset-builder",children:'Error "[E-235] Failed to init rowset builder"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem Description"}),": Error -235 occurs when the load frequency is too high and data hasn't been compacted in time, exceeding version limits."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Increase the batch size of data loading and reduce loading frequency."}),"\n",(0,i.jsxs)(n.li,{children:["Increase the ",(0,i.jsx)(n.code,{children:"max_tablet_version_num"})," parameter in ",(0,i.jsx)(n.code,{children:"be.conf"}),", it is recommended not to exceed 5000."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"error-e-238-too-many-segments-in-rowset",children:'Error "[E-238] Too many segments in rowset"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem Description"}),": Error -238 occurs when the number of segments under a single rowset exceeds the limit."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Common Causes"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The bucket number configured during table creation is too small."}),"\n",(0,i.jsx)(n.li,{children:"Data skew occurs; consider using more balanced bucket keys."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"error-transaction-commit-successfully-but-data-will-be-visible-later",children:'Error "Transaction commit successfully, BUT data will be visible later"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem Description"}),": Data load is successful but temporarily not visible."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause"}),": Usually due to transaction publish delay caused by system resource pressure."]}),"\n",(0,i.jsx)(n.h3,{id:"error-failed-to-commit-kv-txn--transaction-exceeds-byte-limit",children:'Error "Failed to commit kv txn [...] Transaction exceeds byte limit"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem Description"}),": In shared-nothing mode, too many partitions and tablets are involved in a single load, exceeding the transaction size limit."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Load data by partition in batches to reduce the number of partitions involved in a single load."}),"\n",(0,i.jsx)(n.li,{children:"Optimize table structure to reduce the number of partitions and tablets."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"extra-r-in-the-last-column-of-csv-file",children:'Extra "\\r" in the last column of CSV file'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem Description"}),": Usually caused by Windows line endings."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":\nSpecify the correct line delimiter: ",(0,i.jsx)(n.code,{children:'-H "line_delimiter:\\r\\n"'})]}),"\n",(0,i.jsx)(n.h3,{id:"csv-data-with-quotes-imported-as-null",children:"CSV data with quotes imported as null"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem Description"}),": CSV data with quotes becomes null after import."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":\nUse the ",(0,i.jsx)(n.code,{children:"trim_double_quotes"})," parameter to remove double quotes around fields."]}),"\n",(0,i.jsx)(n.h2,{id:"stream-load",children:"Stream Load"}),"\n",(0,i.jsx)(n.h3,{id:"reasons-for-slow-loading",children:"Reasons for Slow Loading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Bottlenecks in CPU, IO, memory, or network card resources."}),"\n",(0,i.jsx)(n.li,{children:"Slow network between client machine and BE machines, can be initially diagnosed through ping latency from client to BE machines."}),"\n",(0,i.jsx)(n.li,{children:"Webserver thread count bottleneck, too many concurrent Stream Loads on a single BE (exceeding be.conf webserver_num_workers configuration) may cause thread count bottleneck."}),"\n",(0,i.jsx)(n.li,{children:"Memtable Flush thread count bottleneck, check BE metrics doris_be_flush_thread_pool_queue_size to see if queuing is severe. Can be resolved by increasing the be.conf flush_thread_num_per_store parameter."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"handling-special-characters-in-column-names",children:"Handling Special Characters in Column Names"}),"\n",(0,i.jsx)(n.p,{children:"When column names contain special characters, use single quotes with backticks to specify the columns parameter:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'curl --location-trusted -u root:"" \\\n    -H \'columns:`@coltime`,colint,colvar\' \\\n    -T a.csv \\\n    -H "column_separator:," \\\n    http://127.0.0.1:8030/api/db/loadtest/_stream_load\n'})}),"\n",(0,i.jsx)(n.h2,{id:"routine-load",children:"Routine Load"}),"\n",(0,i.jsx)(n.h3,{id:"major-bug-fixes",children:"Major Bug Fixes"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Issue Description"}),(0,i.jsx)(n.th,{children:"Trigger Conditions"}),(0,i.jsx)(n.th,{children:"Impact Scope"}),(0,i.jsx)(n.th,{children:"Temporary Solution"}),(0,i.jsx)(n.th,{children:"Affected Versions"}),(0,i.jsx)(n.th,{children:"Fixed Versions"}),(0,i.jsx)(n.th,{children:"Fix PR"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"When at least one job times out while connecting to Kafka, it affects the import of other jobs, slowing down global Routine Load imports."}),(0,i.jsx)(n.td,{children:"At least one job times out while connecting to Kafka."}),(0,i.jsx)(n.td,{children:"Shared-nothing and shared-storage"}),(0,i.jsx)(n.td,{children:"Stop or manually pause the job to resolve the issue."}),(0,i.jsx)(n.td,{children:"<2.1.9 <3.0.5"}),(0,i.jsx)(n.td,{children:"2.1.9 3.0.5"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/47530",children:"#47530"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"User data may be lost after restarting the FE Master."}),(0,i.jsx)(n.td,{children:"The job's offset is set to OFFSET_END, and the FE is restarted."}),(0,i.jsx)(n.td,{children:"Shared-storage"}),(0,i.jsx)(n.td,{children:"Change the consumption mode to OFFSET_BEGINNING."}),(0,i.jsx)(n.td,{children:"3.0.2-3.0.4"}),(0,i.jsx)(n.td,{children:"3.0.5"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/46149",children:"#46149"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"A large number of small transactions are generated during import, causing compaction to fail and resulting in continuous -235 errors."}),(0,i.jsx)(n.td,{children:"Doris consumes data too quickly, or Kafka data flow is in small batches."}),(0,i.jsx)(n.td,{children:"Shared-nothing and shared-storage"}),(0,i.jsxs)(n.td,{children:["Pause the Routine Load job and execute the following command: ",(0,i.jsx)(n.code,{children:'ALTER ROUTINE LOAD FOR jobname FROM kafka ("property.enable.partition.eof" = "false");'})]}),(0,i.jsx)(n.td,{children:"<2.1.8 <3.0.4"}),(0,i.jsx)(n.td,{children:"2.1.8 3.0.4"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/45528",children:"#45528"}),", ",(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/44949",children:"#44949"}),", ",(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/39975",children:"#39975"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Kafka third-party library destructor hangs, causing data consumption to fail."}),(0,i.jsx)(n.td,{children:"Kafka topic deletion (possibly other conditions)."}),(0,i.jsx)(n.td,{children:"Shared-nothing and shared-storage"}),(0,i.jsx)(n.td,{children:"Restart all BE nodes."}),(0,i.jsx)(n.td,{children:"<2.1.8 <3.0.4"}),(0,i.jsx)(n.td,{children:"2.1.8 3.0.4"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/44913",children:"#44913"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Routine Load scheduling hangs."}),(0,i.jsx)(n.td,{children:"Timeout occurs when FE aborts a transaction in Meta Service."}),(0,i.jsx)(n.td,{children:"Shared-storage"}),(0,i.jsx)(n.td,{children:"Restart the FE node."}),(0,i.jsx)(n.td,{children:"<3.0.2"}),(0,i.jsx)(n.td,{children:"3.0.2"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/41267",children:"#41267"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Routine Load restart issue."}),(0,i.jsx)(n.td,{children:"Restarting BE nodes."}),(0,i.jsx)(n.td,{children:"Shared-nothing and shared-storage"}),(0,i.jsx)(n.td,{children:"Manually resume the job."}),(0,i.jsx)(n.td,{children:"<2.1.7 <3.0.2"}),(0,i.jsx)(n.td,{children:"2.1.7 3.0.2"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/40728",children:"#3727"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"default-configuration-optimizations",children:"Default Configuration Optimizations"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Optimization Content"}),(0,i.jsx)(n.th,{children:"Applied Versions"}),(0,i.jsx)(n.th,{children:"Corresponding PR"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Increased the timeout duration for Routine Load."}),(0,i.jsx)(n.td,{children:"2.1.7 3.0.3"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/42042",children:"#42042"}),", ",(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/40818",children:"#40818"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Adjusted the default value of ",(0,i.jsx)(n.code,{children:"max_batch_interval"}),"."]}),(0,i.jsx)(n.td,{children:"2.1.8 3.0.3"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/42491",children:"#42491"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Removed the restriction on ",(0,i.jsx)(n.code,{children:"max_batch_interval"}),"."]}),(0,i.jsx)(n.td,{children:"2.1.5 3.0.0"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/29071",children:"#29071"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Adjusted the default values of ",(0,i.jsx)(n.code,{children:"max_batch_rows"})," and ",(0,i.jsx)(n.code,{children:"max_batch_size"}),"."]}),(0,i.jsx)(n.td,{children:"2.1.5 3.0.0"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/36632",children:"#36632"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"observability-optimizations",children:"Observability Optimizations"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Optimization Content"}),(0,i.jsx)(n.th,{children:"Applied Versions"}),(0,i.jsx)(n.th,{children:"Corresponding PR"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Added observability-related metrics."}),(0,i.jsx)(n.td,{children:"3.0.5"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/48209",children:"#48209"}),", ",(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/48171",children:"#48171"}),", ",(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/pull/48963",children:"#48963"})]})]})})]}),"\n",(0,i.jsx)(n.h3,{id:"error-failed-to-get-latest-offset",children:'Error "failed to get latest offset"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem Description"}),": Routine Load cannot get the latest Kafka offset."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Common Causes"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Usually due to network connectivity issues with Kafka. Verify by pinging or using telnet to test the Kafka domain name."}),"\n",(0,i.jsx)(n.li,{children:"Timeout caused by third-party library bug, error: java.util.concurrent.TimeoutException: Waited X seconds"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"error-failed-to-get-partition-meta-localbroker-transport-failure",children:'Error "failed to get partition meta: Local:\'Broker transport failure"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem Description"}),": Routine Load cannot get Kafka Topic Partition Meta."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Common Causes"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Usually due to network connectivity issues with Kafka. Verify by pinging or using telnet to test the Kafka domain name."}),"\n",(0,i.jsx)(n.li,{children:"If using domain names, try configuring domain name mapping in /etc/hosts"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"error-broker-offset-out-of-range",children:'Error "Broker: Offset out of range"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem Description"}),": The consumed offset doesn't exist in Kafka, possibly because it has been cleaned up by Kafka."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Need to specify a new offset for consumption, for example, set offset to OFFSET_BEGINNING."}),"\n",(0,i.jsx)(n.li,{children:"Need to set appropriate Kafka log cleanup parameters based on import speed: log.retention.hours, log.retention.bytes, etc."}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return l},a:function(){return o}});var r=t(667294);let i={},s=r.createContext(i);function o(e){let n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);