"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["198268"],{98388:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>o,metadata:()=>r,assets:()=>l,toc:()=>c,contentTitle:()=>d});var r=JSON.parse('{"id":"ecosystem/observability/langfuse","title":"Langfuse on Doris","description":"About Langfuse","source":"@site/docs/ecosystem/observability/langfuse.md","sourceDirName":"ecosystem/observability","slug":"/ecosystem/observability/langfuse","permalink":"/docs/dev/ecosystem/observability/langfuse","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Langfuse on Doris","language":"en"},"sidebar":"docs","previous":{"title":"LoongCollector (iLogtail) Doris Flusher","permalink":"/docs/dev/ecosystem/observability/loongcollector"},"next":{"title":"Integrating Vector with Doris","permalink":"/docs/dev/ecosystem/observability/vector"}}'),i=s("785893"),t=s("250065");let o={title:"Langfuse on Doris",language:"en"},d="Langfuse on Doris",l={},c=[{value:"About Langfuse",id:"about-langfuse",level:2},{value:"System Architecture",id:"system-architecture",level:2},{value:"Deployment Requirements",id:"deployment-requirements",level:2},{value:"Software Environment",id:"software-environment",level:3},{value:"Hardware Resources",id:"hardware-resources",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Doris Analytics Backend Configuration",id:"doris-analytics-backend-configuration",level:3},{value:"Basic Service Configuration",id:"basic-service-configuration",level:3},{value:"Redis Cache Configuration",id:"redis-cache-configuration",level:3},{value:"Data Migration Configuration",id:"data-migration-configuration",level:3},{value:"Docker Compose Deployment",id:"docker-compose-deployment",level:2},{value:"Pre-deployment Preparation",id:"pre-deployment-preparation",level:3},{value:"Download docker compose",id:"download-docker-compose",level:3},{value:"Deployment Steps",id:"deployment-steps",level:3},{value:"1 . Start compose",id:"1--start-compose",level:3},{value:"3. Verify Deployment",id:"3-verify-deployment",level:3},{value:"4. Service Initialization",id:"4-service-initialization",level:4},{value:"Using Langfuse SDK",id:"using-langfuse-sdk",level:2},{value:"Using LangChain SDK",id:"using-langchain-sdk",level:2},{value:"Using LlamaIndex SDK",id:"using-llamaindex-sdk",level:2}];function a(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"langfuse-on-doris",children:"Langfuse on Doris"})}),"\n",(0,i.jsx)(n.h2,{id:"about-langfuse",children:"About Langfuse"}),"\n",(0,i.jsx)(n.p,{children:"Langfuse is an open-source LLM engineering platform that provides comprehensive observability solutions for large language model applications. It offers the following core features:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Tracing"}),": Complete recording of LLM application call chains and execution flows"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Evaluation"}),": Multi-dimensional model performance evaluation and quality analysis"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Prompt Management"}),": Centralized management and version control of prompt templates"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metrics Monitoring"}),": Real-time monitoring of application performance, cost, and quality metrics"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This document provides detailed instructions on how to deploy a Langfuse solution using Apache Doris as the analytics backend, fully leveraging Doris's powerful OLAP analytics capabilities to process large-scale LLM application data."}),"\n",(0,i.jsx)(n.h2,{id:"system-architecture",children:"System Architecture"}),"\n",(0,i.jsx)(n.p,{children:"The Langfuse on Doris solution uses a microservices architecture with the following core components:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Component"}),(0,i.jsx)(n.th,{children:"Ports"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Langfuse Web"}),(0,i.jsx)(n.td,{children:"3000"}),(0,i.jsx)(n.td,{children:"Web interface and API service for user interaction and data ingestion"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Langfuse Worker"}),(0,i.jsx)(n.td,{children:"3030"}),(0,i.jsx)(n.td,{children:"Async task processing for data processing and analytics tasks"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"PostgreSQL"}),(0,i.jsx)(n.td,{children:"5432"}),(0,i.jsx)(n.td,{children:"Transactional data storage for user configuration and metadata"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Redis"}),(0,i.jsx)(n.td,{children:"6379"}),(0,i.jsx)(n.td,{children:"Cache layer and message queue for improved system response performance"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"MinIO"}),(0,i.jsx)(n.td,{children:"9090"}),(0,i.jsx)(n.td,{children:"Object storage service for raw events and multi-modal attachments"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Doris Fe"}),(0,i.jsx)(n.td,{children:"9030 8030"}),(0,i.jsx)(n.td,{children:"Doris Frontend, part of the Doris architecture, responsible for receiving user requests, query parsing and planning, metadata management, and node management"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Doris Be"}),(0,i.jsx)(n.td,{children:"8040 8050"}),(0,i.jsx)(n.td,{children:"Doris Backends, part of the Doris architecture, responsible for data storage and query plan execution. Data is split into shards and stored with multiple replicas in BE nodes."})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"::: note"}),"\n",(0,i.jsx)(n.p,{children:"When deploying Apache Doris, you can choose between integrated compute-storage architecture or disaggregated compute-storage architecture based on your hardware environment and business requirements.\nFor Langfuse deployment, Docker Doris is not recommended for production environments. The FE and BE components included in Docker are intended for users to quickly experience the Langfuse on Doris capabilities."}),"\n",(0,i.jsx)(n.p,{children:":::"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mermaid",children:'flowchart TB\n    User["UI, API, SDKs"]\n    subgraph vpc["VPC"]\n        Web["Web Server<br/>(langfuse/langfuse)"]\n        Worker["Async Worker<br/>(langfuse/worker)"]\n        Postgres["Postgres - OLTP<br/>(Transactional Data)"]\n        Cache["Redis/Valkey<br/>(Cache, Queue)"]\n        Doris["Doris - OLAP<br/>(Observability Data)"]\n        S3["S3 / Blob Storage<br/>(Raw events, multi-modal attachments)"]\n    end\n    LLM["LLM API/Gateway<br/>(optional)"]\n\n    User --\x3e Web\n    Web --\x3e S3\n    Web --\x3e Postgres\n    Web --\x3e Cache\n    Web --\x3e Doris\n    Web -.->|"optional for playground"| LLM\n\n    Cache --\x3e Worker\n    Worker --\x3e Doris\n    Worker --\x3e Postgres\n    Worker --\x3e S3\n    Worker -.->|"optional for evals"| LLM\n'})}),"\n",(0,i.jsx)(n.h2,{id:"deployment-requirements",children:"Deployment Requirements"}),"\n",(0,i.jsx)(n.h3,{id:"software-environment",children:"Software Environment"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Component"}),(0,i.jsx)(n.th,{children:"Version"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Docker"}),(0,i.jsx)(n.td,{children:"20.0+"}),(0,i.jsx)(n.td,{children:"Container runtime environment"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Docker Compose"}),(0,i.jsx)(n.td,{children:"2.0+"}),(0,i.jsx)(n.td,{children:"Container orchestration tool"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Apache Doris"}),(0,i.jsx)(n.td,{children:"2.1.10+"}),(0,i.jsx)(n.td,{children:"Analytics database, requires separate deployment"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"hardware-resources",children:"Hardware Resources"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Resource Type"}),(0,i.jsx)(n.th,{children:"Minimum"}),(0,i.jsx)(n.th,{children:"Recommended"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Memory"}),(0,i.jsx)(n.td,{children:"8GB"}),(0,i.jsx)(n.td,{children:"16GB+"}),(0,i.jsx)(n.td,{children:"Supports multi-service concurrent operation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Disk"}),(0,i.jsx)(n.td,{children:"50GB"}),(0,i.jsx)(n.td,{children:"100GB+"}),(0,i.jsx)(n.td,{children:"Storage for container data and logs"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Network"}),(0,i.jsx)(n.td,{children:"1Gbps"}),(0,i.jsx)(n.td,{children:"10Gbps"}),(0,i.jsx)(n.td,{children:"Ensures data transfer performance"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Doris Cluster Preparation"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ensure the Doris cluster is running properly with stable performance"}),"\n",(0,i.jsx)(n.li,{children:"Verify that FE HTTP port (default 8030) and query port (default 9030) are network accessible"}),"\n",(0,i.jsx)(n.li,{children:"Langfuse will automatically create the required database and table structures in Doris after startup"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Network Connectivity"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Deployment environment can access Docker Hub to pull images"}),"\n",(0,i.jsx)(n.li,{children:"Langfuse services can access the relevant ports of the Doris cluster"}),"\n",(0,i.jsx)(n.li,{children:"Clients can access the Langfuse Web service port"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"Deployment Recommendation",type:"tip",children:(0,i.jsx)(n.p,{children:"It is recommended to use Docker to deploy Langfuse service components (Web, Worker, Redis, PostgreSQL), but Doris is recommended to be deployed separately for better performance and stability. Please refer to the official documentation for detailed Doris deployment guide."})}),"\n",(0,i.jsx)(n.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,i.jsx)(n.p,{children:"Langfuse services require multiple environment variables to support the proper operation of each component:"}),"\n",(0,i.jsx)(n.h3,{id:"doris-analytics-backend-configuration",children:"Doris Analytics Backend Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Example Value"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LANGFUSE_ANALYTICS_BACKEND"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"doris"})}),(0,i.jsx)(n.td,{children:"Specify Doris as the analytics backend"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DORIS_FE_HTTP_URL"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"http://localhost:8030"})}),(0,i.jsx)(n.td,{children:"Doris FE HTTP service address"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DORIS_FE_QUERY_PORT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"9030"})}),(0,i.jsx)(n.td,{children:"Doris FE query port"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DORIS_DB"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"langfuse"})}),(0,i.jsx)(n.td,{children:"Doris database name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DORIS_USER"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"root"})}),(0,i.jsx)(n.td,{children:"Doris username"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DORIS_PASSWORD"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"123456"})}),(0,i.jsx)(n.td,{children:"Doris password"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DORIS_MAX_OPEN_CONNECTIONS"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"100"})}),(0,i.jsx)(n.td,{children:"Maximum database connections"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DORIS_REQUEST_TIMEOUT_MS"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"300000"})}),(0,i.jsx)(n.td,{children:"Request timeout in milliseconds"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"basic-service-configuration",children:"Basic Service Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Example Value"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DATABASE_URL"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"postgresql://postgres:postgres@langfuse-postgres:5432/postgres"})}),(0,i.jsx)(n.td,{children:"PostgreSQL database connection URL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NEXTAUTH_SECRET"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"your-debug-secret-key-here-must-be-long-enough"})}),(0,i.jsx)(n.td,{children:"NextAuth authentication key for session encryption"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SALT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"your-super-secret-salt-with-at-least-32-characters-for-encryption"})}),(0,i.jsx)(n.td,{children:"Data encryption salt (at least 32 characters)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ENCRYPTION_KEY"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0000000000000000000000000000000000000000000000000000000000000000"})}),(0,i.jsx)(n.td,{children:"Data encryption key (64 characters)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NEXTAUTH_URL"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"http://localhost:3000"})}),(0,i.jsx)(n.td,{children:"Langfuse Web service address"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TZ"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UTC"})}),(0,i.jsx)(n.td,{children:"System timezone setting"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"redis-cache-configuration",children:"Redis Cache Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Example Value"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REDIS_HOST"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"langfuse-redis"})}),(0,i.jsx)(n.td,{children:"Redis service host address"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REDIS_PORT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"6379"})}),(0,i.jsx)(n.td,{children:"Redis service port"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REDIS_AUTH"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"myredissecret"})}),(0,i.jsx)(n.td,{children:"Redis authentication password"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REDIS_TLS_ENABLED"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})}),(0,i.jsx)(n.td,{children:"Whether to enable TLS encryption"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REDIS_TLS_CA"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-"})}),(0,i.jsx)(n.td,{children:"TLS CA certificate path"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REDIS_TLS_CERT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-"})}),(0,i.jsx)(n.td,{children:"TLS client certificate path"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REDIS_TLS_KEY"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-"})}),(0,i.jsx)(n.td,{children:"TLS private key path"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"data-migration-configuration",children:"Data Migration Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Example Value"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LANGFUSE_ENABLE_BACKGROUND_MIGRATIONS"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})}),(0,i.jsx)(n.td,{children:"Disable background migrations (must be disabled when using Doris)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LANGFUSE_AUTO_DORIS_MIGRATION_DISABLED"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})}),(0,i.jsx)(n.td,{children:"Enable Doris auto migration"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"docker-compose-deployment",children:"Docker Compose Deployment"}),"\n",(0,i.jsx)(n.h3,{id:"pre-deployment-preparation",children:"Pre-deployment Preparation"}),"\n",(0,i.jsx)(n.p,{children:"Here we provide a compose example that can be started directly. Modify the configuration according to your requirements."}),"\n",(0,i.jsx)(n.h3,{id:"download-docker-compose",children:"Download docker compose"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"wget https://apache-doris-releases.oss-cn-beijing.aliyuncs.com/extension/docker-langfuse-doris.tar.gz\n"})}),"\n",(0,i.jsx)(n.p,{children:"The directory structure for compose file and configuration file is as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"docker-langfuse-doris\n\u251C\u2500\u2500 docker-compose.yml\n\u2514\u2500\u2500 doris-config\n    \u2514\u2500\u2500 fe_custom.conf\n"})}),"\n",(0,i.jsx)(n.h3,{id:"deployment-steps",children:"Deployment Steps"}),"\n",(0,i.jsx)(n.h3,{id:"1--start-compose",children:"1 . Start compose"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Bash",children:"docker compose up -d\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Bash",children:"# Check\n$ docker compose up -d\n[+] Running 9/9\n \u2714 Network docker-langfuse-doris_doris_internal  Created                                                                                                                                                                                               0.1s \n \u2714 Network docker-langfuse-doris_default         Created                                                                                                                                                                                               0.1s \n \u2714 Container doris_fe                            Healthy                                                                                                                                                                                              13.8s \n \u2714 Container langfuse-postgres                   Healthy                                                                                                                                                                                              13.8s \n \u2714 Container langfuse-redis                      Healthy                                                                                                                                                                                              13.8s \n \u2714 Container langfuse-minio                      Healthy                                                                                                                                                                                              13.8s \n \u2714 Container doris_be                            Healthy                                                                                                                                                                                              54.3s \n \u2714 Container langfuse-worker                     Started                                                                                                                                                                                              54.8s \n \u2714 Container langfuse-web                        Started\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-verify-deployment",children:"3. Verify Deployment"}),"\n",(0,i.jsx)(n.p,{children:"Check service status:"}),"\n",(0,i.jsx)(n.p,{children:"When all service statuses show as Healthy, the compose has started successfully."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Bash",children:'$ docker compose ps\nNAME                IMAGE                             COMMAND                  SERVICE           CREATED         STATUS                        PORTS\ndoris_be            apache/doris:be-2.1.11            "bash entry_point.sh"    doris_be          2 minutes ago   Up 2 minutes (healthy)        0.0.0.0:8040->8040/tcp, :::8040->8040/tcp, 0.0.0.0:8060->8060/tcp, :::8060->8060/tcp, 0.0.0.0:9050->9050/tcp, :::9050->9050/tcp, 0.0.0.0:9060->9060/tcp, :::9060->9060/tcp\ndoris_fe            apache/doris:fe-2.1.11            "bash init_fe.sh"        doris_fe          2 minutes ago   Up 2 minutes (healthy)        0.0.0.0:8030->8030/tcp, :::8030->8030/tcp, 0.0.0.0:9010->9010/tcp, :::9010->9010/tcp, 0.0.0.0:9030->9030/tcp, :::9030->9030/tcp\nlangfuse-minio      minio/minio                       "sh -c \'mkdir -p /da\u2026"   minio             2 minutes ago   Up 2 minutes (healthy)        0.0.0.0:19090->9000/tcp, :::19090->9000/tcp, 127.0.0.1:19091->9001/tcp\nlangfuse-postgres   postgres:latest                   "docker-entrypoint.s\u2026"   postgres          2 minutes ago   Up 2 minutes (healthy)        127.0.0.1:5432->5432/tcp\nlangfuse-redis      redis:7                           "docker-entrypoint.s\u2026"   redis             2 minutes ago   Up 2 minutes (healthy)        127.0.0.1:16379->6379/tcp\nlangfuse-web        selectdb/langfuse-web:latest      "dumb-init -- ./web/\u2026"   langfuse-web      2 minutes ago   Up About a minute (healthy)   0.0.0.0:13000->3000/tcp, :::13000->3000/tcp\nlangfuse-worker     selectdb/langfuse-worker:latest   "dumb-init -- ./work\u2026"   langfuse-worker   2 minutes ago   Up About a minute (healthy)   0.0.0.0:3030->3030/tcp, :::3030->3030/tcp\n'})}),"\n",(0,i.jsx)(n.h4,{id:"4-service-initialization",children:"4. Service Initialization"}),"\n",(0,i.jsx)(n.p,{children:"After deployment is complete, access and initialize the service as follows:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Access Langfuse Web Interface"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["URL: ",(0,i.jsx)(n.a,{href:"http://localhost:3000",children:"http://localhost:3000"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Initialization Steps"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Open your browser and navigate to ",(0,i.jsx)(n.a,{href:"http://localhost:3000",children:"http://localhost:3000"})]}),"\n",(0,i.jsx)(n.li,{children:"Create an administrator account and log in"}),"\n",(0,i.jsx)(n.li,{children:"Create a new organization and project"}),"\n",(0,i.jsx)(n.li,{children:"Obtain the project's API Keys (Public Key and Secret Key)"}),"\n",(0,i.jsx)(n.li,{children:"Configure the authentication information required for SDK integration"}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.h2,{id:"using-langfuse-sdk",children:"Using Langfuse SDK"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Python",children:'import os\n# Instead of: import openai\nfrom langfuse.openai import OpenAI\n# from langfuse import observe\n\n# Langfuse config\nos.environ["LANGFUSE_SECRET_KEY"] = "sk-lf-******-******"\nos.environ["LANGFUSE_PUBLIC_KEY"] = "pk-lf-******-******" \nos.environ["LANGFUSE_HOST"] = "http://localhost:3000"\n\n\n# use OpenAI client\nclient = OpenAI()\n\n\n# ask a question\nquestion = "What are the key features of the Doris observability solution? Please answer concisely."\nprint(f"question: {question}")\n\ncompletion = client.chat.completions.create(\n    model="gpt-4o",\n    messages=[\n        {"role": "user", "content": question}\n    ]\n)\nresponse = completion.choices[0].message.content\nprint(f"response: {response}")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(683527).Z+"",width:"2126",height:"1790"})}),"\n",(0,i.jsx)(n.h2,{id:"using-langchain-sdk",children:"Using LangChain SDK"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Python",children:'import os\nfrom langfuse.langchain import CallbackHandler\nfrom langchain_openai import ChatOpenAI\n\n# Langfuse config\nos.environ["LANGFUSE_SECRET_KEY"] = "sk-lf-******-******"\nos.environ["LANGFUSE_PUBLIC_KEY"] = "pk-lf-******-******" \nos.environ["LANGFUSE_HOST"] = "http://localhost:3000"\n\n# Create your LangChain components (using OpenAI API)\nllm = ChatOpenAI(\n    model="gpt-4o"\n)\n\n# ask a question\nquestion = "What are the key features of the Doris observability solution? Please answer concisely."\nprint(f"question: {question} \\n")\n\n# Run your chain with Langfuse tracing\ntry:\n    # Initialize the Langfuse handler\n    langfuse_handler = CallbackHandler()\n    response = llm.invoke(question, config={"callbacks": [langfuse_handler]})\n    print(f"response: {response.content}")\nexcept Exception as e:\n    print(f"Error during chain execution: {e}")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(683527).Z+"",width:"2126",height:"1790"})}),"\n",(0,i.jsx)(n.h2,{id:"using-llamaindex-sdk",children:"Using LlamaIndex SDK"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Python",children:'import os\nfrom langfuse import get_client\nfrom openinference.instrumentation.llama_index import LlamaIndexInstrumentor\nfrom llama_index.llms.openai import OpenAI\n\n# Langfuse config\nos.environ["LANGFUSE_SECRET_KEY"] = "sk-lf-******-******"\nos.environ["LANGFUSE_PUBLIC_KEY"] = "pk-lf-******-******" \nos.environ["LANGFUSE_HOST"] = "http://localhost:3000"\n\nlangfuse = get_client()\n\n\n# Initialize LlamaIndex instrumentation\nLlamaIndexInstrumentor().instrument()\n\n\n# Set up the OpenAI class with the required model\nllm = OpenAI(model="gpt-4o")\n\n\n# ask a question\nquestion = "What are the key features of the Doris observability solution? Please answer concisely."\nprint(f"question: {question} \\n")\n \nwith langfuse.start_as_current_span(name="llama-index-trace"):\n    response = llm.complete(question)\n    print(f"response: {response}")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(13166).Z+"",width:"2122",height:"1540"})})]})}function h(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},683527:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/langfuse_2-bbf521aa79ddbc7b7417ad35f2a5dd53.png"},13166:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/langfuse_3-bc35995c8c25c515066bd6b609b5a034.png"},250065:function(e,n,s){s.d(n,{Z:function(){return d},a:function(){return o}});var r=s(667294);let i={},t=r.createContext(i);function o(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);