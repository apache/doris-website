"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["559460"],{151683:function(e,n,s){s.r(n),s.d(n,{default:()=>p,frontMatter:()=>c,metadata:()=>t,assets:()=>d,toc:()=>h,contentTitle:()=>o});var t=JSON.parse('{"id":"lakehouse/catalogs/iceberg-catalog","title":"Iceberg Catalog","description":"Iceberg Catalog in Apache Doris connects to multiple Iceberg metadata services to query and write Iceberg tables across HDFS and cloud object storage, with detailed configuration, properties, query and write operations.","source":"@site/versioned_docs/version-2.1/lakehouse/catalogs/iceberg-catalog.mdx","sourceDirName":"lakehouse/catalogs","slug":"/lakehouse/catalogs/iceberg-catalog","permalink":"/docs/2.1/lakehouse/catalogs/iceberg-catalog","draft":false,"unlisted":false,"tags":[],"version":"2.1","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Iceberg Catalog","language":"en","description":"Iceberg Catalog in Apache Doris connects to multiple Iceberg metadata services to query and write Iceberg tables across HDFS and cloud object storage, with detailed configuration, properties, query and write operations."},"sidebar":"docs","previous":{"title":"Hive Catalog","permalink":"/docs/2.1/lakehouse/catalogs/hive-catalog"},"next":{"title":"Hudi Catalog","permalink":"/docs/2.1/lakehouse/catalogs/hudi-catalog"}}'),i=s("785893"),r=s("250065"),a=s("247902"),l=s("905525");let c={title:"Iceberg Catalog",language:"en",description:"Iceberg Catalog in Apache Doris connects to multiple Iceberg metadata services to query and write Iceberg tables across HDFS and cloud object storage, with detailed configuration, properties, query and write operations."},o=void 0,d={},h=[{value:"Applicable Scenarios",id:"applicable-scenarios",level:2},{value:"Configuring Catalog",id:"configuring-catalog",level:2},{value:"Syntax",id:"syntax",level:3},{value:"Supported Iceberg Versions",id:"supported-iceberg-versions",level:3},{value:"Supported Iceberg Formats",id:"supported-iceberg-formats",level:3},{value:"Supported Metadata Services",id:"supported-metadata-services",level:3},{value:"Iceberg Catalog Feature Support Matrix",id:"iceberg-catalog-feature-support-matrix",level:3},{value:"Supported Storage Systems",id:"supported-storage-systems",level:3},{value:"Supported Data Formats",id:"supported-data-formats",level:3},{value:"Column Type Mapping",id:"column-type-mapping",level:2},{value:"Namespace Mapping",id:"namespace-mapping",level:2},{value:"Examples",id:"examples",level:2},{value:"Hive Metastore",id:"hive-metastore",level:3},{value:"AWS Glue",id:"aws-glue",level:3},{value:"Aliyun DLF",id:"aliyun-dlf",level:3},{value:"Iceberg Rest Catalog",id:"iceberg-rest-catalog",level:3},{value:"FileSystem",id:"filesystem",level:3},{value:"AWS S3 Tables",id:"aws-s3-tables",level:3},{value:"Query Operations",id:"query-operations",level:2},{value:"Basic Query",id:"basic-query",level:3},{value:"Time Travel",id:"time-travel",level:3},{value:"Branch and Tag",id:"branch-and-tag",level:3},{value:"View",id:"view",level:3},{value:"System Tables",id:"system-tables",level:2},{value:"entries",id:"entries",level:3},{value:"files",id:"files",level:3},{value:"history",id:"history",level:3},{value:"manifests",id:"manifests",level:3},{value:"metadata_log_entries",id:"metadata_log_entries",level:3},{value:"partitions",id:"partitions",level:3},{value:"refs",id:"refs",level:3},{value:"snapshots",id:"snapshots",level:3},{value:"Write Operations",id:"write-operations",level:2},{value:"INSERT INTO",id:"insert-into",level:3},{value:"INSERT OVERWRITE",id:"insert-overwrite",level:3},{value:"CTAS",id:"ctas",level:3},{value:"INSERT INTO BRANCH",id:"insert-into-branch",level:3},{value:"Related Parameters",id:"related-parameters",level:3},{value:"Database and Table Management",id:"database-and-table-management",level:2},{value:"Creating and Dropping Databases",id:"creating-and-dropping-databases",level:3},{value:"Creating and Dropping Tables",id:"creating-and-dropping-tables",level:3},{value:"Schema Change",id:"schema-change",level:3},{value:"Partition Evolution",id:"partition-evolution",level:3},{value:"Managing Branch &amp; Tag",id:"managing-branch--tag",level:3},{value:"Iceberg Table Actions",id:"iceberg-table-actions",level:2},{value:"rewrite_data_files",id:"rewrite_data_files",level:3},{value:"cherrypick_snapshot",id:"cherrypick_snapshot",level:3},{value:"fast_forward",id:"fast_forward",level:3},{value:"rollback_to_snapshot",id:"rollback_to_snapshot",level:3},{value:"rollback_to_timestamp",id:"rollback_to_timestamp",level:3},{value:"set_current_snapshot",id:"set_current_snapshot",level:3},{value:"Iceberg Table Optimization",id:"iceberg-table-optimization",level:2},{value:"View Data File Distribution",id:"view-data-file-distribution",level:3},{value:"Dangling Delete",id:"dangling-delete",level:3},{value:"Appendix",id:"appendix",level:2},{value:"<code>rewrite_data_files</code> File Selection Strategy",id:"rewrite_data_files-file-selection-strategy",level:3}];function u(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components},{Details:s}=n;return s||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Doris supports accessing Iceberg table data through various metadata services. In addition to reading data, Doris also supports writing to Iceberg tables."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/best-practices/doris-iceberg",children:"Quick start with Apache Doris and Apache Iceberg"}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"Users can access Iceberg tables using Hive Metastore as metadata through the Hive Catalog. However, it is still recommended to use the Iceberg Catalog directly to avoid some compatibility issues."})}),"\n",(0,i.jsx)(n.h2,{id:"applicable-scenarios",children:"Applicable Scenarios"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Query Acceleration"}),(0,i.jsx)(n.td,{children:"Use Doris's distributed computing engine to directly access Iceberg data for faster queries."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Data Integration"}),(0,i.jsx)(n.td,{children:"Read Iceberg data and write it to internal Doris tables, or perform ZeroETL operations using the Doris computing engine."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Data Write-back"}),(0,i.jsx)(n.td,{children:"Process data from any Doris-supported data source and write it back to Iceberg table storage."})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"configuring-catalog",children:"Configuring Catalog"}),"\n",(0,i.jsx)(n.h3,{id:"syntax",children:"Syntax"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG [IF NOT EXISTS] catalog_name PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = '<iceberg_catalog_type>',\n    'warehouse' = '<warehouse>' --optional\n    {MetaStoreProperties},\n    {StorageProperties},\n    {IcebergProperties},\n    {CommonProperties}\n);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"<iceberg_catalog_type>"})}),"\n",(0,i.jsx)(n.p,{children:"The type of Iceberg Catalog, supporting the following options:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hms"}),": Uses Hive Metastore as the metadata service."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"rest"}),": Metadata service compatible with the Iceberg Rest Catalog interface."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hadoop"}),": Directly accesses metadata stored on the file system."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"glue"}),": Uses AWS Glue as the metadata service."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"dlf"}),": Uses Alibaba Cloud DLF as the metadata service."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"s3tables"}),": Uses AWS S3 Tables Catalog to visit ",(0,i.jsx)(n.a,{href:"https://aws.amazon.com/s3/features/tables/",children:"S3 Table Bucket"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"<warehouse>"})}),"\n",(0,i.jsxs)(n.p,{children:["The warehouse path for Iceberg. This parameter must be specified when ",(0,i.jsx)(n.code,{children:"<iceberg_catalog_type>"})," is ",(0,i.jsx)(n.code,{children:"hadoop"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"warehouse"})," path must point to the level above the ",(0,i.jsx)(n.code,{children:"Database"})," path. For example, if your table path is ",(0,i.jsx)(n.code,{children:"s3://bucket/path/to/db1/table1"}),", then the ",(0,i.jsx)(n.code,{children:"warehouse"})," should be ",(0,i.jsx)(n.code,{children:"s3://bucket/path/to/"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"{MetaStoreProperties}"})}),"\n",(0,i.jsx)(n.p,{children:"The MetaStoreProperties section is for entering connection and authentication information for the Metastore metadata service. Refer to the section on [Supported Metadata Services]."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"{StorageProperties}"})}),"\n",(0,i.jsx)(n.p,{children:"The StorageProperties section is for entering connection and authentication information related to the storage system. Refer to the section on [Supported Storage Systems]."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"{IcebergProperties}"})}),"\n",(0,i.jsx)(n.p,{children:"The IcebergProperties section is used to fill in parameters specific to Iceberg Catalog."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"list-all-tables"})}),"\n",(0,i.jsxs)(n.p,{children:["For Iceberg Catalog that uses Hive Metastore as the metadata service. Default is ",(0,i.jsx)(n.code,{children:"true"}),". By default, the ",(0,i.jsx)(n.code,{children:"SHOW TABLES"})," operation will list all types of tables in the current Database (Hive Metastore may store non-Iceberg type tables). This approach has the best performance."]}),"\n",(0,i.jsxs)(n.p,{children:["If set to ",(0,i.jsx)(n.code,{children:"false"}),", Doris will check the type of each table one by one and only return Iceberg type tables. This mode will have poor performance when there are many tables."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"{CommonProperties}"})}),"\n",(0,i.jsxs)(n.p,{children:["The CommonProperties section is for entering general properties. See the ",(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/catalog-overview",children:"Catalog Overview"})," for details on common properties."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"supported-iceberg-versions",children:"Supported Iceberg Versions"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Doris Version"}),(0,i.jsx)(n.th,{children:"Iceberg SDK Version"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2.1"}),(0,i.jsx)(n.td,{children:"1.6.1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3.0"}),(0,i.jsx)(n.td,{children:"1.6.1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3.1"}),(0,i.jsx)(n.td,{children:"1.9.1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4.0"}),(0,i.jsx)(n.td,{children:"1.9.1"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"supported-iceberg-formats",children:"Supported Iceberg Formats"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Supports Iceberg V1/V2 formats."}),"\n",(0,i.jsx)(n.li,{children:"Supports reading Position Delete and Equality Delete."}),"\n",(0,i.jsx)(n.li,{children:"Supports reading  Deletion Vector (Since 4.1.0)."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"supported-metadata-services",children:"Supported Metadata Services"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/metastores/hive-metastore",children:"Hive Metastore"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/metastores/aws-glue",children:"AWS Glue"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/metastores/aliyun-dlf",children:"Aliyun DLF"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/metastores/iceberg-rest",children:"Iceberg Rest Catalog"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/metastores/filesystem",children:"FileSystem"})}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Note: The service types and parameters supported by different Doris versions are slightly different. Please refer to the [Examples] section."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"iceberg-catalog-feature-support-matrix",children:"Iceberg Catalog Feature Support Matrix"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Metadata Service"}),(0,i.jsx)(n.th,{children:"Table Query"}),(0,i.jsx)(n.th,{children:"View Query"}),(0,i.jsx)(n.th,{children:"DDL Operations"}),(0,i.jsx)(n.th,{children:"Data Writeback"}),(0,i.jsx)(n.th,{children:"System Tables (Supported since 3.1+)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Hive MetaStore"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"AWS Glue"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u274C"}),(0,i.jsx)(n.td,{children:"\u274C"}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Aliyun DLF"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u274C"}),(0,i.jsx)(n.td,{children:"\u274C"}),(0,i.jsx)(n.td,{children:"\u274C"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Iceberg Rest Catalog"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"Depends on the service provider"}),(0,i.jsx)(n.td,{children:"Depends on the service provider"}),(0,i.jsx)(n.td,{children:"Depends on the service provider"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"FileSystem"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"supported-storage-systems",children:"Supported Storage Systems"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/storages/hdfs",children:"HDFS"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/storages/s3",children:"AWS S3"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/storages/gcs",children:"Google Cloud Storage"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/storages/azure-blob",children:"Azure Blob"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/storages/aliyun-oss",children:"Aliyun OSS"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/storages/tencent-cos",children:"Tencent COS"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/storages/huawei-obs",children:"Huawei OBS"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/storages/minio",children:"MINIO"})}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Note: The service types and parameters supported by different Doris versions are slightly different. Please refer to the [Examples] section."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"supported-data-formats",children:"Supported Data Formats"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/file-formats/parquet",children:"Parquet"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/file-formats/orc",children:"ORC"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"column-type-mapping",children:"Column Type Mapping"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Iceberg Type"}),(0,i.jsx)(n.th,{children:"Doris Type"}),(0,i.jsx)(n.th,{children:"Comment"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"boolean"}),(0,i.jsx)(n.td,{children:"boolean"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"int"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"long"}),(0,i.jsx)(n.td,{children:"bigint"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"float"}),(0,i.jsx)(n.td,{children:"float"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"double"}),(0,i.jsx)(n.td,{children:"double"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"decimal(P, S)"}),(0,i.jsx)(n.td,{children:"decimal(P, S)"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"date"}),(0,i.jsx)(n.td,{children:"date"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"timestamp (Timestamp without timezone)"}),(0,i.jsx)(n.td,{children:"datetime(6)"}),(0,i.jsx)(n.td,{children:"Mapped to datetime with precision 6"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"timestamptz (Timestamp with timezone)"}),(0,i.jsx)(n.td,{children:"datetime(6)"}),(0,i.jsx)(n.td,{children:"Mapped to datetime with precision 6"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"fixed(N)"}),(0,i.jsx)(n.td,{children:"char(N)"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"binary"}),(0,i.jsx)(n.td,{children:"string/varbinary"}),(0,i.jsxs)(n.td,{children:["Controlled by the ",(0,i.jsx)(n.code,{children:"enable.mapping.varbinary"})," property of Catalog (supported since 4.0.2). The default is ",(0,i.jsx)(n.code,{children:"false"}),", which maps to ",(0,i.jsx)(n.code,{children:"string"}),"; when ",(0,i.jsx)(n.code,{children:"true"}),", it maps to ",(0,i.jsx)(n.code,{children:"varbinary"})," type."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"uuid"}),(0,i.jsx)(n.td,{children:"string/varbinary"}),(0,i.jsxs)(n.td,{children:["version < 4.0.2 maps to ",(0,i.jsx)(n.code,{children:"string"})," type; version == 4.0.2 maps to ",(0,i.jsx)(n.code,{children:"varbinary"})," type. For version > 4.0.2, it is controlled by the ",(0,i.jsx)(n.code,{children:"enable.mapping.varbinary"})," property in the properties. The default is ",(0,i.jsx)(n.code,{children:"false"}),", which maps to ",(0,i.jsx)(n.code,{children:"string"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"struct"}),(0,i.jsx)(n.td,{children:"struct (supported from version 2.1.3)"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"map"}),(0,i.jsx)(n.td,{children:"map (supported from version 2.1.3)"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"list"}),(0,i.jsx)(n.td,{children:"array"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"other"}),(0,i.jsx)(n.td,{children:"UNSUPPORTED"}),(0,i.jsx)(n.td,{})]})]})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Note:"}),"\n",(0,i.jsxs)(n.p,{children:["Doris currently does not support ",(0,i.jsx)(n.code,{children:"Timestamp"})," types with timezone. All ",(0,i.jsx)(n.code,{children:"timestamp"})," and ",(0,i.jsx)(n.code,{children:"timestamptz"})," will be uniformly mapped to ",(0,i.jsx)(n.code,{children:"datetime(N)"})," type. However, during reading and writing, Doris will correctly handle timezones based on the actual source type. For example, after specifying a timezone with ",(0,i.jsx)(n.code,{children:"SET time_zone=<tz>"}),", it will affect the reading and writing results of ",(0,i.jsx)(n.code,{children:"timestamptz"})," columns."]}),"\n",(0,i.jsxs)(n.p,{children:["You can check whether the source type has timezone information in the Extra column of the ",(0,i.jsx)(n.code,{children:"DESCRIBE table_name"})," statement. If it shows ",(0,i.jsx)(n.code,{children:"WITH_TIMEZONE"}),", it indicates that the source type is a timezone-aware type. (Supported since 3.1.0)."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"namespace-mapping",children:"Namespace Mapping"}),"\n",(0,i.jsx)(n.p,{children:"Iceberg's metadata hierarchy is Catalog -> Namespace -> Table. Namespace can have multiple levels (Nested Namespace)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"      \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \n      \u2502 Catalog \u2502             \n      \u2514\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2518             \n           \u2502                  \n     \u250C\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510            \n  \u250C\u2500\u2500\u25BC\u2500\u2500\u2510     \u250C\u2500\u2500\u25BC\u2500\u2500\u2510         \n  \u2502 NS1 \u2502     \u2502 NS2 \u2502         \n  \u2514\u2500\u2500\u252C\u2500\u2500\u2518     \u2514\u2500\u2500\u252C\u2500\u2500\u2518         \n     \u2502           \u2502            \n\u250C\u2500\u2500\u2500\u2500\u25BC\u2500\u2500\u2500\u2510    \u250C\u2500\u2500\u25BC\u2500\u2500\u2510         \n\u2502 Table1 \u2502    \u2502 NS3 \u2502         \n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u252C\u2500\u2500\u2518         \n                 \u2502            \n          \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \n     \u250C\u2500\u2500\u2500\u2500\u25BC\u2500\u2500\u2500\u2510     \u250C\u2500\u2500\u2500\u2500\u25BC\u2500\u2500\u2500\u2510\n     \u2502 Table2 \u2502     \u2502 Table3 \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.p,{children:"Starting from version 3.1.2, for Iceberg Rest Catalog, Doris supports mapping of Nested Namespace."}),"\n",(0,i.jsx)(n.p,{children:"In the above example, tables will be mapped to Doris metadata according to the following logic:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Catalog"}),(0,i.jsx)(n.th,{children:"Database"}),(0,i.jsx)(n.th,{children:"Table"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Catalog"}),(0,i.jsx)(n.td,{children:"NS1"}),(0,i.jsx)(n.td,{children:"Table1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Catalog"}),(0,i.jsx)(n.td,{children:"NS2.NS3"}),(0,i.jsx)(n.td,{children:"Table2"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Catalog"}),(0,i.jsx)(n.td,{children:"NS2.NS3"}),(0,i.jsx)(n.td,{children:"Table3"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["Support for Nested Namespace needs to be explicitly enabled. For details, please refer to ",(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/metastores/iceberg-rest",children:"Iceberg Rest Catalog"})]}),"\n",(0,i.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.h3,{id:"hive-metastore",children:"Hive Metastore"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"3.1+ Version"}),(0,i.jsxs)(a.Z,{children:[(0,i.jsxs)(l.Z,{value:"HDFS",label:"HDFS",default:!0,children:[(0,i.jsx)(n.p,{children:"Access HMS and HDFS services without Kerberos authentication"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hms_on_hdfs_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'warehouse' = 'hdfs://127.0.0.1:8320/user/iceberg/warehouse/iceberg-hms-hdfs-warehouse',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n    'fs.defaultFS' = 'hdfs://127.0.0.1:8320',\n    'hadoop.username' = 'doris'\n);\n"})}),(0,i.jsx)(n.p,{children:"Access HMS and HDFS services with Kerberos authentication enabled"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hms_on_hdfs_kerberos_hdfs_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'warehouse' = 'hdfs://127.0.0.1:8520/iceberg-hms-hdfs-warehouse',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9583',\n    'hive.metastore.client.principal' = 'hive/presto-master.docker.cluster@LABS.TERADATA.COM',\n    'hive.metastore.client.keytab' = '/keytabs/hive-presto-master.keytab',\n    'hive.metastore.service.principal' = 'hive/hadoop-master@LABS.TERADATA.COM',\n    'hive.metastore.sasl.enabled ' = 'true',\n    'hive.metastore.authentication.type' = 'kerberos',\n    'hadoop.security.auth_to_local' = 'RULE:[2:\\$1@\\$0](.*@LABS.TERADATA.COM)s/@.*//\n    RULE:[2:\\$1@\\$0](.*@OTHERLABS.TERADATA.COM)s/@.*//\n    RULE:[2:\\$1@\\$0](.*@OTHERREALM.COM)s/@.*//\n    DEFAULT',\n    'fs.defaultFS' = 'hdfs://127.0.0.1:8520',\n    'hadoop.security.authentication' = 'kerberos',\n    'hadoop.kerberos.principal'='hive/presto-master.docker.cluster@LABS.TERADATA.COM',\n    'hadoop.kerberos.keytab' = '/keytabs/hive-presto-master.keytab'\n);\n"})})]}),(0,i.jsxs)(l.Z,{value:"S3",label:"S3",children:[(0,i.jsx)(n.p,{children:"Access HMS without Kerberos authentication"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hms_on_s3_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n    'warehouse' = 's3://selectdb-qa-datalake-test-hk/refactor-test/iceberg-hms-s3-warehouse',\n    's3.region' = 'ap-east-1',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>'\n);\n"})}),(0,i.jsx)(n.p,{children:"Obtaining S3 access credentials using an IAM Assumed Role (3.1.2+)"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hms_on_s3_iamrole PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n    'warehouse' = 's3://bucket/warehouse',\n    's3.region' = 'us-east-1',\n    's3.role_arn' = 'arn:aws:iam::543815668950:role/role'\n);\n"})})]}),(0,i.jsxs)(l.Z,{value:"OSS",label:"OSS",children:[(0,i.jsx)(n.p,{children:"Access HMS without Kerberos authentication"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hms_on_oss_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'warehouse' = 'oss://bucket/iceberg/iceberg-hms-warehouse',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9083',\n    'oss.region' = 'cn-beijing',\n    'oss.endpoint' = 'oss-cn-beijing.aliyuncs.com',\n    'oss.access_key' = '<ak>',\n    'oss.secret_key' = '<sk>'\n);\n"})}),(0,i.jsx)(n.p,{children:"Access HMS with Kerberos authentication enabled"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hms_on_oss_kerberos_new_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'warehouse' = 'oss://bucket/iceberg/iceberg-hms-warehouse',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9583',\n    'hive.metastore.client.principal' = 'presto-server/presto-master.docker.cluster@LABS.TERADATA.COM',\n    'hive.metastore.client.keytab' = '/keytabs/presto-server.keytab',\n    'hive.metastore.authentication.type' = 'kerberos',\n    'hive.metastore.service.principal' = 'hive/hadoop-master@LABS.TERADATA.COM',\n    'hive.metastore.sasl.enabled ' = 'true',\n    'hadoop.security.auth_to_local' = 'RULE:[2:\\$1@\\$0](.*@LABS.TERADATA.COM)s/@.*//\n    RULE:[2:\\$1@\\$0](.*@OTHERLABS.TERADATA.COM)s/@.*//\n    RULE:[2:\\$1@\\$0](.*@OTHERREALM.COM)s/@.*//\n    DEFAULT',\n    'oss.region' = 'cn-beijing',\n    'oss.endpoint' = 'oss-cn-beijing.aliyuncs.com',\n    'oss.access_key' = '<ak>',\n    'oss.secret_key' = '<sk>'\n);\n"})})]}),(0,i.jsxs)(l.Z,{value:"COS",label:"COS",children:[(0,i.jsx)(n.p,{children:"Access HMS without Kerberos authentication"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG `iceberg_hms_on_cos_catalog` PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'warehouse' = 'cos://bucket/iceberg-hms-cos-warehouse',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n    'cos.region' = 'ap-beijing',\n    'cos.endpoint' = 'cos.ap-beijing.myqcloud.com',\n    'cos.secret_key' = '<sk>',\n    'cos.access_key' = '<ak>'\n);\n"})}),(0,i.jsx)(n.p,{children:"Access HMS with Kerberos authentication enabled"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG `iceberg_hms_on_cos_kerberos_new_catalog` PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'warehouse' = 'cos://bucket/iceberg-hms-cos-warehouse',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9583',\n    'hive.metastore.service.principal' = 'hive/hadoop-master@LABS.TERADATA.COM',\n    'hive.metastore.sasl.enabled' = 'true',\n    'hive.metastore.client.principal' = 'hive/presto-master.docker.cluster@LABS.TERADATA.COM',\n    'hive.metastore.client.keytab' = '/keytabs/keytabs/hive-presto-master.keytab',\n    'hadoop.security.auth_to_local' = 'RULE:[2:$1@$0](.*@LABS.TERADATA.COM)s/@.*//\n    RULE:[2:$1@$0](.*@OTHERLABS.TERADATA.COM)s/@.*//\n    RULE:[2:$1@$0](.*@OTHERREALM.COM)s/@.*//\n    DEFAULT',\n    'cos.region' = 'ap-beijing',\n    'cos.endpoint' = 'cos.ap-beijing.myqcloud.com',\n    'cos.secret_key' = '<sk>',\n    'cos.access_key' = '<ak>'\n);\n"})})]}),(0,i.jsxs)(l.Z,{value:"OBS",label:"OBS",children:[(0,i.jsx)(n.p,{children:"Access HMS without Kerberos authentication"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG test_iceberg_on_hms_obs_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'warehouse' = 'obs://bucket/regression/iceberg',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n    'obs.region' = 'cn-north-4',\n    'obs.endpoint' = 'obs.cn-north-4.myhuaweicloud.com',\n    'obs.access_key' = '<ak>',\n    'obs.secret_key' = '<sk>'\n);\n"})}),(0,i.jsx)(n.p,{children:"Access HMS with Kerberos authentication enabled"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG obs PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'warehouse' = 'obs://bucket/regression/iceberg1',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9583',\n    'hive.metastore.service.principal' = 'hive/hadoop-master@LABS.TERADATA.COM',\n    'hive.metastore.sasl.enabled' = 'true',\n    'hive.metastore.client.principal' = 'hive/presto-master.docker.cluster@LABS.TERADATA.COM',\n    'hive.metastore.client.keytab' = '/keytabs/hive-presto-master.keytab',\n    'hive.metastore.authentication.type' = 'kerberos',\n    'hadoop.security.auth_to_local' = 'RULE:[2:\\$1@\\$0](.*@LABS.TERADATA.COM)s/@.*//\n    RULE:[2:\\$1@\\$0](.*@OTHERLABS.TERADATA.COM)s/@.*//\n    RULE:[2:\\$1@\\$0](.*@OTHERREALM.COM)s/@.*//\n    DEFAULT',\n    'obs.region' = 'cn-north-4',\n    'obs.endpoint' = 'obs.cn-north-4.myhuaweicloud.com',\n    'obs.access_key' = '<ak>',\n    'obs.secret_key' = '<sk>'\n);\n"})})]}),(0,i.jsx)(l.Z,{value:"GCS",label:"GCS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG `iceberg_hms_on_gcs_kerberos_new_catalog` PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n    'warehouse' = 'gs://bucket/iceberg_warehouse',\n    'gs.access_key' = '<ak>',\n    'gs.secret_key' = '<sk>',\n    'fs.gcs.support'='true'\n);\n"})})}),(0,i.jsxs)(l.Z,{value:"Azure Blob",label:"Azure Blob ",children:[(0,i.jsx)(n.p,{children:"Supported since 3.1.3"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_azure_blob_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'abfs://<container>@<account_name>.dfs.core.windows.net/iceberg-warehouse',\n    'azure.account_name' = '<account_name>',\n    'azure.account_key' = '<account_key>',\n    'azure.endpoint' = 'https://<account_name>.blob.core.windows.net',\n    'fs.azure.support'='true'\n);\n"})})]}),(0,i.jsx)(l.Z,{value:"MinIO",label:"MinIO",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG test_iceberg_on_hms_minio_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'warehouse' = 's3://warehouse/wh',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n    'fs.minio.support' = 'true',\n    'minio.use_path_style' = 'true',\n    'minio.endpoint' = 'http://127.0.0.1:19001',\n    'minio.access_key' = '<ak>',\n    'minio.secret_key' = '<sk>'\n);\n"})})})]})]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"2.1 & 3.0 Version"}),(0,i.jsxs)(a.Z,{children:[(0,i.jsxs)(l.Z,{value:"HDFS",label:"HDFS",default:!0,children:[(0,i.jsx)(n.p,{children:"Access HMS and HDFS services without Kerberos authentication"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hms_on_hdfs_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n    'warehouse' = 'hdfs://127.0.0.1:8320/user/iceberg/warehouse/iceberg-hms-hdfs-warehouse',\n    'hadoop.username' = 'doris',\n    'fs.defaultFS' = 'hdfs://127.0.0.1:8320'\n);\n"})}),(0,i.jsx)(n.p,{children:"Access HMS and HDFS services with Kerberos authentication enabled"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hms_on_hdfs_kerberos_hdfs_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'warehouse' = 'hdfs://127.0.0.1:8520/iceberg-hms-hdfs-warehouse',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9583',\n    'hive.metastore.kerberos.principal' = 'hive/hadoop-master@LABS.TERADATA.COM',\n    'hive.metastore.sasl.enabled ' = 'true',\n    'hive.metastore.authentication.type' = 'kerberos',\n    'hadoop.security.auth_to_local' = 'RULE:[2:\\$1@\\$0](.*@LABS.TERADATA.COM)s/@.*//\n    RULE:[2:\\$1@\\$0](.*@OTHERLABS.TERADATA.COM)s/@.*//\n    RULE:[2:\\$1@\\$0](.*@OTHERREALM.COM)s/@.*//\n    DEFAULT',\n    'fs.defaultFS' = 'hdfs://127.0.0.1:8520',\n    'hadoop.security.authentication' = 'kerberos',\n    'hadoop.kerberos.principal'='hive/presto-master.docker.cluster@LABS.TERADATA.COM',\n    'hadoop.kerberos.keytab' = '/keytabs/hive-presto-master.keytab'\n);\n"})})]}),(0,i.jsx)(l.Z,{value:"S3",label:"S3",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hms_on_s3_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n    'warehouse' = 's3://selectdb-qa-datalake-test-hk/refactor-test/iceberg-hms-s3-warehouse',\n    's3.region' = 'ap-east-1',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"OSS",label:"OSS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hms_on_oss_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9083',\n    'warehouse' = 'oss://bucket/iceberg/iceberg-hms-warehouse',\n    'oss.region' = 'cn-beijing',\n    'oss.endpoint' = 'oss-cn-beijing.aliyuncs.com',\n    'oss.access_key' = '<ak>',\n    'oss.secret_key' = '<sk>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"COS",label:"COS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG `iceberg_hms_on_cos_catalog` PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'warehouse' = 'cos://bucket/iceberg-hms-cos-warehouse',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n    'cos.region' = 'ap-beijing',\n    'cos.endpoint' = 'cos.ap-beijing.myqcloud.com',\n    'cos.secret_key' = '<sk>',\n    'cos.access_key' = '<ak>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"OBS",label:"OBS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG test_iceberg_on_hms_obs_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n    'warehouse' = 'obs://bucket/regression/iceberg',\n    'obs.region' = 'cn-north-4',\n    'obs.endpoint' = 'obs.cn-north-4.myhuaweicloud.com',\n    'obs.access_key' = '<ak>',\n    'obs.secret_key' = '<sk>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"MinIO",label:"MinIO",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG test_iceberg_on_hms_minio_catalog PROPERTIES (\n'type' = 'iceberg',\n'iceberg.catalog.type' = 'hms',\n'warehouse' = 's3://warehouse/iceberg',\n'hive.metastore.uris' = 'thrift://127.0.0.1:9383',\n's3.endpoint' = 'http://127.0.0.1:19001',\n's3.access_key' = '<ak>',\n's3.secret_key' = '<sk>'\n    );\n"})})})]})]}),"\n",(0,i.jsx)(n.h3,{id:"aws-glue",children:"AWS Glue"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"3.1+ Version"}),(0,i.jsx)(a.Z,{children:(0,i.jsxs)(l.Z,{value:"S3",label:"S3",default:!0,children:[(0,i.jsx)(n.p,{children:"AWS Glue and S3 storage services share the same authentication credentials."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG `iceberg_glue_on_s3_catalog_` PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'glue',\n    'warehouse' = 's3://bucket/iceberg-glue-s3-warehouse',\n    'glue.region' = 'ap-northeast-1',\n    'glue.endpoint' = 'https://glue.ap-northeast-1.amazonaws.com',\n    'glue.access_key' = '<ak>',\n    'glue.secret_key' = '<sk>'\n);\n"})}),(0,i.jsx)(n.p,{children:"When Glue service authentication credentials differ from S3 authentication credentials, you can specify S3 authentication credentials separately using the following method."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG `iceberg_glue_on_s3_catalog_` PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'glue',\n    'warehouse' = 's3://selectdb-qa-datalake-test/iceberg-glue-s3-warehouse',\n    'glue.region' = 'ap-northeast-1',\n    'glue.endpoint' = 'https://glue.ap-northeast-1.amazonaws.com',\n    'glue.access_key' = '<ak>',\n    'glue.secret_key' = '<sk>',\n    's3.endpoint' = 's3.ap-northeast-1.amazonaws.com',\n    's3.region' = 'ap-northeast-1',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>'\n);\n"})}),(0,i.jsx)(n.p,{children:"Using IAM Assumed Role to obtain S3 access credentials (Since 3.1.2+)"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG `glue_iceberg_iamrole` PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'glue',\n    'warehouse' = 's3://bucket/warehouse',\n    'glue.region' = 'us-east-1',                    \n    'glue.endpoint' = 'https://glue.us-east-1.amazonaws.com',\n    'glue.role_arn' = '<role_arn>'                \n);\n"})})]})})]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"2.1 & 3.0 Version"}),(0,i.jsx)(a.Z,{children:(0,i.jsxs)(l.Z,{value:"S3",label:"S3",default:!0,children:[(0,i.jsx)(n.p,{children:"AWS Glue and S3 storage services share the same authentication credentials."}),(0,i.jsxs)(n.p,{children:["In non-EC2 environments, you need to use ",(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html",children:"aws configure"})," to configure Credentials information and generate a credentials file in the ~/.aws directory."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG glue PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type' = 'glue',\n    'glue.endpoint' = 'https://glue.us-east-1.amazonaws.com',\n    'glue.access_key' = '<ak>',\n    'glue.secret_key' = '<sk>'\n);\n"})})]})})]}),"\n",(0,i.jsx)(n.h3,{id:"aliyun-dlf",children:"Aliyun DLF"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"3.1+ Version"}),(0,i.jsx)(a.Z,{children:(0,i.jsx)(l.Z,{value:"DLF 1.0",label:"DLF 1.0",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_dlf_catalog_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type'='dlf',\n    'warehouse' = 'oss://bucket/iceberg-dlf-oss-warehouse',\n    'dlf.uid' = '203225413946383283',\n    'dlf.catalog_id' = 'p2_regression_case',\n    'dlf.region' = 'cn-beijing',\n    'dlf.endpoint' = 'datalake.cn-beijing.aliyuncs.com',\n    'dlf.access_key' = '<ak>',\n    'dlf.secret_key' = '<sk>'\n);\n"})})})})]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"2.1 & 3.0 Version"}),(0,i.jsx)(a.Z,{children:(0,i.jsx)(l.Z,{value:"DLF 1.0",label:"DLF 1.0",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_dlf_catalog_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type'='dlf',\n    'warehouse' = 'oss://bucket/iceberg-dlf-oss-warehouse',\n    'dlf.uid' = '203225413946383283',\n    'dlf.catalog.id' = 'catalog_id',\n    'dlf.region' = 'cn-beijing',\n    'dlf.access_key' = '<ak>',\n    'dlf.secret_key' = '<sk>'\n);\n"})})})})]}),"\n",(0,i.jsx)(n.h3,{id:"iceberg-rest-catalog",children:"Iceberg Rest Catalog"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"3.1+ Version"}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(l.Z,{value:"s3",label:"S3",default:!0,children:(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(l.Z,{value:"s3-noauth",label:"No Authentication",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_static_s3 PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 's3://warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:8181',\n    's3.endpoint' = 'https://s3.ap-east-1.amazonaws.com',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>',\n    's3.region' = 'ap-east-1'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"s3-oauth2",label:"OAuth2 Authentication",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG polaris_oauth2_credential_static_s3 PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 'doris_test',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:8181/api/catalog',\n    'iceberg.rest.security.type' = 'oauth2',\n    'iceberg.rest.oauth2.credential' = 'root:secret123',\n    'iceberg.rest.oauth2.server-uri' = 'http://127.0.0.1:8181/api/catalog/v1/oauth/tokens',\n    'iceberg.rest.oauth2.scope' = 'PRINCIPAL_ROLE:ALL',\n    's3.endpoint' = 'https://s3.us-west-2.amazonaws.com',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>',\n    's3.region' = 'us-west-2'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"s3-vended",label:"Vended Credentials",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG gravitino_vended_s3 PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 'warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:9001/iceberg/',\n    'iceberg.rest.vended-credentials-enabled' = 'true'\n);\n"})})})]})}),(0,i.jsx)(l.Z,{value:"oss",label:"OSS",children:(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(l.Z,{value:"oss-noauth",label:"No Authentication",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_static_oss PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 's3://warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:8181',\n    'oss.endpoint' = 'https://oss-cn-beijing.aliyuncs.com',\n    'oss.access_key' = '<ak>',\n    'oss.secret_key' = '<sk>',\n    'oss.region' = 'cn-beijing'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"oss-oauth2",label:"OAuth2 Authentication",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG polaris_oauth2_credential_static_oss PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 'doris_test',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:8181/api/catalog',\n    'iceberg.rest.security.type' = 'oauth2',\n    'iceberg.rest.oauth2.credential' = 'root:secret123',\n    'iceberg.rest.oauth2.server-uri' = 'http://127.0.0.1:8181/api/catalog/v1/oauth/tokens',\n    'iceberg.rest.oauth2.scope' = 'PRINCIPAL_ROLE:ALL',\n    'oss.endpoint' = 'https://oss-cn-beijing.aliyuncs.com',\n    'oss.access_key' = '<ak>',\n    'oss.secret_key' = '<sk>',\n    'oss.region' = 'cn-beijing'\n);\n"})})})]})}),(0,i.jsx)(l.Z,{value:"cos",label:"COS",children:(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(l.Z,{value:"cos-noauth",label:"No Authentication",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_static_cos PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 's3://warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:8181',\n    'cos.endpoint' = 'https://cos.ap-beijing.myqcloud.com',\n    'cos.access_key' = '<ak>',\n    'cos.secret_key' = '<sk>',\n    'cos.region' = 'ap-beijing'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"cos-oauth2",label:"OAuth2 Authentication",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG polaris_oauth2_credential_static_cos PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 'doris_test',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:8181/api/catalog',\n    'iceberg.rest.security.type' = 'oauth2',\n    'iceberg.rest.oauth2.credential' = 'root:secret123',\n    'iceberg.rest.oauth2.server-uri' = 'http://127.0.0.1:8181/api/catalog/v1/oauth/tokens',\n    'iceberg.rest.oauth2.scope' = 'PRINCIPAL_ROLE:ALL',\n    'cos.endpoint' = 'https://cos.ap-beijing.myqcloud.com',\n    'cos.access_key' = '<ak>',\n    'cos.secret_key' = '<sk>',\n    'cos.region' = 'ap-beijing'\n);\n"})})})]})}),(0,i.jsx)(l.Z,{value:"obs",label:"OBS",children:(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(l.Z,{value:"obs-noauth",label:"No Authentication",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_static_obs PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 's3://warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:8181',\n    'obs.endpoint' = 'obs.cn-north-4.myhuaweicloud.com',\n    'obs.access_key' = '<ak>',\n    'obs.secret_key' = '<sk>',\n    'obs.region' = 'cn-north-4'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"obs-oauth2",label:"OAuth2 Authentication",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG polaris_oauth2_credential_static_obs PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 'doris_test',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:8181/api/catalog',\n    'iceberg.rest.security.type' = 'oauth2',\n    'iceberg.rest.oauth2.credential' = 'root:secret123',\n    'iceberg.rest.oauth2.server-uri' = 'http://127.0.0.1:8181/api/catalog/v1/oauth/tokens',\n    'iceberg.rest.oauth2.scope' = 'PRINCIPAL_ROLE:ALL',\n    'obs.endpoint' = 'obs.cn-north-4.myhuaweicloud.com',\n    'obs.access_key' = '<ak>',\n    'obs.secret_key' = '<sk>',\n    'obs.region' = 'cn-north-4'\n);\n"})})})]})}),(0,i.jsx)(l.Z,{value:"gcs",label:"GCS",children:(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(l.Z,{value:"gcs-noauth",label:"No Authentication",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_static_gcs PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 'gs://warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:8181',\n    'gs.endpoint' = 'https://storage.googleapis.com',\n    'gs.access_key' = '<ak>',\n    'gs.secret_key' = '<sk>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"gcs-oauth2",label:"OAuth2 Authentication",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG polaris_oauth2_credential_static_gcs PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 'doris_test',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:8181/api/catalog',\n    'iceberg.rest.security.type' = 'oauth2',\n    'iceberg.rest.oauth2.credential' = 'root:secret123',\n    'iceberg.rest.oauth2.server-uri' = 'http://127.0.0.1:8181/api/catalog/v1/oauth/tokens',\n    'iceberg.rest.oauth2.scope' = 'PRINCIPAL_ROLE:ALL',\n    'gs.endpoint' = 'https://storage.googleapis.com',\n    'gs.access_key' = '<ak>',\n    'gs.secret_key' = '<sk>'\n    \n);\n"})})})]})}),(0,i.jsx)(l.Z,{value:"hdfs",label:"HDFS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_static_hdfs PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 'hdfs://127.0.0.1:8020/user/iceberg/warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:8181',\n    'fs.defaultFS' = 'hdfs://127.0.0.1:8020'\n);\n"})})})]})]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"2.1 & 3.0 Version"}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(l.Z,{value:"S3",label:"S3",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_static_s3 PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 's3://warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'uri' = 'http://127.0.0.1:8181',\n    's3.endpoint' = 'https://s3.ap-east-1.amazonaws.com',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>',\n    's3.region' = 'ap-east-1'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"OSS",label:"OSS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_static_oss PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 's3://warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'uri' = 'http://127.0.0.1:8181',\n    's3.endpoint' = 'https://oss-cn-beijing.aliyuncs.com',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>',\n    's3.region' = 'cn-beijing'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"COS",label:"COS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_static_cos PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 's3://warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'uri' = 'http://127.0.0.1:8181',\n    's3.endpoint' = 'https://cos.ap-beijing.myqcloud.com',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>',\n    's3.region' = 'ap-beijing'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"OBS",label:"OBS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_static_obs PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 's3://warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'uri' = 'http://127.0.0.1:8181',\n    's3.endpoint' = 'obs.cn-north-4.myhuaweicloud.com',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>',\n    's3.region' = 'cn-north-4'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"HDFS",label:"HDFS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_static_hdfs PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 'hdfs://127.0.0.1:8020/user/iceberg/warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'uri' = 'http://127.0.0.1:8181',\n    'fs.defaultFS' = 'hdfs://127.0.0.1:8020'\n);\n"})})})]})]}),"\n",(0,i.jsx)(n.h3,{id:"filesystem",children:"FileSystem"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"3.1+ Version"}),(0,i.jsxs)(a.Z,{children:[(0,i.jsxs)(l.Z,{value:"HDFS",label:"HDFS",default:!0,children:[(0,i.jsx)(n.p,{children:"Access HDFS service without Kerberos authentication"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_hdfs_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'hdfs://127.0.0.1:8320/user/iceberg/warehouse/iceberg-fs-hdfs-warehouse',\n    'hadoop.username' = 'doris',\n    'fs.defaultFS' = 'hdfs://127.0.0.1:8320'\n);\n"})}),(0,i.jsx)(n.p,{children:"Access HDFS service with Kerberos authentication enabled"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_hdfs_kerberos_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'hdfs://127.0.0.1:8520/iceberg-fs-hdfs-warehouse',\n    'fs.defaultFS' = 'hdfs://127.0.0.1:8520',\n    'hadoop.security.authentication' = 'kerberos',\n    'hadoop.kerberos.principal'='hive/presto-master.docker.cluster@LABS.TERADATA.COM',\n    'hadoop.kerberos.keytab' = '/keytabs/hive-presto-master.keytab'\n);\n\n"})})]}),(0,i.jsxs)(l.Z,{value:"S3",label:"S3",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_glue_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 's3://selectdb-qa-datalake-test-hk/refactor-test/iceberg-fs-s3-warehouse',\n    's3.region' = 'ap-east-1',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>'\n);\n"})}),(0,i.jsx)(n.p,{children:"Obtaining S3 access credentials using an IAM Assumed Role (3.1.2+)"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_s3_iamrole PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 's3://bucket/warehouse',\n    's3.region' = 'us-east-1',\n    's3.role_arn' = 'arn:aws:iam::543815668950:role/role'\n);\n"})})]}),(0,i.jsx)(l.Z,{value:"COS",label:"COS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_cos_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'cos://doris-build-1308700295/iceberg-fs-cos-warehouse',\n    'cos.region' = 'ap-beijing',\n    'cos.endpoint' = 'cos.ap-beijing.myqcloud.com',\n    'cos.access_key' = '<ak>',\n    'cos.secret_key' = '<sk>'\n);\n\n"})})}),(0,i.jsx)(l.Z,{value:"OSS",label:"OSS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_oss_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'oss://doris-regression-bj/refactor-test/iceberg-fs-oss-warehouse',\n    'oss.region' = 'cn-beijing',\n    'oss.endpoint' = 'oss-cn-beijing.aliyuncs.com',\n    'oss.access_key' = '<ak>',\n    'oss.secret_key' = '<sk>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"OBS",label:"OBS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG test_fs_on_obs_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'obs://bucket/regression/iceberg',\n    'obs.region' = 'cn-north-4',\n    'obs.endpoint' = 'obs.cn-north-4.myhuaweicloud.com',\n    'obs.access_key' = '<ak>',\n    'obs.secret_key' = '<sk>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"GCS",label:"GCS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_gcs_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'gs://bucket/iceberg_warehouse',\n    'fs.gcs.support'='true',\n    'gs.access_key' = '<ak>',\n    'gs.secret_key' = '<sk>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"MinIO",label:"MinIO",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG test_iceberg_fs_on_minio PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type'='hadoop',\n    'warehouse' = 's3://warehouse/wh',\n    'fs.minio.support'='true',\n    'minio.endpoint' = 'http://127.0.0.1:19001',\n    'minio.access_key' = 'admin',\n    'minio.secret_key' = 'password',\n    'minio.use_path_style' = 'true'\n);\n"})})})]})]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"2.1 & 3.0 Version"}),(0,i.jsxs)(a.Z,{children:[(0,i.jsxs)(l.Z,{value:"HDFS",label:"HDFS",default:!0,children:[(0,i.jsx)(n.p,{children:"Access HDFS service without Kerberos authentication"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_hdfs_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'hdfs://127.0.0.1:8320/user/iceberg/warehouse/iceberg-fs-hdfs-warehouse',\n    'hadoop.username' = 'doris',\n    'fs.defaultFS' = 'hdfs://127.0.0.1:8320'\n);\n"})}),(0,i.jsx)(n.p,{children:"Access HDFS service with Kerberos authentication enabled"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_hdfs_kerberos_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'hdfs://127.0.0.1:8520/iceberg-fs-hdfs-warehouse',\n    'fs.defaultFS' = 'hdfs://127.0.0.1:8520',\n    'hadoop.security.authentication' = 'kerberos',\n    'hadoop.kerberos.principal'='hive/presto-master.docker.cluster@LABS.TERADATA.COM',\n    'hadoop.kerberos.keytab' = '/keytabs/hive-presto-master.keytab'\n);\n"})})]}),(0,i.jsx)(l.Z,{value:"S3",label:"S3",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_s3_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 's3://selectdb-qa-datalake-test-hk/refactor-test/iceberg-fs-s3-warehouse',\n    's3.region' = 'ap-east-1',\n    's3.endpoint' = 's3.ap-east-1.amazonaws.com',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"COS",label:"COS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_cos_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'cos://doris-build-1308700295/iceberg-fs-cos-warehouse',\n    'cos.region' = 'ap-beijing',\n    'cos.endpoint' = 'cos.ap-beijing.myqcloud.com',\n    'cos.access_key' = '<ak>',\n    'cos.secret_key' = '<sk>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"OSS",label:"OSS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_oss_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'oss://bucket/refactor-test/iceberg-fs-oss-warehouse',\n    'oss.region' = 'cn-beijing',\n    'oss.endpoint' = 'oss-cn-beijing.aliyuncs.com',\n    'oss.access_key' = '<ak>',\n    'oss.secret_key' = '<sk>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"GCS",label:"GCS",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_fs_on_gcs_catalog PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type'='hadoop',\n    'warehouse' = 's3://bucket/iceberg_warehouse',\n    'gs.endpoint'='storage.googleapis.com',\n    'gs.access_key' = '<ak>',\n    'gs.secret_key' = '<sk>'\n);\n"})})}),(0,i.jsx)(l.Z,{value:"MinIO",label:"MinIO",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG test_iceberg_fs_on_minio PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type'='hadoop',\n    'warehouse' = 's3://warehouse/wh',\n    's3.region' = 'ap-east-1',\n    's3.endpoint' = 'http://minio:9000',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>'\n);\n"})})})]})]}),"\n",(0,i.jsx)(n.h3,{id:"aws-s3-tables",children:"AWS S3 Tables"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"3.1+ Version"}),(0,i.jsxs)(a.Z,{children:[(0,i.jsxs)(l.Z,{value:"S3 Tables Rest Catalog",label:"S3 Tables Rest Catalog",default:!0,children:[(0,i.jsxs)(n.p,{children:["Please refer to the ",(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/best-practices/doris-aws-s3tables",children:"S3 Tables Integration"})," documentation."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG aws_s3_tables PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'rest',\n    'warehouse' = 'arn:aws:s3tables:us-east-1:<account_id>:bucket/<s3_table_bucket_name>',\n    'iceberg.rest.uri' = 'https://s3tables.us-east-1.amazonaws.com/iceberg',\n    'iceberg.rest.sigv4-enabled' = 'true',\n    'iceberg.rest.signing-name' = 's3tables',\n    'iceberg.rest.signing-region' = 'us-east-1',\n    'iceberg.rest.access-key-id' = '<ak>',\n    'iceberg.rest.secret-access-key' = '<sk>'\n);\n"})})]}),(0,i.jsxs)(l.Z,{value:"AWS Glue Rest Catalog",label:"AWS Glue Rest Catalog",default:!0,children:[(0,i.jsxs)(n.p,{children:["Please refer to the ",(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/best-practices/doris-aws-s3tables",children:"S3 Tables Integration"})," documentation."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG glue_s3 PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'https://glue.ap-east-1.amazonaws.com/iceberg',\n    'warehouse' = '<acount_id>:s3tablescatalog/<s3_table_bucket_name>',\n    'iceberg.rest.sigv4-enabled' = 'true',\n    'iceberg.rest.signing-name' = 'glue',\n    'iceberg.rest.access-key-id' = '<ak>',\n    'iceberg.rest.secret-access-key' = '<sk>',\n    'iceberg.rest.signing-region' = 'ap-east-1'\n);\n"})})]}),(0,i.jsxs)(l.Z,{value:"FileSystem Catalog",label:"FileSystem Catalog",default:!0,children:[(0,i.jsxs)(n.p,{children:["Please refer to the ",(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/best-practices/doris-aws-s3tables",children:"S3 Tables Integration"})," documentation."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG test_s3tables_write_insert PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 's3tables',\n    'warehouse' = 'arn:aws:s3tables:ap-east-1:12345:bucket/doris-s3-table-bucket',\n    's3.region' = 'ap-east-1',\n    's3.endpoint' = 'https://s3.ap-east-1.amazonaws.com',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>'\n);\n"})})]})]})]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"3.0.6+ Version"}),(0,i.jsxs)(l.Z,{value:"FileSystem Catalog",label:"FileSystem Catalog",default:!0,children:[(0,i.jsxs)(n.p,{children:["Please refer to the ",(0,i.jsx)(n.a,{href:"/docs/2.1/lakehouse/best-practices/doris-aws-s3tables",children:"S3 Tables Integration"})," documentation."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG test_s3tables_catalog PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 's3tables',\n    'warehouse' = 'arn:aws:s3tables:ap-east-1:9527:bucket/doris-s3-table-bucket',\n    's3.region' = 'ap-east-1',\n    's3.endpoint' = 'https://s3.ap-east-1.amazonaws.com',\n    's3.access_key' = '<ak>',\n    's3.secret_key' = '<sk>'\n);\n"})})]})]}),"\n",(0,i.jsx)(n.h2,{id:"query-operations",children:"Query Operations"}),"\n",(0,i.jsx)(n.h3,{id:"basic-query",children:"Basic Query"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- 1. switch to catalog, use database and query\nSWITCH iceberg;\nUSE iceberg_db;\nSELECT * FROM iceberg_tbl LIMIT 10;\n\n-- 2. use iceberg database directly\nUSE iceberg.iceberg_db;\nSELECT * FROM iceberg_tbl LIMIT 10;\n\n-- 3. use full qualified name to query\nSELECT * FROM iceberg.iceberg_db.iceberg_tbl LIMIT 10;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"time-travel",children:"Time Travel"}),"\n",(0,i.jsx)(n.p,{children:"You can read a specific snapshot of an Iceberg table."}),"\n",(0,i.jsx)(n.p,{children:"By default, read requests will access the latest snapshot version."}),"\n",(0,i.jsxs)(n.p,{children:["You can query a specific snapshot of an Iceberg table using the ",(0,i.jsx)(n.code,{children:"iceberg_meta()"})," table function:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'SELECT * FROM iceberg_meta(\n    \'table\' = \'iceberg_ctl.iceberg_db.iceberg_tbl\',\n    \'query_type\' = \'snapshots\'\n)\\G\n\n*************************** 1. row ***************************\n committed_at: 2024-11-28 11:07:29\n  snapshot_id: 8903826400153112036\n    parent_id: -1\n    operation: append\nmanifest_list: oss://path/to/metadata/snap-8903826400153112036-1-3835e66d-9a18-4cb0-b9b0-9ec80527ad8d.avro\n      summary: {"added-data-files":"2","added-records":"3","added-files-size":"2742","changed-partition-count":"2","total-records":"3","total-files-size":"2742","total-data-files":"2","total-delete-files":"0","total-position-deletes":"0","total-equality-deletes":"0"}\n*************************** 2. row ***************************\n committed_at: 2024-11-28 11:10:11\n  snapshot_id: 6099853805930794326\n    parent_id: 8903826400153112036\n    operation: append\nmanifest_list: oss://path/to/metadata/snap-6099853805930794326-1-dd46a1bd-219b-4fb0-bb46-ac441d8b3105.avro\n      summary: {"added-data-files":"1","added-records":"1","added-files-size":"1367","changed-partition-count":"1","total-records":"4","total-files-size":"4109","total-data-files":"3","total-delete-files":"0","total-position-deletes":"0","total-equality-deletes":"0"}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["You can use the ",(0,i.jsx)(n.code,{children:"FOR TIME AS OF"})," and ",(0,i.jsx)(n.code,{children:"FOR VERSION AS OF"})," clauses to read historical data based on snapshot ID or the time the snapshot was created. Here are some examples:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Read data as of a specific timestamp\nSELECT * FROM iceberg_table FOR TIME AS OF '2023-01-01 00:00:00';\n\n-- Read data as of a specific snapshot ID\nSELECT * FROM iceberg_table FOR VERSION AS OF 123456789;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"branch-and-tag",children:"Branch and Tag"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Since 3.1.0"}),"\n",(0,i.jsx)(n.p,{children:"For creating, dropping and managing branch and tag, please refer to [Managing Branch & Tag]"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Reading specific branches and tags of Iceberg tables is supported."}),"\n",(0,i.jsx)(n.p,{children:"Multiple syntax forms are supported to be compatible with systems such as Spark/Trino."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'-- BRANCH\nSELECT * FROM iceberg_tbl@branch(branch1);\nSELECT * FROM iceberg_tbl@branch("name" = "branch1");\nSELECT * FROM iceberg_tbl FOR VERSION AS OF \'branch1\';\n\n-- TAG\nSELECT * FROM iceberg_tbl@tag(tag1);\nSELECT * FROM iceberg_tbl@tag("name" = "tag1");\nSELECT * FROM iceberg_tbl FOR VERSION AS OF \'tag1\';\n'})}),"\n",(0,i.jsxs)(n.p,{children:["For the ",(0,i.jsx)(n.code,{children:"FOR VERSION AS OF"})," syntax, Doris will automatically determine whether the parameter is a timestamp or a Branch/Tag name."]}),"\n",(0,i.jsx)(n.h3,{id:"view",children:"View"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Since 3.1.0"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Supports querying Iceberg views. View queries work the same way as regular table queries. Please note the following:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Only ",(0,i.jsx)(n.code,{children:"hms"})," type Iceberg Catalog is supported."]}),"\n",(0,i.jsx)(n.li,{children:"The view definition SQL must be compatible with Doris SQL dialect, otherwise parsing errors will occur. (Dialect conversion functionality will be provided in future versions)."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"system-tables",children:"System Tables"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Since 3.1.0"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Doris supports querying Iceberg system tables to retrieve metadata information about tables. You can use system tables to view snapshot history, manifest files, data files, partitions, and other metadata."}),"\n",(0,i.jsxs)(n.p,{children:["To access metadata of an Iceberg table, append a ",(0,i.jsx)(n.code,{children:"$"})," symbol followed by the system table name to the table name:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$system_table_name;\n"})}),"\n",(0,i.jsx)(n.p,{children:"For example, to view the table's history, you can execute:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$history;\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Currently, the ",(0,i.jsx)(n.code,{children:"all_manifests"})," and ",(0,i.jsx)(n.code,{children:"position_deletes"})," system tables are not yet supported and are planned to be supported in future versions."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"entries",children:"entries"}),"\n",(0,i.jsx)(n.p,{children:"Shows all manifest entries for the current snapshot of the table:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"all_entries"})," and ",(0,i.jsx)(n.code,{children:"entries"})," are similar, with the difference that ",(0,i.jsx)(n.code,{children:"all_entries"})," contains entries from all snapshots, while ",(0,i.jsx)(n.code,{children:"entries"})," only contains entries from the current snapshot."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$entries;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'+--------+---------------------+-----------------+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| status | snapshot_id         | sequence_number | file_sequence_number | data_file                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | readable_metrics                                                                                                                                                                                                                                                   |\n+--------+---------------------+-----------------+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n|      2 | 4890031351138056789 |               1 |                    1 | {"content":0, "file_path":"s3://.../iceberg_table/data/id=1/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00001.parquet", "file_format":"PARQUET", "spec_id":0, "partition":{"id":1}, "record_count":1, "file_size_in_bytes":625, "column_sizes":{1:36, 2:41}, "value_counts":{1:1, 2:1}, "null_value_counts":{1:0, 2:0}, "nan_value_counts":{}, "lower_bounds":{1:"   ", 2:"Alice"}, "upper_bounds":{1:"   ", 2:"Alice"}, "key_metadata":null, "split_offsets":[4], "equality_ids":null, "sort_order_id":0, "first_row_id":null, "referenced_data_file":null, "content_offset":null, "content_size_in_bytes":null} | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":1, "upper_bound":1}, "name":{"column_size":41, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Alice", "upper_bound":"Alice"}} |\n|      0 | 1851184769713369003 |               1 |                    1 | {"content":0, "file_path":"s3://.../iceberg_table/data/id=2/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00002.parquet", "file_format":"PARQUET", "spec_id":0, "partition":{"id":2}, "record_count":1, "file_size_in_bytes":611, "column_sizes":{1:36, 2:39}, "value_counts":{1:1, 2:1}, "null_value_counts":{1:0, 2:0}, "nan_value_counts":{}, "lower_bounds":{1:"   ", 2:"Bob"}, "upper_bounds":{1:"   ", 2:"Bob"}, "key_metadata":null, "split_offsets":[4], "equality_ids":null, "sort_order_id":0, "first_row_id":null, "referenced_data_file":null, "content_offset":null, "content_size_in_bytes":null}     | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":2, "upper_bound":2}, "name":{"column_size":39, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Bob", "upper_bound":"Bob"}}     |\n+--------+---------------------+-----------------+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n'})}),"\n",(0,i.jsx)(n.h3,{id:"files",children:"files"}),"\n",(0,i.jsx)(n.p,{children:"Shows file list for the current snapshot of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$files;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+---------+-----------+--------------+--------------------+--------------+--------------+-------------------+------------------+-----------------------+-----------------------+--------------+---------------+--------------+---------------+--------------+----------------------+----------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| content | file_path                                                                                       | file_format | spec_id | partition | record_count | file_size_in_bytes | column_sizes | value_counts | null_value_counts | nan_value_counts | lower_bounds          | upper_bounds          | key_metadata | split_offsets | equality_ids | sort_order_id | first_row_id | referenced_data_file | content_offset | content_size_in_bytes | readable_metrics                                                                                                                                                                                                                                                   |\n+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+---------+-----------+--------------+--------------------+--------------+--------------+-------------------+------------------+-----------------------+-----------------------+--------------+---------------+--------------+---------------+--------------+----------------------+----------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n|       0 | s3://.../iceberg_table/data/id=2/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00002.parquet  | PARQUET     |       0 | {"id":2}  |            1 |                611 | {1:36, 2:39} | {1:1, 2:1}   | {1:0, 2:0}        | {}               | {1:"   ", 2:"Bob"}   | {1:"   ", 2:"Bob"}   | NULL         | [4]           | NULL         |             0 |         NULL | NULL                 |           NULL |                  NULL | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":2, "upper_bound":2}, "name":{"column_size":39, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Bob", "upper_bound":"Bob"}}     |\n|       0 | s3://.../iceberg_table/data/id=4/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00004.parquet  | PARQUET     |       0 | {"id":4}  |            1 |                618 | {1:36, 2:40} | {1:1, 2:1}   | {1:0, 2:0}        | {}               | {1:"   ", 2:"Dave"}  | {1:"   ", 2:"Dave"}  | NULL         | [4]           | NULL         |             0 |         NULL | NULL                 |           NULL |                  NULL | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":4, "upper_bound":4}, "name":{"column_size":40, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Dave", "upper_bound":"Dave"}}   |\n|       0 | s3://.../iceberg_table/data/id=6/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00006.parquet  | PARQUET     |       0 | {"id":6}  |            1 |                625 | {1:36, 2:41} | {1:1, 2:1}   | {1:0, 2:0}        | {}               | {1:"   ", 2:"Frank"} | {1:"   ", 2:"Frank"} | NULL         | [4]           | NULL         |             0 |         NULL | NULL                 |           NULL |                  NULL | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":6, "upper_bound":6}, "name":{"column_size":41, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Frank", "upper_bound":"Frank"}} |\n|       0 | s3://.../iceberg_table/data/id=8/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00008.parquet  | PARQUET     |       0 | {"id":8}  |            1 |                625 | {1:36, 2:41} | {1:1, 2:1}   | {1:0, 2:0}        | {}               | {1:"   ", 2:"Heidi"} | {1:"   ", 2:"Heidi"} | NULL         | [4]           | NULL         |             0 |         NULL | NULL                 |           NULL |                  NULL | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":8, "upper_bound":8}, "name":{"column_size":41, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Heidi", "upper_bound":"Heidi"}} |\n|       0 | s3://.../iceberg_table/data/id=10/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00010.parquet | PARQUET     |       0 | {"id":10} |            1 |                618 | {1:36, 2:40} | {1:1, 2:1}   | {1:0, 2:0}        | {}               | {1:"   ", 2:"Judy"}  | {1:"   ", 2:"Judy"}  | NULL         | [4]           | NULL         |             0 |         NULL | NULL                 |           NULL |                  NULL | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":10, "upper_bound":10}, "name":{"column_size":40, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Judy", "upper_bound":"Judy"}} |\n+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+---------+-----------+--------------+--------------------+--------------+--------------+-------------------+------------------+-----------------------+-----------------------+--------------+---------------+--------------+---------------+--------------+----------------------+----------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Similar to the ",(0,i.jsx)(n.code,{children:"files"})," system table, you can also query specific file type information through the following system tables:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Query data files for the current snapshot\nSELECT * FROM iceberg_table$data_files;\n\n-- Query delete files for the current snapshot\nSELECT * FROM iceberg_table$delete_files;\n\n-- Query all files (including data and delete files) from all snapshots\nSELECT * FROM iceberg_table$all_files;\n\n-- Query data files from all snapshots\nSELECT * FROM iceberg_table$all_data_files;\n\n-- Query delete files from all snapshots\nSELECT * FROM iceberg_table$all_delete_files;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The result format of these tables is similar to the ",(0,i.jsx)(n.code,{children:"files"})," system table, but each focuses specifically on data files or delete files. System tables with the ",(0,i.jsx)(n.code,{children:"all_"})," prefix contain files from all snapshots, not just files from the current snapshot."]}),"\n",(0,i.jsxs)(n.p,{children:["Note: When specific types of files do not exist in the table (for example, querying ",(0,i.jsx)(n.code,{children:"delete_files"})," when there are no delete files in the table), the query result may be empty."]}),"\n",(0,i.jsx)(n.h3,{id:"history",children:"history"}),"\n",(0,i.jsx)(n.p,{children:"Shows all history of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$history;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"+----------------------------+---------------------+---------------------+---------------------+\n| made_current_at            | snapshot_id         | parent_id           | is_current_ancestor |\n+----------------------------+---------------------+---------------------+---------------------+\n| 2025-06-12 22:29:16.357000 | 1851184769713369003 |                NULL |                   1 |\n| 2025-06-12 22:29:39.922000 | 4890031351138056789 | 1851184769713369003 |                   1 |\n+----------------------------+---------------------+---------------------+---------------------+\n"})}),"\n",(0,i.jsx)(n.h3,{id:"manifests",children:"manifests"}),"\n",(0,i.jsx)(n.p,{children:"Shows manifest file info of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$manifests;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'+---------+------------------------------------------------------------------------------------------------------------------------------------------------+--------+-------------------+---------------------+------------------------+---------------------------+--------------------------+--------------------------+-----------------------------+----------------------------+--------------------------------------------------------------------------------+\n| content | path                                                                         | length | partition_spec_id | added_snapshot_id   | added_data_files_count | existing_data_files_count | deleted_data_files_count | added_delete_files_count | existing_delete_files_count | deleted_delete_files_count | partition_summaries                                                            |\n+---------+------------------------------------------------------------------------------------------------------------------------------------------------+--------+-------------------+---------------------+------------------------+---------------------------+--------------------------+--------------------------+-----------------------------+----------------------------+--------------------------------------------------------------------------------+\n|       0 | s3://.../iceberg_table/metadata/3194eb8b-5ea4-4cbe-95ba-073229458e7b-m0.avro |   7138 |                 0 | 4890031351138056789 |                      0 |                         5 |                        5 |                        0 |                           0 |                          0 | [{"contains_null":0, "contains_nan":0, "lower_bound":"1", "upper_bound":"10"}] |\n+---------+------------------------------------------------------------------------------------------------------------------------------------------------+--------+-------------------+---------------------+------------------------+---------------------------+--------------------------+--------------------------+-----------------------------+----------------------------+--------------------------------------------------------------------------------+\n'})}),"\n",(0,i.jsx)(n.h3,{id:"metadata_log_entries",children:"metadata_log_entries"}),"\n",(0,i.jsx)(n.p,{children:"Shows meta logs of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$metadata_log_entries;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+------------------+------------------------+\n| timestamp                  | file                                                                                     | latest_snapshot_id  | latest_schema_id | latest_sequence_number |\n+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+------------------+------------------------+\n| 2025-06-12 22:29:06.948000 | s3://.../iceberg_table/metadata/00000-e373aa16-15f1-4e69-ae7d-5ed64199cf9a.metadata.json |                NULL |             NULL |                   NULL |\n| 2025-06-12 22:29:16.357000 | s3://.../iceberg_table/metadata/00001-bbc8e244-e41c-4958-92f4-63b8c3ee1196.metadata.json | 1851184769713369003 |                0 |                      1 |\n| 2025-06-12 22:29:39.922000 | s3://.../iceberg_table/metadata/00002-7dc00d6a-6269-4200-9d28-5f8c1c6b9f99.metadata.json | 4890031351138056789 |                0 |                      2 |\n+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+------------------+------------------------+\n"})}),"\n",(0,i.jsx)(n.h3,{id:"partitions",children:"partitions"}),"\n",(0,i.jsx)(n.p,{children:"Shows partitions of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$partitions;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'+-----------+---------+--------------+------------+-------------------------------+------------------------------+----------------------------+------------------------------+----------------------------+----------------------------+--------------------------+\n| partition | spec_id | record_count | file_count | total_data_file_size_in_bytes | position_delete_record_count | position_delete_file_count | equality_delete_record_count | equality_delete_file_count | last_updated_at            | last_updated_snapshot_id |\n+-----------+---------+--------------+------------+-------------------------------+------------------------------+----------------------------+------------------------------+----------------------------+----------------------------+--------------------------+\n| {"id":8}  |       0 |            1 |          1 |                           625 |                            0 |                          0 |                            0 |                          0 | 2025-06-12 22:29:16.357000 |      1851184769713369003 |\n| {"id":6}  |       0 |            1 |          1 |                           625 |                            0 |                          0 |                            0 |                          0 | 2025-06-12 22:29:16.357000 |      1851184769713369003 |\n| {"id":10} |       0 |            1 |          1 |                           618 |                            0 |                          0 |                            0 |                          0 | 2025-06-12 22:29:16.357000 |      1851184769713369003 |\n| {"id":4}  |       0 |            1 |          1 |                           618 |                            0 |                          0 |                            0 |                          0 | 2025-06-12 22:29:16.357000 |      1851184769713369003 |\n| {"id":2}  |       0 |            1 |          1 |                           611 |                            0 |                          0 |                            0 |                          0 | 2025-06-12 22:29:16.357000 |      1851184769713369003 |\n+-----------+---------+--------------+------------+-------------------------------+------------------------------+----------------------------+------------------------------+----------------------------+----------------------------+--------------------------+\n'})}),"\n",(0,i.jsx)(n.p,{children:"Note:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["For non-partitioned tables, the ",(0,i.jsx)(n.code,{children:"partitions"})," table will not contain the ",(0,i.jsx)(n.code,{children:"partition"})," and ",(0,i.jsx)(n.code,{children:"spec_id"})," fields."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"partitions"})," table shows partitions that contain data files or delete files in the current snapshot. However, delete files are not applied, so in some cases, a partition may still be displayed even if all data rows in the partition have been marked as deleted by delete files."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"refs",children:"refs"}),"\n",(0,i.jsx)(n.p,{children:"Shows all known snapshot references (branches and tags) for the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$refs;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"+------+--------+---------------------+-------------------------+-----------------------+------------------------+\n| name | type   | snapshot_id         | max_reference_age_in_ms | min_snapshots_to_keep | max_snapshot_age_in_ms |\n+------+--------+---------------------+-------------------------+-----------------------+------------------------+\n| main | BRANCH | 4890031351138056789 |                    NULL |                  NULL |                   NULL |\n+------+--------+---------------------+-------------------------+-----------------------+------------------------+\n"})}),"\n",(0,i.jsx)(n.h3,{id:"snapshots",children:"snapshots"}),"\n",(0,i.jsx)(n.p,{children:"Shows all snapshots of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$snapshots;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'+----------------------------+---------------------+---------------------+-----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| committed_at               | snapshot_id         | parent_id           | operation | manifest_list                                                                                        | summary                                                                                                                                                                                                                                                                                                                      |\n+----------------------------+---------------------+---------------------+-----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| 2025-06-12 22:29:16.357000 | 1851184769713369003 |                NULL | append    | s3://.../iceberg_table/metadata/snap-1851184769713369003-1-82059f57-821a-4983-b083-002cc2cde313.avro | {"spark.app.id":"application_1738810850199_0472", "added-data-files":"10", "added-records":"10", "added-files-size":"6200", "changed-partition-count":"10", "total-records":"10", "total-files-size":"6200", "total-data-files":"10", "total-delete-files":"0", "total-position-deletes":"0", "total-equality-deletes":"0"}  |\n| 2025-06-12 22:29:39.922000 | 4890031351138056789 | 1851184769713369003 | overwrite | s3://.../iceberg_table/metadata/snap-4890031351138056789-1-3194eb8b-5ea4-4cbe-95ba-073229458e7b.avro | {"spark.app.id":"application_1738810850199_0472", "deleted-data-files":"5", "deleted-records":"5", "removed-files-size":"3103", "changed-partition-count":"5", "total-records":"5", "total-files-size":"3097", "total-data-files":"5", "total-delete-files":"0", "total-position-deletes":"0", "total-equality-deletes":"0"} |\n+----------------------------+---------------------+---------------------+-----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n'})}),"\n",(0,i.jsx)(n.h2,{id:"write-operations",children:"Write Operations"}),"\n",(0,i.jsx)(n.h3,{id:"insert-into",children:"INSERT INTO"}),"\n",(0,i.jsx)(n.p,{children:"The INSERT operation appends data to the target table."}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"INSERT INTO iceberg_tbl VALUES (val1, val2, val3, val4);\nINSERT INTO iceberg.iceberg_db.iceberg_tbl SELECT col1, col2 FROM internal.db1.tbl1;\n\nINSERT INTO iceberg_tbl(col1, col2) VALUES (val1, val2);\nINSERT INTO iceberg_tbl(col1, col2, partition_col1, partition_col2) VALUES (1, 2, 'beijing', '2023-12-12');\n"})}),"\n",(0,i.jsx)(n.p,{children:"Since version 3.1.0, support for writing data to specified branches:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"INSERT INTO iceberg_tbl@branch(b1) values (val1, val2, val3, val4);\nINSERT INTO iceberg_tbl@branch(b1) (col3, col4) values (val3, val4);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"insert-overwrite",children:"INSERT OVERWRITE"}),"\n",(0,i.jsx)(n.p,{children:"The INSERT OVERWRITE operation completely replaces the existing data in the table with new data."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"INSERT OVERWRITE TABLE iceberg_tbl VALUES (val1, val2, val3, val4);\nINSERT OVERWRITE TABLE iceberg.iceberg_db.iceberg_tbl(col1, col2) SELECT col1, col2 FROM internal.db1.tbl1;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Since version 3.1.0, support for writing data to specified branches:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"INSERT OVERWRITE TABLE iceberg_tbl@branch(b1) values (val1, val2, val3, val4);\nINSERT OVERWRITE TABLE iceberg_tbl@branch(b1) (col3, col4) values (val3, val4);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"ctas",children:"CTAS"}),"\n",(0,i.jsxs)(n.p,{children:["You can create an Iceberg table and write data using the ",(0,i.jsx)(n.code,{children:"CTAS"})," (Create Table As Select) statement:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE iceberg_ctas AS SELECT * FROM other_table;\n"})}),"\n",(0,i.jsx)(n.p,{children:"CTAS supports specifying file formats, partitioning, and other properties:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE iceberg_ctas\nPARTITION BY LIST (pt1, pt2) ()\nAS SELECT col1, pt1, pt2 FROM part_ctas_src WHERE col1 > 0;\n\nCREATE TABLE iceberg.iceberg_db.iceberg_ctas (col1, col2, pt1)\nPARTITION BY LIST (pt1) ()\nPROPERTIES (\n    'write-format'='parquet',\n    'compression-codec'='zstd'\n)\nAS SELECT col1, pt1 AS col2, pt2 AS pt1 FROM test_ctas.part_ctas_src WHERE col1 > 0;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"insert-into-branch",children:"INSERT INTO BRANCH"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Since 3.1.0"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"INSERT INTO iceberg_table@branch(b1) SELECT * FROM other_table;\nINSERT OVERWRITE TABLE iceberg_table@branch(b1) SELECT * FROM other_table;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"related-parameters",children:"Related Parameters"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"BE (Backend)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter Name"}),(0,i.jsx)(n.th,{children:"Default Value"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"iceberg_sink_max_file_size"})}),(0,i.jsx)(n.td,{children:"1GB"}),(0,i.jsx)(n.td,{children:"Maximum data file size. When the written data exceeds this size, the current file is closed and a new file is created to continue writing."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"table_sink_partition_write_max_partition_nums_per_writer"})}),(0,i.jsx)(n.td,{children:"128"}),(0,i.jsx)(n.td,{children:"Maximum number of partitions each instance can write to on a BE node."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"table_sink_non_partition_write_scaling_data_processed_threshold"})}),(0,i.jsx)(n.td,{children:"25MB"}),(0,i.jsxs)(n.td,{children:["Data threshold for starting scaling-write in non-partitioned tables. A new writer (instance) is used for every additional ",(0,i.jsx)(n.code,{children:"table_sink_non_partition_write_scaling_data_processed_threshold"})," of data. This mechanism adjusts the number of writers based on data volume to enhance throughput while conserving resources and minimizing file numbers for smaller data volumes."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"table_sink_partition_write_min_data_processed_rebalance_threshold"})}),(0,i.jsx)(n.td,{children:"25MB"}),(0,i.jsxs)(n.td,{children:["Minimum data volume threshold to trigger rebalancing for partitioned tables. Rebalancing starts if ",(0,i.jsx)(n.code,{children:"current accumulated data volume"})," - ",(0,i.jsx)(n.code,{children:"data volume since last rebalancing"})," >= ",(0,i.jsx)(n.code,{children:"table_sink_partition_write_min_data_processed_rebalance_threshold"}),". Lowering this threshold can improve balance if file size differences are significant, but may increase rebalancing costs and impact performance."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"table_sink_partition_write_min_partition_data_processed_rebalance_threshold"})}),(0,i.jsx)(n.td,{}),(0,i.jsxs)(n.td,{children:["Minimum partition data volume threshold to trigger rebalancing. Rebalancing starts if ",(0,i.jsx)(n.code,{children:"current partition data volume"})," >= ",(0,i.jsx)(n.code,{children:"threshold"})," * ",(0,i.jsx)(n.code,{children:"number of tasks already allocated to the partition"}),". Lowering this threshold can improve balance if file size differences are significant, but may increase rebalancing costs and impact performance."]})]})]})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"database-and-table-management",children:"Database and Table Management"}),"\n",(0,i.jsx)(n.h3,{id:"creating-and-dropping-databases",children:"Creating and Dropping Databases"}),"\n",(0,i.jsxs)(n.p,{children:["You can switch to the desired catalog using the ",(0,i.jsx)(n.code,{children:"SWITCH"})," statement and execute the ",(0,i.jsx)(n.code,{children:"CREATE DATABASE"})," command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SWITCH iceberg;\nCREATE DATABASE [IF NOT EXISTS] iceberg_db;\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can also create a database using a fully qualified name or specify a location (currently, only HMS-type catalogs support specifying a location), such as:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE DATABASE [IF NOT EXISTS] iceberg.iceberg_db;\n\nCREATE DATABASE [IF NOT EXISTS] iceberg.iceberg_db\nPROPERTIES ('location'='hdfs://172.21.16.47:4007/path/to/db/');\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can view the database's location information using the ",(0,i.jsx)(n.code,{children:"SHOW CREATE DATABASE"})," command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"mysql> SHOW CREATE DATABASE iceberg_db;\n+-------------+-------------------------------------------------------------------------------------------------+\n| Database    | Create Database                                                                                 |\n+-------------+-------------------------------------------------------------------------------------------------+\n| iceberg_db  | CREATE DATABASE iceberg_db LOCATION 'hdfs://172.21.16.47:4007/usr/hive/warehouse/iceberg_db.db' |\n+-------------+-------------------------------------------------------------------------------------------------+\n"})}),"\n",(0,i.jsx)(n.p,{children:"To drop a database:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"DROP DATABASE [IF EXISTS] iceberg.iceberg_db;\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsx)(n.p,{children:"For an Iceberg Database, you must first drop all tables under the database before you can drop the database itself; otherwise, an error will occur."})}),"\n",(0,i.jsx)(n.h3,{id:"creating-and-dropping-tables",children:"Creating and Dropping Tables"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Creating Tables"})}),"\n",(0,i.jsx)(n.p,{children:"Doris supports creating both partitioned and non-partitioned tables in Iceberg."}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Create unpartitioned iceberg table\nCREATE TABLE unpartitioned_table (\n  `col1` BOOLEAN COMMENT 'col1',\n  `col2` INT COMMENT 'col2',\n  `col3` BIGINT COMMENT 'col3',\n  `col4` FLOAT COMMENT 'col4',\n  `col5` DOUBLE COMMENT 'col5',\n  `col6` DECIMAL(9,4) COMMENT 'col6',\n  `col7` STRING COMMENT 'col7',\n  `col8` DATE COMMENT 'col8',\n  `col9` DATETIME COMMENT 'col9'\n)\nPROPERTIES (\n  'write-format'='parquet'\n);\n\n-- Create partitioned iceberg table\n-- The partition columns must be in table's column definition list\nCREATE TABLE partition_table (\n  `ts` DATETIME COMMENT 'ts',\n  `col1` BOOLEAN COMMENT 'col1',\n  `col2` INT COMMENT 'col2',\n  `col3` BIGINT COMMENT 'col3',\n  `col4` FLOAT COMMENT 'col4',\n  `col5` DOUBLE COMMENT 'col5',\n  `col6` DECIMAL(9,4) COMMENT 'col6',\n  `col7` STRING COMMENT 'col7',\n  `col8` DATE COMMENT 'col8',\n  `col9` DATETIME COMMENT 'col9',\n  `pt1` STRING COMMENT 'pt1',\n  `pt2` STRING COMMENT 'pt2'\n)\nPARTITION BY LIST (day(ts), pt1, pt2) ()\nPROPERTIES (\n  'write-format'='orc',\n  'compression-codec'='zlib'\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["After creation, you can use the ",(0,i.jsx)(n.code,{children:"SHOW CREATE TABLE"})," command to view the Iceberg table creation statement. For details about partition functions, see the ",(0,i.jsx)(n.a,{href:"#",children:"Partitioning"})," section."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Dropping Tables"})}),"\n",(0,i.jsxs)(n.p,{children:["You can drop an Iceberg table using the ",(0,i.jsx)(n.code,{children:"DROP TABLE"})," statement. Dropping a table will also remove its data, including partition data."]}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"DROP TABLE [IF EXISTS] iceberg_tbl;\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Column Type Mapping"})}),"\n",(0,i.jsxs)(n.p,{children:["Refer to the ",(0,i.jsx)(n.a,{href:"#",children:"Column Type Mapping"})," section."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Partitioning"})}),"\n",(0,i.jsx)(n.p,{children:"Partition types in Iceberg correspond to List partitions in Doris. Therefore, when creating an Iceberg partitioned table in Doris, you should use the List partitioning syntax, but you don't need to explicitly enumerate each partition. Doris will automatically create the corresponding Iceberg partitions based on the data values during data insertion."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Supports creating single-column or multi-column partitioned tables."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Supports partition transformation functions to enable Iceberg implicit partitioning and partition evolution. For specific Iceberg partition transformation functions, see ",(0,i.jsx)(n.a,{href:"https://iceberg.apache.org/spec/#partition-transforms",children:"Iceberg partition transforms"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"year(ts)"})," or ",(0,i.jsx)(n.code,{children:"years(ts)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"month(ts)"})," or ",(0,i.jsx)(n.code,{children:"months(ts)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"day(ts)"})," or ",(0,i.jsx)(n.code,{children:"days(ts)"})," or ",(0,i.jsx)(n.code,{children:"date(ts)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hour(ts)"})," or ",(0,i.jsx)(n.code,{children:"hours(ts)"})," or ",(0,i.jsx)(n.code,{children:"date_hour(ts)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"bucket(N, col)"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"truncate(L, col)"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"File Formats"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Parquet (default)"}),"\n",(0,i.jsxs)(n.p,{children:["Note that for the Iceberg table created by Doris, the Datetime corresponds to the ",(0,i.jsx)(n.code,{children:"timestamp_ntz"})," type."]}),"\n",(0,i.jsx)(n.p,{children:"In versions after 3.1.0, when the Datetime type is written to the Parquet file, the physical type used is INT64 instead of INT96."}),"\n",(0,i.jsxs)(n.p,{children:["And if the Iceberg table is created by other systems, although the ",(0,i.jsx)(n.code,{children:"timestamp"})," and ",(0,i.jsx)(n.code,{children:"timestamp_ntz"})," types are both mapped to the Doris Datetime type. However, when writing, it will determine whether the time zone needs to be processed based on the actual type."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"ORC"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Compression Formats"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Parquet: snappy, zstd (default), plain (no compression)."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"ORC: snappy, zlib (default), zstd, plain (no compression)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Storage Medium"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"HDFS"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Object storage"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"schema-change",children:"Schema Change"}),"\n",(0,i.jsxs)(n.p,{children:["Start from 3.1.0, Doris supports schema changes for Iceberg tables, which can be modified using the ",(0,i.jsx)(n.code,{children:"ALTER TABLE"})," statement."]}),"\n",(0,i.jsx)(n.p,{children:"Supported schema change operations include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rename Column"})}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"RENAME COLUMN"})," clause to rename columns. Renaming columns within nested types is not supported."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table RENAME COLUMN old_col_name TO new_col_name;\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Add a Column"})}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"ADD COLUMN"})," to add a new column. Adding new columns to nested types is not supported."]}),"\n",(0,i.jsx)(n.p,{children:"When adding a new column, you can specify nullable attributes, default values, comments, and column position."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table ADD COLUMN col_name col_type [NULL|NOT NULL, [DEFAULT default_value, [COMMENT 'comment', [FIRST|AFTER col_name]]]];\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table ADD COLUMN new_col STRING NOT NULL DEFAULT 'default_value' COMMENT 'This is a new col' AFTER old_col;\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Add Columns"})}),"\n",(0,i.jsxs)(n.p,{children:["You can also use ",(0,i.jsx)(n.code,{children:"ADD COLUMN"})," to add multiple columns. The new columns will be added to the end of the table. Column positioning is not supported for multiple columns. Adding new columns to nested types is not supported."]}),"\n",(0,i.jsx)(n.p,{children:"The syntax for each column is the same as adding a single column."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table ADD COLUMN (col_name1 col_type1 [NULL|NOT NULL, [DEFAULT default_value, [COMMENT 'comment']]], col_name2 col_type2 [NULL|NOT NULL, [DEFAULT default_value, [COMMENT 'comment']]] ...);\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Drop Column"})}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"DROP COLUMN"})," to drop columns. Dropping columns within nested types is not supported."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table DROP COLUMN col_name;\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Modify Column"})}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"MODIFY COLUMN"})," statement to modify column attributes, including type, nullable, default value, comment, and column position."]}),"\n",(0,i.jsx)(n.p,{children:"Note: When modifying column attributes, all attributes that are not being modified should also be explicitly specified with their original values."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table MODIFY COLUMN col_name col_type [NULL|NOT NULL, [DEFAULT default_value, [COMMENT 'comment', [FIRST|AFTER col_name]]]];\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE iceberg_table (\n    id INT,\n    name STRING\n);\n-- Modify the id column type to BIGINT, set as NOT NULL, default value to 0, and add comment\nALTER TABLE iceberg_table MODIFY COLUMN id BIGINT NOT NULL DEFAULT 0 COMMENT 'This is a modified id column';\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Reorder Columns"})}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"ORDER BY"})," to reorder columns by specifying the new column order."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table ORDER BY (col_name1, col_name2, ...);\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"partition-evolution",children:"Partition Evolution"}),"\n",(0,i.jsxs)(n.p,{children:["Starting from version 4.0.2, Doris supports Partition Evolution for Iceberg tables through ",(0,i.jsx)(n.code,{children:"ALTER"})," statements."]}),"\n",(0,i.jsx)(n.p,{children:"Supported partition transforms include:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Transform"}),(0,i.jsx)(n.th,{children:"Syntax"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"bucket"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bucket(N, column)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bucket(16, id)"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"truncate"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"truncate(N, column)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"truncate(10, name)"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"year"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"year(column)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"year(ts)"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"month"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"month(column)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"month(ts)"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"day"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"day(column)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"day(ts)"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"hour"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hour(column)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hour(ts)"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"identity"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"column"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"category"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Supported operations include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Add partition key"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- use optional AS keyword to specify a custom name for the partition field\nALTER TABLE table_name ADD PARTITION KEY partition_transform [AS key_name];\n\n-- example\nALTER TABLE prod.db.sample ADD PARTITION KEY bucket(16, id);\nALTER TABLE prod.db.sample ADD PARTITION KEY truncate(4, data);\nALTER TABLE prod.db.sample ADD PARTITION KEY year(ts);\n-- use optional AS keyword to specify a custom name for the partition field \nALTER TABLE prod.db.sample ADD PARTITION KEY bucket(16, id) AS shard;\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Drop partition key"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE table_name DROP PARTITION KEY partition_transform\uFF5Ckey_name;\n\n-- example\nALTER TABLE prod.db.sample DROP PARTITION KEY catalog;\nALTER TABLE prod.db.sample DROP PARTITION KEY bucket(16, id);\nALTER TABLE prod.db.sample DROP PARTITION KEY truncate(4, data);\nALTER TABLE prod.db.sample DROP PARTITION KEY year(ts);\nALTER TABLE prod.db.sample DROP PARTITION KEY shard;\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Replace partition key"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- use optional AS keyword to specify a custom name for the partition field\nALTER TABLE table_name REPLACE PARTITION KEY key_name WITH partition_transform [AS key_name];\n\n-- example\nALTER TABLE prod.db.sample REPLACE PARTITION KEY ts_day WITH day(ts);\n-- use optional AS keyword to specify a custom name for the new partition field \nALTER TABLE prod.db.sample REPLACE PARTITION KEY ts_day WITH day(ts) AS day_of_ts;\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"managing-branch--tag",children:"Managing Branch & Tag"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Since 3.1.0"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Create Branch"})}),"\n",(0,i.jsx)(n.p,{children:"Syntax:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE [catalog.][database.]table_name\nCREATE [OR REPLACE] BRANCH [IF NOT EXISTS] <branch_name>\n[AS OF VERSION <snapshot_id>]\n[RETAIN <num> { DAYS | HOURS | MINUTES }]\n[WITH SNAPSHOT RETENTION { snapshotKeep | timeKeep }]\n\nsnapshotKeep:\n  <num> SNAPSHOTS [<num> { DAYS | HOURS | MINUTES }]\n\ntimeKeep:\n  <num> { DAYS | HOURS | MINUTES }\n"})}),"\n",(0,i.jsx)(n.p,{children:"Examples:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'-- Create branch "b1".\nALTER TABLE tbl CREATE BRANCH b1;\nALTER TABLE tb1 CREATE BRANCH IF NOT EXISTS b1;\n-- Create or replace branch "b1".\nALTER TABLE tb1 CREATE OR REPLACE BRANCH b1;\n-- Create or replace branch "b1" based on snapshot "123456".\nALTER TABLE tb1 CREATE OR REPLACE BRANCH b1 AS OF VERSION 123456;\n-- Create or replace branch "b1" based on snapshot "123456", branch retained for 1 day.\nALTER TABLE tb1 CREATE OR REPLACE BRANCH b1 AS OF VERSION 123456 RETAIN 1 DAYS;\n-- Create branch "b1" based on snapshot "123456", branch retained for 30 days. Keep the latest 3 snapshots in the branch.\nALTER TABLE tb1 CREATE BRANCH b1 AS OF VERSION 123456 RETAIN 30 DAYS WITH SNAPSHOT RETENTION 3 SNAPSHOTS;\n-- Create branch "b1" based on snapshot "123456", branch retained for 30 days. Snapshots in the branch are retained for at most 2 days.\nALTER TABLE tb1 CREATE BRANCH b1 AS OF VERSION 123456 RETAIN 30 DAYS WITH SNAPSHOT RETENTION 2 DAYS;\n-- Create branch "b1" based on snapshot "123456", branch retained for 30 days. Keep the latest 3 snapshots in the branch, and snapshots in the branch are retained for at most 2 days.\nALTER TABLE tb1 CREATE BRANCH b1 AS OF VERSION 123456 RETAIN 30 DAYS WITH SNAPSHOT RETENTION 3 SNAPSHOTS 2 DAYS;\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Drop Branch"})}),"\n",(0,i.jsx)(n.p,{children:"Syntax:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE [catalog.][database.]table_name\nDROP BRANCH [IF EXISTS] <branch_name>;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE tbl DROP BRANCH b1;\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Create Tag"})}),"\n",(0,i.jsx)(n.p,{children:"Syntax:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE [catalog.][database.]table_name\nCREATE [OR REPLACE] TAG [IF NOT EXISTS] <tag_name>\n[AS OF VERSION <snapshot_id>]\n[RETAIN <num> { DAYS | HOURS | MINUTES }]\n"})}),"\n",(0,i.jsx)(n.p,{children:"Examples:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'-- Create tag "t1".\nALTER TABLE tbl CREATE TAG t1;\nALTER TABLE tb1 CREATE TAG IF NOT EXISTS t1;\n-- Create or replace tag "t1".\nALTER TABLE tb1 CREATE OR REPLACE TAG t1;\n-- Create or replace tag "t1" based on snapshot "123456".\nALTER TABLE tb1 CREATE OR REPLACE TAG b1 AS OF VERSION 123456;\n-- Create or replace tag "b1" based on snapshot "123456", tag retained for 1 day.\nALTER TABLE tb1 CREATE OR REPLACE TAG b1 AS OF VERSION 123456 RETAIN 1 DAYS;\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Drop Tag"})}),"\n",(0,i.jsx)(n.p,{children:"Syntax:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE [catalog.][database.]table_name\nDROP TAG [IF EXISTS] <tag_name>;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE tbl DROP TAG t1;\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"iceberg-table-actions",children:"Iceberg Table Actions"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"This feature is supported since 4.0.2"}),"\n",(0,i.jsx)(n.p,{children:"This is an experimental feature."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Doris supports executing specific actions on Iceberg tables through the ",(0,i.jsx)(n.code,{children:"ALTER TABLE EXECUTE"})," syntax. This syntax provides a unified interface for executing various actions such as table optimization and snapshot management."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE [catalog.][database.]table_name\nEXECUTE <action_name> ("key1" = "value1", "key2" = "value2", ...)\n[WHERE <condition>]\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"action_name"}),": The name of the action to execute"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'("key1" = "value1", ...)'}),": Action-related parameters provided as key-value pairs. Parameter names must be wrapped in double quotes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"[WHERE <condition>]"}),": Optional WHERE condition to specify the partition or data range for the operation (only supported by some operations)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"rewrite_data_files",children:"rewrite_data_files"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"rewrite_data_files"})," operation rewrites data files in an Iceberg table to implement small file compaction, optimizing query performance and storage efficiency. This is a synchronized operation."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Syntax:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE [catalog.][database.]table_name\nEXECUTE rewrite_data_files ("key1" = "value1", "key2" = "value2", ...) [WHERE <condition>]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Default Value"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"target-file-size-bytes"})}),(0,i.jsx)(n.td,{children:"Long"}),(0,i.jsx)(n.td,{children:"536870912 (512MB)"}),(0,i.jsx)(n.td,{children:"Target file size in bytes for output files"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"min-file-size-bytes"})}),(0,i.jsx)(n.td,{children:"Long"}),(0,i.jsx)(n.td,{children:"target-file-size-bytes * 0.75"}),(0,i.jsx)(n.td,{children:"Minimum file size in bytes. Files smaller than this will be rewritten. If not specified, defaults to 75% of target file size"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"max-file-size-bytes"})}),(0,i.jsx)(n.td,{children:"Long"}),(0,i.jsx)(n.td,{children:"target-file-size-bytes * 1.8"}),(0,i.jsx)(n.td,{children:"Maximum file size in bytes. Files larger than this will be split. If not specified, defaults to 180% of target file size"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"min-input-files"})}),(0,i.jsx)(n.td,{children:"Integer"}),(0,i.jsx)(n.td,{children:"5"}),(0,i.jsx)(n.td,{children:"Minimum number of input files to trigger rewrite. Rewrite only executes when the number of files to rewrite reaches this threshold"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"rewrite-all"})}),(0,i.jsx)(n.td,{children:"Boolean"}),(0,i.jsx)(n.td,{children:"false"}),(0,i.jsx)(n.td,{children:"Whether to rewrite all files regardless of file size"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"max-file-group-size-bytes"})}),(0,i.jsx)(n.td,{children:"Long"}),(0,i.jsx)(n.td,{children:"107374182400 (100GB)"}),(0,i.jsx)(n.td,{children:"Maximum size in bytes for a file group. Used to limit the amount of data processed by a single rewrite task"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"delete-file-threshold"})}),(0,i.jsx)(n.td,{children:"Integer"}),(0,i.jsx)(n.td,{children:"Integer.MAX_VALUE"}),(0,i.jsx)(n.td,{children:"Minimum number of delete files required to trigger rewrite"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"delete-ratio-threshold"})}),(0,i.jsx)(n.td,{children:"Double"}),(0,i.jsx)(n.td,{children:"0.3"}),(0,i.jsx)(n.td,{children:"Minimum ratio of delete records to total records required to trigger rewrite (delete records / total records). Range: 0.0 - 1.0"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"output-spec-id"})}),(0,i.jsx)(n.td,{children:"Long"}),(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"Partition specification ID for output files"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Return Value:"})}),"\n",(0,i.jsxs)(n.p,{children:["Executing ",(0,i.jsx)(n.code,{children:"rewrite_data_files"})," returns a result set with the following 4 columns:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Column Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"rewritten_data_files_count"})}),(0,i.jsx)(n.td,{children:"INT"}),(0,i.jsx)(n.td,{children:"Number of data files that were rewritten"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"added_data_files_count"})}),(0,i.jsx)(n.td,{children:"INT"}),(0,i.jsx)(n.td,{children:"Number of new data files that were written"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"rewritten_bytes_count"})}),(0,i.jsx)(n.td,{children:"INT"}),(0,i.jsx)(n.td,{children:"Number of bytes that were rewritten"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"removed_delete_files_count"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"Number of delete files that were removed"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'-- Rewrite data files with default parameters\nALTER TABLE iceberg_db.iceberg_table EXECUTE rewrite_data_files();\n\n-- Specify target file size and minimum input files\nALTER TABLE iceberg_db.iceberg_table \nEXECUTE rewrite_data_files (\n  "target-file-size-bytes" = "134217728",\n  "min-input-files" = "10"\n);\n\n-- Use WHERE condition to rewrite specific partition data\nALTER TABLE iceberg_db.iceberg_table \nEXECUTE rewrite_data_files (\n  "target-file-size-bytes" = "268435456"\n)\nWHERE date_col = \'2024-01-01\';\n\n-- Rewrite all files\nALTER TABLE iceberg_db.iceberg_table \nEXECUTE rewrite_data_files (\n  "rewrite-all" = "true",\n  "target-file-size-bytes" = "536870912"\n);\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"rewrite_data_files"})," operation reads and rewrites data files, which will generate additional I/O and computational overhead. Please allocate cluster resources reasonably."]}),"\n",(0,i.jsxs)(n.li,{children:["Before execution, you can use the SQL in the ",(0,i.jsx)(n.a,{href:"#view-data-file-distribution",children:"View Data File Distribution"})," section to evaluate whether a rewrite operation is needed"]}),"\n",(0,i.jsx)(n.li,{children:"The WHERE condition can be used to limit the partition or data range for rewriting. This condition will filter out files that do not contain data matching the WHERE condition, thereby reducing the number of files and amount of data to rewrite"}),"\n",(0,i.jsxs)(n.li,{children:["Before execution, you can use the SQL in the ",(0,i.jsx)(n.a,{href:"#rewrite-file-selection-logic",children:"Rewrite File Selection Logic"})," section to calculate which files will be rewritten"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"cherrypick_snapshot",children:"cherrypick_snapshot"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"cherrypick_snapshot"})," operation merges changes from a specified snapshot into the current table state, creating a new snapshot without modifying or deleting the original snapshot."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Syntax:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE [catalog.][database.]table_name\nEXECUTE cherrypick_snapshot ("snapshot_id" = "<snapshot_id>")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"snapshot_id"})}),(0,i.jsx)(n.td,{children:"Long"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"The snapshot ID to merge"})]})})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Return Value:"})}),"\n",(0,i.jsxs)(n.p,{children:["Executing ",(0,i.jsx)(n.code,{children:"cherrypick_snapshot"})," returns a result set with the following 2 columns:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Column Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"source_snapshot_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"The snapshot ID whose changes were merged"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"current_snapshot_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"The snapshot ID of the new snapshot created and set as current after the merge operation"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'-- Merge changes from snapshot 123456789 into current table state\nALTER TABLE iceberg_db.iceberg_table \nEXECUTE cherrypick_snapshot ("snapshot_id" = "123456789");\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"This operation does not support WHERE conditions"}),"\n",(0,i.jsx)(n.li,{children:"If the specified snapshot does not exist, the operation will fail"}),"\n",(0,i.jsx)(n.li,{children:"The merge operation creates a new snapshot and does not delete the original snapshot"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"fast_forward",children:"fast_forward"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"fast_forward"})," operation fast-forwards the current snapshot of one branch to the latest snapshot of another branch."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Syntax:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE [catalog.][database.]table_name\nEXECUTE fast_forward ("branch" = "<branch_name>", "to" = "<target_branch>")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"branch"})}),(0,i.jsx)(n.td,{children:"String"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Name of the branch to fast-forward"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"to"})}),(0,i.jsx)(n.td,{children:"String"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsxs)(n.td,{children:["Target branch name. The ",(0,i.jsx)(n.code,{children:"branch"})," will be fast-forwarded to the latest snapshot of this branch"]})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Return Value:"})}),"\n",(0,i.jsxs)(n.p,{children:["Executing ",(0,i.jsx)(n.code,{children:"fast_forward"})," returns a result set with the following 3 columns:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Column Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"branch_updated"})}),(0,i.jsx)(n.td,{children:"STRING"}),(0,i.jsx)(n.td,{children:"Name of the branch that was fast-forwarded"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"previous_ref"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"Snapshot ID the branch was pointing to before the fast-forward operation (can be NULL)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"updated_ref"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"Snapshot ID the branch is pointing to after the fast-forward operation"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'-- Fast-forward feature branch to the latest snapshot of main branch\nALTER TABLE iceberg_db.iceberg_table \nEXECUTE fast_forward ("branch" = "feature", "to" = "main");\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"This operation does not support WHERE conditions"}),"\n",(0,i.jsx)(n.li,{children:"If the specified branch does not exist, the operation will fail"}),"\n",(0,i.jsx)(n.li,{children:"Only branches can be fast-forwarded, not tags"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"rollback_to_snapshot",children:"rollback_to_snapshot"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"rollback_to_snapshot"})," operation rolls back an Iceberg table to a specified snapshot."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Syntax:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE [catalog.][database.]table_name\nEXECUTE rollback_to_snapshot ("snapshot_id" = "<snapshot_id>")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"snapshot_id"})}),(0,i.jsx)(n.td,{children:"Long"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"The snapshot ID to rollback to"})]})})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Return Value:"})}),"\n",(0,i.jsxs)(n.p,{children:["Executing ",(0,i.jsx)(n.code,{children:"rollback_to_snapshot"})," returns a result set with the following 2 columns:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Column Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"previous_snapshot_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"The snapshot ID that was current before the rollback operation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"current_snapshot_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"The snapshot ID that is set as current after rolling back to the specified snapshot"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'-- Rollback to snapshot 987654321\nALTER TABLE iceberg_db.iceberg_table \nEXECUTE rollback_to_snapshot ("snapshot_id" = "987654321");\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"This operation does not support WHERE conditions"}),"\n",(0,i.jsx)(n.li,{children:"If the specified snapshot does not exist, the operation will fail"}),"\n",(0,i.jsx)(n.li,{children:"If the current snapshot is already the target snapshot, the operation returns directly without creating a new snapshot"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"rollback_to_timestamp",children:"rollback_to_timestamp"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"rollback_to_timestamp"})," operation rolls back an Iceberg table to the snapshot at a specified timestamp."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Syntax:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE [catalog.][database.]table_name\nEXECUTE rollback_to_timestamp ("timestamp" = "<timestamp>")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"timestamp"})}),(0,i.jsx)(n.td,{children:"String"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsxs)(n.td,{children:["The timestamp to rollback to. Supports two formats:",(0,i.jsx)("br",{}),"1. ISO datetime format: ",(0,i.jsx)(n.code,{children:"yyyy-MM-dd HH:mm:ss.SSS"})," (e.g., ",(0,i.jsx)(n.code,{children:"2024-01-01 10:30:00.000"}),")",(0,i.jsx)("br",{}),"2. Milliseconds timestamp (e.g., ",(0,i.jsx)(n.code,{children:"1704067200000"}),")"]})]})})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Return Value:"})}),"\n",(0,i.jsxs)(n.p,{children:["Executing ",(0,i.jsx)(n.code,{children:"rollback_to_timestamp"})," returns a result set with the following 2 columns:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Column Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"previous_snapshot_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"The snapshot ID that was current before the rollback operation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"current_snapshot_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"The snapshot ID that was current at the specified timestamp, now set as current"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'-- Rollback to specified timestamp (ISO format)\nALTER TABLE iceberg_db.iceberg_table \nEXECUTE rollback_to_timestamp ("timestamp" = "2024-01-01 10:30:00.000");\n\n-- Rollback to specified timestamp (timestamp format)\nALTER TABLE iceberg_db.iceberg_table \nEXECUTE rollback_to_timestamp ("timestamp" = "1704067200000");\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"This operation does not support WHERE conditions"}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"timestamp"})," parameter supports ISO datetime format (",(0,i.jsx)(n.code,{children:"yyyy-MM-dd HH:mm:ss.SSS"}),") or milliseconds timestamp format"]}),"\n",(0,i.jsx)(n.li,{children:"If there is no snapshot corresponding to the specified timestamp, the operation will fail"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"set_current_snapshot",children:"set_current_snapshot"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"set_current_snapshot"})," operation sets the current snapshot of an Iceberg table to a specified snapshot ID or reference (branch or tag)."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Syntax:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE [catalog.][database.]table_name\nEXECUTE set_current_snapshot ("snapshot_id" = "<snapshot_id>" | "ref" = "<ref_name>")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"snapshot_id"})}),(0,i.jsx)(n.td,{children:"Long"}),(0,i.jsx)(n.td,{children:"Either one"}),(0,i.jsx)(n.td,{children:"The snapshot ID to set as current"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ref"})}),(0,i.jsx)(n.td,{children:"String"}),(0,i.jsx)(n.td,{children:"Either one"}),(0,i.jsx)(n.td,{children:"The reference name (branch or tag) to set as current"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Return Value:"})}),"\n",(0,i.jsxs)(n.p,{children:["Executing ",(0,i.jsx)(n.code,{children:"set_current_snapshot"})," returns a result set with the following 2 columns:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Column Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"previous_snapshot_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsx)(n.td,{children:"The snapshot ID that was current before setting the new current snapshot"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"current_snapshot_id"})}),(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsxs)(n.td,{children:["The snapshot ID that is now set as current (from ",(0,i.jsx)(n.code,{children:"snapshot_id"})," parameter or resolved from ",(0,i.jsx)(n.code,{children:"ref"})," parameter)"]})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'-- Set current snapshot by snapshot ID\nALTER TABLE iceberg_db.iceberg_table \nEXECUTE set_current_snapshot ("snapshot_id" = "123456789");\n\n-- Set current snapshot by branch name\nALTER TABLE iceberg_db.iceberg_table \nEXECUTE set_current_snapshot ("ref" = "feature_branch");\n\n-- Set current snapshot by tag name\nALTER TABLE iceberg_db.iceberg_table \nEXECUTE set_current_snapshot ("ref" = "v1.0");\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"This operation does not support WHERE conditions"}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"snapshot_id"})," and ",(0,i.jsx)(n.code,{children:"ref"})," parameters are mutually exclusive; only one can be specified"]}),"\n",(0,i.jsx)(n.li,{children:"If the specified snapshot ID or reference does not exist, the operation will fail"}),"\n",(0,i.jsx)(n.li,{children:"If the current snapshot is already the target snapshot, the operation returns directly without creating a new snapshot"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"iceberg-table-optimization",children:"Iceberg Table Optimization"}),"\n",(0,i.jsx)(n.h3,{id:"view-data-file-distribution",children:"View Data File Distribution"}),"\n",(0,i.jsxs)(n.p,{children:["You can use the following SQL to analyze the data distribution and delete file count of Iceberg tables, helping determine whether optimization like ",(0,i.jsx)(n.code,{children:"rewrite_data_files"})," is needed."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Display data file size distribution. This can help identify if there are too many"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT\n  CASE\n    WHEN file_size_in_bytes BETWEEN 0 AND 8 * 1024 * 1024 THEN '0-8M'\n    WHEN file_size_in_bytes BETWEEN 8 * 1024 * 1024 + 1 AND 32 * 1024 * 1024 THEN '8-32M'\n    WHEN file_size_in_bytes BETWEEN 2 * 1024 * 1024 + 1 AND 128 * 1024 * 1024 THEN '32-128M'\n    WHEN file_size_in_bytes BETWEEN 128 * 1024 * 1024 + 1 AND 512 * 1024 * 1024 THEN '128-512M'\n    WHEN file_size_in_bytes > 512 * 1024 * 1024 THEN '> 512M'\n    ELSE 'Unknown'\n  END AS SizeRange,\n  COUNT(*) AS FileNum\nFROM store_sales$data_files\nGROUP BY\n  SizeRange;\n\n+-----------+---------+\n| SizeRange | FileNum |\n+-----------+---------+\n| 0-8M      |       8 |\n| 8-32M     |       6 |\n+-----------+---------+\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Display the number of data files and delete files"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT\n  CASE\n    WHEN content = 0 THEN 'DataFile'\n    WHEN content = 1 THEN 'PositionDeleteFile'\n    WHEN content = 2 THEN 'EqualityDeleteFile'\n    ELSE 'Unknown'\n  END AS ContentType,\n  COUNT(*) AS FileNum,\n  SUM(file_size_in_bytes) AS SizeInBytes,\n  SUM(record_count) AS Records\nFROM\n  iceberg_table$files\nGROUP BY\n  ContentType;\n\n+--------------------+---------+-------------+---------+\n| ContentType        | FileNum | SizeInBytes | Records |\n+--------------------+---------+-------------+---------+\n| EqualityDeleteFile |    2787 |     1432518 |   27870 |\n| DataFile           |    2787 |     4062416 |   38760 |\n| PositionDeleteFile |      11 |       36608 |   10890 |\n+--------------------+---------+-------------+---------+\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"dangling-delete",children:"Dangling Delete"}),"\n",(0,i.jsxs)(n.p,{children:["In some cases, after executing the ",(0,i.jsx)(n.code,{children:"rewrite_data_files"})," action, references to certain Position Deletes may not have been removed from the Snapshot metadata (Dangling Delete). If you directly use the row number information from the metadata in this situation, the result may be incorrect."]}),"\n",(0,i.jsxs)(n.p,{children:["Therefore, by default, for ",(0,i.jsx)(n.code,{children:"COUNT(*)"})," queries, if a Position Delete file is found, COUNT pushdown optimization is not enabled; instead, the file is read directly to obtain the actual ",(0,i.jsx)(n.code,{children:"COUNT(*)"})," result. However, this method is time-consuming."]}),"\n",(0,i.jsxs)(n.p,{children:["If the user can ensure there is no Dangling Delete issue, this check can be skipped using the Doris session variable ",(0,i.jsx)(n.code,{children:"ignore_iceberg_dangling_delete"}),". This variable defaults to ",(0,i.jsx)(n.code,{children:"false"}),". When set to ",(0,i.jsx)(n.code,{children:"true"}),", the system will directly return the ",(0,i.jsx)(n.code,{children:"COUNT(*)"})," result based on the row count information in the metadata, improving query efficiency."]}),"\n",(0,i.jsx)(n.p,{children:"This feature is supported from versions 3.1.4 and 4.0.3."}),"\n",(0,i.jsx)(n.h2,{id:"appendix",children:"Appendix"}),"\n",(0,i.jsxs)(n.h3,{id:"rewrite_data_files-file-selection-strategy",children:[(0,i.jsx)(n.code,{children:"rewrite_data_files"})," File Selection Strategy"]}),"\n",(0,i.jsx)(n.p,{children:"You can check this section to understand the logic for selecting files to be rewritten. You can also use the following SQL queries to analyze which files will be rewritten based on system table information. This helps you debug and understand rewrite behavior before executing actual rewrite operations."}),"\n",(0,i.jsx)(n.p,{children:"The rewrite operation uses a two-stage filtering and grouping strategy:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Stage 1: File-level filtering"}),"\n",(0,i.jsx)(n.p,{children:"First, files are filtered based on file-level conditions. Only files that meet at least one of the following conditions will be considered for rewriting:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"File size out of range"}),": File is smaller than ",(0,i.jsx)(n.code,{children:"min-file-size-bytes"})," or larger than ",(0,i.jsx)(n.code,{children:"max-file-size-bytes"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Too many delete files"}),": Number of associated delete files >= ",(0,i.jsx)(n.code,{children:"delete-file-threshold"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"High delete ratio"}),": Delete record ratio >= ",(0,i.jsx)(n.code,{children:"delete-ratio-threshold"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note about delete file conditions:"})," Conditions related to delete files (",(0,i.jsx)(n.code,{children:"delete-file-threshold"})," and ",(0,i.jsx)(n.code,{children:"delete-ratio-threshold"}),") affect file rewrite selection, but cannot be accurately calculated through system table SQL queries. This is because current system table information is insufficient to accurately determine which data files are affected by delete files. Delete files may only affect specific data files (especially Position Delete files), and the association between delete files and data files requires more detailed metadata that is not available in current system tables. Actual rewrite operations will evaluate these conditions based on more detailed metadata not exposed in system tables."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Stage 2: BinPack grouping and group-level filtering"}),"\n",(0,i.jsxs)(n.p,{children:["After file-level filtering, files are grouped by partition, then within each partition, files are grouped using the ",(0,i.jsx)(n.strong,{children:"BinPack algorithm"})," based on file size and ",(0,i.jsx)(n.code,{children:"max-file-group-size-bytes"}),". The BinPack algorithm intelligently packs files into groups to optimize rewrite operations."]}),"\n",(0,i.jsx)(n.p,{children:"After grouping, file groups are filtered based on group-level conditions. File groups will be rewritten when they meet at least one of the following conditions:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sufficient input files"}),": Number of files in group > 1 and file count >= ",(0,i.jsx)(n.code,{children:"min-input-files"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sufficient content"}),": Number of files in group > 1 and total size > ",(0,i.jsx)(n.code,{children:"target-file-size-bytes"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Too much content"}),": Group total size > ",(0,i.jsx)(n.code,{children:"max-file-group-size-bytes"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Contains files with delete file issues"}),": At least one file in the group has too many delete files or high delete ratio."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note about BinPack grouping:"})," The BinPack algorithm used to group files within each partition is a complex optimization algorithm that cannot be accurately simulated through system table SQL queries. This algorithm considers file size and ",(0,i.jsx)(n.code,{children:"max-file-group-size-bytes"})," to intelligently pack files into groups, which may result in different grouping results than simple partition-based grouping. Therefore, the SQL queries provided below can only identify files that meet file-level conditions, but cannot accurately calculate the final file groups that will be rewritten."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Here are some example query strategies:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Query 1: Identify files meeting file-level conditions"}),"\n",(0,i.jsx)(n.p,{children:"This query identifies files that meet file-level conditions (file size) and will be considered for rewriting:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Set parameters (adjust according to your rewrite parameters)\nSET @min_file_size_bytes = 16 * 1024 * 1024;   -- 16 MB (default: target-file-size-bytes * 0.75)\nSET @max_file_size_bytes = 768 * 1024 * 1024;  -- 768 MB (default: target-file-size-bytes * 1.8)\n\nSELECT \n    file_path,\n    `partition`,\n    file_size_in_bytes / 1024.0 / 1024.0 AS file_size_mb,\n    record_count,\n    CASE \n        WHEN file_size_in_bytes < @min_file_size_bytes THEN 'Too small'\n        WHEN file_size_in_bytes > @max_file_size_bytes THEN 'Too large'\n    END AS size_issue\nFROM iceberg_table$data_files\nWHERE file_size_in_bytes < @min_file_size_bytes \nOR file_size_in_bytes > @max_file_size_bytes\nORDER BY `partition`, file_size_in_bytes DESC;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'+----------------------------------------------------------------------------------------+---------------------------+-------------+--------------+------------+\n| file_path                                                                             | partition                 | file_size_mb | record_count | size_issue |\n+----------------------------------------------------------------------------------------+---------------------------+-------------+--------------+------------+\n| s3a://bucket/path/to/table/data/date_col=2024-01-01/00000-0-00000-00000-0.parquet   | {"date_col":"2024-01-01"} |     0.00215  |            5 | Too small  |\n| s3a://bucket/path/to/table/data/date_col=2024-01-01/00001-0-00001-00001-0.parquet     | {"date_col":"2024-01-01"} |     0.00198  |            5 | Too small  |\n| s3a://bucket/path/to/table/data/date_col=2024-01-02/00002-0-00002-00002-0.parquet     | {"date_col":"2024-01-02"} |     0.00231  |            5 | Too small  |\n| s3a://bucket/path/to/table/data/date_col=2024-01-02/00003-0-00003-00003-0.parquet     | {"date_col":"2024-01-02"} |   850.23456  |      1250000 | Too large  |\n| s3a://bucket/path/to/table/data/date_col=2024-01-03/00004-0-00004-00004-0.parquet     | {"date_col":"2024-01-03"} |     0.00245  |            5 | Too small  |\n+----------------------------------------------------------------------------------------+---------------------------+-------------+--------------+------------+\n5 rows in set\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," This query can only identify files that meet file-level conditions (file size). The actual file groups to be rewritten depend on the BinPack grouping algorithm, which cannot be accurately simulated through SQL queries. Files identified by this query may be grouped differently by the BinPack algorithm, and some groups may be filtered out based on group-level conditions."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Query 2: Overall statistics summary"}),"\n",(0,i.jsx)(n.p,{children:"This query provides overall statistics about files that meet file-level conditions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Set parameters (adjust according to your rewrite parameters)\nSET @min_file_size_bytes = 16 * 1024 * 1024;\nSET @max_file_size_bytes = 768 * 1024 * 1024;\n\nWITH file_analysis AS (\n    SELECT \n        `partition`,\n        file_path,\n        file_size_in_bytes,\n        record_count,\n        (file_size_in_bytes < @min_file_size_bytes OR file_size_in_bytes > @max_file_size_bytes) AS meets_file_level_conditions\n    FROM iceberg_table$data_files\n)\nSELECT \n    'Total files' AS metric, \n    COUNT(*) AS value\nFROM file_analysis\nUNION ALL\nSELECT \n    'Files meeting file-level conditions', \n    SUM(CASE WHEN meets_file_level_conditions THEN 1 ELSE 0 END)\nFROM file_analysis\nUNION ALL\nSELECT \n    'Total size (GB)', \n    ROUND(SUM(file_size_in_bytes) / 1024.0 / 1024.0 / 1024.0, 2)\nFROM file_analysis\nUNION ALL\nSELECT \n    'Size meeting file-level conditions (GB)', \n    ROUND(SUM(CASE WHEN meets_file_level_conditions THEN file_size_in_bytes ELSE 0 END) / 1024.0 / 1024.0 / 1024.0, 2)\nFROM file_analysis\nUNION ALL\nSELECT \n    'Percentage meeting file-level conditions (%)', \n    ROUND(SUM(CASE WHEN meets_file_level_conditions THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2)\nFROM file_analysis;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"+----------------------------------------------+--------+\n| metric                                       | value  |\n+----------------------------------------------+--------+\n| Total files                                  |  15.00 |\n| Total size (GB)                              |   2.45 |\n| Files meeting file-level conditions          |  12.00 |\n| Size meeting file-level conditions (GB)      |   1.85 |\n| Percentage meeting file-level conditions (%) |  80.00 |\n+----------------------------------------------+--------+\n5 rows in set\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Replace ",(0,i.jsx)(n.code,{children:"iceberg_table"})," in the example with the actual table name"]}),"\n",(0,i.jsxs)(n.li,{children:["Adjust parameter values (",(0,i.jsx)(n.code,{children:"@min_file_size_bytes"}),", ",(0,i.jsx)(n.code,{children:"@max_file_size_bytes"}),") according to your actual rewrite parameters"]}),"\n",(0,i.jsx)(n.li,{children:"The default values shown above correspond to default rewrite parameters (min-file-size-bytes = target-file-size-bytes * 0.75, max-file-size-bytes = target-file-size-bytes * 1.8)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"View snapshot and branch relationships"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'SELECT\nrefs_data.snapshot_id,\nsnapshots.committed_at,\nsnapshots.operation,\nARRAY_SORT(refs_data.refs)\nFROM (\nSELECT\n    snapshot_id,\n    ARRAY_AGG(CONCAT(type, \':\', name)) AS refs\nFROM\n    iceberg_table$refs\nGROUP BY\n    snapshot_id\n) AS refs_data\nJOIN (\nSELECT\n    snapshot_id,\n    committed_at,\n    operation\nFROM\n    iceberg_table$snapshots\n) AS snapshots\nON refs_data.snapshot_id = snapshots.snapshot_id\nORDER BY\nsnapshots.committed_at;\n\n+---------------------+----------------------------+-----------+-------------------------------------+\n| snapshot_id         | committed_at               | operation | ARRAY_SORT(refs_data.refs)          |\n+---------------------+----------------------------+-----------+-------------------------------------+\n| 8272911997874079853 | 2025-07-10 15:27:07.177000 | append    | ["BRANCH:b1", "TAG:t1"]             |\n| 1325777059626757917 | 2025-07-10 15:27:07.530000 | append    | ["BRANCH:b2", "TAG:t2"]             |\n|   76492482642020578 | 2025-07-10 15:27:07.865000 | append    | ["BRANCH:b3", "TAG:t3"]             |\n| 1788715857849070138 | 2025-07-12 04:15:19.626000 | append    | ["BRANCH:main", "TAG:t4", "TAG:t5"] |\n+---------------------+----------------------------+-----------+-------------------------------------+\n'})}),"\n"]}),"\n"]})]})}function p(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},905525:function(e,n,s){s.d(n,{Z:()=>r});var t=s("785893");s("667294");var i=s("74904");function r(e){let{children:n,hidden:s,className:r}=e;return(0,t.jsx)("div",{role:"tabpanel",className:(0,i.Z)("tabItem_Ymn6",r),hidden:s,children:n})}},247902:function(e,n,s){s.d(n,{Z:()=>m});var t=s("785893"),i=s("667294"),r=s("74904"),a=s("69599"),l=s("616550"),c=s("232000"),o=s("4520"),d=s("38341"),h=s("876009");function u(e){return i.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||i.isValidElement(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){let{value:n,tabValues:s}=e;return s.some(e=>e.value===n)}var x=s("7227");function g(e){let{className:n,block:s,selectedValue:i,selectValue:l,tabValues:c}=e,o=[],{blockElementScrollPositionUntilNextRender:d}=(0,a.o5)(),h=e=>{let n=e.currentTarget,s=c[o.indexOf(n)].value;s!==i&&(d(n),l(s))},u=e=>{let n=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{let s=o.indexOf(e.currentTarget)+1;n=o[s]??o[0];break}case"ArrowLeft":{let s=o.indexOf(e.currentTarget)-1;n=o[s]??o[o.length-1]}}n?.focus()};return(0,t.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":s},n),children:c.map(e=>{let{value:n,label:s,attributes:a}=e;return(0,t.jsx)("li",{role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,ref:e=>o.push(e),onKeyDown:u,onClick:h,...a,className:(0,r.Z)("tabs__item","tabItem_LNqP",a?.className,{"tabs__item--active":i===n}),children:s??n},n)})})}function b(e){let{lazy:n,children:s,selectedValue:a}=e,l=(Array.isArray(s)?s:[s]).filter(Boolean);if(n){let e=l.find(e=>e.props.value===a);return e?(0,i.cloneElement)(e,{className:(0,r.Z)("margin-top--md",e.props.className)}):null}return(0,t.jsx)("div",{className:"margin-top--md",children:l.map((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==a}))})}function j(e){let n=function(e){let{defaultValue:n,queryString:s=!1,groupId:t}=e,r=function(e){let{values:n,children:s}=e;return(0,i.useMemo)(()=>{let e=n??u(s).map(e=>{let{props:{value:n,label:s,attributes:t,default:i}}=e;return{value:n,label:s,attributes:t,default:i}});return!function(e){let n=(0,d.lx)(e,(e,n)=>e.value===n.value);if(n.length>0)throw Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,s])}(e),[a,x]=(0,i.useState)(()=>(function(e){let{defaultValue:n,tabValues:s}=e;if(0===s.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:s}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${s.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}let t=s.find(e=>e.default)??s[0];if(!t)throw Error("Unexpected error: 0 tabValues");return t.value})({defaultValue:n,tabValues:r})),[g,b]=function(e){let{queryString:n=!1,groupId:s}=e,t=(0,l.k6)(),r=function(e){let{queryString:n=!1,groupId:s}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!s)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:n,groupId:s});return[(0,o._X)(r),(0,i.useCallback)(e=>{if(!r)return;let n=new URLSearchParams(t.location.search);n.set(r,e),t.replace({...t.location,search:n.toString()})},[r,t])]}({queryString:s,groupId:t}),[j,m]=function(e){let{groupId:n}=e,s=n?`docusaurus.tab.${n}`:null,[t,r]=(0,h.Nk)(s);return[t,(0,i.useCallback)(e=>{s&&r.set(e)},[s,r])]}({groupId:t}),_=(()=>{let e=g??j;return p({value:e,tabValues:r})?e:null})();return(0,c.Z)(()=>{_&&x(_)},[_]),{selectedValue:a,selectValue:(0,i.useCallback)(e=>{if(!p({value:e,tabValues:r}))throw Error(`Can't select invalid tab value=${e}`);x(e),b(e),m(e)},[b,m,r]),tabValues:r}}(e);return(0,t.jsxs)("div",{className:(0,r.Z)("tabs-container","tabList__CuJ"),children:[(0,t.jsx)(g,{...n,...e}),(0,t.jsx)(b,{...n,...e})]})}function m(e){let n=(0,x.Z)();return(0,t.jsx)(j,{...e,children:u(e.children)},String(n))}},250065:function(e,n,s){s.d(n,{Z:function(){return l},a:function(){return a}});var t=s(667294);let i={},r=t.createContext(i);function a(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);