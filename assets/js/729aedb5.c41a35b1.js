"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["59263"],{396777:function(e,n,t){t.r(n),t.d(n,{default:()=>u,frontMatter:()=>s,metadata:()=>a,assets:()=>o,toc:()=>c,contentTitle:()=>r});var a=JSON.parse('{"id":"sql-manual/sql-functions/aggregate-functions/retention","title":"RETENTION","description":"Description","source":"@site/docs/sql-manual/sql-functions/aggregate-functions/retention.md","sourceDirName":"sql-manual/sql-functions/aggregate-functions","slug":"/sql-manual/sql-functions/aggregate-functions/retention","permalink":"/docs/dev/sql-manual/sql-functions/aggregate-functions/retention","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"RETENTION","language":"en"},"sidebar":"docs","previous":{"title":"REGR_SLOPE","permalink":"/docs/dev/sql-manual/sql-functions/aggregate-functions/regr-slope"},"next":{"title":"SEQUENCE_COUNT","permalink":"/docs/dev/sql-manual/sql-functions/aggregate-functions/sequence-count"}}'),l=t("785893"),i=t("250065");let s={title:"RETENTION",language:"en"},r=void 0,o={},c=[{value:"Description",id:"description",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Returned value",id:"returned-value",level:2},{value:"Examples",id:"examples",level:2}];function d(e){let n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"retention"})," function takes as arguments a set of conditions from 1 to 32 arguments of type Bool that indicate whether a certain condition was met for the event. Any condition can be specified as an argument."]}),"\n",(0,l.jsx)(n.p,{children:"The conditions, except the first, apply in pairs: the result of the second will be true if the first and second are true, of the third if the first and third are true, etc."}),"\n",(0,l.jsxs)(n.p,{children:["To put it simply, the first digit of the return value array indicates whether ",(0,l.jsx)(n.code,{children:"event_1"})," is true or false, the second digit represents the truth and falseness of ",(0,l.jsx)(n.code,{children:"event_1"})," and ",(0,l.jsx)(n.code,{children:"event_2"}),", and the third digit represents whether ",(0,l.jsx)(n.code,{children:"event_1"})," is true or false and ",(0,l.jsx)(n.code,{children:"event_3"})," is true or false, and so on. If ",(0,l.jsx)(n.code,{children:"event_1"})," is false, return an array full of false."]}),"\n",(0,l.jsx)(n.h2,{id:"syntax",children:"Syntax"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"RETENTION(<event_1> [, <event_2>, ... , <event_n>]);\n"})}),"\n",(0,l.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Parameter"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsx)(n.tbody,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"<event_n>"})}),(0,l.jsxs)(n.td,{children:["The ",(0,l.jsx)(n.code,{children:"n"}),"th event condition, type Bool."]})]})})]}),"\n",(0,l.jsx)(n.h2,{id:"returned-value",children:"Returned value"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"true: Condition is met."}),"\n",(0,l.jsx)(n.li,{children:"false: Condition is not met.\nAn array of Bool with a maximum length of 32, where the final output array length matches the input parameter length.\nIf no data is involved in the aggregation, a NULL value will be returned.\nWhen multiple columns are involved in a calculation, if any column contains a NULL value, the current row with the NULL value will not participate in the aggregate calculation and will be directly discarded.\nYou can use the IFNULL function on the calculation column to handle NULL values. For details, refer to the subsequent examples."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Create sample table and Insert sample data"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE retention_test(\n    `uid` int COMMENT 'user id', \n    `date` datetime COMMENT 'date time' \n) DUPLICATE KEY(uid) \nDISTRIBUTED BY HASH(uid) BUCKETS AUTO\nPROPERTIES ( \n    \"replication_allocation\" = \"tag.location.default: 1\"\n);\n\nINSERT into retention_test values \n(0, '2022-10-12'),\n(0, '2022-10-13'),\n(0, '2022-10-14'),\n(1, '2022-10-12'),\n(1, '2022-10-13'),\n(2, '2022-10-12');\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"Calculate user retention"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT \n    uid,     \n    RETENTION(date = '2022-10-12') AS r,\n    RETENTION(date = '2022-10-12', date = '2022-10-13') AS r2,\n    RETENTION(date = '2022-10-12', date = '2022-10-13', date = '2022-10-14') AS r3 \nFROM retention_test \nGROUP BY uid \nORDER BY uid ASC;\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"+------+------+--------+-----------+\n| uid  | r    | r2     | r3        |\n+------+------+--------+-----------+\n|    0 | [1]  | [1, 1] | [1, 1, 1] |\n|    1 | [1]  | [1, 1] | [1, 1, 0] |\n|    2 | [1]  | [1, 0] | [1, 0, 0] |\n+------+------+--------+-----------+\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsx)(n.li,{children:"Handling NULL values in special cases, recreating the table and inserting data"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE retention_test2(\n    `uid` int, \n    `flag` boolean,\n    `flag2` boolean\n) DUPLICATE KEY(uid) \nDISTRIBUTED BY HASH(uid) BUCKETS AUTO\nPROPERTIES ( \n    "replication_allocation" = "tag.location.default: 1"\n);\n\nINSERT into retention_test2 values (0, false, false), (1, true,  NULL);\n\nSELECT * from retention_test2;\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"+------+------+-------+\n| uid  | flag | flag2 |\n+------+------+-------+\n|    0 |    1 |  NULL |\n|    1 |    0 |     0 |\n+------+------+-------+\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"4",children:["\n",(0,l.jsx)(n.li,{children:"When performing calculations on an empty table, no data participates in aggregation, and NULL values are returned."}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT RETENTION(date = '2022-10-12') AS r FROM retention_test2 where uid is NULL;\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"+------+\n| r    |\n+------+\n| NULL |\n+------+\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"5",children:["\n",(0,l.jsx)(n.li,{children:"Only the flag column is involved in the calculation. Since flag is true when uid = 0, it returns 1."}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"select retention(flag) from retention_test2;\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"+-----------------+\n| retention(flag) |\n+-----------------+\n| [1]             |\n+-----------------+\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"6",children:["\n",(0,l.jsx)(n.li,{children:"When the columns flag and flag2 are involved in the calculation, the row with uid = 0 is excluded from the aggregate computation because flag2 is NULL. Only the row with uid = 1 participates in the aggregation, resulting in a return value of 0."}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"select retention(flag,flag2) from retention_test2;\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"+-----------------------+\n| retention(flag,flag2) |\n+-----------------------+\n| [0, 0]                |\n+-----------------------+\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"7",children:["\n",(0,l.jsx)(n.li,{children:"To resolve NULL value issues, you can use the IFNULL function to convert NULL to false, ensuring that both rows with uid = 0 and uid = 1 are included in the aggregate calculation."}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"select retention(flag,IFNULL(flag2,false)) from retention_test2;;\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"+-------------------------------------+\n| retention(flag,IFNULL(flag2,false)) |\n+-------------------------------------+\n| [1, 0]                              |\n+-------------------------------------+\n"})})]})}function u(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return r},a:function(){return s}});var a=t(667294);let l={},i=a.createContext(l);function s(e){let n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);