"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["357186"],{479168:function(e,a,t){t.r(a),t.d(a,{default:()=>c,frontMatter:()=>s,metadata:()=>n,assets:()=>m,toc:()=>d,contentTitle:()=>i});var n=JSON.parse('{"id":"admin-manual/trouble-shooting/memory-management/memory-analysis/metadata-memory-analysis","title":"Metadata Memory Analysis","description":"The metadata of Doris BE in memory includes data structures such as Tablet, Rowset, Segment, TabletSchema, ColumnReader, PrimaryKeyIndex,","source":"@site/versioned_docs/version-4.x/admin-manual/trouble-shooting/memory-management/memory-analysis/metadata-memory-analysis.md","sourceDirName":"admin-manual/trouble-shooting/memory-management/memory-analysis","slug":"/admin-manual/trouble-shooting/memory-management/memory-analysis/metadata-memory-analysis","permalink":"/docs/4.x/admin-manual/trouble-shooting/memory-management/memory-analysis/metadata-memory-analysis","draft":false,"unlisted":false,"tags":[],"version":"4.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Metadata Memory Analysis","language":"en","description":"The metadata of Doris BE in memory includes data structures such as Tablet, Rowset, Segment, TabletSchema, ColumnReader, PrimaryKeyIndex,"},"sidebar":"docs","previous":{"title":"Cache Memory Analysis","permalink":"/docs/4.x/admin-manual/trouble-shooting/memory-management/memory-analysis/doris-cache-memory-analysis"},"next":{"title":"Query Memory Analysis","permalink":"/docs/4.x/admin-manual/trouble-shooting/memory-management/memory-analysis/query-memory-analysis"}}'),o=t("785893"),r=t("250065");let s={title:"Metadata Memory Analysis",language:"en",description:"The metadata of Doris BE in memory includes data structures such as Tablet, Rowset, Segment, TabletSchema, ColumnReader, PrimaryKeyIndex,"},i=void 0,m={},d=[{value:"Metadata Viewing Method",id:"metadata-viewing-method",level:2},{value:"Doris BE Bvar",id:"doris-be-bvar",level:3},{value:"Doris BE Metrics",id:"doris-be-metrics",level:3},{value:"Use Heap Profile to analyze metadata memory",id:"use-heap-profile-to-analyze-metadata-memory",level:3}];function l(e){let a={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a.p,{children:["The metadata of Doris BE in memory includes data structures such as ",(0,o.jsx)(a.code,{children:"Tablet"}),", ",(0,o.jsx)(a.code,{children:"Rowset"}),", ",(0,o.jsx)(a.code,{children:"Segment"}),", ",(0,o.jsx)(a.code,{children:"TabletSchema"}),", ",(0,o.jsx)(a.code,{children:"ColumnReader"}),", ",(0,o.jsx)(a.code,{children:"PrimaryKeyIndex"}),", and ",(0,o.jsx)(a.code,{children:"BloomFilterIndex"}),". For more information about Doris BE metadata, refer to the document ",(0,o.jsx)(a.a,{href:"https://blog.csdn.net/ucanuup_/article/details/115004829",children:"Analysis of Doris Storage Structure Design"}),"."]}),"\n",(0,o.jsx)(a.h2,{id:"metadata-viewing-method",children:"Metadata Viewing Method"}),"\n",(0,o.jsx)(a.p,{children:"Currently, Memory Tracker does not accurately count the metadata memory size of Doris BE. You can estimate the metadata memory size by viewing some counters in Doris BE Bvar and Doris BE Metrics, or use Heap Profile for further analysis."}),"\n",(0,o.jsx)(a.h3,{id:"doris-be-bvar",children:"Doris BE Bvar"}),"\n",(0,o.jsxs)(a.p,{children:["You can see some metadata-related indicators counted by Bvar on the web page ",(0,o.jsx)(a.code,{children:"http://{be_host}:{brpc_port}/vars"}),"."]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{children:"- `doris_total_tablet_num`: The number of all tablets.\n- `doris_total_rowset_num`: The number of all rowsets.\n- `doris_total_segment_num`: The number of all open segments.\n- `doris_total_tablet_schema_num`: The number of all tablet schemas.\n- `tablet_schema_cache_count`: The number of cached tablet schemas.\n- `tablet_meta_schema_columns_count`: The number of columns in all tablet schemas.\n- `tablet_schema_cache_columns_count`: The number of cached columns in a tablet schema.\n- `doris_column_reader_num`: The number of open column readers.\n- `doris_column_reader_memory_bytes`: the number of bytes occupied by the opened Column Reader.\n- `doris_ordinal_index_memory_bytes`: the number of bytes occupied by the opened Ordinal Index.\n- `doris_zone_map_memory_bytes`: the number of bytes occupied by the opened ZoneMap Index.\n- `doris_short_key_index_memory_bytes`: the number of bytes occupied by the opened Short Key Index.\n- `doris_pk/index_reader_bytes`: the cumulative number of bytes occupied by the Primary Key Index Reader. This is not a real-time statistical value and is expected to be fixed.\n- `doris_pk/index_reader_pages`: Same as above, the cumulative value of the statistics.\n- `doris_pk/index_reader_cached_pages`: Same as above, the cumulative value of the statistics.\n- `doris_pk/index_reader_pagindex_reader_pk_pageses`: Same as above, cumulative value of statistics.\n- `doris_primary_key_index_memory_bytes`: Same as above, cumulative value of statistics.\n"})}),"\n",(0,o.jsx)(a.h3,{id:"doris-be-metrics",children:"Doris BE Metrics"}),"\n",(0,o.jsxs)(a.p,{children:["Web page ",(0,o.jsx)(a.code,{children:"http://{be_host}:{be_web_server_port}/metrics"})," can see some metadata indicators in BE process memory monitoring (Metrics). Among them, Metadata Cache related indicators refer to ",(0,o.jsx)(a.a,{href:"/docs/4.x/admin-manual/trouble-shooting/memory-management/memory-analysis/doris-cache-memory-analysis",children:"Doris Cache Memory Analysis"}),"."]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{children:"- `doris_be_all_rowsets_num`: The number of all Rowsets.\n- `doris_be_all_segments_num`: The number of all Segments.\n"})}),"\n",(0,o.jsx)(a.h3,{id:"use-heap-profile-to-analyze-metadata-memory",children:"Use Heap Profile to analyze metadata memory"}),"\n",(0,o.jsxs)(a.p,{children:["If the memory location cannot be accurately located using Doris BE Bvar and Metrics above, if the cluster can be easily restarted and the phenomenon can be reproduced, refer to ",(0,o.jsx)(a.a,{href:"/docs/4.x/admin-manual/trouble-shooting/memory-management/memory-analysis/heap-profile-memory-analysis",children:"Heap Profile Memory Analysis"})," to analyze Metadata memory."]}),"\n",(0,o.jsxs)(a.p,{children:["After the phenomenon is reproduced, if you see the ",(0,o.jsx)(a.code,{children:"Tablet"}),", ",(0,o.jsx)(a.code,{children:"Segment"}),", ",(0,o.jsx)(a.code,{children:"TabletSchema"}),", and ",(0,o.jsx)(a.code,{children:"ColumnReader"})," fields in the call stack with a large memory usage in Heap Profile, it can be basically confirmed that metadata occupies a large amount of memory."]})]})}function c(e={}){let{wrapper:a}={...(0,r.a)(),...e.components};return a?(0,o.jsx)(a,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},250065:function(e,a,t){t.d(a,{Z:function(){return i},a:function(){return s}});var n=t(667294);let o={},r=n.createContext(o);function s(e){let a=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(r.Provider,{value:a},e.children)}}}]);