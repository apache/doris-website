"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["303811"],{129560:function(e,n,l){l.r(n),l.d(n,{default:()=>h,frontMatter:()=>i,metadata:()=>a,assets:()=>r,toc:()=>d,contentTitle:()=>o});var a=JSON.parse('{"id":"sql-manual/sql-statements/table-and-view/table/ALTER-TABLE-COLUMN","title":"ALTER TABLE COLUMN","description":"This statement is used to perform a schema change operation on an existing table. The schema change is asynchronous,","source":"@site/versioned_docs/version-3.x/sql-manual/sql-statements/table-and-view/table/ALTER-TABLE-COLUMN.md","sourceDirName":"sql-manual/sql-statements/table-and-view/table","slug":"/sql-manual/sql-statements/table-and-view/table/ALTER-TABLE-COLUMN","permalink":"/docs/3.x/sql-manual/sql-statements/table-and-view/table/ALTER-TABLE-COLUMN","draft":false,"unlisted":false,"tags":[],"version":"3.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"ALTER TABLE COLUMN","language":"en","description":"This statement is used to perform a schema change operation on an existing table. The schema change is asynchronous,"},"sidebar":"docs","previous":{"title":"DESCRIBE","permalink":"/docs/3.x/sql-manual/sql-statements/table-and-view/table/DESC-TABLE"},"next":{"title":"ALTER TABLE PARTITION","permalink":"/docs/3.x/sql-manual/sql-statements/table-and-view/table/ALTER-TABLE-PARTITION"}}'),t=l("785893"),s=l("250065");let i={title:"ALTER TABLE COLUMN",language:"en",description:"This statement is used to perform a schema change operation on an existing table. The schema change is asynchronous,"},o=void 0,r={},d=[{value:"Description",id:"description",level:2},{value:"Grammar:",id:"grammar",level:3},{value:"Keywords",id:"keywords",level:2},{value:"Best Practice",id:"best-practice",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",mdxadmonitiontitle:"mdxadmonitiontitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,t.jsxs)(n.p,{children:["This statement is used to perform a schema change operation on an existing table. The schema change is asynchronous, and the task is returned when the task is submitted successfully. After that, you can use the ",(0,t.jsx)(n.a,{href:"../../../../sql-manual/sql-statements/table-and-view/table/SHOW-ALTER-TABLE",children:"SHOW ALTER TABLE COLUMN"})," command to view the progress."]}),"\n",(0,t.jsx)(n.p,{children:"Doris has the concept of materialized index after table construction. After successful table construction, it is the base table and the materialized index is the base index. rollup index can be created based on the base table. Both base index and rollup index are materialized indexes. If rollup_index_name is not specified during the schema change operation, the operation is based on the base table by default."}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"Doris 1.2.0 supports light schema change for light scale structure changes, and addition and subtraction operations for value columns can be completed more quickly and synchronously. You can manually specify \"light_schema_change\" = 'true' when creating a table. This parameter is enabled by default for versions 2.0.0 and later."})}),"\n",(0,t.jsx)(n.h3,{id:"grammar",children:"Grammar:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE [database.]table alter_clause;\n"})}),"\n",(0,t.jsx)(n.p,{children:"The alter_clause of schema change supports the following modification methods:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. Add a column to the specified position at the specified index"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Grammar"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE [database.]table table_name ADD COLUMN column_name column_type [KEY | agg_type] [DEFAULT "default_value"]\n[AFTER column_name|FIRST]\n[TO rollup_index_name]\n[PROPERTIES ("key"="value", ...)]\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Add a key column new_col to example_db.my_table after key_1 (non-aggregated model)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE example_db.my_table\nADD COLUMN new_col INT KEY DEFAULT "0" AFTER key_1;\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Add a value column new_col to example_db.my_table after value_1 (non-aggregate model)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE example_db.my_table\nADD COLUMN new_col INT DEFAULT "0" AFTER value_1;\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"Add a key column new_col (aggregate model) to example_db.my_table after key_1"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE example_db.my_table\nADD COLUMN new_col INT KEY DEFAULT "0" AFTER key_1;\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"Add a value column to example_db.my_table after value_1 new_col SUM Aggregation type (aggregation model)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE example_db.my_table   \nADD COLUMN new_col INT SUM DEFAULT "0" AFTER value_1; \n'})}),"\n",(0,t.jsxs)(n.ol,{start:"5",children:["\n",(0,t.jsx)(n.li,{children:"Add new_col to the first column position of the example_db.my_table table (non-aggregated model)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE example_db.my_table\nADD COLUMN new_col INT KEY DEFAULT "0" FIRST;\n'})}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.mdxadmonitiontitle,{}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If you add a value column to the aggregation model, you need to specify agg_type"}),"\n",(0,t.jsx)(n.li,{children:"For non-aggregated models (such as DUPLICATE KEY), if you add a key column, you need to specify the KEY keyword"}),"\n",(0,t.jsx)(n.li,{children:"You cannot add columns that already exist in the base index to the rollup index (you can recreate a rollup index if necessary)"}),"\n"]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. Add multiple columns to the specified index"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Grammar"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE [database.]table table_name ADD COLUMN (column_name1 column_type [KEY | agg_type] DEFAULT "default_value", ...)\n[TO rollup_index_name]\n[PROPERTIES ("key"="value", ...)]\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Add multiple columns to example_db.my_table, where new_col and new_col2 are SUM aggregate types (aggregate model)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE example_db.my_table\nADD COLUMN (new_col1 INT SUM DEFAULT "0" ,new_col2 INT SUM DEFAULT "0");\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Add multiple columns to example_db.my_table (non-aggregated model), where new_col1 is the KEY column and new_col2 is the value column"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE example_db.my_table\nADD COLUMN (new_col1 INT key DEFAULT "0" , new_col2 INT DEFAULT "0");\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If you add a value column to the aggregation model, you need to specify agg_type"}),"\n",(0,t.jsx)(n.li,{children:"If you add a key column to the aggregation model, you need to specify the KEY keyword"}),"\n",(0,t.jsx)(n.li,{children:"You cannot add columns that already exist in the base index to the rollup index (you can recreate a rollup index if necessary)"}),"\n"]})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"3. Delete a column from the specified index"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Grammar"}),"*"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE [database.]table table_name DROP COLUMN column_name\n[FROM rollup_index_name]\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Delete column col1 from example_db.my_table"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE example_db.my_table DROP COLUMN col1;\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Cannot drop partition column"}),"\n",(0,t.jsx)(n.li,{children:"The aggregate model cannot delete KEY columns"}),"\n",(0,t.jsx)(n.li,{children:"If the column is removed from the base index, it will also be removed if it is included in the rollup index"}),"\n"]})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"4. Modify the column type and column position of the specified index"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Grammar"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE [database.]table table_name MODIFY COLUMN column_name column_type [KEY | agg_type] [NULL | NOT NULL] [DEFAULT "default_value"]\n[AFTER column_name|FIRST]\n[FROM rollup_index_name]\n[PROPERTIES ("key"="value", ...)]\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Modify the type of the key column col1 of the base index to BIGINT and move it to the back of the col2 column"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE example_db.my_table \nMODIFY COLUMN col1 BIGINT KEY DEFAULT "1" AFTER col2;\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"Whether you modify the key column or the value column, you need to declare complete column information"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:'Modify the maximum length of the val1 column of base index. The original val1 is (val1 VARCHAR(32) REPLACE DEFAULT "abc")'}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE example_db.my_table \nMODIFY COLUMN val1 VARCHAR(64) REPLACE DEFAULT "abc";\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"You can only modify the column's data type; other attributes of the column must remain unchanged."})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"Modify the length of a field in the Key column of the Duplicate key table"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE example_db.my_table \nMODIFY COLUMN k3 VARCHAR(50) KEY NULL COMMENT 'to 50';\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If you modify the value column in the aggregation model, you need to specify agg_type"}),"\n",(0,t.jsx)(n.li,{children:"If you modify the key column for non-aggregate types, you need to specify the KEY keyword"}),"\n",(0,t.jsx)(n.li,{children:"Only the type of the column can be modified, and other attributes of the column remain as they are (that is, other attributes need to be explicitly written in the statement according to the   original attributes, see example 8)"}),"\n",(0,t.jsx)(n.li,{children:"Partitioning and bucketing columns cannot be modified in any way"}),"\n",(0,t.jsxs)(n.li,{children:["The following types of conversions are currently supported (loss of precision is guaranteed by the user)\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Conversion of TINYINT/SMALLINT/INT/BIGINT/LARGEINT/FLOAT/DOUBLE types to larger numeric types"}),"\n",(0,t.jsx)(n.li,{children:"Convert TINTINT/SMALLINT/INT/BIGINT/LARGEINT/FLOAT/DOUBLE/DECIMAL to VARCHAR"}),"\n",(0,t.jsx)(n.li,{children:"VARCHAR supports modifying the maximum length"}),"\n",(0,t.jsx)(n.li,{children:"VARCHAR/CHAR converted to TINTINT/SMALLINT/INT/BIGINT/LARGEINT/FLOAT/DOUBLE"}),"\n",(0,t.jsx)(n.li,{children:'Convert VARCHAR/CHAR to DATE (currently supports "%Y-%m-%d", "%y-%m-%d", "%Y%m%d", "%y%m%d", "%Y/%m/%d, "%y/%m/%d" six formats)'}),"\n",(0,t.jsxs)(n.li,{children:["Convert DATETIME to DATE (only keep year-month-day information, for example: ",(0,t.jsx)(n.code,{children:"2019-12-09 21:47:05"})," <--\x3e ",(0,t.jsx)(n.code,{children:"2019-12-09"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["DATE is converted to DATETIME (hours, minutes and seconds are automatically filled with zeros, for example: ",(0,t.jsx)(n.code,{children:"2019-12-09"})," <--\x3e ",(0,t.jsx)(n.code,{children:"2019-12-09 00:00:00"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Convert FLOAT to DOUBLE"}),"\n",(0,t.jsx)(n.li,{children:"INT is converted to DATE (if the INT type data is illegal, the conversion fails, and the original data remains unchanged)"}),"\n",(0,t.jsx)(n.li,{children:"All can be converted to STRING except DATE and DATETIME, but STRING cannot be converted to any other type"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"5. Reorder the column at the specified index"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Grammar"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE [database.]table table_name ORDER BY (column_name1, column_name2, ...)\n[FROM rollup_index_name]\n[PROPERTIES ("key"="value", ...)]\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Adjust the order of the key and value columns of example_db.my_table (non-aggregate model)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE `my_table`(\n`k_1` INT NULL,\n`k_2` INT NULL,\n`v_1` INT NULL,\n`v_2` varchar NULL,\n`v_3` varchar NULL\n) ENGINE=OLAP\nDUPLICATE KEY(`k_1`, `k_2`)\nCOMMENT \'OLAP\'\nDISTRIBUTED BY HASH(`k_1`) BUCKETS 5\nPROPERTIES (\n"replication_allocation" = "tag.location.default: 1"\n);\n\nALTER TABLE example_db.my_table ORDER BY (k_2,k_1,v_3,v_2,v_1);\n\nmysql> desc my_table;\n+-------+------------+------+-------+---------+-------+\n| Field | Type       | Null | Key   | Default | Extra |\n+-------+------------+------+-------+---------+-------+\n| k_2   | INT        | Yes  | true  | NULL    |       |\n| k_1   | INT        | Yes  | true  | NULL    |       |\n| v_3   | VARCHAR(*) | Yes  | false | NULL    | NONE  |\n| v_2   | VARCHAR(*) | Yes  | false | NULL    | NONE  |\n| v_1   | INT        | Yes  | false | NULL    | NONE  |\n+-------+------------+------+-------+---------+-------+\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Do two actions simultaneously"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE `my_table` (\n`k_1` INT NULL,\n`k_2` INT NULL,\n`v_1` INT NULL,\n`v_2` varchar NULL,\n`v_3` varchar NULL\n) ENGINE=OLAP\nDUPLICATE KEY(`k_1`, `k_2`)\nCOMMENT \'OLAP\'\nDISTRIBUTED BY HASH(`k_1`) BUCKETS 5\nPROPERTIES (\n"replication_allocation" = "tag.location.default: 1"\n);\n\nALTER TABLE example_db.my_table\nADD COLUMN col INT DEFAULT "0" AFTER v_1,\nORDER BY (k_2,k_1,v_3,v_2,v_1,col);\n\nmysql> desc my_table;\n+-------+------------+------+-------+---------+-------+\n| Field | Type       | Null | Key   | Default | Extra |\n+-------+------------+------+-------+---------+-------+\n| k_2   | INT        | Yes  | true  | NULL    |       |\n| k_1   | INT        | Yes  | true  | NULL    |       |\n| v_3   | VARCHAR(*) | Yes  | false | NULL    | NONE  |\n| v_2   | VARCHAR(*) | Yes  | false | NULL    | NONE  |\n| v_1   | INT        | Yes  | false | NULL    | NONE  |\n| col   | INT        | Yes  | false | 0       | NONE  |\n+-------+------------+------+-------+---------+-------+\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"All columns in index are written out"}),"\n",(0,t.jsx)(n.li,{children:"the value column comes after the key column"}),"\n",(0,t.jsx)(n.li,{children:"You can adjust the key column only within the range of the key column. The same applies to the value column"}),"\n"]})}),"\n",(0,t.jsx)(n.h2,{id:"keywords",children:"Keywords"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"ALTER, TABLE, COLUMN, ALTER TABLE\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practice",children:"Best Practice"})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},250065:function(e,n,l){l.d(n,{Z:function(){return o},a:function(){return i}});var a=l(667294);let t={},s=a.createContext(t);function i(e){let n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);