"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["844925"],{227045:function(e,i,n){n.r(i),n.d(i,{default:()=>h,frontMatter:()=>s,metadata:()=>t,assets:()=>o,toc:()=>r,contentTitle:()=>l});var t=JSON.parse('{"id":"admin-manual/audit-plugin","title":"Audit Log","description":"Doris provides auditing capabilities for database operations, allowing the recording of user logins, queries,","source":"@site/docs/admin-manual/audit-plugin.md","sourceDirName":"admin-manual","slug":"/admin-manual/audit-plugin","permalink":"/docs/dev/admin-manual/audit-plugin","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Audit Log","language":"en","description":"Doris provides auditing capabilities for database operations, allowing the recording of user logins, queries,"},"sidebar":"docs","previous":{"title":"Data Access Control","permalink":"/docs/dev/admin-manual/auth/authorization/data"},"next":{"title":"MySQL Secure Transport","permalink":"/docs/dev/admin-manual/auth/certificate"}}'),d=n("785893"),a=n("250065");let s={title:"Audit Log",language:"en",description:"Doris provides auditing capabilities for database operations, allowing the recording of user logins, queries,"},l=void 0,o={},r=[{value:"Enabling Audit Logs",id:"enabling-audit-logs",level:2},{value:"Viewing the Audit Log Table",id:"viewing-the-audit-log-table",level:2},{value:"Audit Log Files",id:"audit-log-files",level:2},{value:"Audit Log Format",id:"audit-log-format",level:2},{value:"Audit Log Configuration",id:"audit-log-configuration",level:2}];function c(e){let i={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.a)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(i.p,{children:"Doris provides auditing capabilities for database operations, allowing the recording of user logins, queries, and modification operations on the database. In Doris, audit logs can be queried directly through built-in system tables or by viewing Doris's audit log files."}),"\n",(0,d.jsx)(i.h2,{id:"enabling-audit-logs",children:"Enabling Audit Logs"}),"\n",(0,d.jsxs)(i.p,{children:["The audit log plugin can be enabled or disabled at any time using the global variable ",(0,d.jsx)(i.code,{children:"enable_audit_plugin"})," (disabled by default), for example:"]}),"\n",(0,d.jsx)(i.p,{children:(0,d.jsx)(i.code,{children:"set global enable_audit_plugin = true;"})}),"\n",(0,d.jsxs)(i.p,{children:["Once enabled, Doris will write the audit logs to the ",(0,d.jsx)(i.code,{children:"audit_log"})," table."]}),"\n",(0,d.jsx)(i.p,{children:"You can disable the audit log plugin at any time:"}),"\n",(0,d.jsx)(i.p,{children:(0,d.jsx)(i.code,{children:"set global enable_audit_plugin = false;"})}),"\n",(0,d.jsxs)(i.p,{children:["After disabling, Doris will stop writing to the ",(0,d.jsx)(i.code,{children:"audit_log"})," table. The already written audit logs will remain unchanged."]}),"\n",(0,d.jsx)(i.h2,{id:"viewing-the-audit-log-table",children:"Viewing the Audit Log Table"}),"\n",(0,d.jsx)(i.admonition,{title:"Note",type:"caution",children:(0,d.jsxs)(i.p,{children:["Before version 2.1.8, as the system version was upgraded, the audit log table fields may have increased. After upgrading, you need to add fields to the ",(0,d.jsx)(i.code,{children:"audit_log"})," table using the ",(0,d.jsx)(i.code,{children:"ALTER TABLE"})," command based on the fields in the audit log table."]})}),"\n",(0,d.jsxs)(i.p,{children:["Starting from Doris version 2.1, Doris can write user behavior operations to the ",(0,d.jsx)(i.a,{href:"../admin-manual/system-tables/internal_schema/audit_log",children:(0,d.jsx)(i.code,{children:"audit_log"})})," table in the ",(0,d.jsx)(i.code,{children:"__internal_schema"})," database by enabling the audit log feature."]}),"\n",(0,d.jsxs)(i.p,{children:["The audit log table is a dynamically partitioned table, partitioned daily by default, retaining the most recent 30 days of data. You can adjust the retention period of dynamic partitions by modifying the ",(0,d.jsx)(i.code,{children:"dynamic_partition.start"})," property using the ",(0,d.jsx)(i.code,{children:"ALTER TABLE"})," statement."]}),"\n",(0,d.jsx)(i.h2,{id:"audit-log-files",children:"Audit Log Files"}),"\n",(0,d.jsxs)(i.p,{children:["In ",(0,d.jsx)(i.code,{children:"fe.conf"}),", ",(0,d.jsx)(i.code,{children:"LOG_DIR"})," defines the storage path for FE logs. All database operations executed by this FE node are recorded in ",(0,d.jsx)(i.code,{children:"${LOG_DIR}/fe.audit.log"}),". To view all operations in the cluster, you need to traverse the audit logs of each FE node."]}),"\n",(0,d.jsx)(i.h2,{id:"audit-log-format",children:"Audit Log Format"}),"\n",(0,d.jsxs)(i.p,{children:["In versions before 3.0.7, the symbols ",(0,d.jsx)(i.code,{children:"\\n"}),", ",(0,d.jsx)(i.code,{children:"\\t"}),", and ",(0,d.jsx)(i.code,{children:"\\r"})," in statements would be replaced with ",(0,d.jsx)(i.code,{children:"\\\\n"}),", ",(0,d.jsx)(i.code,{children:"\\\\t"}),", and ",(0,d.jsx)(i.code,{children:"\\\\r"}),". These modified statements were then stored in the ",(0,d.jsx)(i.code,{children:"fe.audit.log"})," file and the ",(0,d.jsx)(i.code,{children:"audit_log"})," table."]}),"\n",(0,d.jsxs)(i.p,{children:["Starting from version 3.0.7, for the ",(0,d.jsx)(i.code,{children:"fe.audit.log"})," file, only ",(0,d.jsx)(i.code,{children:"\\n"})," in statements will be replaced with ",(0,d.jsx)(i.code,{children:"\\\\n"}),". The ",(0,d.jsx)(i.code,{children:"audit_log"})," table, stores the original format of statements."]}),"\n",(0,d.jsx)(i.h2,{id:"audit-log-configuration",children:"Audit Log Configuration"}),"\n",(0,d.jsx)(i.p,{children:(0,d.jsx)(i.strong,{children:"Global Variables:"})}),"\n",(0,d.jsxs)(i.p,{children:["Audit log variables can be modified using ",(0,d.jsx)(i.code,{children:"set [global] <var_name> = <var_value>"}),"."]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(i.table,{children:[(0,d.jsx)(i.thead,{children:(0,d.jsxs)(i.tr,{children:[(0,d.jsx)(i.th,{children:"Variable"}),(0,d.jsx)(i.th,{children:"Default Value"}),(0,d.jsx)(i.th,{children:"Description"})]})}),(0,d.jsxs)(i.tbody,{children:[(0,d.jsxs)(i.tr,{children:[(0,d.jsx)(i.td,{children:(0,d.jsx)(i.code,{children:"audit_plugin_max_batch_interval_sec"})}),(0,d.jsx)(i.td,{children:"60 seconds"}),(0,d.jsx)(i.td,{children:"Maximum write interval for the audit log table."})]}),(0,d.jsxs)(i.tr,{children:[(0,d.jsx)(i.td,{children:(0,d.jsx)(i.code,{children:"audit_plugin_max_batch_bytes"})}),(0,d.jsx)(i.td,{children:"50MB"}),(0,d.jsx)(i.td,{children:"Maximum data volume per batch for the audit log table."})]}),(0,d.jsxs)(i.tr,{children:[(0,d.jsx)(i.td,{children:(0,d.jsx)(i.code,{children:"audit_plugin_max_sql_length"})}),(0,d.jsx)(i.td,{children:"4096"}),(0,d.jsx)(i.td,{children:"Maximum length of SQL statements recorded in the audit log table."})]}),(0,d.jsxs)(i.tr,{children:[(0,d.jsx)(i.td,{children:(0,d.jsx)(i.code,{children:"audit_plugin_load_timeout"})}),(0,d.jsx)(i.td,{children:"600 seconds"}),(0,d.jsx)(i.td,{children:"Default timeout for audit log import jobs."})]}),(0,d.jsxs)(i.tr,{children:[(0,d.jsx)(i.td,{children:(0,d.jsx)(i.code,{children:"audit_plugin_max_insert_stmt_length"})}),(0,d.jsx)(i.td,{children:"Int.MAX"}),(0,d.jsxs)(i.td,{children:["The maximum length limit for ",(0,d.jsx)(i.code,{children:"INSERT"})," statements. If larger than ",(0,d.jsx)(i.code,{children:"audit_plugin_max_sql_length"}),", the value of ",(0,d.jsx)(i.code,{children:"audit_plugin_max_sql_length"})," is used. This parameter is supported since 3.0.6."]})]})]})]}),"\n",(0,d.jsxs)(i.p,{children:["Because some ",(0,d.jsx)(i.code,{children:"INSERT INTO VALUES"})," statements may be too long and submitted frequently, causing the audit log too large. Therefore, Doris added ",(0,d.jsx)(i.code,{children:"audit_plugin_max_insert_stmt_length"})," in version 3.0.6 to limit the audit length of ",(0,d.jsx)(i.code,{children:"INSERT"})," statements separately. This avoids the expansion of the audit log and ensures that the SQL statements are fully audited."]}),"\n",(0,d.jsx)(i.p,{children:(0,d.jsx)(i.strong,{children:"FE Configuration Items:"})}),"\n",(0,d.jsxs)(i.p,{children:["FE configuration items can be modified by editing the ",(0,d.jsx)(i.code,{children:"fe.conf"})," directory."]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(i.table,{children:[(0,d.jsx)(i.thead,{children:(0,d.jsxs)(i.tr,{children:[(0,d.jsx)(i.th,{children:"Configuration Item"}),(0,d.jsx)(i.th,{children:"Description"})]})}),(0,d.jsx)(i.tbody,{children:(0,d.jsxs)(i.tr,{children:[(0,d.jsx)(i.td,{children:(0,d.jsx)(i.code,{children:"skip_audit_user_list"})}),(0,d.jsxs)(i.td,{children:["If you do not want operations of certain users to be recorded in the audit logs, you can modify this configuration (supported since version 3.0.01). For example, use the config to exclude ",(0,d.jsx)(i.code,{children:"user1"})," and ",(0,d.jsx)(i.code,{children:"user2"})," from audit log recording: ",(0,d.jsx)(i.code,{children:"skip_audit_user_list=user1,user2"})]})]})})]})]})}function h(e={}){let{wrapper:i}={...(0,a.a)(),...e.components};return i?(0,d.jsx)(i,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},250065:function(e,i,n){n.d(i,{Z:function(){return l},a:function(){return s}});var t=n(667294);let d={},a=t.createContext(d);function s(e){let i=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),t.createElement(a.Provider,{value:i},e.children)}}}]);