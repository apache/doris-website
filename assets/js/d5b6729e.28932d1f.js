"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["439112"],{67737:function(e,n,r){r.r(n),r.d(n,{default:()=>u,frontMatter:()=>l,metadata:()=>a,assets:()=>c,toc:()=>d,contentTitle:()=>s});var a=JSON.parse('{"id":"sql-manual/sql-functions/scalar-functions/array-functions/array-difference","title":"ARRAY_DIFFERENCE","description":"array_difference","source":"@site/docs/sql-manual/sql-functions/scalar-functions/array-functions/array-difference.md","sourceDirName":"sql-manual/sql-functions/scalar-functions/array-functions","slug":"/sql-manual/sql-functions/scalar-functions/array-functions/array-difference","permalink":"/docs/dev/sql-manual/sql-functions/scalar-functions/array-functions/array-difference","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"ARRAY_DIFFERENCE","language":"en"},"sidebar":"docs","previous":{"title":"ARRAY_CUM_SUM","permalink":"/docs/dev/sql-manual/sql-functions/scalar-functions/array-functions/array-cum-sum"},"next":{"title":"ARRAY_DISTINCT","permalink":"/docs/dev/sql-manual/sql-functions/scalar-functions/array-functions/array-distinct"}}'),t=r("785893"),i=r("250065");let l={title:"ARRAY_DIFFERENCE",language:"en"},s=void 0,c={},d=[{value:"array_difference",id:"array_difference",level:2},{value:"Description",id:"description",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Return Value",id:"return-value",level:3},{value:"Examples",id:"examples",level:3},{value:"Keywords",id:"keywords",level:3}];function o(e){let n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",version:"version",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"array_difference",children:"array_difference"}),"\n",(0,t.jsx)(n.version,{since:"2.0.0",children:"\n"}),"\n",(0,t.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,t.jsx)(n.p,{children:"Calculates the difference between adjacent elements in an array. The function traverses the array from left to right, calculating the difference between each element and its previous element, and returns a new array with the same length as the original array. The difference of the first element is always 0."}),"\n",(0,t.jsx)(n.h2,{id:"syntax",children:"Syntax"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"array_difference(ARRAY<T> arr)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"arr"}),"\uFF1AARRAY<T> type, the array to calculate differences for. Supports column names or constant values."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"T supported types:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Numeric types: TINYINT, SMALLINT, INT, BIGINT, LARGEINT, FLOAT, DOUBLE, DECIMAL"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"return-value",children:"Return Value"}),"\n",(0,t.jsx)(n.p,{children:"Return type: ARRAY<T>"}),"\n",(0,t.jsx)(n.p,{children:"Return value meaning:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Returns a new array with the same length as the input array, where each position contains the difference between the current element and the previous element, with the first element's difference being 0"}),"\n",(0,t.jsx)(n.li,{children:"NULL: if the input array is NULL"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Usage notes:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If the array contains other types (such as strings etc.), it will attempt to convert elements to DOUBLE type. Elements that fail conversion will result in null and will not participate in the difference calculation."}),"\n",(0,t.jsxs)(n.li,{children:["The function will attempt to convert all elements to compatible numeric types for difference calculation,and the return type of the difference is automatically selected based on the input type:\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"When input is DOUBLE or FLOAT, returns ARRAY<DOUBLE>"}),"\n",(0,t.jsx)(n.li,{children:"When input is integer type, returns ARRAY<BIGINT> or ARRAY<LARGEINT>"}),"\n",(0,t.jsx)(n.li,{children:"When input is DECIMAL, returns ARRAY<DECIMAL>, maintaining original precision and scale"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"The difference calculation order is from left to right, where each position contains the difference between the current element and the previous element, with the first element being 0."}),"\n",(0,t.jsx)(n.li,{children:"Empty array returns empty array, NULL array returns NULL, array with only one element returns [0]."}),"\n",(0,t.jsx)(n.li,{children:"Complex types (nested arrays, MAP, STRUCT) do not support difference calculation, calling will result in an error."}),"\n",(0,t.jsx)(n.li,{children:"For null values in array elements: null elements will affect subsequent difference calculations, when the previous element is null, the current difference will be null"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE array_difference_test (\n    id INT,\n    int_array ARRAY<INT>,\n    double_array ARRAY<DOUBLE>\n)\nDUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 3\nPROPERTIES (\n    "replication_num" = "1"\n);\n\nINSERT INTO array_difference_test VALUES\n(1, [1, 3, 6, 10, 15], [1.1, 3.3, 6.6, 11.0, 16.5]),\n(2, [10, 30, 60], [10.5, 41.0, 76.5]),\n(3, [], []),\n(4, NULL, NULL);\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Query examples:"})}),"\n",(0,t.jsx)(n.p,{children:"Difference of int_array: each position contains the difference between the current element and the previous element, with the first element being 0."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference(int_array) FROM array_difference_test WHERE id = 1;\n+-----------------------------+\n| array_difference(int_array) |\n+-----------------------------+\n| [0, 2, 3, 4, 5]             |\n+-----------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"Difference of double_array: difference of floating-point array, result is floating-point."}),"\n",(0,t.jsx)(n.p,{children:'Note that the result at the second position is 2.1999999999999997, which is due to the small error caused by floating-point binary representation precision (3.3 - 1.1 cannot be precisely represented as 2.2 in binary). The subsequent values 3.3, 4.4, 5.5 may appear as "normal values", but they are actually binary approximations, just that they match the decimal after rounding. This is a phenomenon that all systems based on IEEE 754 floating-point (including MySQL, Snowflake, Python, JavaScript, etc.) will encounter.'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference(double_array) FROM array_difference_test WHERE id = 1;\n+------------------------------------------+\n| array_difference(double_array)           |\n+------------------------------------------+\n| [0, 2.1999999999999997, 3.3, 4.4, 5.5]  |\n+------------------------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"Empty array returns empty array:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference(int_array) FROM array_difference_test WHERE id = 3;\n+-----------------------------+\n| array_difference(int_array) |\n+-----------------------------+\n| []                          |\n+-----------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"NULL array returns NULL: returning NULL when the input array is NULL without throwing an error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference(int_array) FROM array_difference_test WHERE id = 4;\n+-----------------------------+\n| array_difference(int_array) |\n+-----------------------------+\n| NULL                        |\n+-----------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"Array with only one element returns [0]:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference([42]);\n+------------------------+\n| array_difference([42]) |\n+------------------------+\n| [0]                    |\n+------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"Array containing null values, when the previous element is null, the current difference will be null."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference([1, null, 3, null, 5]);\n+-----------------------------------------+\n| array_difference([1, null, 3, null, 5]) |\n+-----------------------------------------+\n| [0, null, null, null, null]             |\n+-----------------------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"When mixing strings and numbers, elements that can be converted to numbers will participate in the difference calculation, those that cannot be converted will be null, and the result at the corresponding position will be null."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference(['a', 1, 'b', 2, 'c', 3]);\n+--------------------------------------------+\n| array_difference(['a', 1, 'b', 2, 'c', 3]) |\n+--------------------------------------------+\n| [null, null, null, null, null, null]       |\n+--------------------------------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"Complex type examples:"}),"\n",(0,t.jsx)(n.p,{children:"Nested array type not supported, throws error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference([[1,2,3]]);\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not find the compatibility function signature: array_difference(ARRAY<ARRAY<TINYINT>>)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Map type not supported, throws error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference([{'k':1},{'k':2}]);\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not find the compatibility function signature: array_difference(ARRAY<MAP<VARCHAR(1),TINYINT>>)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Struct type not supported, throws error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference(array(named_struct('name','Alice','age',20),named_struct('name','Bob','age',30)));\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not find the compatibility function signature: array_difference(ARRAY<STRUCT<name:TEXT,age:TINYINT>>)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Incorrect number of parameters will cause an error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference([1,2,3],[4,5,6]);\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not found function 'array_difference' which has 2 arity. Candidate functions are: [array_difference(Expression)]\n"})}),"\n",(0,t.jsx)(n.p,{children:"Passing non-array type will cause an error."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT array_difference('not_an_array');\nERROR 1105 (HY000): errCode = 2, detailMessage = Can not find the compatibility function signature: array_difference(VARCHAR(12))\n"})}),"\n",(0,t.jsx)(n.h3,{id:"keywords",children:"Keywords"}),"\n",(0,t.jsx)(n.p,{children:"ARRAY, DIFFERENCE, ARRAY_DIFFERENCE"})]})}function u(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return s},a:function(){return l}});var a=r(667294);let t={},i=a.createContext(t);function l(e){let n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);