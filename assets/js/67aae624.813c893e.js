"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["163094"],{142264:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>d,metadata:()=>i,assets:()=>l,toc:()=>o,contentTitle:()=>c});var i=JSON.parse('{"id":"ecosystem/observability/vector","title":"Integrating Vector with Doris","description":"About Vector","source":"@site/versioned_docs/version-3.x/ecosystem/observability/vector.md","sourceDirName":"ecosystem/observability","slug":"/ecosystem/observability/vector","permalink":"/docs/3.x/ecosystem/observability/vector","draft":false,"unlisted":false,"tags":[],"version":"3.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Integrating Vector with Doris","language":"en"},"sidebar":"docs","previous":{"title":"Langfuse on Doris","permalink":"/docs/3.x/ecosystem/observability/langfuse"},"next":{"title":"Overview","permalink":"/docs/3.x/compute-storage-decoupled/overview"}}'),r=t("785893"),s=t("250065");let d={title:"Integrating Vector with Doris",language:"en"},c="Integrating Vector with Doris",l={},o=[{value:"About Vector",id:"about-vector",level:2},{value:"Installation",id:"installation",level:2},{value:"Download Installation Package",id:"download-installation-package",level:3},{value:"Build from Source",id:"build-from-source",level:3},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Basic Configuration",id:"basic-configuration",level:3},{value:"Authentication Configuration",id:"authentication-configuration",level:3},{value:"Request and Concurrency Configuration",id:"request-and-concurrency-configuration",level:3},{value:"Encoding and Data Format",id:"encoding-and-data-format",level:3},{value:"Stream Load Headers (<code>headers</code>)",id:"stream-load-headers-headers",level:4},{value:"Batch Configuration",id:"batch-configuration",level:3},{value:"Reliability and Security Configuration",id:"reliability-and-security-configuration",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"TEXT Log Collection Example",id:"text-log-collection-example",level:3},{value:"JSON Log Collection Example",id:"json-log-collection-example",level:3},{value:"Start Vector",id:"start-vector",level:4}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"integrating-vector-with-doris",children:"Integrating Vector with Doris"})}),"\n",(0,r.jsx)(n.h2,{id:"about-vector",children:"About Vector"}),"\n",(0,r.jsx)(n.p,{children:"Vector is a high-performance observability data pipeline written in Rust, specifically designed for collecting, transforming, and routing logs, metrics, and traces. To better support the Doris ecosystem, we have developed a dedicated Doris Sink component for Vector, enabling efficient data ingestion from various data sources into Doris for analysis."}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.h3,{id:"download-installation-package",children:"Download Installation Package"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"wget https://apache-doris-releases.oss-cn-beijing.aliyuncs.com/extension/vector-x86_64-unknown-linux-gnu.tar.gz\n"})}),"\n",(0,r.jsx)(n.h3,{id:"build-from-source",children:"Build from Source"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"cd ${Vector_HOME}\n\n## Choose the appropriate option based on your deployment environment. Multiple options are available in the Makefile.\nmake package-x86_64-unknown-linux-gnu\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,r.jsx)(n.p,{children:"Doris Sink supports extensive configuration options to meet data writing requirements in different scenarios:"}),"\n",(0,r.jsx)(n.h3,{id:"basic-configuration",children:"Basic Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"type"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsxs)(n.td,{children:["Fixed as ",(0,r.jsx)(n.code,{children:"doris"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"inputs"})}),(0,r.jsx)(n.td,{children:"array"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"List of upstream data source names"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"endpoints"})}),(0,r.jsx)(n.td,{children:"array<string>"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsxs)(n.td,{children:["Doris FE HTTP/HTTPS addresses, must include protocol and port, e.g., ",(0,r.jsx)(n.code,{children:'["https://fe1:8030"]'})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"database"})}),(0,r.jsx)(n.td,{children:"string/template"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsxs)(n.td,{children:["Target database name, supports ",(0,r.jsx)(n.a,{href:"https://vector.dev/docs/reference/configuration/template-syntax/",children:"Template"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"table"})}),(0,r.jsx)(n.td,{children:"string/template"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"Target table name, supports template"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"label_prefix"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"vector"'})}),(0,r.jsxs)(n.td,{children:["Stream Load label prefix, final label format is ",(0,r.jsx)(n.code,{children:"{label_prefix}_{database}_{table}_{timestamp}_{uuid}"})]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"authentication-configuration",children:"Authentication Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"auth.strategy"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"basic"'})}),(0,r.jsx)(n.td,{children:"Authentication strategy, Doris currently only supports Basic Auth"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"auth.user"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"Doris username"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"auth.password"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"Doris password, can be used with environment variables or secret management systems"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"request-and-concurrency-configuration",children:"Request and Concurrency Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.concurrency"})}),(0,r.jsx)(n.td,{children:"string/integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"adaptive"'})}),(0,r.jsxs)(n.td,{children:["Controls concurrency strategy, supports ",(0,r.jsx)(n.code,{children:'"adaptive"'}),", ",(0,r.jsx)(n.code,{children:'"none"'})," (serial), or a positive integer for concurrency limit"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.timeout_secs"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"60"})}),(0,r.jsx)(n.td,{children:"Timeout for a single Stream Load request (seconds)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.rate_limit_duration_secs"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1"})}),(0,r.jsx)(n.td,{children:"Rate limit time window (seconds)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.rate_limit_num"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"i64::MAX"})}),(0,r.jsx)(n.td,{children:"Number of requests allowed per time window, default is virtually unlimited"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.retry_attempts"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"usize::MAX"})}),(0,r.jsx)(n.td,{children:"Maximum retry attempts for Tower middleware, default means unlimited retries"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.retry_initial_backoff_secs"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1"})}),(0,r.jsx)(n.td,{children:"Wait time before the first retry (seconds), subsequent retries use Fibonacci backoff"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.retry_max_duration_secs"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"30"})}),(0,r.jsx)(n.td,{children:"Maximum wait time for a single retry backoff (seconds)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.retry_jitter_mode"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"full"'})}),(0,r.jsxs)(n.td,{children:["Retry jitter mode, supports ",(0,r.jsx)(n.code,{children:"full"})," or ",(0,r.jsx)(n.code,{children:"none"})]})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Adaptive Concurrency (",(0,r.jsx)(n.code,{children:"request.adaptive_concurrency"}),", only effective when ",(0,r.jsx)(n.code,{children:'request.concurrency = "adaptive"'}),")"]})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.adaptive_concurrency.initial_concurrency"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1"})}),(0,r.jsx)(n.td,{children:"Initial value for adaptive concurrency"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.adaptive_concurrency.max_concurrency_limit"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"200"})}),(0,r.jsx)(n.td,{children:"Upper limit for adaptive concurrency to prevent overload"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.adaptive_concurrency.decrease_ratio"})}),(0,r.jsx)(n.td,{children:"float"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0.9"})}),(0,r.jsx)(n.td,{children:"Reduction ratio used when triggering slowdown"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.adaptive_concurrency.ewma_alpha"})}),(0,r.jsx)(n.td,{children:"float"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0.4"})}),(0,r.jsx)(n.td,{children:"Exponential moving average weight for RTT metrics"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"request.adaptive_concurrency.rtt_deviation_scale"})}),(0,r.jsx)(n.td,{children:"float"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2.5"})}),(0,r.jsx)(n.td,{children:"RTT deviation amplification factor, used to ignore normal fluctuations"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"encoding-and-data-format",children:"Encoding and Data Format"}),"\n",(0,r.jsxs)(n.p,{children:["Doris Sink uses the ",(0,r.jsx)(n.code,{children:"encoding"})," block to control event serialization behavior, defaulting to NDJSON (newline-delimited JSON):"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"encoding.codec"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"json"'})}),(0,r.jsxs)(n.td,{children:["Serialization encoding, options include ",(0,r.jsx)(n.code,{children:"json"}),", ",(0,r.jsx)(n.code,{children:"text"}),", ",(0,r.jsx)(n.code,{children:"csv"}),", etc."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"encoding.timestamp_format"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsxs)(n.td,{children:["Adjust timestamp output format, supports ",(0,r.jsx)(n.code,{children:"rfc3339"}),", ",(0,r.jsx)(n.code,{children:"unix"}),", etc."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"encoding.only_fields"})," / ",(0,r.jsx)(n.code,{children:"encoding.except_fields"})]}),(0,r.jsx)(n.td,{children:"array<string>"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"Control field whitelist or blacklist"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"encoding.framing.method"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"auto-inferred"}),(0,r.jsxs)(n.td,{children:["Set when custom framing format is needed, e.g., ",(0,r.jsx)(n.code,{children:"newline_delimited"}),", ",(0,r.jsx)(n.code,{children:"character_delimited"})]})]})]})]}),"\n",(0,r.jsxs)(n.h4,{id:"stream-load-headers-headers",children:["Stream Load Headers (",(0,r.jsx)(n.code,{children:"headers"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"headers"})," is a key-value pair mapping that is passed directly as HTTP headers for Doris Stream Load. You can use all parameters available in stream load headers.\nCommon settings are as follows (all values must be strings):"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"headers.format"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"json"'})}),(0,r.jsxs)(n.td,{children:["Data format, supports ",(0,r.jsx)(n.code,{children:"json"}),", ",(0,r.jsx)(n.code,{children:"csv"}),", ",(0,r.jsx)(n.code,{children:"parquet"}),", etc."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"headers.read_json_by_line"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"true"'})}),(0,r.jsx)(n.td,{children:"Whether to read JSON line by line (NDJSON)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"headers.strip_outer_array"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"false"'})}),(0,r.jsx)(n.td,{children:"Whether to remove the outermost array"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"headers.column_separator"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsxs)(n.td,{children:["CSV column separator (effective when ",(0,r.jsx)(n.code,{children:"format = csv"}),")"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"headers.columns"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsxs)(n.td,{children:["Column order for CSV/JSON mapping, e.g., ",(0,r.jsx)(n.code,{children:"timestamp,client_ip,status_code"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"headers.where"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsxs)(n.td,{children:["Stream Load ",(0,r.jsx)(n.code,{children:"where"})," filter condition"]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"batch-configuration",children:"Batch Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"batch.max_bytes"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"10485760"})}),(0,r.jsx)(n.td,{children:"Maximum bytes per batch (10 MB)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"batch.max_events"})}),(0,r.jsxs)(n.td,{children:["integer/",(0,r.jsx)(n.code,{children:"null"})]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"null"})}),(0,r.jsx)(n.td,{children:"Maximum events per batch, default is unlimited, primarily controlled by byte count"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"batch.timeout_secs"})}),(0,r.jsx)(n.td,{children:"float"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1"})}),(0,r.jsx)(n.td,{children:"Maximum wait time for a batch (seconds)"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"reliability-and-security-configuration",children:"Reliability and Security Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"max_retries"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"-1"})}),(0,r.jsxs)(n.td,{children:["Maximum retries at Sink level, ",(0,r.jsx)(n.code,{children:"-1"})," means unlimited"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"log_request"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Whether to print each Stream Load request and response (enable as needed in production)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"compression"})}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Not supported"})}),(0,r.jsx)(n.td,{children:"-"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"distribution.retry_initial_backoff_secs"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1"})}),(0,r.jsx)(n.td,{children:"Initial backoff time for endpoint health check recovery (seconds)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"distribution.retry_max_duration_secs"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"3600"})}),(0,r.jsx)(n.td,{children:"Maximum health check backoff duration (seconds)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"tls.verify_certificate"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})}),(0,r.jsx)(n.td,{children:"Enable/disable upstream certificate verification"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"tls.verify_hostname"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})}),(0,r.jsx)(n.td,{children:"Enable/disable hostname verification"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"tls.ca_file"})," / ",(0,r.jsx)(n.code,{children:"tls.crt_file"})," / ",(0,r.jsx)(n.code,{children:"tls.key_file"})," / ",(0,r.jsx)(n.code,{children:"tls.key_pass"})," / ",(0,r.jsx)(n.code,{children:"tls.alpn_protocols"})," / ",(0,r.jsx)(n.code,{children:"tls.server_name"})]}),(0,r.jsx)(n.td,{children:"various"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"Standard Vector TLS client configuration options for custom CA, mutual authentication, or SNI"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"acknowledgements.enabled"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Enable end-to-end acknowledgements for use with Sources that support acknowledgements"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,r.jsx)(n.h3,{id:"text-log-collection-example",children:"TEXT Log Collection Example"}),"\n",(0,r.jsx)(n.p,{children:"This example demonstrates TEXT log collection using Doris FE logs as an example."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Data"})}),"\n",(0,r.jsx)(n.p,{children:"FE log files are typically located at fe/log/fe.log under the Doris installation directory. This is a typical Java application log containing fields such as timestamp, log level, thread name, code position, and log message. In addition to regular logs, there are exception logs with stack traces that span multiple lines. Log collection and storage need to combine the main log and stack trace into a single log entry."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"2024-07-08 21:18:01,432 INFO (Statistics Job Appender|61) [StatisticsJobAppender.runAfterCatalogReady():70] Stats table not available, skip\n2024-07-08 21:18:53,710 WARN (STATS_FETCH-0|208) [StmtExecutor.executeInternalQuery():3332] Failed to run internal SQL: OriginStatement{originStmt='SELECT * FROM __internal_schema.column_statistics WHERE part_id is NULL  ORDER BY update_time DESC LIMIT 500000', idx=0}\norg.apache.doris.common.UserException: errCode = 2, detailMessage = tablet 10031 has no queryable replicas. err: replica 10032's backend 10008 does not exist or not alive\n        at org.apache.doris.planner.OlapScanNode.addScanRangeLocations(OlapScanNode.java:931) ~[doris-fe.jar:1.2-SNAPSHOT]\n        at org.apache.doris.planner.OlapScanNode.computeTabletInfo(OlapScanNode.java:1197) ~[doris-fe.jar:1.2-SNAPSHOT]\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. Create Table"})}),"\n",(0,r.jsx)(n.p,{children:"The table structure includes fields for log generation time, collection time, hostname, log file path, log type, log level, thread name, code position, and log message."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE `doris_log` (\n  `log_time` datetime NULL COMMENT \'log content time\',\n  `collect_time` datetime NULL COMMENT \'log agent collect time\',\n  `host` text NULL COMMENT \'hostname or ip\',\n  `path` text NULL COMMENT \'log file path\',\n  `type` text NULL COMMENT \'log type\',\n  `level` text NULL COMMENT \'log level\',\n  `thread` text NULL COMMENT \'log thread\',\n  `position` text NULL COMMENT \'log code position\',\n  `message` text NULL COMMENT \'log message\',\n  INDEX idx_host (`host`) USING INVERTED COMMENT \'\',\n  INDEX idx_path (`path`) USING INVERTED COMMENT \'\',\n  INDEX idx_type (`type`) USING INVERTED COMMENT \'\',\n  INDEX idx_level (`level`) USING INVERTED COMMENT \'\',\n  INDEX idx_thread (`thread`) USING INVERTED COMMENT \'\',\n  INDEX idx_position (`position`) USING INVERTED COMMENT \'\',\n  INDEX idx_message (`message`) USING INVERTED PROPERTIES("parser" = "unicode", "support_phrase" = "true") COMMENT \'\'\n) ENGINE=OLAP\nDUPLICATE KEY(`log_time`)\nCOMMENT \'OLAP\'\nPARTITION BY RANGE(`log_time`) ()\nDISTRIBUTED BY RANDOM BUCKETS 10\nPROPERTIES (\n"replication_num" = "1",\n"dynamic_partition.enable" = "true",\n"dynamic_partition.time_unit" = "DAY",\n"dynamic_partition.start" = "-7",\n"dynamic_partition.end" = "1",\n"dynamic_partition.prefix" = "p",\n"dynamic_partition.buckets" = "10",\n"dynamic_partition.create_history_partition" = "true",\n"compaction_policy" = "time_series"\n);\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Vector Configuration"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'# ==================== Sources ====================\n[sources.fe_log_input]\n  type = "file"\n  include = ["/path/fe/log/fe.log"]\n  start_at_beginning = true\n  max_line_bytes = 102400\n  ignore_older_secs = 0\n  fingerprint.strategy = "device_and_inode"\n  \n  # Multi-line log handling - corresponds to Logstash\'s multiline codec\n  # Lines starting with a timestamp are new logs, other lines are merged with the previous line (handling stack traces)\n  multiline.start_pattern = "^\\\\d{4}-\\\\d{2}-\\\\d{2} \\\\d{2}:\\\\d{2}:\\\\d{2},\\\\d{3}"\n  multiline.mode = "halt_before"\n  multiline.condition_pattern = "^\\\\d{4}-\\\\d{2}-\\\\d{2} \\\\d{2}:\\\\d{2}:\\\\d{2},\\\\d{3}"\n  multiline.timeout_ms = 10000\n\n# ==================== Transforms ====================\n# Use grok to parse log content\n[transforms.parse_log]\n  inputs = ["fe_log_input"]\n  type = "remap"\n  source = \'\'\'\n    # Add type field (corresponds to Logstash\'s add_field)\n    .type = "fe.log"\n    \n    # Add collect_time (corresponds to Logstash\'s @timestamp)\n    # Use Asia/Shanghai timezone, consistent with log_time\n    .collect_time = format_timestamp!(.timestamp, format: "%Y-%m-%d %H:%M:%S", timezone: "Asia/Shanghai")\n    \n    # Parse log format: 2024-01-01 12:00:00,123 INFO (thread-name) [position] message\n    # Use (?s) to enable DOTALL mode, allowing .* to match newlines (handling multi-line logs)\n    parsed, err = parse_regex(.message, r\'(?s)^(?P<log_time>\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2},\\d{3}) (?P<level>[A-Z]+) \\((?P<thread>[^\\)]+)\\) \\[(?P<position>[^\\]]+)\\] (?P<content>.*)\')\n    \n    # Extract parsed fields\n    if err == null {\n      .log_time = parsed.log_time\n      .level = parsed.level\n      .thread = parsed.thread\n      .position = parsed.position\n      # Keep the complete original message (including multi-line stack traces)\n    } else {\n      # If parsing fails, set default values to avoid NULL (avoid partition errors)\n      .log_time = .collect_time\n      .level = "UNKNOWN"\n      .thread = ""\n      .position = ""\n    }\n    \n    # Extract host and path (Vector automatically adds these metadata)\n    .host = .host\n    .path = .file\n  \'\'\'\n\n# ==================== Sinks ====================\n[sinks.doris]\n  inputs = ["parse_log"]\n  type = "doris"\n  endpoints = ["http://fe_ip:http_port"]\n  database = "log_db"\n  table = "doris_log"\n  label_prefix = "vector_fe_log"\n  log_request = true\n\n[sinks.doris.auth]\n  user = "root"\n  password = ""\n  strategy = "basic"\n\n[sinks.doris.encoding]\n  codec = "json"\n\n[sinks.doris.framing]\n  method = "newline_delimited"\n\n[sinks.doris.request]\n  concurrency = 10\n\n[sinks.doris.headers]\n  format = "json"\n  read_json_by_line = "true"\n  load_to_single_tablet = "true"\n\n[sinks.doris.batch]\n  max_events = 10000\n  timeout_secs = 3\n  max_bytes = 100000000\n\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"4. Run Vector"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\n${VECTOR_HOME}/bin/vector --config vector_fe_log.toml\n\n# When log_request is true, the log will output the request parameters and response results of each Stream Load\n2025-11-19T10:14:40.822071Z  INFO sink{component_kind="sink" component_id=doris component_type=doris}:request{request_id=82}: vector::sinks::doris::service: Doris stream load response received. status_code=200 OK stream_load_status=Successful response={\n  "TxnId": 169721,\n  "Label": "vector_fe_log_log_db_doris_log_1763547280791_e2e619ee-4067-4fe8-974e-9f35f0d4e48e",\n  "Comment": "",\n  "TwoPhaseCommit": "false",\n  "Status": "Success",\n  "Message": "OK",\n  "NumberTotalRows": 10,\n  "NumberLoadedRows": 10,\n  "NumberFilteredRows": 0,\n  "NumberUnselectedRows": 0,\n  "LoadBytes": 7301,\n  "LoadTimeMs": 30,\n  "BeginTxnTimeMs": 0,\n  "StreamLoadPutTimeMs": 1,\n  "ReadDataTimeMs": 0,\n  "WriteDataTimeMs": 8,\n  "ReceiveDataTimeMs": 2,\n  "CommitAndPublishTimeMs": 18\n} internal_log_rate_limit=true\n'})}),"\n",(0,r.jsx)(n.h3,{id:"json-log-collection-example",children:"JSON Log Collection Example"}),"\n",(0,r.jsx)(n.p,{children:"This example demonstrates JSON log collection using GitHub events archive data."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Data"})}),"\n",(0,r.jsxs)(n.p,{children:["GitHub events archive contains archived data of GitHub user operation events in JSON format. You can download it from ",(0,r.jsx)(n.a,{href:"https://www.gharchive.org/",children:"https://www.gharchive.org/"}),", for example, downloading data from 15:00 on January 1, 2024."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"wget https://data.gharchive.org/2024-01-01-15.json.gz\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Below is a sample data entry. The actual data is one entry per line; formatting is added here for display purposes."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{\n  "id": "37066529221",\n  "type": "PushEvent",\n  "actor": {\n    "id": 46139131,\n    "login": "Bard89",\n    "display_login": "Bard89",\n    "gravatar_id": "",\n    "url": "https://api.github.com/users/Bard89",\n    "avatar_url": "https://avatars.githubusercontent.com/u/46139131?"\n  },\n  "repo": {\n    "id": 780125623,\n    "name": "Bard89/talk-to-me",\n    "url": "https://api.github.com/repos/Bard89/talk-to-me"\n  },\n  "payload": {\n    "repository_id": 780125623,\n    "push_id": 17799451992,\n    "size": 1,\n    "distinct_size": 1,\n    "ref": "refs/heads/add_mvcs",\n    "head": "f03baa2de66f88f5f1754ce3fa30972667f87e81",\n    "before": "85e6544ede4ae3f132fe2f5f1ce0ce35a3169d21"\n  },\n  "public": true,\n  "created_at": "2024-04-01T23:00:00Z"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. Create Doris Table"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'CREATE DATABASE log_db;\nUSE log_db;\n\nCREATE TABLE github_events\n(\n  `created_at` DATETIME,\n  `id` BIGINT,\n  `type` TEXT,\n  `public` BOOLEAN,\n  `actor` VARIANT,\n  `repo` VARIANT,\n  `payload` TEXT,\n  INDEX `idx_id` (`id`) USING INVERTED,\n  INDEX `idx_type` (`type`) USING INVERTED,\n  INDEX `idx_actor` (`actor`) USING INVERTED,\n  INDEX `idx_host` (`repo`) USING INVERTED,\n  INDEX `idx_payload` (`payload`) USING INVERTED PROPERTIES("parser" = "unicode", "support_phrase" = "true")\n)\nENGINE = OLAP\nDUPLICATE KEY(`created_at`)\nPARTITION BY RANGE(`created_at`) ()\nDISTRIBUTED BY RANDOM BUCKETS 10\nPROPERTIES (\n"replication_num" = "1",\n"inverted_index_storage_format"= "v2",\n"compaction_policy" = "time_series",\n"enable_single_replica_compaction" = "true",\n"dynamic_partition.enable" = "true",\n"dynamic_partition.create_history_partition" = "true",\n"dynamic_partition.time_unit" = "DAY",\n"dynamic_partition.start" = "-30",\n"dynamic_partition.end" = "1",\n"dynamic_partition.prefix" = "p",\n"dynamic_partition.buckets" = "10",\n"dynamic_partition.replication_num" = "1"\n);\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Vector Configuration"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'# ==================== Sources ====================\n[sources.github_events_reload]\ntype = "file"\ninclude = ["/path/2024-01-01-15.json"]\nread_from = "beginning"\nignore_checkpoints = true\nmax_line_bytes = 10485760\nignore_older_secs = 0\nline_delimiter = "\\n"\nfingerprint.strategy = "device_and_inode"\n\n# ==================== Transforms ====================\n# Parse JSON format GitHub Events data, VARIANT type can directly store nested objects\n[transforms.parse_json]\ninputs = ["github_events_reload"]\ntype = "remap"\nsource = \'\'\'\n    # Parse JSON data (each line is a complete JSON object)\n    . = parse_json!(.message)\n    \n    # Convert payload field to JSON string (TEXT type)\n    .payload = encode_json(.payload)\n    \n    # Keep only the fields needed for the table\n    . = {\n      "created_at": .created_at,\n      "id": .id,\n      "type": .type,\n      "public": .public,\n      "actor": .actor,\n      "repo": .repo,\n      "payload": .payload\n    }\n  \'\'\'\n\n# ==================== Sinks ====================\n[sinks.doris]\ninputs = ["parse_json"]\ntype = "doris"\nendpoints = ["http://fe_ip:http_port"]\ndatabase = "log_db"\ntable = "github_events"\nlabel_prefix = "vector_github_events"\nlog_request = true\n\n[sinks.doris.auth]\nuser = "root"\npassword = ""\nstrategy = "basic"\n\n[sinks.doris.encoding]\ncodec = "json"\n\n[sinks.doris.framing]\nmethod = "newline_delimited"\n\n[sinks.doris.request]\nconcurrency = 10\n\n[sinks.doris.headers]\nformat = "json"\nread_json_by_line = "true"\nload_to_single_tablet = "true"\n\n[sinks.doris.batch]\nmax_events = 10000\ntimeout_secs = 3\nmax_bytes = 100000000\n'})}),"\n",(0,r.jsx)(n.h4,{id:"start-vector",children:"Start Vector"}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to start the Vector service:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"vector --config vector_config.toml\n"})})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return c},a:function(){return d}});var i=t(667294);let r={},s=i.createContext(r);function d(e){let n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);