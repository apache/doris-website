"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["929226"],{161581:function(e,n,i){i.r(n),i.d(n,{default:()=>m,frontMatter:()=>o,metadata:()=>r,assets:()=>l,toc:()=>c,contentTitle:()=>s});var r=JSON.parse('{"id":"ai/text-search/custom-normalizer","title":"Custom Normalizer","description":"Custom Normalizer is used for unified text preprocessing,","source":"@site/docs/ai/text-search/custom-normalizer.md","sourceDirName":"ai/text-search","slug":"/ai/text-search/custom-normalizer","permalink":"/docs/dev/ai/text-search/custom-normalizer","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Custom Normalizer","language":"en","description":"Custom Normalizer is used for unified text preprocessing,"},"sidebar":"docs","previous":{"title":"Custom Analyzer","permalink":"/docs/dev/ai/text-search/custom-analyzer"},"next":{"title":"Relevance Scoring","permalink":"/docs/dev/ai/text-search/scoring"}}'),t=i("785893"),a=i("250065");let o={title:"Custom Normalizer",language:"en",description:"Custom Normalizer is used for unified text preprocessing,"},s=void 0,l={},c=[{value:"Overview",id:"overview",level:2},{value:"Using Custom Normalizer",id:"using-custom-normalizer",level:2},{value:"Create",id:"create",level:3},{value:"View",id:"view",level:3},{value:"Drop",id:"drop",level:3},{value:"Usage in Table Creation",id:"usage-in-table-creation",level:2},{value:"Limitations",id:"limitations",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Example: Ignoring Case and Special Accents",id:"example-ignoring-case-and-special-accents",level:3}];function d(e){let n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Custom Normalizer is used for unified text preprocessing, typically in scenarios that do not require tokenization but need normalization (such as keyword search). Unlike an Analyzer, a Normalizer does not split text but processes the entire text as a single complete Token. It supports combining character filters and token filters to achieve functions like case conversion and character normalization."}),"\n",(0,t.jsx)(n.h2,{id:"using-custom-normalizer",children:"Using Custom Normalizer"}),"\n",(0,t.jsx)(n.h3,{id:"create",children:"Create"}),"\n",(0,t.jsxs)(n.p,{children:["A custom normalizer consists mainly of character filters (",(0,t.jsx)(n.code,{children:"char_filter"}),") and token filters (",(0,t.jsx)(n.code,{children:"token_filter"}),")."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Note: For detailed creation methods of ",(0,t.jsx)(n.code,{children:"char_filter"})," and ",(0,t.jsx)(n.code,{children:"token_filter"}),", please refer to the [Custom Analyzer] documentation."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE INVERTED INDEX NORMALIZER IF NOT EXISTS x_normalizer\nPROPERTIES (\n  "char_filter" = "x_char_filter",          -- Optional, one or more character filters\n  "token_filter" = "x_filter1, x_filter2"   -- Optional, one or more token filters, executed in order\n);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"view",children:"View"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SHOW INVERTED INDEX NORMALIZER;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"drop",children:"Drop"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"DROP INVERTED INDEX NORMALIZER IF EXISTS x_normalizer;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"usage-in-table-creation",children:"Usage in Table Creation"}),"\n",(0,t.jsxs)(n.p,{children:["Specify the custom normalizer using ",(0,t.jsx)(n.code,{children:"normalizer"})," in the inverted index properties."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": ",(0,t.jsx)(n.code,{children:"normalizer"})," and ",(0,t.jsx)(n.code,{children:"analyzer"})," are mutually exclusive and cannot be specified in the same index simultaneously."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE tbl (\n    `id` bigint NOT NULL,\n    `code` text NULL,\n    INDEX idx_code (`code`) USING INVERTED PROPERTIES("normalizer" = "x_custom_normalizer")\n)\n...\n'})}),"\n",(0,t.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["The names referenced in ",(0,t.jsx)(n.code,{children:"char_filter"})," and ",(0,t.jsx)(n.code,{children:"token_filter"})," must exist (either built-in or created)."]}),"\n",(0,t.jsx)(n.li,{children:"A normalizer can only be dropped if no table is using it."}),"\n",(0,t.jsxs)(n.li,{children:["A ",(0,t.jsx)(n.code,{children:"char_filter"})," or ",(0,t.jsx)(n.code,{children:"token_filter"})," can only be dropped if no normalizer is using it."]}),"\n",(0,t.jsx)(n.li,{children:"After using the custom normalizer syntax, it takes about 10 seconds to sync to the BE, after which import operations will function normally without errors."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,t.jsx)(n.h3,{id:"example-ignoring-case-and-special-accents",children:"Example: Ignoring Case and Special Accents"}),"\n",(0,t.jsxs)(n.p,{children:["This example demonstrates how to create a normalizer that converts text to lowercase and removes accents (e.g., normalizing ",(0,t.jsx)(n.code,{children:"Caf\xe9"})," to ",(0,t.jsx)(n.code,{children:"cafe"}),"), suitable for exact matching that is case-insensitive and accent-insensitive."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'-- 1. Create a custom token filter (if specific parameters are needed)\n-- Create an ascii_folding filter here\nCREATE INVERTED INDEX TOKEN_FILTER IF NOT EXISTS my_ascii_folding\nPROPERTIES\n(\n    "type" = "ascii_folding",\n    "preserve_original" = "false"\n);\n\n-- 2. Create the normalizer\n-- Combine lowercase (built-in) and my_ascii_folding\nCREATE INVERTED INDEX NORMALIZER IF NOT EXISTS lowercase_ascii_normalizer\nPROPERTIES\n(\n    "token_filter" = "lowercase, my_ascii_folding"\n);\n\n-- 3. Use in table creation\nCREATE TABLE product_table (\n    `id` bigint NOT NULL,\n    `product_name` text NULL,\n    INDEX idx_name (`product_name`) USING INVERTED PROPERTIES("normalizer" = "lowercase_ascii_normalizer")\n) ENGINE=OLAP\nDUPLICATE KEY(`id`)\nDISTRIBUTED BY RANDOM BUCKETS 1\nPROPERTIES (\n"replication_allocation" = "tag.location.default: 1"\n);\n\n-- 4. Verify and test\nselect tokenize(\'Caf\xe9-Products\', \'"normalizer"="lowercase_ascii_normalizer"\');\n'})}),"\n",(0,t.jsx)(n.p,{children:"Result:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'[\n  {"token":"cafe-products"}\n]\n'})})]})}function m(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return s},a:function(){return o}});var r=i(667294);let t={},a=r.createContext(t);function o(e){let n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);