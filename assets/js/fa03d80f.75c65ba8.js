"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["562446"],{266969:function(e,n,i){i.r(n),i.d(n,{default:()=>h,frontMatter:()=>t,metadata:()=>r,assets:()=>d,toc:()=>l,contentTitle:()=>o});var r=JSON.parse('{"id":"developer-guide/fe-eclipse-dev","title":"Setting FE Dev Env - Eclipse","description":"\x3c!--","source":"@site/community/developer-guide/fe-eclipse-dev.md","sourceDirName":"developer-guide","slug":"/developer-guide/fe-eclipse-dev","permalink":"/community/developer-guide/fe-eclipse-dev","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Setting FE Dev Env - Eclipse","language":"en"},"sidebar":"community","previous":{"title":"Pipeline Tracing","permalink":"/community/developer-guide/pipeline-tracing"},"next":{"title":"Use FE profiler to generate flame graph","permalink":"/community/developer-guide/fe-profiler"}}'),c=i("785893"),s=i("250065");let t={title:"Setting FE Dev Env - Eclipse",language:"en"},o="Setting FE dev env using Eclipse",d={},l=[{value:"Preparation",id:"preparation",level:2},{value:"Code Generation",id:"code-generation",level:3},{value:"Windows",id:"windows",level:4},{value:"MacOS",id:"macos",level:4},{value:"Import FE project",id:"import-fe-project",level:2},{value:"Import as eclipse project",id:"import-as-eclipse-project",level:3},{value:"Import as maven project",id:"import-as-maven-project",level:3},{value:"Run Unit Test",id:"run-unit-test",level:2},{value:"Run FE",id:"run-fe",level:2},{value:"Code Update",id:"code-update",level:2},{value:"Imported as eclipse project",id:"imported-as-eclipse-project",level:3},{value:"Imported as maven project",id:"imported-as-maven-project",level:3},{value:"Imports Order",id:"imports-order",level:2}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"setting-fe-dev-env-using-eclipse",children:"Setting FE dev env using Eclipse"})}),"\n",(0,c.jsx)(n.h2,{id:"preparation",children:"Preparation"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"JDK 1.8+"}),"\n",(0,c.jsx)(n.li,{children:"Maven 3.x+"}),"\n",(0,c.jsxs)(n.li,{children:["Eclipse, with ",(0,c.jsx)(n.a,{href:"http://www.eclipse.org/m2e/",children:"M2Eclipse"})," installed"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"code-generation",children:"Code Generation"}),"\n",(0,c.jsx)(n.p,{children:"The FE module requires part of the generated code, such as Thrift, Protobuf, Jflex, CUP and other frameworks."}),"\n",(0,c.jsx)(n.h4,{id:"windows",children:"Windows"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Under Linux, enter the source code directory ",(0,c.jsx)(n.code,{children:"fe"})," and execute the following command:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:" mvn  generate-sources\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["If use windows as development environment, then package the generated ",(0,c.jsx)(n.code,{children:"fe/fe-core/target/generated-sources"})," directory:"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"fe/fe-core/target/ && tar czf java.tar.gz generated-sources/"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Copy ",(0,c.jsx)(n.code,{children:"java.tar.gz"})," to the ",(0,c.jsx)(n.code,{children:"fe/fe-core/target/"})," directory of the development environment and unzip"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"cp java.tar.gz /path/to/doris/fe/fe-core/target/\ncd /path/to/doris/fe/fe-core/target/ && tar xzf java.tar.gz\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"macos",children:"MacOS"}),"\n",(0,c.jsx)(n.p,{children:"We can use maven to do code generation or in other words build FE project\ndirectly on MacOS."}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Install apache thrift from source code or ",(0,c.jsx)(n.code,{children:"brew"})," if you don't have one"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Create a directory ",(0,c.jsx)(n.code,{children:"thirdparty/installed/bin"}),", and link command thrift into\nit."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"mkdir -p thirdparty/installed/bin\nln -s ${thrift_installed_full_path} thirdparty/installed/bin/thrift\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Call ",(0,c.jsx)(n.code,{children:"maven"})," to build FE project, if something went wrong, check you\n",(0,c.jsx)(n.code,{children:"$JAVA_HOME"}),", java version and newly installed command ",(0,c.jsx)(n.code,{children:"thrift"})," work\ncorrectly."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"cd fe && mvn package -DskipTests=true -Dos.arch=x86_64\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["Option ",(0,c.jsx)(n.code,{children:"-Dos.arch=x86_64"})," in step 3 is for compatibility of Apple's M series\nCPU."]}),"\n",(0,c.jsx)(n.p,{children:"Note:\n0. cup and jfex use java jar to do code generation, the process is platform\nindependent."}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Code generation of protobuf is done by ",(0,c.jsx)(n.code,{children:"protoc-jar-maven-plugin"}),", which uses\nprecompiled binaries of different archs to make it seems platform independent."]}),"\n",(0,c.jsxs)(n.li,{children:["thrift is the only one relies on ",(0,c.jsx)(n.code,{children:"thirdparty/installed"}),", which needs to be\nbuilt from source. We will make it independent on ",(0,c.jsx)(n.code,{children:"thirdparty/installed"}),"\nsomeday (TODO)."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"import-fe-project",children:"Import FE project"}),"\n",(0,c.jsx)(n.h3,{id:"import-as-eclipse-project",children:"Import as eclipse project"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["In the ",(0,c.jsx)(n.code,{children:"fe/"})," directory of the development environment, execute the following command to generate the Eclipse project file:"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"cd /path/to/doris/fe/ && mvn -npr eclipse:eclipse -Dskip.plugin=true"})}),"\n",(0,c.jsxs)(n.p,{children:["After the execution is completed, the ",(0,c.jsx)(n.code,{children:".project"})," and ",(0,c.jsx)(n.code,{children:".classpath"})," files will be generated in the ",(0,c.jsx)(n.code,{children:"fe/"})," directory."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Import FE project"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Open Eclipse, choose ",(0,c.jsx)(n.code,{children:"File -> Import"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Choose ",(0,c.jsx)(n.code,{children:"General -> Existing Projects into Workspace"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"Select root directory"})," and choose ",(0,c.jsx)(n.code,{children:"fe/"})," directory, click ",(0,c.jsx)(n.code,{children:"Finish"})," to finish."]}),"\n",(0,c.jsxs)(n.li,{children:["Right click the project, and choose ",(0,c.jsx)(n.code,{children:"Build Path -> Configure Build Path"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["In the ",(0,c.jsx)(n.code,{children:"Java Build Path"})," dialog, choose the ",(0,c.jsx)(n.code,{children:"Source"})," tab, click ",(0,c.jsx)(n.code,{children:"Add Folder"}),", and select the ",(0,c.jsx)(n.code,{children:"java/"})," directory that was copied and unzipped before adding."]}),"\n",(0,c.jsxs)(n.li,{children:["Click ",(0,c.jsx)(n.code,{children:"Apply and Close"})," to finish."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"At this point, FE project import is complete. The project directory in Eclipse is roughly as follows:"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:i(522716).Z+"",width:"592",height:"312"})}),"\n",(0,c.jsx)(n.h3,{id:"import-as-maven-project",children:"Import as maven project"}),"\n",(0,c.jsx)(n.p,{children:"We are able to build FE with maven, if we have done all the operations related\nto MacOS. And we are now of course able to import FE project as a maven project\nin eclipse."}),"\n",(0,c.jsxs)(n.p,{children:["In eclipse menu ",(0,c.jsx)(n.code,{children:"File"})," select ",(0,c.jsx)(n.code,{children:"Import -> Maven -> Existing Maven Projects"}),",\nChoose doris fe directory to finish import. It's recommended to use working set\nto manage the all modules of FE."]}),"\n",(0,c.jsx)(n.p,{children:"Enjoy developing and debugging FE in eclipse!"}),"\n",(0,c.jsx)(n.h2,{id:"run-unit-test",children:"Run Unit Test"}),"\n",(0,c.jsxs)(n.p,{children:["Right-click on the unit test file you want to run and select ",(0,c.jsx)(n.code,{children:"Run As -> JUnit Test"}),". (If you want to debug, select ",(0,c.jsx)(n.code,{children:"Debug As -> JUnit Test"}),")."]}),"\n",(0,c.jsx)(n.p,{children:"If the following error occurs:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"java.lang.Exception: Method xxxx should have no parameters\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Then right-click the unit test file and select ",(0,c.jsx)(n.code,{children:"Run As -> Run Configurations..."}),". (If you want to debug, select ",(0,c.jsx)(n.code,{children:"Debug As -> Debug Configurations..."}),")."]}),"\n",(0,c.jsxs)(n.p,{children:["Add to the ",(0,c.jsx)(n.code,{children:"VM arguments"})," in the ",(0,c.jsx)(n.code,{children:"Arguments"})," tab:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"-javaagent:${settings.localRepository}/org/jmockit/jmockit/1.48/jmockit-1.48.jar\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Among them, ",(0,c.jsx)(n.code,{children:"${settings.localRepository}"})," should be replaced with the path of the maven library path, such as:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"-javaagent:/Users/cmy/.m2/repository/org/jmockit/jmockit/1.48/jmockit-1.48.jar\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Then just run ",(0,c.jsx)(n.code,{children:"Run/Debug"}),"."]}),"\n",(0,c.jsx)(n.h2,{id:"run-fe",children:"Run FE"}),"\n",(0,c.jsx)(n.p,{children:"You can directly start an FE process in Eclipse to facilitate debugging the code."}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Create a runtime directory"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"mkdir /path/to/doris/fe/run/\ncd /path/to/doris/fe/run/\nmkdir conf/log/doris-meta/\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Create configuration file"}),"\n",(0,c.jsxs)(n.p,{children:["Create the configuration file ",(0,c.jsx)(n.code,{children:"fe.conf"})," in the ",(0,c.jsx)(n.code,{children:"conf/"})," directory created in the first step. You can directly copy ",(0,c.jsx)(n.code,{children:"conf/fe.conf"})," in the source directory and make simple changes."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Find the ",(0,c.jsx)(n.code,{children:"src/main/java/org/apache/doris/DorisFE.java"})," file in Eclipse, right-click and select ",(0,c.jsx)(n.code,{children:"Run As -> Run Configurations..."}),". Add the following environment variables to the ",(0,c.jsx)(n.code,{children:"Environment"})," tab:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"DORIS_HOME: /path/to/doris/fe/run/"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"PID_DIR: /path/to/doris/fe/run/"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"LOG_DIR: /path/to/doris/fe/run/log"})}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Right-click ",(0,c.jsx)(n.code,{children:"DorisFE.java"})," and select ",(0,c.jsx)(n.code,{children:"Run As -> Java Application"})," to start FE."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["To run a UT, a FE service will be started at first. And then, UT cases execute as client and test corresponding logics. When errors occur, only client logs will be print in UT logs. If you need more information from ",(0,c.jsx)(n.strong,{children:"server logs"}),", you can view logs in ",(0,c.jsx)(n.code,{children:"${DORIS_HOME}/fe/mocked"}),"."]}),"\n",(0,c.jsx)(n.h2,{id:"code-update",children:"Code Update"}),"\n",(0,c.jsx)(n.h3,{id:"imported-as-eclipse-project",children:"Imported as eclipse project"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Update lexical and grammar files or proto and thrift files"}),"\n",(0,c.jsxs)(n.p,{children:["If you modified ",(0,c.jsx)(n.code,{children:"fe/src/main/cup/sql_parser.cup"})," or ",(0,c.jsx)(n.code,{children:"fe/src/main/jflex/sql_scanner.flex"})," file or proto and thrift files. You need to execute the following commands in the ",(0,c.jsx)(n.code,{children:"fe/"})," directory:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"mvn  generate-sources\n"})}),"\n",(0,c.jsx)(n.p,{children:"Then refresh the project in Eclipse."}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Update maven dependencies"}),"\n",(0,c.jsxs)(n.p,{children:["If you update the dependency in ",(0,c.jsx)(n.code,{children:"fe/pom.xml"}),", you need to execute the following command in the ",(0,c.jsx)(n.code,{children:"fe/"})," directory:"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"mvn -npr eclipse:eclipse -Dskip.plugin=true"})}),"\n",(0,c.jsx)(n.p,{children:"Then refresh the project in Eclipse. If it cannot be updated, it is recommended to delete the project and import it again according to this document."}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"imported-as-maven-project",children:"Imported as maven project"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Update lexical and grammar files or proto and thrift files"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"cd fe && mvn package -DskipTests=true -Dos.arch=x86_64\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Update maven dependencies, in eclipse ",(0,c.jsx)(n.code,{children:"Package Explorer"})," right click on the\nproject ",(0,c.jsx)(n.code,{children:"maven -> update project..."})]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Refresh project in eclipse"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"imports-order",children:"Imports Order"}),"\n",(0,c.jsx)(n.p,{children:"In order to maintain the Imports order of Java, please perform the following operations to set the Imports Order of the project."}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Create the file ",(0,c.jsx)(n.code,{children:"fe_doris.importorder"})," and write the following:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"#Organize Import Order\n#Wed Jul 01 16:42:47 CST 2020\n4=javax\n3=java\n2=org\n1=com\n0=org.apache.doris\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Open Eclipse Preferences, select ",(0,c.jsx)(n.code,{children:"Java -> Code Style -> Organize Imports"}),". Click ",(0,c.jsx)(n.code,{children:"Import"})," to import the above file."]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},522716:function(e,n,i){i.d(n,{Z:function(){return r}});let r=i.p+"assets/images/eclipse-import-fe-project-1-a9785cc1c02e93aa7a088bf272fed3f4.png"},250065:function(e,n,i){i.d(n,{Z:function(){return o},a:function(){return t}});var r=i(667294);let c={},s=r.createContext(c);function t(e){let n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);