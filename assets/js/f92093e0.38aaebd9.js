"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["1870"],{737190:function(e,n,i){i.r(n),i.d(n,{default:()=>h,frontMatter:()=>l,metadata:()=>r,assets:()=>d,toc:()=>c,contentTitle:()=>a});var r=JSON.parse('{"id":"developer-guide/debug-tool","title":"Debugging Tools","description":"A comprehensive guide to debugging tools and methods for Apache Doris, including FE and BE debugging techniques, memory profiling with Jemalloc and TCMalloc, memory leak detection with LSAN and ASAN, and CPU profiling with pprof and perf.","source":"@site/community/developer-guide/debug-tool.md","sourceDirName":"developer-guide","slug":"/developer-guide/debug-tool","permalink":"/community/developer-guide/debug-tool","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Debugging Tools","language":"en","description":"A comprehensive guide to debugging tools and methods for Apache Doris, including FE and BE debugging techniques, memory profiling with Jemalloc and TCMalloc, memory leak detection with LSAN and ASAN, and CPU profiling with pprof and perf."},"sidebar":"community","previous":{"title":"Spark Load","permalink":"/community/design/spark_load"},"next":{"title":"Doris Docker quick build development environment","permalink":"/community/developer-guide/docker-dev"}}'),s=i("785893"),o=i("250065");let l={title:"Debugging Tools",language:"en",description:"A comprehensive guide to debugging tools and methods for Apache Doris, including FE and BE debugging techniques, memory profiling with Jemalloc and TCMalloc, memory leak detection with LSAN and ASAN, and CPU profiling with pprof and perf."},a="Debugging Tools",d={},c=[{value:"FE Debugging",id:"fe-debugging",level:2},{value:"1. Memory Usage Statistics",id:"1-memory-usage-statistics",level:3},{value:"2. JVM Memory Usage",id:"2-jvm-memory-usage",level:3},{value:"3. Print FE Thread Stack",id:"3-print-fe-thread-stack",level:3},{value:"BE Debugging",id:"be-debugging",level:2},{value:"Memory Debugging",id:"memory-debugging",level:3},{value:"Doris Debug Tools",id:"doris-debug-tools",level:4},{value:"Jemalloc Heap Profile",id:"jemalloc-heap-profile",level:4},{value:"1. Real-time Heap Dump (for analyzing real-time memory)",id:"1-real-time-heap-dump-for-analyzing-real-time-memory",level:5},{value:"2. Periodic Heap Dump (for long-term memory observation)",id:"2-periodic-heap-dump-for-long-term-memory-observation",level:5},{value:"3. Parse Heap Profile with <code>jeprof</code>",id:"3-parse-heap-profile-with-jeprof",level:5},{value:"4. Common Issues (QA)",id:"4-common-issues-qa",level:5},{value:"TCMalloc Heap Profile",id:"tcmalloc-heap-profile",level:4},{value:"pprof Remote Server",id:"pprof-remote-server",level:5},{value:"LSAN (Memory Leak Detection)",id:"lsan-memory-leak-detection",level:4},{value:"ASAN (Address Legality Detection)",id:"asan-address-legality-detection",level:4},{value:"CPU Debugging",id:"cpu-debugging",level:3},{value:"Doris Debug Tools",id:"doris-debug-tools-1",level:4},{value:"pprof",id:"pprof",level:4},{value:"perf + FlameGraph",id:"perf--flamegraph",level:4}];function t(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"debugging-tools",children:"Debugging Tools"})}),"\n",(0,s.jsx)(n.p,{children:"During Doris usage and development, debugging is often necessary. This document introduces commonly used debugging tools and methods."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["Note: The BE binary file name ",(0,s.jsx)(n.code,{children:"doris_be"})," mentioned in this document was ",(0,s.jsx)(n.code,{children:"palo_be"})," in earlier versions."]})}),"\n",(0,s.jsx)(n.h2,{id:"fe-debugging",children:"FE Debugging"}),"\n",(0,s.jsx)(n.p,{children:"FE is a Java process. Below are some commonly used Java debugging commands."}),"\n",(0,s.jsx)(n.h3,{id:"1-memory-usage-statistics",children:"1. Memory Usage Statistics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"jmap -histo:live pid > 1.jmp\n"})}),"\n",(0,s.jsx)(n.p,{children:"This command lists the memory usage of live objects sorted by size (replace pid with the FE process ID)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:" num     #instances         #bytes  class name\n----------------------------------------------\n   1:         33528       10822024  [B\n   2:         80106        8662200  [C\n   3:           143        4688112  [Ljava.util.concurrent.ForkJoinTask;\n   4:         80563        1933512  java.lang.String\n   5:         15295        1714968  java.lang.Class\n   6:         45546        1457472  java.util.concurrent.ConcurrentHashMap$Node\n   7:         15483        1057416  [Ljava.lang.Object;\n"})}),"\n",(0,s.jsx)(n.p,{children:"This method allows you to view the total memory occupied by live objects (at the end of the file) and analyze which objects consume more memory."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," This method triggers a FullGC due to the ",(0,s.jsx)(n.code,{children:":live"})," parameter."]}),"\n",(0,s.jsx)(n.h3,{id:"2-jvm-memory-usage",children:"2. JVM Memory Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"jstat -gcutil pid 1000 1000\n"})}),"\n",(0,s.jsx)(n.p,{children:"This command checks JVM memory usage in each region every second (replace pid with the FE process ID)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT\n  0.00   0.00  22.61   3.03  95.74  92.77     68    1.249     5    0.794    2.043\n  0.00   0.00  22.61   3.03  95.74  92.77     68    1.249     5    0.794    2.043\n  0.00   0.00  22.61   3.03  95.74  92.77     68    1.249     5    0.794    2.043\n  0.00   0.00  22.92   3.03  95.74  92.77     68    1.249     5    0.794    2.043\n  0.00   0.00  22.92   3.03  95.74  92.77     68    1.249     5    0.794    2.043\n"})}),"\n",(0,s.jsx)(n.p,{children:"Focus on the Old generation (O) percentage (3.03% in the example). High usage may lead to OOM or FullGC."}),"\n",(0,s.jsx)(n.h3,{id:"3-print-fe-thread-stack",children:"3. Print FE Thread Stack"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"jstack -l pid > 1.js\n"})}),"\n",(0,s.jsx)(n.p,{children:"This command prints the current FE thread stack (replace pid with the FE process ID)."}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"-l"})," parameter also detects deadlocks. This method can be used to view FE thread execution status, detect deadlocks, and locate blocking positions."]}),"\n",(0,s.jsx)(n.h2,{id:"be-debugging",children:"BE Debugging"}),"\n",(0,s.jsx)(n.h3,{id:"memory-debugging",children:"Memory Debugging"}),"\n",(0,s.jsx)(n.p,{children:"Memory debugging focuses on two aspects:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Memory usage reasonability"}),": Excessive memory usage may indicate memory leaks or improper memory usage."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Memory access legality"}),": Detecting memory overflows, illegal access, accessing invalid addresses, or using uninitialized memory."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The following tools can be used for tracking and analysis."}),"\n",(0,s.jsx)(n.h4,{id:"doris-debug-tools",children:"Doris Debug Tools"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/morningman/doris-debug-tools",children:"Doris Debug Tools"})," provides packaged CPU flame graph and memory analysis tools that can be downloaded and used directly."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/morningman/doris-debug-tools/releases",children:"Releases"})}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Note: Unofficial tool, for development and debugging purposes only."}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"jemalloc-heap-profile",children:"Jemalloc Heap Profile"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Doris 1.2.2 and later versions use Jemalloc as the default memory allocator."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["For Heap Profiling principles, refer to ",(0,s.jsx)(n.a,{href:"https://cn.pingcap.com/blog/an-explanation-of-the-heap-profiling-principle/",children:"Heap Profiling Principle Explanation"}),". Note that Heap Profile records virtual memory."]}),"\n",(0,s.jsxs)(n.p,{children:["Jemalloc supports both real-time and periodic Heap Dump methods, then uses the ",(0,s.jsx)(n.code,{children:"jeprof"})," tool to parse the generated Heap Profile."]}),"\n",(0,s.jsx)(n.h5,{id:"1-real-time-heap-dump-for-analyzing-real-time-memory",children:"1. Real-time Heap Dump (for analyzing real-time memory)"}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"be.conf"}),", change ",(0,s.jsx)(n.code,{children:"prof:false"})," to ",(0,s.jsx)(n.code,{children:"prof:true"})," and ",(0,s.jsx)(n.code,{children:"prof_active:false"})," to ",(0,s.jsx)(n.code,{children:"prof_active:true"})," in ",(0,s.jsx)(n.code,{children:"JEMALLOC_CONF"}),", then restart Doris BE. Use the Jemalloc Heap Dump HTTP interface to generate Heap Profile files on the BE machine."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Version Notes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Doris 2.1.8, 3.0.4 and later: ",(0,s.jsx)(n.code,{children:"prof"})," is already ",(0,s.jsx)(n.code,{children:"true"})," by default in ",(0,s.jsx)(n.code,{children:"JEMALLOC_CONF"}),", no modification needed."]}),"\n",(0,s.jsxs)(n.li,{children:["Before Doris 2.1.8 and 3.0.4: ",(0,s.jsx)(n.code,{children:"JEMALLOC_CONF"})," doesn't have ",(0,s.jsx)(n.code,{children:"prof_active"})," option, just change ",(0,s.jsx)(n.code,{children:"prof:false"})," to ",(0,s.jsx)(n.code,{children:"prof:true"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl http://be_host:be_webport/jeheap/dump\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Heap Profile directory"}),": Configure via ",(0,s.jsx)(n.code,{children:"jeprofile_dir"})," in ",(0,s.jsx)(n.code,{children:"be.conf"}),", defaults to ",(0,s.jsx)(n.code,{children:"${DORIS_HOME}/log"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sampling interval"}),": Defaults to 512KB, typically recording ~10% of memory with <10% performance impact. Modify ",(0,s.jsx)(n.code,{children:"lg_prof_sample"})," in ",(0,s.jsx)(n.code,{children:"JEMALLOC_CONF"})," (default ",(0,s.jsx)(n.code,{children:"19"}),", i.e., 2^19 B = 512KB). Decreasing ",(0,s.jsx)(n.code,{children:"lg_prof_sample"})," increases sampling frequency for more accurate profiles but higher overhead."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Performance tip:"})," Keep ",(0,s.jsx)(n.code,{children:"prof:false"})," during performance testing to avoid Heap Dump overhead."]}),"\n",(0,s.jsx)(n.h5,{id:"2-periodic-heap-dump-for-long-term-memory-observation",children:"2. Periodic Heap Dump (for long-term memory observation)"}),"\n",(0,s.jsxs)(n.p,{children:["Change ",(0,s.jsx)(n.code,{children:"prof:false"})," to ",(0,s.jsx)(n.code,{children:"prof:true"})," in ",(0,s.jsx)(n.code,{children:"JEMALLOC_CONF"})," in ",(0,s.jsx)(n.code,{children:"be.conf"}),". Heap Profile files default to ",(0,s.jsx)(n.code,{children:"${DORIS_HOME}/log"})," with prefix specified by ",(0,s.jsx)(n.code,{children:"JEMALLOC_PROF_PRFIX"})," (default ",(0,s.jsx)(n.code,{children:"jemalloc_heap_profile_"}),")."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Before Doris 2.1.6, ",(0,s.jsx)(n.code,{children:"JEMALLOC_PROF_PRFIX"})," was empty and needs to be set."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Dump triggers:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Dump after cumulative memory allocation"})}),"\n",(0,s.jsxs)(n.p,{children:["Change ",(0,s.jsx)(n.code,{children:"lg_prof_interval"})," to ",(0,s.jsx)(n.code,{children:"34"})," in ",(0,s.jsx)(n.code,{children:"JEMALLOC_CONF"})," to dump after cumulative 16GB allocation (2^34 B = 16GB)."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Before Doris 2.1.6, ",(0,s.jsx)(n.code,{children:"lg_prof_interval"})," defaulted to ",(0,s.jsx)(n.code,{children:"32"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Dump on memory peak"})}),"\n",(0,s.jsxs)(n.p,{children:["Change ",(0,s.jsx)(n.code,{children:"prof_gdump"})," to ",(0,s.jsx)(n.code,{children:"true"})," in ",(0,s.jsx)(n.code,{children:"JEMALLOC_CONF"})," and restart BE."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Dump on exit and detect leaks"})}),"\n",(0,s.jsxs)(n.p,{children:["Change ",(0,s.jsx)(n.code,{children:"prof_leak"})," and ",(0,s.jsx)(n.code,{children:"prof_final"})," to ",(0,s.jsx)(n.code,{children:"true"})," in ",(0,s.jsx)(n.code,{children:"JEMALLOC_CONF"})," and restart BE."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Dump cumulative (growth) instead of real-time values"})}),"\n",(0,s.jsxs)(n.p,{children:["Change ",(0,s.jsx)(n.code,{children:"prof_accum"})," to ",(0,s.jsx)(n.code,{children:"true"})," in ",(0,s.jsx)(n.code,{children:"JEMALLOC_CONF"})," and restart BE. Use ",(0,s.jsx)(n.code,{children:"jeprof --alloc_space"})," to display cumulative heap dump."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h5,{id:"3-parse-heap-profile-with-jeprof",children:["3. Parse Heap Profile with ",(0,s.jsx)(n.code,{children:"jeprof"})]}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"be/bin/jeprof"})," to parse dumped Heap Profiles. Parsing may take minutes for large memory processes."]}),"\n",(0,s.jsxs)(n.p,{children:["If ",(0,s.jsx)(n.code,{children:"jeprof"})," binary is missing from ",(0,s.jsx)(n.code,{children:"be/bin"}),", upload ",(0,s.jsx)(n.code,{children:"jeprof"})," from ",(0,s.jsx)(n.code,{children:"doris/tools"})," directory."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Requires addr2line version 2.35.2+, see QA-1 below."}),"\n",(0,s.jsxs)(n.li,{children:["Execute Heap Dump and ",(0,s.jsx)(n.code,{children:"jeprof"})," parsing on the same machine running Doris BE, see QA-2 below."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. Analyze single Heap Profile"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"jeprof --dot ${DORIS_HOME}/lib/doris_be ${DORIS_HOME}/log/profile_file\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Paste terminal output to ",(0,s.jsx)(n.a,{href:"http://www.webgraphviz.com/",children:"online dot visualization"})," to generate memory allocation diagram."]}),"\n",(0,s.jsx)(n.p,{children:"To generate PDF directly (requires dependencies):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"yum install ghostscript graphviz\njeprof --pdf ${DORIS_HOME}/lib/doris_be ${DORIS_HOME}/log/profile_file > result.pdf\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Analyze diff between two Heap Profiles"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"jeprof --dot ${DORIS_HOME}/lib/doris_be --base=${DORIS_HOME}/log/profile_file ${DORIS_HOME}/log/profile_file2\n"})}),"\n",(0,s.jsx)(n.p,{children:"Compare heap files from different times to analyze diff by using earlier file as baseline."}),"\n",(0,s.jsx)(n.h5,{id:"4-common-issues-qa",children:"4. Common Issues (QA)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["QA-1: Errors after running jeprof: ",(0,s.jsx)(n.code,{children:"addr2line: Dwarf Error: found dwarf version xxx, this reader only handles version xxx"})]})}),"\n",(0,s.jsx)(n.p,{children:"GCC 11+ defaults to DWARF-v5, requiring Binutils 2.35.2+. Doris Ldb_toolchain uses GCC 11."}),"\n",(0,s.jsx)(n.p,{children:"Solution: Upgrade addr2line to 2.35.2."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Download addr2line source\nwget https://ftp.gnu.org/gnu/binutils/binutils-2.35.tar.bz2\n\n# Install dependencies if needed\nyum install make gcc gcc-c++ binutils\n\n# Compile & install addr2line\ntar -xvf binutils-2.35.tar.bz2\ncd binutils-2.35\n./configure --prefix=/usr/local\nmake\nmake install\n\n# Verify\naddr2line -h\n\n# Replace addr2line\nchmod +x addr2line\nmv /usr/bin/addr2line /usr/bin/addr2line.bak\nmv /bin/addr2line /bin/addr2line.bak\ncp addr2line /bin/addr2line\ncp addr2line /usr/bin/addr2line\nhash -r\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Don't use addr2line 2.3.9, which may be incompatible and cause memory growth."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["QA-2: Errors after running ",(0,s.jsx)(n.code,{children:"jeprof"}),": ",(0,s.jsx)(n.code,{children:"addr2line: DWARF error: invalid or unhandled FORM value: 0x25"}),", parsed heap stacks show memory addresses instead of function names"]})}),"\n",(0,s.jsxs)(n.p,{children:["Usually occurs when Heap Dump and ",(0,s.jsx)(n.code,{children:"jeprof"})," parsing are on different servers, causing symbol table resolution failure."]}),"\n",(0,s.jsx)(n.p,{children:"Solution:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Execute Dump Heap and ",(0,s.jsx)(n.code,{children:"jeprof"})," parsing on the same machine running Doris BE."]}),"\n",(0,s.jsxs)(n.li,{children:["Or download ",(0,s.jsx)(n.code,{children:"be/bin/doris_be"})," binary and Heap Profile to a machine with matching Linux kernel version and run ",(0,s.jsx)(n.code,{children:"jeprof"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"QA-3: If heap stacks still show memory addresses instead of function names after parsing on the BE machine"})}),"\n",(0,s.jsx)(n.p,{children:"Use this script for manual parsing. Modify these variables:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"heap"}),": Heap Profile filename."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"bin"}),": ",(0,s.jsx)(n.code,{children:"be/bin/doris_be"})," binary filename."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"llvm_symbolizer"}),": Path to llvm symbolizer, preferably the version used to compile the binary."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n## @brief\n## @author zhoufei\n## @email  gavineaglechou@gmail.com\n## @date   2024-02-24-Sat\n\n# 1. jeprof --dot ${bin} ${heap} > heap.dot to generate calling profile\n# 2. find base addr and symbol\n# 3. get addr to symble table with llvm-symbolizer\n# 4. replace the addr with symbol\n\n# heap file name\nheap=jeheap_dump.1708694081.3443.945778264.heap\n# binary name\nbin=doris_be_aws.3.0.5\n# path to llvm symbolizer\nllvm_symbolizer=$HOME/opt/ldb-toolchain-16/bin/llvm-symbolizer\n# output file name\nout=out.dot\nvaddr_baddr_symbol=vaddr_baddr_symbol.txt\nprogram_name=doris_be\n\njeprof --dot ${bin} ${heap} > ${out}\n\nbaseaddr=$(grep ${program_name} ${heap} | head -n 1 | awk -F\'-\' \'{print $1}\')\necho "$baseaddr: ${baseaddr}"\n\nfunction find_symbol() {\n  local addr="$1"\n  "${llvm_symbolizer}" --inlining --obj=${bin} ${addr} | head -n 1 | awk -F\'(\' \'{print $1}\'\n}\n\nif [ -f ${vaddr_baddr_symbol} ]; then\n  cat ${vaddr_baddr_symbol} | while read vaddr baddr; do\n    symbol=$(find_symbol ${baddr})\n    echo "${vaddr} ${baddr} ${symbol}"\n    sed -ri.orig "s/${vaddr}/${symbol}/g" ${out}\n  done\nelse # recalculate the addr and\n  grep -oP \'0x(\\d|[a-f])+\' ${out} | xargs -I {} python -c "print(\'{}\', \'0x{:x}\'.format({} - 0x${baseaddr}))" \\\n    | while read vaddr baddr; do\n    symbol=$(find_symbol ${baddr})\n    echo "${vaddr} ${baddr} ${symbol}"\n    sed -ri.orig "s/${vaddr}/${symbol}/g" ${out}\n  done | tee ${vaddr_baddr_symbol}\nfi\n\n# vim: et tw=80 ts=2 sw=2 cc=80:\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"QA-4: If none of the above methods work"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Try recompiling ",(0,s.jsx)(n.code,{children:"be/bin/doris_be"})," on the BE machine to compile, run, and parse on the same machine."]}),"\n",(0,s.jsxs)(n.li,{children:["If heap stacks still show addresses, try compiling with TCMalloc using ",(0,s.jsx)(n.code,{children:"USE_JEMALLOC=OFF ./build.sh --be"}),", then use TCMalloc Heap Profile as described below."]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"tcmalloc-heap-profile",children:"TCMalloc Heap Profile"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Doris 1.2.1 and earlier use TCMalloc. Doris 1.2.2+ default to Jemalloc. To switch back to TCMalloc, compile with ",(0,s.jsx)(n.code,{children:"USE_JEMALLOC=OFF sh build.sh --be"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["When using TCMalloc, large memory allocations print stacks to ",(0,s.jsx)(n.code,{children:"be.out"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"tcmalloc: large alloc 1396277248 bytes == 0x3f3488000 @  0x2af6f63 0x2c4095b 0x134d278 0x134bdcb 0x133d105 0x133d1d0 0x19930ed\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This indicates Doris BE attempted to allocate ",(0,s.jsx)(n.code,{children:"1396277248 bytes"})," at this stack. Use ",(0,s.jsx)(n.code,{children:"addr2line"})," to convert to readable information:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"addr2line -e lib/doris_be 0x2af6f63 0x2c4095b 0x134d278 0x134bdcb 0x133d105 0x133d1d0 0x19930ed\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"/home/ssd0/zc/palo/doris/core/thirdparty/src/gperftools-gperftools-2.7/src/tcmalloc.cc:1335\n/home/ssd0/zc/palo/doris/core/thirdparty/src/gperftools-gperftools-2.7/src/tcmalloc.cc:1357\n/home/disk0/baidu-doris/baidu/bdg/doris-baidu/core/be/src/exec/hash_table.cpp:267\n/home/disk0/baidu-doris/baidu/bdg/doris-baidu/core/be/src/exec/hash_table.hpp:86\n/home/disk0/baidu-doris/baidu/bdg/doris-baidu/core/be/src/exec/hash_join_node.cpp:239\n/home/disk0/baidu-doris/baidu/bdg/doris-baidu/core/be/src/exec/hash_join_node.cpp:213\nthread.cpp:?\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Sometimes memory issues come from accumulating small allocations, not visible in logs. Use TCMalloc's ",(0,s.jsx)(n.a,{href:"https://gperftools.github.io/gperftools/heapprofile.html",children:"HEAP PROFILE"})," feature. Set ",(0,s.jsx)(n.code,{children:"HEAPPROFILE"})," environment variable before starting Doris BE:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"export TCMALLOC_SAMPLE_PARAMETER=64000 HEAP_PROFILE_ALLOCATION_INTERVAL=-1 HEAP_PROFILE_INUSE_INTERVAL=-1 HEAP_PROFILE_TIME_INTERVAL=5 HEAPPROFILE=/tmp/doris_be.hprof\n./bin/start_be.sh --daemon\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," HEAPPROFILE requires absolute path, and directory must exist."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["When HEAPPROFILE dump conditions are met, memory usage writes to specified file. Use ",(0,s.jsx)(n.code,{children:"pprof"})," tool to analyze output."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pprof --text lib/doris_be /tmp/doris_be.hprof.0012.heap | head -30\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"Using local file lib/doris_be.\nUsing local file /tmp/doris_be.hprof.0012.heap.\nTotal: 668.6 MB\n   610.6  91.3%  91.3%    610.6  91.3% doris::SystemAllocator::allocate_via_malloc (inline)\n    18.1   2.7%  94.0%     18.1   2.7% _objalloc_alloc\n     5.6   0.8%  94.9%     63.4   9.5% doris::RowBatch::RowBatch\n     5.1   0.8%  95.6%      7.1   1.1% butil::ResourcePool::add_block (inline)\n     3.7   0.5%  96.2%      3.7   0.5% butil::iobuf::create_block (inline)\n     3.4   0.5%  96.7%      3.4   0.5% butil::FlatMap::init\n     3.2   0.5%  97.2%      5.2   0.8% butil::ObjectPool::add_block (inline)\n     2.6   0.4%  97.6%      2.6   0.4% __gnu_cxx::new_allocator::allocate (inline)\n     2.0   0.3%  97.9%      2.0   0.3% butil::ObjectPool::add_block_group (inline)\n     2.0   0.3%  98.2%      2.0   0.3% butil::ResourcePool::add_block_group (inline)\n     1.7   0.3%  98.4%      1.7   0.3% doris::SegmentReader::_load_index\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Column meanings:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Column 1"}),": Memory directly allocated by function (MB)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Column 2"}),": Percentage of column 1."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Column 3"}),": Cumulative value of column 2."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Column 4"}),": Total memory occupied by function and all called functions (MB)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Column 5"}),": Percentage of column 4."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Generate call relationship graph in SVG format:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pprof --svg lib/doris_be /tmp/doris_be.hprof.0012.heap > heap.svg\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Performance tip:"})," This option affects performance. Use cautiously on production instances."]}),"\n",(0,s.jsx)(n.h5,{id:"pprof-remote-server",children:"pprof Remote Server"}),"\n",(0,s.jsx)(n.p,{children:"HEAP PROFILE has limitations: 1. Requires BE restart; 2. Continuous enabling impacts performance."}),"\n",(0,s.jsxs)(n.p,{children:["Doris BE supports dynamic heap profiling. Doris supports GPerftools ",(0,s.jsx)(n.a,{href:"https://gperftools.github.io/gperftools/pprof_remote_servers.html",children:"remote server debugging"}),". Use ",(0,s.jsx)(n.code,{children:"pprof"})," to dynamically profile remote running Doris BE. Example for viewing memory usage increment:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pprof --text --seconds=60 http://be_host:be_webport/pprof/heap\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"Total: 1296.4 MB\n   484.9  37.4%  37.4%    484.9  37.4% doris::StorageByteBuffer::create\n   272.2  21.0%  58.4%    273.3  21.1% doris::RowBlock::init\n   157.5  12.1%  70.5%    157.5  12.1% doris::RowBatch::RowBatch\n    90.7   7.0%  77.5%     90.7   7.0% doris::SystemAllocator::allocate_via_malloc\n    66.6   5.1%  82.7%     66.6   5.1% doris::IntegerColumnReader::init\n    47.9   3.7%  86.4%     47.9   3.7% __gnu_cxx::new_allocator::allocate\n    20.8   1.6%  88.0%     35.4   2.7% doris::SegmentReader::_load_index\n    12.7   1.0%  89.0%     12.7   1.0% doris::DecimalColumnReader::init\n    12.7   1.0%  89.9%     12.7   1.0% doris::LargeIntColumnReader::init\n    12.7   1.0%  90.9%     12.7   1.0% doris::StringColumnDirectReader::init\n    12.3   0.9%  91.9%     12.3   0.9% std::__cxx11::basic_string::_M_mutate\n    10.4   0.8%  92.7%     10.4   0.8% doris::VectorizedRowBatch::VectorizedRowBatch\n    10.0   0.8%  93.4%     10.0   0.8% doris::PlainTextLineReader::PlainTextLineReader\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output and viewing method match HEAP PROFILE. This command only enables statistics during execution, causing less performance impact than HEAP PROFILE."}),"\n",(0,s.jsx)(n.h4,{id:"lsan-memory-leak-detection",children:"LSAN (Memory Leak Detection)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/google/sanitizers/wiki/AddressSanitizerLeakSanitizer",children:"LSAN"})," is an address checking tool integrated in GCC. Enable during compilation to activate this feature. When determinable memory leaks occur, leak stacks are printed. Doris BE has integrated this tool. Compile with:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"BUILD_TYPE=LSAN ./build.sh\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When memory leaks are detected, corresponding information outputs to ",(0,s.jsx)(n.code,{children:"be.out"}),". For demonstration, we intentionally inject a memory leak in the ",(0,s.jsx)(n.code,{children:"StorageEngine"})," ",(0,s.jsx)(n.code,{children:"open"})," function:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:'char* leak_buf = new char[1024];\nstrcpy(leak_buf, "hello world");\nLOG(INFO) << leak_buf;\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Then ",(0,s.jsx)(n.code,{children:"be.out"})," shows:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"=================================================================\n==24732==ERROR: LeakSanitizer: detected memory leaks\n\nDirect leak of 1024 byte(s) in 1 object(s) allocated from:\n    #0 0xd10586 in operator new (unsigned long) ../../../../gcc-7.3.0/libsanitizer/lsan/lsan_interceptors.cc:164\n    #1 0xe333a2 in doris::StorageEngine::open(doris::EngineOptions const&, doris::StorageEngine**) /home/ssd0/zc/palo/doris/core/be/src/olap/storage_engine.cpp:104\n    #2 0xd3cc96 in main /home/ssd0/zc/palo/doris/core/be/src/service/doris_main.cpp:159\n    #3 0x7f573b5eebd4 in __libc_start_main (/opt/compiler/gcc-4.8.2/lib64/libc.so.6+0x21bd4)\n\nSUMMARY: LeakSanitizer: 1024 byte(s) leaked in 1 allocation(s).\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output shows 1024 bytes leaked with memory allocation stack trace."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Performance tip:"})," This option affects performance. Use cautiously on production instances."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Enabling LSAN automatically disables TCMalloc."]}),"\n",(0,s.jsx)(n.h4,{id:"asan-address-legality-detection",children:"ASAN (Address Legality Detection)"}),"\n",(0,s.jsxs)(n.p,{children:["Besides improper memory usage and leaks, illegal address access errors can occur. Use ",(0,s.jsx)(n.a,{href:"https://github.com/google/sanitizers/wiki/AddressSanitizer",children:"ASAN"})," to find root causes. Like LSAN, ASAN is integrated in GCC. Compile Doris with:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"BUILD_TYPE=ASAN ./build.sh\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When abnormal access is detected, the binary exits immediately and outputs illegal access stack to ",(0,s.jsx)(n.code,{children:"be.out"}),". ASAN output analysis uses the same method as LSAN. For demonstration, inject an address access error in the ",(0,s.jsx)(n.code,{children:"StorageEngine"})," ",(0,s.jsx)(n.code,{children:"open"})," function:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"char* invalid_buf = new char[1024];\nfor (int i = 0; i < 1025; ++i) {\n    invalid_buf[i] = i;\n}\nLOG(INFO) << invalid_buf;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Then ",(0,s.jsx)(n.code,{children:"be.out"})," shows:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"=================================================================\n==23284==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61900008bf80 at pc 0x00000129f56a bp 0x7fff546eed90 sp 0x7fff546eed88\nWRITE of size 1 at 0x61900008bf80 thread T0\n    #0 0x129f569 in doris::StorageEngine::open(doris::EngineOptions const&, doris::StorageEngine**) /home/ssd0/zc/palo/doris/core/be/src/olap/storage_engine.cpp:106\n    #1 0xe2c1e3 in main /home/ssd0/zc/palo/doris/core/be/src/service/doris_main.cpp:159\n    #2 0x7fa5580fbbd4 in __libc_start_main (/opt/compiler/gcc-4.8.2/lib64/libc.so.6+0x21bd4)\n    #3 0xd30794  (/home/ssd0/zc/palo/doris/core/output3/be/lib/doris_be+0xd30794)\n\n0x61900008bf80 is located 0 bytes to the right of 1024-byte region [0x61900008bb80,0x61900008bf80)\nallocated by thread T0 here:\n    #0 0xdeb040 in operator new[](unsigned long) ../../../../gcc-7.3.0/libsanitizer/asan/asan_new_delete.cc:82\n    #1 0x129f50d in doris::StorageEngine::open(doris::EngineOptions const&, doris::StorageEngine**) /home/ssd0/zc/palo/doris/core/be/src/olap/storage_engine.cpp:104\n    #2 0xe2c1e3 in main /home/ssd0/zc/palo/doris/core/be/src/service/doris_main.cpp:159\n    #3 0x7fa5580fbbd4 in __libc_start_main (/opt/compiler/gcc-4.8.2/lib64/libc.so.6+0x21bd4)\n\nSUMMARY: AddressSanitizer: heap-buffer-overflow /home/ssd0/zc/palo/doris/core/be/src/olap/storage_engine.cpp:106 in doris::StorageEngine::open(doris::EngineOptions const&, doris::StorageEngine**)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This shows an attempted one-byte write to illegal address ",(0,s.jsx)(n.code,{children:"0x61900008bf80"}),", and the allocation stack for region ",(0,s.jsx)(n.code,{children:"[0x61900008bb80,0x61900008bf80)"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Performance tip:"})," This option affects performance. Use cautiously on production instances."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Enabling ASAN automatically disables TCMalloc."]}),"\n",(0,s.jsxs)(n.p,{children:["If ",(0,s.jsx)(n.code,{children:"be.out"})," stack output lacks function symbols, manual processing is needed. Use the ",(0,s.jsx)(n.a,{href:"https://llvm.org/svn/llvm-project/compiler-rt/trunk/lib/asan/scripts/asan_symbolize.py",children:"asan_symbolize"})," script to parse ASAN output:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cat be.out | python asan_symbolize.py | c++filt\n"})}),"\n",(0,s.jsx)(n.p,{children:"This command produces readable stack information."}),"\n",(0,s.jsx)(n.h3,{id:"cpu-debugging",children:"CPU Debugging"}),"\n",(0,s.jsx)(n.p,{children:"When system CPU Idle is low, CPU is the main bottleneck. Analyze current CPU usage. For Doris BE, there are serveral methods to analyze CPU bottlenecks."}),"\n",(0,s.jsx)(n.h4,{id:"doris-debug-tools-1",children:"Doris Debug Tools"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/morningman/doris-debug-tools",children:"Doris Debug Tools"})," provides packaged CPU flame graph and memory analysis tools that can be downloaded and used directly."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/morningman/doris-debug-tools/releases",children:"Releases"})}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Note: Unofficial tool, for development and debugging purposes only."}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"pprof",children:"pprof"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/google/pprof",children:"pprof"})," from gperftools converts gperftools output to readable formats like PDF, SVG, Text."]}),"\n",(0,s.jsxs)(n.p,{children:["Since Doris has integrated and is compatible with GPerf REST interface, use ",(0,s.jsx)(n.code,{children:"pprof"})," tool to analyze remote Doris BE:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pprof --svg --seconds=60 http://be_host:be_webport/pprof/profile > be.svg\n"})}),"\n",(0,s.jsx)(n.p,{children:"This command generates a BE CPU consumption graph."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"CPU Pprof",src:i(531259).Z+"",width:"1196",height:"1488"})}),"\n",(0,s.jsx)(n.h4,{id:"perf--flamegraph",children:"perf + FlameGraph"}),"\n",(0,s.jsxs)(n.p,{children:["This is a very general CPU analysis method. Unlike ",(0,s.jsx)(n.code,{children:"pprof"}),", this method requires login to the physical machine. But compared to pprof's timed sampling, perf can collect stack information through different events."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Tool introduction:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://perf.wiki.kernel.org/index.php/Main_Page",children:"perf"}),": Linux kernel built-in performance analysis tool. ",(0,s.jsx)(n.a,{href:"http://www.brendangregg.com/perf.html",children:"Here"})," are some perf usage examples."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/brendangregg/FlameGraph",children:"FlameGraph"}),": Visualization tool to display perf output as flame graphs."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"perf record -g -p be_pid -- sleep 60\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This command profiles BE CPU usage for 60 seconds and generates ",(0,s.jsx)(n.code,{children:"perf.data"})," file. Analyze ",(0,s.jsx)(n.code,{children:"perf.data"})," with perf command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"perf report\n"})}),"\n",(0,s.jsx)(n.p,{children:"Analysis example:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Perf Report",src:i(764997).Z+"",width:"1102",height:"412"})}),"\n",(0,s.jsx)(n.p,{children:"Or visualize with FlameGraph:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"perf script | ./FlameGraph/stackcollapse-perf.pl | ./FlameGraph/flamegraph.pl > be.svg\n"})}),"\n",(0,s.jsx)(n.p,{children:"This also generates a CPU consumption graph."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"CPU Flame",src:i(416658).Z+"",width:"1200",height:"418"})})]})}function h(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},416658:function(e,n,i){i.d(n,{Z:function(){return r}});let r=i.p+"assets/images/cpu-flame-demo-727a5b8c32db9b3b129481ac75405b5d.svg"},531259:function(e,n,i){i.d(n,{Z:function(){return r}});let r=i.p+"assets/images/cpu-pprof-demo-46064afc3672559af190f0698ed9ef52.png"},764997:function(e,n,i){i.d(n,{Z:function(){return r}});let r=i.p+"assets/images/perf-report-demo-5987234ce899968a08be49a29f51acb1.png"},250065:function(e,n,i){i.d(n,{Z:function(){return a},a:function(){return l}});var r=i(667294);let s={},o=r.createContext(s);function l(e){let n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);