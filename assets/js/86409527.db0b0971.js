"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["292938"],{493675:function(e,n,i){i.r(n),i.d(n,{default:()=>u,frontMatter:()=>s,metadata:()=>l,assets:()=>a,toc:()=>d,contentTitle:()=>r});var l=JSON.parse('{"id":"admin-manual/plugin-development-manual","title":"Developing Plugins","description":"Introduction","source":"@site/docs/admin-manual/plugin-development-manual.md","sourceDirName":"admin-manual","slug":"/admin-manual/plugin-development-manual","permalink":"/docs/dev/admin-manual/plugin-development-manual","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Developing Plugins","language":"en"}}'),t=i("785893"),o=i("250065");let s={title:"Developing Plugins",language:"en"},r="Doris Plugin Framework",a={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Plugin",id:"plugin",level:2},{value:"Write A Plugin",id:"write-a-plugin",level:2},{value:"Create module",id:"create-module",level:3},{value:"Add zip.xml",id:"add-zipxml",level:3},{value:"Update pom.xml",id:"update-pomxml",level:3},{value:"Implement plugin",id:"implement-plugin",level:3},{value:"Compile",id:"compile",level:3},{value:"Other way",id:"other-way",level:3},{value:"Deploy",id:"deploy",level:2},{value:"Install and Uninstall",id:"install-and-uninstall",level:2}];function c(e){let n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"doris-plugin-framework",children:"Doris Plugin Framework"})}),"\n",(0,t.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsx)(n.p,{children:"Doris plugin framework supports install/uninstall custom plugins at runtime without restart the Doris service. Users can extend Doris's functionality by developing their own plugins."}),"\n",(0,t.jsx)(n.p,{children:"For example, the audit plugin worked after a request execution, it can obtain information related to a request (access user, request IP, SQL, etc...) and write the information into the specified table."}),"\n",(0,t.jsx)(n.p,{children:"Differences from UDF:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"UDF is a function used for data calculation when SQL is executed. Plugin is additional function that is used to extend Doris with customized function, such as support different storage engines and different import ways, and plugin doesn't participate in data calculation when executing SQL."}),"\n",(0,t.jsx)(n.li,{children:"The execution cycle of UDF is limited to a SQL execution. The execution cycle of plugin may be the same as the Doris process."}),"\n",(0,t.jsx)(n.li,{children:"The usage scene is different. If you need to support special data algorithms when executing SQL, then UDF is recommended, if you need to run custom functions on Doris, or start a background thread to do tasks, then the use of plugin is recommended."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Currently the plugin framework only supports audit plugins."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Note:\nDoris plugin framework is an experimental feature, currently only supports FE plugin, and is closed by default, can be opened by FE configuration ",(0,t.jsx)(n.code,{children:"plugin_enable = true"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"plugin",children:"Plugin"}),"\n",(0,t.jsxs)(n.p,{children:["A FE Plugin can be a ",(0,t.jsx)(n.strong,{children:".zip package"})," or a ",(0,t.jsx)(n.strong,{children:"directory"}),", which contains at least two parts: the ",(0,t.jsx)(n.code,{children:"plugin.properties"})," and ",(0,t.jsx)(n.code,{children:".jar"})," files. The ",(0,t.jsx)(n.code,{children:"plugin.properties"})," file is used to describe the plugin information."]}),"\n",(0,t.jsx)(n.p,{children:"The file structure of a Plugin looks like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# plugin .zip\nauditodemo.zip:\n    -plugin.properties\n    -auditdemo.jar\n    -xxx.config\n    -data/\n    -test_data/\n\n# plugin local directory\nauditodemo/:\n    -plugin.properties\n    -auditdemo.jar\n    -xxx.config\n    -data/\n    -test_data/\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"plugin.properties"})," example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'### required:\n#\n# the plugin name\nname = audit_plugin_demo\n#\n# the plugin type\ntype = AUDIT\n#\n# simple summary of the plugin\ndescription = just for test\n#\n# Doris\'s version, like: 0.11.0\nversion = 0.11.0\n\n### FE-Plugin optional:\n#\n# version of java the code is built against\n# use the command "java -version" value, like 1.8.0, 9.0.1, 13.0.4\njava.version = 1.8.31\n#\n# the name of the class to load, fully-qualified.\nclassname = AuditPluginDemo\n\n### BE-Plugin optional:\n# the name of the so to load\nsoName = example.so\n'})}),"\n",(0,t.jsx)(n.h2,{id:"write-a-plugin",children:"Write A Plugin"}),"\n",(0,t.jsx)(n.p,{children:"The development environment of the FE plugin depends on the development environment of Doris. So please make sure Doris's compilation and development environment works normally."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"fe_plugins"})," is the parent module of the fe plugins. It can uniformly manage the third-party library information that the plugin depends on. Adding a plugin can add a submodule implementation under ",(0,t.jsx)(n.code,{children:"fe_plugins"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"create-module",children:"Create module"}),"\n",(0,t.jsxs)(n.p,{children:["We can add a submodule in the ",(0,t.jsx)(n.code,{children:"fe_plugins"})," directory to implement Plugin and create a project:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mvn archetype: generate -DarchetypeCatalog = internal -DgroupId = org.apache -DartifactId = doris-fe-test -DinteractiveMode = false\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The command produces a new mvn project, and a new submodule is automatically added to ",(0,t.jsx)(n.code,{children:"fe_plugins/pom.xml"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\xa0\xa0\xa0\xa0.....\n\xa0\xa0\xa0\xa0<groupId>org.apache</groupId>\n\xa0\xa0\xa0\xa0<artifactId>doris-fe-plugins</artifactId>\n\xa0\xa0\xa0\xa0<packaging>pom</packaging>\n\xa0\xa0\xa0\xa0<version>1.0-SNAPSHOT</version>\n\xa0\xa0\xa0\xa0<modules>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<module>auditdemo</module>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0# new plugin module\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<module>doris-fe-test</module>\n\xa0\xa0\xa0\xa0</modules>\n\xa0\xa0\xa0\xa0.....\n"})}),"\n",(0,t.jsx)(n.p,{children:"The new plugin project file structure is as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"-doris-fe-test/\n-pom.xml\n-src/\n    ---- main/java/org/apache/\n    ------- App.java # mvn auto generate, ignore\n    ---- test/java/org/apache\n"})}),"\n",(0,t.jsxs)(n.p,{children:["We will add an assembly folder under main to store ",(0,t.jsx)(n.code,{children:"plugin.properties"})," and ",(0,t.jsx)(n.code,{children:"zip.xml"}),". After completion, the file structure is as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"-doris-fe-test/\n-pom.xml\n-src/\n---- main/\n------ assembly/\n-------- plugin.properties\n-------- zip.xml\n------ java/org/apache/\n--------App.java # mvn auto generate, ignore\n---- test/java/org/apache\n"})}),"\n",(0,t.jsx)(n.h3,{id:"add-zipxml",children:"Add zip.xml"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"zip.xml"}),", used to describe the content of the final package of the plugin (.jar file, plugin.properties):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"<assembly>\n\xa0\xa0\xa0\xa0<id>plugin</id>\n\xa0\xa0\xa0\xa0<formats>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<format>zip</format>\n\xa0\xa0\xa0\xa0</formats>\n\xa0\xa0\xa0\xa0<!-IMPORTANT: must be false->\n\xa0\xa0\xa0\xa0<includeBaseDirectory>false</includeBaseDirectory>\n\xa0\xa0\xa0\xa0<fileSets>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<fileSet>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<directory>target</directory>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<includes>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<include>*.jar</include>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</ ncludes>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<outputDirectory>/</outputDirectory>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</fileSet>\n\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<fileSet>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<directory>src/main/assembly</directory>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<includes>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<include>plugin.properties</include>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</includes>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0<outputDirectory>/</outputDirectory>\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</fileSet>\n\xa0\xa0\xa0\xa0</fileSets>\n</assembly>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"update-pomxml",children:"Update pom.xml"}),"\n",(0,t.jsxs)(n.p,{children:["Then we need to update ",(0,t.jsx)(n.code,{children:"pom.xml"}),", add doris-fe dependency, and modify maven packaging way:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xmlns="http://maven.apache.org/POM/4.0.0"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <parent>\n        <groupId>org.apache</groupId>\n        <artifactId>doris-fe-plugins</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </parent>\n    <modelVersion>4.0.0</modelVersion>\n\n    <artifactId>auditloader</artifactId>\n    <packaging>jar</packaging>\n\n    <dependencies>\n        \x3c!-- doris-fe dependencies --\x3e\n        <dependency>\n            <groupId>org.apache</groupId>\n            <artifactId>doris-fe</artifactId>\n        </dependency>\n\n        \x3c!-- other dependencies --\x3e\n        <dependency>\n            ...\n        </dependency>\n    </dependencies>\n\n\n    <build>\n        <finalName>auditloader</finalName>\n        <plugins>\n            <plugin>\n                <artifactId>maven-assembly-plugin</artifactId>\n                <version>2.4.1</version>\n                <configuration>\n                    <appendAssemblyId>false</appendAssemblyId>\n                    <descriptors>\n                        <descriptor>src/main/assembly/zip.xml</descriptor>\n                    </descriptors>\n                </configuration>\n                <executions>\n                    <execution>\n                        <id>make-assembly</id>\n                        <phase>package</phase>\n                        <goals>\n                            <goal>single</goal>\n                        </goals>\n                    </execution>\n                </executions>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n'})}),"\n",(0,t.jsx)(n.h3,{id:"implement-plugin",children:"Implement plugin"}),"\n",(0,t.jsxs)(n.p,{children:["Then we can implement Plugin according to the needs. Plugins need to implement the ",(0,t.jsx)(n.code,{children:"Plugin"})," interface. For details, please refer to the ",(0,t.jsx)(n.code,{children:"auditdemo"})," plugin sample code that comes with Doris."]}),"\n",(0,t.jsx)(n.h3,{id:"compile",children:"Compile"}),"\n",(0,t.jsxs)(n.p,{children:["Before compiling the plugin, you must first execute ",(0,t.jsx)(n.code,{children:"sh build.sh --fe"})," of Doris to complete the compilation of Doris FE."]}),"\n",(0,t.jsxs)(n.p,{children:["Finally, execute ",(0,t.jsx)(n.code,{children:"sh build_plugin.sh"})," in the ${DORIS_HOME} path and you will find the ",(0,t.jsx)(n.code,{children:"your_plugin_name.zip"})," file in ",(0,t.jsx)(n.code,{children:"fe_plugins/output"})]}),"\n",(0,t.jsxs)(n.p,{children:["Or you can execute ",(0,t.jsx)(n.code,{children:"sh build_plugin.sh --plugin your_plugin_name"})," to only build your plugin."]}),"\n",(0,t.jsx)(n.h3,{id:"other-way",children:"Other way"}),"\n",(0,t.jsxs)(n.p,{children:["The easiest way, you can implement your plugin by modifying the example ",(0,t.jsx)(n.code,{children:"auditdemo"})]}),"\n",(0,t.jsx)(n.h2,{id:"deploy",children:"Deploy"}),"\n",(0,t.jsx)(n.p,{children:"Doris's plugin can be deployed in three ways:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Http or Https .zip, like ",(0,t.jsx)(n.code,{children:"http://xxx.xxxxxx.com/data/plugin.zip"}),", Doris will download this .zip file. At the same time, the value of md5sum needs to be set in properties, or an md5 file with the same name as the ",(0,t.jsx)(n.code,{children:".zip"})," file needs to be placed, such as ",(0,t.jsx)(n.code,{children:"http://xxx.xxxxxx.com/data/my_plugin.zip.md5"}),". The content is the MD5 value of the .zip file."]}),"\n",(0,t.jsxs)(n.li,{children:["Local .zip, like ",(0,t.jsx)(n.code,{children:"/home/work/data/plugin.zip"}),". If the plug-in is only used for FE, it needs to be deployed in the same directory of all FE nodes. Otherwise, it needs to be deployed on all FE and BE nodes."]}),"\n",(0,t.jsxs)(n.li,{children:["Local directory, like ",(0,t.jsx)(n.code,{children:"/home/work/data/plugin"}),", .zip decompressed folder. If the plug-in is only used for FE, it needs to be deployed in the same directory of all FE nodes. Otherwise, it needs to be deployed on all FE and BE nodes."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Note: Need to ensure that the plugin .zip file is available in the life cycle of doris!"}),"\n",(0,t.jsx)(n.h2,{id:"install-and-uninstall",children:"Install and Uninstall"}),"\n",(0,t.jsxs)(n.p,{children:["Install and uninstall the plugin through the install/uninstall statements. More details, see ",(0,t.jsx)(n.code,{children:"HELP INSTALL PLUGIN;"})," ",(0,t.jsx)(n.code,{children:"HELP UNINSTALL PLUGIN;"})," ",(0,t.jsx)(n.code,{children:"HELP SHOW PLUGINS;"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'mysql> install plugin from "/home/users/doris/auditloader.zip";\nQuery OK, 0 rows affected (0.09 sec)\n\nmysql> show plugins\\G\n*************************** 1. row ***************************\n       Name: auditloader\n       Type: AUDIT\nDescription: load audit log to olap load, and user can view the statistic of queries\n    Version: 0.12.0\nJavaVersion: 1.8.31\n  ClassName: AuditLoaderPlugin\n     SoName: NULL\n    Sources: /home/users/doris/auditloader.zip\n     Status: INSTALLED\n Properties: {}\n*************************** 2. row ***************************\n       Name: AuditLogBuilder\n       Type: AUDIT\nDescription: builtin audit logger\n    Version: 0.12.0\nJavaVersion: 1.8.31\n  ClassName: org.apache.doris.qe.AuditLogBuilder\n     SoName: NULL\n    Sources: Builtin\n     Status: INSTALLED\n Properties: {}   \n2 rows in set (0.00 sec)\n\nmysql> uninstall plugin auditloader;\nQuery OK, 0 rows affected (0.05 sec)\n\nmysql> show plugins;\nEmpty set (0.00 sec)\n'})})]})}function u(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return r},a:function(){return s}});var l=i(667294);let t={},o=l.createContext(t);function s(e){let n=l.useContext(o);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);