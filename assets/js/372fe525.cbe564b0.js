"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["678726"],{781612:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>l,metadata:()=>i,assets:()=>a,toc:()=>c,contentTitle:()=>r});var i=JSON.parse('{"id":"sql-manual/sql-functions/window-functions/WINDOW-FUNCTION-WINDOW-FUNNEL","title":"WINDOW_FUNCTION_WINDOW_FUNNEL","description":"WINDOW FUNCTION WINDOW_FUNNEL","source":"@site/versioned_docs/version-2.0/sql-manual/sql-functions/window-functions/WINDOW-FUNCTION-WINDOW-FUNNEL.md","sourceDirName":"sql-manual/sql-functions/window-functions","slug":"/sql-manual/sql-functions/window-functions/WINDOW-FUNCTION-WINDOW-FUNNEL","permalink":"/docs/2.0/sql-manual/sql-functions/window-functions/WINDOW-FUNCTION-WINDOW-FUNNEL","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"WINDOW_FUNCTION_WINDOW_FUNNEL","language":"en"},"sidebar":"docs","previous":{"title":"WINDOW_FUNCTION_NTILE","permalink":"/docs/2.0/sql-manual/sql-functions/window-functions/WINDOW-FUNCTION-NTILE"},"next":{"title":"IPV4_NUM_TO_STRING","permalink":"/docs/2.0/sql-manual/sql-functions/ip-functions/ipv4-num-to-string"}}'),s=t("785893"),o=t("250065");let l={title:"WINDOW_FUNCTION_WINDOW_FUNNEL",language:"en"},r=void 0,a={},c=[{value:"WINDOW FUNCTION WINDOW_FUNNEL",id:"window-function-window_funnel",level:2},{value:"description",id:"description",level:3},{value:"example",id:"example",level:3},{value:"keywords",id:"keywords",level:3}];function d(e){let n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"window-function-window_funnel",children:"WINDOW FUNCTION WINDOW_FUNNEL"}),"\n",(0,s.jsx)(n.h3,{id:"description",children:"description"}),"\n",(0,s.jsx)(n.p,{children:"Searches the longest event chain happened in order (event1, event2, ... , eventN) along the timestamp_column with length of window."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"window is the length of time window in seconds."}),"\n",(0,s.jsxs)(n.li,{children:["mode can be one of the followings:\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'"default": Defualt mode.'}),"\n",(0,s.jsx)(n.li,{children:"\"deduplication\": If the same event holds for the sequence of events, then such repeating event interrupts further processing. E.g. the array parameter is [event1='A', event2='B', event3='C', event4='D'], and the original event chain is \"A-B-C-B-D\". Since event B repeats, the filtered event chain can only be \"A-B-C\" and the max event level is 3."}),"\n",(0,s.jsx)(n.li,{children:"\"fixed\": Don't allow interventions of other events. E.g. the array parameter is [event1='A', event2='B', event3='C', event4='D'], and the original event chain is A->B->D->C, it stops finding A->B->C at the D and the max event level is 2."}),"\n",(0,s.jsx)(n.li,{children:'"increase": Apply conditions only to events with strictly increasing timestamps.'}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"timestamp_column specifies column of DATETIME type, sliding time window works on it."}),"\n",(0,s.jsx)(n.li,{children:"evnetN is boolean expression like eventID = 1004."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The function works according to the algorithm:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The function searches for data that triggers the first condition in the chain and sets the event counter to 1. This is the moment when the sliding window starts."}),"\n",(0,s.jsx)(n.li,{children:"If events from the chain occur sequentially within the window, the counter is incremented. If the sequence of events is disrupted, the counter is not incremented."}),"\n",(0,s.jsx)(n.li,{children:"If the data has multiple event chains at varying points of completion, the function will only output the size of the longest chain."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"window_funnel(window, mode, timestamp_column, event1, event2, ... , eventN)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"example",children:"example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE windowfunnel_test (\n                `xwho` varchar(50) NULL COMMENT 'xwho',\n                `xwhen` datetime COMMENT 'xwhen',\n                `xwhat` int NULL COMMENT 'xwhat'\n                )\nDUPLICATE KEY(xwho)\nDISTRIBUTED BY HASH(xwho) BUCKETS 3\nPROPERTIES (\n    \"replication_num\" = \"1\"\n);\n\nINSERT into windowfunnel_test (xwho, xwhen, xwhat) values ('1', '2022-03-12 10:41:00', 1),\n                                                   ('1', '2022-03-12 13:28:02', 2),\n                                                   ('1', '2022-03-12 16:15:01', 3),\n                                                   ('1', '2022-03-12 19:05:04', 4);\n\nselect window_funnel(3600 * 3, 'default', t.xwhen, t.xwhat = 1, t.xwhat = 2 ) AS level from windowfunnel_test t;\n\n| level |\n|---|\n| 2 |\n"})}),"\n",(0,s.jsx)(n.h3,{id:"keywords",children:"keywords"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"WINDOW,FUNCTION,WINDOW_FUNNEL\n"})})]})}function h(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return r},a:function(){return l}});var i=t(667294);let s={},o=i.createContext(s);function l(e){let n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);