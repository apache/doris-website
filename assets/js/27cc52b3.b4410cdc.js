"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["279245"],{136104:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>o,metadata:()=>i,assets:()=>c,toc:()=>l,contentTitle:()=>t});var i=JSON.parse('{"id":"admin-manual/auth/authentication/ldap","title":"LDAP","description":"Detailed guide on Apache Doris federated authentication: unified identity verification and group authorization through LDAP integration, covering configuration steps, login methods, permission mapping rules, and common troubleshooting.","source":"@site/versioned_docs/version-3.x/admin-manual/auth/authentication/ldap.md","sourceDirName":"admin-manual/auth/authentication","slug":"/admin-manual/auth/authentication/ldap","permalink":"/docs/3.x/admin-manual/auth/authentication/ldap","draft":false,"unlisted":false,"tags":[],"version":"3.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"LDAP","language":"en","description":"Detailed guide on Apache Doris federated authentication: unified identity verification and group authorization through LDAP integration, covering configuration steps, login methods, permission mapping rules, and common troubleshooting."},"sidebar":"docs","previous":{"title":"Built-in Authentication","permalink":"/docs/3.x/admin-manual/auth/authentication/internal"},"next":{"title":"Built-in Authorization","permalink":"/docs/3.x/admin-manual/auth/authorization/internal"}}'),r=s("785893"),d=s("250065");let o={title:"LDAP",language:"en",description:"Detailed guide on Apache Doris federated authentication: unified identity verification and group authorization through LDAP integration, covering configuration steps, login methods, permission mapping rules, and common troubleshooting."},t=void 0,c={},l=[{value:"LDAP Basic Concepts",id:"ldap-basic-concepts",level:2},{value:"Terminology",id:"terminology",level:3},{value:"Quick Start",id:"quick-start",level:2},{value:"Step 1: Configure Doris",id:"step-1-configure-doris",level:3},{value:"Step 2: Client Connection",id:"step-2-client-connection",level:3},{value:"Authentication",id:"authentication",level:2},{value:"Login Behavior Overview",id:"login-behavior-overview",level:3},{value:"Login Examples",id:"login-examples",level:3},{value:"Group Authorization",id:"group-authorization",level:2},{value:"Permission Merging Rules",id:"permission-merging-rules",level:3},{value:"Group Name Mapping Rules",id:"group-name-mapping-rules",level:3},{value:"Group Authorization Example",id:"group-authorization-example",level:3},{value:"Cache Management",id:"cache-management",level:2},{value:"Known Limitations",id:"known-limitations",level:2},{value:"FAQ",id:"faq",level:2}];function a(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Doris supports integration with third-party LDAP services, providing two core functionalities:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authentication"}),": Use LDAP passwords instead of Doris passwords for identity verification."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Group Authorization"}),": Map LDAP ",(0,r.jsx)(n.code,{children:"groups"})," to Doris ",(0,r.jsx)(n.code,{children:"roles"})," for unified permission management."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"ldap-basic-concepts",children:"LDAP Basic Concepts"}),"\n",(0,r.jsx)(n.p,{children:"In LDAP, data is organized in a tree structure. Here's an example of a typical LDAP directory tree:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"- dc=example,dc=com\n - ou = ou1\n   - cn = group1\n   - cn = user1\n - ou = ou2\n   - cn = group2\n     - cn = user2\n - cn = user3\n"})}),"\n",(0,r.jsx)(n.h3,{id:"terminology",children:"Terminology"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Term"}),(0,r.jsx)(n.th,{children:"Full Name"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"dc"})}),(0,r.jsx)(n.td,{children:"Domain Component"}),(0,r.jsx)(n.td,{children:"Organization's domain name, serving as the root node of the tree"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"dn"})}),(0,r.jsx)(n.td,{children:"Distinguished Name"}),(0,r.jsxs)(n.td,{children:["Unique name. For example, user1's ",(0,r.jsx)(n.code,{children:"dn"})," is ",(0,r.jsx)(n.code,{children:"cn=user1,ou=ou1,dc=example,dc=com"}),", user2's ",(0,r.jsx)(n.code,{children:"dn"})," is ",(0,r.jsx)(n.code,{children:"cn=user2,cn=group2,ou=ou2,dc=example,dc=com"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"rdn"})}),(0,r.jsx)(n.td,{children:"Relative Distinguished Name"}),(0,r.jsxs)(n.td,{children:["Part of the ",(0,r.jsx)(n.code,{children:"dn"}),". user1's four ",(0,r.jsx)(n.code,{children:"rdns"})," are ",(0,r.jsx)(n.code,{children:"cn=user1"}),", ",(0,r.jsx)(n.code,{children:"ou=ou1"}),", ",(0,r.jsx)(n.code,{children:"dc=example"}),", and ",(0,r.jsx)(n.code,{children:"dc=com"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ou"})}),(0,r.jsx)(n.td,{children:"Organization Unit"}),(0,r.jsxs)(n.td,{children:["Sub-organization. ",(0,r.jsx)(n.code,{children:"users"})," can be placed in ",(0,r.jsx)(n.code,{children:"ou"})," or directly under the example.com domain"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"cn"})}),(0,r.jsx)(n.td,{children:"Common Name"}),(0,r.jsx)(n.td,{children:"Name"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"group"})}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"Group, corresponding to Doris roles"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"user"})}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"User, equivalent to Doris users"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"objectClass"})}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsxs)(n.td,{children:["Data type. Used to distinguish whether a node is a ",(0,r.jsx)(n.code,{children:"group"})," or ",(0,r.jsx)(n.code,{children:"user"}),". ",(0,r.jsx)(n.code,{children:"group"})," requires ",(0,r.jsx)(n.code,{children:"cn"})," and ",(0,r.jsx)(n.code,{children:"member"})," (list of ",(0,r.jsx)(n.code,{children:"users"}),") attributes, ",(0,r.jsx)(n.code,{children:"user"})," requires ",(0,r.jsx)(n.code,{children:"cn"}),", ",(0,r.jsx)(n.code,{children:"password"}),", ",(0,r.jsx)(n.code,{children:"uid"}),", etc."]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-configure-doris",children:"Step 1: Configure Doris"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Set the authentication method in ",(0,r.jsx)(n.code,{children:"fe/conf/fe.conf"}),": ",(0,r.jsx)(n.code,{children:"authentication_type=ldap"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Configure LDAP service connection information in ",(0,r.jsx)(n.code,{children:"fe/conf/ldap.conf"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ldap_authentication_enabled = true\nldap_host = ladp-host\nldap_port = 389\nldap_admin_name = uid=admin,o=emr\nldap_user_basedn = ou=people,o=emr\nldap_user_filter = (&(uid={login}))\nldap_group_basedn = ou=group,o=emr\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["After starting ",(0,r.jsx)(n.code,{children:"fe"}),", log in to Doris with ",(0,r.jsx)(n.code,{children:"root"})," or ",(0,r.jsx)(n.code,{children:"admin"})," account and set the LDAP admin password:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"set ldap_admin_password = password('<ldap_admin_password>');\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"step-2-client-connection",children:"Step 2: Client Connection"}),"\n",(0,r.jsx)(n.p,{children:"LDAP authentication requires clients to send passwords in plaintext, so cleartext authentication plugins must be enabled."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"MySQL Client"})}),"\n",(0,r.jsx)(n.p,{children:"You can enable the cleartext authentication plugin using either method:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Method 1"}),": Set environment variable (permanent)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'echo "export LIBMYSQL_ENABLE_CLEARTEXT_PLUGIN=1" >> ~/.bash_profile && source ~/.bash_profile\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Method 2"}),": Add parameter when logging in (one-time)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"mysql -hDORIS_HOST -PDORIS_PORT -u user -p --enable-cleartext-plugin\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"JDBC Client"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Doris SSL Not Enabled"}),"\n",(0,r.jsx)(n.p,{children:"When Doris SSL is not enabled, you need to create a custom authentication plugin to bypass SSL restrictions when using JDBC connections:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Create a custom plugin class that extends ",(0,r.jsx)(n.code,{children:"MysqlClearPasswordPlugin"})," and overrides the ",(0,r.jsx)(n.code,{children:"requiresConfidentiality()"})," method:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public class MysqlClearPasswordPluginWithoutSSL extends MysqlClearPasswordPlugin {\n  @Override\n  public boolean requiresConfidentiality() {\n    return false;\n  }\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Configure the custom plugin in the JDBC connection URL (replace ",(0,r.jsx)(n.code,{children:"xxx"})," with your actual package name):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'jdbcUrl = "jdbc:mysql://localhost:9030/mydatabase?authenticationPlugins=xxx.xxx.xxx.MysqlClearPasswordPluginWithoutSSL&defaultAuthenticationPlugin=xxx.xxx.xxx.MysqlClearPasswordPluginWithoutSSL&disabledAuthenticationPlugins=com.mysql.jdbc.authentication.MysqlClearPasswordPlugin";\n'})}),"\n",(0,r.jsx)(n.p,{children:"Description of the three required properties:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Property"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"authenticationPlugins"})}),(0,r.jsx)(n.td,{children:"Register the custom cleartext authentication plugin"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"defaultAuthenticationPlugin"})}),(0,r.jsx)(n.td,{children:"Set the custom plugin as the default authentication plugin"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"disabledAuthenticationPlugins"})}),(0,r.jsx)(n.td,{children:"Disable the original cleartext authentication plugin (which mandates SSL)"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["You can refer to the examples in ",(0,r.jsx)(n.a,{href:"https://github.com/morningman/doris-debug-tools/tree/main/jdbc-test",children:"this code repository"}),". Or execute ",(0,r.jsx)(n.code,{children:"build-auth-plugin.sh"})," to directly generate the plugin JAR file, then place it in the client's specified location."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Doris SSL Enabled"}),"\n",(0,r.jsxs)(n.p,{children:["When Doris SSL is enabled (",(0,r.jsx)(n.code,{children:"enable_ssl=true"})," added in ",(0,r.jsx)(n.code,{children:"fe.conf"}),"), the JDBC URL requires no additional parameters and can connect directly:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'jdbcUrl = "jdbc:mysql://localhost:9030/mydatabase\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,r.jsx)(n.p,{children:"LDAP authentication means password verification through LDAP service to supplement Doris's native authentication mechanism. Password verification priority is as follows:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Doris first uses LDAP to verify user passwords."}),"\n",(0,r.jsx)(n.li,{children:"If the user doesn't exist in LDAP, it falls back to Doris local password verification."}),"\n",(0,r.jsx)(n.li,{children:"If the LDAP password is correct but there's no corresponding account in Doris, a temporary user is created for login."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"login-behavior-overview",children:"Login Behavior Overview"}),"\n",(0,r.jsx)(n.p,{children:"After enabling LDAP, login behaviors under different user states are as follows:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"LDAP User"}),(0,r.jsx)(n.th,{children:"Doris User"}),(0,r.jsx)(n.th,{children:"Password Used"}),(0,r.jsx)(n.th,{children:"Login Result"}),(0,r.jsx)(n.th,{children:"Login Identity"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Exists"}),(0,r.jsx)(n.td,{children:"Exists"}),(0,r.jsx)(n.td,{children:"LDAP password"}),(0,r.jsx)(n.td,{children:"Success"}),(0,r.jsx)(n.td,{children:"Doris user"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Exists"}),(0,r.jsx)(n.td,{children:"Exists"}),(0,r.jsx)(n.td,{children:"Doris password"}),(0,r.jsx)(n.td,{children:"Failed"}),(0,r.jsx)(n.td,{children:"-"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Not exists"}),(0,r.jsx)(n.td,{children:"Exists"}),(0,r.jsx)(n.td,{children:"Doris password"}),(0,r.jsx)(n.td,{children:"Success"}),(0,r.jsx)(n.td,{children:"Doris user"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Exists"}),(0,r.jsx)(n.td,{children:"Not exists"}),(0,r.jsx)(n.td,{children:"LDAP password"}),(0,r.jsx)(n.td,{children:"Success"}),(0,r.jsx)(n.td,{children:"LDAP temporary user"})]})]})]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"About Temporary Users:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Temporary accounts are only valid for the current connection and are automatically destroyed when disconnected."}),"\n",(0,r.jsx)(n.li,{children:"Doris doesn't create persistent user metadata for temporary users."}),"\n",(0,r.jsx)(n.li,{children:'Temporary user permissions are determined by LDAP group authorization (see "Group Authorization" section below).'}),"\n",(0,r.jsxs)(n.li,{children:["If temporary users have no corresponding group permissions, they default to ",(0,r.jsx)(n.code,{children:"select_priv"})," on ",(0,r.jsx)(n.code,{children:"information_schema"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"login-examples",children:"Login Examples"}),"\n",(0,r.jsxs)(n.p,{children:["The following examples assume LDAP authentication is enabled, configured with ",(0,r.jsx)(n.code,{children:"ldap_user_filter = (&(uid={login}))"}),", and the client has set ",(0,r.jsx)(n.code,{children:"LIBMYSQL_ENABLE_CLEARTEXT_PLUGIN=1"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scenario 1: Account exists in both Doris and LDAP"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Doris account: ",(0,r.jsx)(n.code,{children:"jack@'172.10.1.10'"}),", password: ",(0,r.jsx)(n.code,{children:"123456"})]}),"\n",(0,r.jsxs)(n.li,{children:["LDAP user attributes: ",(0,r.jsx)(n.code,{children:"uid: jack"}),", password: ",(0,r.jsx)(n.code,{children:"abcdef"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Login with LDAP password, success:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"mysql -hDoris_HOST -PDoris_PORT -ujack -p abcdef\n"})}),"\n",(0,r.jsx)(n.p,{children:"Login with Doris password, failed (after enabling LDAP, LDAP users must use LDAP passwords):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"mysql -hDoris_HOST -PDoris_PORT -ujack -p 123456\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scenario 2: User exists only in LDAP"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["LDAP user attributes: ",(0,r.jsx)(n.code,{children:"uid: jack"}),", password: ",(0,r.jsx)(n.code,{children:"abcdef"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Login with LDAP password, Doris automatically creates temporary user ",(0,r.jsx)(n.code,{children:"jack@'%'"})," and logs in. Temporary user has basic permission ",(0,r.jsx)(n.code,{children:"DatabasePrivs"}),": ",(0,r.jsx)(n.code,{children:"Select_priv"}),", automatically destroyed after disconnection:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"mysql -hDoris_HOST -PDoris_PORT -ujack -p abcdef\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scenario 3: Account exists only in Doris"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Doris account: ",(0,r.jsx)(n.code,{children:"jack@'172.10.1.10'"}),", password: ",(0,r.jsx)(n.code,{children:"123456"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"User doesn't exist in LDAP, falls back to Doris local authentication, login succeeds with Doris password:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"mysql -hDoris_HOST -PDoris_PORT -ujack -p 123456\n"})}),"\n",(0,r.jsx)(n.h2,{id:"group-authorization",children:"Group Authorization"}),"\n",(0,r.jsxs)(n.p,{children:["LDAP group authorization maps LDAP ",(0,r.jsx)(n.code,{children:"groups"})," to Doris ",(0,r.jsx)(n.code,{children:"roles"})," to achieve centralized permission management. The core mechanism is:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If an LDAP user's ",(0,r.jsx)(n.code,{children:"dn"})," appears in the ",(0,r.jsx)(n.code,{children:"member"})," attribute of an LDAP group node, Doris considers the user belongs to that group."]}),"\n",(0,r.jsxs)(n.li,{children:["When users log in, Doris automatically grants them the ",(0,r.jsx)(n.code,{children:"role"})," permissions corresponding to their LDAP groups."]}),"\n",(0,r.jsxs)(n.li,{children:["After users log out, Doris automatically revokes these ",(0,r.jsx)(n.code,{children:"role"})," permissions."]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Prerequisite:"})," Before using LDAP group authorization, you need to create ",(0,r.jsx)(n.code,{children:"roles"})," in Doris with the same names as LDAP ",(0,r.jsx)(n.code,{children:"groups"})," and grant permissions to these ",(0,r.jsx)(n.code,{children:"roles"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"permission-merging-rules",children:"Permission Merging Rules"}),"\n",(0,r.jsx)(n.p,{children:"The final permissions of a logged-in user depend on their status in both LDAP and Doris:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"LDAP User"}),(0,r.jsx)(n.th,{children:"Doris User"}),(0,r.jsx)(n.th,{children:"Final Permissions"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Exists"}),(0,r.jsx)(n.td,{children:"Exists"}),(0,r.jsx)(n.td,{children:"LDAP group permissions + Doris user permissions"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Not exists"}),(0,r.jsx)(n.td,{children:"Exists"}),(0,r.jsx)(n.td,{children:"Doris user permissions"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Exists"}),(0,r.jsx)(n.td,{children:"Not exists"}),(0,r.jsx)(n.td,{children:"LDAP group permissions"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"group-name-mapping-rules",children:"Group Name Mapping Rules"}),"\n",(0,r.jsxs)(n.p,{children:["Doris extracts the first ",(0,r.jsx)(n.code,{children:"Rdn"})," of the LDAP group ",(0,r.jsx)(n.code,{children:"dn"})," as the group name and maps it to a ",(0,r.jsx)(n.code,{children:"role"})," with the same name in Doris."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, if user ",(0,r.jsx)(n.code,{children:"dn"})," is ",(0,r.jsx)(n.code,{children:"uid=jack,ou=aidp,dc=domain,dc=com"}),", and the group information is:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"dn: cn=doris_rd,ou=group,dc=domain,dc=com  \nobjectClass: groupOfNames  \nmember: uid=jack,ou=aidp,dc=domain,dc=com  \n"})}),"\n",(0,r.jsxs)(n.p,{children:["The first ",(0,r.jsx)(n.code,{children:"Rdn"})," of this group ",(0,r.jsx)(n.code,{children:"dn"})," is ",(0,r.jsx)(n.code,{children:"cn=doris_rd"}),", so the group name is ",(0,r.jsx)(n.code,{children:"doris_rd"}),", corresponding to the ",(0,r.jsx)(n.code,{children:"role"})," ",(0,r.jsx)(n.code,{children:"doris_rd"})," in Doris."]}),"\n",(0,r.jsx)(n.h3,{id:"group-authorization-example",children:"Group Authorization Example"}),"\n",(0,r.jsxs)(n.p,{children:["If user jack belongs to LDAP groups ",(0,r.jsx)(n.code,{children:"doris_rd"}),", ",(0,r.jsx)(n.code,{children:"doris_qa"}),", ",(0,r.jsx)(n.code,{children:"doris_pm"}),", and Doris has ",(0,r.jsx)(n.code,{children:"roles"})," with the same names: ",(0,r.jsx)(n.code,{children:"doris_rd"}),", ",(0,r.jsx)(n.code,{children:"doris_qa"}),", ",(0,r.jsx)(n.code,{children:"doris_pm"}),". After jack logs in, in addition to the original permissions of their Doris account, they will also receive the permissions of these three ",(0,r.jsx)(n.code,{children:"roles"}),"."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Note:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Which ",(0,r.jsx)(n.code,{children:"group"})," a ",(0,r.jsx)(n.code,{children:"user"})," belongs to is independent of the LDAP tree's organizational structure. ",(0,r.jsx)(n.code,{children:"user2"})," in the example above doesn't necessarily belong to ",(0,r.jsx)(n.code,{children:"group2"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["To make ",(0,r.jsx)(n.code,{children:"user2"})," belong to ",(0,r.jsx)(n.code,{children:"group2"}),", you need to explicitly add ",(0,r.jsx)(n.code,{children:"user2"})," to the ",(0,r.jsx)(n.code,{children:"member"})," attribute of ",(0,r.jsx)(n.code,{children:"group2"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"cache-management",children:"Cache Management"}),"\n",(0,r.jsx)(n.p,{children:"To avoid frequent access to LDAP services, Doris caches LDAP information in memory."}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Configuration"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default Value"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_user_cache_timeout_s"})}),(0,r.jsx)(n.td,{children:"Cache time for LDAP user information (seconds)"}),(0,r.jsx)(n.td,{children:"43200 (12 hours)"})]})})]}),"\n",(0,r.jsx)(n.p,{children:"In the following scenarios, you may need to manually refresh the cache to make changes take effect immediately:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Modified user or group information in the LDAP service."}),"\n",(0,r.jsxs)(n.li,{children:["Modified the ",(0,r.jsx)(n.code,{children:"Role"})," permissions corresponding to LDAP user groups in Doris."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["You can refresh the cache with the ",(0,r.jsx)(n.code,{children:"refresh ldap"})," statement. See ",(0,r.jsx)(n.a,{href:"../../../sql-manual/sql-statements/account-management/REFRESH-LDAP",children:"REFRESH-LDAP"})," for details."]}),"\n",(0,r.jsx)(n.h2,{id:"known-limitations",children:"Known Limitations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Currently, Doris's LDAP functionality only supports cleartext password verification, meaning that when users log in, passwords are transmitted in plaintext between ",(0,r.jsx)(n.code,{children:"client"})," and ",(0,r.jsx)(n.code,{children:"fe"}),", and between ",(0,r.jsx)(n.code,{children:"fe"})," and LDAP service."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Q: How to check which roles an LDAP user has in Doris?"})}),"\n",(0,r.jsxs)(n.p,{children:["After logging into Doris with an LDAP user, execute ",(0,r.jsx)(n.code,{children:"show grants;"})," to view all roles of the current user. ",(0,r.jsx)(n.code,{children:"ldapDefaultRole"})," is the default role that every LDAP user has."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Q: An LDAP user has fewer roles in Doris than expected, how to troubleshoot?"})}),"\n",(0,r.jsx)(n.p,{children:"Check the following items step by step:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Execute ",(0,r.jsx)(n.code,{children:"show roles;"})," to confirm whether the expected roles exist in Doris. If not, create them with ",(0,r.jsx)(n.code,{children:"CREATE ROLE role_name;"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Check whether the expected ",(0,r.jsx)(n.code,{children:"group"})," is located under the organizational structure corresponding to ",(0,r.jsx)(n.code,{children:"ldap_group_basedn"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Check whether the expected ",(0,r.jsx)(n.code,{children:"group"})," contains the ",(0,r.jsx)(n.code,{children:"member"})," attribute."]}),"\n",(0,r.jsxs)(n.li,{children:["Check whether the ",(0,r.jsx)(n.code,{children:"member"})," attribute of the expected ",(0,r.jsx)(n.code,{children:"group"})," contains the current user's ",(0,r.jsx)(n.code,{children:"dn"}),"."]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,d.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return t},a:function(){return o}});var i=s(667294);let r={},d=i.createContext(r);function o(e){let n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(d.Provider,{value:n},e.children)}}}]);