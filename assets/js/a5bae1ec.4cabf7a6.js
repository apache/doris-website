"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["80016"],{378787:function(e,n,o){o.r(n),o.d(n,{default:()=>h,frontMatter:()=>c,metadata:()=>t,assets:()=>a,toc:()=>l,contentTitle:()=>s});var t=JSON.parse('{"id":"how-to-contribute/trino-connector-developer-guide","title":"Trino Connector Developer Guide","description":"\x3c!--","source":"@site/community/how-to-contribute/trino-connector-developer-guide.md","sourceDirName":"how-to-contribute","slug":"/how-to-contribute/trino-connector-developer-guide","permalink":"/community/how-to-contribute/trino-connector-developer-guide","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Trino Connector Developer Guide","language":"en"},"sidebar":"community","previous":{"title":"How to Share Blogs","permalink":"/community/how-to-contribute/how-to-share-blogs"},"next":{"title":"JDBC Catalog Developer Guide","permalink":"/community/how-to-contribute/jdbc-catalog-developer-guide"}}'),r=o("785893"),i=o("250065");let c={title:"Trino Connector Developer Guide",language:"en"},s=void 0,a={},l=[{value:"Background",id:"background",level:2},{value:"Step 1: Compile Kakfa connector plugin",id:"step-1-compile-kakfa-connector-plugin",level:2},{value:"Step 2: Set up Doris&#39;s fe.conf / be.conf",id:"step-2-set-up-doriss-feconf--beconf",level:2},{value:"Step 3: Using the Trino-Connector catalog feature",id:"step-3-using-the-trino-connector-catalog-feature",level:2}];function d(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,r.jsx)(n.p,{children:"Starting from version 3.0, Doris supports docking with the Trino Connector plugin. Through the rich Trino Connector plugin and Doris' Trino-Connector Catalog function, Doris can query more data sources."}),"\n",(0,r.jsx)(n.p,{children:"The purpose of the Trino Connector compatibility framework is to help Doris quickly connect to more data sources to meet user needs."}),"\n",(0,r.jsx)(n.p,{children:"For data sources such as Hive, Iceberg, Hudi, Paimon, and JDBC, we still recommend using the built-in catalog of Doris  for connection to achieve better performance, stability, and compatibility."}),"\n",(0,r.jsx)(n.p,{children:"This article mainly introduces how to adapt a Trino Connector plugin in Doris."}),"\n",(0,r.jsxs)(n.p,{children:["The following takes Trino's kafka Connector plugin as an example to introduce in detail how to adapt Trino's kafka Connector plugin in Doris, and then access the kafka data source through the ",(0,r.jsx)(n.code,{children:"Trino-Connector"})," catalog function of Doris."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Note: Trino is an Apache License 2.0 protocol open source software provided by ",(0,r.jsx)(n.a,{href:"https://trino.io/foundation",children:"Trino Software Foundation"}),". For details, please visit ",(0,r.jsx)(n.a,{href:"https://trino.io/docs/current/",children:"Trino official website"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-1-compile-kakfa-connector-plugin",children:"Step 1: Compile Kakfa connector plugin"}),"\n",(0,r.jsx)(n.p,{children:"Trino does not provide officially compiled connector plugins, so we need to compile the required connector plugins ourselves."}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Note: Since Doris currently uses the 435 version of the ",(0,r.jsx)(n.code,{children:"trino-main"})," package, it is best to compile the 435 version of the connector plugin. There may be compatibility issues with non-435 versions of the connector plugin. If you encounter any problems, please provide feedback to the Apache Doris community."]}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Clone Trino source code\n",(0,r.jsx)(n.code,{children:"$ git clone https://github.com/trinodb/trino.git"})]}),"\n",(0,r.jsxs)(n.li,{children:["Switch Trino source code to version 435\n",(0,r.jsx)(n.code,{children:"$ git checkout 435"})]}),"\n",(0,r.jsxs)(n.li,{children:["Enter the Kafka plugin source code directory\n",(0,r.jsx)(n.code,{children:"$ cd trino/plugin/trino-kafka"})]}),"\n",(0,r.jsxs)(n.li,{children:["Compile the Kafka plugin\n",(0,r.jsx)(n.code,{children:"$ mvn clean install -DskipTest"})]}),"\n",(0,r.jsx)(n.li,{children:"After the compilation is completed, the target/trino-kafka-435 directory will be generated in the trino/plugin/trino-kafka/ directory."}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Note: Each connector plugin is a subdirectory, not a jar package."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-2-set-up-doriss-feconf--beconf",children:"Step 2: Set up Doris's fe.conf / be.conf"}),"\n",(0,r.jsx)(n.p,{children:"After preparing the Kafka connector plug-in, you need to configure Doris's fe.conf and be.conf so that Doris can load the plug-in."}),"\n",(0,r.jsxs)(n.p,{children:["If we store the ",(0,r.jsx)(n.code,{children:"trino-kafka-435"})," directory prepared above in the /path/to/connectors directory, and then we should configure:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"fe.conf"}),"\n",(0,r.jsxs)(n.p,{children:["Configure ",(0,r.jsx)(n.code,{children:"trino_connector_plugin_dir=/path/to/connectors"})," in the fe.conf file (if the ",(0,r.jsx)(n.code,{children:"trino_connector_plugin_dir"})," attribute is not configured in fe.conf, the ",(0,r.jsx)(n.code,{children:"${Doris_HOME}/fe/connectors"})," directory will be used by default)."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"be.conf"}),"\n",(0,r.jsxs)(n.p,{children:["Configure ",(0,r.jsx)(n.code,{children:"trino_connector_plugin_dir=/path/to/connectors"})," in the be.conf file (if the ",(0,r.jsx)(n.code,{children:"trino_connector_plugin_dir"})," attribute is not configured in be.conf, the ",(0,r.jsx)(n.code,{children:"${Doris_HOME}/be/connectors"})," directory will be used by default)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Note: Doris uses a lazy loading method to load the Trino Connector plug-in, which means that if it is the first time to use the Trino-Connector Catalog function in Doris, there is no need to restart the FE / BE node, Doris will automatically load the plug-in. However, the plug-in will only be loaded once, so if the plug-in in the ",(0,r.jsx)(n.code,{children:"/path/to/connectors/"})," directory changes, you need to restart the FE / BE node before the changed plug-in can be loaded."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-3-using-the-trino-connector-catalog-feature",children:"Step 3: Using the Trino-Connector catalog feature"}),"\n",(0,r.jsx)(n.p,{children:"After completing the previous two steps, we can use the Trino-Connector Catalog function in Doris."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"First let's create a Trino-Connector Catalog in Doris:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'create catalog kafka_tpch properties (\n    "type"="trino-connector",\n    -- The following four properties are derived from trino and are consistent with the properties in etc/catalog/kakfa.properties of trino. But need to add "trino." prefix\n    "trino.connector.name"="kafka",\n    "trino.kafka.table-names"="tpch.customer,tpch.orders,tpch.lineitem,tpch.part,tpch.partsupp,tpch.supplier,tpch.nation,tpch.region",\n    "trino.kafka.nodes"="localhost:9092",\n    "trino.kafka.table-description-dir" = "/mnt/datadisk1/fangtiewei"\n);\n'})}),"\n",(0,r.jsx)(n.p,{children:"explain:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"type"})," \uFF1AThe type of catalog, here we must set it to ",(0,r.jsx)(n.code,{children:"trino-connector"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"trino.connector.name"}),"\u3001",(0,r.jsx)(n.code,{children:"trino.kafka.table-names"}),"\u3001",(0,r.jsx)(n.code,{children:"trino.kafka.nodes"}),"\u3001",(0,r.jsx)(n.code,{children:"trino.kafka.table-description-dir"})," The following four properties are derived from trino, refer to: ",(0,r.jsx)(n.a,{href:"https://trino.io/docs/current/connector/kafka.html#configuration",children:"Kafka connector"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Different Connector plug-ins should set different properties. You can refer to the official trino documentation: ",(0,r.jsx)(n.a,{href:"https://trino.io/docs/current/connector.html#connector--page-root",children:"Connectors"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Use catalog"}),"\n",(0,r.jsxs)(n.p,{children:["After we create the Trino-Connector catalog, there is no difference in use from other catalogs. Switch to the catalog through the ",(0,r.jsx)(n.code,{children:"switch kafka_tpch"})," statement, and then you can query the data of the Kafka data source."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The following are the Doris Trino-Connector catalog configuration of several commonly used Connector plug-ins."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Hive"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'create catalog emr_hive properties (\n    "type"="trino-connector",\n    "trino.connector.name"="hive",\n    "trino.hive.metastore.uri"="thrift://ip:port",\n    "trino.hive.config.resources"="/path/to/core-site.xml,/path/to/hdfs-site.xml"\n);\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Note:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'You should add Hadoop\'s user name in the JVM parameters: -DHADOOP_USER_NAME=user, which can be configured at the end of the JAVA_OPTS_FOR_JDK_17 parameter in the fe.conf / be.conf file, such as JAVA_OPTS_FOR_JDK_17="...-DHADOOP_USER_NAME=user"'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Mysql"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'create catalog trino_mysql properties (\n    "type"="trino-connector",\n    "trino.connector.name"="mysql",\n    "trino.connection-url" = "jdbc:mysql://ip:port",\n    "trino.connection-user" = "user",\n    "trino.connection-password" = "password"\n);\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Note:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"When encountering the error: Unknown or incorrect time zone: 'Asia/Shanghai', you need to add: -Duser.timezone=Etc/GMT-8 to the JVM startup parameters, which can be configured at the end of the JAVA_OPTS_FOR_JDK_17 parameter in the fe.conf / be.conf file."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Kafka"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'create catalog kafka properties (\n    "type"="trino-connector",\n    "trino.connector.name"="kafka",\n    "trino.kafka.nodes"="localhost:9092",\n    "trino.kafka.table-description-supplier"="CONFLUENT",\n    "trino.kafka.confluent-schema-registry-url"="http://localhost:8081",\n    "trino.kafka.hide-internal-columns" = "false"\n);\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"BigQuery"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'create catalog bigquery_catalog properties (\n    "type"="trino-connector",\n    "trino.connector.name"="bigquery",\n    "trino.bigquery.project-id"="steam-circlet-388406",\n    "trino.bigquery.credentials-file"="/path/to/application_default_credentials.json"\n);\n'})}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},250065:function(e,n,o){o.d(n,{Z:function(){return s},a:function(){return c}});var t=o(667294);let r={},i=t.createContext(r);function c(e){let n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);