"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["933388"],{324299:function(e,n,i){i.r(n),i.d(n,{default:()=>h,frontMatter:()=>l,metadata:()=>t,assets:()=>a,toc:()=>c,contentTitle:()=>s});var t=JSON.parse('{"id":"source-install/compilation-with-ldb-toolchain","title":"Compiling with LDB Toolchain (Recommended)","description":"\x3c!--","source":"@site/community/source-install/compilation-with-ldb-toolchain.md","sourceDirName":"source-install","slug":"/source-install/compilation-with-ldb-toolchain","permalink":"/community/source-install/compilation-with-ldb-toolchain","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Compiling with LDB Toolchain (Recommended)","language":"en"},"sidebar":"community","previous":{"title":"Compiling with Docker (Recommended)","permalink":"/community/source-install/compilation-with-docker"},"next":{"title":"Compiling on Linux","permalink":"/community/source-install/compilation-linux"}}'),o=i("785893"),r=i("250065");let l={title:"Compiling with LDB Toolchain (Recommended)",language:"en"},s=void 0,a={},c=[{value:"Prepare the compilation environment",id:"prepare-the-compilation-environment",level:2},{value:"Compile Doris",id:"compile-doris",level:2},{value:"Pre-compile third-party libraries",id:"pre-compile-third-party-libraries",level:2}];function d(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"This guide is about how to compile Doris using the LDB Toolchain. This method serves as a supplement to the Docker compilation approach to help developers and users without a Docker environment."}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Doris Version"}),(0,o.jsx)(n.th,{children:"Recommended LDB Toolchain Version"}),(0,o.jsx)(n.th,{children:"Included Compiler Version"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"master"}),(0,o.jsx)(n.td,{children:"0.25"}),(0,o.jsx)(n.td,{children:"clang-20, gcc-15"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"3.1 / 3.0 / 2.1"}),(0,o.jsx)(n.td,{children:"0.19"}),(0,o.jsx)(n.td,{children:"clang-17, gcc-13"})]})]})]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"LDB Toolchain stands for Linux Distribution Based Toolchain Generator. It helps compile modern C++ projects on almost all Linux distributions."})}),"\n",(0,o.jsx)(n.h2,{id:"prepare-the-compilation-environment",children:"Prepare the compilation environment"}),"\n",(0,o.jsx)(n.p,{children:"This method applies to most Linux distributions (CentOS, Ubuntu, etc.)."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Download"})," ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"ldb_toolchain_gen.sh"})})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Download the latest ",(0,o.jsx)(n.code,{children:"ldb_toolchain_gen.sh"})," from ",(0,o.jsx)(n.a,{href:"https://github.com/amosbird/ldb_toolchain_gen/releases",children:"here"}),", For ARM architecture, you need to download the latest ldb_toolchain_gen.aarch64.sh. This script is used to generate ldb toolchain."]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["For more information, please visit ",(0,o.jsx)(n.a,{href:"https://github.com/amosbird/ldb_toolchain_gen",children:"https://github.com/amosbird/ldb_toolchain_gen"})]})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Execute the following command to generate ldb toolchain."})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sh ldb_toolchain_gen.sh /path/to/ldb_toolchain/\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"/path/to/ldb_toolchain/"})," is the installation directory for the toolchain. After successful execution, the following directory structure will be generated under ",(0,o.jsx)(n.code,{children:"/path/to/ldb_toolchain/"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"\u251C\u2500\u2500 bin\n\u251C\u2500\u2500 include\n\u251C\u2500\u2500 lib\n\u251C\u2500\u2500 share\n\u251C\u2500\u2500 test\n\u2514\u2500\u2500 usr\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Download and install other compilation components"})}),"\n"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Download ",(0,o.jsx)(n.a,{href:"https://doris-thirdparty-1308700295.cos.ap-beijing.myqcloud.com/tools/jdk-8u391-linux-x64.tar.gz",children:"Java8"})," for Doris 2.1 and earlier versions and install it to /path/to/java."]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["For versions later than 3.0 (inclusive), or the master branch, please use ",(0,o.jsx)(n.a,{href:"https://download.oracle.com/java/17/archive/jdk-17.0.10_linux-x64_bin.tar.gz",children:"Java 17"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"It is recommended to install Java 8 or Java 17 using the package management tools provided by your Linux distribution, such as yum(java-1.8.0/17-openjdk-devel) or apt(openjdk-8/17-jdk). and verify with java -version"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Download ",(0,o.jsx)(n.a,{href:"https://dlcdn.apache.org/maven/maven-3/3.9.9/binaries/apache-maven-3.9.9-bin.tar.gz",children:"Apache Maven 3.9.9"})," and install it to /path/to/maven."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Download ",(0,o.jsx)(n.a,{href:"https://doris-thirdparty-repo.bj.bcebos.com/thirdparty/node-v12.13.0-linux-x64.tar.gz",children:"Node v12.13.0"})," and install it to /path/to/node."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Different Linux distributions may include different default components. Therefore, you may need to install some additional components. The following takes CentOS 6 as an example. Similar steps may apply to other distributions:"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"install required system packages\nsudo yum install -y byacc patch automake libtool make which file ncurses-devel gettext-devel unzip bzip2 zip util-linux wget git python2\n\ninstall autoconf-2.69\nwget http://ftp.gnu.org/gnu/autoconf/autoconf-2.69.tar.gz && \\\n    tar zxf autoconf-2.69.tar.gz && \\\n    cd autoconf-2.69 && \\\n    ./configure && \\\n    make && \\\n    make install\n\ninstall bison-3.8.2\nwget http://ftp.gnu.org/gnu/bison/bison-3.8.2.tar.gz && \\\n    tar xzf bison-3.8.2.tar.gz && \\\n    cd bison-3.8.2 && \\\n    ./configure && \\\n    make && \\\n    make install\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"4",children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Download Doris source code"})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/apache/doris.git\n"})}),"\n",(0,o.jsxs)(n.p,{children:["After downloading, navigate to the Doris source code directory, create a ",(0,o.jsx)(n.code,{children:"custom_env.sh"})," file, and set the PATH environment variable as follows:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"export JAVA_HOME=/path/to/java/\nexport PATH=$JAVA_HOME/bin:$PATH\nexport PATH=/path/to/maven/bin:$PATH\nexport PATH=/path/to/node/bin:$PATH\nexport PATH=/path/to/ldb_toolchain/bin:$PATH\n"})}),"\n",(0,o.jsx)(n.h2,{id:"compile-doris",children:"Compile Doris"}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"The first step of compiling Doris source code is to first download third-party libraries and compile them. You can refer to the following instructions to download precompiled versions of the third-party libraries."})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Enter the Doris source code directory and execute the following command to check if the compilation machine supports the AVX2 instruction set."})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cat /proc/cpuinfo | grep avx2\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Execute compilation."})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# By default, it builds AVX2 version.\n$ sh build.sh\n\n# If you need the no AVX2 version, add USE_AVX2=0.\n$ USE_AVX2=0 sh build.sh\n\n# To compile a debug version of BE, add BUILD_TYPE=Debug.\n$ BUILD_TYPE=Debug sh build.sh\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This script first compiles the third-party libraries and then the Doris components (FE, BE, MS). The compilation output can be found in the ",(0,o.jsx)(n.code,{children:"output/"})," directory. MS stands for Meta Service, which a module of Doris in the compute-storage decoupled mode. For more information about MS, refer to this ",(0,o.jsx)(n.a,{href:"../../docs/compute-storage-decoupled/compilation-and-deployment.md",children:"doc"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"pre-compile-third-party-libraries",children:"Pre-compile third-party libraries"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"build.sh"})," script compiles third-party libraries first. You can download the pre-compiled third-party libraries directly from the following link:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-Plain",children:"https://github.com/apache/doris-thirdparty/releases\n"})}),"\n",(0,o.jsx)(n.p,{children:"The pre-compiled libraries for Linux and MacOS are provided. If they match your compilation and runtime environment, you can download them and use them directly."}),"\n",(0,o.jsxs)(n.p,{children:["After downloading, extract the files to obtain an ",(0,o.jsx)(n.code,{children:"installed/"})," directory. Copy this directory to the ",(0,o.jsx)(n.code,{children:"thirdparty/"}),"directory, and then run ",(0,o.jsx)(n.code,{children:"build.sh"})," to proceed with the compilation."]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return s},a:function(){return l}});var t=i(667294);let o={},r=t.createContext(o);function l(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);