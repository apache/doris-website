"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["741486"],{642698:function(e,a,s){s.r(a),s.d(a,{default:()=>d,frontMatter:()=>r,metadata:()=>t,assets:()=>c,toc:()=>l,contentTitle:()=>o});var t=JSON.parse('{"id":"ecosystem/automq-load","title":"AutoMQ Load","description":"AutoMQ is a cloud-native fork of Kafka by separating storage to object storage like S3. It remains 100% compatible with Apache Kafka\xae while offering users up to a 10x cost-effective and 100x elasticity . Through its innovative shared storage architecture, it achieves capabilities such as reassign partitions in seconds, self-balancing and auto scaling in seconds while ensuring high throughput and low latency.","source":"@site/docs/ecosystem/automq-load.md","sourceDirName":"ecosystem","slug":"/ecosystem/automq-load","permalink":"/docs/dev/ecosystem/automq-load","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"AutoMQ Load","language":"en"},"sidebar":"docs","previous":{"title":"Kyuubi","permalink":"/docs/dev/ecosystem/kyuubi"},"next":{"title":"Hive Bitmap UDF","permalink":"/docs/dev/ecosystem/hive-bitmap-udf"}}'),n=s("785893"),i=s("250065");let r={title:"AutoMQ Load",language:"en"},o=void 0,c={},l=[{value:"Environment Preparation",id:"environment-preparation",level:2},{value:"Prepare Apache Doris and Test Data",id:"prepare-apache-doris-and-test-data",level:3},{value:"Prepare Kafka Command Line Tools",id:"prepare-kafka-command-line-tools",level:3},{value:"Prepare AutoMQ and test data",id:"prepare-automq-and-test-data",level:3},{value:"Create a Routine Load import job",id:"create-a-routine-load-import-job",level:2},{value:"Verify data import",id:"verify-data-import",level:2}];function m(e){let a={a:"a",annotation:"annotation",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",math:"math",mi:"mi",mo:"mo",mrow:"mrow",msub:"msub",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.a,{href:"https://github.com/AutoMQ/automq",children:"AutoMQ"})," is a cloud-native fork of Kafka by separating storage to object storage like S3. It remains 100% compatible with Apache Kafka\xae while offering users up to a 10x cost-effective and 100x elasticity . Through its innovative shared storage architecture, it achieves capabilities such as reassign partitions in seconds, self-balancing and auto scaling in seconds while ensuring high throughput and low latency.\n",(0,n.jsx)(a.img,{alt:"AutoMQ Storage Architecture",src:s(192628).Z+"",width:"828",height:"948"})]}),"\n",(0,n.jsxs)(a.p,{children:["This article will explain how to use Apache Doris Routine Load to import data from AutoMQ into Doris. For more details on Routine Load, please refer to the ",(0,n.jsx)(a.a,{href:"https://doris.apache.org/docs/data-operate/import/routine-load-manual/",children:"Routine Load"})," document."]}),"\n",(0,n.jsx)(a.h2,{id:"environment-preparation",children:"Environment Preparation"}),"\n",(0,n.jsx)(a.h3,{id:"prepare-apache-doris-and-test-data",children:"Prepare Apache Doris and Test Data"}),"\n",(0,n.jsxs)(a.p,{children:["Ensure that a working Apache Doris cluster is already set up. For demonstration purposes, we have deployed a test Apache Doris environment on Linux following the ",(0,n.jsx)(a.a,{href:"../gettingStarted/quick-start",children:"Quick Started"})," document.\nCreate databases and test tables:"]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:"create database automq_db;\nCREATE TABLE automq_db.users (\n                                 id bigint NOT NULL,\n                                 name string NOT NULL,\n                                 timestamp string NULL,\n                                 status string NULL\n\n) DISTRIBUTED BY hash (id) PROPERTIES ('replication_num' = '1');\n"})}),"\n",(0,n.jsx)(a.h3,{id:"prepare-kafka-command-line-tools",children:"Prepare Kafka Command Line Tools"}),"\n",(0,n.jsxs)(a.p,{children:["Download the latest TGZ package from ",(0,n.jsx)(a.a,{href:"https://github.com/AutoMQ/automq",children:"AutoMQ Releases"})," and extract it. Assuming the extraction directory is ",(0,n.jsxs)(a.span,{className:"katex",children:[(0,n.jsx)(a.span,{className:"katex-mathml",children:(0,n.jsx)(a.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(a.semantics,{children:[(0,n.jsxs)(a.mrow,{children:[(0,n.jsx)(a.mi,{children:"A"}),(0,n.jsx)(a.mi,{children:"U"}),(0,n.jsx)(a.mi,{children:"T"}),(0,n.jsx)(a.mi,{children:"O"}),(0,n.jsx)(a.mi,{children:"M"}),(0,n.jsxs)(a.msub,{children:[(0,n.jsx)(a.mi,{children:"Q"}),(0,n.jsx)(a.mi,{children:"H"})]}),(0,n.jsx)(a.mi,{children:"O"}),(0,n.jsx)(a.mi,{children:"M"}),(0,n.jsx)(a.mi,{children:"E"}),(0,n.jsx)(a.mo,{separator:"true",children:","}),(0,n.jsx)(a.mi,{children:"t"}),(0,n.jsx)(a.mi,{children:"h"}),(0,n.jsx)(a.mi,{children:"i"}),(0,n.jsx)(a.mi,{children:"s"}),(0,n.jsx)(a.mi,{children:"a"}),(0,n.jsx)(a.mi,{children:"r"}),(0,n.jsx)(a.mi,{children:"t"}),(0,n.jsx)(a.mi,{children:"i"}),(0,n.jsx)(a.mi,{children:"c"}),(0,n.jsx)(a.mi,{children:"l"}),(0,n.jsx)(a.mi,{children:"e"}),(0,n.jsx)(a.mi,{children:"w"}),(0,n.jsx)(a.mi,{children:"i"}),(0,n.jsx)(a.mi,{children:"l"}),(0,n.jsx)(a.mi,{children:"l"}),(0,n.jsx)(a.mi,{children:"u"}),(0,n.jsx)(a.mi,{children:"s"}),(0,n.jsx)(a.mi,{children:"e"}),(0,n.jsx)(a.mi,{children:"t"}),(0,n.jsx)(a.mi,{children:"h"}),(0,n.jsx)(a.mi,{children:"e"}),(0,n.jsx)(a.mi,{children:"s"}),(0,n.jsx)(a.mi,{children:"c"}),(0,n.jsx)(a.mi,{children:"r"}),(0,n.jsx)(a.mi,{children:"i"}),(0,n.jsx)(a.mi,{children:"p"}),(0,n.jsx)(a.mi,{children:"t"}),(0,n.jsx)(a.mi,{children:"s"}),(0,n.jsx)(a.mi,{children:"u"}),(0,n.jsx)(a.mi,{children:"n"}),(0,n.jsx)(a.mi,{children:"d"}),(0,n.jsx)(a.mi,{children:"e"}),(0,n.jsx)(a.mi,{children:"r"})]}),(0,n.jsx)(a.annotation,{encoding:"application/x-tex",children:"AUTOMQ_HOME, this article will use the scripts under "})]})})}),(0,n.jsx)(a.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(a.span,{className:"base",children:[(0,n.jsx)(a.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"A"}),(0,n.jsx)(a.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"U"}),(0,n.jsx)(a.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"TOM"}),(0,n.jsxs)(a.span,{className:"mord",children:[(0,n.jsx)(a.span,{className:"mord mathnormal",children:"Q"}),(0,n.jsx)(a.span,{className:"msupsub",children:(0,n.jsxs)(a.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(a.span,{className:"vlist-r",children:[(0,n.jsx)(a.span,{className:"vlist",style:{height:"0.3283em"},children:(0,n.jsxs)(a.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,n.jsx)(a.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(a.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(a.span,{className:"mord mathnormal mtight",style:{marginRight:"0.08125em"},children:"H"})})]})}),(0,n.jsx)(a.span,{className:"vlist-s",children:"\u200B"})]}),(0,n.jsx)(a.span,{className:"vlist-r",children:(0,n.jsx)(a.span,{className:"vlist",style:{height:"0.15em"},children:(0,n.jsx)(a.span,{})})})]})})]}),(0,n.jsx)(a.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"OME"}),(0,n.jsx)(a.span,{className:"mpunct",children:","}),(0,n.jsx)(a.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"t"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"hi"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"s"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"a"}),(0,n.jsx)(a.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"t"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"i"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"c"}),(0,n.jsx)(a.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"e"}),(0,n.jsx)(a.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"i"}),(0,n.jsx)(a.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"ll"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"u"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"se"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"t"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"h"}),(0,n.jsx)(a.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"escr"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"i"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"pt"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"s"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"u"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"n"}),(0,n.jsx)(a.span,{className:"mord mathnormal",children:"d"}),(0,n.jsx)(a.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"er"})]})})]}),"AUTOMQ_HOME/bin to create topics and generate test data."]}),"\n",(0,n.jsx)(a.h3,{id:"prepare-automq-and-test-data",children:"Prepare AutoMQ and test data"}),"\n",(0,n.jsxs)(a.p,{children:["Refer to the AutoMQ ",(0,n.jsx)(a.a,{href:"https://docs.automq.com/docs/automq-opensource/EvqhwAkpriAomHklOUzcUtybn7g",children:"official deployment documentation"})," to deploy a functional cluster, ensuring network connectivity between AutoMQ and Apache Doris.\nQuickly create a topic named example_topic in AutoMQ and write a test JSON data to it by following these steps."]}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Create Topic"})}),"\n",(0,n.jsx)(a.p,{children:"Use the Apache Kafka\xae command line tool in AutoMQ to create the topic, ensuring that you have access to a Kafka environment and that the Kafka service is running. Here is an example command to create a topic:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:"$AUTOMQ_HOME/bin/kafka-topics.sh --create --topic exampleto_topic --bootstrap-server 127.0.0.1:9092  --partitions 1 --replication-factor 1\n"})}),"\n",(0,n.jsxs)(a.blockquote,{children:["\n",(0,n.jsxs)(a.p,{children:["Tips: When executing the command, replace ",(0,n.jsx)(a.code,{children:"topic"})," and ",(0,n.jsx)(a.code,{children:"bootstarp-server"})," with the actual AutoMQ Bootstrap Server address."]}),"\n"]}),"\n",(0,n.jsx)(a.p,{children:"After creating the topic, you can use the following command to verify that the topic has been successfully created."}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:"$AUTOMQ_HOME/bin/kafka-topics.sh --describe example_topic --bootstrap-server 127.0.0.1:9092\n"})}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Generate test data"})}),"\n",(0,n.jsx)(a.p,{children:"Create a JSON-formatted test data entry, corresponding to the table mentioned earlier."}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:'{\n  "id": 1,\n  "name": "testuser",\n  "timestamp": "2023-11-10T12:00:00",\n  "status": "active"\n}\n'})}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Write test data"})}),"\n",(0,n.jsxs)(a.p,{children:["Use Kafka's command-line tools or a programming approach to write the test data to a topic named ",(0,n.jsx)(a.code,{children:"example_topic"}),". Below is an example using the command-line tool:"]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:'echo \'{"id": 1, "name": "testuser", "timestamp": "2023-11-10T12:00:00", "status": "active"}\' | sh kafka-console-producer.sh --broker-list 127.0.0.1:9092 --topic example_topic\n'})}),"\n",(0,n.jsx)(a.p,{children:"To view the data just written to the topic, use the following command:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:"sh $AUTOMQ_HOME/bin/kafka-console-consumer.sh --bootstrap-server 127.0.0.1:9092 --topic example_topic --from-beginning\n"})}),"\n",(0,n.jsxs)(a.blockquote,{children:["\n",(0,n.jsxs)(a.p,{children:["Tips: When executing the command, replace ",(0,n.jsx)(a.code,{children:"topic"})," and ",(0,n.jsx)(a.code,{children:"bootstarp-server"})," with the actual AutoMQ Bootstrap Server address."]}),"\n"]}),"\n",(0,n.jsx)(a.h2,{id:"create-a-routine-load-import-job",children:"Create a Routine Load import job"}),"\n",(0,n.jsx)(a.p,{children:"In the Apache Doris command line, create a Routine Load job that accepts JSON data to continuously import data from an AutoMQ Kafka topic. For detailed parameter information of Routine Load, please refer to [Doris Routine Load]."}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:'CREATE ROUTINE LOAD automq_example_load ON users\nCOLUMNS(id, name, timestamp, status)\nPROPERTIES\n(\n    "format" = "json",\n    "jsonpaths" = "[\\"$.id\\",\\"$.name\\",\\"$.timestamp\\",\\"$.status\\"]"\n )\nFROM KAFKA\n(\n    "kafka_broker_list" = "127.0.0.1:9092",\n    "kafka_topic" = "example_topic",\n    "property.kafka_default_offsets" = "OFFSET_BEGINNING"\n);\n'})}),"\n",(0,n.jsxs)(a.blockquote,{children:["\n",(0,n.jsx)(a.p,{children:"Tips: When executing the command, you need to replace kafka_broker_list with the actual AutoMQ Bootstrap Server address."}),"\n"]}),"\n",(0,n.jsx)(a.h2,{id:"verify-data-import",children:"Verify data import"}),"\n",(0,n.jsx)(a.p,{children:"First, check the status of the Routine Load import job to ensure that the task is running."}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:"show routine load\\G;\n"})}),"\n",(0,n.jsx)(a.p,{children:"Then query the relevant tables in the Apache Doris database, and you will see that the data has been successfully imported."}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:"select * from users;\n+------+--------------+---------------------+--------+\n| id   | name         | timestamp           | status |\n+------+--------------+---------------------+--------+\n|    1 | testuser     | 2023-11-10T12:00:00 | active |\n|    2 | testuser     | 2023-11-10T12:00:00 | active |\n+------+--------------+---------------------+--------+\n2 rows in set (0.01 sec)\n"})})]})}function d(e={}){let{wrapper:a}={...(0,i.a)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(m,{...e})}):m(e)}},192628:function(e,a,s){s.d(a,{Z:function(){return t}});let t=s.p+"assets/images/automq_storage_architecture-ae9745cd9eb2b4c42ef8e10d44e9fe7a.png"},250065:function(e,a,s){s.d(a,{Z:function(){return o},a:function(){return r}});var t=s(667294);let n={},i=t.createContext(n);function r(e){let a=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),t.createElement(i.Provider,{value:a},e.children)}}}]);