"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["310830"],{202382:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>o,metadata:()=>a,assets:()=>l,toc:()=>c,contentTitle:()=>t});var a=JSON.parse('{"id":"lakehouse/best-practices/doris-polaris","title":"Integration with Apache Polaris","description":"As data lake technologies continue to evolve, efficiently and securely managing massive amounts of data on object storage (such as AWS S3) while ","source":"@site/versioned_docs/version-4.x/lakehouse/best-practices/doris-polaris.md","sourceDirName":"lakehouse/best-practices","slug":"/lakehouse/best-practices/doris-polaris","permalink":"/docs/4.x/lakehouse/best-practices/doris-polaris","draft":false,"unlisted":false,"tags":[],"version":"4.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Integration with Apache Polaris","language":"en","description":"As data lake technologies continue to evolve, efficiently and securely managing massive amounts of data on object storage (such as AWS S3) while "},"sidebar":"docs","previous":{"title":"Integration with Glue + AWS S3 Tables","permalink":"/docs/4.x/lakehouse/best-practices/doris-aws-s3tables"},"next":{"title":"Integration with Apache Gravitino","permalink":"/docs/4.x/lakehouse/best-practices/doris-gravitino"}}'),i=s("785893"),r=s("250065");let o={title:"Integration with Apache Polaris",language:"en",description:"As data lake technologies continue to evolve, efficiently and securely managing massive amounts of data on object storage (such as AWS S3) while "},t=void 0,l={},c=[{value:"1. AWS Environment Preparation",id:"1-aws-environment-preparation",level:2},{value:"1.1 Create S3 Storage Bucket",id:"11-create-s3-storage-bucket",level:3},{value:"1.2 Create IAM Role for Object Storage Access",id:"12-create-iam-role-for-object-storage-access",level:3},{value:"1.3 Bind IAM Role to EC2 Instance (Optional)",id:"13-bind-iam-role-to-ec2-instance-optional",level:3},{value:"2. Polaris Deployment and Catalog Creation",id:"2-polaris-deployment-and-catalog-creation",level:2},{value:"2.1 Clone Source Code and Start Polaris",id:"21-clone-source-code-and-start-polaris",level:3},{value:"2.2 Create Catalog and Namespace in Polaris",id:"22-create-catalog-and-namespace-in-polaris",level:3},{value:"2.3 Polaris Security Role and Permission Configuration",id:"23-polaris-security-role-and-permission-configuration",level:3},{value:"3. Doris Connection to Polaris",id:"3-doris-connection-to-polaris",level:2},{value:"Method 1: OAuth2 + Temporary Storage Credentials (Credential Vending)",id:"method-1-oauth2--temporary-storage-credentials-credential-vending",level:3},{value:"Method 2: OAuth2 + Static Storage Credentials (AK/SK)",id:"method-2-oauth2--static-storage-credentials-aksk",level:3},{value:"4. Verify Connection in Doris",id:"4-verify-connection-in-doris",level:2}];function d(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"As data lake technologies continue to evolve, efficiently and securely managing massive amounts of data on object storage (such as AWS S3) while providing a unified access point for upstream analytical engines (such as Apache Doris) has become a core challenge in modern data architecture. Apache Polaris, as Iceberg's open and standardized REST Catalog service, provides the perfect solution for this challenge. It not only handles centralized metadata management but also greatly enhances the security and manageability of data lakes through fine-grained access controls and flexible credential management mechanisms."}),"\n",(0,i.jsx)(n.p,{children:"This article will provide a detailed introduction on how to integrate Apache Doris with Polaris to achieve efficient querying and management of Iceberg data on S3. We will guide you through the entire process from environment preparation to final querying step by step."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Through this document, you will quickly learn:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"AWS Environment Preparation"}),": How to create and configure S3 storage buckets in AWS, and prepare necessary IAM roles and policies for both Polaris and Doris, enabling Polaris to access S3 itself and distribute access credentials to Doris."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Polaris Deployment and Configuration"}),": How to download and start the Polaris service on a server, and create Iceberg Catalog, Namespace, and corresponding Principal/Role/permissions in Polaris to provide secure metadata access endpoints for Doris."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Doris Connection to Polaris"}),": Explains how Doris obtains metadata access tokens from Polaris through OAuth2, and demonstrates two core underlying storage access methods:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Temporary AK/SK issued by Polaris (Credential Vending mechanism)"}),"\n",(0,i.jsx)(n.li,{children:"Doris directly using static AK/SK to access S3"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Require Doris version 3.1+"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"1-aws-environment-preparation",children:"1. AWS Environment Preparation"}),"\n",(0,i.jsx)(n.p,{children:"Before we begin, we need to prepare S3 storage buckets and corresponding IAM roles on AWS, which forms the foundation for Polaris to manage data and Doris to access data."}),"\n",(0,i.jsx)(n.h3,{id:"11-create-s3-storage-bucket",children:"1.1 Create S3 Storage Bucket"}),"\n",(0,i.jsxs)(n.p,{children:["First, we create an S3 Bucket named ",(0,i.jsx)(n.code,{children:"polaris-doris-demo"})," to store Iceberg table data that will be created later."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Create S3 storage bucket\naws s3 mb s3://polaris-doris-demo --region us-west-2\n# Verify bucket creation success\naws s3 ls | grep polaris-doris-demo\n"})}),"\n",(0,i.jsx)(n.h3,{id:"12-create-iam-role-for-object-storage-access",children:"1.2 Create IAM Role for Object Storage Access"}),"\n",(0,i.jsx)(n.p,{children:"To implement secure credential management, we need to create an IAM role for Polaris to use through the STS AssumeRole mechanism. This design follows the security best practices of least privilege principle and separation of duties."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create trust policy file"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"polaris-trust-policy.json"})," file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'cat > polaris-trust-policy.json << \'EOF\'\n{\n    "Version": "2012-10-17",\n    "Statement": [\n    {\n        "Effect": "Allow",\n        "Principal": {\n        "AWS": "arn:aws:iam::YOUR_ACCOUNT_ID:root"\n        },\n        "Action": "sts:AssumeRole",\n        "Condition": {\n        "StringEquals": {\n            "sts:ExternalId": "polaris-doris-demo"\n        }\n        }\n    }\n    ]\n}\nEOF\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Note: Please replace YOUR_ACCOUNT_ID with your actual AWS Account ID, which can be obtained via ",(0,i.jsx)(n.code,{children:"aws sts get-caller-identity --query Account --output text"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create IAM Role"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'aws iam create-role \\\n    --role-name polaris-doris-demo \\\n    --assume-role-policy-document file:///path/to/polaris-trust-policy.json \\\n    --description "IAM Role for Polaris to access S3 storage"\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Attach S3 access permission policy"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"aws iam attach-role-policy \\\n    --role-name polaris-doris-demo \\\n    --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Verify creation results"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"aws iam get-role --role-name polaris-doris-demo\naws iam list-attached-role-policies --role-name polaris-doris-demo\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"13-bind-iam-role-to-ec2-instance-optional",children:"1.3 Bind IAM Role to EC2 Instance (Optional)"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"If this step is not performed, you need to set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY before starting Polaris"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If your Polaris service will run on an EC2 instance, the best practice is to bind an IAM role to that EC2 instance rather than using access keys. This avoids hardcoding credentials in code and improves security."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create trust policy for EC2 instance role"}),"\n",(0,i.jsx)(n.p,{children:"First create a trust policy file that allows the EC2 service to assume this role:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'cat > ec2-trust-policy.json << \'EOF\'\n{\n"Version": "2012-10-17",\n"Statement": [\n    {\n    "Effect": "Allow",\n    "Principal": {\n        "Service": "ec2.amazonaws.com"\n    },\n    "Action": "sts:AssumeRole"\n    }\n]\n}\nEOF\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create EC2 instance role"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'aws iam create-role \\\n    --role-name polaris-ec2-role \\\n    --assume-role-policy-document file:///path/to/ec2-trust-policy.json \\\n    --description "IAM Role for EC2 instance running Polaris service"\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Attach S3 access permission policy"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Attach AmazonS3FullAccess managed policy\naws iam attach-role-policy \\\n    --role-name polaris-ec2-role \\\n    --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create instance profile"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Create instance profile\naws iam create-instance-profile \\\n    --instance-profile-name polaris-ec2-instance-profile\n\n# Add role to instance profile\naws iam add-role-to-instance-profile \\\n    --instance-profile-name polaris-ec2-instance-profile \\\n    --role-name polaris-ec2-role\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Attach instance profile to EC2 instance"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# If it's a newly created EC2 instance, specify during launch\naws ec2 run-instances \\\n    --image-id ami-xxxxxxxxx \\\n    --instance-type t3.medium \\\n    --iam-instance-profile Name=polaris-ec2-instance-profile \\\n    --other-parameters...\n\n# If it's an existing EC2 instance, associate instance profile\naws ec2 associate-iam-instance-profile \\\n    --instance-id i-xxxxxxxxx \\\n    --iam-instance-profile Name=polaris-ec2-instance-profile\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"2-polaris-deployment-and-catalog-creation",children:"2. Polaris Deployment and Catalog Creation"}),"\n",(0,i.jsx)(n.p,{children:"After environment preparation is complete, we begin deploying the Polaris service and configuring the Catalog."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["This document uses the source code quick start method. For more deployment options, refer to: ",(0,i.jsx)(n.a,{href:"https://polaris.apache.org/releases/1.0.1/getting-started/deploying-polaris/",children:"https://polaris.apache.org/releases/1.0.1/getting-started/deploying-polaris/"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"21-clone-source-code-and-start-polaris",children:"2.1 Clone Source Code and Start Polaris"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Clone Polaris repository and switch to specific version"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/apache/polaris.git\ncd polaris\n# Recommend using a released stable version\ngit checkout apache-polaris-1.0.1-incubating\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Set AWS credentials (Optional)"}),"\n",(0,i.jsxs)(n.p,{children:["If you're not running Polaris on EC2, or the EC2 doesn't have the appropriate IAM Role bound, you need to provide Polaris with an AK/SK that has permission to assume the ",(0,i.jsx)(n.code,{children:"polaris-doris-demo"})," role through environment variables."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export AWS_ACCESS_KEY_ID=YOUR_AWS_ACCESS_KEY_ID\nexport AWS_SECRET_ACCESS_KEY=YOUR_AWS_SECRET_ACCESS_KEY\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Compile and run Polaris"}),"\n",(0,i.jsx)(n.p,{children:"Ensure you have Java 21+ and Docker 27+ installed."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./gradlew run -Dpolaris.bootstrap.credentials=POLARIS,root,secret\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POLARIS"})," is the realm"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"root"})," is the ",(0,i.jsx)(n.code,{children:"CLIENT_ID"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"secret"})," is the ",(0,i.jsx)(n.code,{children:"CLIENT_SECRET"})]}),"\n",(0,i.jsxs)(n.li,{children:["If credentials are not set, it will use preset credentials ",(0,i.jsx)(n.code,{children:"POLARIS,root,s3cr3t"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This command will start the Polaris service, listening on port ",(0,i.jsx)(n.code,{children:"8181"})," by default."]}),"\n",(0,i.jsx)(n.h3,{id:"22-create-catalog-and-namespace-in-polaris",children:"2.2 Create Catalog and Namespace in Polaris"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Export ROOT credentials"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export CLIENT_ID=root\nexport CLIENT_SECRET=secret\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create Catalog (pointing to S3 storage)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./polaris catalogs create \\\n--storage-type s3 \\\n--default-base-location s3://polaris-doris-test/polaris1 \\\n--role-arn arn:aws:iam::<account_id>:role/polaris-doris-test \\\n--external-id polaris-doris-test \\\ndoris_catalog\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--storage-type s3"}),": Specifies underlying storage as S3."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--default-base-location"}),": Default root path for Iceberg table data."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--role-arn"}),": IAM Role used by Polaris service to assume for S3 access."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--external-id"}),": External ID used when assuming the role, consistent with the configuration in the IAM Role trust policy."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create Namespace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./polaris namespaces create --catalog doris_catalog doris_demo\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This creates a database (Namespace) named ",(0,i.jsx)(n.code,{children:"doris_demo"})," under ",(0,i.jsx)(n.code,{children:"doris_catalog"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"23-polaris-security-role-and-permission-configuration",children:"2.3 Polaris Security Role and Permission Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["To allow Doris to access as a non-",(0,i.jsx)(n.code,{children:"root"})," user, we need to create a new user and role, and grant appropriate permissions."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create Principal Role and Catalog Role"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Create a Principal Role for aggregating permissions\n./polaris principal-roles create doris_pr_role\n\n# Create a Catalog Role under doris_catalog\n./polaris catalog-roles create --catalog doris_catalog doris_catalog_role\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Grant permissions to Catalog Role"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Grant doris_catalog_role permission to manage content within this Catalog\n./polaris privileges catalog grant \\\n    --catalog doris_catalog \\\n    --catalog-role doris_catalog_role \\\n    CATALOG_MANAGE_CONTENT\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Associate Principal Role and Catalog Role"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Assign doris_catalog_role to doris_pr_role\n./polaris catalog-roles grant \\\n--catalog doris_catalog \\\n--principal-role doris_pr_role \\\ndoris_catalog_role\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create new Principal (user) and bind Role"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Create a new user (Principal) named doris_user\n./polaris principals create doris_user\n# Example output: {"clientId": "6e155b128dc06c13", "clientSecret": "ce9fbb4cc91c43ff2955f2c6545239d7"}\n# Please note down this new client_id and client_secret pair, as Doris will use it for connection.\n\n# Bind doris_user to doris_pr_role\n./polaris principal-roles grant \\\ndoris_pr_role \\\n--principal doris_user\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["At this point, all Polaris-side configuration is complete. We have created a user named ",(0,i.jsx)(n.code,{children:"doris_user"})," that obtains permission to manage ",(0,i.jsx)(n.code,{children:"doris_catalog"})," through ",(0,i.jsx)(n.code,{children:"doris_pr_role"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"3-doris-connection-to-polaris",children:"3. Doris Connection to Polaris"}),"\n",(0,i.jsx)(n.p,{children:"Now, we will create an Iceberg Catalog in Doris that connects to the newly configured Polaris service. Doris supports multiple flexible authentication combinations."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," In this example, we use OAuth2 authentication credentials to connect to Polaris's rest service. Additionally, Doris also supports using ",(0,i.jsx)(n.code,{children:"iceberg.rest.oauth2.token"})," to directly provide a pre-obtained Bearer Token."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"method-1-oauth2--temporary-storage-credentials-credential-vending",children:"Method 1: OAuth2 + Temporary Storage Credentials (Credential Vending)"}),"\n",(0,i.jsxs)(n.p,{children:["This is the ",(0,i.jsx)(n.strong,{children:"most recommended"})," approach. Doris uses OAuth2 credentials to authenticate with Polaris and obtain metadata. When needing to read/write data files on S3, Doris requests a temporary, minimally-privileged S3 access credential from Polaris."]}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"clientId"})," and ",(0,i.jsx)(n.code,{children:"clientSecret"})," generated for ",(0,i.jsx)(n.code,{children:"doris_user"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG polaris_vended PROPERTIES (\n    'type' = 'iceberg',\n    -- Catalog name in Polaris\n    'warehouse' = 'doris_catalog',\n    'iceberg.catalog.type' = 'rest',\n    -- Polaris service address\n    'iceberg.rest.uri' = 'http://YOUR_POLARIS_HOST:8181/api/catalog',\n    -- Metadata authentication method\n    'iceberg.rest.security.type' = 'oauth2',\n    -- Replace with doris_user's client_id:client_secret\n    'iceberg.rest.oauth2.credential' = 'client_id:client_secret',\n    'iceberg.rest.oauth2.server-uri' = 'http://YOUR_POLARIS_HOST:8181/api/catalog/v1/oauth/tokens',\n    'iceberg.rest.oauth2.scope' = 'PRINCIPAL_ROLE:doris_pr_role',\n    -- Enable credential vending\n    'iceberg.rest.vended-credentials-enabled' = 'true'\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"method-2-oauth2--static-storage-credentials-aksk",children:"Method 2: OAuth2 + Static Storage Credentials (AK/SK)"}),"\n",(0,i.jsx)(n.p,{children:"In this approach, Doris still uses OAuth2 to access Polaris metadata, but when accessing S3 data, it uses static AK/SK hardcoded in the Doris Catalog configuration. This method is simple to configure and suitable for quick testing, but has lower security."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG polaris_aksk PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://YOUR_POLARIS_HOST:8181/api/catalog',\n    'iceberg.rest.warehouse' = 'doris_catalog',\n    'iceberg.rest.security.type' = 'oauth2',\n    'iceberg.rest.oauth2.credential' = '6e155b128dc06c13:ce9fbb4cc91c43ff2955f2c6545239d7',\n    'iceberg.rest.oauth2.server-uri' = 'http://YOUR_POLARIS_HOST:8181/api/catalog/v1/oauth/tokens',\n    'iceberg.rest.oauth2.scope' = 'PRINCIPAL_ROLE:doris_pr_role',\n    -- Directly provide S3 access keys\n    's3.access_key' = 'YOUR_S3_ACCESS_KEY',\n    's3.secret_key' = 'YOUR_S3_SECRET_KEY',\n    's3.endpoint' = 'https://s3.us-west-2.amazonaws.com',\n    's3.region' = 'us-west-2'\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"4-verify-connection-in-doris",children:"4. Verify Connection in Doris"}),"\n",(0,i.jsx)(n.p,{children:"Regardless of which method you used to create the Catalog, you can verify end-to-end connectivity through the following SQL."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Switch to the Catalog you created and the Namespace configured in Polaris\nUSE polaris_vended.doris_demo;\n\n-- Create an Iceberg table\nCREATE TABLE my_iceberg_table (\n  id INT,\n  name STRING\n)\nPROPERTIES (\n  'write-format'='parquet'\n);\n\n-- Insert data\nINSERT INTO my_iceberg_table VALUES (1, 'Doris'), (2, 'Polaris');\n\n-- Query data\nSELECT * FROM my_iceberg_table;\n-- Expected result:\n-- +------+---------+\n-- | id   | name    |\n-- +------+---------+\n-- | 1    | Doris   |\n-- | 2    | Polaris |\n-- +------+---------+\n"})}),"\n",(0,i.jsx)(n.p,{children:"If all the above operations can be completed successfully, congratulations! You have successfully established the complete data lake pipeline: Doris -> Polaris -> S3."}),"\n",(0,i.jsx)(n.p,{children:"For more information on using Doris to manage Iceberg tables, please visit:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://doris.apache.org/docs/lakehouse/catalogs/iceberg-catalog",children:"https://doris.apache.org/docs/lakehouse/catalogs/iceberg-catalog"})})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return t},a:function(){return o}});var a=s(667294);let i={},r=a.createContext(i);function o(e){let n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);