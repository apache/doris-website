"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["317192"],{547730:function(e,s,n){n.r(s),n.d(s,{default:()=>h,frontMatter:()=>a,metadata:()=>t,assets:()=>o,toc:()=>d,contentTitle:()=>l});var t=JSON.parse('{"id":"admin-manual/auth/authentication/internal","title":"Built-in Authentication","description":"Key Concepts","source":"@site/versioned_docs/version-3.x/admin-manual/auth/authentication/internal.md","sourceDirName":"admin-manual/auth/authentication","slug":"/admin-manual/auth/authentication/internal","permalink":"/docs/3.x/admin-manual/auth/authentication/internal","draft":false,"unlisted":false,"tags":[],"version":"3.x","frontMatter":{"title":"Built-in Authentication","language":"en"},"sidebar":"docs","previous":{"title":"Authentication and Authorization","permalink":"/docs/3.x/admin-manual/auth/authentication-and-authorization"},"next":{"title":"federation","permalink":"/docs/3.x/admin-manual/auth/authentication/federation"}}'),i=n("785893"),r=n("250065");let a={title:"Built-in Authentication",language:"en"},l=void 0,o={},d=[{value:"Key Concepts",id:"key-concepts",level:2},{value:"Users",id:"users",level:3},{value:"User Attributes",id:"user-attributes",level:4},{value:"Built-in Users",id:"built-in-users",level:4},{value:"Password",id:"password",level:3},{value:"Password Policies",id:"password-policies",level:4},{value:"Authentication Mechanism",id:"authentication-mechanism",level:2},{value:"Blacklist and Whitelist",id:"blacklist-and-whitelist",level:2},{value:"Related Commands",id:"related-commands",level:2},{value:"Other Notes",id:"other-notes",level:2}];function c(e){let s={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,i.jsx)(s.h3,{id:"users",children:"Users"}),"\n",(0,i.jsx)(s.p,{children:"In Doris, a user_identity uniquely identifies a user. user_identity consists of two parts: user_name and host, where username is the user name. host identifies the host address where the user client connection is located. The host part can use % for fuzzy matching. If host is not specified, it defaults to '%', which means the user can connect to Doris from any host."}),"\n",(0,i.jsx)(s.h4,{id:"user-attributes",children:"User Attributes"}),"\n",(0,i.jsx)(s.p,{children:"User attributes are directly attached to user_name, not user_identity. This means user@'192.%' and user@['domain'] both have the same set of user attributes. These attributes belong to user, not to user@'192.%' or user@['domain']."}),"\n",(0,i.jsx)(s.p,{children:"User attributes include but are not limited to: maximum user connections, import cluster configuration, etc."}),"\n",(0,i.jsx)(s.h4,{id:"built-in-users",children:"Built-in Users"}),"\n",(0,i.jsx)(s.p,{children:"Built-in users are users created by default in Doris and have certain default permissions, including root and admin. The initial passwords are empty. After FE starts, you can modify them using the password change command. Built-in users cannot be deleted."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"root@'%': root user, allowed to log in from any node, with operator role."}),"\n",(0,i.jsx)(s.li,{children:"admin@'%': admin user, allowed to log in from any node, with admin role."}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"password",children:"Password"}),"\n",(0,i.jsx)(s.p,{children:"User login credentials, set by administrators when creating users, or can be changed by users themselves after creation."}),"\n",(0,i.jsx)(s.h4,{id:"password-policies",children:"Password Policies"}),"\n",(0,i.jsx)(s.p,{children:"Doris supports the following password policies to help users better manage passwords."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"PASSWORD_HISTORY"})}),"\n",(0,i.jsxs)(s.p,{children:["Whether to allow the current user to use historical passwords when resetting passwords. For example, ",(0,i.jsx)(s.code,{children:"PASSWORD_HISTORY"})," 10 means prohibiting the use of the last 10 passwords as new passwords. If set to ",(0,i.jsx)(s.code,{children:"PASSWORD_HISTORY DEFAULT"}),", it will use the value in the global variable ",(0,i.jsx)(s.code,{children:"password_history"}),". 0 means this feature is disabled. Default is 0."]}),"\n",(0,i.jsx)(s.p,{children:"Examples:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Set global variable: ",(0,i.jsx)(s.code,{children:"SET GLOBAL password_history = 10"})]}),"\n",(0,i.jsxs)(s.li,{children:["Set for user: ",(0,i.jsx)(s.code,{children:"ALTER USER user1@'ip' PASSWORD_HISTORY 10"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"PASSWORD_EXPIRE"})}),"\n",(0,i.jsxs)(s.p,{children:["Set the expiration time for the current user's password. For example, ",(0,i.jsx)(s.code,{children:"PASSWORD_EXPIRE INTERVAL 10 DAY"})," means the password will expire in 10 days. ",(0,i.jsx)(s.code,{children:"PASSWORD_EXPIRE NEVER"})," means the password never expires. If set to ",(0,i.jsx)(s.code,{children:"PASSWORD_EXPIRE DEFAULT"}),", it will use the value in the global variable ",(0,i.jsx)(s.code,{children:"default_password_lifetime"})," (in days). Default is NEVER (or 0), meaning it will not expire."]}),"\n",(0,i.jsx)(s.p,{children:"Examples:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Set global variable: ",(0,i.jsx)(s.code,{children:"SET GLOBAL default_password_lifetime = 1"})]}),"\n",(0,i.jsxs)(s.li,{children:["Set for user: ",(0,i.jsx)(s.code,{children:"ALTER USER user1@'ip' PASSWORD_EXPIRE INTERVAL 10 DAY"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"FAILED_LOGIN_ATTEMPTS"})," and ",(0,i.jsx)(s.code,{children:"PASSWORD_LOCK_TIME"})]}),"\n",(0,i.jsxs)(s.p,{children:["Set that when the current user logs in with wrong password n times, the account will be locked and set a lock time. For example, ",(0,i.jsx)(s.code,{children:"FAILED_LOGIN_ATTEMPTS 3 PASSWORD_LOCK_TIME 1 DAY"})," means if there are 3 wrong logins, the account will be locked for one day. Administrators can actively unlock locked accounts through ALTER USER statements."]}),"\n",(0,i.jsx)(s.p,{children:"Examples:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Set for user: ",(0,i.jsx)(s.code,{children:"ALTER USER user1@'ip' FAILED_LOGIN_ATTEMPTS 3 PASSWORD_LOCK_TIME 1 DAY"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Password Strength"}),"\n",(0,i.jsxs)(s.p,{children:["This feature is controlled by the global variable ",(0,i.jsx)(s.code,{children:"validate_password_policy"}),'. Default is NONE/0, meaning password strength is not checked. If set to STRONG/2, the password must contain 3 of the following: "uppercase letters", "lowercase letters", "numbers", and "special characters", and the length must be greater than or equal to 8.']}),"\n",(0,i.jsx)(s.p,{children:"Examples:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"SET validate_password_policy=STRONG"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"After setting the above policies, you can view them with the following command:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"SHOW PROC \"/auth/'<user>'@'<host>'\";\n"})}),"\n",(0,i.jsx)(s.p,{children:"Note that you need to wrap the user and host parts with single quotes separately. For example:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"SHOW PROC \"/auth/'root'@'%'\";\nSHOW PROC \"/auth/'user1'@'127.0.0.1'\";\n"})}),"\n",(0,i.jsx)(s.h2,{id:"authentication-mechanism",children:"Authentication Mechanism"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Client authentication information sending: The client packages and sends user information (such as username, password, database, etc.) to the Doris server. This information is used to prove the client's identity and request access to the database."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Server authentication: After Doris receives the client's authentication information, it performs verification. If the username, password, and client IP are correct, and the user has permission to access the selected database, authentication succeeds, and Doris will map the user individual to the User Identity in the system. Otherwise, authentication fails and returns the corresponding error message to the client."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"blacklist-and-whitelist",children:"Blacklist and Whitelist"}),"\n",(0,i.jsxs)(s.p,{children:["Doris itself does not support blacklists, only whitelist functionality, but we can simulate blacklists in certain ways. Suppose we first created a user named ",(0,i.jsx)(s.code,{children:"user@'192.%'"}),", indicating that users from ",(0,i.jsx)(s.code,{children:"192.*"})," are allowed to log in. If we want to prohibit users from ",(0,i.jsx)(s.code,{children:"192.168.10.1"})," from logging in, we can create another user ",(0,i.jsx)(s.code,{children:"cmy@'192.168.10.1'"})," and set a new password. Because ",(0,i.jsx)(s.code,{children:"192.168.10.1"})," has higher priority than ",(0,i.jsx)(s.code,{children:"192.%"}),", users from ",(0,i.jsx)(s.code,{children:"192.168.10.1"})," will no longer be able to log in using the old password."]}),"\n",(0,i.jsx)(s.h2,{id:"related-commands",children:"Related Commands"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Create user: ",(0,i.jsx)(s.a,{href:"../../../sql-manual/sql-statements/account-management/CREATE-USER",children:"CREATE USER"})]}),"\n",(0,i.jsxs)(s.li,{children:["View users: ",(0,i.jsx)(s.a,{href:"../../../sql-manual/sql-statements/account-management/SHOW-GRANTS",children:"SHOW ALL GRANTS"})]}),"\n",(0,i.jsxs)(s.li,{children:["Modify user: ",(0,i.jsx)(s.a,{href:"../../../sql-manual/sql-statements/account-management/ALTER-USER",children:"ALTER USER"})]}),"\n",(0,i.jsxs)(s.li,{children:["Change password: ",(0,i.jsx)(s.a,{href:"../../../sql-manual/sql-statements/account-management/SET-PASSWORD",children:"SET PASSWORD"})]}),"\n",(0,i.jsxs)(s.li,{children:["Delete user: ",(0,i.jsx)(s.a,{href:"../../../sql-manual/sql-statements/account-management/DROP-USER",children:"DROP USER"})]}),"\n",(0,i.jsxs)(s.li,{children:["Set user attributes: ",(0,i.jsx)(s.a,{href:"../../../sql-manual/sql-statements/account-management/SET-PROPERTY",children:"SET PROPERTY"})]}),"\n",(0,i.jsxs)(s.li,{children:["View user attributes: ",(0,i.jsx)(s.a,{href:"../../../sql-manual/sql-statements/account-management/SHOW-PROPERTY",children:"SHOW PROPERTY"})]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"other-notes",children:"Other Notes"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Priority selection of user_identity during login"}),"\n",(0,i.jsxs)(s.p,{children:["As mentioned above, ",(0,i.jsx)(s.code,{children:"user_identity"})," consists of ",(0,i.jsx)(s.code,{children:"user_name"})," and ",(0,i.jsx)(s.code,{children:"host"}),", but when users log in, they only need to input ",(0,i.jsx)(s.code,{children:"user_name"}),", so Doris matches the corresponding ",(0,i.jsx)(s.code,{children:"host"})," based on the client's IP to determine which ",(0,i.jsx)(s.code,{children:"user_identity"})," to use for login."]}),"\n",(0,i.jsxs)(s.p,{children:["If only one ",(0,i.jsx)(s.code,{children:"user_identity"})," can be matched based on the client IP, then this ",(0,i.jsx)(s.code,{children:"user_identity"})," will undoubtedly be matched. However, when multiple ",(0,i.jsx)(s.code,{children:"user_identity"})," can be matched, there will be the following priority issues."]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Priority between domain and IP:"}),"\n",(0,i.jsx)(s.p,{children:"Suppose the following users were created:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"CREATE USER user1@['domain1'] IDENTIFIED BY \"12345\";\nCREATE USER user1@'ip1'IDENTIFIED BY \"abcde\";\n"})}),"\n",(0,i.jsx)(s.p,{children:"domain1 is resolved to two IPs: ip1 and ip2."}),"\n",(0,i.jsx)(s.p,{children:"In terms of priority, IP takes precedence over domain, so when user user1 tries to log in to Doris from ip1 using password '12345', it will be rejected."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Priority between specific IP and IP range:"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Suppose the following users were created:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"CREATE USER user1@'%' IDENTIFIED BY \"12345\";\nCREATE USER user1@'192.%' IDENTIFIED BY \"abcde\";\n"})}),"\n",(0,i.jsx)(s.p,{children:"In terms of priority, '192.%' takes precedence over '%', so when user user1 tries to log in to Doris from 192.168.1.1 using password '12345', it will be rejected."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Forgot password"}),"\n",(0,i.jsx)(s.p,{children:"If you forget your password and cannot log in to Doris, you can add the skip_localhost_auth_check=true parameter in the FE config file and restart FE, so you can log in to Doris as root on the FE local machine without a password."}),"\n",(0,i.jsx)(s.p,{children:"After logging in, you can reset the password using the SET PASSWORD command."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"No user can reset the root user's password except the root user itself."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"current_user()"})," and ",(0,i.jsx)(s.code,{children:"user()"})]}),"\n",(0,i.jsxs)(s.p,{children:["Users can view ",(0,i.jsx)(s.code,{children:"current_user"})," and ",(0,i.jsx)(s.code,{children:"user"})," through ",(0,i.jsx)(s.code,{children:"SELECT current_user()"})," and ",(0,i.jsx)(s.code,{children:"SELECT user()"})," respectively. ",(0,i.jsx)(s.code,{children:"current_user"})," represents the identity through which the current user passed the authentication system, while ",(0,i.jsx)(s.code,{children:"user"})," is the user's actual User Identity."]}),"\n",(0,i.jsx)(s.p,{children:"Example:"}),"\n",(0,i.jsxs)(s.p,{children:["Suppose we created the user ",(0,i.jsx)(s.code,{children:"user1@'192.%'"}),", then user ",(0,i.jsx)(s.code,{children:"user1"})," from ",(0,i.jsx)(s.code,{children:"192.168.10.1"})," logged into the system. In this case, ",(0,i.jsx)(s.code,{children:"current_user"})," would be ",(0,i.jsx)(s.code,{children:"user1@'192.%'"}),", while ",(0,i.jsx)(s.code,{children:"user"})," would be ",(0,i.jsx)(s.code,{children:"user1@'192.168.10.1'"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["All permissions are granted to a specific ",(0,i.jsx)(s.code,{children:"current_user"}),", and the actual user has all the permissions of the corresponding ",(0,i.jsx)(s.code,{children:"current_user"}),"."]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},250065:function(e,s,n){n.d(s,{Z:function(){return l},a:function(){return a}});var t=n(667294);let i={},r=t.createContext(i);function a(e){let s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);