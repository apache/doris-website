"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["610971"],{319454:function(e,n,i){i.r(n),i.d(n,{default:()=>g,frontMatter:()=>s,metadata:()=>r,assets:()=>c,toc:()=>l,contentTitle:()=>o});var r=JSON.parse('{"id":"lakehouse/best-practices/doris-gravitino","title":"Integration with Apache Gravitino","description":"With the rapid development of data lake technology, building a unified, secure,","source":"@site/versioned_docs/version-4.x/lakehouse/best-practices/doris-gravitino.md","sourceDirName":"lakehouse/best-practices","slug":"/lakehouse/best-practices/doris-gravitino","permalink":"/docs/4.x/lakehouse/best-practices/doris-gravitino","draft":false,"unlisted":false,"tags":[],"version":"4.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Integration with Apache Gravitino","language":"en","description":"With the rapid development of data lake technology, building a unified, secure,"},"sidebar":"docs","previous":{"title":"Integration with Apache Polaris","permalink":"/docs/4.x/lakehouse/best-practices/doris-polaris"},"next":{"title":"Integration with Microsoft OneLake","permalink":"/docs/4.x/lakehouse/best-practices/doris-onelake"}}'),a=i("785893"),t=i("250065");let s={title:"Integration with Apache Gravitino",language:"en",description:"With the rapid development of data lake technology, building a unified, secure,"},o=void 0,c={},l=[{value:"Hands-on Guide",id:"hands-on-guide",level:2},{value:"1. AWS Environment Preparation",id:"1-aws-environment-preparation",level:3},{value:"1.1 Create S3 Bucket",id:"11-create-s3-bucket",level:3},{value:"1.2 Design IAM Role Architecture",id:"12-design-iam-role-architecture",level:3},{value:"2. Gravitino Deployment and Configuration",id:"2-gravitino-deployment-and-configuration",level:2},{value:"2.1 Download and Install Gravitino",id:"21-download-and-install-gravitino",level:3},{value:"2.2 Install Required Dependencies",id:"22-install-required-dependencies",level:3},{value:"2.3 Configure Gravitino Service",id:"23-configure-gravitino-service",level:3},{value:"2.4 Create Gravitino Metadata Structure",id:"24-create-gravitino-metadata-structure",level:3},{value:"3. Doris Connection to Gravitino",id:"3-doris-connection-to-gravitino",level:2},{value:"3.1 Using Vended Credentials",id:"31-using-vended-credentials",level:3},{value:"3.2 Verify Connection and Data Operations",id:"32-verify-connection-and-data-operations",level:3},{value:"Summary",id:"summary",level:2}];function d(e){let n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"With the rapid development of data lake technology, building a unified, secure, and efficient lakehouse architecture has become a core challenge in enterprise digital transformation. Apache Gravitino, as a next-generation unified metadata management platform, provides a complete solution for data governance in multi-cloud and multi-engine environments. It not only supports unified management of various data sources and compute engines but also ensures security and controllability of data access through credential vending mechanisms."}),"\n",(0,a.jsx)(n.p,{children:"This article will provide an in-depth introduction to how to deeply integrate Apache Doris with Apache Gravitino to build a modern lakehouse architecture based on Iceberg REST Catalog. Through Gravitino's unified metadata management and dynamic credential distribution capabilities, we can achieve efficient and secure access to Iceberg data on S3."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Through this document, you will quickly understand:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"AWS Environment Preparation"}),": How to create S3 buckets and IAM roles in AWS, configure a secure credential management system for Gravitino, and implement dynamic distribution of temporary credentials."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Gravitino Deployment and Configuration"}),": How to quickly deploy Gravitino services, configure Iceberg REST Catalog, and enable vended-credentials functionality."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Doris Connection to Gravitino"}),": Detailed explanation of how Doris accesses Iceberg data through Gravitino's REST API."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"hands-on-guide",children:"Hands-on Guide"}),"\n",(0,a.jsx)(n.h3,{id:"1-aws-environment-preparation",children:"1. AWS Environment Preparation"}),"\n",(0,a.jsx)(n.p,{children:"Before we begin, we need to prepare a complete infrastructure on AWS, including S3 buckets and a carefully designed IAM role system, which is the foundation for building a secure and reliable lakehouse architecture."}),"\n",(0,a.jsx)(n.h3,{id:"11-create-s3-bucket",children:"1.1 Create S3 Bucket"}),"\n",(0,a.jsx)(n.p,{children:"First, create a dedicated S3 bucket to store Iceberg data:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Create S3 bucket\naws s3 mb s3://gravitino-iceberg-demo --region us-west-2\n# Verify bucket creation success\naws s3 ls | grep gravitino-iceberg-demo\n"})}),"\n",(0,a.jsx)(n.h3,{id:"12-design-iam-role-architecture",children:"1.2 Design IAM Role Architecture"}),"\n",(0,a.jsx)(n.p,{children:"To implement secure credential management, we need to create an IAM role for Gravitino to use through the STS AssumeRole mechanism. This design follows security best practices of least privilege and separation of duties."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Create Data Access Role"})}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create Trust Policy File"}),"\n",(0,a.jsxs)(n.p,{children:["Create the ",(0,a.jsx)(n.code,{children:"gravitino-trust-policy.json"})," file:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Principal": {\n                "AWS": [\n                    "arn:aws:iam::YOUR_ACCOUNT_ID:root"\n                ]\n            },\n            "Action": "sts:AssumeRole"\n        }\n    ]\n}\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create IAM Role"}),"\n",(0,a.jsx)(n.p,{children:"For demonstration simplicity, we'll use AWS managed policies directly. Production environments should use more fine-grained permission controls."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Create IAM role\naws iam create-role \\\n    --role-name gravitino-iceberg-access \\\n    --assume-role-policy-document file://gravitino-trust-policy.json \\\n    --description "Gravitino Iceberg data access role"\n\n# Attach S3 full access permissions (for testing, use fine-grained permissions in production)\naws iam attach-role-policy \\\n    --role-name gravitino-iceberg-access \\\n    --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Verify IAM Configuration"}),"\n",(0,a.jsx)(n.p,{children:"Verify that the role configuration is correct:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Test role assumption functionality\naws sts assume-role \\\n    --role-arn arn:aws:iam::YOUR_ACCOUNT_ID:role/gravitino-iceberg-access \\\n    --role-session-name gravitino-test\n"})}),"\n",(0,a.jsx)(n.p,{children:"Successful response example:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n    "Credentials": {\n        "AccessKeyId": "ASIA***************",\n        "SecretAccessKey": "***************************",\n        "SessionToken": "IQoJb3JpZ2luX2VjEOj...",\n        "Expiration": "2025-07-23T08:33:30+00:00"\n    }\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"2-gravitino-deployment-and-configuration",children:"2. Gravitino Deployment and Configuration"}),"\n",(0,a.jsx)(n.h3,{id:"21-download-and-install-gravitino",children:"2.1 Download and Install Gravitino"}),"\n",(0,a.jsx)(n.p,{children:"We'll use Gravitino's pre-compiled version to quickly set up the environment:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Create working directory\nmkdir gravitino-deployment && cd gravitino-deployment\n\n# Download Gravitino main program\nwget https://github.com/apache/gravitino/releases/download/v0.9.1/gravitino-0.9.1-bin.tar.gz\n\n# Download Iceberg REST server component\nwget https://github.com/apache/gravitino/releases/download/v0.9.1/gravitino-iceberg-rest-server-0.9.1-bin.tar.gz\n\n# Extract and install\ntar -xzf gravitino-0.9.1-bin.tar.gz\ncd gravitino-0.9.1-bin\ntar -xzf ../gravitino-iceberg-rest-server-0.9.1-bin.tar.gz --strip-components=1\n"})}),"\n",(0,a.jsx)(n.h3,{id:"22-install-required-dependencies",children:"2.2 Install Required Dependencies"}),"\n",(0,a.jsx)(n.p,{children:"To support AWS S3 and credential management functionality, additional JAR packages need to be installed:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Create necessary directory structure\nmkdir -p catalogs/lakehouse-iceberg/libs\nmkdir -p iceberg-rest-server/libs\nmkdir -p logs\nmkdir -p /tmp/gravitino\n\n# Download Iceberg AWS bundle\nwget https://repo1.maven.org/maven2/org/apache/iceberg/iceberg-aws-bundle/1.6.1/iceberg-aws-bundle-1.6.1.jar \\\n  -P catalogs/lakehouse-iceberg/libs/\n\n# Download Gravitino AWS support package (core for vended-credentials functionality)\nwget https://repo1.maven.org/maven2/org/apache/gravitino/gravitino-aws/0.9.1/gravitino-aws-0.9.1.jar \\\n  -P iceberg-rest-server/libs/\n\n# Distribute JAR packages to various directories\ncp catalogs/lakehouse-iceberg/libs/iceberg-aws-bundle-1.6.1.jar iceberg-rest-server/libs/\ncp catalogs/lakehouse-iceberg/libs/iceberg-aws-bundle-1.6.1.jar libs/\ncp iceberg-rest-server/libs/gravitino-aws-0.9.1.jar libs/\n"})}),"\n",(0,a.jsx)(n.h3,{id:"23-configure-gravitino-service",children:"2.3 Configure Gravitino Service"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Main Service Configuration"}),"\n",(0,a.jsxs)(n.p,{children:["Create or edit the ",(0,a.jsx)(n.code,{children:"conf/gravitino.conf"})," file:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-properties",children:"# Gravitino server basic configuration\ngravitino.server.webserver.host = 0.0.0.0\ngravitino.server.webserver.httpPort = 8090\n\n# Metadata store configuration (PostgreSQL/MySQL recommended for production)\ngravitino.entity.store = relational\ngravitino.entity.store.relational = JDBCBackend\ngravitino.entity.store.relational.jdbcUrl = jdbc:h2:file:/tmp/gravitino/gravitino.db;DB_CLOSE_DELAY=-1;MODE=MYSQL\ngravitino.entity.store.relational.jdbcDriver = org.h2.Driver\ngravitino.entity.store.relational.jdbcUser = gravitino\ngravitino.entity.store.relational.jdbcPassword = gravitino\n\n# Enable Iceberg REST service\ngravitino.auxService.names = iceberg-rest\n\n# Iceberg REST service detailed configuration\ngravitino.iceberg-rest.classpath = iceberg-rest-server/libs, iceberg-rest-server/conf\ngravitino.iceberg-rest.host = 0.0.0.0\ngravitino.iceberg-rest.httpPort = 9001\n\n# Iceberg catalog backend configuration\ngravitino.iceberg-rest.catalog-backend = jdbc\ngravitino.iceberg-rest.uri = jdbc:h2:file:/tmp/gravitino/catalog_iceberg.db;DB_CLOSE_DELAY=-1;MODE=MYSQL\ngravitino.iceberg-rest.jdbc-driver = org.h2.Driver\ngravitino.iceberg-rest.jdbc-user = iceberg\ngravitino.iceberg-rest.jdbc-password = iceberg123\ngravitino.iceberg-rest.jdbc-initialize = true\ngravitino.iceberg-rest.warehouse = s3://gravitino-iceberg-demo/warehouse\ngravitino.iceberg-rest.io-impl = org.apache.iceberg.aws.s3.S3FileIO\ngravitino.iceberg-rest.s3-region = us-west-2\n\n# Enable Vended-Credentials functionality\n# Note: Gravitino uses these AK/SK to call STS AssumeRole and obtain temporary credentials for distribution to clients\ngravitino.iceberg-rest.credential-providers = s3-token\ngravitino.iceberg-rest.s3-access-key-id = YOUR_AWS_ACCESS_KEY_ID\ngravitino.iceberg-rest.s3-secret-access-key = YOUR_AWS_SECRET_ACCESS_KEY\ngravitino.iceberg-rest.s3-role-arn = arn:aws:iam::YOUR_ACCOUNT_ID:role/gravitino-iceberg-access\ngravitino.iceberg-rest.s3-region = us-west-2\ngravitino.iceberg-rest.s3-token-expire-in-secs = 3600\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Start Service"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Start Gravitino service\n./bin/gravitino.sh start\n\n# Check service status\n./bin/gravitino.sh status\n\n# View logs\ntail -f logs/gravitino-server.log\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Verify Service Status"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Verify main service\ncurl -v http://localhost:8090/api/version\n\n# Verify Iceberg REST service\ncurl -v http://localhost:9001/iceberg/v1/config\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"24-create-gravitino-metadata-structure",children:"2.4 Create Gravitino Metadata Structure"}),"\n",(0,a.jsx)(n.p,{children:"Create necessary metadata structures through REST API:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Create MetaLake\ncurl -X POST -H "Accept: application/vnd.gravitino.v1+json" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "name": "lakehouse",\n    "comment": "Gravitino lakehouse for Doris integration",\n    "properties": {}\n  }\' http://localhost:8090/api/metalakes\n\n# Create Iceberg Catalog\ncurl -X POST -H "Accept: application/vnd.gravitino.v1+json" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "name": "iceberg_catalog",\n    "type": "RELATIONAL",\n    "provider": "lakehouse-iceberg",\n    "comment": "Iceberg catalog with S3 storage and vended credentials",\n    "properties": {\n      "catalog-backend": "jdbc",\n      "uri": "jdbc:h2:file:/tmp/gravitino/catalog_iceberg.db;DB_CLOSE_DELAY=-1;MODE=MYSQL",\n      "jdbc-user": "iceberg",\n      "jdbc-password": "iceberg123",\n      "jdbc-driver": "org.h2.Driver",\n      "jdbc-initialize": "true",\n      "warehouse": "s3://gravitino-iceberg-demo/warehouse",\n      "io-impl": "org.apache.iceberg.aws.s3.S3FileIO",\n      "s3-region": "us-west-2"\n    }\n  }\' http://localhost:8090/api/metalakes/lakehouse/catalogs\n'})}),"\n",(0,a.jsx)(n.h2,{id:"3-doris-connection-to-gravitino",children:"3. Doris Connection to Gravitino"}),"\n",(0,a.jsx)(n.h3,{id:"31-using-vended-credentials",children:"3.1 Using Vended Credentials"}),"\n",(0,a.jsx)(n.p,{children:"Gravitino will dynamically generate and distribute temporary credentials to Doris:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- Create dynamic credential mode Catalog\nCREATE CATALOG gravitino_vending PROPERTIES (\n    'type' = 'iceberg',\n    'warehouse' = 'warehouse',\n    'iceberg.catalog.type' = 'rest',\n    'iceberg.rest.uri' = 'http://127.0.0.1:9001/iceberg/',\n    'iceberg.rest.vended-credentials-enabled' = 'true'\n);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"32-verify-connection-and-data-operations",children:"3.2 Verify Connection and Data Operations"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- Verify connection\nSHOW DATABASES FROM gravitino_vending;\n\n-- Switch to vended credentials catalog\nSWITCH gravitino_vending;\n\n-- Create database and table\nCREATE DATABASE demo;\nUSE gravitino_vending.demo;\n\nCREATE TABLE gravitino_table (\n    id INT,\n    name STRING\n)\nPROPERTIES (\n    'write-format' = 'parquet'\n);\n\n-- Insert test data\nINSERT INTO gravitino_table VALUES (1, 'Doris'), (2, 'Gravitino');\n\n-- Query verification\nSELECT * FROM gravitino_table;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(n.p,{children:"Through this guide, you should be able to successfully build a modern lakehouse architecture based on Gravitino and Doris. This architecture not only provides high performance and high availability but also ensures security and compliance of data access through advanced security mechanisms. As data scales grow and business requirements change, this architecture can flexibly scale to meet various enterprise-level needs."})]})}function g(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return o},a:function(){return s}});var r=i(667294);let a={},t=r.createContext(a);function s(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);