"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["649035"],{742628:function(e,a,t){t.r(a),t.d(a,{default:()=>u,frontMatter:()=>l,metadata:()=>n,assets:()=>o,toc:()=>d,contentTitle:()=>i});var n=JSON.parse('{"id":"compute-storage-decoupled/managing-storage-vault","title":"Managing Storage Vault","description":"The Storage Vault is a remote shared storage used by Doris in a decoupled storage-compute model.","source":"@site/versioned_docs/version-3.x/compute-storage-decoupled/managing-storage-vault.md","sourceDirName":"compute-storage-decoupled","slug":"/compute-storage-decoupled/managing-storage-vault","permalink":"/docs/3.x/compute-storage-decoupled/managing-storage-vault","draft":false,"unlisted":false,"tags":[],"version":"3.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Managing Storage Vault","language":"en","description":"The Storage Vault is a remote shared storage used by Doris in a decoupled storage-compute model."},"sidebar":"docs","previous":{"title":"Compilation and Deployment","permalink":"/docs/3.x/compute-storage-decoupled/compilation-and-deployment"},"next":{"title":"Managing Compute Groups","permalink":"/docs/3.x/compute-storage-decoupled/managing-compute-cluster"}}'),s=t("785893"),r=t("250065");let l={title:"Managing Storage Vault",language:"en",description:"The Storage Vault is a remote shared storage used by Doris in a decoupled storage-compute model."},i=void 0,o={},d=[{value:"Create an Storage Vault",id:"create-an-storage-vault",level:2},{value:"Create an HDFS Storage Vault",id:"create-an-hdfs-storage-vault",level:3},{value:"Create an S3 Storage Vault",id:"create-an-s3-storage-vault",level:3},{value:"View Storage Vaults",id:"view-storage-vaults",level:2},{value:"Set the Default Storage Vault",id:"set-the-default-storage-vault",level:2},{value:"Specify Storage Vault When Creating a Table",id:"specify-storage-vault-when-creating-a-table",level:2},{value:"Specify Storage Vault When Creating a Database",id:"specify-storage-vault-when-creating-a-database",level:2},{value:"Alter Storage Vault",id:"alter-storage-vault",level:2},{value:"Delete an Storage Vault",id:"delete-an-storage-vault",level:2},{value:"Storage Vault Privilege",id:"storage-vault-privilege",level:2},{value:"Granting",id:"granting",level:3},{value:"Revoking",id:"revoking",level:3},{value:"FAQ",id:"faq",level:2},{value:"Q1. \u5982\u4F55\u67E5\u8BE2\u7279\u5B9Astorage vault\u88AB\u90A3\u4E9B\u8868\u5F15\u7528\uFF1F",id:"q1-\u5982\u4F55\u67E5\u8BE2\u7279\u5B9Astorage-vault\u88AB\u90A3\u4E9B\u8868\u5F15\u7528",level:4}];function c(e){let a={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.p,{children:"The Storage Vault is a remote shared storage used by Doris in a decoupled storage-compute model. You can configure one or more Storage Vaults to store different tables in different Storage Vaults."}),"\n",(0,s.jsx)(a.h2,{id:"create-an-storage-vault",children:"Create an Storage Vault"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Syntax"})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:'CREATE STORAGE VAULT [IF NOT EXISTS] <vault_name>\nPROPERTIES\n("key" = "value",...)\n'})}),"\n",(0,s.jsx)(a.p,{children:"<vault_name> is the user-defined name of the Storage Vault, which serves as the identifier for accessing the Storage Vault."}),"\n",(0,s.jsx)(a.h3,{id:"create-an-hdfs-storage-vault",children:"Create an HDFS Storage Vault"}),"\n",(0,s.jsx)(a.p,{children:"To create an HDFS-based decoupled storage-compute Doris cluster, ensure that all nodes (including FE/BE nodes, Meta Service) have privilege to access the specified HDFS, including completing Kerberos authorization configuration and connectivity checks in advance (which can be tested using Hadoop Client on each corresponding node)."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:'CREATE STORAGE VAULT IF NOT EXISTS hdfs_vault_demo\n    PROPERTIES (\n        "type"="hdfs",                                     -- required\n        "fs.defaultFS"="hdfs://127.0.0.1:8020",            -- required\n        "path_prefix"="big/data",                          -- optional, generally filled in according to business name\n        "hadoop.username"="user"                           -- optional\n        "hadoop.security.authentication"="kerberos"        -- optional\n        "hadoop.kerberos.principal"="hadoop/127.0.0.1@XXX" -- optional\n        "hadoop.kerberos.keytab"="/etc/emr.keytab"         -- optional\n    );\n'})}),"\n",(0,s.jsx)(a.h3,{id:"create-an-s3-storage-vault",children:"Create an S3 Storage Vault"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:'CREATE STORAGE VAULT IF NOT EXISTS s3_vault_demo\nPROPERTIES (\n    "type" = "S3",                                 -- required\n    "s3.endpoint" = "oss-cn-beijing.aliyuncs.com", -- required\n    "s3.region" = "cn-beijing",                    -- required\n    "s3.bucket" = "bucket",                        -- required\n    "s3.root.path" = "big/data/prefix",            -- required\n    "s3.access_key" = "ak",                        -- required\n    "s3.secret_key" = "sk",                        -- required\n    "provider" = "OSS",                            -- required\n    "use_path_style" = "false"                     -- optional\n);\n'})}),"\n",(0,s.jsxs)(a.p,{children:["More parameter explanations and examples can be found in ",(0,s.jsx)(a.a,{href:"/docs/3.x/sql-manual/sql-statements/cluster-management/storage-management/CREATE-STORAGE-VAULT",children:"CREATE-STORAGE-VAULT"}),"."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Note"}),"\nThe provided object storage path must have head/get/list/put/multipartUpload/delete access permissions."]}),"\n",(0,s.jsx)(a.h2,{id:"view-storage-vaults",children:"View Storage Vaults"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Syntax"})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"SHOW STORAGE VAULTS\n"})}),"\n",(0,s.jsx)(a.p,{children:"The returned result includes 4 columns: the Storage Vault name, Storage Vault ID, properties, and whether it is the default Storage Vault."}),"\n",(0,s.jsx)(a.h2,{id:"set-the-default-storage-vault",children:"Set the Default Storage Vault"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Syntax"})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:"SET <vault_name> AS DEFAULT STORAGE VAULT\n"})}),"\n",(0,s.jsx)(a.h2,{id:"specify-storage-vault-when-creating-a-table",children:"Specify Storage Vault When Creating a Table"}),"\n",(0,s.jsxs)(a.p,{children:["When creating a table, specify ",(0,s.jsx)(a.code,{children:"storage_vault_name"})," in ",(0,s.jsx)(a.code,{children:"PROPERTIES"}),", and the data will be stored in the Storage Vault corresponding to the specified ",(0,s.jsx)(a.code,{children:"vault name"}),". Once the table is successfully created, the ",(0,s.jsx)(a.code,{children:"storage_vault"})," cannot be modified, meaning changing the Storage Vault is not supported."]}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Example"})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:'CREATE TABLE IF NOT EXISTS supplier (\n  s_suppkey int(11) NOT NULL COMMENT "",\n  s_name varchar(26) NOT NULL COMMENT "",\n  s_address varchar(26) NOT NULL COMMENT "",\n  s_city varchar(11) NOT NULL COMMENT "",\n  s_nation varchar(16) NOT NULL COMMENT "",\n  s_region varchar(13) NOT NULL COMMENT "",\n  s_phone varchar(16) NOT NULL COMMENT ""\n)\nUNIQUE KEY (s_suppkey)\nDISTRIBUTED BY HASH(s_suppkey) BUCKETS 1\nPROPERTIES (\n"replication_num" = "1",\n"storage_vault_name" = "hdfs_demo_vault"\n);\n'})}),"\n",(0,s.jsx)(a.h2,{id:"specify-storage-vault-when-creating-a-database",children:"Specify Storage Vault When Creating a Database"}),"\n",(0,s.jsxs)(a.p,{children:["When creating a database, specify ",(0,s.jsx)(a.code,{children:"storage_vault_name"})," in ",(0,s.jsx)(a.code,{children:"PROPERTIES"}),". If ",(0,s.jsx)(a.code,{children:"storage_vault_name"})," is not specified when creating a table under the database, the table will use the Storage Vault corresponding to the database's ",(0,s.jsx)(a.code,{children:"vault name"})," for data storage. Users can change the ",(0,s.jsx)(a.code,{children:"storage_vault_name"})," of the database via ",(0,s.jsx)(a.a,{href:"/docs/3.x/sql-manual/sql-statements/database/ALTER-DATABASE",children:"ALTER-DATABASE"}),". However, this action will not affect the ",(0,s.jsx)(a.code,{children:"storage_vault"})," of tables that have already been created under the database, and only newly created tables will use the updated ",(0,s.jsx)(a.code,{children:"storage_vault"}),"."]}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Example"})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:'CREATE DATABASE IF NOT EXIST `db_test`\nPROPERTIES (\n    "storage_vault_name" = "hdfs_demo_vault"\n);\n'})}),"\n",(0,s.jsxs)(a.admonition,{title:"Note",type:"info",children:[(0,s.jsx)(a.p,{children:"This feature is supported since version 3.0.5."}),(0,s.jsx)(a.p,{children:"The priority order for using Storage Vault when creating a table is: Table -> Database -> Default Storage Vault. If Storage Vault is not specified in the table's PROPERTY, it will check if Storage Vault is specified in the database; if the database also does not specify it, it will further check if there is a default Storage Vault."}),(0,s.jsxs)(a.p,{children:["If the ",(0,s.jsx)(a.code,{children:"VAULT_NAME"})," attribute of Storage Vault is modified, it may cause the Storage Vault set in the database to become invalid, resulting in an error. Users will need to configure a valid ",(0,s.jsx)(a.code,{children:"storage_vault_name"})," for the database based on the actual situation."]})]}),"\n",(0,s.jsx)(a.h2,{id:"alter-storage-vault",children:"Alter Storage Vault"}),"\n",(0,s.jsx)(a.p,{children:"Used to alter modifiable properties of the Storage Vault configuration."}),"\n",(0,s.jsx)(a.p,{children:"S3 Storage Vault allowed properties:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:(0,s.jsx)(a.code,{children:"VAULT_NAME"})}),"\n",(0,s.jsx)(a.li,{children:(0,s.jsx)(a.code,{children:"s3.access_key"})}),"\n",(0,s.jsx)(a.li,{children:(0,s.jsx)(a.code,{children:"s3.secret_key"})}),"\n",(0,s.jsx)(a.li,{children:(0,s.jsx)(a.code,{children:"use_path_style"})}),"\n"]}),"\n",(0,s.jsx)(a.p,{children:"HDFS Storage Vault forbidden properties:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:(0,s.jsx)(a.code,{children:"path_prefix"})}),"\n",(0,s.jsx)(a.li,{children:(0,s.jsx)(a.code,{children:"fs.defaultFS"})}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:["Properties explanations can be found in ",(0,s.jsx)(a.a,{href:"/docs/3.x/sql-manual/sql-statements/cluster-management/storage-management/CREATE-STORAGE-VAULT",children:"CREATE-STORAGE-VAULT"}),"."]}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Example"})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:'ALTER STORAGE VAULT old_s3_vault\nPROPERTIES (\n    "type" = "S3",\n    "VAULT_NAME" = "new_s3_vault",\n    "s3.access_key" = "new_ak"\n    "s3.secret_key" = "new_sk"\n);\n'})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:'ALTER STORAGE VAULT old_hdfs_vault\nPROPERTIES (\n    "type" = "hdfs",\n    "VAULT_NAME" = "new_hdfs_vault",\n    "hadoop.username" = "hdfs"\n);\n'})}),"\n",(0,s.jsx)(a.h2,{id:"delete-an-storage-vault",children:"Delete an Storage Vault"}),"\n",(0,s.jsx)(a.p,{children:"Not supported"}),"\n",(0,s.jsx)(a.h2,{id:"storage-vault-privilege",children:"Storage Vault Privilege"}),"\n",(0,s.jsx)(a.p,{children:"Grant a specified MySQL user the usage privilege for a certain Storage Vault, allowing the user to specify that Storage Vault when creating tables or viewing Storage Vaults."}),"\n",(0,s.jsx)(a.h3,{id:"granting",children:"Granting"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:"GRANT\n    USAGE_PRIV\n    ON STORAGE VAULT <vault_name>\n    TO { ROLE | USER } {<role> | <user>}\n"})}),"\n",(0,s.jsxs)(a.p,{children:["Only Admin users have the authority to execute the ",(0,s.jsx)(a.code,{children:"GRANT"})," statement, which is used to grant specified Storage Vault privileges to User/Role. Users/Roles with ",(0,s.jsx)(a.code,{children:"USAGE_PRIV"})," privilege for a certain Storage Vault can perform the following operations:"]}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["View the information of that Storage Vault through ",(0,s.jsx)(a.code,{children:"SHOW STORAGE VAULTS"}),";"]}),"\n",(0,s.jsxs)(a.li,{children:["Specify the use of that Storage Vault in ",(0,s.jsx)(a.code,{children:"PROPERTIES"})," when creating tables."]}),"\n"]}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Example"})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:"grant usage_priv on storage vault my_storage_vault to user1\n"})}),"\n",(0,s.jsx)(a.h3,{id:"revoking",children:"Revoking"}),"\n",(0,s.jsx)(a.p,{children:"Revoke the Storage Vault privileges of a specified MySQL user."}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Syntax"})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:"REVOKE \n    USAGE_PRIV\n    ON STORAGE VAULT <vault_name>\n    FROM { ROLE | USER } {<role> | <user>}\n"})}),"\n",(0,s.jsxs)(a.p,{children:["Only Admin users have the authority to execute the ",(0,s.jsx)(a.code,{children:"REVOKE"})," statement, which is used to revoke the privileges of User/Role for the specified Storage Vault."]}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Example"})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:"revoke usage_priv on storage vault my_storage_vault from user1\n"})}),"\n",(0,s.jsx)(a.h2,{id:"faq",children:"FAQ"}),"\n",(0,s.jsx)(a.h4,{id:"q1-\u5982\u4F55\u67E5\u8BE2\u7279\u5B9Astorage-vault\u88AB\u90A3\u4E9B\u8868\u5F15\u7528",children:"Q1. \u5982\u4F55\u67E5\u8BE2\u7279\u5B9Astorage vault\u88AB\u90A3\u4E9B\u8868\u5F15\u7528\uFF1F"}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["Use ",(0,s.jsx)(a.code,{children:"show storage vault"})," to find the \u200B\u200Bstorage vault id\u200B\u200B corresponding to the storage vault name."]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Execute the following SQL statement:"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",children:'mysql> select * from information_schema.table_properties where PROPERTY_NAME = "storage_vault_id" and PROPERTY_VALUE=3;\n+---------------+---------------------------------+-------------------------------------+------------------+----------------+\n| TABLE_CATALOG | TABLE_SCHEMA                    | TABLE_NAME                          | PROPERTY_NAME    | PROPERTY_VALUE |\n+---------------+---------------------------------+-------------------------------------+------------------+----------------+\n| internal      | regression_test_vault_p0_create | s3_92ba28c209154d968e680e58dd54d0cc | storage_vault_id | 3              |\n+---------------+---------------------------------+-------------------------------------+------------------+----------------+\n1 row in set (0.04 sec)\n'})}),"\n",(0,s.jsxs)(a.p,{children:["Replace ",(0,s.jsx)(a.code,{children:"PROPERTY_VALUE=3"})," with the corresponding \u200B\u200Bstorage vault id\u200B\u200B value."]})]})}function u(e={}){let{wrapper:a}={...(0,r.a)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},250065:function(e,a,t){t.d(a,{Z:function(){return i},a:function(){return l}});var n=t(667294);let s={},r=n.createContext(s);function l(e){let a=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),n.createElement(r.Provider,{value:a},e.children)}}}]);