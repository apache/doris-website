"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["86170"],{999158:function(e,n,t){t.r(n),t.d(n,{default:()=>u,frontMatter:()=>a,metadata:()=>s,assets:()=>l,toc:()=>o,contentTitle:()=>c});var s=JSON.parse('{"id":"sql-manual/sql-functions/aggregate-functions/ai-agg","title":"AI_AGG","description":"Aggregates a specific column using a large language model according to user-provided instructions.","source":"@site/docs/sql-manual/sql-functions/aggregate-functions/ai-agg.md","sourceDirName":"sql-manual/sql-functions/aggregate-functions","slug":"/sql-manual/sql-functions/aggregate-functions/ai-agg","permalink":"/docs/dev/sql-manual/sql-functions/aggregate-functions/ai-agg","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"AI_AGG","language":"en","description":"Aggregates a specific column using a large language model according to user-provided instructions."},"sidebar":"docs","previous":{"title":"NULLIF","permalink":"/docs/dev/sql-manual/sql-functions/scalar-functions/conditional-functions/nullif"},"next":{"title":"ANY_VALUE","permalink":"/docs/dev/sql-manual/sql-functions/aggregate-functions/any-value"}}'),i=t("785893"),r=t("250065");let a={title:"AI_AGG",language:"en",description:"Aggregates a specific column using a large language model according to user-provided instructions."},c=void 0,l={},o=[{value:"Description",id:"description",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Parameter Description",id:"parameter-description",level:2},{value:"Return Value",id:"return-value",level:2},{value:"Example",id:"example",level:2}];function d(e){let n={code:"code",h2:"h2",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,i.jsx)(n.p,{children:"Aggregates a specific column using a large language model according to user-provided instructions."}),"\n",(0,i.jsx)(n.h2,{id:"syntax",children:"Syntax"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"AI_AGG([<resource_name>], <expr>, <instruction>)"})}),"\n",(0,i.jsx)(n.h2,{id:"parameter-description",children:"Parameter Description"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"<resource_name>"})}),(0,i.jsx)(n.td,{children:"The specified resource name, optional."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"<expr>"})}),(0,i.jsx)(n.td,{children:"The text column to aggregate. The number of characters in a single text must be less than 128K."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"<instruction>"})}),(0,i.jsx)(n.td,{children:"The instruction to execute, only accepts literals."})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"return-value",children:"Return Value"}),"\n",(0,i.jsx)(n.p,{children:"Returns a string containing the aggregation result."}),"\n",(0,i.jsx)(n.p,{children:"If all input values are NULL, returns NULL."}),"\n",(0,i.jsx)(n.p,{children:"The result is generated by the language model, so the output is not fixed."}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.p,{children:"The following table simulates customer support tickets:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE support_tickets (\n    ticket_id      BIGINT,\n    customer_name  VARCHAR(100),\n    subject        VARCHAR(200),\n    details        TEXT\n)\nDUPLICATE KEY(ticket_id)\nDISTRIBUTED BY HASH(ticket_id) BUCKETS 5\nPROPERTIES (\n    \"replication_num\" = \"1\"\n);\n\nINSERT INTO support_tickets VALUES\n(1, 'Alice', 'Login Failure', 'Cannot log in after password reset. Tried clearing cache and different browsers.'),\n(2, 'Bob', 'Login Failure', 'Same problem as Alice. Also seeing 502 errors on the SSO page.'),\n(3, 'Carol', 'Payment Declined', 'Credit card charged twice but order still shows pending.'),\n(4, 'Dave', 'Slow Dashboard', 'Dashboard takes >30 seconds to load since the last release.'),\n(5, 'Eve', 'Login Failure', 'Getting redirected back to login after entering 2FA code.');\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can use ",(0,i.jsx)(n.code,{children:"AI_AGG"})," to summarize customer issues by problem subject:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT\n    subject,\n    AI_AGG(\n        'ai_resource_name',\n        details,\n        'Summarize every ticket detail into one short paragraph of 40 words or less.'\n    ) AS ai_summary\nFROM support_tickets\nGROUP BY subject;\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| subject          | ai_summary                                                                                                                                                                                                |\n+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Slow Dashboard   | The dashboard loading time has significantly increased to over 30 seconds following the latest release, indicating a potential issue with the recent update.                                              |\n| Login Failure    | User experiences login issues, including redirection post-2FA, inability to log in after password reset despite using different browsers and clearing cache, and encountering 502 errors on the SSO page. |\n| Payment Declined | The customer's credit card was charged twice, but the order status remains pending, indicating a potential issue with the transaction processing or system update.                                        |\n+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n"})}),"\n",(0,i.jsx)(n.p,{children:"case 2\uFF1A"}),"\n",(0,i.jsx)(n.p,{children:"The following table simulates the user review table of an e-commerce platform."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE product_reviews (\n    review_id   BIGINT,\n    product_id  BIGINT,\n    rating      TINYINT,\n    comment     STRING\n)\nDUPLICATE KEY(review_id)\nDISTRIBUTED BY HASH(product_id) BUCKETS 10\nPROPERTIES (\n    \"replication_num\" = \"1\"\n);\n\nINSERT INTO product_reviews VALUES\n(1, 1001, 5, '\u978B\u5B50\u5C3A\u7801\u521A\u597D\uFF0C\u7A7F\u7740\u8212\u670D\uFF0C\u989C\u8272\u4E5F\u597D\u770B\uFF0C\u7269\u6D41\u5F88\u5FEB\uFF01'),\n(2, 1001, 4, '\u8D28\u91CF\u4E0D\u9519\uFF0C\u5C31\u662F\u978B\u5E95\u6709\u70B9\u786C\uFF0C\u9700\u8981\u78E8\u5408\u51E0\u5929\u3002'),\n(3, 1001, 3, '\u5916\u89C2\u548C\u56FE\u7247\u4E00\u6837\uFF0C\u4F46\u6536\u5230\u65F6\u6709\u8F7B\u5FAE\u80F6\u5473\u3002'),\n(4, 1002, 5, '\u676F\u5B50\u5C0F\u5DE7\uFF0C\u51FA\u6C41\u5FEB\uFF0C\u6E05\u6D17\u4E5F\u65B9\u4FBF\uFF0C\u4E0A\u73ED\u5E26\u7740\u521A\u597D\u3002'),\n(5, 1002, 3, '\u58F0\u97F3\u6709\u70B9\u5927\uFF0C\u4E0D\u8FC7\u80FD\u63A5\u53D7\uFF0C\u5145\u6EE1\u7535\u53EA\u80FD\u69A8 5 \u676F\u3002'),\n(6, 1002, 2, '\u7528\u4E86\u4E24\u5468\u5C31\u5145\u4E0D\u8FDB\u7535\uFF0C\u552E\u540E\u6362\u8D27\u6D41\u7A0B\u592A\u6162\u3002'),\n(7, 1003, 5, '\u9762\u6599\u900F\u6C14\u4E0D\u95F7\u70ED\uFF0C\u8896\u53E3\u8BBE\u8BA1\u5F88\u8D34\u5FC3\uFF0CUPF50+ \u786E\u5B9E\u6652\u4E0D\u9ED1\u3002'),\n(8, 1003, 4, '\u989C\u8272\u597D\u770B\uFF0C\u4F46\u62C9\u94FE\u6709\u70B9\u5361\u987F\uFF0C\u9700\u8981\u7528\u529B\u3002'),\n(9, 1004, 5, '\u964D\u566A\u7ED9\u529B\uFF0C\u5730\u94C1\u91CC\u4E5F\u80FD\u5B89\u9759\u542C\u6B4C\uFF0C\u7EED\u822A\u4E00\u5468\u5145\u4E00\u6B21\u3002');\n"})}),"\n",(0,i.jsx)(n.p,{children:"Using AI_AGG to summarize and evaluate:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SET default_ai_resoure = 'ai_resource_name';\nSELECT\n    product_id,\n    AI_AGG(\n        comment,\n        '\u8BF7\u628A\u591A\u6761\u7528\u6237\u8BC4\u4EF7\u603B\u7ED3\u6210\u4E00\u53E5\u8BDD\uFF0C\u7A81\u51FA\u4E70\u5BB6\u6700\u5173\u5FC3\u7684\u4F18\u70B9\u548C\u7F3A\u70B9\uFF0C\u63A7\u5236\u572850\u5B57\u4EE5\u5185\u3002'\n    ) AS \u8BC4\u4EF7\u6458\u8981\nFROM product_reviews\nGROUP BY product_id;\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"+------------+--------------------------------------------------------------------------------------------------------------+\n| product_id | \u8BC4\u4EF7\u6458\u8981                                                                                                     |\n+------------+--------------------------------------------------------------------------------------------------------------+\n|       1003 | \u8BE5\u4EA7\u54C1\u9762\u6599\u900F\u6C14\u3001\u9632\u6652\u6548\u679C\u597D\u4E14\u989C\u8272\u7F8E\u89C2\uFF0C\u4F46\u62C9\u94FE\u4F7F\u7528\u4E0D\u987A\u7545\u3002                                                     |\n|       1004 | \u7528\u6237\u8BC4\u4EF7\u8BE5\u4EA7\u54C1\u964D\u566A\u6548\u679C\u597D\uFF0C\u7EED\u822A\u80FD\u529B\u5F3A\uFF0C\u4E00\u5468\u5145\u4E00\u6B21\u7535\u3002                                                         |\n|       1001 | \u4E70\u5BB6\u666E\u904D\u8BA4\u4E3A\u978B\u5B50\u7A7F\u7740\u8212\u9002\u3001\u5916\u89C2\u597D\u770B\u4E14\u7269\u6D41\u5FEB\uFF0C\u4F46\u978B\u5E95\u504F\u786C\u4E14\u6709\u8F7B\u5FAE\u80F6\u5473\u3002                                         |\n|       1002 | \u4E70\u5BB6\u8BA4\u4E3A\u8BE5\u69A8\u6C41\u676F\u5C0F\u5DE7\u4FBF\u643A\u3001\u51FA\u6C41\u5FEB\u4E14\u6613\u6E05\u6D17\uFF0C\u4F46\u7535\u6C60\u7EED\u822A\u77ED\u4E14\u552E\u540E\u6362\u8D27\u6D41\u7A0B\u6162\u3002                                     |\n+------------+--------------------------------------------------------------------------------------------------------------+\n"})})]})}function u(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return c},a:function(){return a}});var s=t(667294);let i={},r=s.createContext(i);function a(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);