"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["207781"],{783134:function(e,i,n){n.r(i),n.d(i,{default:()=>m,frontMatter:()=>o,metadata:()=>t,assets:()=>d,toc:()=>l,contentTitle:()=>s});var t=JSON.parse('{"id":"table-design/tiered-storage/tiered-ssd-hdd","title":"Tiered Storage of SSD and HDD","description":"Doris supports tiered storage between different disk types (SSD and HDD),","source":"@site/versioned_docs/version-4.x/table-design/tiered-storage/tiered-ssd-hdd.md","sourceDirName":"table-design/tiered-storage","slug":"/table-design/tiered-storage/tiered-ssd-hdd","permalink":"/docs/4.x/table-design/tiered-storage/tiered-ssd-hdd","draft":false,"unlisted":false,"tags":[],"version":"4.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Tiered Storage of SSD and HDD","language":"en","description":"Doris supports tiered storage between different disk types (SSD and HDD),"},"sidebar":"docs","previous":{"title":"Tiered Storage Overview","permalink":"/docs/4.x/table-design/tiered-storage/overview"},"next":{"title":"Remote Storage","permalink":"/docs/4.x/table-design/tiered-storage/remote-storage"}}'),a=n("785893"),r=n("250065");let o={title:"Tiered Storage of SSD and HDD",language:"en",description:"Doris supports tiered storage between different disk types (SSD and HDD),"},s=void 0,d={},l=[{value:"Dynamic Partitioning and Tiered Storage",id:"dynamic-partitioning-and-tiered-storage",level:2},{value:"Parameter Description",id:"parameter-description",level:2},{value:"<code>dynamic_partition.hot_partition_num</code>",id:"dynamic_partitionhot_partition_num",level:3},{value:"<code>dynamic_partition.storage_medium</code>",id:"dynamic_partitionstorage_medium",level:3},{value:"Example",id:"example",level:2},{value:"1. Create a table with dynamic_partition",id:"1-create-a-table-with-dynamic_partition",level:3},{value:"2. Check storage medium of partitions",id:"2-check-storage-medium-of-partitions",level:3},{value:"3. Manually tiering a partition",id:"3-manually-tiering-a-partition",level:3},{value:"4. Manual tiering in heterogeneous clusters",id:"4-manual-tiering-in-heterogeneous-clusters",level:3}];function c(e){let i={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.p,{children:"Doris supports tiered storage between different disk types (SSD and HDD), combining dynamic partitioning features to dynamically migrate data from SSD to HDD based on the characteristics of hot and cold data. This approach reduces storage costs while maintaining high performance for hot data reads and writes."}),"\n",(0,a.jsx)(i.h2,{id:"dynamic-partitioning-and-tiered-storage",children:"Dynamic Partitioning and Tiered Storage"}),"\n",(0,a.jsx)(i.p,{children:"By configuring dynamic partitioning parameters of a table, users can set which partitions are stored on SSD and automatically migrate to HDD after cooling."}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Hot Partitions"}),": Recently active partitions, prioritized to be stored on SSD to ensure high performance."]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Cold Partitions"}),": Partitions that are accessed less frequently, which will gradually migrate to HDD to reduce storage costs."]}),"\n"]}),"\n",(0,a.jsxs)(i.p,{children:["For more information on dynamic partitioning, please refer to: ",(0,a.jsx)(i.a,{href:"../../table-design/data-partitioning/dynamic-partitioning",children:"Data Partitioning - Dynamic Partitioning"}),"."]}),"\n",(0,a.jsx)(i.h2,{id:"parameter-description",children:"Parameter Description"}),"\n",(0,a.jsx)(i.h3,{id:"dynamic_partitionhot_partition_num",children:(0,a.jsx)(i.code,{children:"dynamic_partition.hot_partition_num"})}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:["\n",(0,a.jsxs)(i.p,{children:[(0,a.jsx)(i.strong,{children:"Function"}),":"]}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsx)(i.li,{children:"Specifies how many of the most recent partitions are hot partitions, which are stored on SSD, while the remaining partitions are stored on HDD."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(i.li,{children:["\n",(0,a.jsxs)(i.p,{children:[(0,a.jsx)(i.strong,{children:"Note"}),":"]}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.code,{children:'"dynamic_partition.storage_medium" = "HDD"'})," must be set simultaneously; otherwise, this parameter will not take effect."]}),"\n",(0,a.jsx)(i.li,{children:"If there are no SSD devices in the storage path, this configuration will cause partition creation to fail."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(i.p,{children:[(0,a.jsx)(i.strong,{children:"Example Description"}),":"]}),"\n",(0,a.jsxs)(i.p,{children:["Assuming the current date is ",(0,a.jsx)(i.strong,{children:"2021-05-20"}),", with daily partitioning, the dynamic partitioning configuration is as follows:"]}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-sql",children:'    "dynamic_partition.time_unit" = "DAY",\n    "dynamic_partition.hot_partition_num" = 2\n    "dynamic_partition.start" = -3\n    "dynamic_partition.end" = 3\n'})}),"\n",(0,a.jsx)(i.p,{children:"The system will automatically create the following partitions and configure their storage medium and cooling time:"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-Plain",children:'p20210517\uFF1A["2021-05-17", "2021-05-18") storage_medium=HDD storage_cooldown_time=9999-12-31 23:59:59\np20210518\uFF1A["2021-05-18", "2021-05-19") storage_medium=HDD storage_cooldown_time=9999-12-31 23:59:59\np20210519\uFF1A["2021-05-19", "2021-05-20") storage_medium=SSD storage_cooldown_time=2021-05-21 00:00:00\np20210520\uFF1A["2021-05-20", "2021-05-21") storage_medium=SSD storage_cooldown_time=2021-05-22 00:00:00\np20210521\uFF1A["2021-05-21", "2021-05-22") storage_medium=SSD storage_cooldown_time=2021-05-23 00:00:00\np20210522\uFF1A["2021-05-22", "2021-05-23") storage_medium=SSD storage_cooldown_time=2021-05-24 00:00:00\np20210523\uFF1A["2021-05-23", "2021-05-24") storage_medium=SSD storage_cooldown_time=2021-05-25 00:00:00\n'})}),"\n",(0,a.jsx)(i.h3,{id:"dynamic_partitionstorage_medium",children:(0,a.jsx)(i.code,{children:"dynamic_partition.storage_medium"})}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:["\n",(0,a.jsxs)(i.p,{children:[(0,a.jsx)(i.strong,{children:"Function"}),":"]}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsx)(i.li,{children:"Specifies the final storage medium for dynamic partitions. The default is HDD, but SSD can be selected."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(i.li,{children:["\n",(0,a.jsxs)(i.p,{children:[(0,a.jsx)(i.strong,{children:"Note"}),":"]}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:["When set to SSD, the ",(0,a.jsx)(i.code,{children:"hot_partition_num"})," attribute will no longer take effect, and all partitions will default to SSD storage medium with a cooling time of 9999-12-31 23:59:59."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(i.h2,{id:"example",children:"Example"}),"\n",(0,a.jsx)(i.h3,{id:"1-create-a-table-with-dynamic_partition",children:"1. Create a table with dynamic_partition"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-sql",children:'    CREATE TABLE tiered_table (k DATE)\n    PARTITION BY RANGE(k)()\n    DISTRIBUTED BY HASH (k) BUCKETS 5\n    PROPERTIES\n    (\n        "dynamic_partition.storage_medium" = "hdd",\n        "dynamic_partition.enable" = "true",\n        "dynamic_partition.time_unit" = "DAY",\n        "dynamic_partition.hot_partition_num" = "2",\n        "dynamic_partition.end" = "3",\n        "dynamic_partition.prefix" = "p",\n        "dynamic_partition.buckets" = "5",\n        "dynamic_partition.create_history_partition"= "true",\n        "dynamic_partition.start" = "-3"\n    );\n'})}),"\n",(0,a.jsx)(i.h3,{id:"2-check-storage-medium-of-partitions",children:"2. Check storage medium of partitions"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-sql",children:"    SHOW PARTITIONS FROM tiered_table;\n"})}),"\n",(0,a.jsx)(i.p,{children:"You should have 7 partitions, 5 of which use SSD as the storage medium, while the other 2 use HDD."}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-Plain",children:'  p20210517\uFF1A["2021-05-17", "2021-05-18") storage_medium=HDD storage_cooldown_time=9999-12-31 23:59:59\n  p20210518\uFF1A["2021-05-18", "2021-05-19") storage_medium=HDD storage_cooldown_time=9999-12-31 23:59:59\n  p20210519\uFF1A["2021-05-19", "2021-05-20") storage_medium=SSD storage_cooldown_time=2021-05-21 00:00:00\n  p20210520\uFF1A["2021-05-20", "2021-05-21") storage_medium=SSD storage_cooldown_time=2021-05-22 00:00:00\n  p20210521\uFF1A["2021-05-21", "2021-05-22") storage_medium=SSD storage_cooldown_time=2021-05-23 00:00:00\n  p20210522\uFF1A["2021-05-22", "2021-05-23") storage_medium=SSD storage_cooldown_time=2021-05-24 00:00:00\n  p20210523\uFF1A["2021-05-23", "2021-05-24") storage_medium=SSD storage_cooldown_time=2021-05-25 00:00:00\n'})}),"\n",(0,a.jsx)(i.h3,{id:"3-manually-tiering-a-partition",children:"3. Manually tiering a partition"}),"\n",(0,a.jsxs)(i.p,{children:["You can manually move an individual partition between storage tiers by updating its ",(0,a.jsx)(i.code,{children:"storage_medium"})," property. For example, to move a partition to HDD storage:"]}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-sql",children:'ALTER TABLE parent_table\nMODIFY PARTITION (partition_name) SET ("storage_medium" = "HDD");\n'})}),"\n",(0,a.jsx)(i.p,{children:"This operation updates the partition\u2019s storage policy and triggers Doris to relocate the data accordingly."}),"\n",(0,a.jsx)(i.h3,{id:"4-manual-tiering-in-heterogeneous-clusters",children:"4. Manual tiering in heterogeneous clusters"}),"\n",(0,a.jsx)(i.p,{children:"In heterogeneous cluster setups, it is common to deploy a mix of SSD-backed nodes for hot data and HDD-backed nodes for cold data. A frequent pitfall in such environments is failing to distinguish these nodes using location tags."}),"\n",(0,a.jsx)(i.p,{children:"If all backends share the default location tag, Doris may be unable to tier a partition down to HDD. This happens because the partition was originally placed on an SSD node, and Doris cannot locate an HDD storage medium on the same backend."}),"\n",(0,a.jsx)(i.p,{children:"To avoid this issue:"}),"\n",(0,a.jsxs)(i.ol,{children:["\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.strong,{children:"Tag cold (HDD) backends with a distinct location"})}),"\n"]}),"\n",(0,a.jsx)(i.p,{children:"For example:"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-sql",children:'ALTER SYSTEM MODIFY BACKEND "cold_node1:9050" SET ("tag.location" = "archive");\n'})}),"\n",(0,a.jsxs)(i.ol,{start:"2",children:["\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.strong,{children:"Explicitly target the tagged backends when modifying the partition"})}),"\n"]}),"\n",(0,a.jsx)(i.p,{children:"Specify both the desired storage medium and the replication allocation:"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-sql",children:'ALTER TABLE parent_table\nMODIFY PARTITION (partition_name) SET ("storage_medium" = "HDD", "replication_allocation" = "tag.location.archive:1");\n'})}),"\n",(0,a.jsx)(i.p,{children:"By assigning location tags and referencing them in the partition\u2019s replication policy, Doris can correctly place cold data on HDD-backed nodes in heterogeneous clusters."})]})}function m(e={}){let{wrapper:i}={...(0,r.a)(),...e.components};return i?(0,a.jsx)(i,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},250065:function(e,i,n){n.d(i,{Z:function(){return s},a:function(){return o}});var t=n(667294);let a={},r=t.createContext(a);function o(e){let i=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(r.Provider,{value:i},e.children)}}}]);