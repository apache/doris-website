"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["609482"],{584471:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>d,metadata:()=>s,assets:()=>l,toc:()=>a,contentTitle:()=>o});var s=JSON.parse('{"id":"compute-storage-decoupled/before-deployment","title":"Doris Compute-Storage Decoupled Deployment Preparation","description":"1. Overview","source":"@site/versioned_docs/version-3.x/compute-storage-decoupled/before-deployment.md","sourceDirName":"compute-storage-decoupled","slug":"/compute-storage-decoupled/before-deployment","permalink":"/docs/3.x/compute-storage-decoupled/before-deployment","draft":false,"unlisted":false,"tags":[],"version":"3.x","frontMatter":{"title":"Doris Compute-Storage Decoupled Deployment Preparation","language":"en"},"sidebar":"docs","previous":{"title":"Overview","permalink":"/docs/3.x/compute-storage-decoupled/overview"},"next":{"title":"Compilation and Deployment","permalink":"/docs/3.x/compute-storage-decoupled/compilation-and-deployment"}}'),i=t("785893"),r=t("250065");let d={title:"Doris Compute-Storage Decoupled Deployment Preparation",language:"en"},o=void 0,l={},a=[{value:"1. Overview",id:"1-overview",level:2},{value:"2. Architecture Components",id:"2-architecture-components",level:2},{value:"3. System Requirements",id:"3-system-requirements",level:2},{value:"3.1 Hardware Requirements",id:"31-hardware-requirements",level:3},{value:"3.2 Software Dependencies",id:"32-software-dependencies",level:3},{value:"4. Deployment Planning",id:"4-deployment-planning",level:2},{value:"4.1 Testing Environment Deployment",id:"41-testing-environment-deployment",level:3},{value:"4.2 Production Deployment",id:"42-production-deployment",level:3},{value:"5. Installation Steps",id:"5-installation-steps",level:2},{value:"5.1 Install FoundationDB",id:"51-install-foundationdb",level:3},{value:"5.1.1 Machine Requirements",id:"511-machine-requirements",level:4},{value:"5.1.2 <code>fdb_vars.sh</code> Configuration",id:"512-fdb_varssh-configuration",level:4},{value:"Required Custom Settings",id:"required-custom-settings",level:5},{value:"Optional Custom Settings",id:"optional-custom-settings",level:5},{value:"5.1.3 Deploy FDB Cluster",id:"513-deploy-fdb-cluster",level:4},{value:"5.1.4 Start FDB Service",id:"514-start-fdb-service",level:3},{value:"5.2 Install OpenJDK 17",id:"52-install-openjdk-17",level:3},{value:"6. Next Steps",id:"6-next-steps",level:2},{value:"7. Notes",id:"7-notes",level:2},{value:"8. References",id:"8-references",level:2}];function c(e){let n={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"1-overview",children:"1. Overview"}),"\n",(0,i.jsx)(n.p,{children:"This document describes the deployment preparation work for the Apache Doris compute-storage decoupled mode. The decoupled architecture aims to improve system scalability and performance, suitable for large-scale data processing scenarios."}),"\n",(0,i.jsx)(n.h2,{id:"2-architecture-components",children:"2. Architecture Components"}),"\n",(0,i.jsx)(n.p,{children:"The Doris compute-storage decoupled architecture consists of three main modules:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Frontend (FE)"}),": Handles user requests and manages metadata."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Backend (BE)"}),": Stateless compute nodes that execute query tasks."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Meta Service (MS)"}),": Manages metadata operations and data recovery."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"3-system-requirements",children:"3. System Requirements"}),"\n",(0,i.jsx)(n.h3,{id:"31-hardware-requirements",children:"3.1 Hardware Requirements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Minimum configuration: 3 servers"}),"\n",(0,i.jsx)(n.li,{children:"Recommended configuration: 5 or more servers"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"32-software-dependencies",children:"3.2 Software Dependencies"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"FoundationDB (FDB) version 7.1.38 or higher"}),"\n",(0,i.jsx)(n.li,{children:"OpenJDK 17"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"4-deployment-planning",children:"4. Deployment Planning"}),"\n",(0,i.jsx)(n.h3,{id:"41-testing-environment-deployment",children:"4.1 Testing Environment Deployment"}),"\n",(0,i.jsx)(n.p,{children:"Deploy all modules on a single machine, not suitable for production environments."}),"\n",(0,i.jsx)(n.h3,{id:"42-production-deployment",children:"4.2 Production Deployment"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Deploy FDB on 3 or more machines"}),"\n",(0,i.jsx)(n.li,{children:"Deploy FE and Meta Service on 3 or more machines"}),"\n",(0,i.jsx)(n.li,{children:"Deploy BE on 3 or more machines"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"When machine configurations are high, consider mixing FDB, FE, and Meta Service, but do not mix disks."}),"\n",(0,i.jsx)(n.h2,{id:"5-installation-steps",children:"5. Installation Steps"}),"\n",(0,i.jsx)(n.h3,{id:"51-install-foundationdb",children:"5.1 Install FoundationDB"}),"\n",(0,i.jsxs)(n.p,{children:["This section provides a step-by-step guide to configure, deploy, and start the FoundationDB (FDB) service using the provided scripts ",(0,i.jsx)(n.code,{children:"fdb_vars.sh"})," and ",(0,i.jsx)(n.code,{children:"fdb_ctl.sh"}),". You can download ",(0,i.jsx)(n.a,{href:"http://apache-doris-releases.oss-accelerate.aliyuncs.com/apache-doris-3.0.2-tools.tar.gz",children:"doris tools"})," and get ",(0,i.jsx)(n.code,{children:"fdb_vars.sh"})," and ",(0,i.jsx)(n.code,{children:"fdb_ctl.sh"})," from ",(0,i.jsx)(n.code,{children:"fdb"})," directory."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"Doris currently relies on FDB version 7.1.x by default. If you have already installed FDB separately, please ensure it is version 7.1.x; otherwise, the Meta Service will fail to start."})}),"\n",(0,i.jsx)(n.h4,{id:"511-machine-requirements",children:"5.1.1 Machine Requirements"}),"\n",(0,i.jsx)(n.p,{children:"Typically, at least 3 machines equipped with SSDs are required to form a FoundationDB cluster with dual data replicas and allow for single machine failures.\nIf SSDs are not available, at least standard cloud disks or local disks with a standard POSIX-compliant file system must be used for data storage. Otherwise, FoundationDB may fail to operate properly - for instance, storage solutions like JuiceFS should not be used as the underlying storage for FoundationDB."}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"If only for development/testing purposes, a single machine is sufficient."})}),"\n",(0,i.jsxs)(n.h4,{id:"512-fdb_varssh-configuration",children:["5.1.2 ",(0,i.jsx)(n.code,{children:"fdb_vars.sh"})," Configuration"]}),"\n",(0,i.jsx)(n.h5,{id:"required-custom-settings",children:"Required Custom Settings"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Example"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DATA_DIRS"})}),(0,i.jsx)(n.td,{children:"Specify the data directory for FoundationDB storage"}),(0,i.jsx)(n.td,{children:"Comma-separated list of absolute paths"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/mnt/foundationdb/data1,/mnt/foundationdb/data2,/mnt/foundationdb/data3"})}),(0,i.jsxs)(n.td,{children:["- Ensure directories are created before running the script",(0,i.jsx)(n.br,{}),"- SSD and separate directories are recommended for production environments"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"FDB_CLUSTER_IPS"})}),(0,i.jsx)(n.td,{children:"Define cluster IPs"}),(0,i.jsx)(n.td,{children:"String (comma-separated IP addresses)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"172.200.0.2,172.200.0.3,172.200.0.4"})}),(0,i.jsxs)(n.td,{children:["- At least 3 IP addresses for production clusters",(0,i.jsx)(n.br,{}),"- The first IP will be used as the coordinator",(0,i.jsx)(n.br,{}),"- For high availability, place machines in different racks"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"FDB_HOME"})}),(0,i.jsx)(n.td,{children:"Define the main directory for FoundationDB"}),(0,i.jsx)(n.td,{children:"Absolute path"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/fdbhome"})}),(0,i.jsxs)(n.td,{children:["- Default path is /fdbhome",(0,i.jsx)(n.br,{}),"- Ensure this path is absolute"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"FDB_CLUSTER_ID"})}),(0,i.jsx)(n.td,{children:"Define the cluster ID"}),(0,i.jsx)(n.td,{children:"String"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SAQESzbh"})}),(0,i.jsxs)(n.td,{children:["- Each cluster ID must be unique",(0,i.jsx)(n.br,{}),"- Can be generated using ",(0,i.jsx)(n.code,{children:"mktemp -u XXXXXXXX"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"FDB_CLUSTER_DESC"})}),(0,i.jsx)(n.td,{children:"Define the description of the FDB cluster"}),(0,i.jsx)(n.td,{children:"String"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dorisfdb"})}),(0,i.jsx)(n.td,{children:"- It is recommended to change this to something meaningful for the deployment"})]})]})]}),"\n",(0,i.jsx)(n.h5,{id:"optional-custom-settings",children:"Optional Custom Settings"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Example"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"MEMORY_LIMIT_GB"})}),(0,i.jsx)(n.td,{children:"Define the memory limit for FDB processes in GB"}),(0,i.jsx)(n.td,{children:"Integer"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"MEMORY_LIMIT_GB=16"})}),(0,i.jsx)(n.td,{children:"Adjust this value based on available memory resources and FDB process requirements"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CPU_CORES_LIMIT"})}),(0,i.jsx)(n.td,{children:"Define the CPU core limit for FDB processes"}),(0,i.jsx)(n.td,{children:"Integer"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CPU_CORES_LIMIT=8"})}),(0,i.jsx)(n.td,{children:"Set this value based on the number of available CPU cores and FDB process requirements"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"513-deploy-fdb-cluster",children:"5.1.3 Deploy FDB Cluster"}),"\n",(0,i.jsxs)(n.p,{children:["After configuring the environment with ",(0,i.jsx)(n.code,{children:"fdb_vars.sh"}),", you can deploy the FDB cluster on each node using the ",(0,i.jsx)(n.code,{children:"fdb_ctl.sh"})," script."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./fdb_ctl.sh deploy\n"})}),"\n",(0,i.jsx)(n.p,{children:"This command initiates the deployment process of the FDB cluster."}),"\n",(0,i.jsx)(n.h3,{id:"514-start-fdb-service",children:"5.1.4 Start FDB Service"}),"\n",(0,i.jsxs)(n.p,{children:["Once the FDB cluster is deployed, you can start the FDB service on each node using the ",(0,i.jsx)(n.code,{children:"fdb_ctl.sh"})," script."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./fdb_ctl.sh start\n"})}),"\n",(0,i.jsx)(n.p,{children:"This command starts the FDB service, making the cluster operational and obtaining the FDB cluster connection string, which can be used for configuring the MetaService."}),"\n",(0,i.jsx)(n.h3,{id:"52-install-openjdk-17",children:"5.2 Install OpenJDK 17"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Download ",(0,i.jsx)(n.a,{href:"https://download.java.net/java/GA/jdk17.0.1/2a2082e5a09d4267845be086888add4f/12/GPL/openjdk-17.0.1_linux-x64_bin.tar.gz",children:"OpenJDK 17"})]}),"\n",(0,i.jsx)(n.li,{children:"Extract and set the environment variable JAVA_HOME."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"6-next-steps",children:"6. Next Steps"}),"\n",(0,i.jsx)(n.p,{children:"After completing the above preparations, please refer to the following documents to continue the deployment:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.x/compute-storage-decoupled/compilation-and-deployment",children:"Deployment"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.x/compute-storage-decoupled/managing-compute-cluster",children:"Managing Compute Group"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.x/compute-storage-decoupled/managing-storage-vault",children:"Managing Storage Vault"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"7-notes",children:"7. Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ensure time synchronization across all nodes"}),"\n",(0,i.jsx)(n.li,{children:"Regularly back up FoundationDB data"}),"\n",(0,i.jsx)(n.li,{children:"Adjust FoundationDB and Doris configuration parameters based on actual load"}),"\n",(0,i.jsxs)(n.li,{children:["Use standard cloud disks or local disks with a POSIX-compliant file system for data storage; otherwise, FoundationDB may not function properly.\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"For example, storage solutions like JuiceFS should not be used as FoundationDB's storage backend."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"8-references",children:"8. References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://apple.github.io/foundationdb/index.html",children:"FoundationDB Official Documentation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://doris.apache.org/",children:"Apache Doris Official Website"})}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return o},a:function(){return d}});var s=t(667294);let i={},r=s.createContext(i);function d(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);