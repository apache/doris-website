"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["237011"],{68258:function(e,n,i){i.r(n),i.d(n,{default:()=>h,frontMatter:()=>a,metadata:()=>r,assets:()=>d,toc:()=>l,contentTitle:()=>o});var r=JSON.parse('{"id":"table-design/index/inverted-index/overview","title":"Inverted Index | Inverted Index","description":"Inverted Index is a commonly used indexing technique in the field of information retrieval.","source":"@site/docs/table-design/index/inverted-index/overview.md","sourceDirName":"table-design/index/inverted-index","slug":"/table-design/index/inverted-index/overview","permalink":"/docs/dev/table-design/index/inverted-index/overview","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Inverted Index | Inverted Index","sidebar_label":"Overview","language":"en","description":"Inverted Index is a commonly used indexing technique in the field of information retrieval."},"sidebar":"docs","previous":{"title":"Sort Key and Prefix Index","permalink":"/docs/dev/table-design/index/prefix-index"},"next":{"title":"BloomFilter Index","permalink":"/docs/dev/table-design/index/bloomfilter"}}'),t=i("785893"),s=i("250065");let a={title:"Inverted Index | Inverted Index",sidebar_label:"Overview",language:"en",description:"Inverted Index is a commonly used indexing technique in the field of information retrieval."},o="Inverted Index",d={},l=[{value:"Indexing Principle",id:"indexing-principle",level:2},{value:"Usage Scenarios",id:"usage-scenarios",level:2},{value:"Managing Indexes",id:"managing-indexes",level:2},{value:"Defining Inverted Indexes When Creating a Table",id:"defining-inverted-indexes-when-creating-a-table",level:3},{value:"Adding Inverted Indexes to Existing Tables",id:"adding-inverted-indexes-to-existing-tables",level:3},{value:"Deleting Inverted Indexes from Existing Tables",id:"deleting-inverted-indexes-from-existing-tables",level:3},{value:"Viewing Inverted Index",id:"viewing-inverted-index",level:3},{value:"Using Indexes",id:"using-indexes",level:2},{value:"Accelerating Queries with Inverted Indexes",id:"accelerating-queries-with-inverted-indexes",level:3},{value:"Analyzing Index Acceleration Effects Through Profiles",id:"analyzing-index-acceleration-effects-through-profiles",level:3},{value:"Verifying Tokenization Effects Using Tokenization Functions",id:"verifying-tokenization-effects-using-tokenization-functions",level:3},{value:"Usage Example",id:"usage-example",level:2},{value:"Table Creation",id:"table-creation",level:3},{value:"Data Import",id:"data-import",level:3},{value:"Queries",id:"queries",level:3},{value:"02 Standard Equality and Range Queries",id:"02-standard-equality-and-range-queries",level:3}];function c(e){let n={a:"a",admonition:"admonition",code:"code",details:"details",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",summary:"summary",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"inverted-index",children:"Inverted Index"})}),"\n",(0,t.jsx)(n.h2,{id:"indexing-principle",children:"Indexing Principle"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Inverted_index",children:"Inverted Index"})," is a commonly used indexing technique in the field of information retrieval. It divides text into individual words and constructs a word -> document IDs index, allowing for quick searches to determine which documents contain a specific word."]}),"\n",(0,t.jsx)(n.p,{children:"Starting from version 2.0.0, Doris supports inverted indexes, which can be used for full-text searches on text types, equality, and range queries on normal numerical and date types, and quickly filtering rows that meet the criteria from massive amounts of data."}),"\n",(0,t.jsx)(n.p,{children:"In Doris's implementation of the inverted index, each row in the table corresponds to a document, and each column corresponds to a field in the document. Thus, using an inverted index, you can quickly locate rows containing specific keywords, thereby accelerating the WHERE clause."}),"\n",(0,t.jsx)(n.p,{children:"Unlike other indexes in Doris, the inverted index uses independent files at the storage layer, corresponding one-to-one with data files but physically stored independently. This approach allows for creating and deleting indexes without rewriting data files, significantly reducing processing overhead."}),"\n",(0,t.jsx)(n.h2,{id:"usage-scenarios",children:"Usage Scenarios"}),"\n",(0,t.jsx)(n.p,{children:"Inverted indexes have a wide range of applications and can accelerate equality, range, and full-text searches (keyword matching, phrase matching, etc.). A table can have multiple inverted indexes, and the conditions of multiple inverted indexes can be combined arbitrarily during queries."}),"\n",(0,t.jsx)(n.p,{children:"The functionality of inverted indexes is briefly introduced as follows:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. Accelerate full-text searches for string types"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Support for keyword search, including matching multiple keywords simultaneously ",(0,t.jsx)(n.code,{children:"MATCH_ALL"})," and matching any one keyword ",(0,t.jsx)(n.code,{children:"MATCH_ANY"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Support for phrase queries ",(0,t.jsx)(n.code,{children:"MATCH_PHRASE"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Support for specifying slop for word distence"}),"\n",(0,t.jsxs)(n.li,{children:["Support for phrase + prefix ",(0,t.jsx)(n.code,{children:"MATCH_PHRASE_PREFIX"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Support for tokenized regular expression queries ",(0,t.jsx)(n.code,{children:"MATCH_REGEXP"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Support for English, Chinese, and Unicode tokenizers"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. Accelerate normal equality and range queries, covering and replacing the functionality of BITMAP index"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Support for fast filtering of string, numerical, and datetime types for =, !=, >, >=, <, <="}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Support for fast filtering of string, numerical, and datetime array types for ",(0,t.jsx)(n.code,{children:"array_contains"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"3. Support for comprehensive logical combinations"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Not only supports acceleration for AND conditions but also for OR and NOT conditions"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Supports arbitrary logical combinations of multiple conditions with AND, OR, NOT"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"4. Flexible and efficient index management"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Support for defining inverted indexes when creating a table"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Support for adding inverted indexes to existing tables, with incremental index construction without rewriting existing data in the table"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Support for deleting inverted indexes from existing tables without rewriting existing data in the table"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.p,{children:"There are some limitations to using inverted indexes:"}),(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Floating-point types FLOAT and DOUBLE, which have precision issues, do not support inverted indexes due to inaccurate precision. The solution is to use the precisely accurate DECIMAL type, which supports inverted indexes."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Some complex data types do not yet support inverted indexes, including MAP, STRUCT, JSON, HLL, BITMAP, QUANTILE_STATE, AGG_STATE."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"DUPLICATE and UNIQUE table models with Merge-on-Write enabled support building inverted indexes on any column. However, AGGREGATE and UNIQUE models without Merge-on-Write enabled only support building inverted indexes on Key columns, as non-Key columns cannot have inverted indexes. This is because these two models require reading all data for merging, so indexes cannot be used for pre-filtering."}),"\n"]}),"\n"]})]}),"\n",(0,t.jsx)(n.h2,{id:"managing-indexes",children:"Managing Indexes"}),"\n",(0,t.jsx)(n.h3,{id:"defining-inverted-indexes-when-creating-a-table",children:"Defining Inverted Indexes When Creating a Table"}),"\n",(0,t.jsx)(n.p,{children:"In the table creation statement, after the COLUMN definition, is the index definition:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE table_name\n(\n  column_name1 TYPE1,\n  column_name2 TYPE2,\n  column_name3 TYPE3,\n  INDEX idx_name1(column_name1) USING INVERTED [PROPERTIES(...)] [COMMENT 'your comment'],\n  INDEX idx_name2(column_name2) USING INVERTED [PROPERTIES(...)] [COMMENT 'your comment']\n)\ntable_properties;\n"})}),"\n",(0,t.jsx)(n.p,{children:"Syntax explanation:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["1. ",(0,t.jsx)(n.code,{children:"idx_column_name(column_name)"})," is mandatory, ",(0,t.jsx)(n.code,{children:"column_name"})," is the name of the column for the index, must be a column defined earlier, ",(0,t.jsx)(n.code,{children:"idx_column_name"})," is the index name, must be unique at the table level, recommended naming convention: prefix ",(0,t.jsx)(n.code,{children:"idx_"})," before the column name"]})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["2. ",(0,t.jsx)(n.code,{children:"USING INVERTED"})," is mandatory to specify that the index type is an inverted index"]})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["3. ",(0,t.jsx)(n.code,{children:"PROPERTIES"})," is optional to specify additional properties of the inverted index, currently supported properties are:"]})}),"\n",(0,t.jsxs)(n.details,{children:["\n  ",(0,t.jsx)(n.summary,{children:"parser: specifies the tokenizer"}),"\n  ",(0,t.jsx)(n.p,{children:"- By default, it is unspecified, meaning no tokenization"}),"\n  ",(0,t.jsx)(n.p,{children:"- `english`: English tokenization, suitable for columns with English text, uses spaces and punctuation for tokenization, high performance"}),"\n  ",(0,t.jsx)(n.p,{children:"- `chinese`: Chinese tokenization, suitable for columns with mainly Chinese text, lower performance than English tokenization"}),"\n  ",(0,t.jsx)(n.p,{children:"- `unicode`: Unicode tokenization, suitable for mixed Chinese and English, and mixed multilingual texts. It can tokenize email prefixes and suffixes, IP addresses, and mixed character and number strings, and can tokenize Chinese by characters."}),"\n  ",(0,t.jsx)(n.p,{children:"- `icu` (Supported since 3.1.0): ICU (International Components for Unicode) tokenization, based on the ICU library. Ideal for internationalized text with complex writing systems and multilingual documents. Supports languages like Arabic, Thai, and other Unicode-based scripts."}),"\n  ",(0,t.jsx)(n.p,{children:"- `basic` (Supported since 3.1.0): Basic rule-based tokenization using simple character type recognition. Suitable for scenarios with extremely high performance requirements or simple text processing needs. Rules: continuous alphanumeric characters are treated as one token, each Chinese character is a separate token, and punctuation/spaces/special characters are ignored. This tokenizer provides the best performance among all tokenizers but with simpler tokenization logic compared to unicode or icu."}),"\n  ",(0,t.jsx)(n.p,{children:"- `ik` (Supported since 3.1.0): IK Chinese tokenization, specifically designed for Chinese text analysis."}),"\n",(0,t.jsxs)(n.p,{children:["Tokenization results can be verified using the ",(0,t.jsx)(n.code,{children:"TOKENIZE"})," SQL function, see the following sections for details."]}),"\n"]}),"\n",(0,t.jsxs)(n.details,{children:["\n  ",(0,t.jsx)(n.summary,{children:"parser_mode"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["Specifies the tokenization mode, currently supported modes for ",(0,t.jsx)(n.code,{children:"parser = chinese"})," are:"]})}),"\n  ",(0,t.jsx)(n.p,{children:"- fine_grained: fine-grained mode, tends to generate shorter, more words, e.g., '\u6B66\u6C49\u5E02\u957F\u6C5F\u5927\u6865' will be tokenized into '\u6B66\u6C49', '\u6B66\u6C49\u5E02', '\u5E02\u957F', '\u957F\u6C5F', '\u957F\u6C5F\u5927\u6865', '\u5927\u6865'"}),"\n  ",(0,t.jsx)(n.p,{children:"- coarse_grained: coarse-grained mode, tends to generate longer, fewer words, e.g., '\u6B66\u6C49\u5E02\u957F\u6C5F\u5927\u6865' will be tokenized into '\u6B66\u6C49\u5E02', '\u957F\u6C5F\u5927\u6865'"}),"\n  ",(0,t.jsx)(n.p,{children:"- default coarse_grained"}),"\n"]}),"\n",(0,t.jsxs)(n.details,{children:["\n  ",(0,t.jsx)(n.summary,{children:"support_phrase"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Specifies whether the index supports MATCH_PHRASE phrase query acceleration"})}),"\n  ",(0,t.jsx)(n.p,{children:"- true: supported, but the index requires more storage space"}),"\n  ",(0,t.jsx)(n.p,{children:"- false: not supported, more storage efficient, can use MATCH_ALL to query multiple keywords"}),"\n  ",(0,t.jsx)(n.p,{children:"- From versions 2.0.14, 2.1.5 and 3.0.1, the default is true if parser is set. Otherwise default to false."}),"\n",(0,t.jsx)(n.p,{children:"For example, the following example specifies Chinese tokenization, coarse-grained mode, and supports phrase query acceleration."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'   INDEX idx_name(column_name) USING INVERTED PROPERTIES("parser" = "chinese", "parser_mode" = "coarse_grained", "support_phrase" = "true")\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.details,{children:["\n  ",(0,t.jsx)(n.summary,{children:"char_filter"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Specifies preprocessing the text before tokenization, usually to affect tokenization behavior"})}),"\n  ",(0,t.jsx)(n.p,{children:"char_filter_type: specifies different functional char_filters (currently only supports char_replace)"}),"\n  ",(0,t.jsx)(n.p,{children:"char_replace replaces each char in the pattern with a char in the replacement"}),"\n  ",(0,t.jsx)(n.p,{children:"- char_filter_pattern: characters to be replaced"}),"\n  ",(0,t.jsx)(n.p,{children:"- char_filter_replacement: replacement character array, optional, defaults to a space character"}),"\n",(0,t.jsx)(n.p,{children:"For example, the following example replaces dots and underscores with spaces, thus treating them as word separators, affecting tokenization behavior."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'   INDEX idx_name(column_name) USING INVERTED PROPERTIES("parser" = "unicode", "char_filter_type" = "char_replace", "char_filter_pattern" = "._", "char_filter_replacement" = " ")\n'})}),"\n",(0,t.jsx)(n.p,{children:"`"}),"\n"]}),"\n",(0,t.jsxs)(n.details,{children:["\n  ",(0,t.jsx)(n.summary,{children:"ignore_above"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Specifies the length limit for non-tokenized string indexes (parser not specified)"})}),"\n  ",(0,t.jsx)(n.p,{children:"- Strings longer than the length set by ignore_above will not be indexed. For string arrays, ignore_above applies to each array element separately, and elements longer than ignore_above will not be indexed."}),"\n  ",(0,t.jsx)(n.p,{children:"- Default is 256, unit is bytes"}),"\n"]}),"\n",(0,t.jsxs)(n.details,{children:["\n  ",(0,t.jsx)(n.summary,{children:"lower_case"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Whether to convert tokens to lowercase for case-insensitive matching"})}),"\n  ",(0,t.jsx)(n.p,{children:"- true: convert to lowercase"}),"\n  ",(0,t.jsx)(n.p,{children:"- false: do not convert to lowercase"}),"\n  ",(0,t.jsx)(n.p,{children:"- From versions 2.0.7 and 2.1.2, the default is true, automatically converting to lowercase. Earlier versions default to false."}),"\n"]}),"\n",(0,t.jsxs)(n.details,{children:["\n  ",(0,t.jsx)(n.summary,{children:"stopwords"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Specifying the stopword list to use, which will affect the behavior of the tokenizer"})}),"\n  ",(0,t.jsx)(n.p,{children:"- The default built-in stopword list includes meaningless words such as 'is,' 'the,' 'a,' etc. When writing or querying, the tokenizer will ignore words that are in the stopword list."}),"\n  ",(0,t.jsx)(n.p,{children:"- none: Use an empty stopword list"}),"\n"]}),"\n",(0,t.jsxs)(n.details,{children:["\n  ",(0,t.jsx)(n.summary,{children:"dict_compression (Supported since 3.1.0)"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Specifies whether to enable ZSTD dictionary compression for the inverted index term dictionary"})}),"\n  ",(0,t.jsx)(n.p,{children:"- true: Enable dictionary compression, which can reduce index storage size by up to 20%, especially effective for large-scale text data and log analysis scenarios"}),"\n  ",(0,t.jsx)(n.p,{children:"- false: Disable dictionary compression (default)"}),"\n  ",(0,t.jsx)(n.p,{children:'- Recommendation: Enable for scenarios with large text datasets, log analytics, or when storage cost is a concern. Works best with inverted_index_storage_format = "V3"'}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'   INDEX idx_name(column_name) USING INVERTED PROPERTIES("parser" = "english", "dict_compression" = "true")\n'})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["4. ",(0,t.jsx)(n.code,{children:"COMMENT"})," is optional for specifying index comments"]})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["5. Table-level property ",(0,t.jsx)(n.code,{children:"inverted_index_storage_format"})," (Supported since 3.1.0)"]})}),"\n",(0,t.jsx)(n.p,{children:"To use the new V3 storage format for inverted indexes, specify this property when creating the table:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE table_name (\n    column_name TEXT,\n    INDEX idx_name(column_name) USING INVERTED PROPERTIES("parser" = "english", "dict_compression" = "true")\n) PROPERTIES (\n    "inverted_index_storage_format" = "V3"\n);\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"inverted_index_storage_format values:"})}),"\n  ",(0,t.jsx)(n.p,{children:'- "V2": Default storage format'}),"\n  ",(0,t.jsx)(n.p,{children:'- "V3": New storage format with optimized compression. Compared to V2, V3 provides:'}),"\n  ",(0,t.jsx)(n.p,{children:"  - Smaller index files, reducing disk usage and I/O overhead"}),"\n  ",(0,t.jsx)(n.p,{children:"  - Up to 20% storage space savings for large-scale text data and log analysis scenarios"}),"\n  ",(0,t.jsx)(n.p,{children:"  - ZSTD dictionary compression for term dictionaries (when dict_compression is enabled)"}),"\n  ",(0,t.jsx)(n.p,{children:"  - Compression for positional information associated with each term"}),"\n  ",(0,t.jsx)(n.p,{children:"- Recommendation: Use V3 for new tables with large text datasets, log analytics workloads, or when storage optimization is important"}),"\n",(0,t.jsx)(n.h3,{id:"adding-inverted-indexes-to-existing-tables",children:"Adding Inverted Indexes to Existing Tables"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. ADD INDEX"})}),"\n",(0,t.jsxs)(n.p,{children:["Supports both ",(0,t.jsx)(n.code,{children:"CREATE INDEX"})," and ",(0,t.jsx)(n.code,{children:"ALTER TABLE ADD INDEX"})," syntax. The parameters are the same as those used when defining indexes during table creation."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Syntax 1\nCREATE INDEX idx_name ON table_name(column_name) USING INVERTED [PROPERTIES(...)] [COMMENT 'your comment'];\n-- Syntax 2\nALTER TABLE table_name ADD INDEX idx_name(column_name) USING INVERTED [PROPERTIES(...)] [COMMENT 'your comment'];\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. BUILD INDEX"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"CREATE / ADD INDEX"})," operation only adds the index definition. New data written after this operation will generate inverted indexes, but existing data requires using ",(0,t.jsx)(n.code,{children:"BUILD INDEX"})," to trigger indexing:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Syntax 1, by default, builds the index for all partitions in the table\nBUILD INDEX index_name ON table_name;\n-- Syntax 2, you can specify partitions, one or more\nBUILD INDEX index_name ON table_name PARTITIONS(partition_name1, partition_name2);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To check the progress of ",(0,t.jsx)(n.code,{children:"BUILD INDEX"}),", use ",(0,t.jsx)(n.code,{children:"SHOW BUILD INDEX"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'SHOW BUILD INDEX [FROM db_name];\n-- Example 1, view the progress of all BUILD INDEX tasks\nSHOW BUILD INDEX;\n-- Example 2, view the progress of BUILD INDEX tasks for a specific table\nSHOW BUILD INDEX where TableName = "table1";\n'})}),"\n",(0,t.jsxs)(n.p,{children:["To cancel ",(0,t.jsx)(n.code,{children:"BUILD INDEX"}),", use ",(0,t.jsx)(n.code,{children:"CANCEL BUILD INDEX"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CANCEL BUILD INDEX ON table_name;\nCANCEL BUILD INDEX ON table_name (job_id1, job_id2, ...);\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"BUILD INDEX"})," creates an asynchronous task executed by multiple threads on each BE. The number of threads can be set using the BE config ",(0,t.jsx)(n.code,{children:"alter_index_worker_count"}),", with a default value of 3."]}),(0,t.jsxs)(n.p,{children:["In versions before 2.0.12 and 2.1.4, ",(0,t.jsx)(n.code,{children:"BUILD INDEX"})," would keep retrying until it succeeded. Starting from these versions, failure and timeout mechanisms prevent endless retries. 3.0 (Cloud Mode) does not support this command as this moment."]}),(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["If the majority of replicas for a tablet fail to ",(0,t.jsx)(n.code,{children:"BUILD INDEX"}),", the entire ",(0,t.jsx)(n.code,{children:"BUILD INDEX"})," operation fails."]}),"\n",(0,t.jsxs)(n.li,{children:["If the time exceeds ",(0,t.jsx)(n.code,{children:"alter_table_timeout_second"}),", the ",(0,t.jsx)(n.code,{children:"BUILD INDEX"})," operation times out."]}),"\n",(0,t.jsxs)(n.li,{children:["Users can trigger ",(0,t.jsx)(n.code,{children:"BUILD INDEX"})," multiple times; indexes that have already been built successfully will not be rebuilt."]}),"\n"]})]}),"\n",(0,t.jsx)(n.h3,{id:"deleting-inverted-indexes-from-existing-tables",children:"Deleting Inverted Indexes from Existing Tables"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Syntax 1\nDROP INDEX idx_name ON table_name;\n-- Syntax 2\nALTER TABLE table_name DROP INDEX idx_name;\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"DROP INDEX"})," deletes the index definition, so new data will no longer write to the index. This creates an asynchronous task to perform the index deletion, executed by multiple threads on each BE. The number of threads can be set using the BE parameter ",(0,t.jsx)(n.code,{children:"alter_index_worker_count"}),", with a default value of 3."]})}),"\n",(0,t.jsx)(n.h3,{id:"viewing-inverted-index",children:"Viewing Inverted Index"}),"\n",(0,t.jsx)(n.p,{children:"-- Syntax 1: The INDEX section in the table schema with USING INVERTED indicates an inverted index\nSHOW CREATE TABLE table_name;"}),"\n",(0,t.jsx)(n.p,{children:"-- Syntax 2: IndexType as INVERTED indicates an inverted index\nSHOW INDEX FROM idx_name;"}),"\n",(0,t.jsx)(n.h2,{id:"using-indexes",children:"Using Indexes"}),"\n",(0,t.jsx)(n.h3,{id:"accelerating-queries-with-inverted-indexes",children:"Accelerating Queries with Inverted Indexes"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- 1. Full-text search keyword matching using MATCH_ANY and MATCH_ALL\nSELECT * FROM table_name WHERE column_name MATCH_ANY | MATCH_ALL 'keyword1 ...';\n\n-- 1.1 Rows in the content column containing keyword1\nSELECT * FROM table_name WHERE content MATCH_ANY 'keyword1';\n\n-- 1.2 Rows in the content column containing keyword1 or keyword2; you can add more keywords\nSELECT * FROM table_name WHERE content MATCH_ANY 'keyword1 keyword2';\n\n-- 1.3 Rows in the content column containing both keyword1 and keyword2; you can add more keywords\nSELECT * FROM table_name WHERE content MATCH_ALL 'keyword1 keyword2';\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- 2. Full-text search phrase matching using MATCH_PHRASE\n\n-- 2.1 Rows in the content column containing both keyword1 and keyword2, where keyword2 must immediately follow keyword1\n-- 'keyword1 keyword2', 'wordx keyword1 keyword2', 'wordx keyword1 keyword2 wordy' all match because they contain 'keyword1 keyword2' with keyword2 immediately following keyword1\n-- 'keyword1 wordx keyword2' does not match because there is a word between keyword1 and keyword2\n-- 'keyword2 keyword1' does not match because the order is reversed\n-- To use MATCH_PHRASE, you need to enable \"support_phrase\" = \"true\" in PROPERTIES.\nSELECT * FROM table_name WHERE content MATCH_PHRASE 'keyword1 keyword2';\n\n-- 2.2 Rows in the content column containing both keyword1 and keyword2, with a slop (maximum word distance) of 3\n-- 'keyword1 keyword2', 'keyword1 a keyword2', 'keyword1 a b c keyword2' all match because the slop is 0, 1, and 3 respectively, all within 3\n-- 'keyword1 a b c d keyword2' does not match because the slop is 4, exceeding 3\n-- 'keyword2 keyword1', 'keyword2 a keyword1', 'keyword2 a b c keyword1' also match because when slop > 0, the order of keyword1 and keyword2 is not required. To enforce the order, Doris provides a + sign after slop\nSELECT * FROM table_name WHERE content MATCH_PHRASE 'keyword1 keyword2 ~3';\n-- To enforce order, use a positive sign with slop; 'keyword1 a b c keyword2' matches, while 'keyword2 a b c keyword1' does not\nSELECT * FROM table_name WHERE content MATCH_PHRASE 'keyword1 keyword2 ~3+';\n\n-- 2.3 Prefix matching the last word keyword2, with a default limit of 50 prefixes (controlled by session variable inverted_index_max_expansions)\n-- It is necessary to ensure that keyword1 and keyword2 remain adjacent in the original text after tokenization, with no other words in between.\n-- 'keyword1 keyword2abc' matches because keyword1 is identical and keyword2abc is a prefix of keyword2\n-- 'keyword1 keyword2' also matches because keyword2 is a prefix of keyword2\n-- 'keyword1 keyword3' does not match because keyword3 is not a prefix of keyword2\n-- 'keyword1 keyword3abc' does not match because keyword3abc is not a prefix of keyword2\nSELECT * FROM table_name WHERE content MATCH_PHRASE_PREFIX 'keyword1 keyword2';\n\n-- 2.4 If only one word is provided, it defaults to a prefix query with a limit of 50 prefixes (controlled by session variable inverted_index_max_expansions)\nSELECT * FROM table_name WHERE content MATCH_PHRASE_PREFIX 'keyword1';\n\n-- 2.5 Regular expression matching on tokenized words, with a default limit of 50 matches (controlled by session variable inverted_index_max_expansions)\n-- Similar to MATCH_PHRASE_PREFIX but with regex instead of prefix\nSELECT * FROM table_name WHERE content MATCH_REGEXP 'key.*';\n\n-- 3. Normal equality, range, IN, and NOT IN queries using standard SQL syntax, for example:\nSELECT * FROM table_name WHERE id = 123;\nSELECT * FROM table_name WHERE ts > '2023-01-01 00:00:00';\nSELECT * FROM table_name WHERE op_type IN ('add', 'delete');\n\n-- 4. Full-text search across multiple columns using the multi_match function\n-- Parameters:\n--   First N parameters are column names to search\n--   Second-to-last parameter specifies match mode: 'any'/'all'/'phrase'/'phrase_prefix'\n--   Last parameter is the keyword or phrase to search for\n\n-- 4.1 Rows where 'keyword1' appears in ANY of col1,col2,col3 (OR logic)\nselect * FROM table_name WHERE multi_match(col1, col2, col3, 'any', 'keyword1');\n\n-- 4.2 Rows where 'keyword1' appears in ALL of col1,col2,col3 (AND logic)\nselect * FROM table_name WHERE multi_match(col1, col2, col3, 'all', 'keyword1');\n\n-- 4.3 Rows where the exact phrase 'keyword1' appears in ANY of col1,col2,col3 (exact phrase match)\nselect * FROM table_name WHERE multi_match(col1, col2, col3, 'phrase', 'keyword1');\n\n-- 4.4 Rows where a phrase starting with 'keyword1' appears in ANY of col1,col2,col3 (phrase prefix match)\n-- For example, will match content like \"keyword123\"\nselect * FROM table_name WHERE multi_match(col1, col2, col3, 'phrase_prefix', 'keyword1');\n"})}),"\n",(0,t.jsx)(n.h3,{id:"analyzing-index-acceleration-effects-through-profiles",children:"Analyzing Index Acceleration Effects Through Profiles"}),"\n",(0,t.jsxs)(n.p,{children:["Inverted query acceleration can be toggled using the session variable ",(0,t.jsx)(n.code,{children:"enable_inverted_index_query"}),", which is set to true by default. To verify the acceleration effect of the index, it can be set to false to turn it off."]}),"\n",(0,t.jsx)(n.p,{children:"The acceleration effect of the inverted index can be analyzed using the following metrics in the Query Profile:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"RowsInvertedIndexFiltered: The number of rows filtered by the inverted index, which can be compared with other Rows values to analyze the filtering effect of the index."}),"\n",(0,t.jsxs)(n.li,{children:["InvertedIndexFilterTime: The time consumed by the inverted index.\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"InvertedIndexSearcherOpenTime: The time taken to open the inverted index."}),"\n",(0,t.jsx)(n.li,{children:"InvertedIndexSearcherSearchTime: The time taken for internal queries within the inverted index."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"verifying-tokenization-effects-using-tokenization-functions",children:"Verifying Tokenization Effects Using Tokenization Functions"}),"\n",(0,t.jsxs)(n.p,{children:["To check the actual effect of tokenization or to tokenize a piece of text, you can use the ",(0,t.jsx)(n.code,{children:"TOKENIZE"})," function for verification."]}),"\n",(0,t.jsxs)(n.p,{children:["The first parameter of the ",(0,t.jsx)(n.code,{children:"TOKENIZE"})," function is the text to be tokenized, and the second parameter specifies the tokenization parameters used when creating the index."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'-- English tokenization\nSELECT TOKENIZE(\'I love Doris\',\'"parser"="english"\');\n+------------------------------------------------+\n| tokenize(\'I love Doris\', \'"parser"="english"\') |\n+------------------------------------------------+\n| ["i", "love", "doris"]                         |\n+------------------------------------------------+\n\n-- ICU tokenization for multilingual text (Supported since 3.1.0)\nSELECT TOKENIZE(\'\u0645\u0631\u062D\u0628\u0627 \u0628\u0627\u0644\u0639\u0627\u0644\u0645 Hello \u4E16\u754C\', \'"parser"="icu"\');\n+--------------------------------------------------------+\n| tokenize(\'\u0645\u0631\u062D\u0628\u0627 \u0628\u0627\u0644\u0639\u0627\u0644\u0645 Hello \u4E16\u754C\', \'"parser"="icu"\') |\n+--------------------------------------------------------+\n| ["\u0645\u0631\u062D\u0628\u0627", "\u0628\u0627\u0644\u0639\u0627\u0644\u0645", "Hello", "\u4E16\u754C"]                   |\n+--------------------------------------------------------+\n\nSELECT TOKENIZE(\'\u0E21\u0E19\u0E44\u0E21\u0E40\u0E1B\u0E19\u0E44\u0E1B\u0E15\u0E32\u0E21\u0E04\u0E27\u0E32\u0E21\u0E15\u0E2D\u0E07\u0E01\u0E32\u0E23\', \'"parser"="icu"\');\n+-------------------------------------------------------------------+\n| tokenize(\'\u0E21\u0E19\u0E44\u0E21\u0E40\u0E1B\u0E19\u0E44\u0E1B\u0E15\u0E32\u0E21\u0E04\u0E27\u0E32\u0E21\u0E15\u0E2D\u0E07\u0E01\u0E32\u0E23\', \'"parser"="icu"\')            |\n+-------------------------------------------------------------------+\n| ["\u0E21\u0E19", "\u0E44\u0E21\u0E40\u0E1B\u0E19", "\u0E44\u0E1B", "\u0E15\u0E32\u0E21", "\u0E04\u0E27\u0E32\u0E21", "\u0E15\u0E2D\u0E07\u0E01\u0E32\u0E23"]                  |\n+-------------------------------------------------------------------+\n\n-- Basic tokenization for high performance (Supported since 3.1.0)\nSELECT TOKENIZE(\'Hello World! This is a test.\', \'"parser"="basic"\');\n+-----------------------------------------------------------+\n| tokenize(\'Hello World! This is a test.\', \'"parser"="basic"\') |\n+-----------------------------------------------------------+\n| ["hello", "world", "this", "is", "a", "test"]              |\n+-----------------------------------------------------------+\n\nSELECT TOKENIZE(\'\u4F60\u597D\u4E16\u754C\', \'"parser"="basic"\');\n+-------------------------------------------+\n| tokenize(\'\u4F60\u597D\u4E16\u754C\', \'"parser"="basic"\')   |\n+-------------------------------------------+\n| ["\u4F60", "\u597D", "\u4E16", "\u754C"]                    |\n+-------------------------------------------+\n\nSELECT TOKENIZE(\'Hello\u4F60\u597DWorld\u4E16\u754C\', \'"parser"="basic"\');\n+------------------------------------------------------+\n| tokenize(\'Hello\u4F60\u597DWorld\u4E16\u754C\', \'"parser"="basic"\')    |\n+------------------------------------------------------+\n| ["hello", "\u4F60", "\u597D", "world", "\u4E16", "\u754C"]             |\n+------------------------------------------------------+\n\nSELECT TOKENIZE(\'GET /images/hm_bg.jpg HTTP/1.0\', \'"parser"="basic"\');\n+---------------------------------------------------------------------+\n| tokenize(\'GET /images/hm_bg.jpg HTTP/1.0\', \'"parser"="basic"\')      |\n+---------------------------------------------------------------------+\n| ["get", "images", "hm", "bg", "jpg", "http", "1", "0"]              |\n+---------------------------------------------------------------------+\n'})}),"\n",(0,t.jsx)(n.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,t.jsx)(n.p,{children:"Demonstrating the creation of an inverted index, full-text search, and regular queries using 1 million records from HackerNews. This includes a simple performance comparison with queries without indexing."}),"\n",(0,t.jsx)(n.h3,{id:"table-creation",children:"Table Creation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE DATABASE test_inverted_index;\n\nUSE test_inverted_index;\n\n-- Create a table with an inverted index on the comment field\n--   USING INVERTED specifies the index type as an inverted index\n--   PROPERTIES("parser" = "english") specifies using the "english" tokenizer; other options include "chinese" for Chinese tokenization and "unicode" for mixed-language tokenization. If the "parser" parameter is not specified, no tokenization is applied.\n\nCREATE TABLE hackernews_1m\n(\n    `id` BIGINT,\n    `deleted` TINYINT,\n    `type` String,\n    `author` String,\n    `timestamp` DateTimeV2,\n    `comment` String,\n    `dead` TINYINT,\n    `parent` BIGINT,\n    `poll` BIGINT,\n    `children` Array<BIGINT>,\n    `url` String,\n    `score` INT,\n    `title` String,\n    `parts` Array<INT>,\n    `descendants` INT,\n    INDEX idx_comment (`comment`) USING INVERTED PROPERTIES("parser" = "english") COMMENT \'inverted index for comment\'\n)\nDUPLICATE KEY(`id`)\nDISTRIBUTED BY HASH(`id`) BUCKETS 10\nPROPERTIES ("replication_num" = "1");\n'})}),"\n",(0,t.jsx)(n.h3,{id:"data-import",children:"Data Import"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Importing Data via Stream Load"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'wget https://qa-build.oss-cn-beijing.aliyuncs.com/regression/index/hacknernews_1m.csv.gz\n\ncurl --location-trusted -u root: -H "compress_type:gz" -T hacknernews_1m.csv.gz http://127.0.0.1:8030/api/test_inverted_index/hackernews_1m/_stream_load\n{\n    "TxnId": 2,\n    "Label": "a8a3e802-2329-49e8-912b-04c800a461a6",\n    "TwoPhaseCommit": "false",\n    "Status": "Success",\n    "Message": "OK",\n    "NumberTotalRows": 1000000,\n    "NumberLoadedRows": 1000000,\n    "NumberFilteredRows": 0,\n    "NumberUnselectedRows": 0,\n    "LoadBytes": 130618406,\n    "LoadTimeMs": 8988,\n    "BeginTxnTimeMs": 23,\n    "StreamLoadPutTimeMs": 113,\n    "ReadDataTimeMs": 4788,\n    "WriteDataTimeMs": 8811,\n    "CommitAndPublishTimeMs": 38\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Confirm Data Import Success with SQL count()"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT count() FROM hackernews_1m;\n+---------+\n| count() |\n+---------+\n| 1000000 |\n+---------+\n"})}),"\n",(0,t.jsx)(n.h3,{id:"queries",children:"Queries"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"01 Full-Text Search"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Using ",(0,t.jsx)(n.code,{children:"LIKE"})," to match and count rows containing 'OLAP' in the ",(0,t.jsx)(n.code,{children:"comment"})," column took 0.18s."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT count() FROM hackernews_1m WHERE comment LIKE '%OLAP%';\n+---------+\n| count() |\n+---------+\n|      34 |\n+---------+\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Using full-text search with ",(0,t.jsx)(n.code,{children:"MATCH_ANY"})," based on the inverted index to count rows containing 'OLAP' in the ",(0,t.jsx)(n.code,{children:"comment"})," column took 0.02s, resulting in a 9x speedup. The performance improvement would be even more significant on larger datasets."]}),"\n",(0,t.jsxs)(n.p,{children:["The difference in the number of results is due to the inverted index normalizing the terms by converting them to lowercase, among other processes, hence ",(0,t.jsx)(n.code,{children:"MATCH_ANY"})," yields more results than ",(0,t.jsx)(n.code,{children:"LIKE"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT count() FROM hackernews_1m WHERE comment MATCH_ANY 'OLAP';\n+---------+\n| count() |\n+---------+\n|      35 |\n+---------+\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Similarly, comparing the performance for counting occurrences of 'OLTP', 0.07s vs 0.01s. Due to caching, both ",(0,t.jsx)(n.code,{children:"LIKE"})," and ",(0,t.jsx)(n.code,{children:"MATCH_ANY"})," improved, but the inverted index still provided a 7x speedup."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT count() FROM hackernews_1m WHERE comment LIKE '%OLTP%';\n+---------+\n| count() |\n+---------+\n|      48 |\n+---------+\n\n\nSELECT count() FROM hackernews_1m WHERE comment MATCH_ANY 'OLTP';\n+---------+\n| count() |\n+---------+\n|      51 |\n+---------+\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Counting rows where both 'OLAP' and 'OLTP' appear took 0.13s vs 0.01s, a 13x speedup."}),"\n",(0,t.jsxs)(n.p,{children:["To require multiple terms to appear simultaneously (AND relationship), use ",(0,t.jsx)(n.code,{children:"MATCH_ALL 'keyword1 keyword2 ...'"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT count() FROM hackernews_1m WHERE comment LIKE '%OLAP%' AND comment LIKE '%OLTP%';\n+---------+\n| count() |\n+---------+\n|      14 |\n+---------+\n\n\nSELECT count() FROM hackernews_1m WHERE comment MATCH_ALL 'OLAP OLTP';\n+---------+\n| count() |\n+---------+\n|      15 |\n+---------+\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Counting rows where either 'OLAP' or 'OLTP' appears took 0.12s vs 0.01s, a 12x speedup."}),"\n",(0,t.jsxs)(n.p,{children:["To require any one or more of multiple terms to appear (OR relationship), use ",(0,t.jsx)(n.code,{children:"MATCH_ANY 'keyword1 keyword2 ...'"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT count() FROM hackernews_1m WHERE comment LIKE '%OLAP%' OR comment LIKE '%OLTP%';\n+---------+\n| count() |\n+---------+\n|      68 |\n+---------+\n\nSELECT count() FROM hackernews_1m WHERE comment MATCH_ANY 'OLAP OLTP';\n+---------+\n| count() |\n+---------+\n|      71 |\n+---------+\n"})}),"\n",(0,t.jsx)(n.h3,{id:"02-standard-equality-and-range-queries",children:"02 Standard Equality and Range Queries"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Range query on a ",(0,t.jsx)(n.code,{children:"DateTime"})," type column"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT count() FROM hackernews_1m WHERE timestamp > '2007-08-23 04:17:00';\n+---------+\n| count() |\n+---------+\n|  999081 |\n+---------+\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Adding an inverted index for the ",(0,t.jsx)(n.code,{children:"timestamp"})," column"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- For date-time types, USING INVERTED does not require specifying a parser\n-- CREATE INDEX is one syntax for creating an index, another method will be shown later\nCREATE INDEX idx_timestamp ON hackernews_1m(timestamp) USING INVERTED;\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"BUILD INDEX idx_timestamp ON hackernews_1m;\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Checking the index creation progress. From the difference between ",(0,t.jsx)(n.code,{children:"FinishTime"})," and ",(0,t.jsx)(n.code,{children:"CreateTime"}),", we can see that building the inverted index for 1 million rows on the ",(0,t.jsx)(n.code,{children:"timestamp"})," column took only 1 second."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SHOW ALTER TABLE COLUMN;\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| JobId | TableName     | CreateTime              | FinishTime              | IndexName     | IndexId | OriginIndexId | SchemaVersion | TransactionId | State    | Msg  | Progress | Timeout |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| 10030 | hackernews_1m | 2023-02-10 19:44:12.929 | 2023-02-10 19:44:13.938 | hackernews_1m | 10031   | 10008         | 1:1994690496  | 3             | FINISHED |      | NULL     | 2592000 |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- If the table has no partitions, PartitionName defaults to TableName\nSHOW BUILD INDEX;\n+-------+---------------+---------------+----------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| JobId | TableName     | PartitionName | AlterInvertedIndexes                                     | CreateTime              | FinishTime              | TransactionId | State    | Msg  | Progress |\n+-------+---------------+---------------+----------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| 10191 | hackernews_1m | hackernews_1m | [ADD INDEX idx_timestamp (`timestamp`) USING INVERTED],  | 2023-06-26 15:32:33.894 | 2023-06-26 15:32:34.847 | 3             | FINISHED |      | NULL     |\n+-------+---------------+---------------+----------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"After the index is created, range queries use the same query syntax. Doris will automatically recognize the index for optimization. However, due to the small dataset, the performance difference is not significant."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT count() FROM hackernews_1m WHERE timestamp > '2007-08-23 04:17:00';\n+---------+\n| count() |\n+---------+\n|  999081 |\n+---------+\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Performing similar operations on a numeric column ",(0,t.jsx)(n.code,{children:"parent"})," with an equality match query."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT count() FROM hackernews_1m WHERE parent = 11189;\n+---------+\n| count() |\n+---------+\n|       2 |\n+---------+\n\n-- For numeric types, USING INVERTED does not require specifying a parser\n-- ALTER TABLE t ADD INDEX is the second syntax for creating an index\nALTER TABLE hackernews_1m ADD INDEX idx_parent(parent) USING INVERTED;\n\n\n-- Execute BUILD INDEX to create the inverted index for existing data\nBUILD INDEX idx_parent ON hackernews_1m;\n\n\nSHOW ALTER TABLE COLUMN;\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| JobId | TableName     | CreateTime              | FinishTime              | IndexName     | IndexId | OriginIndexId | SchemaVersion | TransactionId | State    | Msg  | Progress | Timeout |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| 10030 | hackernews_1m | 2023-02-10 19:44:12.929 | 2023-02-10 19:44:13.938 | hackernews_1m | 10031   | 10008         | 1:1994690496  | 3             | FINISHED |      | NULL     | 2592000 |\n| 10053 | hackernews_1m | 2023-02-10 19:49:32.893 | 2023-02-10 19:49:33.982 | hackernews_1m | 10054   | 10008         | 1:378856428   | 4             | FINISHED |      | NULL     | 2592000 |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n\nSHOW BUILD INDEX;\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| JobId | TableName     | PartitionName | AlterInvertedIndexes                               | CreateTime              | FinishTime              | TransactionId | State    | Msg  | Progress |\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| 11005 | hackernews_1m | hackernews_1m | [ADD INDEX idx_parent (`parent`) USING INVERTED],  | 2023-06-26 16:25:10.167 | 2023-06-26 16:25:10.838 | 1002          | FINISHED |      | NULL     |\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n\n\nSELECT count() FROM hackernews_1m WHERE parent = 11189;\n+---------+\n| count() |\n+---------+\n|       2 |\n+---------+\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Creating an inverted index for the string column ",(0,t.jsx)(n.code,{children:"author"})," without tokenization. Equality queries can also leverage the index for speedup."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT count() FROM hackernews_1m WHERE author = 'faster';\n+---------+\n| count() |\n+---------+\n|      20 |\n+---------+\n\n\n-- Here, USING INVERTED is used without tokenizing the `author` column, treating it as a single term\nALTER TABLE hackernews_1m ADD INDEX idx_author(author) USING INVERTED;\n\n\n-- Execute BUILD INDEX to add the inverted index for existing data\nBUILD INDEX idx_author ON hackernews_1m;\n\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Creating an incremental index for 1 million author records took only 1.5 seconds."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SHOW ALTER TABLE COLUMN;\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| JobId | TableName     | CreateTime              | FinishTime              | IndexName     | IndexId | OriginIndexId | SchemaVersion | TransactionId | State    | Msg  | Progress | Timeout |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| 10030 | hackernews_1m | 2023-02-10 19:44:12.929 | 2023-02-10 19:44:13.938 | hackernews_1m | 10031   | 10008         | 1:1994690496  | 3             | FINISHED |      | NULL     | 2592000 |\n| 10053 | hackernews_1m | 2023-02-10 19:49:32.893 | 2023-02-10 19:49:33.982 | hackernews_1m | 10054   | 10008         | 1:378856428   | 4             | FINISHED |      | NULL     | 2592000 |\n| 10076 | hackernews_1m | 2023-02-10 19:54:20.046 | 2023-02-10 19:54:21.521 | hackernews_1m | 10077   | 10008         | 1:1335127701  | 5             | FINISHED |      | NULL     | 2592000 |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SHOW BUILD INDEX ORDER BY CreateTime DESC LIMIT 1;\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| JobId | TableName     | PartitionName | AlterInvertedIndexes                               | CreateTime              | FinishTime              | TransactionId | State    | Msg  | Progress |\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| 13006 | hackernews_1m | hackernews_1m | [ADD INDEX idx_author (`author`) USING INVERTED],  | 2023-06-26 17:23:02.610 | 2023-06-26 17:23:03.755 | 3004          | FINISHED |      | NULL     |\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"-- After creating the index, string equality matches also showed significant acceleration."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT count() FROM hackernews_1m WHERE author = 'faster';\n+---------+\n| count() |\n+---------+\n|      20 |\n+---------+\n"})})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return o},a:function(){return a}});var r=i(667294);let t={},s=r.createContext(t);function a(e){let n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);