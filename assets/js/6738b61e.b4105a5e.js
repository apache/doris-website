"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["295880"],{844351:function(e,n,a){a.r(n),a.d(n,{default:()=>d,frontMatter:()=>c,metadata:()=>t,assets:()=>l,toc:()=>h,contentTitle:()=>r});var t=JSON.parse('{"id":"lakehouse/data-cache","title":"Data Cache","description":"Data Cache accelerates subsequent queries of the same data by caching recently accessed data files from remote storage systems (HDFS or object ","source":"@site/docs/lakehouse/data-cache.md","sourceDirName":"lakehouse","slug":"/lakehouse/data-cache","permalink":"/docs/dev/lakehouse/data-cache","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Data Cache","language":"en","description":"Data Cache accelerates subsequent queries of the same data by caching recently accessed data files from remote storage systems (HDFS or object "},"sidebar":"docs","previous":{"title":"Text/CSV/JSON","permalink":"/docs/dev/lakehouse/file-formats/text"},"next":{"title":"Metadata Cache","permalink":"/docs/dev/lakehouse/meta-cache"}}'),i=a("785893"),s=a("250065");let c={title:"Data Cache",language:"en",description:"Data Cache accelerates subsequent queries of the same data by caching recently accessed data files from remote storage systems (HDFS or object "},r=void 0,l={},h=[{value:"Applicable Scenarios",id:"applicable-scenarios",level:2},{value:"Enabling Data Cache",id:"enabling-data-cache",level:2},{value:"BE Configuration",id:"be-configuration",level:3},{value:"FE Configuration",id:"fe-configuration",level:3},{value:"Cache Observability",id:"cache-observability",level:2},{value:"View Cache Hit Rate",id:"view-cache-hit-rate",level:3},{value:"Monitoring Metrics",id:"monitoring-metrics",level:3},{value:"Cache Query Limit",id:"cache-query-limit",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Cache Warmup",id:"cache-warmup",level:2},{value:"Syntax",id:"syntax",level:3},{value:"Examples",id:"examples",level:3},{value:"Execution Results",id:"execution-results",level:3},{value:"Appendix",id:"appendix",level:2},{value:"Principle",id:"principle",level:3}];function o(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Data Cache accelerates subsequent queries of the same data by caching recently accessed data files from remote storage systems (HDFS or object storage) to local disks. In scenarios where the same data is frequently accessed, Data Cache can avoid the overhead of repeated remote data access, improving the performance and stability of query analysis on hot data."}),"\n",(0,i.jsx)(n.h2,{id:"applicable-scenarios",children:"Applicable Scenarios"}),"\n",(0,i.jsx)(n.p,{children:"The data cache function only works for queries on Hive, Iceberg, Hudi, and Paimon tables. It has no effect on internal table queries or non-file external table queries (such as JDBC, Elasticsearch)."}),"\n",(0,i.jsx)(n.p,{children:"Whether data caching can improve query efficiency depends on multiple factors. Below are the applicable scenarios for data caching:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"High-speed local disk"}),"\n",(0,i.jsx)(n.p,{children:"It is recommended to use high-speed local disks, such as SSD or NVME media local disks, as the data cache directory. It is not recommended to use mechanical hard drives as the data cache directory. Essentially, the local disk's IO bandwidth and IOPS must be significantly higher than the network bandwidth and the source storage system's IO bandwidth and IOPS to bring noticeable performance improvements."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Sufficient cache space size"}),"\n",(0,i.jsx)(n.p,{children:"Data caching uses the LRU strategy as the cache eviction policy. If the queried data does not have a clear distinction between hot and cold, the cached data may be frequently updated and replaced, which may reduce query performance. It is recommended to enable data caching in scenarios where the query pattern has a clear distinction between hot and cold (e.g., most queries only access today's data and rarely access historical data), and the cache space is sufficient to store hot data."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Unstable IO latency of remote storage"}),"\n",(0,i.jsx)(n.p,{children:"This situation usually occurs on HDFS storage. In most enterprises, different business departments share the same HDFS, which may lead to very unstable IO latency during peak periods. In this case, if you need to ensure stable IO latency, it is recommended to enable data caching. However, the first two conditions should still be considered."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"enabling-data-cache",children:"Enabling Data Cache"}),"\n",(0,i.jsx)(n.p,{children:"The data cache function is disabled by default and needs to be enabled by setting relevant parameters in FE and BE."}),"\n",(0,i.jsx)(n.h3,{id:"be-configuration",children:"BE Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["First, configure the cache path information in ",(0,i.jsx)(n.code,{children:"be.conf"})," and restart the BE node to make the configuration effective."]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"enable_file_cache"})}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Whether to enable Data Cache, default is false"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"file_cache_path"})}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Configuration related to the cache directory, in JSON format."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"clear_file_cache"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Default is false. If true, the cache directory will be cleared when the BE node restarts."})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["Example configuration of ",(0,i.jsx)(n.code,{children:"file_cache_path"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'file_cache_path=[{"path": "/path/to/file_cache1", "total_size":53687091200},{"path": "/path/to/file_cache2", "total_size":53687091200},{"path": "/path/to/file_cache3", "total_size":53687091200}]\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"path"})," is the path where the cache is stored, and one or more paths can be configured. It is recommended to configure only one path per disk."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"total_size"})," is the upper limit of the cache space size, in bytes. When the cache space is exceeded, the LRU strategy will be used to evict cached data."]}),"\n",(0,i.jsx)(n.h3,{id:"fe-configuration",children:"FE Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Enable Data Cache in a single session:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SET enable_file_cache = true;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Enable Data Cache globally:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SET GLOBAL enable_file_cache = true;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Note that if ",(0,i.jsx)(n.code,{children:"enable_file_cache"})," is not enabled, the cache will not be used even if the BE is configured with a cache directory. Similarly, if the BE is not configured with a cache directory, the cache will not be used even if ",(0,i.jsx)(n.code,{children:"enable_file_cache"})," is enabled."]}),"\n",(0,i.jsx)(n.h2,{id:"cache-observability",children:"Cache Observability"}),"\n",(0,i.jsx)(n.h3,{id:"view-cache-hit-rate",children:"View Cache Hit Rate"}),"\n",(0,i.jsxs)(n.p,{children:["Execute ",(0,i.jsx)(n.code,{children:"set enable_profile=true"})," to open the session variable, and you can view the job's Profile on the ",(0,i.jsx)(n.code,{children:"Queries"})," tab of the FE web page. The data cache-related metrics are as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-  FileCache:  0ns\n    -  BytesScannedFromCache:  2.02  GB\n    -  BytesScannedFromRemote:  0.00  \n    -  BytesWriteIntoCache:  0.00  \n    -  LocalIOUseTimer:  2s723ms\n    -  NumLocalIOTotal:  444\n    -  NumRemoteIOTotal:  0\n    -  NumSkipCacheIOTotal:  0\n    -  RemoteIOUseTimer:  0ns\n    -  WriteCacheIOUseTimer:  0ns\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"BytesScannedFromCache"}),": The amount of data read from the local cache."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"BytesScannedFromRemote"}),": The amount of data read from the remote."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"BytesWriteIntoCache"}),": The amount of data written into the cache."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"LocalIOUseTimer"}),": The IO time of the local cache."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"RemoteIOUseTimer"}),": The IO time of remote reading."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"NumLocalIOTotal"}),": The number of IO operations on the local cache."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"NumRemoteIOTotal"}),": The number of remote IO operations."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"WriteCacheIOUseTimer"}),": The IO time of writing into the cache."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"BytesScannedFromRemote"})," is 0, it means the cache is fully hit."]}),"\n",(0,i.jsx)(n.h3,{id:"monitoring-metrics",children:"Monitoring Metrics"}),"\n",(0,i.jsxs)(n.p,{children:["Users can view cache statistics for each Backend node through the system table ",(0,i.jsx)(n.a,{href:"../admin-manual/system-tables/information_schema/file_cache_statistics",children:(0,i.jsx)(n.code,{children:"file_cache_statistics"})}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"cache-query-limit",children:"Cache Query Limit"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"This feature is supported since version 4.0.3."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The Cache Query Limit feature allows users to limit the percentage of file cache that a single query can use. In scenarios where multiple users or complex queries share cache resources, a single large query might occupy too much cache space, causing other queries' hot data to be evicted. By setting a query limit, you can ensure fair resource usage and prevent cache thrashing."}),"\n",(0,i.jsx)(n.p,{children:"The cache space occupied by a query refers to the total size of data populated into the cache due to cache misses. If the total size populated by the query reaches the quota limit, subsequent data populated by the query will replace the previously populated data based on the LRU algorithm."}),"\n",(0,i.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"This feature involves configuration on BE and FE, as well as session variable settings."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. BE Configuration"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enable_file_cache_query_limit"}),":\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Type: Boolean"}),"\n",(0,i.jsxs)(n.li,{children:["Default: ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.li,{children:"Description: The master switch for the file cache query limit feature on the BE side. Only when enabled will the BE process the query limit parameters passed from the FE."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"2. FE Configuration"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"file_cache_query_limit_max_percent"}),":\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Type: Integer"}),"\n",(0,i.jsxs)(n.li,{children:["Default: ",(0,i.jsx)(n.code,{children:"100"})]}),"\n",(0,i.jsx)(n.li,{children:"Description: The max query limit constraint used to validate the upper limit of session variables. It ensures that the query limit set by users does not exceed this value."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"3. Session Variables"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"file_cache_query_limit_percent"}),":\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Type: Integer (1-100)"}),"\n",(0,i.jsxs)(n.li,{children:["Description: The file cache query limit percentage. It sets the maximum percentage of cache a query can use. This value is constrained by ",(0,i.jsx)(n.code,{children:"file_cache_query_limit_max_percent"}),". It is recommended that the calculated cache quota is not less than 256MB. If it is lower than this value, the BE will print a warning in the log."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage Example"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Set session variable to limit a query to use at most 50% of the cache\nSET file_cache_query_limit_percent = 50;\n\n-- Execute query\nSELECT * FROM large_table;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Note:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["The value must be within the range [0, ",(0,i.jsx)(n.code,{children:"file_cache_query_limit_max_percent"}),"]."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"cache-warmup",children:"Cache Warmup"}),"\n",(0,i.jsx)(n.p,{children:'Data Cache provides a cache "warmup" feature that allows preloading external data into the local cache of BE nodes, thereby improving cache hit rates and query performance for subsequent first-time queries.'}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"This feature is supported since version 4.0.2."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"syntax",children:"Syntax"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"WARM UP SELECT <select_expr_list>\nFROM <table_reference>\n[WHERE <boolean_expression>]\n"})}),"\n",(0,i.jsx)(n.p,{children:"Usage restrictions:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Supported:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Single table queries (only one table_reference allowed)"}),"\n",(0,i.jsx)(n.li,{children:"Simple SELECT for specified columns"}),"\n",(0,i.jsx)(n.li,{children:"WHERE filtering (supports regular predicates)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Not supported:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"JOIN, UNION, subqueries, CTE"}),"\n",(0,i.jsx)(n.li,{children:"GROUP BY, HAVING, ORDER BY"}),"\n",(0,i.jsx)(n.li,{children:"LIMIT"}),"\n",(0,i.jsx)(n.li,{children:"INTO OUTFILE"}),"\n",(0,i.jsx)(n.li,{children:"Multi-table / complex query plans"}),"\n",(0,i.jsx)(n.li,{children:"Other complex syntax"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Warm up the entire table"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"WARM UP SELECT * FROM hive_db.tpch100_parquet.lineitem;\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Warm up partial columns by partition"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"WARM UP SELECT l_orderkey, l_shipmode\nFROM hive_db.tpch100_parquet.lineitem\nWHERE dt = '2025-01-01';\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Warm up partial columns by filter conditions"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"WARM UP SELECT l_shipmode, l_linestatus\nFROM hive_db.tpch100_parquet.lineitem\nWHERE l_orderkey = 123456;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"execution-results",children:"Execution Results"}),"\n",(0,i.jsxs)(n.p,{children:["After executing ",(0,i.jsx)(n.code,{children:"WARM UP SELECT"}),", the FE dispatches tasks to each BE. The BE scans remote data and writes it to Data Cache."]}),"\n",(0,i.jsx)(n.p,{children:"The system directly returns scan and cache write statistics for each BE (Note: Statistics are generally accurate but may have some margin of error). For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"+---------------+-----------+-------------+---------------------------+----------------------------+---------------------+\n| BackendId     | ScanRows  | ScanBytes   | ScanBytesFromLocalStorage | ScanBytesFromRemoteStorage | BytesWriteIntoCache |\n+---------------+-----------+-------------+---------------------------+----------------------------+---------------------+\n| 1755134092928 | 294744184 | 11821864798 | 538154009                 | 11283717130                | 11899799492         |\n| 1755134092929 | 305293718 | 12244439301 | 560970435                 | 11683475207                | 12332861380         |\n| TOTAL         | 600037902 | 24066304099 | 1099124444                | 22967192337                | 24232660872         |\n+---------------+-----------+-------------+---------------------------+----------------------------+---------------------+\n"})}),"\n",(0,i.jsx)(n.p,{children:"Field explanations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"ScanRows: Number of rows scanned and read."}),"\n",(0,i.jsx)(n.li,{children:"ScanBytes: Amount of data scanned and read."}),"\n",(0,i.jsx)(n.li,{children:"ScanBytesFromLocalStorage: Amount of data scanned and read from local cache."}),"\n",(0,i.jsx)(n.li,{children:"ScanBytesFromRemoteStorage: Amount of data scanned and read from remote storage."}),"\n",(0,i.jsx)(n.li,{children:"BytesWriteIntoCache: Amount of data written to Data Cache during this warmup."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"appendix",children:"Appendix"}),"\n",(0,i.jsx)(n.h3,{id:"principle",children:"Principle"}),"\n",(0,i.jsxs)(n.p,{children:["Data caching caches accessed remote data to the local BE node. The original data file is split into Blocks based on the accessed IO size, and Blocks are stored in the local file ",(0,i.jsx)(n.code,{children:"cache_path/hash(filepath).substr(0, 3)/hash(filepath)/offset"}),", with Block metadata saved in the BE node. When accessing the same remote file, doris checks whether the cache data of the file exists in the local cache and determines which data to read from the local Block and which data to pull from the remote based on the Block's offset and size, caching the newly pulled remote data. When the BE node restarts, it scans the ",(0,i.jsx)(n.code,{children:"cache_path"})," directory to restore Block metadata. When the cache size reaches the upper limit, it cleans up long-unused Blocks according to the LRU principle."]})]})}function d(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},250065:function(e,n,a){a.d(n,{Z:function(){return r},a:function(){return c}});var t=a(667294);let i={},s=t.createContext(i);function c(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);