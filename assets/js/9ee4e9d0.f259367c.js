"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["535026"],{248356:function(e,n,t){t.r(n),t.d(n,{default:()=>d,frontMatter:()=>a,metadata:()=>i,assets:()=>c,toc:()=>l,contentTitle:()=>o});var i=JSON.parse('{"id":"query-acceleration/tuning/tuning-plan/adjusting-join-shuffle","title":"Adjusting Join Shuffle Mode with Hint","description":"Overview","source":"@site/docs/query-acceleration/tuning/tuning-plan/adjusting-join-shuffle.md","sourceDirName":"query-acceleration/tuning/tuning-plan","slug":"/query-acceleration/tuning/tuning-plan/adjusting-join-shuffle","permalink":"/docs/dev/query-acceleration/tuning/tuning-plan/adjusting-join-shuffle","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Adjusting Join Shuffle Mode with Hint","language":"en"},"sidebar":"docs","previous":{"title":"Optimizing Join with Colocate Group","permalink":"/docs/dev/query-acceleration/tuning/tuning-plan/optimizing-join-with-colocate-group"},"next":{"title":"Control CBO Rules With Hint","permalink":"/docs/dev/query-acceleration/tuning/tuning-plan/controlling-hints-with-cbo-rule"}}'),r=t("785893"),s=t("250065");let a={title:"Adjusting Join Shuffle Mode with Hint",language:"en"},o=void 0,c={},l=[{value:"Overview",id:"overview",level:2},{value:"Case",id:"case",level:2},{value:"Summary",id:"summary",level:2}];function h(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Doris supports the use of hints to adjust the type of data shuffle in Join operations, thereby optimizing query performance. This section provides detailed instructions on how to specify the Join Shuffle type in Doris using hints."}),"\n",(0,r.jsx)(n.admonition,{title:"Note",type:"caution",children:(0,r.jsx)(n.p,{children:"Currently, Doris has good out-of-the-box capabilities. This means that in most scenarios, Doris will adaptively optimize performance in various scenarios, and users do not need to manually control hints for performance tuning. The content introduced in this chapter is mainly for professional tuners, and business personnel only need a simple understanding."})}),"\n",(0,r.jsxs)(n.p,{children:["Currently, Doris supports two independent ",(0,r.jsx)(n.a,{href:"/docs/dev/query-acceleration/hints/distribute-hint",children:"Distribute Hint"}),", ",(0,r.jsx)(n.code,{children:"[shuffle]"})," and ",(0,r.jsx)(n.code,{children:"[broadcast]"}),", to specify the Distribute Type for the right table in a Join. The Distribute Type should be placed before the right table in the Join, enclosed in square brackets ",(0,r.jsx)(n.code,{children:"[]"}),". Additionally, Doris can specify the shuffle mode by using the Leading Hint in conjunction with the Distribute Hint (for more details, refer to ",(0,r.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/reordering-join-with-leading-hint",children:"Reordering Join With Leading Hint"}),")."]}),"\n",(0,r.jsx)(n.p,{children:"Examples are as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT COUNT(*) FROM t2 JOIN [broadcast] t1 ON t1.c1 = t2.c2;\r\nSELECT COUNT(*) FROM t2 JOIN [shuffle] t1 ON t1.c1 = t2.c2;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"case",children:"Case"}),"\n",(0,r.jsx)(n.p,{children:"Next, we will demonstrate the usage of Distribute Hints through an example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"EXPLAIN SHAPE PLAN SELECT COUNT(*) FROM t1 JOIN t2 ON t1.c1 = t2.c2;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The plan for the original SQL is as follows, showing that the join between t1 and t2 uses the hash distribute method, indicated by ",(0,r.jsx)(n.code,{children:"DistributionSpecHash"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"+----------------------------------------------------------------------------------+\r\n| Explain String (Nereids Planner)                                                 |\r\n+----------------------------------------------------------------------------------+\r\n| PhysicalResultSink                                                               |\r\n| --hashAgg [GLOBAL]                                                               |\r\n| ----PhysicalDistribute [DistributionSpecGather]                                  |\r\n| ------hashAgg [LOCAL]                                                            |\r\n| --------PhysicalProject                                                          |\r\n| ----------hashJoin [INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=()|\r\n| ------------PhysicalProject                                                      |\r\n| --------------PhysicalOlapScan [t1]                                              |\r\n| ------------PhysicalDistribute [DistributionSpecHash]                            |\r\n| --------------PhysicalProject                                                    |\r\n| ----------------PhysicalOlapScan [t2]                                            |\r\n+----------------------------------------------------------------------------------+\n"})}),"\n",(0,r.jsx)(n.p,{children:"After adding the [broadcast] hint:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"EXPLAIN SHAPE PLAN SELECT COUNT(*) FROM t1 JOIN [broadcast] t2 ON t1.c1 = t2.c2;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["It can be seen that the distribution method for the join between t1 and t2 has been changed to the broadcast method, indicated by ",(0,r.jsx)(n.code,{children:"DistributionSpecReplicated"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"+----------------------------------------------------------------------------------+\r\n| Explain String (Nereids Planner)                                                 |\r\n+----------------------------------------------------------------------------------+\r\n| PhysicalResultSink                                                               |\r\n| --hashAgg [GLOBAL]                                                               |\r\n| ----PhysicalDistribute [DistributionSpecGather]                                  |\r\n| ------hashAgg [LOCAL]                                                            |\r\n| --------PhysicalProject                                                          |\r\n| ----------hashJoin [INNER_JOIN] hashCondition=((t1.c1 = t2.c2)) otherCondition=()|\r\n| ------------PhysicalProject                                                      |\r\n| --------------PhysicalOlapScan [t1]                                              |\r\n| ------------PhysicalDistribute [DistributionSpecReplicated]                      |\r\n| --------------PhysicalProject                                                    |\r\n| ----------------PhysicalOlapScan [t2]                                            |\r\n+----------------------------------------------------------------------------------+\n"})}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"By appropriately using Distribute Hints, you can optimize the shuffle mode for Join operations and improve query performance. In practice, it is recommended to first analyze the query execution plan using EXPLAIN and then specify the appropriate shuffle type based on the actual situation."})]})}function d(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return o},a:function(){return a}});var i=t(667294);let r={},s=i.createContext(r);function a(e){let n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);