"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["372259"],{166044:function(e,n,i){i.r(n),i.d(n,{default:()=>x,frontMatter:()=>r,metadata:()=>s,assets:()=>l,toc:()=>c,contentTitle:()=>a});var s=JSON.parse('{"id":"ai/vector-search/index-management","title":"ANN Index Management","description":"Approximate Nearest Neighbor (ANN) indexes in Apache Doris enable efficient vector similarity search for high-dimensional data. Since from Doris 4.x,","source":"@site/versioned_docs/version-4.x/ai/vector-search/index-management.md","sourceDirName":"ai/vector-search","slug":"/ai/vector-search/index-management","permalink":"/docs/4.x/ai/vector-search/index-management","draft":false,"unlisted":false,"tags":[],"version":"4.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"ANN Index Management","language":"en","description":"Approximate Nearest Neighbor (ANN) indexes in Apache Doris enable efficient vector similarity search for high-dimensional data. Since from Doris 4.x,"},"sidebar":"docs","previous":{"title":"IVF","permalink":"/docs/4.x/ai/vector-search/ivf"},"next":{"title":"Performance Testing and Analysis","permalink":"/docs/4.x/ai/vector-search/performance"}}'),d=i("785893"),t=i("250065");let r={title:"ANN Index Management",language:"en",description:"Approximate Nearest Neighbor (ANN) indexes in Apache Doris enable efficient vector similarity search for high-dimensional data. Since from Doris 4.x,"},a="ANN Index Management",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Creating ANN Indexes",id:"creating-ann-indexes",level:2},{value:"Syntax",id:"syntax",level:3},{value:"Syntax",id:"syntax-1",level:3},{value:"General Properties",id:"general-properties",level:3},{value:"Index-Specific Properties",id:"index-specific-properties",level:3},{value:"IVF Index Properties",id:"ivf-index-properties",level:4},{value:"HNSW Index Properties",id:"hnsw-index-properties",level:4},{value:"Quantization-Specific Properties",id:"quantization-specific-properties",level:3},{value:"Product Quantization Properties",id:"product-quantization-properties",level:4},{value:"Examples",id:"examples",level:3},{value:"Create table with ANN index",id:"create-table-with-ann-index",level:4},{value:"IVF Index",id:"ivf-index",level:4},{value:"HNSW Index",id:"hnsw-index",level:4},{value:"HNSW Index with SQ",id:"hnsw-index-with-sq",level:4},{value:"HNSW Index with PQ",id:"hnsw-index-with-pq",level:4},{value:"IVF Index with SQ",id:"ivf-index-with-sq",level:4},{value:"IVF Index with PQ",id:"ivf-index-with-pq",level:4},{value:"Building ANN Indexes",id:"building-ann-indexes",level:2},{value:"Syntax",id:"syntax-2",level:3},{value:"Monitoring Build Progress",id:"monitoring-build-progress",level:3},{value:"Canceling Index Builds",id:"canceling-index-builds",level:3},{value:"Dropping ANN Indexes",id:"dropping-ann-indexes",level:2},{value:"Syntax",id:"syntax-3",level:3},{value:"Showing ANN Indexes",id:"showing-ann-indexes",level:2},{value:"Syntax",id:"syntax-4",level:3},{value:"Example Output",id:"example-output",level:3}];function o(e){let n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"ann-index-management",children:"ANN Index Management"})}),"\n",(0,d.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,d.jsx)(n.p,{children:"Approximate Nearest Neighbor (ANN) indexes in Apache Doris enable efficient vector similarity search for high-dimensional data. Since from Doris 4.x, the universal index operation syntax has also been extended to cover ANN indexes. This article will introduce the specific SQL syntax for ANN index-related operations and provide detailed parameter explanations."}),"\n",(0,d.jsxs)(n.p,{children:["ANN indexes are built on vector columns (typically ",(0,d.jsx)(n.code,{children:"ARRAY<FLOAT> NOT NULL"})," type) and support distance metrics include L2 distance and inner product."]}),"\n",(0,d.jsx)(n.h2,{id:"creating-ann-indexes",children:"Creating ANN Indexes"}),"\n",(0,d.jsxs)(n.p,{children:["ANN indexes can be created using the ",(0,d.jsx)(n.code,{children:"CREATE INDEX"})," statement with ",(0,d.jsx)(n.code,{children:"USING ANN"}),". There are two main approaches:"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Define the index during table creation"}),": The index is built synchronously as data is loaded."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"syntax",children:"Syntax"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE [IF NOT EXISTS] <table_name> (\n  <columns_definition>\n  INDEX <index_name> (<vector_column) USING ANN PROPERTIES (\n    "<key>" = "<value>" [, ...]\n  )\n)\n[ <key_type> KEY (<key_cols>)\n    [ CLUSTER BY (<cluster_cols>) ]\n]\n[ COMMENT \'<table_comment>\' ]\n[ <partitions_definition> ]\n[ DISTRIBUTED BY { HASH (<distribute_cols>) | RANDOM }\n    [ BUCKETS { <bucket_count> | AUTO } ]\n]\n[ <roll_up_definition> ]\n[ PROPERTIES (\n    -- Table property\n    <table_property>\n    -- Additional table properties\n    [ , ... ])\n]\n'})}),"\n",(0,d.jsxs)(n.ol,{start:"2",children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Create the index separately"}),": Define the index first, then build it on existing data using ",(0,d.jsx)(n.code,{children:"BUILD INDEX"}),"."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"syntax-1",children:"Syntax"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'CREATE INDEX [IF NOT EXISTS] <index_name>\n             ON <table_name> (<column_name>)\n             USING ANN\n             PROPERTIES ("<key>" = "<value>" [, ...])\n             [COMMENT \'<index_comment>\']\n\n-- or\nALTER TABLE <table_name> ADD INDEX <index_name>(<column_name>)\n             USING ANN\n             [PROPERTIES("<key>" = "<value>" [, ...])]\n             [COMMENT \'<index_comment>\']\n'})}),"\n",(0,d.jsx)(n.h3,{id:"general-properties",children:"General Properties"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"index_type"}),": The type of ANN index. Supported values: ",(0,d.jsx)(n.code,{children:'"ivf"'})," or ",(0,d.jsx)(n.code,{children:'"hnsw"'}),"."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"metric_type"}),": The distance metric. Supported values: ",(0,d.jsx)(n.code,{children:'"l2_distance"'}),", ",(0,d.jsx)(n.code,{children:'"inner_product"'}),"."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"dim"}),": The dimension of the vector column."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"quantizer"}),": The quantizer type. Supported values: ",(0,d.jsx)(n.code,{children:"flat"}),", ",(0,d.jsx)(n.code,{children:"sq4"}),", ",(0,d.jsx)(n.code,{children:"sq8"}),", ",(0,d.jsx)(n.code,{children:"pq"}),". Default to ",(0,d.jsx)(n.code,{children:"flat"})," when not specified."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"index-specific-properties",children:"Index-Specific Properties"}),"\n",(0,d.jsx)(n.h4,{id:"ivf-index-properties",children:"IVF Index Properties"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"nlist"}),": Number of clusters (inverted lists). Default: 1024. Higher values improve recall but increase build time and memory usage."]}),"\n"]}),"\n",(0,d.jsx)(n.h4,{id:"hnsw-index-properties",children:"HNSW Index Properties"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"max_degree"}),": Maximum number of connections per node. Default: 32. Affects recall and query performance."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"ef_construction"}),": Size of the candidate queue during index construction. Default: 40. Higher values improve graph quality but increase build time."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"quantization-specific-properties",children:"Quantization-Specific Properties"}),"\n",(0,d.jsx)(n.p,{children:"for quantizer property:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"sq4"}),": Scalar Quantization (SQ), uses 4-bit integers instead of the typical 32-bit floating point numbers to store each dimension value of a vector."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"sq8"}),": Scalar Quantization (SQ), uses 8-bit integers instead of the typical 32-bit floating point numbers to store each dimension value of a vector."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"pq"}),": Product Quantization (PQ), two additional parameters, ",(0,d.jsx)(n.code,{children:"pq_m"})," and ",(0,d.jsx)(n.code,{children:"pq_nbits"})," are required in the properties."]}),"\n"]}),"\n",(0,d.jsx)(n.h4,{id:"product-quantization-properties",children:"Product Quantization Properties"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"pq_m"}),": Specifies how many subvectors are used (vector dimension dim must be divisible by pq_m)."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"pq_nbits"}),": The number of bits used to represent each subvector, in faiss pq_nbits is generally required to be no greater than 24."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,d.jsx)(n.h4,{id:"create-table-with-ann-index",children:"Create table with ANN index"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE tbl_ann (\n    id int NOT NULL,\n    embedding array<float> NOT NULL,\n    INDEX ann_index (embedding) USING ANN PROPERTIES(\n        "index_type"="hnsw",\n        "metric_type"="l2_distance",\n        "dim"="128"\n    )\n) ENGINE=OLAP\nDUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 1\nPROPERTIES ("replication_num" = "1");\n'})}),"\n",(0,d.jsx)(n.h4,{id:"ivf-index",children:"IVF Index"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'CREATE INDEX ann_ivf_index ON tbl_ivf (`embedding`) USING ANN PROPERTIES(\n    "index_type"="ivf",\n    "metric_type"="l2_distance",\n    "dim"="128",\n    "nlist"="1024"\n);\n'})}),"\n",(0,d.jsx)(n.h4,{id:"hnsw-index",children:"HNSW Index"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'CREATE INDEX ann_hnsw_index ON tbl_hnsw (`embedding`) USING ANN PROPERTIES(\n    "index_type"="hnsw",\n    "metric_type"="l2_distance",\n    "dim"="128",\n    "max_degree"="32",\n    "ef_construction"="40"\n);\n'})}),"\n",(0,d.jsx)(n.h4,{id:"hnsw-index-with-sq",children:"HNSW Index with SQ"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'CREATE INDEX ann_hnsw_sq ON tbl_hnsw (`embedding`) USING ANN PROPERTIES(\n    "index_type"="hnsw",\n    "metric_type"="l2_distance",\n    "dim"="128",\n    "max_degree"="32",\n    "ef_construction"="40",\n    "quantizer"="sq8"\n);\n'})}),"\n",(0,d.jsx)(n.h4,{id:"hnsw-index-with-pq",children:"HNSW Index with PQ"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'CREATE INDEX ann_hnsw_pq ON tbl_hnsw (`embedding`) USING ANN PROPERTIES(\n    "index_type"="hnsw",\n    "metric_type"="l2_distance",\n    "dim"="128",\n    "max_degree"="32",\n    "ef_construction"="40",\n    "quantizer"="pq",\n    "pq_m"="8",\n    "pq_nbits"="8"\n);\n'})}),"\n",(0,d.jsx)(n.h4,{id:"ivf-index-with-sq",children:"IVF Index with SQ"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'CREATE INDEX ann_ivf_sq ON tbl_ivf (`embedding`) USING ANN PROPERTIES(\n    "index_type"="ivf",\n    "metric_type"="l2_distance",\n    "dim"="128",\n    "nlist"="1024",\n    "quantizer"="sq8"\n);\n'})}),"\n",(0,d.jsx)(n.h4,{id:"ivf-index-with-pq",children:"IVF Index with PQ"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'CREATE INDEX ann_ivf_pq ON tbl_ivf (`embedding`) USING ANN PROPERTIES(\n    "index_type"="ivf",\n    "metric_type"="l2_distance",\n    "dim"="128",\n    "nlist"="1024",\n    "quantizer"="pq",\n    "pq_m"="8",\n    "pq_nbits"="8"\n);\n'})}),"\n",(0,d.jsx)(n.h2,{id:"building-ann-indexes",children:"Building ANN Indexes"}),"\n",(0,d.jsxs)(n.p,{children:["For indexes created separately (not during table creation), use ",(0,d.jsx)(n.code,{children:"BUILD INDEX"})," to build the index on existing data. This operation is asynchronous."]}),"\n",(0,d.jsx)(n.h3,{id:"syntax-2",children:"Syntax"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:"BUILD INDEX <index_name> ON <table_name> [PARTITION (<partition_name> [, ...])]\n"})}),"\n",(0,d.jsx)(n.h3,{id:"monitoring-build-progress",children:"Monitoring Build Progress"}),"\n",(0,d.jsxs)(n.p,{children:["Use ",(0,d.jsx)(n.code,{children:"SHOW BUILD INDEX"})," to check the status of index build jobs."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'-- view all the progress of BUILD INDEX tasks [for a specific database]\nSHOW BUILD INDEX [FROM db_name];\n\n-- view the progress of BUILD INDEX tasks for a specific table\nSHOW BUILD INDEX WHERE TableName = "<table_name>";\n'})}),"\n",(0,d.jsxs)(n.p,{children:["The output includes columns such as ",(0,d.jsx)(n.code,{children:"JobId"}),", ",(0,d.jsx)(n.code,{children:"TableName"}),", ",(0,d.jsx)(n.code,{children:"State"})," (e.g., ",(0,d.jsx)(n.code,{children:"FINISHED"}),", ",(0,d.jsx)(n.code,{children:"RUNNING"}),"), and ",(0,d.jsx)(n.code,{children:"Progress"}),", for example:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'mysql> show build index where TableName = "sift_1M";\n+---------------+-----------+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| JobId         | TableName | PartitionName | AlterInvertedIndexes                                                                                                                                | CreateTime              | FinishTime              | TransactionId | State    | Msg  | Progress |\n+---------------+-----------+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| 1764579876673 | sift_1M   | sift_1M       | [ADD INDEX idx_test_ann (`embedding`) USING ANN PROPERTIES("dim" = "128", "index_type" = "ivf", "metric_type" = "l2_distance", "nlist" = "1024")],  | 2025-12-01 17:59:54.277 | 2025-12-01 17:59:56.987 | 82            | FINISHED |      | NULL     |\n+---------------+-----------+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n1 row in set (0.00 sec)\n'})}),"\n",(0,d.jsx)(n.h3,{id:"canceling-index-builds",children:"Canceling Index Builds"}),"\n",(0,d.jsx)(n.p,{children:"To cancel an ongoing index build:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:"CANCEL BUILD INDEX ON <table_name> [(<job_id> [, ...])]\n"})}),"\n",(0,d.jsx)(n.h2,{id:"dropping-ann-indexes",children:"Dropping ANN Indexes"}),"\n",(0,d.jsxs)(n.p,{children:["Remove an ANN index using ",(0,d.jsx)(n.code,{children:"DROP INDEX"}),"."]}),"\n",(0,d.jsx)(n.h3,{id:"syntax-3",children:"Syntax"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:"DROP INDEX [IF EXISTS] <index_name> ON [<db_name>.]<table_name>\n\n-- or\nALTER TABLE [<db_name>.]<table_name> DROP INDEX <index_name>\n"})}),"\n",(0,d.jsx)(n.h2,{id:"showing-ann-indexes",children:"Showing ANN Indexes"}),"\n",(0,d.jsxs)(n.p,{children:["Display information about indexes on a table using ",(0,d.jsx)(n.code,{children:"SHOW INDEX"})," or ",(0,d.jsx)(n.code,{children:"SHOW CREATE TABLE"}),"."]}),"\n",(0,d.jsx)(n.h3,{id:"syntax-4",children:"Syntax"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:"SHOW INDEX[ES] FROM [<db_name>.]<table_name> [FROM <db_name>]\n\n-- or\nSHOW CREATE TABLE [<db_name>.]<table_name>\n"})}),"\n",(0,d.jsx)(n.h3,{id:"example-output",children:"Example Output"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:'mysql> SHOW INDEX FROM sift_1M;\n+---------+------------+--------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+----------------------------------------------------------------------------------------+\n| Table   | Non_unique | Key_name     | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Properties                                                                             |\n+---------+------------+--------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+----------------------------------------------------------------------------------------+\n| sift_1M |            | idx_test_ann |              | embedding   |           |             |          |        |      | ANN        |         | ("dim" = "128", "index_type" = "ivf", "metric_type" = "l2_distance", "nlist" = "1024") |\n+---------+------------+--------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+----------------------------------------------------------------------------------------+\n1 row in set (0.01 sec)\n'})}),"\n",(0,d.jsxs)(n.p,{children:["The output includes columns such as ",(0,d.jsx)(n.code,{children:"Table"}),", ",(0,d.jsx)(n.code,{children:"Key_name"}),", ",(0,d.jsx)(n.code,{children:"Index_type"})," (shows ",(0,d.jsx)(n.code,{children:"ANN"})," for ANN indexes), and ",(0,d.jsx)(n.code,{children:"Properties"})," (containing the index configuration)."]})]})}function x(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return a},a:function(){return r}});var s=i(667294);let d={},t=s.createContext(d);function r(e){let n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);