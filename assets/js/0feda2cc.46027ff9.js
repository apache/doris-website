"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["883694"],{906170:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>r,metadata:()=>a,assets:()=>c,toc:()=>o,contentTitle:()=>i});var a=JSON.parse('{"id":"sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-SQL-BLOCK-RULE","title":"CREATE-SQL-BLOCK-RULE","description":"CREATE-SQL-BLOCK-RULE","source":"@site/versioned_docs/version-2.0/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-SQL-BLOCK-RULE.md","sourceDirName":"sql-manual/sql-reference/Data-Definition-Statements/Create","slug":"/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-SQL-BLOCK-RULE","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-SQL-BLOCK-RULE","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"CREATE-SQL-BLOCK-RULE","language":"en"},"sidebar":"docs","previous":{"title":"CREATE-WORKLOAD-GORUP","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-WORKLOAD-GROUP"},"next":{"title":"ALTER-CATALOG","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Definition-Statements/Alter/ALTER-CATALOG"}}'),s=t("785893"),l=t("250065");let r={title:"CREATE-SQL-BLOCK-RULE",language:"en"},i=void 0,c={},o=[{value:"CREATE-SQL-BLOCK-RULE",id:"create-sql-block-rule",level:2},{value:"Name",id:"name",level:3},{value:"Description",id:"description",level:3},{value:"Example",id:"example",level:3},{value:"APPENDIX",id:"appendix",level:3},{value:"Keywords",id:"keywords",level:3},{value:"Best Practice",id:"best-practice",level:3}];function d(e){let n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"create-sql-block-rule",children:"CREATE-SQL-BLOCK-RULE"}),"\n",(0,s.jsx)(n.h3,{id:"name",children:"Name"}),"\n",(0,s.jsx)(n.p,{children:"CREATE SQL BLOCK RULE"}),"\n",(0,s.jsx)(n.h3,{id:"description",children:"Description"}),"\n",(0,s.jsx)(n.p,{children:"This statement creates a SQL blocking rule. it can restrict any kind of sql statements(no matter DDL or DML statement)."}),"\n",(0,s.jsx)(n.p,{children:"Supports configuring SQL blacklists by user:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Refuse to specify SQL by regular matching"}),"\n",(0,s.jsxs)(n.li,{children:["Check if a sql reaches one of these limits by setting partition_num, tablet_num, cardinality\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"partition_num, tablet_num, cardinality can be set together, once a query reaches one of these limits, the query will be intercepted"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"grammar:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'CREATE SQL_BLOCK_RULE rule_name\n[PROPERTIES ("key"="value", ...)];\n'})}),"\n",(0,s.jsx)(n.p,{children:"Parameter Description:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["sql: matching rule (based on regular matching, special characters need to be translated,for example",(0,s.jsx)(n.code,{children:"select *"}),"use",(0,s.jsx)(n.code,{children:"select \\\\*"}),'), optional, the default value is "NULL"']}),"\n",(0,s.jsxs)(n.li,{children:["sqlHash: sql hash value, used for exact matching, we will print this value in ",(0,s.jsx)(n.code,{children:"fe.audit.log"}),', optional, this parameter and sql can only be selected one, the default value is "NULL"']}),"\n",(0,s.jsx)(n.li,{children:"partition_num: the maximum number of partitions a scan node will scan, the default value is 0L"}),"\n",(0,s.jsx)(n.li,{children:"tablet_num: The maximum number of tablets that a scanning node will scan, the default value is 0L"}),"\n",(0,s.jsx)(n.li,{children:"cardinality: the rough scan line number of a scan node, the default value is 0L"}),"\n",(0,s.jsx)(n.li,{children:"global: Whether to take effect globally (all users), the default is false"}),"\n",(0,s.jsx)(n.li,{children:"enable: whether to enable blocking rules, the default is true"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Create a block rule named test_rule"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'CREATE SQL_BLOCK_RULE test_rule\nPROPERTIES(\n"sql"="select \\\\* from order_analysis",\n"global"="false",\n"enable"="true"\n);\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Notes:"}),"\n",(0,s.jsx)(n.p,{children:"That the sql statement here does not end with a semicolon"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"When we execute the sql we just defined in the rule, an exception error will be returned. The example is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"select * from order_analysis;\nERROR 1064 (HY000): errCode = 2, detailMessage = sql match regex sql block rule: order_analysis_rule\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Create test_rule2, limit the maximum number of scanned partitions to 30, and limit the maximum scan base to 10 billion rows. The example is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:' CREATE SQL_BLOCK_RULE test_rule2\n PROPERTIES (\n "partition_num" = "30",\n "cardinality" = "10000000000",\n "global" = "false",\n "enable" = "true"\n );\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Create SQL BLOCK RULE with special chars"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'CREATE SQL_BLOCK_RULE test_rule3\nPROPERTIES\n( \n"sql" = "select count\\\\(1\\\\) from db1.tbl1"\n);\nCREATE SQL_BLOCK_RULE test_rule4\nPROPERTIES\n( \n"sql" = "select \\\\* from db1.tbl1"\n);\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"In SQL_BLOCK_RULE, SQL matching is based on regular expressions. If want to match more patterns of SQL, need to write the corresponding regex. For example, to ignore spaces in SQL and not query tables that start with 'order_', as shown below:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:' CREATE SQL_BLOCK_RULE test_rule4 \n PROPERTIES(\n   "sql"="\\\\s*select\\\\s*\\\\*\\\\s*from order_\\\\w*\\\\s*",\n   "global"="false",\n   "enable"="true"\n );\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"appendix",children:"APPENDIX"}),"\n",(0,s.jsx)(n.p,{children:"Here are some commonly used regular expressions:"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:". \uFF1AMatches any single character except for a newline character \\n.\n\n* \uFF1AMatches the preceding element zero or more times. For example, a matches zero or more 'a'.\n\n+ \uFF1AMatches the preceding element one or more times. For example, a+ matches one or more 'a'.\n\n? \uFF1AMatches the preceding element zero or one time. For example, a? matches zero or one 'a'.\n\n[] \uFF1AUsed to define a character set. For example, [aeiou] matches any one vowel letter.\n\n[^] \uFF1AIn a character set, use ^ to indicate negation, matching characters that are not in the set. For example, [^0-9] matches any non-digit character.\n\n() \uFF1AUsed for grouping expressions and applying quantifiers. For example, (ab)+ matches consecutive 'ab'.\n\n| \uFF1ARepresents logical OR. For example, a|b matches 'a' or 'b'.\n\n^ \uFF1AMatches the beginning of a string. For example, ^abc matches a string that starts with 'abc'.\n\n$ \uFF1AMatches the end of a string. For example, xyz$ matches a string that ends with 'xyz'.\n\n\\ \uFF1AUsed to escape special characters to treat them as ordinary characters. For example, \\\\. matches the period character '.'.\n\n\\s \uFF1AMatches any whitespace character, including spaces, tabs, newline characters, etc.\n\n\\d \uFF1AMatches any digit character, equivalent to [0-9].\n\n\\w \uFF1AMatches any word character, including letters, digits, and underscores, equivalent to [a-zA-Z0-9_].\n"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"keywords",children:"Keywords"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"CREATE, SQL_BLCOK_RULE\n"})}),"\n",(0,s.jsx)(n.h3,{id:"best-practice",children:"Best Practice"})]})}function h(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return i},a:function(){return r}});var a=t(667294);let s={},l=a.createContext(s);function r(e){let n=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);