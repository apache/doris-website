"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["229107"],{288780:function(e,s,t){t.r(s),t.d(s,{default:()=>d,frontMatter:()=>i,metadata:()=>n,assets:()=>u,toc:()=>a,contentTitle:()=>c});var n=JSON.parse('{"id":"compute-storage-decoupled/managing-compute-cluster","title":"Managing Compute Groups","description":"In a compute-storage decoupled architecture, one or more compute nodes (BE) can be grouped into a Compute Group. This document describes how to use compute groups, including operations such as:","source":"@site/versioned_docs/version-3.x/compute-storage-decoupled/managing-compute-cluster.md","sourceDirName":"compute-storage-decoupled","slug":"/compute-storage-decoupled/managing-compute-cluster","permalink":"/docs/3.x/compute-storage-decoupled/managing-compute-cluster","draft":false,"unlisted":false,"tags":[],"version":"3.x","frontMatter":{"title":"Managing Compute Groups","language":"en"},"sidebar":"docs","previous":{"title":"Managing Storage Vault","permalink":"/docs/3.x/compute-storage-decoupled/managing-storage-vault"},"next":{"title":"File Cache","permalink":"/docs/3.x/compute-storage-decoupled/file-cache/"}}'),o=t("785893"),r=t("250065");let i={title:"Managing Compute Groups",language:"en"},c=void 0,u={},a=[{value:"Compute Group Usage Scenarios",id:"compute-group-usage-scenarios",level:2},{value:"Default Compute Group Selection Mechanism",id:"default-compute-group-selection-mechanism",level:2},{value:"Viewing All Compute Groups",id:"viewing-all-compute-groups",level:2},{value:"Adding Compute Groups",id:"adding-compute-groups",level:2},{value:"Granting Compute Group Access",id:"granting-compute-group-access",level:2},{value:"Revoking Compute Group Access",id:"revoking-compute-group-access",level:2},{value:"Setting Default Compute Group",id:"setting-default-compute-group",level:2},{value:"Switching Compute Groups",id:"switching-compute-groups",level:2},{value:"Scaling Compute Groups",id:"scaling-compute-groups",level:2}];function l(e){let s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.p,{children:"In a compute-storage decoupled architecture, one or more compute nodes (BE) can be grouped into a Compute Group. This document describes how to use compute groups, including operations such as:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Viewing all compute groups"}),"\n",(0,o.jsx)(s.li,{children:"Granting compute group access"}),"\n",(0,o.jsxs)(s.li,{children:["Binding compute groups at the user level (",(0,o.jsx)(s.code,{children:"default_compute_group"}),") for user-level isolation"]}),"\n"]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.em,{children:"Note"}),"\nIn versions prior to 3.0.2, this was referred to as a Compute Cluster."]}),"\n",(0,o.jsx)(s.h2,{id:"compute-group-usage-scenarios",children:"Compute Group Usage Scenarios"}),"\n",(0,o.jsx)(s.p,{children:"In a multi-compute group architecture, you can group one or more stateless BE nodes into compute clusters. By using compute cluster specification statements (use @<compute_group_name>), you can allocate specific workloads to specific compute clusters, achieving physical isolation of multiple import and query workloads."}),"\n",(0,o.jsx)(s.p,{children:"Assume there are two compute clusters: C1 and C2."}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Read-Read Isolation"}),": Before initiating two large queries, use ",(0,o.jsx)(s.code,{children:"use @c1"})," and ",(0,o.jsx)(s.code,{children:"use @c2"})," respectively to ensure that the queries run on different compute nodes. This prevents resource contention (CPU, memory, etc.) when accessing the same dataset."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Read-Write Isolation"}),": Doris data imports consume substantial resources, especially in scenarios with large data volumes and high-frequency imports. To avoid resource contention between queries and imports, you can use ",(0,o.jsx)(s.code,{children:"use @c1"})," and ",(0,o.jsx)(s.code,{children:"use @c2"})," to specify that queries execute on C1 and imports on C2. Additionally, the C1 compute cluster can access newly imported data in the C2 compute cluster."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Write-Write Isolation"}),": Similar to read-write isolation, imports can also be isolated from each other. For example, when the system has both high-frequency small imports and large batch imports, batch imports typically take longer and have higher retry costs, while high-frequency small imports are quick with lower retry costs. To prevent small imports from interfering with batch imports, you can use ",(0,o.jsx)(s.code,{children:"use @c1"})," and ",(0,o.jsx)(s.code,{children:"use @c2"})," to specify small imports to execute on C1 and batch imports on C2."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"default-compute-group-selection-mechanism",children:"Default Compute Group Selection Mechanism"}),"\n",(0,o.jsxs)(s.p,{children:["When a user has not explicitly ",(0,o.jsx)(s.a,{href:"#setting-default-compute-group",children:"set a default compute group"}),", the system will automatically select a compute group with Active BE that the user has usage permissions for. Once the default compute group is determined in a specific session, it will remain unchanged during that session unless the user explicitly changes the default setting."]}),"\n",(0,o.jsx)(s.p,{children:"In different sessions, if the following situations occur, the system may automatically change the user's default compute group:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"The user has lost usage permissions for the default compute group selected in the last session"}),"\n",(0,o.jsx)(s.li,{children:"A compute group has been added or removed"}),"\n",(0,o.jsx)(s.li,{children:"The previously selected default compute group no longer has Alive BE"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Situations one and two will definitely lead to a change in the automatically selected default compute group, while situation three may lead to a change."}),"\n",(0,o.jsx)(s.h2,{id:"viewing-all-compute-groups",children:"Viewing All Compute Groups"}),"\n",(0,o.jsxs)(s.p,{children:["Use the ",(0,o.jsx)(s.code,{children:"SHOW COMPUTE GROUPS"})," command to view all compute groups in the current repository. The returned results will display different content based on the user's permission level:"]}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Users with ",(0,o.jsx)(s.code,{children:"ADMIN"})," privileges can view all compute groups"]}),"\n",(0,o.jsx)(s.li,{children:"Regular users can only view compute groups for which they have usage permissions (USAGE_PRIV)"}),"\n",(0,o.jsx)(s.li,{children:"If a user doesn't have usage permissions for any compute groups, an empty result will be returned"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:"SHOW COMPUTE GROUPS;\n"})}),"\n",(0,o.jsx)(s.h2,{id:"adding-compute-groups",children:"Adding Compute Groups"}),"\n",(0,o.jsxs)(s.p,{children:["Managing compute groups requires ",(0,o.jsx)(s.code,{children:"OPERATOR"})," privilege, which controls node management permissions. For more details, please refer to ",(0,o.jsx)(s.a,{href:"../sql-manual/sql-statements/account-management/GRANT-TO",children:"Privilege Management"}),". By default, only the root account has the ",(0,o.jsx)(s.code,{children:"OPERATOR"})," privilege, but it can be granted to other accounts using the ",(0,o.jsx)(s.code,{children:"GRANT"})," command.\nTo add a BE and assign it to a compute group, use the ",(0,o.jsx)(s.a,{href:"../sql-manual/sql-statements/cluster-management/instance-management/ADD-BACKEND",children:"Add BE"})," command. For example:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:'ALTER SYSTEM ADD BACKEND \'host:9050\' PROPERTIES ("tag.compute_group_name" = "new_group");\n'})}),"\n",(0,o.jsxs)(s.p,{children:["The above sql will add ",(0,o.jsx)(s.code,{children:"host:9050"})," to compute group ",(0,o.jsx)(s.code,{children:"new_group"}),". The BE will be added to compute group ",(0,o.jsx)(s.code,{children:"default_compute_group"})," if you omit PROPERTIES statement, for example:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:"ALTER SYSTEM ADD BACKEND 'host:9050';\n"})}),"\n",(0,o.jsx)(s.h2,{id:"granting-compute-group-access",children:"Granting Compute Group Access"}),"\n",(0,o.jsx)(s.p,{children:"Prerequisite: The current operating user has' ADMIN 'permission, or the current user belongs to the admin role."}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:"GRANT USAGE_PRIV ON COMPUTE GROUP {compute_group_name} TO {user}\n"})}),"\n",(0,o.jsx)(s.h2,{id:"revoking-compute-group-access",children:"Revoking Compute Group Access"}),"\n",(0,o.jsx)(s.p,{children:"Prerequisite: The current operating user has' ADMIN 'permission, or the current user belongs to the admin role."}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:"REVOKE USAGE_PRIV ON COMPUTE GROUP {compute_group_name} FROM {user}\n"})}),"\n",(0,o.jsx)(s.h2,{id:"setting-default-compute-group",children:"Setting Default Compute Group"}),"\n",(0,o.jsx)(s.p,{children:"To set the default compute group for the current user(This operation requires the current user to already have permission to use the computing group):"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:"SET PROPERTY 'default_compute_group' = '{clusterName}';\n"})}),"\n",(0,o.jsx)(s.p,{children:"To set the default compute group for other users (this operation requires Admin privileges):"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:"SET PROPERTY FOR {user} 'default_compute_group' = '{clusterName}';\n"})}),"\n",(0,o.jsxs)(s.p,{children:["To view the current user's default compute group, the value of ",(0,o.jsx)(s.code,{children:"default_compute_group"})," in the returned result is the default compute group:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:"SHOW PROPERTY;\n"})}),"\n",(0,o.jsxs)(s.p,{children:["To view the default compute group of other users, This operation requires the current user to have admin privileges, and the value of ",(0,o.jsx)(s.code,{children:"default_compute_group"})," in the returned result is the default compute group:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:"SHOW PROPERTY FOR {user};\n"})}),"\n",(0,o.jsx)(s.p,{children:"To view all available compute groups in the current repository:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:"SHOW COMPUTE GROUPS;\n"})}),"\n",(0,o.jsx)(s.admonition,{title:"Note",type:"info",children:(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["If the current user has an Admin role, for example: ",(0,o.jsx)(s.code,{children:"CREATE USER jack IDENTIFIED BY '123456' DEFAULT ROLE \"admin\""}),", then:\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"They can set the default compute group for themselves and other users;"}),"\n",(0,o.jsxs)(s.li,{children:["They can view their own and other users' ",(0,o.jsx)(s.code,{children:"PROPERTY"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["If the current user does not have an Admin role, for example: ",(0,o.jsx)(s.code,{children:"CREATE USER jack1 IDENTIFIED BY '123456'"}),", then:\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"They can set the default compute group for themselves;"}),"\n",(0,o.jsxs)(s.li,{children:["They can view their own ",(0,o.jsx)(s.code,{children:"PROPERTY"}),";"]}),"\n",(0,o.jsxs)(s.li,{children:["They cannot view all compute groups, as this operation requires ",(0,o.jsx)(s.code,{children:"GRANT ADMIN"})," privileges."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["If the current user has not configured a default compute group, the existing system will trigger an error when performing data read/write operations. To resolve this issue, the user can execute the ",(0,o.jsx)(s.code,{children:"use @cluster"})," command to specify the compute group used by the current context, or use the ",(0,o.jsx)(s.code,{children:"SET PROPERTY"})," statement to set the default compute group."]}),"\n",(0,o.jsxs)(s.li,{children:["If the current user has configured a default compute group, but that cluster is subsequently deleted, an error will also be triggered during data read/write operations. The user can execute the ",(0,o.jsx)(s.code,{children:"use @cluster"})," command to re-specify the compute group used by the current context, or use the ",(0,o.jsx)(s.code,{children:"SET PROPERTY"})," statement to update the default cluster settings."]}),"\n"]})}),"\n",(0,o.jsx)(s.h2,{id:"switching-compute-groups",children:"Switching Compute Groups"}),"\n",(0,o.jsx)(s.p,{children:"Users can specify the database and compute group to use in a compute-storage decoupled architecture."}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.strong,{children:"Syntax"})}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:"USE { [catalog_name.]database_name[@compute_group_name] | @compute_group_name }\n"})}),"\n",(0,o.jsx)(s.p,{children:"If the database or compute group name contains reserved keywords, the corresponding name must be enclosed in backticks ```."}),"\n",(0,o.jsx)(s.h2,{id:"scaling-compute-groups",children:"Scaling Compute Groups"}),"\n",(0,o.jsxs)(s.p,{children:["You can scale compute groups by adding or removing BE using ",(0,o.jsx)(s.code,{children:"ALTER SYSTEM ADD BACKEND"})," and ",(0,o.jsx)(s.code,{children:"ALTER SYSTEM DECOMMISION BACKEND"}),"."]})]})}function d(e={}){let{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},250065:function(e,s,t){t.d(s,{Z:function(){return c},a:function(){return i}});var n=t(667294);let o={},r=n.createContext(o);function i(e){let s=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);