"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["43210"],{205938:function(e,t,n){n.r(t),n.d(t,{default:()=>h,frontMatter:()=>a,metadata:()=>s,assets:()=>l,toc:()=>c,contentTitle:()=>o});var s=JSON.parse('{"id":"sql-manual/sql-reference/Data-Manipulation-Statements/Load/STREAM-LOAD","title":"STREAM-LOAD","description":"STREAM-LOAD","source":"@site/versioned_docs/version-2.0/sql-manual/sql-reference/Data-Manipulation-Statements/Load/STREAM-LOAD.md","sourceDirName":"sql-manual/sql-reference/Data-Manipulation-Statements/Load","slug":"/sql-manual/sql-reference/Data-Manipulation-Statements/Load/STREAM-LOAD","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Manipulation-Statements/Load/STREAM-LOAD","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"STREAM-LOAD","language":"en"},"sidebar":"docs","previous":{"title":"CANCEL-RESTORE","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Definition-Statements/Backup-and-Restore/CANCEL-RESTORE"},"next":{"title":"MULTI-LOAD","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Manipulation-Statements/Load/MULTI-LOAD"}}'),i=n("785893"),r=n("250065");let a={title:"STREAM-LOAD",language:"en"},o=void 0,l={},c=[{value:"STREAM-LOAD",id:"stream-load",level:2},{value:"Name",id:"name",level:3},{value:"Description",id:"description",level:3},{value:"Example",id:"example",level:3},{value:"Keywords",id:"keywords",level:3},{value:"Best Practice",id:"best-practice",level:3}];function d(e){let t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"stream-load",children:"STREAM-LOAD"}),"\n",(0,i.jsx)(t.h3,{id:"name",children:"Name"}),"\n",(0,i.jsx)(t.p,{children:"STREAM LOAD"}),"\n",(0,i.jsx)(t.h3,{id:"description",children:"Description"}),"\n",(0,i.jsx)(t.p,{children:"stream-load: load data to table in streaming"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u user:passwd [-H ""...] -T data.file -XPUT http://fe_host:http_port/api/{db}/{table}/_stream_load\n'})}),"\n",(0,i.jsx)(t.p,{children:"This statement is used to import data into the specified table. The difference from ordinary Load is that this import method is synchronous import."}),"\n",(0,i.jsx)(t.p,{children:"This import method can still ensure the atomicity of a batch of import tasks, either all data is imported successfully or all of them fail."}),"\n",(0,i.jsx)(t.p,{children:"This operation will update the data of the rollup table related to this base table at the same time."}),"\n",(0,i.jsx)(t.p,{children:"This is a synchronous operation. After the entire data import work is completed, the import result is returned to the user."}),"\n",(0,i.jsx)(t.p,{children:"Currently, HTTP chunked and non-chunked uploads are supported. For non-chunked methods, Content-Length must be used to indicate the length of the uploaded content, which can ensure the integrity of the data."}),"\n",(0,i.jsx)(t.p,{children:"In addition, it is best for users to set the content of the Expect Header field to 100-continue, which can avoid unnecessary data transmission in some error scenarios."}),"\n",(0,i.jsx)(t.p,{children:"Parameter introduction:\nUsers can pass in import parameters through the Header part of HTTP"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"label: The label imported once, the data of the same label cannot be imported multiple times. Users can avoid the problem of duplicate data import by specifying Label."}),"\n",(0,i.jsx)(t.p,{children:"Currently, Doris retains the most recent successful label within 30 minutes."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"column_separator: used to specify the column separator in the import file, the default is \\t. If it is an invisible character, you need to add \\x as a prefix and use hexadecimal to represent the separator."}),"\n",(0,i.jsx)(t.p,{children:'For example, the separator \\x01 of the hive file needs to be specified as -H "column_separator:\\x01".'}),"\n",(0,i.jsx)(t.p,{children:"You can use a combination of multiple characters as column separators."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"line_delimiter: used to specify the newline character in the imported file, the default is \\n. Combinations of multiple characters can be used as newlines."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"columns: used to specify the correspondence between the columns in the import file and the columns in the table. If the column in the source file corresponds exactly to the content in the table, then there is no need to specify the content of this field."}),"\n",(0,i.jsx)(t.p,{children:"If the source file does not correspond to the table schema, then this field is required for some data conversion. There are two forms of column, one is directly corresponding to the field in the imported file, which is directly represented by the field name;"}),"\n",(0,i.jsxs)(t.p,{children:["One is derived column, the syntax is ",(0,i.jsx)(t.code,{children:"column_name"})," = expression. Give a few examples to help understand."]}),"\n",(0,i.jsx)(t.p,{children:'Example 1: There are 3 columns "c1, c2, c3" in the table, and the three columns in the source file correspond to "c3, c2, c1" at a time; then you need to specify -H "columns: c3, c2, c1 "'}),"\n",(0,i.jsx)(t.p,{children:'Example 2: There are 3 columns "c1, c2, c3" in the table, the first three columns in the source file correspond in turn, but there is more than 1 column; then you need to specify -H "columns: c1, c2, c3, xxx";'}),"\n",(0,i.jsx)(t.p,{children:"The last column can be arbitrarily assigned a name and placeholder"}),"\n",(0,i.jsx)(t.p,{children:'Example 3: There are three columns "year, month, day" in the table, and there is only one time column in the source file, which is in "2018-06-01 01:02:03" format;'}),"\n",(0,i.jsx)(t.p,{children:'Then you can specify -H "columns: col, year = year(col), month=month(col), day=day(col)" to complete the import'}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"where: used to extract part of the data. If the user needs to filter out the unnecessary data, he can achieve this by setting this option."}),"\n",(0,i.jsx)(t.p,{children:'Example 1: Only import data greater than k1 column equal to 20180601, then you can specify -H "where: k1 = 20180601" when importing'}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"max_filter_ratio: The maximum tolerable data ratio that can be filtered (for reasons such as data irregularity). Zero tolerance by default. Data irregularities do not include rows filtered out by where conditions."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"partitions: used to specify the partition designed for this import. If the user can determine the partition corresponding to the data, it is recommended to specify this item. Data that does not satisfy these partitions will be filtered out."}),"\n",(0,i.jsx)(t.p,{children:'For example, specify import to p1, p2 partition, -H "partitions: p1, p2"'}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"timeout: Specify the import timeout. in seconds. The default is 600 seconds. The setting range is from 1 second to 259200 seconds."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:'strict_mode: The user specifies whether to enable strict mode for this import. The default is off. The enable mode is -H "strict_mode: true".'}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:['timezone: Specifies the timezone used for this import. The default is "+08:00". This variable replaces the session variable ',(0,i.jsx)(t.code,{children:"time_zone"}),' in this import transaction. See the section "Importing with timezones" in ',(0,i.jsx)(t.a,{href:"#best-practice",children:"Best Practice"})," for more information."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"exec_mem_limit: Load memory limit. Default is 2GB. The unit is bytes."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"format: Specify load data format, support csv, json,  csv_with_names(support csv file line header filter), csv_with_names_and_types(support csv file first two lines filter), parquet, orc, default is csv."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.admonition,{title:"Tips",type:"tip",children:(0,i.jsx)(t.p,{children:"This feature is supported since the Apache Doris 1.2 version"})}),"\n",(0,i.jsxs)(t.ol,{start:"13",children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"jsonpaths: The way of importing json is divided into: simple mode and matching mode."}),"\n",(0,i.jsx)(t.p,{children:"Simple mode: The simple mode is not set the jsonpaths parameter. In this mode, the json data is required to be an object type, for example:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'{"k1":1, "k2":2, "k3":"hello"}, where k1, k2, k3 are column names.\n'})}),"\n",(0,i.jsx)(t.p,{children:"Matching mode: It is relatively complex for json data and needs to match the corresponding value through the jsonpaths parameter."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"strip_outer_array: Boolean type, true indicates that the json data starts with an array object and flattens the array object, the default value is false. E.g:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:' [\n  {"k1" : 1, "v1" : 2},\n  {"k1" : 3, "v1" : 4}\n ]\n'})}),"\n",(0,i.jsx)(t.p,{children:"When strip_outer_array is true, the final import into doris will generate two rows of data."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:'json_root: json_root is a valid jsonpath string, used to specify the root node of the json document, the default value is "".'}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["merge_type: The merge type of data, which supports three types: APPEND, DELETE, and MERGE. Among them, APPEND is the default value, which means that this batch of data needs to be appended to the existing data, and DELETE means to delete all the data with the same key as this batch of data. Line, the MERGE semantics need to be used in conjunction with the delete condition, which means that the data that meets the delete condition is processed according to the DELETE semantics and the rest is processed according to the APPEND semantics, for example: ",(0,i.jsx)(t.code,{children:'-H "merge_type: MERGE" -H "delete: flag=1"'})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"delete: Only meaningful under MERGE, indicating the deletion condition of the data"}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"function_column.sequence_col: Only applicable to UNIQUE_KEYS. Under the same key column, ensure that the value column is REPLACEed according to the source_sequence column. The source_sequence can be a column in the data source or a column in the table structure."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"fuzzy_parse: Boolean type, true means that json will be parsed with the schema of the first row. Enabling this option can improve the efficiency of json import, but requires that the order of the keys of all json objects is the same as the first row, the default is false, only use in json format"}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"num_as_string: Boolean type, true means that when parsing json data, the numeric type will be converted to a string, and then imported without losing precision."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"read_json_by_line: Boolean type, true to support reading one json object per line, the default value is false."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["send_batch_parallelism: Integer, used to set the parallelism of sending batch data. If the value of parallelism exceeds ",(0,i.jsx)(t.code,{children:"max_send_batch_parallelism_per_job"})," in the BE configuration, the BE as a coordination point will use the value of ",(0,i.jsx)(t.code,{children:"max_send_batch_parallelism_per_job"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["hidden_columns: Specify hidden column when no ",(0,i.jsx)(t.code,{children:"columns"})," in Headers, multi hidden column shoud be\nseparated by commas."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"    hidden_columns: __DORIS_DELETE_SIGN__,__DORIS_SEQUENCE_COL__\n    The system will use the order specified by user. in case above, data should be ended\n    with __DORIS_SEQUENCE_COL__.\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"load_to_single_tablet: Boolean type, True means that one task can only load data to one tablet in the corresponding partition at a time. The default value is false. This parameter can only be set when loading data into the OLAP table with random bucketing."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"compress_type: Specify compress type file. Only support compressed csv file now. Support gz, lzo, bz2, lz4, lzop, deflate."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"trim_double_quotes: Boolean type, The default value is false. True means that the outermost double quotes of each field in the csv file are trimmed."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["skip_lines:   Integer type, the default value is 0. It will skip some lines in the head of csv file. It will be disabled when format is ",(0,i.jsx)(t.code,{children:"csv_with_names"})," or ",(0,i.jsx)(t.code,{children:"csv_with_names_and_types"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:'comment: String type, the default value is "".'}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.admonition,{title:"Tips",type:"tip",children:(0,i.jsx)(t.p,{children:"This feature  is supported since the Apache Doris 1.2.3 version"})}),"\n",(0,i.jsxs)(t.ol,{start:"29",children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:['enclose:   When the csv data field contains row delimiters or column delimiters, to prevent accidental truncation, single-byte characters can be specified as brackets for protection. For example, the column separator is ",", the bracket is "\'", and the data is "a,\'b,c\'", then "b,c" will be parsed as a field. Note: when the bracket is ',(0,i.jsx)(t.code,{children:'"'}),", trim_double_quotes must be set to true."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:'escape   Used to escape characters that appear in a csv field identical to the enclosing characters. For example, if the data is "a,\'b,\'c\'", enclose is "\'", and you want "b,\'c to be parsed as a field, you need to specify a single-byte escape character, such as "", and then modify the data to "a,\' b,\'c\'".'}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"example",children:"Example"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import the data in the local file 'testData' into the table 'testTbl' in the database 'testDb', and use Label for deduplication. Specify a timeout of 100 seconds"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'    curl --location-trusted -u root -H "label:123" -H "timeout:100" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import the data in the local file 'testData' into the table 'testTbl' in the database 'testDb', use Label for deduplication, and only import data whose k1 is equal to 20180601"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -H "label:123" -H "where: k1=20180601" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import the data in the local file 'testData' into the table 'testTbl' in the database 'testDb', allowing a 20% error rate (the user is in the defalut_cluster)"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -H "label:123" -H "max_filter_ratio:0.2" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import the data in the local file 'testData' into the table 'testTbl' in the database 'testDb', allow a 20% error rate, and specify the column name of the file (the user is in the defalut_cluster)"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -H "label:123" -H "max_filter_ratio:0.2" -H "columns: k2, k1, v1" -T testData http://host:port/api/testDb/testTbl /_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import the data in the local file 'testData' into the p1, p2 partitions of the table 'testTbl' in the database 'testDb', allowing a 20% error rate."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -H "label:123" -H "max_filter_ratio:0.2" -H "partitions: p1, p2" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import using streaming (user is in defalut_cluster)"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"seq 1 10 | awk '{OFS=\"\\t\"}{print $1, $1 * 10}' | curl --location-trusted -u root -T - http://host:port/api/testDb/testTbl/ _stream_load\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import a table containing HLL columns, which can be columns in the table or columns in the data to generate HLL columns, or use hll_empty to supplement columns that are not in the data"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -H "columns: k1, k2, v1=hll_hash(k1), v2=hll_empty()" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import data for strict mode filtering and set the time zone to Africa/Abidjan"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -H "strict_mode: true" -H "timezone: Africa/Abidjan" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import a table with a BITMAP column, which can be a column in the table or a column in the data to generate a BITMAP column, or use bitmap_empty to fill an empty Bitmap"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:' curl --location-trusted -u root -H "columns: k1, k2, v1=to_bitmap(k1), v2=bitmap_empty()" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Simple mode, import json data\nTable Structure:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'`category` varchar(512) NULL COMMENT "",\n`author` varchar(512) NULL COMMENT "",\n`title` varchar(512) NULL COMMENT "",\n`price` double NULL COMMENT ""\n'})}),"\n",(0,i.jsx)(t.p,{children:"json data format:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'{"category":"C++","author":"avc","title":"C++ primer","price":895}\n'})}),"\n",(0,i.jsx)(t.p,{children:"Import command:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -H "label:123" -H "format: json" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n",(0,i.jsx)(t.p,{children:"In order to improve throughput, it supports importing multiple pieces of json data at one time, each line is a json object, and \\n is used as a newline by default. You need to set read_json_by_line to true. The json data format is as follows:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'{"category":"C++","author":"avc","title":"C++ primer","price":89.5}\n{"category":"Java","author":"avc","title":"Effective Java","price":95}\n{"category":"Linux","author":"avc","title":"Linux kernel","price":195}\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Match pattern, import json data\njson data format:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'[\n{"category":"xuxb111","author":"1avc","title":"SayingsoftheCentury","price":895},{"category":"xuxb222","author":"2avc"," title":"SayingsoftheCentury","price":895},\n{"category":"xuxb333","author":"3avc","title":"SayingsoftheCentury","price":895}\n]\n'})}),"\n",(0,i.jsx)(t.p,{children:"Precise import by specifying jsonpath, such as importing only three attributes of category, author, and price"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -H "columns: category, price, author" -H "label:123" -H "format: json" -H "jsonpaths: [\\"$.category\\",\\" $.price\\",\\"$.author\\"]" -H "strip_outer_array: true" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n",(0,i.jsx)(t.p,{children:"illustrate:\n1) If the json data starts with an array, and each object in the array is a record, you need to set strip_outer_array to true, which means flatten the array.\n2) If the json data starts with an array, and each object in the array is a record, when setting jsonpath, our ROOT node is actually an object in the array."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"User specified json root node\njson data format:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'{\n "RECORDS":[\n{"category":"11","title":"SayingsoftheCentury","price":895,"timestamp":1589191587},\n{"category":"22","author":"2avc","price":895,"timestamp":1589191487},\n{"category":"33","author":"3avc","title":"SayingsoftheCentury","timestamp":1589191387}\n]\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"Precise import by specifying jsonpath, such as importing only three attributes of category, author, and price"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -H "columns: category, price, author" -H "label:123" -H "format: json" -H "jsonpaths: [\\"$.category\\",\\" $.price\\",\\"$.author\\"]" -H "strip_outer_array: true" -H "json_root: $.RECORDS" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Delete the data with the same import key as this batch"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -H "merge_type: DELETE" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Delete the columns in this batch of data that match the data whose flag is listed as true, and append other rows normally"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root: -H "column_separator:," -H "columns: siteid, citycode, username, pv, flag" -H "merge_type: MERGE" -H "delete: flag=1" -T testData http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import data into UNIQUE_KEYS table with sequence column"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -H "columns: k1,k2,source_sequence,v1,v2" -H "function_column.sequence_col: source_sequence" -T testData http://host:port/api/testDb/testTbl/ _stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"csv file line header filter import"}),"\n",(0,i.jsx)(t.p,{children:"file data:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"   id,name,age\n   1,doris,20\n   2,flink,10\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Filter the first line import by specifying ",(0,i.jsx)(t.code,{children:"format=csv_with_names"})]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -T test.csv  -H "label:1" -H "format:csv_with_names" -H "column_separator:," http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import data into a table whose table field contains DEFAULT CURRENT_TIMESTAMP"}),"\n",(0,i.jsx)(t.p,{children:"Table Structure:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"`id` bigint(30) NOT NULL,\n`order_code` varchar(30) DEFAULT NULL COMMENT '',\n`create_time` datetimev2(3) DEFAULT CURRENT_TIMESTAMP    \n"})}),"\n",(0,i.jsx)(t.p,{children:"JSON data format:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'{"id":1,"order_Code":"avc"}\n'})}),"\n",(0,i.jsx)(t.p,{children:"Import command:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'curl --location-trusted -u root -T test.json -H "label:1" -H "format:json" -H \'columns: id, order_code, create_time=CURRENT_TIMESTAMP()\' http://host:port/api/testDb/testTbl/_stream_load\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"keywords",children:"Keywords"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"STREAM, LOAD\n"})}),"\n",(0,i.jsx)(t.h3,{id:"best-practice",children:"Best Practice"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Check the import task status"}),"\n",(0,i.jsx)(t.p,{children:"Stream Load is a synchronous import process. The successful execution of the statement means that the data is imported successfully. The imported execution result will be returned synchronously through the HTTP return value. And display it in Json format. An example is as follows:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'{\n    "TxnId": 17,\n    "Label": "707717c0-271a-44c5-be0b-4e71bfeacaa5",\n    "Status": "Success",\n    "Message": "OK",\n    "NumberTotalRows": 5,\n    "NumberLoadedRows": 5,\n    "NumberFilteredRows": 0,\n    "NumberUnselectedRows": 0,\n    "LoadBytes": 28,\n    "LoadTimeMs": 27,\n    "BeginTxnTimeMs": 0,\n    "StreamLoadPutTimeMs": 2,\n    "ReadDataTimeMs": 0,\n    "WriteDataTimeMs": 3,\n    "CommitAndPublishTimeMs": 18\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"The following main explanations are given for the Stream load import result parameters:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"TxnId: The imported transaction ID. Users do not perceive."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Label: Import Label. User specified or automatically generated by the system."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Status: Import completion status."}),"\n",(0,i.jsx)(t.p,{children:'"Success": Indicates successful import.'}),"\n",(0,i.jsx)(t.p,{children:'"Publish Timeout": This state also indicates that the import has been completed, except that the data may be delayed and visible without retrying.'}),"\n",(0,i.jsx)(t.p,{children:'"Label Already Exists": Label duplicate, need to be replaced Label.'}),"\n",(0,i.jsx)(t.p,{children:'"Fail": Import failed.'}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"ExistingJobStatus: The state of the load job corresponding to the existing Label."}),"\n",(0,i.jsx)(t.p,{children:'This field is displayed only when the status is "Label Already Exists". The user can know the status of the load job corresponding to Label through this state. "RUNNING" means that the job is still executing, and "FINISHED" means that the job is successful.'}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Message: Import error messages."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"NumberTotalRows: Number of rows imported for total processing."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"NumberLoadedRows: Number of rows successfully imported."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"NumberFilteredRows: Number of rows that do not qualify for data quality."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"NumberUnselectedRows: Number of rows filtered by where condition."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"LoadBytes: Number of bytes imported."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"LoadTimeMs: Import completion time. Unit milliseconds."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"BeginTxnTimeMs: The time cost for RPC to Fe to begin a transaction, Unit milliseconds."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"StreamLoadPutTimeMs: The time cost for RPC to Fe to get a stream load plan, Unit milliseconds."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"ReadDataTimeMs: Read data time, Unit milliseconds."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"WriteDataTimeMs: Write data time, Unit milliseconds."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"CommitAndPublishTimeMs: The time cost for RPC to Fe to commit and publish a transaction, Unit milliseconds."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"ErrorURL: If you have data quality problems, visit this URL to see specific error lines."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"Note: Since Stream load is a synchronous import mode, import information will not be recorded in Doris system. Users cannot see Stream load asynchronously by looking at import commands. You need to listen for the return value of the create import request to get the import result."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"How to correctly submit the Stream Load job and process the returned results."}),"\n",(0,i.jsx)(t.p,{children:"Stream Load is a synchronous import operation, so the user needs to wait for the return result of the command synchronously, and decide the next processing method according to the return result."}),"\n",(0,i.jsxs)(t.p,{children:["The user's primary concern is the ",(0,i.jsx)(t.code,{children:"Status"})," field in the returned result."]}),"\n",(0,i.jsxs)(t.p,{children:["If it is ",(0,i.jsx)(t.code,{children:"Success"}),", everything is fine and you can do other operations after that."]}),"\n",(0,i.jsxs)(t.p,{children:["If the returned result shows a large number of ",(0,i.jsx)(t.code,{children:"Publish Timeout"}),", it may indicate that some resources (such as IO) of the cluster are currently under strain, and the imported data cannot take effect finally. The import task in the state of ",(0,i.jsx)(t.code,{children:"Publish Timeout"})," has succeeded and does not need to be retried. However, it is recommended to slow down or stop the submission of new import tasks and observe the cluster load."]}),"\n",(0,i.jsxs)(t.p,{children:["If the returned result is ",(0,i.jsx)(t.code,{children:"Fail"}),", the import failed, and you need to check the problem according to the specific reason. Once resolved, you can retry with the same Label."]}),"\n",(0,i.jsx)(t.p,{children:"In some cases, the user's HTTP connection may be disconnected abnormally and the final returned result cannot be obtained. At this point, you can use the same Label to resubmit the import task, and the resubmitted task may have the following results:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"Status"})," status is ",(0,i.jsx)(t.code,{children:"Success"}),", ",(0,i.jsx)(t.code,{children:"Fail"})," or ",(0,i.jsx)(t.code,{children:"Publish Timeout"}),". At this point, it can be processed according to the normal process."]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"Status"})," status is ",(0,i.jsx)(t.code,{children:"Label Already Exists"}),". At this time, you need to continue to view the ",(0,i.jsx)(t.code,{children:"ExistingJobStatus"})," field. If the value of this field is ",(0,i.jsx)(t.code,{children:"FINISHED"}),", it means that the import task corresponding to this Label has been successful, and there is no need to retry. If it is ",(0,i.jsx)(t.code,{children:"RUNNING"}),", it means that the import task corresponding to this Label is still running. At this time, you need to use the same Label to continue to submit repeatedly at intervals (such as 10 seconds) until ",(0,i.jsx)(t.code,{children:"Status"})," is not ",(0,i.jsx)(t.code,{children:"Label Already Exists' "}),", or until the value of the ",(0,i.jsx)(t.code,{children:"ExistingJobStatus"})," field is ",(0,i.jsx)(t.code,{children:"FINISHED"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Cancel the import task"}),"\n",(0,i.jsx)(t.p,{children:"Import tasks that have been submitted and not yet completed can be canceled with the CANCEL LOAD command. After cancellation, the written data will also be rolled back and will not take effect."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Label, import transaction, multi-table atomicity"}),"\n",(0,i.jsxs)(t.p,{children:["All import tasks in Doris are atomic. And the import of multiple tables in the same import task can also guarantee atomicity. At the same time, Doris can also use the Label mechanism to ensure that the data imported is not lost or heavy. For details, see the ",(0,i.jsx)(t.a,{href:"../../../../data-operate/import/load-atomicity",children:"Import Transactions and Atomicity"})," documentation."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Column mapping, derived columns and filtering"}),"\n",(0,i.jsxs)(t.p,{children:["Doris can support very rich column transformation and filtering operations in import statements. Most built-in functions and UDFs are supported. For how to use this function correctly, please refer to the ",(0,i.jsx)(t.a,{href:"../../../../data-operate/import/load-data-convert",children:"Column Mapping, Conversion and Filtering"})," document."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Error data filtering"}),"\n",(0,i.jsxs)(t.p,{children:["Doris' import tasks can tolerate a portion of malformed data. The tolerance ratio is set via ",(0,i.jsx)(t.code,{children:"max_filter_ratio"}),". The default is 0, which means that the entire import task will fail when there is an error data. If the user wants to ignore some problematic data rows, the secondary parameter can be set to a value between 0 and 1, and Doris will automatically skip the rows with incorrect data format."]}),"\n",(0,i.jsxs)(t.p,{children:["For some calculation methods of the tolerance rate, please refer to the ",(0,i.jsx)(t.a,{href:"../../../../data-operate/import/load-data-convert",children:"Column Mapping, Conversion and Filtering"})," document."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Strict Mode"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"strict_mode"})," attribute is used to set whether the import task runs in strict mode. The format affects the results of column mapping, transformation, and filtering, and it also controls the behavior of partial updates. For a detailed description of strict mode, see the ",(0,i.jsx)(t.a,{href:"../../../../data-operate/import/load-strict-mode",children:"strict mode"})," documentation."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Timeout"}),"\n",(0,i.jsx)(t.p,{children:"The default timeout for Stream Load is 10 minutes. from the time the task is submitted. If it does not complete within the timeout period, the task fails."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Limits on data volume and number of tasks"}),"\n",(0,i.jsx)(t.p,{children:"Stream Load is suitable for importing data within a few GB. Because the data is processed by single-threaded transmission, the performance of importing excessively large data cannot be guaranteed. When a large amount of local data needs to be imported, multiple import tasks can be submitted in parallel."}),"\n",(0,i.jsx)(t.p,{children:"Doris also limits the number of import tasks running at the same time in the cluster, usually ranging from 10-20. Import jobs submitted after that will be rejected."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Importing with timezones"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Since Doris currently has no built-in time types for time zones, all ",(0,i.jsx)(t.code,{children:"DATETIME"})," related types only represent absolute points in time, and do not contain time zone information, which does not change due to time zone changes in the Doris system. Therefore, for importing data with a time zone, we uniformly handle it as ",(0,i.jsx)(t.strong,{children:"converting it to data in a specific target time zone"}),". In the Doris system, this is the time zone represented by the session variable ",(0,i.jsx)(t.code,{children:"time_zone"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["In the import, on the other hand, our target timezone is specified by the parameter ",(0,i.jsx)(t.code,{children:"timezone"}),", which will replace the session variable ",(0,i.jsx)(t.code,{children:"time_zone"})," when timezone conversions occur, and when computing timezone-sensitive functions. Therefore, if there are no special circumstances, ",(0,i.jsx)(t.code,{children:"timezone"})," should be set in the import transaction to match the ",(0,i.jsx)(t.code,{children:"time_zone"}),' of the current Doris cluster. This means that all time data with a time zone will be converted to that time zone.\nFor example, if the Doris system timezone is "+08:00", and the time column in the imported data contains two pieces of data, "2012-01-01 01:00:00Z" and "2015-12-12 12:12:12-08:00", then after we specify the timezone of the imported transaction via ',(0,i.jsx)(t.code,{children:'-H "timezone: +08:00"'}),' during import, both pieces of data will be converted to that timezone, resulting in the results "2012-01-01 09:00:00" and "2015-12-13 04:12:12".']}),"\n",(0,i.jsxs)(t.p,{children:["For a more detailed understanding, see ",(0,i.jsx)(t.a,{href:"../../../../query/query-variables/time-zone",children:"time-zone"})," document."]}),"\n",(0,i.jsxs)(t.ol,{start:"11",children:["\n",(0,i.jsx)(t.li,{children:"The Execution Engine Choice"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["The Session Variable ",(0,i.jsx)(t.code,{children:"enable_pipeline_load"})," determines whether to attempt to enable the Pipeline engine for Streamload tasks. See ",(0,i.jsx)(t.a,{href:"../../../../data-operate/import/load-manual",children:"Import"})," document for more."]})]})}function h(e={}){let{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return o},a:function(){return a}});var s=n(667294);let i={},r=s.createContext(i);function a(e){let t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);