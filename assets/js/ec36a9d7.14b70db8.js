"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["36212"],{996629:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>c,metadata:()=>i,assets:()=>o,toc:()=>l,contentTitle:()=>a});var i=JSON.parse('{"id":"admin-manual/auth/certificate","title":"MySQL Secure Transport","description":"Learn how to configure SSL/TLS encrypted connections for Apache Doris to protect data transmission security between MySQL clients and Doris. Supports TLS1.2/1.3 protocols with two modes: one-way authentication and mTLS mutual authentication.","source":"@site/versioned_docs/version-4.x/admin-manual/auth/certificate.md","sourceDirName":"admin-manual/auth","slug":"/admin-manual/auth/certificate","permalink":"/docs/4.x/admin-manual/auth/certificate","draft":false,"unlisted":false,"tags":[],"version":"4.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"MySQL Secure Transport","language":"en","description":"Learn how to configure SSL/TLS encrypted connections for Apache Doris to protect data transmission security between MySQL clients and Doris. Supports TLS1.2/1.3 protocols with two modes: one-way authentication and mTLS mutual authentication."},"sidebar":"docs","previous":{"title":"Audit Log","permalink":"/docs/4.x/admin-manual/audit-plugin"},"next":{"title":"FE SSL Certificate","permalink":"/docs/4.x/admin-manual/auth/fe-certificate"}}'),s=t("785893"),r=t("250065");let c={title:"MySQL Secure Transport",language:"en",description:"Learn how to configure SSL/TLS encrypted connections for Apache Doris to protect data transmission security between MySQL clients and Doris. Supports TLS1.2/1.3 protocols with two modes: one-way authentication and mTLS mutual authentication."},a=void 0,o={},l=[{value:"Overview",id:"overview",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Client Connection Methods",id:"client-connection-methods",level:2},{value:"Configuring Mutual Authentication (mTLS)",id:"configuring-mutual-authentication-mtls",level:2},{value:"Enable mTLS",id:"enable-mtls",level:3},{value:"Client Connection",id:"client-connection",level:3},{value:"Certificate Configuration Details",id:"certificate-configuration-details",level:2},{value:"Default Certificates",id:"default-certificates",level:3},{value:"Custom Certificates",id:"custom-certificates",level:3},{value:"Generating Custom Certificates",id:"generating-custom-certificates",level:2},{value:"Step 1: Generate CA, Server-side, and Client-side Keys and Certificates",id:"step-1-generate-ca-server-side-and-client-side-keys-and-certificates",level:3},{value:"Step 2: Verify Certificates",id:"step-2-verify-certificates",level:3},{value:"Step 3: Package into PKCS#12 Format",id:"step-3-package-into-pkcs12-format",level:3}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"This document describes how to configure SSL/TLS encryption for communication between Doris and MySQL clients to protect data transmission security."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Doris supports SSL-based encrypted connections, currently supporting TLS1.2 and TLS1.3 protocols. By enabling SSL, you can ensure that data transmission between clients and Doris FE is encrypted, preventing data from being intercepted or tampered with during transmission."}),"\n",(0,s.jsx)(n.p,{children:"Doris provides two SSL authentication modes:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Authentication Mode"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Use Case"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"One-way authentication (default)"}),(0,s.jsx)(n.td,{children:"Only validates server certificate"}),(0,s.jsx)(n.td,{children:"General security requirements"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Mutual authentication (mTLS)"}),(0,s.jsx)(n.td,{children:"Validates both server and client certificates"}),(0,s.jsx)(n.td,{children:"High security requirements"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,s.jsx)(n.p,{children:"Enable SSL encrypted connections in just two steps:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. Enable SSL functionality in FE"})}),"\n",(0,s.jsxs)(n.p,{children:["Modify the FE configuration file ",(0,s.jsx)(n.code,{children:"conf/fe.conf"}),", add the following configuration, and restart FE:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-properties",children:"enable_ssl = true\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Connect using MySQL client"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"mysql --ssl-mode=REQUIRED -uroot -P9030 -h127.0.0.1\n"})}),"\n",(0,s.jsx)(n.p,{children:"Doris has built-in default key certificate files, so SSL functionality can be used without additional configuration."}),"\n",(0,s.jsx)(n.h2,{id:"client-connection-methods",children:"Client Connection Methods"}),"\n",(0,s.jsx)(n.p,{children:"When connecting to Doris via MySQL client, you can choose the following SSL modes:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"SSL Mode"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Command Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"PREFERRED (default)"}),(0,s.jsx)(n.td,{children:"Attempts SSL connection first, falls back to regular connection if failed"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mysql -uroot -P9030 -h127.0.0.1"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DISABLE"}),(0,s.jsx)(n.td,{children:"Disables SSL, uses regular connection"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mysql --ssl-mode=DISABLE -uroot -P9030 -h127.0.0.1"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"REQUIRED"}),(0,s.jsx)(n.td,{children:"Forces SSL connection"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mysql --ssl-mode=REQUIRED -uroot -P9030 -h127.0.0.1"})})]})]})]}),"\n",(0,s.jsx)(n.admonition,{title:"Note",type:"note",children:(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"--ssl-mode"})," parameter was introduced in MySQL 5.7.11. For MySQL clients below this version, please refer to the ",(0,s.jsx)(n.a,{href:"https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-connp-props-security.html",children:"MySQL official documentation"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"configuring-mutual-authentication-mtls",children:"Configuring Mutual Authentication (mTLS)"}),"\n",(0,s.jsx)(n.p,{children:"If you need a higher level of security, you can enable mTLS mutual authentication, which requires clients to also provide certificates for identity verification."}),"\n",(0,s.jsx)(n.h3,{id:"enable-mtls",children:"Enable mTLS"}),"\n",(0,s.jsxs)(n.p,{children:["Modify the FE configuration file ",(0,s.jsx)(n.code,{children:"conf/fe.conf"}),", add the following configuration, and restart FE:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-properties",children:"enable_ssl = true\nssl_force_client_auth = true\n"})}),"\n",(0,s.jsx)(n.h3,{id:"client-connection",children:"Client Connection"}),"\n",(0,s.jsx)(n.p,{children:"When connecting with mTLS, the client needs to specify the CA certificate, client certificate, and private key:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"mysql --ssl-mode=VERIFY_CA -uroot -P9030 -h127.0.0.1 \\\n      --tls-version=TLSv1.2 \\\n      --ssl-ca=/path/to/your/ca.pem \\\n      --ssl-cert=/path/to/your/client-cert.pem \\\n      --ssl-key=/path/to/your/client-key.pem\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Doris provides default client certificate files located in the ",(0,s.jsx)(n.code,{children:"Doris/conf/mysql_ssl_default_certificate/client_certificate/"})," directory:"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"File Name"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ca.pem"})}),(0,s.jsx)(n.td,{children:"CA certificate"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"client-cert.pem"})}),(0,s.jsx)(n.td,{children:"Client certificate"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"client-key.pem"})}),(0,s.jsx)(n.td,{children:"Client private key"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"certificate-configuration-details",children:"Certificate Configuration Details"}),"\n",(0,s.jsx)(n.p,{children:"Enabling SSL functionality in Doris requires configuring CA key certificates and Server-side key certificates. If mutual authentication is enabled, Client-side key certificates must also be configured."}),"\n",(0,s.jsx)(n.h3,{id:"default-certificates",children:"Default Certificates"}),"\n",(0,s.jsx)(n.p,{children:"Doris has built-in default certificate files that can be used directly:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Certificate Type"}),(0,s.jsx)(n.th,{children:"Default Path"}),(0,s.jsx)(n.th,{children:"Default Password"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"CA Certificate"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Doris/fe/mysql_ssl_default_certificate/ca_certificate.p12"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"doris"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Server-side Certificate"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Doris/fe/mysql_ssl_default_certificate/server_certificate.p12"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"doris"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Client-side Certificate"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Doris/fe/mysql_ssl_default_certificate/client_certificate/"})}),(0,s.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"custom-certificates",children:"Custom Certificates"}),"\n",(0,s.jsxs)(n.p,{children:["To use custom certificates, add the following configuration to the FE configuration file ",(0,s.jsx)(n.code,{children:"conf/fe.conf"}),":"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"CA Certificate Configuration"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-properties",children:"mysql_ssl_default_ca_certificate = /path/to/your/ca_certificate.p12\nmysql_ssl_default_ca_certificate_password = your_password\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Server-side Certificate Configuration"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-properties",children:"mysql_ssl_default_server_certificate = /path/to/your/server_certificate.p12\nmysql_ssl_default_server_certificate_password = your_password\n"})}),"\n",(0,s.jsx)(n.h2,{id:"generating-custom-certificates",children:"Generating Custom Certificates"}),"\n",(0,s.jsxs)(n.p,{children:["If you need to use your own certificates, you can generate them using OpenSSL. For detailed steps, please refer to the ",(0,s.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/8.0/en/creating-ssl-files-using-openssl.html",children:"MySQL official documentation: Creating SSL Certificates Using OpenSSL"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"step-1-generate-ca-server-side-and-client-side-keys-and-certificates",children:"Step 1: Generate CA, Server-side, and Client-side Keys and Certificates"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# Generate CA certificate\nopenssl genrsa 2048 > ca-key.pem\nopenssl req -new -x509 -nodes -days 3600 \\\n        -key ca-key.pem -out ca.pem\n\n# Generate Server-side certificate and sign with the above CA\n# server-cert.pem = public key, server-key.pem = private key\nopenssl req -newkey rsa:2048 -days 3600 \\\n        -nodes -keyout server-key.pem -out server-req.pem\nopenssl rsa -in server-key.pem -out server-key.pem\nopenssl x509 -req -in server-req.pem -days 3600 \\\n        -CA ca.pem -CAkey ca-key.pem -set_serial 01 -out server-cert.pem\n\n# Generate Client-side certificate and sign with the above CA\n# client-cert.pem = public key, client-key.pem = private key\nopenssl req -newkey rsa:2048 -days 3600 \\\n        -nodes -keyout client-key.pem -out client-req.pem\nopenssl rsa -in client-key.pem -out client-key.pem\nopenssl x509 -req -in client-req.pem -days 3600 \\\n        -CA ca.pem -CAkey ca-key.pem -set_serial 01 -out client-cert.pem\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-2-verify-certificates",children:"Step 2: Verify Certificates"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"openssl verify -CAfile ca.pem server-cert.pem client-cert.pem\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-3-package-into-pkcs12-format",children:"Step 3: Package into PKCS#12 Format"}),"\n",(0,s.jsx)(n.p,{children:"Merge the CA key and certificate, and Server-side key and certificate separately into PKCS#12 (P12) format for use by Doris:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# Package CA key and certificate\nopenssl pkcs12 -inkey ca-key.pem -in ca.pem -export -out ca_certificate.p12\n\n# Package Server-side key and certificate\nopenssl pkcs12 -inkey server-key.pem -in server-cert.pem -export -out server_certificate.p12\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"Tip",type:"tip",children:(0,s.jsxs)(n.p,{children:["You can also modify the ",(0,s.jsx)(n.code,{children:"conf/fe.conf"})," configuration file and add the parameter ",(0,s.jsx)(n.code,{children:"ssl_trust_store_type"})," to specify other certificate formats. The default is PKCS12."]})}),"\n",(0,s.jsx)(n.admonition,{title:"More Information",type:"info",children:(0,s.jsxs)(n.p,{children:["For more information on generating self-signed certificates using OpenSSL, please refer to the ",(0,s.jsx)(n.a,{href:"https://www.ibm.com/docs/en/api-connect/2018.x?topic=overview-generating-self-signed-certificate-using-openssl",children:"IBM official documentation"}),"."]})})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return a},a:function(){return c}});var i=t(667294);let s={},r=i.createContext(s);function c(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);