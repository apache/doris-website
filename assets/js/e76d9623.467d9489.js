"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["290150"],{718576:function(e,n,t){t.r(n),t.d(n,{default:()=>u,frontMatter:()=>r,metadata:()=>s,assets:()=>c,toc:()=>o,contentTitle:()=>l});var s=JSON.parse('{"id":"sql-manual/sql-functions/aggregate-functions/approx-count-distinct","title":"APPROX_COUNT_DISTINCT","description":"Description","source":"@site/docs/sql-manual/sql-functions/aggregate-functions/approx-count-distinct.md","sourceDirName":"sql-manual/sql-functions/aggregate-functions","slug":"/sql-manual/sql-functions/aggregate-functions/approx-count-distinct","permalink":"/docs/dev/sql-manual/sql-functions/aggregate-functions/approx-count-distinct","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"APPROX_COUNT_DISTINCT","language":"en"},"sidebar":"docs","previous":{"title":"ANY_VALUE","permalink":"/docs/dev/sql-manual/sql-functions/aggregate-functions/any-value"},"next":{"title":"APPROX_TOP_K","permalink":"/docs/dev/sql-manual/sql-functions/aggregate-functions/approx-top-k"}}'),a=t("785893"),i=t("250065");let r={title:"APPROX_COUNT_DISTINCT",language:"en"},l=void 0,c={},o=[{value:"Description",id:"description",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Return Value",id:"return-value",level:2},{value:"Example",id:"example",level:2}];function d(e){let n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,a.jsxs)(n.p,{children:["Returns the number of distinct non-NULL elements.\nThis function is implemented based on the HyperLogLog algorithm, which uses a fixed size of memory to estimate the column base. The algorithm is based on the assumption of a null distribution in the tails, and the accuracy depends on the data distribution. Based on the fixed bucket size used by Doris, the relative standard error of the algorithm is 0.8125%.\nFor a more detailed and specific analysis, see ",(0,a.jsx)(n.a,{href:"https://algo.inria.fr/flajolet/Publications/FlFuGaMe07.pdf",children:"related paper"})]}),"\n",(0,a.jsx)(n.h2,{id:"syntax",children:"Syntax"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"APPROX_COUNT_DISTINCT(<expr>)\nNDV(<expr>)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Parameters"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsx)(n.tbody,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"<expr>"})}),(0,a.jsx)(n.td,{children:"The expression to get the value. Supported types are String, Date, DateTime, IPv4, IPv6, TinyInt, Bool, SmallInt, Integer, BigInt, LargeInt, Float, Double, Decimal."})]})})]}),"\n",(0,a.jsx)(n.h2,{id:"return-value",children:"Return Value"}),"\n",(0,a.jsx)(n.p,{children:"Returns a value of type BIGINT."}),"\n",(0,a.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- setup\ncreate table t1(\n        k1 int,\n        k_string varchar(100),\n        k_tinyint tinyint\n) distributed by hash (k1) buckets 1\nproperties (\"replication_num\"=\"1\");\ninsert into t1 values \n    (1, 'apple', 10),\n    (1, 'banana', 20),\n    (1, 'apple', 10),\n    (2, 'orange', 30),\n    (2, 'orange', 40),\n    (2, 'grape', 50),\n    (3, null, null);\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"select approx_count_distinct(k_string) from t1;\n"})}),"\n",(0,a.jsx)(n.p,{children:"String type: Calculate the approximate distinct count of all k_string values, NULL values are not included in the calculation."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"+---------------------------------+\n| approx_count_distinct(k_string) |\n+---------------------------------+\n|                               4 |\n+---------------------------------+\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"select approx_count_distinct(k_tinyint) from t1;\n"})}),"\n",(0,a.jsx)(n.p,{children:"TinyInt type: Calculate the approximate distinct count of all k_tinyint values."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"+----------------------------------+\n| approx_count_distinct(k_tinyint) |\n+----------------------------------+\n|                                5 |\n+----------------------------------+\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"select approx_count_distinct(k1) from t1;\n"})}),"\n",(0,a.jsx)(n.p,{children:"Integer type: Calculate the approximate distinct count of all k1 values."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"+---------------------------+\n| approx_count_distinct(k1) |\n+---------------------------+\n|                         3 |\n+---------------------------+\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"select k1, approx_count_distinct(k_string) from t1 group by k1;\n"})}),"\n",(0,a.jsx)(n.p,{children:"Group by k1 and calculate the approximate distinct count of k_string in each group. When all records in the group are NULL, returns 0."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"+------+---------------------------------+\n| k1   | approx_count_distinct(k_string) |\n+------+---------------------------------+\n|    1 |                               2 |\n|    2 |                               2 |\n|    3 |                               0 |\n+------+---------------------------------+\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"select ndv(k_string) from t1;\n"})}),"\n",(0,a.jsx)(n.p,{children:"Using alias NDV has the same effect as APPROX_COUNT_DISTINCT."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"+---------------+\n| ndv(k_string) |\n+---------------+\n|             4 |\n+---------------+\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"select approx_count_distinct(k_string) from t1 where k1 = 999;\n"})}),"\n",(0,a.jsx)(n.p,{children:"When the query result is empty, returns 0."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"+---------------------------------+\n| approx_count_distinct(k_string) |\n+---------------------------------+\n|                               0 |\n+---------------------------------+\n"})})]})}function u(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return l},a:function(){return r}});var s=t(667294);let a={},i=s.createContext(a);function r(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);