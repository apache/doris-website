"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["213944"],{402391:function(e,n,r){r.r(n),r.d(n,{default:()=>h,frontMatter:()=>d,metadata:()=>s,assets:()=>o,toc:()=>l,contentTitle:()=>a});var s=JSON.parse('{"id":"ecosystem/spark-doris-connector","title":"Spark Doris Connector","description":"Spark Doris Connector can support reading data stored in Doris and writing data to Doris through Spark.","source":"@site/versioned_docs/version-2.1/ecosystem/spark-doris-connector.md","sourceDirName":"ecosystem","slug":"/ecosystem/spark-doris-connector","permalink":"/docs/2.1/ecosystem/spark-doris-connector","draft":false,"unlisted":false,"tags":[],"version":"2.1","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Spark Doris Connector","language":"en","description":"Spark Doris Connector can support reading data stored in Doris and writing data to Doris through Spark."},"sidebar":"docs","previous":{"title":"Modify BE VLOG","permalink":"/docs/2.1/admin-manual/open-api/be-http/be-vlog"},"next":{"title":"Flink Doris Connector","permalink":"/docs/2.1/ecosystem/flink-doris-connector"}}'),t=r("785893"),i=r("250065");let d={title:"Spark Doris Connector",language:"en",description:"Spark Doris Connector can support reading data stored in Doris and writing data to Doris through Spark."},a="Spark Doris Connector",o={},l=[{value:"Version Compatibility",id:"version-compatibility",level:2},{value:"How To Use",id:"how-to-use",level:2},{value:"Maven",id:"maven",level:3},{value:"Compile",id:"compile",level:3},{value:"Example",id:"example",level:2},{value:"Batch Read",id:"batch-read",level:3},{value:"RDD",id:"rdd",level:4},{value:"DataFrame",id:"dataframe",level:4},{value:"Spark SQL",id:"spark-sql",level:4},{value:"pySpark",id:"pyspark",level:4},{value:"Reading via Arrow Flight SQL",id:"reading-via-arrow-flight-sql",level:4},{value:"Batch Write",id:"batch-write",level:3},{value:"DataFrame",id:"dataframe-1",level:4},{value:"Spark SQL",id:"spark-sql-1",level:4},{value:"Streaming Write",id:"streaming-write",level:3},{value:"DataFrame",id:"dataframe-2",level:4},{value:"Write structured data",id:"write-structured-data",level:5},{value:"Write directly",id:"write-directly",level:5},{value:"Write in JSON format",id:"write-in-json-format",level:4},{value:"Spark Doris Catalog",id:"spark-doris-catalog",level:3},{value:"Catalog Config",id:"catalog-config",level:4},{value:"DataFrame",id:"dataframe-3",level:4},{value:"Spark SQL",id:"spark-sql-2",level:4},{value:"Configuration",id:"configuration",level:2},{value:"General",id:"general",level:3},{value:"SQL &amp; Dataframe Configuration",id:"sql--dataframe-configuration",level:3},{value:"Structured Streaming Configuration",id:"structured-streaming-configuration",level:3},{value:"RDD Configuration",id:"rdd-configuration",level:3},{value:"Data Type Mapping from Doris to Spark",id:"data-type-mapping-from-doris-to-spark",level:2},{value:"Data Type Mapping from Spark to Doris",id:"data-type-mapping-from-spark-to-doris",level:2},{value:"FAQ",id:"faq",level:2}];function c(e){let n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"spark-doris-connector",children:"Spark Doris Connector"})}),"\n",(0,t.jsx)(n.p,{children:"Spark Doris Connector can support reading data stored in Doris and writing data to Doris through Spark."}),"\n",(0,t.jsxs)(n.p,{children:["Github: ",(0,t.jsx)(n.a,{href:"https://github.com/apache/doris-spark-connector",children:"https://github.com/apache/doris-spark-connector"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Support reading data in batch mode from ",(0,t.jsx)(n.code,{children:"Doris"})," through ",(0,t.jsx)(n.code,{children:"RDD"}),", ",(0,t.jsx)(n.code,{children:"DataFrame"})," and ",(0,t.jsx)(n.code,{children:"Spark SQL"}),". It is recommended to use ",(0,t.jsx)(n.code,{children:"DataFrame"})," or ",(0,t.jsx)(n.code,{children:"Spark SQL"})]}),"\n",(0,t.jsxs)(n.li,{children:["Support writing data to ",(0,t.jsx)(n.code,{children:"Doris"})," in batch or streaming mode with DataFrame API and Spark SQL."]}),"\n",(0,t.jsxs)(n.li,{children:["You can map the ",(0,t.jsx)(n.code,{children:"Doris"})," table to",(0,t.jsx)(n.code,{children:" DataFrame"})," or ",(0,t.jsx)(n.code,{children:"RDD"}),", it is recommended to use",(0,t.jsx)(n.code,{children:" DataFrame"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Support the completion of data filtering on the ",(0,t.jsx)(n.code,{children:"Doris"})," side to reduce the amount of data transmission."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"version-compatibility",children:"Version Compatibility"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Connector"}),(0,t.jsx)(n.th,{children:"Spark"}),(0,t.jsx)(n.th,{children:"Doris"}),(0,t.jsx)(n.th,{children:"Java"}),(0,t.jsx)(n.th,{children:"Scala"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"25.2.0"}),(0,t.jsx)(n.td,{children:"3.5 - 3.1, 2.4"}),(0,t.jsx)(n.td,{children:"1.0 +"}),(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"2.12, 2.11"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"25.1.0"}),(0,t.jsx)(n.td,{children:"3.5 - 3.1, 2.4"}),(0,t.jsx)(n.td,{children:"1.0 +"}),(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"2.12, 2.11"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"25.0.1"}),(0,t.jsx)(n.td,{children:"3.5 - 3.1, 2.4"}),(0,t.jsx)(n.td,{children:"1.0 +"}),(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"2.12, 2.11"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"25.0.0"}),(0,t.jsx)(n.td,{children:"3.5 - 3.1, 2.4"}),(0,t.jsx)(n.td,{children:"1.0 +"}),(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"2.12, 2.11"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"24.0.0"}),(0,t.jsx)(n.td,{children:"3.5 ~ 3.1, 2.4"}),(0,t.jsx)(n.td,{children:"1.0 +"}),(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"2.12, 2.11"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1.3.2"}),(0,t.jsx)(n.td,{children:"3.4 ~ 3.1, 2.4, 2.3"}),(0,t.jsx)(n.td,{children:"1.0 ~ 2.1.6"}),(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"2.12, 2.11"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1.3.1"}),(0,t.jsx)(n.td,{children:"3.4 ~ 3.1, 2.4, 2.3"}),(0,t.jsx)(n.td,{children:"1.0 ~ 2.1.0"}),(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"2.12, 2.11"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1.3.0"}),(0,t.jsx)(n.td,{children:"3.4 ~ 3.1, 2.4, 2.3"}),(0,t.jsx)(n.td,{children:"1.0 ~ 2.1.0"}),(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"2.12, 2.11"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1.2.0"}),(0,t.jsx)(n.td,{children:"3.2, 3.1, 2.3"}),(0,t.jsx)(n.td,{children:"1.0 ~ 2.0.2"}),(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"2.12, 2.11"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1.1.0"}),(0,t.jsx)(n.td,{children:"3.2, 3.1, 2.3"}),(0,t.jsx)(n.td,{children:"1.0 ~ 1.2.8"}),(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"2.12, 2.11"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1.0.1"}),(0,t.jsx)(n.td,{children:"3.1, 2.3"}),(0,t.jsx)(n.td,{children:"0.12 - 0.15"}),(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"2.12, 2.11"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"how-to-use",children:"How To Use"}),"\n",(0,t.jsx)(n.h3,{id:"maven",children:"Maven"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"<dependency>\n    <groupId>org.apache.doris</groupId>\n    <artifactId>spark-doris-connector-spark-3.5</artifactId>\n    <version>25.2.0</version>\n</dependency>\n"})}),"\n",(0,t.jsx)(n.p,{children:"::: tip"}),"\n",(0,t.jsx)(n.p,{children:"Starting from version 24.0.0, the naming rules of the Doris connector package have been adjusted:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"No longer contains Scala version information."}),"\n",(0,t.jsxs)(n.li,{children:["For Spark 2.x versions, use the package named ",(0,t.jsx)(n.code,{children:"spark-doris-connector-spark-2"})," uniformly, and by default only compile based on Scala 2.11 version. If you need Scala 2.12 version, please compile it yourself."]}),"\n",(0,t.jsxs)(n.li,{children:["For Spark 3.x versions, use the package named ",(0,t.jsx)(n.code,{children:"spark-doris-connector-spark-3.x"})," according to the specific Spark version. Applications based on Spark 3.0 version can use the package ",(0,t.jsx)(n.code,{children:"spark-doris-connector-spark-3.1"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:":::"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Note"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Please replace the corresponding Connector version according to different Spark and Scala versions."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["You can also download the relevant version jar package from ",(0,t.jsx)(n.a,{href:"https://repo.maven.apache.org/maven2/org/apache/doris/",children:"here"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"compile",children:"Compile"}),"\n",(0,t.jsxs)(n.p,{children:["When compiling, you can directly run ",(0,t.jsx)(n.code,{children:"sh build.sh"}),", for details, please refer to here."]}),"\n",(0,t.jsxs)(n.p,{children:["After successful compilation, the target jar package will be generated in the ",(0,t.jsx)(n.code,{children:"dist"})," directory, such as: spark-doris-connector-spark-3.5-25.2.0.jar. Copy this file to the ",(0,t.jsx)(n.code,{children:"ClassPath"})," of ",(0,t.jsx)(n.code,{children:"Spark"})," to use ",(0,t.jsx)(n.code,{children:"Spark-Doris-Connector"}),". For example, for ",(0,t.jsx)(n.code,{children:"Spark"})," running in ",(0,t.jsx)(n.code,{children:"Local"})," mode, put this file in the ",(0,t.jsx)(n.code,{children:"jars/"})," folder. For ",(0,t.jsx)(n.code,{children:"Spark"})," running in ",(0,t.jsx)(n.code,{children:"Yarn"})," cluster mode, put this file in the pre-deployment package.\nYou can also"]}),"\n",(0,t.jsx)(n.p,{children:"Execute in the source code directory:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"sh build.sh"})}),"\n",(0,t.jsx)(n.p,{children:"Enter the Scala and Spark versions you need to compile according to the prompts."}),"\n",(0,t.jsxs)(n.p,{children:["After successful compilation, the target jar package will be generated in the ",(0,t.jsx)(n.code,{children:"dist"})," directory, such as: ",(0,t.jsx)(n.code,{children:"spark-doris-connector-spark-3.5-25.2.0.jar"}),".\nCopy this file to the ",(0,t.jsx)(n.code,{children:"ClassPath"})," of ",(0,t.jsx)(n.code,{children:"Spark"})," to use ",(0,t.jsx)(n.code,{children:"Spark-Doris-Connector"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["For example, if ",(0,t.jsx)(n.code,{children:"Spark"})," is running in ",(0,t.jsx)(n.code,{children:"Local"})," mode, put this file in the ",(0,t.jsx)(n.code,{children:"jars/"})," folder. If ",(0,t.jsx)(n.code,{children:"Spark"})," is running in ",(0,t.jsx)(n.code,{children:"Yarn"})," cluster mode, put this file in the pre-deployment package."]}),"\n",(0,t.jsxs)(n.p,{children:["For example, upload ",(0,t.jsx)(n.code,{children:"spark-doris-connector-spark-3.5-25.2.0.jar"})," to hdfs and add the Jar package path on hdfs to the ",(0,t.jsx)(n.code,{children:"spark.yarn.jars"})," parameter"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"\n1. Upload `spark-doris-connector-spark-3.5-25.2.0.jar` to hdfs.\n\nhdfs dfs -mkdir /spark-jars/\nhdfs dfs -put /your_local_path/spark-doris-connector-spark-3.5-25.2.0.jar /spark-jars/\n\n2. Add the `spark-doris-connector-spark-3.5-25.2.0.jar` dependency in the cluster.\nspark.yarn.jars=hdfs:///spark-jars/spark-doris-connector-spark-3.5-25.2.0.jar\n\n"})}),"\n",(0,t.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,t.jsx)(n.h3,{id:"batch-read",children:"Batch Read"}),"\n",(0,t.jsx)(n.h4,{id:"rdd",children:"RDD"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'import org.apache.doris.spark._\n\nval dorisSparkRDD = sc.dorisRDD(\n  tableIdentifier = Some("$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME"),\n  cfg = Some(Map(\n    "doris.fenodes" -> "$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT",\n    "doris.request.auth.user" -> "$YOUR_DORIS_USERNAME",\n    "doris.request.auth.password" -> "$YOUR_DORIS_PASSWORD"\n  ))\n)\n\ndorisSparkRDD.collect()\n'})}),"\n",(0,t.jsx)(n.h4,{id:"dataframe",children:"DataFrame"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'val dorisSparkDF = spark.read.format("doris")\n  .option("doris.table.identifier", "$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME")\n  .option("doris.fenodes", "$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT")\n  .option("user", "$YOUR_DORIS_USERNAME")\n  .option("password", "$YOUR_DORIS_PASSWORD")\n  .load()\n\ndorisSparkDF.show(5)\n'})}),"\n",(0,t.jsx)(n.h4,{id:"spark-sql",children:"Spark SQL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sparksql",children:'CREATE TEMPORARY VIEW spark_doris\nUSING doris\nOPTIONS(\n  "table.identifier"="$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME",\n  "fenodes"="$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT",\n  "user"="$YOUR_DORIS_USERNAME",\n  "password"="$YOUR_DORIS_PASSWORD"\n);\n\nSELECT * FROM spark_doris;\n'})}),"\n",(0,t.jsx)(n.h4,{id:"pyspark",children:"pySpark"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'dorisSparkDF = spark.read.format("doris")\n  .option("doris.table.identifier", "$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME")\n  .option("doris.fenodes", "$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT")\n  .option("user", "$YOUR_DORIS_USERNAME")\n  .option("password", "$YOUR_DORIS_PASSWORD")\n  .load()\n// show 5 lines data \ndorisSparkDF.show(5)\n'})}),"\n",(0,t.jsx)(n.h4,{id:"reading-via-arrow-flight-sql",children:"Reading via Arrow Flight SQL"}),"\n",(0,t.jsx)(n.p,{children:"Starting from version 24.0.0, data can be read via Arrow Flight SQL (Doris version >= 2.1.0 is required)."}),"\n",(0,t.jsxs)(n.p,{children:["Set ",(0,t.jsx)(n.code,{children:"doris.read.mode"})," to arrow, set ",(0,t.jsx)(n.code,{children:"doris.read.arrow-flight-sql.port"})," to the Arrow Flight SQL port configured by FE."]}),"\n",(0,t.jsxs)(n.p,{children:["For server configuration, refer to ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/zh-CN/docs/dev/db-connect/arrow-flight-sql-connect",children:"High-speed data transmission link based on Arrow Flight SQL"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'val df = spark.read.format("doris")\n        .option("doris.table.identifier", "$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME")\n        .option("doris.fenodes", "$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT")\n        .option("doris.user", "$YOUR_DORIS_USERNAME")\n        .option("doris.password", "$YOUR_DORIS_PASSWORD")\n        .option("doris.read.mode", "arrow")\n        .option("doris.read.arrow-flight-sql.port", "12345")\n        .load()\n\ndf.show()\n'})}),"\n",(0,t.jsx)(n.h3,{id:"batch-write",children:"Batch Write"}),"\n",(0,t.jsx)(n.h4,{id:"dataframe-1",children:"DataFrame"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'val mockDataDF = List(\n  (3, "440403001005", "21.cn"),\n  (1, "4404030013005", "22.cn"),\n  (33, null, "23.cn")\n).toDF("id", "mi_code", "mi_name")\nmockDataDF.show(5)\n\nmockDataDF.write.format("doris")\n  .option("doris.table.identifier", "$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME")\n  .option("doris.fenodes", "$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT")\n  .option("user", "$YOUR_DORIS_USERNAME")\n  .option("password", "$YOUR_DORIS_PASSWORD")\n  //other options\n  //specify the fields to write\n  .option("doris.write.fields", "$YOUR_FIELDS_TO_WRITE")\n  // Support setting Overwrite mode to overwrite data\n  // .mode(SaveMode.Overwrite)\n  .save()\n'})}),"\n",(0,t.jsx)(n.h4,{id:"spark-sql-1",children:"Spark SQL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sparksql",children:'CREATE TEMPORARY VIEW spark_doris\nUSING doris\nOPTIONS(\n  "table.identifier"="$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME",\n  "fenodes"="$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT",\n  "user"="$YOUR_DORIS_USERNAME",\n  "password"="$YOUR_DORIS_PASSWORD"\n);\n\nINSERT INTO spark_doris VALUES ("VALUE1", "VALUE2", ...);\n-- insert into select\nINSERT INTO spark_doris SELECT * FROM YOUR_TABLE;\n-- insert overwrite\nINSERT OVERWRITE SELECT * FROM YOUR_TABLE; \n'})}),"\n",(0,t.jsx)(n.h3,{id:"streaming-write",children:"Streaming Write"}),"\n",(0,t.jsx)(n.h4,{id:"dataframe-2",children:"DataFrame"}),"\n",(0,t.jsx)(n.h5,{id:"write-structured-data",children:"Write structured data"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'val df = spark.readStream.format("your_own_stream_source").load()\n\ndf.writeStream\n      .format("doris")\n      .option("checkpointLocation", "$YOUR_CHECKPOINT_LOCATION")\n      .option("doris.table.identifier", "$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME")\n      .option("doris.fenodes", "$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT")\n      .option("user", "$YOUR_DORIS_USERNAME")\n      .option("password", "$YOUR_DORIS_PASSWORD")\n      .start()\n      .awaitTermination()\n'})}),"\n",(0,t.jsx)(n.h5,{id:"write-directly",children:"Write directly"}),"\n",(0,t.jsxs)(n.p,{children:["If the first column of data in the data stream is formatted data that conforms to the ",(0,t.jsx)(n.code,{children:"Doris"})," table structure, such as CSV format data with the same column order, or JSON format data with the same field name, it can be written directly to ",(0,t.jsx)(n.code,{children:"Doris"})," by setting the ",(0,t.jsx)(n.code,{children:"doris.sink.streaming.passthrough"})," option to ",(0,t.jsx)(n.code,{children:"true"})," without converting to ",(0,t.jsx)(n.code,{children:"DataFrame"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Taking kafka as an example."}),"\n",(0,t.jsx)(n.p,{children:"And assuming the table structure to be written is:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE `t2` (\n`c0` int NULL,\n`c1` varchar(10) NULL,\n`c2` date NULL\n) ENGINE=OLAP\nDUPLICATE KEY(`c0`)\nCOMMENT \'OLAP\'\nDISTRIBUTED BY HASH(`c0`) BUCKETS 1\nPROPERTIES (\n"replication_allocation" = "tag.location.default: 1"\n);\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The value of the message is ",(0,t.jsx)(n.code,{children:'{"c0":1,"c1":"a","dt":"2024-01-01"}'})," in json format."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'val kafkaSource = spark.readStream\n  .format("kafka")\n  .option("kafka.bootstrap.servers", "$YOUR_KAFKA_SERVERS")\n  .option("startingOffsets", "latest")\n  .option("subscribe", "$YOUR_KAFKA_TOPICS")\n  .load()\n\n// Select the value of the message as the first column of the DataFrame.\nkafkaSource.selectExpr("CAST(value as STRING)")\n  .writeStream\n  .format("doris")\n  .option("checkpointLocation", "$YOUR_CHECKPOINT_LOCATION")\n  .option("doris.table.identifier", "$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME")\n  .option("doris.fenodes", "$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT")\n  .option("user", "$YOUR_DORIS_USERNAME")\n  .option("password", "$YOUR_DORIS_PASSWORD")\n  // Set this option to true, and the first column will be written directly without processing.\n  .option("doris.sink.streaming.passthrough", "true")\n  .option("doris.sink.properties.format", "json")\n  .start()\n  .awaitTermination()\n'})}),"\n",(0,t.jsx)(n.h4,{id:"write-in-json-format",children:"Write in JSON format"}),"\n",(0,t.jsxs)(n.p,{children:["Set ",(0,t.jsx)(n.code,{children:"doris.sink.properties.format"})," to json"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'val df = spark.readStream.format("your_own_stream_source").load() \ndf.write.format("doris")\n        .option("doris.fenodes", "$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT")\n        .option("doris.table.identifier", "$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME") \n        .option("user", "$YOUR_DORIS_USERNAME") \n        .option("password", "$YOUR_DORIS_PASSWORD") \n        .option("doris.sink.properties.format", "json")\n        .save()\n'})}),"\n",(0,t.jsx)(n.h3,{id:"spark-doris-catalog",children:"Spark Doris Catalog"}),"\n",(0,t.jsx)(n.p,{children:"Since version 24.0.0, support accessing doris through Spark Catalog."}),"\n",(0,t.jsx)(n.h4,{id:"catalog-config",children:"Catalog Config"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Required"}),(0,t.jsx)(n.th,{children:"Comment"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"spark.sql.catalog.your_catalog_name"}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsxs)(n.td,{children:["Set class name of catalog provider, the only valid value for Doris is ",(0,t.jsx)(n.code,{children:"org.apache.doris.spark.catalog.DorisTableCatalog"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"spark.sql.catalog.your_catalog_name.doris.fenodes"}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsx)(n.td,{children:"Set Doris FE node in the format fe_ip:fe_http_port"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"spark.sql.catalog.your_catalog_name.doris.query.port"}),(0,t.jsx)(n.td,{children:"false"}),(0,t.jsxs)(n.td,{children:["Set Doris FE query port, this option is unnecessary if ",(0,t.jsx)(n.code,{children:"spark.sql.catalog.your_catalog_name.doris.fe.auto.fetch"})," is set to true"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"spark.sql.catalog.your_catalog_name.doris.user"}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsx)(n.td,{children:"Set Doris user"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"spark.sql.catalog.your_catalog_name.doris.password"}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsx)(n.td,{children:"Set Doris password"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"spark.sql.defaultCatalog"}),(0,t.jsx)(n.td,{children:"false"}),(0,t.jsx)(n.td,{children:"Set Spark SQL default catalog"})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["All connector parameters that apply to DataFrame and Spark SQL can be set for catalog.",(0,t.jsx)(n.br,{}),"\nFor example, if you want to write data in json format, you can set the option ",(0,t.jsx)(n.code,{children:"spark.sql.catalog.your_catalog_name.doris.sink.properties.format"})," to ",(0,t.jsx)(n.code,{children:"json"}),"."]})}),"\n",(0,t.jsx)(n.h4,{id:"dataframe-3",children:"DataFrame"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'val conf = new SparkConf()\nconf.set("spark.sql.catalog.your_catalog_name", "org.apache.doris.spark.catalog.DorisTableCatalog")\nconf.set("spark.sql.catalog.your_catalog_name.doris.fenodes", "192.168.0.1:8030")\nconf.set("spark.sql.catalog.your_catalog_name.doris.query.port", "9030")\nconf.set("spark.sql.catalog.your_catalog_name.doris.user", "root")\nconf.set("spark.sql.catalog.your_catalog_name.doris.password", "")\nval spark = builder.config(conf).getOrCreate()\nspark.sessionState.catalogManager.setCurrentCatalog("your_catalog_name")\n\n// show all databases\nspark.sql("show databases")\n\n// use databases\nspark.sql("use your_doris_db")\n\n// show tables in test\nspark.sql("show tables")\n\n// query table\nspark.sql("select * from your_doris_table")\n\n// write data\nspark.sql("insert into your_doris_table values(xxx)")\n'})}),"\n",(0,t.jsx)(n.h4,{id:"spark-sql-2",children:"Spark SQL"}),"\n",(0,t.jsx)(n.p,{children:"Start Spark SQL CLI with necessary config."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'spark-sql \\\n--conf "spark.sql.catalog.your_catalog_name=org.apache.doris.spark.catalog.DorisTableCatalog" \\\n--conf "spark.sql.catalog.your_catalog_name.doris.fenodes=192.168.0.1:8030" \\\n--conf "spark.sql.catalog.your_catalog_name.doris.query.port=9030" \\\n--conf "spark.sql.catalog.your_catalog_name.doris.user=root" \\\n--conf "spark.sql.catalog.your_catalog_name.doris.password=" \\\n--conf "spark.sql.defaultCatalog=your_catalog_name"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Execute query in Spark SQL CLI."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sparksql",children:"-- show all databases\nshow databases;\n\n-- use databases\nuse your_doris_db;\n\n-- show tables in test\nshow tables;\n\n-- query table\nselect * from your_doris_table;\n\n-- write data\ninsert into your_doris_table values(xxx);\ninsert into your_doris_table select * from your_source_table;\n\n-- access table with full name\nselect * from your_catalog_name.your_doris_db.your_doris_table;\ninsert into your_catalog_name.your_doris_db.your_doris_table values(xxx);\ninsert into your_catalog_name.your_doris_db.your_doris_table select * from your_source_table;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"general",children:"General"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Default Value"}),(0,t.jsx)(n.th,{children:"Comment"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.fenodes"}),(0,t.jsx)(n.td,{children:"--"}),(0,t.jsx)(n.td,{children:"Doris FE http address, support multiple addresses, separated by commas"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.table.identifier"}),(0,t.jsx)(n.td,{children:"--"}),(0,t.jsx)(n.td,{children:"Doris table identifier, eg, db1.tbl1"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.user"}),(0,t.jsx)(n.td,{children:"--"}),(0,t.jsx)(n.td,{children:"Doris username"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.password"}),(0,t.jsx)(n.td,{children:"Empty string"}),(0,t.jsx)(n.td,{children:"Doris password"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.request.retries"}),(0,t.jsx)(n.td,{children:"3"}),(0,t.jsx)(n.td,{children:"Number of retries to send requests to Doris"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.request.connect.timeout.ms"}),(0,t.jsx)(n.td,{children:"30000"}),(0,t.jsx)(n.td,{children:"Connection timeout for sending requests to Doris"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.request.read.timeout.ms"}),(0,t.jsx)(n.td,{children:"30000"}),(0,t.jsx)(n.td,{children:"Read timeout for sending request to Doris"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.request.query.timeout.s"}),(0,t.jsx)(n.td,{children:"21600"}),(0,t.jsx)(n.td,{children:"Query the timeout time of doris, the default is 6 hour, -1 means no timeout limit"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.request.tablet.size"}),(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"The number of Doris Tablets corresponding to an RDD Partition. The smaller this value is set, the more partitions will be generated. This will increase the parallelism on the Spark side, but at the same time will cause greater pressure on Doris."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.read.field"}),(0,t.jsx)(n.td,{children:"--"}),(0,t.jsx)(n.td,{children:"List of column names in the Doris table, separated by commas"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.batch.size"}),(0,t.jsx)(n.td,{children:"4064"}),(0,t.jsx)(n.td,{children:"The maximum number of rows to read data from BE at one time. Increasing this value can reduce the number of connections between Spark and Doris. Thereby reducing the extra time overhead caused by network delay."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.exec.mem.limit"}),(0,t.jsx)(n.td,{children:"8589934592"}),(0,t.jsx)(n.td,{children:"Memory limit for a single query. The default is 8GB, in bytes."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.write.fields"}),(0,t.jsx)(n.td,{children:"--"}),(0,t.jsxs)(n.td,{children:["Specifies the fields (or the order of the fields) to write to the Doris table, fileds separated by commas.",(0,t.jsx)(n.br,{}),"By default, all fields are written in the order of Doris table fields."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.batch.size"}),(0,t.jsx)(n.td,{children:"500000"}),(0,t.jsx)(n.td,{children:"Maximum number of lines in a single write BE"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.max-retries"}),(0,t.jsx)(n.td,{children:"0"}),(0,t.jsxs)(n.td,{children:["Number of retries after writing BE, Since version 1.3.0, the default value is 0, which means no retries are performed by default. When this parameter is set greater than 0, batch-level failure retries will be performed, and data of the configured size of ",(0,t.jsx)(n.code,{children:"doris.sink.batch.size"})," will be cached in the Spark Executor memory. The memory allocation may need to be appropriately increased."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.retry.interval.ms"}),(0,t.jsx)(n.td,{children:"10000"}),(0,t.jsx)(n.td,{children:"After configuring the number of retries, the interval between each retry, in ms"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.properties.format"}),(0,t.jsx)(n.td,{children:"--"}),(0,t.jsxs)(n.td,{children:["Data format of the stream load.",(0,t.jsx)(n.br,{}),"Supported formats: csv, json, arrow ",(0,t.jsx)(n.br,{})," ",(0,t.jsx)(n.a,{href:"../data-operate/import/import-way/stream-load-manual",children:"More Multi-parameter details"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.properties.*"}),(0,t.jsx)(n.td,{children:"--"}),(0,t.jsxs)(n.td,{children:["Import parameters for Stream Load. ",(0,t.jsx)(n.br,{}),"For example:",(0,t.jsx)(n.br,{}),"Specify column separator: ",(0,t.jsx)(n.code,{children:"'doris.sink.properties.column_separator' = ','"}),".",(0,t.jsx)(n.br,{}),(0,t.jsx)(n.a,{href:"../data-operate/import/import-way/stream-load-manual",children:"More parameter details"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.task.partition.size"}),(0,t.jsx)(n.td,{children:"--"}),(0,t.jsx)(n.td,{children:"The number of partitions corresponding to the Writing task. After filtering and other operations, the number of partitions written in Spark RDD may be large, but the number of records corresponding to each Partition is relatively small, resulting in increased writing frequency and waste of computing resources. The smaller this value is set, the less Doris write frequency and less Doris merge pressure. It is generally used with doris.sink.task.use.repartition."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.task.use.repartition"}),(0,t.jsx)(n.td,{children:"false"}),(0,t.jsx)(n.td,{children:"Whether to use repartition mode to control the number of partitions written by Doris. The default value is false, and coalesce is used (note: if there is no Spark action before the write, the whole computation will be less parallel). If it is set to true, then repartition is used (note: you can set the final number of partitions at the cost of shuffle)."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.batch.interval.ms"}),(0,t.jsx)(n.td,{children:"0"}),(0,t.jsx)(n.td,{children:"The interval time of each batch sink, unit ms."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.enable-2pc"}),(0,t.jsx)(n.td,{children:"false"}),(0,t.jsx)(n.td,{children:"Whether to enable two-stage commit. When enabled, transactions will be committed at the end of the job, and all pre-commit transactions will be rolled back when some tasks fail."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.auto-redirect"}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsx)(n.td,{children:"Whether to redirect StreamLoad requests. After being turned on, StreamLoad will write through FE and no longer obtain BE information explicitly."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.enable.https"}),(0,t.jsx)(n.td,{children:"false"}),(0,t.jsx)(n.td,{children:"Whether to enable FE Https request."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.https.key-store-path"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"Https key store path."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.https.key-store-type"}),(0,t.jsx)(n.td,{children:"JKS"}),(0,t.jsx)(n.td,{children:"Https key store type."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.https.key-store-password"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"Https key store password."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.read.mode"}),(0,t.jsx)(n.td,{children:"thrift"}),(0,t.jsxs)(n.td,{children:["Doris read mode, with optional ",(0,t.jsx)(n.code,{children:"thrift"})," and ",(0,t.jsx)(n.code,{children:"arrow"}),"."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.read.arrow-flight-sql.port"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsxs)(n.td,{children:["Arrow Flight SQL port of Doris FE. When ",(0,t.jsx)(n.code,{children:"doris.read.mode"})," is ",(0,t.jsx)(n.code,{children:"arrow"}),", it is used to read data via Arrow Flight SQL. For server configuration, see ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/zh-CN/docs/dev/db-connect/arrow-flight-sql-connect",children:"High-speed data transmission link based on Arrow Flight SQL"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.label.prefix"}),(0,t.jsx)(n.td,{children:"spark-doris"}),(0,t.jsx)(n.td,{children:"The import label prefix when writing in Stream Load mode."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.thrift.max.message.size"}),(0,t.jsx)(n.td,{children:"2147483647"}),(0,t.jsx)(n.td,{children:"The maximum size of a message when reading data via Thrift."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.fe.auto.fetch"}),(0,t.jsx)(n.td,{children:"false"}),(0,t.jsxs)(n.td,{children:["Whether to automatically obtain FE information. When set to true, all FE node information will be requested according to the nodes configured by ",(0,t.jsx)(n.code,{children:"doris.fenodes"}),". There is no need to configure multiple nodes and configure ",(0,t.jsx)(n.code,{children:"doris.read.arrow-flight-sql.port"})," and ",(0,t.jsx)(n.code,{children:"doris.query.port"})," separately."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.read.bitmap-to-string"}),(0,t.jsx)(n.td,{children:"false"}),(0,t.jsxs)(n.td,{children:["Whether to convert the Bitmap type to a string composed of array indexes for reading. For the specific result format, see the function definition ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/zh-CN/docs/dev/sql-manual/sql-functions/bitmap-functions/bitmap-to-string",children:"BITMAP_TO_STRING"}),"."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.read.bitmap-to-base64"}),(0,t.jsx)(n.td,{children:"false"}),(0,t.jsxs)(n.td,{children:["Whether to convert the Bitmap type to a Base64-encoded string for reading. For the specific result format, see the function definition ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/zh-CN/docs/dev/sql-manual/sql-functions/bitmap-functions/bitmap-to-base64",children:"BITMAP_TO_BASE64"}),"."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.query.port"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"Doris FE query port, used for overwriting and obtaining metadata of the Catalog."})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"sql--dataframe-configuration",children:"SQL & Dataframe Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Default Value"}),(0,t.jsx)(n.th,{children:"Comment"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.filter.query.in.max.count"}),(0,t.jsx)(n.td,{children:"100"}),(0,t.jsx)(n.td,{children:"In the predicate pushdown, the maximum number of elements in the in expression value list. If this number is exceeded, the in-expression conditional filtering is processed on the Spark side."})]})})]}),"\n",(0,t.jsx)(n.h3,{id:"structured-streaming-configuration",children:"Structured Streaming Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Default Value"}),(0,t.jsx)(n.th,{children:"Comment"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.sink.streaming.passthrough"}),(0,t.jsx)(n.td,{children:"false"}),(0,t.jsx)(n.td,{children:"Write the value of the first column directly without processing."})]})})]}),"\n",(0,t.jsx)(n.h3,{id:"rdd-configuration",children:"RDD Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Default Value"}),(0,t.jsx)(n.th,{children:"Comment"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.request.auth.user"}),(0,t.jsx)(n.td,{children:"--"}),(0,t.jsx)(n.td,{children:"Doris username"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.request.auth.password"}),(0,t.jsx)(n.td,{children:"--"}),(0,t.jsx)(n.td,{children:"Doris password"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"doris.filter.query"}),(0,t.jsx)(n.td,{children:"--"}),(0,t.jsx)(n.td,{children:"Filter expression of the query, which is transparently transmitted to Doris. Doris uses this expression to complete source-side data filtering."})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"data-type-mapping-from-doris-to-spark",children:"Data Type Mapping from Doris to Spark"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Doris Type"}),(0,t.jsx)(n.th,{children:"Spark Type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"NULL_TYPE"}),(0,t.jsx)(n.td,{children:"DataTypes.NullType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"BOOLEAN"}),(0,t.jsx)(n.td,{children:"DataTypes.BooleanType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"TINYINT"}),(0,t.jsx)(n.td,{children:"DataTypes.ByteType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SMALLINT"}),(0,t.jsx)(n.td,{children:"DataTypes.ShortType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"INT"}),(0,t.jsx)(n.td,{children:"DataTypes.IntegerType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"BIGINT"}),(0,t.jsx)(n.td,{children:"DataTypes.LongType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"FLOAT"}),(0,t.jsx)(n.td,{children:"DataTypes.FloatType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DOUBLE"}),(0,t.jsx)(n.td,{children:"DataTypes.DoubleType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DATE"}),(0,t.jsx)(n.td,{children:"DataTypes.DateType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DATETIME"}),(0,t.jsx)(n.td,{children:"DataTypes.TimestampType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DECIMAL"}),(0,t.jsx)(n.td,{children:"DecimalType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CHAR"}),(0,t.jsx)(n.td,{children:"DataTypes.StringType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"LARGEINT"}),(0,t.jsx)(n.td,{children:"DecimalType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"VARCHAR"}),(0,t.jsx)(n.td,{children:"DataTypes.StringType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"STRING"}),(0,t.jsx)(n.td,{children:"DataTypes.StringType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"JSON"}),(0,t.jsx)(n.td,{children:"DataTypes.StringType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"VARIANT"}),(0,t.jsx)(n.td,{children:"DataTypes.StringType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"TIME"}),(0,t.jsx)(n.td,{children:"DataTypes.DoubleType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"HLL"}),(0,t.jsx)(n.td,{children:"DataTypes.StringType"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Bitmap"}),(0,t.jsx)(n.td,{children:"DataTypes.StringType"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"data-type-mapping-from-spark-to-doris",children:"Data Type Mapping from Spark to Doris"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Spark Type"}),(0,t.jsx)(n.th,{children:"Doris Type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"BooleanType"}),(0,t.jsx)(n.td,{children:"BOOLEAN"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"ShortType"}),(0,t.jsx)(n.td,{children:"SMALLINT"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"IntegerType"}),(0,t.jsx)(n.td,{children:"INT"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"LongType"}),(0,t.jsx)(n.td,{children:"BIGINT"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"FloatType"}),(0,t.jsx)(n.td,{children:"FLOAT"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DoubleType"}),(0,t.jsx)(n.td,{children:"DOUBLE"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DecimalType"}),(0,t.jsx)(n.td,{children:"DECIMAL"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"StringType"}),(0,t.jsx)(n.td,{children:"VARCHAR/STRING"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DateType"}),(0,t.jsx)(n.td,{children:"DATE"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"TimestampType"}),(0,t.jsx)(n.td,{children:"DATETIME"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"ArrayType"}),(0,t.jsx)(n.td,{children:"ARRAY"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"MapType"}),(0,t.jsx)(n.td,{children:"MAP/JSON"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"StructType"}),(0,t.jsx)(n.td,{children:"STRUCT/JSON"})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Since version 24.0.0, the return type of the Bitmap type is string type, and the default return value is string value ",(0,t.jsx)(n.code,{children:"Read unsupported"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"How to write Bitmap type"}),"\n",(0,t.jsxs)(n.p,{children:["In Spark SQL, when writing data through insert into, if the target table of doris contains data of type ",(0,t.jsx)(n.code,{children:"BITMAP"})," or ",(0,t.jsx)(n.code,{children:"HLL"}),", you need to set the option ",(0,t.jsx)(n.code,{children:"doris.ignore-type"})," to the corresponding type and map the columns through ",(0,t.jsx)(n.code,{children:"doris.write.fields"}),". The usage is as follows:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"BITMAP"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE TEMPORARY VIEW spark_doris\nUSING doris\nOPTIONS(\n"table.identifier"="$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME",\n"fenodes"="$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT",\n"user"="$YOUR_DORIS_USERNAME",\n"password"="$YOUR_DORIS_PASSWORD"\n"doris.ignore-type"="bitmap",\n"doris.write.fields"="col1,col2,col3,bitmap_col2=to_bitmap(col2),bitmap_col3=bitmap_hash(col3)"\n);\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"HLL"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE TEMPORARY VIEW spark_doris\nUSING doris\nOPTIONS(\n"table.identifier"="$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME",\n"fenodes"="$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT",\n"user"="$YOUR_DORIS_USERNAME",\n"password"="$YOUR_DORIS_PASSWORD"\n"doris.ignore-type"="hll",\n"doris.write.fields"="col1,hll_col1=hll_hash(col1)"\n);\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Since version 24.0.0, ",(0,t.jsx)(n.code,{children:"doris.ignore-type"})," has been deprecated and there is no need to add this parameter when writing."]})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"How to use overwrite to write?"})}),"\n",(0,t.jsx)(n.p,{children:"Since version 1.3.0, overwrite mode writing is supported (only supports data overwriting at the full table level). The specific usage is as follows:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"DataFrame"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'resultDf.format("doris")\n  .option("doris.fenodes","$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT")\n  // your own options\n  .mode(SaveMode.Overwrite)\n  .save()\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"SQL"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sparksql",children:"INSERT OVERWRITE your_target_table SELECT * FROM your_source_table\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"How to read Bitmap type"})}),"\n",(0,t.jsx)(n.p,{children:"Starting from version 24.0.0, it supports reading converted Bitmap data through Arrow Flight SQL (Doris version >= 2.1.0 is required)."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Bitmap to string"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"DataFrame"})," example is as follows, set ",(0,t.jsx)(n.code,{children:"doris.read.bitmap-to-string"})," to true. For the specific result format, see the option definition."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'spark.read.format("doris")\n.option("doris.table.identifier", "$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME")\n.option("doris.fenodes", "$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT")\n.option("user", "$YOUR_DORIS_USERNAME")\n.option("password", "$YOUR_DORIS_PASSWORD")\n.option("doris.read.bitmap-to-string","true")\n.load()\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Bitmap to base64"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"DataFrame"})," example is as follows, set ",(0,t.jsx)(n.code,{children:"doris.read.bitmap-to-base64"})," to true. For the specific result format, see the option definition."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'spark.read.format("doris")\n.option("doris.table.identifier", "$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME")\n.option("doris.fenodes", "$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT")\n.option("user", "$YOUR_DORIS_USERNAME")\n.option("password", "$YOUR_DORIS_PASSWORD")\n.option("doris.read.bitmap-to-base64","true")\n.load()\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["An error occurs when writing in DataFrame mode: ",(0,t.jsx)(n.code,{children:"org.apache.spark.sql.AnalysisException: TableProvider implementation doris cannot be written with ErrorIfExists mode, please use Append or Overwrite modes instead."})]})}),"\n",(0,t.jsx)(n.p,{children:"Need to add save mode to append."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:'resultDf.format("doris")\n  .option("doris.fenodes","$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT") \n  // your own options \n  .mode(SaveMode.Append)\n  .save() \n'})}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return a},a:function(){return d}});var s=r(667294);let t={},i=s.createContext(t);function d(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);