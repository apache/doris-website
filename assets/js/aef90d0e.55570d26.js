"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["450147"],{744446:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>o,metadata:()=>i,assets:()=>d,toc:()=>l,contentTitle:()=>r});var i=JSON.parse('{"id":"data-operate/update/unique-update","title":"Updating Data with UPDATE Command","description":"The main topic is how to use the UPDATE command to update data in Doris. The UPDATE command can only be executed on tables in the Unique data model.","source":"@site/versioned_docs/version-2.0/data-operate/update/unique-update.md","sourceDirName":"data-operate/update","slug":"/data-operate/update/unique-update","permalink":"/docs/2.0/data-operate/update/unique-update","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"Updating Data with UPDATE Command","language":"en"},"sidebar":"docs","previous":{"title":"Updating Overview","permalink":"/docs/2.0/data-operate/update/update-overview"},"next":{"title":"Updating Data on Unique Key Model","permalink":"/docs/2.0/data-operate/update/update-of-unique-model"}}'),a=t("785893"),s=t("250065");let o={title:"Updating Data with UPDATE Command",language:"en"},r=void 0,d={},l=[{value:"Use Cases",id:"use-cases",level:2},{value:"Basic Principles",id:"basic-principles",level:2},{value:"Synchronization",id:"synchronization",level:3},{value:"Performance",id:"performance",level:3},{value:"Example",id:"example",level:2},{value:"More Details",id:"more-details",level:2}];function c(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"The main topic is how to use the UPDATE command to update data in Doris. The UPDATE command can only be executed on tables in the Unique data model."}),"\n",(0,a.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Modify the values of rows that meet certain conditions."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Suitable for updating a small amount of data that is not frequently updated."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"basic-principles",children:"Basic Principles"}),"\n",(0,a.jsx)(n.p,{children:"By utilizing the filtering logic of the query engine's WHERE clause, the UPDATE command selects the rows that need to be updated from the target table. Then, using the built-in logic of the Value column in the Unique model, the old data is replaced with the new data, and the updated rows are reinserted into the table, thus achieving row-level updates."}),"\n",(0,a.jsx)(n.h3,{id:"synchronization",children:"Synchronization"}),"\n",(0,a.jsx)(n.p,{children:"The UPDATE syntax in Doris is synchronous, meaning that when an UPDATE statement is executed successfully, the update operation is completed, and the data is immediately visible."}),"\n",(0,a.jsx)(n.h3,{id:"performance",children:"Performance"}),"\n",(0,a.jsx)(n.p,{children:"The performance of the UPDATE statement depends on the number of rows to be updated and the efficiency of the condition retrieval."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Number of rows to be updated: The more rows that need to be updated, the slower the UPDATE statement will be. The UPDATE command is suitable for scenarios where occasional updates are required, such as modifying values for individual rows. It is not suitable for bulk data modifications."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Efficiency of condition retrieval: The UPDATE operation reads the rows that satisfy the condition first. Therefore, if the condition retrieval is efficient, the UPDATE operation will be faster. It is recommended to have the condition column indexed or utilize partitioning and bucketing pruning to quickly locate the rows to be updated, thus improving the update efficiency. It is strongly advised not to include the value column in the condition column."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,a.jsx)(n.p,{children:"Assuming in a financial risk control scenario, there is a transaction details table with the following structure:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE transaction_details (\n  transaction_id BIGINT NOT NULL,        -- Unique transaction ID\n  user_id BIGINT NOT NULL,               -- User ID\n  transaction_date DATE NOT NULL,        -- Transaction date\n  transaction_time DATETIME NOT NULL,    -- Transaction time\n  transaction_amount DECIMAL(18, 2),     -- Transaction amount\n  transaction_device STRING,             -- Transaction device\n  transaction_region STRING,             -- Transaction region\n  average_daily_amount DECIMAL(18, 2),   -- Average daily transaction amount over the last 3 months\n  recent_transaction_count INT,          -- Number of transactions in the last 7 days\n  has_dispute_history BOOLEAN,           -- Whether there is a dispute history\n  risk_level STRING                      -- Risk level\n)\nUNIQUE KEY(transaction_id)\nDISTRIBUTED BY HASH(transaction_id) BUCKETS 16\nPROPERTIES (\n  "replication_num" = "3",               -- Number of replicas, default is 3\n  "enable_unique_key_merge_on_write" = "true"  -- Enable MOW mode, support merge update\n);\n'})}),"\n",(0,a.jsx)(n.p,{children:"The following transaction data exists:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"+----------------+---------+------------------+---------------------+--------------------+--------------------+--------------------+----------------------+--------------------------+---------------------+------------+\n| transaction_id | user_id | transaction_date | transaction_time    | transaction_amount | transaction_device | transaction_region | average_daily_amount | recent_transaction_count | has_dispute_history | risk_level |\n+----------------+---------+------------------+---------------------+--------------------+--------------------+--------------------+----------------------+--------------------------+---------------------+------------+\n|           1001 |    5001 | 2024-11-24       | 2024-11-24 14:30:00 |             100.00 | iPhone 12          | New York           |               100.00 |                       10 |                   0 | NULL       |\n|           1002 |    5002 | 2024-11-24       | 2024-11-24 03:30:00 |             120.00 | iPhone 12          | New York           |               100.00 |                       15 |                   0 | NULL       |\n|           1003 |    5003 | 2024-11-24       | 2024-11-24 10:00:00 |             150.00 | Samsung S21        | Los Angeles        |               100.00 |                       30 |                   0 | NULL       |\n|           1004 |    5004 | 2024-11-24       | 2024-11-24 16:00:00 |             300.00 | MacBook Pro        | high_risk_region1  |               200.00 |                        5 |                   0 | NULL       |\n|           1005 |    5005 | 2024-11-24       | 2024-11-24 11:00:00 |            1100.00 | iPad Pro           | Chicago            |               200.00 |                       10 |                   0 | NULL       |\n+----------------+---------+------------------+---------------------+--------------------+--------------------+--------------------+----------------------+--------------------------+---------------------+------------+\n"})}),"\n",(0,a.jsx)(n.p,{children:"Update the risk level of all transactions on a daily basis according to the following risk control rules:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"If there is a dispute history, the risk is high."}),"\n",(0,a.jsx)(n.li,{children:"If in a high-risk region, the risk is high."}),"\n",(0,a.jsx)(n.li,{children:"If the transaction amount is abnormal (more than 5 times the daily average), the risk is high."}),"\n",(0,a.jsx)(n.li,{children:"Frequent transactions in the last 7 days:\na. If the number of transactions > 50, the risk is high.\nb. If the number of transactions is between 20 and 50, the risk is medium."}),"\n",(0,a.jsx)(n.li,{children:"Transactions during non-working hours (2 AM to 4 AM), the risk is medium."}),"\n",(0,a.jsx)(n.li,{children:"The default risk is low."}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"UPDATE transaction_details\nSET risk_level = CASE\n  -- Transactions with dispute history or in high-risk regions\n  WHEN has_dispute_history = TRUE THEN 'high'\n  WHEN transaction_region IN ('high_risk_region1', 'high_risk_region2') THEN 'high'\n\n  -- Abnormal transaction amount\n  WHEN transaction_amount > 5 * average_daily_amount THEN 'high'\n\n  -- High transaction frequency in the last 7 days\n  WHEN recent_transaction_count > 50 THEN 'high'\n  WHEN recent_transaction_count BETWEEN 20 AND 50 THEN 'medium'\n\n  -- Transactions during non-working hours\n  WHEN HOUR(transaction_time) BETWEEN 2 AND 4 THEN 'medium'\n\n  -- Default risk\n  ELSE 'low'\nEND\nWHERE transaction_date = '2024-11-24';\n"})}),"\n",(0,a.jsx)(n.p,{children:"The updated data is:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"+----------------+---------+------------------+---------------------+--------------------+--------------------+--------------------+----------------------+--------------------------+---------------------+------------+\n| transaction_id | user_id | transaction_date | transaction_time    | transaction_amount | transaction_device | transaction_region | average_daily_amount | recent_transaction_count | has_dispute_history | risk_level |\n+----------------+---------+------------------+---------------------+--------------------+--------------------+--------------------+----------------------+--------------------------+---------------------+------------+\n|           1001 |    5001 | 2024-11-24       | 2024-11-24 14:30:00 |             100.00 | iPhone 12          | New York           |               100.00 |                       10 |                   0 | low        |\n|           1002 |    5002 | 2024-11-24       | 2024-11-24 03:30:00 |             120.00 | iPhone 12          | New York           |               100.00 |                       15 |                   0 | medium     |\n|           1003 |    5003 | 2024-11-24       | 2024-11-24 10:00:00 |             150.00 | Samsung S21        | Los Angeles        |               100.00 |                       30 |                   0 | medium     |\n|           1004 |    5004 | 2024-11-24       | 2024-11-24 16:00:00 |             300.00 | MacBook Pro        | high_risk_region1  |               200.00 |                        5 |                   0 | high       |\n|           1005 |    5005 | 2024-11-24       | 2024-11-24 11:00:00 |            1100.00 | iPad Pro           | Chicago            |               200.00 |                       10 |                   0 | high       |\n+----------------+---------+------------------+---------------------+--------------------+--------------------+--------------------+----------------------+--------------------------+---------------------+------------+\n"})}),"\n",(0,a.jsx)(n.h2,{id:"more-details",children:"More Details"}),"\n",(0,a.jsxs)(n.p,{children:["For more detailed syntax on data updates, please refer to the ",(0,a.jsx)(n.a,{href:"../../sql-manual/sql-reference/Data-Manipulation-Statements/Manipulation/UPDATE",children:"UPDATE"})," command manual. You can also enter ",(0,a.jsx)(n.code,{children:"HELP UPDATE"})," in the MySQL client command line for more information and assistance."]})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return r},a:function(){return o}});var i=t(667294);let a={},s=i.createContext(a);function o(e){let n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);