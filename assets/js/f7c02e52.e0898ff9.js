"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["154149"],{247510:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>d,metadata:()=>t,assets:()=>c,toc:()=>a,contentTitle:()=>l});var t=JSON.parse('{"id":"data-operate/import/group-commit-manual","title":"High Concurrency LOAD Optimization(Group Commit)","description":"In high-frequency small batch write scenarios, traditional loading methods have the following issues:","source":"@site/versioned_docs/version-3.x/data-operate/import/group-commit-manual.md","sourceDirName":"data-operate/import","slug":"/data-operate/import/group-commit-manual","permalink":"/docs/3.x/data-operate/import/group-commit-manual","draft":false,"unlisted":false,"tags":[],"version":"3.x","lastUpdatedAt":1770477659000,"frontMatter":{"title":"High Concurrency LOAD Optimization(Group Commit)","language":"en","description":"In high-frequency small batch write scenarios, traditional loading methods have the following issues:"},"sidebar":"docs","previous":{"title":"Load High Availability","permalink":"/docs/3.x/data-operate/import/load-high-availability"},"next":{"title":"Load Best Practices","permalink":"/docs/3.x/data-operate/import/load-best-practices"}}'),i=s("785893"),r=s("250065");let d={title:"High Concurrency LOAD Optimization(Group Commit)",language:"en",description:"In high-frequency small batch write scenarios, traditional loading methods have the following issues:"},l=void 0,c={},a=[{value:"Group Commit Modes",id:"group-commit-modes",level:2},{value:"How to Use Group Commit",id:"how-to-use-group-commit",level:2},{value:"Using JDBC",id:"using-jdbc",level:3},{value:"Using Golang for Group Commit",id:"using-golang-for-group-commit",level:3},{value:"INSERT INTO VALUES",id:"insert-into-values",level:3},{value:"Stream Load",id:"stream-load",level:3},{value:"Modifying Commit Interval",id:"modifying-commit-interval",level:3},{value:"Modifying Commit Data Volume",id:"modifying-commit-data-volume",level:3},{value:"BE Configuration",id:"be-configuration",level:3},{value:"Usage Limitations",id:"usage-limitations",level:2},{value:"Performance",id:"performance",level:2},{value:"Stream Load",id:"stream-load-1",level:3},{value:"Environment",id:"environment",level:4},{value:"DataSet",id:"dataset",level:4},{value:"Test Tool",id:"test-tool",level:4},{value:"Test Method",id:"test-method",level:4},{value:"Test Results",id:"test-results",level:4},{value:"JDBC",id:"jdbc",level:3},{value:"Environment",id:"environment-1",level:4},{value:"DataSet",id:"dataset-1",level:4},{value:"Test Method",id:"test-method-1",level:4},{value:"Test Method",id:"test-method-2",level:4},{value:"Test Results",id:"test-results-1",level:4},{value:"Insert into Sync Mode Small Batch Data",id:"insert-into-sync-mode-small-batch-data",level:3},{value:"Insert into Sync Mode Large Batch Data",id:"insert-into-sync-mode-large-batch-data",level:3}];function o(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"In high-frequency small batch write scenarios, traditional loading methods have the following issues:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Each load creates an independent transaction, requiring FE to parse SQL and generate execution plans, affecting overall performance"}),"\n",(0,i.jsx)(n.li,{children:"Each load generates a new version, causing rapid version growth and increasing background compaction pressure"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"To solve these problems, Doris introduced the Group Commit mechanism. Group Commit is not a new loading method, but rather an optimization extension of existing loading methods, mainly targeting:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"INSERT INTO tbl VALUES(...)"})," statements"]}),"\n",(0,i.jsx)(n.li,{children:"Stream Load"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"By merging multiple small batch loads into one large transaction commit in the background, it significantly improves high-concurrency small batch write performance. Additionally, using Group Commit with PreparedStatement can achieve even higher performance improvements."}),"\n",(0,i.jsx)(n.h2,{id:"group-commit-modes",children:"Group Commit Modes"}),"\n",(0,i.jsx)(n.p,{children:"Group Commit has three modes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Off Mode (",(0,i.jsx)(n.code,{children:"off_mode"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"Group Commit is disabled."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Synchronous Mode (",(0,i.jsx)(n.code,{children:"sync_mode"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Doris commits multiple loads in one transaction based on load and table's ",(0,i.jsx)(n.code,{children:"group_commit_interval"})," property, returning after transaction commit. This is suitable for high-concurrency write scenarios requiring immediate data visibility after loading."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Asynchronous Mode (",(0,i.jsx)(n.code,{children:"async_mode"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Doris first writes data to WAL (Write Ahead Log), then returns immediately. Doris asynchronously commits data based on load and table's ",(0,i.jsx)(n.code,{children:"group_commit_interval"})," property, making data visible after commit. To prevent WAL from occupying too much disk space, it automatically switches to ",(0,i.jsx)(n.code,{children:"sync_mode"})," for large single loads. This is suitable for write latency-sensitive and high-frequency write scenarios."]}),"\n",(0,i.jsxs)(n.p,{children:["WAL count can be viewed through FE http interface as shown ",(0,i.jsx)(n.a,{href:"../../admin-manual/open-api/fe-http/get-wal-size-action",children:"here"}),", or by searching for ",(0,i.jsx)(n.code,{children:"wal"})," keyword in BE metrics."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-to-use-group-commit",children:"How to Use Group Commit"}),"\n",(0,i.jsx)(n.p,{children:"Assuming the table structure is:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE `dt` (\n    `id` int(11) NOT NULL,\n    `name` varchar(50) NULL,\n    `score` int(11) NULL\n) ENGINE=OLAP\nDUPLICATE KEY(`id`)\nDISTRIBUTED BY HASH(`id`) BUCKETS 1\nPROPERTIES (\n    "replication_num" = "1"\n);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"using-jdbc",children:"Using JDBC"}),"\n",(0,i.jsxs)(n.p,{children:["When users write using JDBC's ",(0,i.jsx)(n.code,{children:"insert into values"})," method, to reduce SQL parsing and planning overhead, we support MySQL protocol's ",(0,i.jsx)(n.code,{children:"PreparedStatement"})," feature on the FE side. When using ",(0,i.jsx)(n.code,{children:"PreparedStatement"}),", SQL and its load plan are cached in session-level memory cache, and subsequent loads directly use the cached objects, reducing FE CPU pressure. Here's an example of using ",(0,i.jsx)(n.code,{children:"PreparedStatement"})," in JDBC:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. Set JDBC URL and enable Prepared Statement on Server side"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"url = jdbc:mysql://127.0.0.1:9030/db?useServerPrepStmts=true&useLocalSessionState=true&rewriteBatchedStatements=true&cachePrepStmts=true&prepStmtCacheSqlLimit=99999&prepStmtCacheSize=500\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["2. Configure ",(0,i.jsx)(n.code,{children:"group_commit"})," session variable in one of two ways:"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Through JDBC url by adding ",(0,i.jsx)(n.code,{children:"sessionVariables=group_commit=async_mode"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"url = jdbc:mysql://127.0.0.1:9030/db?useServerPrepStmts=true&useLocalSessionState=true&rewriteBatchedStatements=true&cachePrepStmts=true&prepStmtCacheSqlLimit=99999&prepStmtCacheSize=500&sessionVariables=group_commit=async_mode,enable_nereids_planner=false\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Through SQL execution"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'try (Statement statement = conn.createStatement()) {\n    statement.execute("SET group_commit = async_mode;");\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["3. Use ",(0,i.jsx)(n.code,{children:"PreparedStatement"})]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'private static final String JDBC_DRIVER = "com.mysql.jdbc.Driver";\nprivate static final String URL_PATTERN = "jdbc:mysql://%s:%d/%s?useServerPrepStmts=true&useLocalSessionState=true&rewriteBatchedStatements=true&cachePrepStmts=true&prepStmtCacheSqlLimit=99999&prepStmtCacheSize=50&sessionVariables=group_commit=async_mode";\nprivate static final String HOST = "127.0.0.1";\nprivate static final int PORT = 9087;\nprivate static final String DB = "db";\nprivate static final String TBL = "dt";\nprivate static final String USER = "root";\nprivate static final String PASSWD = "";\nprivate static final int INSERT_BATCH_SIZE = 10;\n\nprivate static void groupCommitInsertBatch() throws Exception {\n    Class.forName(JDBC_DRIVER);\n    // add rewriteBatchedStatements=true and cachePrepStmts=true in JDBC url\n    // set session variables by sessionVariables=group_commit=async_mode in JDBC url\n    try (Connection conn = DriverManager.getConnection(\n            String.format(URL_PATTERN, HOST, PORT, DB), USER, PASSWD)) {\n\n        String query = "insert into " + TBL + " values(?, ?, ?)";\n        try (PreparedStatement stmt = conn.prepareStatement(query)) {\n            for (int j = 0; j < 5; j++) {\n                // 10 rows per insert\n                for (int i = 0; i < INSERT_BATCH_SIZE; i++) {\n                    stmt.setInt(1, i);\n                    stmt.setString(2, "name" + i);\n                    stmt.setInt(3, i + 10);\n                    stmt.addBatch();\n                }\n                int[] result = stmt.executeBatch();\n            }\n        }\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Note: Since high-frequency insert into statements will print large amounts of audit logs affecting final performance, printing prepared statement audit logs is disabled by default. You can control whether to print prepared statement audit logs through session variable settings."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"# Configure session variable to enable printing prepared statement audit log, default is false\nset enable_prepared_stmt_audit_log=true;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For more about ",(0,i.jsx)(n.strong,{children:"JDBC"})," usage, refer to ",(0,i.jsx)(n.a,{href:"/docs/3.x/data-operate/import/import-way/insert-into-manual",children:"Using Insert Method to Synchronize Data"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"using-golang-for-group-commit",children:"Using Golang for Group Commit"}),"\n",(0,i.jsx)(n.p,{children:"Since Golang has limited support for prepared statements, we can improve Group Commit performance through manual client-side batching. Here's a sample program:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Golang",children:'package main\n\nimport (\n	"database/sql"\n	"fmt"\n	"math/rand"\n	"strings"\n	"sync"\n	"sync/atomic"\n	"time"\n\n	_ "github.com/go-sql-driver/mysql"\n)\n\nconst (\n	host     = "127.0.0.1"\n	port     = 9038\n	db       = "test"\n	user     = "root"\n	password = ""\n	table    = "async_lineitem"\n)\n\nvar (\n	threadCount = 20\n	batchSize   = 100\n)\n\nvar totalInsertedRows int64\nvar rowsInsertedLastSecond int64\n\nfunc main() {\n	dbDSN := fmt.Sprintf("%s:%s@tcp(%s:%d)/%s?parseTime=true", user, password, host, port, db)\n	db, err := sql.Open("mysql", dbDSN)\n	if err != nil {\n		fmt.Printf("Error opening database: %s\\n", err)\n		return\n	}\n	defer db.Close()\n\n	var wg sync.WaitGroup\n	for i := 0; i < threadCount; i++ {\n		wg.Add(1)\n		go func() {\n			defer wg.Done()\n			groupCommitInsertBatch(db)\n		}()\n	}\n\n	go logInsertStatistics()\n\n	wg.Wait()\n}\n\nfunc groupCommitInsertBatch(db *sql.DB) {\n	for {\n		valueStrings := make([]string, 0, batchSize)\n		valueArgs := make([]interface{}, 0, batchSize*16)\n		for i := 0; i < batchSize; i++ {\n		    valueStrings = append(valueStrings, "(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)")\n			valueArgs = append(valueArgs, rand.Intn(1000))\n			valueArgs = append(valueArgs, rand.Intn(1000))\n			valueArgs = append(valueArgs, rand.Intn(1000))\n			valueArgs = append(valueArgs, rand.Intn(1000))\n			valueArgs = append(valueArgs, sql.NullFloat64{Float64: 1.0, Valid: true})\n			valueArgs = append(valueArgs, sql.NullFloat64{Float64: 1.0, Valid: true})\n			valueArgs = append(valueArgs, sql.NullFloat64{Float64: 1.0, Valid: true})\n			valueArgs = append(valueArgs, sql.NullFloat64{Float64: 1.0, Valid: true})\n			valueArgs = append(valueArgs, "N")\n			valueArgs = append(valueArgs, "O")\n			valueArgs = append(valueArgs, time.Now())\n			valueArgs = append(valueArgs, time.Now())\n			valueArgs = append(valueArgs, time.Now())\n			valueArgs = append(valueArgs, "DELIVER IN PERSON")\n			valueArgs = append(valueArgs, "SHIP")\n			valueArgs = append(valueArgs, "N/A")\n		}\n		stmt := fmt.Sprintf("INSERT INTO %s VALUES %s",\n			table, strings.Join(valueStrings, ","))\n		_, err := db.Exec(stmt, valueArgs...)\n		if err != nil {\n			fmt.Printf("Error executing batch: %s\\n", err)\n			return\n		}\n		atomic.AddInt64(&rowsInsertedLastSecond, int64(batchSize))\n		atomic.AddInt64(&totalInsertedRows, int64(batchSize))\n	}\n}\n\nfunc logInsertStatistics() {\n	for {\n		time.Sleep(1 * time.Second)\n		fmt.Printf("Total inserted rows: %d\\n", totalInsertedRows)\n		fmt.Printf("Rows inserted in the last second: %d\\n", rowsInsertedLastSecond)\n		rowsInsertedLastSecond = 0\n	}\n}\n\n'})}),"\n",(0,i.jsx)(n.h3,{id:"insert-into-values",children:"INSERT INTO VALUES"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Asynchronous Mode"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"# Configure session variable to enable group commit (default is off_mode), enable asynchronous mode\nmysql> set group_commit = async_mode;\n\n# The returned label is prefixed with group_commit, indicating whether group commit is used\nmysql> insert into dt values(1, 'Bob', 90), (2, 'Alice', 99);\nQuery OK, 2 rows affected (0.05 sec)\n{'label':'group_commit_a145ce07f1c972fc-bd2c54597052a9ad', 'status':'PREPARE', 'txnId':'181508'}\n\n# The label, txn_id, and previous one are the same, indicating that they are accumulated into the same import task\nmysql> insert into dt(id, name) values(3, 'John');\nQuery OK, 1 row affected (0.01 sec)\n{'label':'group_commit_a145ce07f1c972fc-bd2c54597052a9ad', 'status':'PREPARE', 'txnId':'181508'}\n\n# Cannot query immediately\nmysql> select * from dt;\nEmpty set (0.01 sec)\n\n# 10 seconds later, data can be queried, and data visibility delay can be controlled by table attribute group_commit_interval.\nmysql> select * from dt;\n+------+-------+-------+\n| id   | name  | score |\n+------+-------+-------+\n|    1 | Bob   |    90 |\n|    2 | Alice |    99 |\n|    3 | John  |  NULL |\n+------+-------+-------+\n3 rows in set (0.02 sec)\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Synchronous Mode"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"# Configure session variable to enable group commit (default is off_mode), enable synchronous mode\nmysql> set group_commit = sync_mode;\n\n# The returned label is prefixed with group_commit, indicating whether group commit is used, and import time is at least table attribute group_commit_interval.\nmysql> insert into dt values(4, 'Bob', 90), (5, 'Alice', 99);\nQuery OK, 2 rows affected (10.06 sec)\n{'label':'group_commit_d84ab96c09b60587_ec455a33cb0e9e87', 'status':'PREPARE', 'txnId':'3007', 'query_id':'fc6b94085d704a94-a69bfc9a202e66e2'}\n\n# Data can be read immediately\nmysql> select * from dt;\n+------+-------+-------+\n| id   | name  | score |\n+------+-------+-------+\n|    1 | Bob   |    90 |\n|    2 | Alice |    99 |\n|    3 | John  |  NULL |\n|    4 | Bob   |    90 |\n|    5 | Alice |    99 |\n+------+-------+-------+\n5 rows in set (0.03 sec)\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Off Mode"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"mysql> set group_commit = off_mode;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"stream-load",children:"Stream Load"}),"\n",(0,i.jsxs)(n.p,{children:["Assuming ",(0,i.jsx)(n.code,{children:"data.csv"})," contains:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"6,Amy,60\n7,Ross,98\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Asynchronous Mode"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'# Import with "group_commit:async_mode" configuration in header\n\ncurl --location-trusted -u {user}:{passwd} -T data.csv -H "group_commit:async_mode"  -H "column_separator:,"  http://{fe_host}:{http_port}/api/db/dt/_stream_load\n{\n    "TxnId": 7009,\n    "Label": "group_commit_c84d2099208436ab_96e33fda01eddba8",\n    "Comment": "",\n    "GroupCommit": true,\n    "Status": "Success",\n    "Message": "OK",\n    "NumberTotalRows": 2,\n    "NumberLoadedRows": 2,\n    "NumberFilteredRows": 0,\n    "NumberUnselectedRows": 0,\n    "LoadBytes": 19,\n    "LoadTimeMs": 35,\n    "StreamLoadPutTimeMs": 5,\n    "ReadDataTimeMs": 0,\n    "WriteDataTimeMs": 26\n}\n\n# The returned GroupCommit is true, indicating that the group commit process is entered\n# The returned Label is prefixed with group_commit, indicating the label associated with the import that truly consumes data\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Synchronous Mode"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'# Import with "group_commit:sync_mode" configuration in header\n\ncurl --location-trusted -u {user}:{passwd} -T data.csv -H "group_commit:sync_mode"  -H "column_separator:,"  http://{fe_host}:{http_port}/api/db/dt/_stream_load\n{\n    "TxnId": 3009,\n    "Label": "group_commit_d941bf17f6efcc80_ccf4afdde9881293",\n    "Comment": "",\n    "GroupCommit": true,\n    "Status": "Success",\n    "Message": "OK",\n    "NumberTotalRows": 2,\n    "NumberLoadedRows": 2,\n    "NumberFilteredRows": 0,\n    "NumberUnselectedRows": 0,\n    "LoadBytes": 19,\n    "LoadTimeMs": 10044,\n    "StreamLoadPutTimeMs": 4,\n    "ReadDataTimeMs": 0,\n    "WriteDataTimeMs": 10038\n}\n\n# The returned GroupCommit is true, indicating that the group commit process is entered\n# The returned Label is prefixed with group_commit, indicating the label associated with the import that truly consumes data\n'})}),"\n",(0,i.jsxs)(n.p,{children:["About Stream Load usage, please refer to ",(0,i.jsx)(n.a,{href:"./import-way/stream-load-manual",children:"Stream Load"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Data is automatically committed when either time interval (default 10 seconds) or data volume (default 64 MB) condition is met. These parameters should be used together and tuned based on actual scenarios."}),"\n",(0,i.jsx)(n.h3,{id:"modifying-commit-interval",children:"Modifying Commit Interval"}),"\n",(0,i.jsx)(n.p,{children:"Default commit interval is 10 seconds, users can adjust through table configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'# Modify commit interval to 2 seconds\nALTER TABLE dt SET ("group_commit_interval_ms" = "2000");\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Parameter Adjustment Recommendations"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Shorter intervals (e.g., 2 seconds):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pros: Lower data visibility latency, suitable for scenarios requiring high real-time performance"}),"\n",(0,i.jsx)(n.li,{children:"Cons: More commits, faster version growth, higher background compaction pressure"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Longer intervals (e.g., 30 seconds):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pros: Larger commit batches, slower version growth, lower system overhead"}),"\n",(0,i.jsx)(n.li,{children:"Cons: Higher data visibility latency"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Recommend setting based on business tolerance for data visibility delay. If system pressure is high, consider increasing the interval."}),"\n",(0,i.jsx)(n.h3,{id:"modifying-commit-data-volume",children:"Modifying Commit Data Volume"}),"\n",(0,i.jsx)(n.p,{children:"Group Commit's default commit data volume is 64 MB, users can adjust through table configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'# Modify commit data volume to 128MB\nALTER TABLE dt SET ("group_commit_data_bytes" = "134217728");\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Parameter Adjustment Recommendations"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Smaller threshold (e.g., 32MB):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pros: Less memory usage, suitable for resource-constrained environments"}),"\n",(0,i.jsx)(n.li,{children:"Cons: Smaller commit batches, potentially limited throughput"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Larger threshold (e.g., 256MB):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pros: Higher batch commit efficiency, greater system throughput"}),"\n",(0,i.jsx)(n.li,{children:"Cons: Uses more memory"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Recommend balancing based on system memory resources and data reliability requirements. If memory is sufficient and higher throughput is desired, consider increasing to 128MB or more."}),"\n",(0,i.jsx)(n.h3,{id:"be-configuration",children:"BE Configuration"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"group_commit_wal_path"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Description: Directory for storing group commit WAL files"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Default: Creates a ",(0,i.jsx)(n.code,{children:"wal"})," directory under each configured ",(0,i.jsx)(n.code,{children:"storage_root_path"}),". Configuration example:"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"group_commit_wal_path=/data1/storage/wal;/data2/storage/wal;/data3/storage/wal\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"usage-limitations",children:"Usage Limitations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Group Commit Limitations"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"INSERT INTO VALUES"})," statements degrade to non-Group Commit mode in these cases:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Transaction writes (",(0,i.jsx)(n.code,{children:"Begin; INSERT INTO VALUES; COMMIT"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Specified Label (",(0,i.jsx)(n.code,{children:"INSERT INTO dt WITH LABEL {label} VALUES"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["VALUES containing expressions (",(0,i.jsx)(n.code,{children:"INSERT INTO dt VALUES (1 + 100)"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Column update writes"}),"\n",(0,i.jsx)(n.li,{children:"Table doesn't support lightweight mode changes"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Stream Load"})," degrades to non-Group Commit mode in these cases:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Using two-phase commit"}),"\n",(0,i.jsxs)(n.li,{children:["Specified Label (",(0,i.jsx)(n.code,{children:'-H "label:my_label"'}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Column update writes"}),"\n",(0,i.jsx)(n.li,{children:"Table doesn't support lightweight mode changes"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Unique Model"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Group Commit doesn't guarantee commit order, recommend using Sequence column to ensure data consistency."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"WAL Limitations"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"async_mode"})," writes data to WAL, deletes after success, recovers through WAL on failure."]}),"\n",(0,i.jsx)(n.li,{children:"WAL files are stored with a single replica on one BE, disk damage or accidental file deletion may cause data loss."}),"\n",(0,i.jsxs)(n.li,{children:["When offlining BE nodes, use ",(0,i.jsx)(n.code,{children:"DECOMMISSION"})," command to prevent data loss."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"async_mode"})," switches to ",(0,i.jsx)(n.code,{children:"sync_mode"})," in these cases:\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Load data volume too large (exceeds 80% of WAL single directory space)"}),"\n",(0,i.jsx)(n.li,{children:"Unknown data volume chunked stream load"}),"\n",(0,i.jsx)(n.li,{children:"Insufficient disk space"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"During heavyweight Schema Change, Group Commit writes are rejected, client needs to retry."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,i.jsxs)(n.p,{children:["We have separately tested the write performance of group commit in high-concurrency scenarios with small data volumes using ",(0,i.jsx)(n.code,{children:"Stream Load"})," and ",(0,i.jsx)(n.code,{children:"JDBC"})," (in ",(0,i.jsx)(n.code,{children:"async mode"}),")."]}),"\n",(0,i.jsx)(n.h3,{id:"stream-load-1",children:"Stream Load"}),"\n",(0,i.jsx)(n.h4,{id:"environment",children:"Environment"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"1 Front End (FE) server: Alibaba Cloud with 8-core CPU, 16GB RAM, and one 100GB ESSD PL1 SSD."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"3 Backend (BE) servers: Alibaba Cloud with 16-core CPU, 64GB RAM, and one 1TB ESSD PL1 SSD."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"1 Test Client: Alibaba Cloud with 16-core CPU, 64GB RAM, and one 100GB ESSD PL1 SSD."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The version for testing is Doris-3.0.1."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"dataset",children:"DataSet"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"httplogs"}),", 31 GB, 247249096 (247 million) rows"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"test-tool",children:"Test Tool"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"../../ecosystem/doris-streamloader",children:"doris-streamloader"})}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"test-method",children:"Test Method"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Testing with different data sizes per request and concurrency levels between ",(0,i.jsx)(n.code,{children:"non group_commit"})," and ",(0,i.jsx)(n.code,{children:"group_commit=async mode"})," modes."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"test-results",children:"Test Results"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Load Way"}),(0,i.jsx)(n.th,{children:"Single-concurrency Data Size"}),(0,i.jsx)(n.th,{children:"Concurrency"}),(0,i.jsx)(n.th,{children:"Cost Seconds"}),(0,i.jsx)(n.th,{children:"Rows / Seconds"}),(0,i.jsx)(n.th,{children:"MB / Seconds"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"group_commit"})}),(0,i.jsx)(n.td,{children:"10 KB"}),(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"2204"}),(0,i.jsx)(n.td,{children:"112,181"}),(0,i.jsx)(n.td,{children:"14.8"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"group_commit"})}),(0,i.jsx)(n.td,{children:"10 KB"}),(0,i.jsx)(n.td,{children:"30"}),(0,i.jsx)(n.td,{children:"2176"}),(0,i.jsx)(n.td,{children:"113,625"}),(0,i.jsx)(n.td,{children:"15.0"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"group_commit"})}),(0,i.jsx)(n.td,{children:"100 KB"}),(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"283"}),(0,i.jsx)(n.td,{children:"873,671"}),(0,i.jsx)(n.td,{children:"115.1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"group_commit"})}),(0,i.jsx)(n.td,{children:"100 KB"}),(0,i.jsx)(n.td,{children:"30"}),(0,i.jsx)(n.td,{children:"244"}),(0,i.jsx)(n.td,{children:"1,013,315"}),(0,i.jsx)(n.td,{children:"133.5"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"group_commit"})}),(0,i.jsx)(n.td,{children:"500 KB"}),(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"125"}),(0,i.jsx)(n.td,{children:"1,977,992"}),(0,i.jsx)(n.td,{children:"260.6"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"group_commit"})}),(0,i.jsx)(n.td,{children:"500 KB"}),(0,i.jsx)(n.td,{children:"30"}),(0,i.jsx)(n.td,{children:"122"}),(0,i.jsx)(n.td,{children:"2,026,631"}),(0,i.jsx)(n.td,{children:"267.1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"group_commit"})}),(0,i.jsx)(n.td,{children:"1 MB"}),(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"119"}),(0,i.jsx)(n.td,{children:"2,077,723"}),(0,i.jsx)(n.td,{children:"273.8"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"group_commit"})}),(0,i.jsx)(n.td,{children:"1 MB"}),(0,i.jsx)(n.td,{children:"30"}),(0,i.jsx)(n.td,{children:"119"}),(0,i.jsx)(n.td,{children:"2,077,723"}),(0,i.jsx)(n.td,{children:"273.8"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"group_commit"})}),(0,i.jsx)(n.td,{children:"10 MB"}),(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"118"}),(0,i.jsx)(n.td,{children:"2,095,331"}),(0,i.jsx)(n.td,{children:"276.1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"non group_commit"})}),(0,i.jsx)(n.td,{children:"1 MB"}),(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"1883"}),(0,i.jsx)(n.td,{children:"131,305"}),(0,i.jsx)(n.td,{children:"17.3"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"non group_commit"})}),(0,i.jsx)(n.td,{children:"10 MB"}),(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"294"}),(0,i.jsx)(n.td,{children:"840,983"}),(0,i.jsx)(n.td,{children:"105.4"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"non group_commit"})}),(0,i.jsx)(n.td,{children:"10 MB"}),(0,i.jsx)(n.td,{children:"30"}),(0,i.jsx)(n.td,{children:"118"}),(0,i.jsx)(n.td,{children:"2,095,331"}),(0,i.jsx)(n.td,{children:"276.1"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"In the above test, the CPU usage of BE fluctuates between 10-40%."}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"group_commit"})," effectively enhances load performance while reducing the number of versions, thereby alleviating the pressure on compaction."]}),"\n",(0,i.jsx)(n.h3,{id:"jdbc",children:"JDBC"}),"\n",(0,i.jsx)(n.h4,{id:"environment-1",children:"Environment"}),"\n",(0,i.jsx)(n.p,{children:"1 Front End (FE) server: Alibaba Cloud with an 8-core CPU, 16GB RAM, and one 100GB ESSD PL1 SSD."}),"\n",(0,i.jsx)(n.p,{children:"1 Backend (BE) server: Alibaba Cloud with a 16-core CPU, 64GB RAM, and one 500GB ESSD PL1 SSD."}),"\n",(0,i.jsx)(n.p,{children:"1 Test Client: Alibaba Cloud with a 16-core CPU, 64GB RAM, and one 100GB ESSD PL1 SSD."}),"\n",(0,i.jsx)(n.p,{children:"The testing version is Doris-2.1.5."}),"\n",(0,i.jsx)(n.p,{children:"Disable the printing of prepared statement audit logs to enhance performance."}),"\n",(0,i.jsx)(n.h4,{id:"dataset-1",children:"DataSet"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The data of tpch sf10 ",(0,i.jsx)(n.code,{children:"lineitem"})," table, 20 files, 14 GB, 120 million rows"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"test-method-1",children:"Test Method"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/alibaba/DataX",children:"DataX"})}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"test-method-2",children:"Test Method"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"txtfilereader"})," wtite data to ",(0,i.jsx)(n.code,{children:"mysqlwriter"}),", config different concurrenncy and rows for per ",(0,i.jsx)(n.code,{children:"INSERT"})," sql."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"test-results-1",children:"Test Results"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Rows per insert"}),(0,i.jsx)(n.th,{children:"Concurrency"}),(0,i.jsx)(n.th,{children:"Rows / Second"}),(0,i.jsx)(n.th,{children:"MB / Second"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"100"}),(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"160,758"}),(0,i.jsx)(n.td,{children:"17.21"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"100"}),(0,i.jsx)(n.td,{children:"20"}),(0,i.jsx)(n.td,{children:"210,476"}),(0,i.jsx)(n.td,{children:"22.19"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"100"}),(0,i.jsx)(n.td,{children:"30"}),(0,i.jsx)(n.td,{children:"214,323"}),(0,i.jsx)(n.td,{children:"22.92"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"In the above test, the CPU usage of BE fluctuates between 10-20%, FE fluctuates between 60-70%."}),"\n",(0,i.jsx)(n.h3,{id:"insert-into-sync-mode-small-batch-data",children:"Insert into Sync Mode Small Batch Data"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Machine Configuration"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"1 Front-End (FE): Alibaba Cloud, 16-core CPU, 64GB RAM, 1 x 500GB ESSD PL1 cloud disk"}),"\n",(0,i.jsx)(n.li,{children:"5 Back-End (BE) nodes: Alibaba Cloud, 16-core CPU, 64GB RAM, 1 x 1TB ESSD PL1 cloud disk."}),"\n",(0,i.jsx)(n.li,{children:"1 Testing Client: Alibaba Cloud, 16-core CPU, 64GB RAM, 1 x 100GB ESSD PL1 cloud disk"}),"\n",(0,i.jsx)(n.li,{children:"Test version: Doris-2.1.5"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Dataset"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The data of tpch sf10 ",(0,i.jsx)(n.code,{children:"lineitem"})," table."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The create table statement is"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE IF NOT EXISTS lineitem (\n  L_ORDERKEY    INTEGER NOT NULL,\n  L_PARTKEY     INTEGER NOT NULL,\n  L_SUPPKEY     INTEGER NOT NULL,\n  L_LINENUMBER  INTEGER NOT NULL,\n  L_QUANTITY    DECIMAL(15,2) NOT NULL,\n  L_EXTENDEDPRICE  DECIMAL(15,2) NOT NULL,\n  L_DISCOUNT    DECIMAL(15,2) NOT NULL,\n  L_TAX         DECIMAL(15,2) NOT NULL,\n  L_RETURNFLAG  CHAR(1) NOT NULL,\n  L_LINESTATUS  CHAR(1) NOT NULL,\n  L_SHIPDATE    DATE NOT NULL,\n  L_COMMITDATE  DATE NOT NULL,\n  L_RECEIPTDATE DATE NOT NULL,\n  L_SHIPINSTRUCT CHAR(25) NOT NULL,\n  L_SHIPMODE     CHAR(10) NOT NULL,\n  L_COMMENT      VARCHAR(44) NOT NULL\n)\nDUPLICATE KEY(L_ORDERKEY, L_PARTKEY, L_SUPPKEY, L_LINENUMBER)\nDISTRIBUTED BY HASH(L_ORDERKEY) BUCKETS 32\nPROPERTIES (\n  "replication_num" = "3"\n);\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Testing Tool"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://jmeter.apache.org/",children:"Jmeter"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"JMeter Parameter Settings as Shown in the Images"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"jmeter1",src:s(638797).Z+"",width:"2744",height:"1716"}),"\n",(0,i.jsx)(n.img,{alt:"jmeter2",src:s(225073).Z+"",width:"2746",height:"1720"})]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Set the Init Statement Before Testing:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"set group_commit=async_mode;\nset enable_nereids_planner=false;\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Enable JDBC Prepared Statement:"}),"\n",(0,i.jsx)(n.p,{children:"Complete URL:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"jdbc:mysql://127.0.0.1:9030?useServerPrepStmts=true&useLocalSessionState=true&rewriteBatchedStatements=true&cachePrepStmts=true&prepStmtCacheSqlLimit=99999&prepStmtCacheSize=50&sessionVariables=group_commit=async_mode,enable_nereids_planner=false.\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Set the Import Type to Prepared Update Statement."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Set the Import Statement."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Set the Values to Be Imported:"}),"\n",(0,i.jsx)(n.p,{children:"Ensure that the imported values match the data types one by one."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Testing Methodology"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use JMeter to write data into Doris. Each thread writes 1 row of data per execution using the insert into statement."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Test Results"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Data unit: rows per second."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The following tests are divided into 30, 100, and 500 concurrency."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Performance Test with 30 Concurrent Users in Sync Mode, 5 BEs, and 3 Replicas"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Group commit interval"}),(0,i.jsx)(n.th,{children:"10ms"}),(0,i.jsx)(n.th,{children:"20ms"}),(0,i.jsx)(n.th,{children:"50ms"}),(0,i.jsx)(n.th,{children:"100ms"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=true"}),(0,i.jsx)(n.td,{children:"891.8"}),(0,i.jsx)(n.td,{children:"701.1"}),(0,i.jsx)(n.td,{children:"400.0"}),(0,i.jsx)(n.td,{children:"237.5"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=false"}),(0,i.jsx)(n.td,{children:"885.8"}),(0,i.jsx)(n.td,{children:"688.1"}),(0,i.jsx)(n.td,{children:"398.7"}),(0,i.jsx)(n.td,{children:"232.9"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Performance Test with 100 Concurrent Users in Sync Mode, 5 BEs, and 3 Replicas"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Group commit interval"}),(0,i.jsx)(n.th,{children:"10ms"}),(0,i.jsx)(n.th,{children:"20ms"}),(0,i.jsx)(n.th,{children:"50ms"}),(0,i.jsx)(n.th,{children:"100ms"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=true"}),(0,i.jsx)(n.td,{children:"2427.8"}),(0,i.jsx)(n.td,{children:"2068.9"}),(0,i.jsx)(n.td,{children:"1259.4"}),(0,i.jsx)(n.td,{children:"764.9"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=false"}),(0,i.jsx)(n.td,{children:"2320.4"}),(0,i.jsx)(n.td,{children:"1899.3"}),(0,i.jsx)(n.td,{children:"1206.2"}),(0,i.jsx)(n.td,{children:"749.7"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Performance Test with 500 Concurrent Users in Sync Mode, 5 BEs, and 3 Replicas"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Group commit interval"}),(0,i.jsx)(n.th,{children:"10ms"}),(0,i.jsx)(n.th,{children:"20ms"}),(0,i.jsx)(n.th,{children:"50ms"}),(0,i.jsx)(n.th,{children:"100ms"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=true"}),(0,i.jsx)(n.td,{children:"5567.5"}),(0,i.jsx)(n.td,{children:"5713.2"}),(0,i.jsx)(n.td,{children:"4681.0"}),(0,i.jsx)(n.td,{children:"3131.2"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=false"}),(0,i.jsx)(n.td,{children:"4471.6"}),(0,i.jsx)(n.td,{children:"5042.5"}),(0,i.jsx)(n.td,{children:"4932.2"}),(0,i.jsx)(n.td,{children:"3641.1"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"insert-into-sync-mode-large-batch-data",children:"Insert into Sync Mode Large Batch Data"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Machine Configuration"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"1 Front-End (FE): Alibaba Cloud, 16-core CPU, 64GB RAM, 1 x 500GB ESSD PL1 cloud disk"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"5 Back-End (BE) nodes: Alibaba Cloud, 16-core CPU, 64GB RAM, 1 x 1TB ESSD PL1 cloud disk."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"1 Testing Client: Alibaba Cloud, 16-core CPU, 64GB RAM, 1 x 100GB ESSD PL1 cloud disk"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Test version: Doris-3.0.1"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Dataset"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Insert into statement for 1000 rows: ",(0,i.jsx)(n.code,{children:"insert into tbl values(1,1)..."})," (1000 rows omitted)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Testing Tool"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://jmeter.apache.org/",children:"Jmeter"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Testing Methodology"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use JMeter to write data into Doris. Each thread writes 1000 row of data per execution using the insert into statement."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Test Results"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Data unit: rows per second."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The following tests are divided into 30, 100, and 500 concurrency."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Performance Test with 30 Concurrent Users in Sync Mode, 5 BEs, and 3 Replicas"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Group commit interval"}),(0,i.jsx)(n.th,{children:"10ms"}),(0,i.jsx)(n.th,{children:"20ms"}),(0,i.jsx)(n.th,{children:"50ms"}),(0,i.jsx)(n.th,{children:"100ms"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=true"}),(0,i.jsx)(n.td,{children:"9.1K"}),(0,i.jsx)(n.td,{children:"11.1K"}),(0,i.jsx)(n.td,{children:"11.4K"}),(0,i.jsx)(n.td,{children:"11.1K"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=false"}),(0,i.jsx)(n.td,{children:"157.8K"}),(0,i.jsx)(n.td,{children:"159.9K"}),(0,i.jsx)(n.td,{children:"154.1K"}),(0,i.jsx)(n.td,{children:"120.4K"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Performance Test with 100 Concurrent Users in Sync Mode, 5 BEs, and 3 Replicas"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Group commit interval"}),(0,i.jsx)(n.th,{children:"10ms"}),(0,i.jsx)(n.th,{children:"20ms"}),(0,i.jsx)(n.th,{children:"50ms"}),(0,i.jsx)(n.th,{children:"100ms"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=true"}),(0,i.jsx)(n.td,{children:"10.0K"}),(0,i.jsx)(n.td,{children:"9.2K"}),(0,i.jsx)(n.td,{children:"8.9K"}),(0,i.jsx)(n.td,{children:"8.9K"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=false"}),(0,i.jsx)(n.td,{children:"130.4k"}),(0,i.jsx)(n.td,{children:"131.0K"}),(0,i.jsx)(n.td,{children:"130.4K"}),(0,i.jsx)(n.td,{children:"124.1K"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Performance Test with 500 Concurrent Users in Sync Mode, 5 BEs, and 3 Replicas"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Group commit interval"}),(0,i.jsx)(n.th,{children:"10ms"}),(0,i.jsx)(n.th,{children:"20ms"}),(0,i.jsx)(n.th,{children:"50ms"}),(0,i.jsx)(n.th,{children:"100ms"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=true"}),(0,i.jsx)(n.td,{children:"2.5K"}),(0,i.jsx)(n.td,{children:"2.5K"}),(0,i.jsx)(n.td,{children:"2.3K"}),(0,i.jsx)(n.td,{children:"2.1K"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_nereids_planner=false"}),(0,i.jsx)(n.td,{children:"94.2K"}),(0,i.jsx)(n.td,{children:"95.1K"}),(0,i.jsx)(n.td,{children:"94.4K"}),(0,i.jsx)(n.td,{children:"94.8K"})]})]})]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},638797:function(e,n,s){s.d(n,{Z:function(){return t}});let t=s.p+"assets/images/jmeter1-baa8bee682b7778e4b90dcc7d1e66d96.jpg"},225073:function(e,n,s){s.d(n,{Z:function(){return t}});let t=s.p+"assets/images/jmeter2-9060becd8c6cb1bef900edad9bb306aa.jpg"},250065:function(e,n,s){s.d(n,{Z:function(){return l},a:function(){return d}});var t=s(667294);let i={},r=t.createContext(i);function d(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);