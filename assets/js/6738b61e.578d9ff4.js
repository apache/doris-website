"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["295880"],{844351:function(e,a,n){n.r(a),n.d(a,{default:()=>d,frontMatter:()=>s,metadata:()=>t,assets:()=>l,toc:()=>h,contentTitle:()=>r});var t=JSON.parse('{"id":"lakehouse/data-cache","title":"Data Cache","description":"Data Cache accelerates subsequent queries of the same data by caching recently accessed data files from remote storage systems (HDFS or object storage) to local disks. In scenarios where the same data is frequently accessed, Data Cache can avoid the overhead of repeated remote data access, improving the performance and stability of query analysis on hot data.","source":"@site/docs/lakehouse/data-cache.md","sourceDirName":"lakehouse","slug":"/lakehouse/data-cache","permalink":"/docs/dev/lakehouse/data-cache","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Data Cache","language":"en"},"sidebar":"docs","previous":{"title":"Text/CSV/JSON","permalink":"/docs/dev/lakehouse/file-formats/text"},"next":{"title":"Metadata Cache","permalink":"/docs/dev/lakehouse/meta-cache"}}'),c=n("785893"),i=n("250065");let s={title:"Data Cache",language:"en"},r=void 0,l={},h=[{value:"Applicable Scenarios",id:"applicable-scenarios",level:2},{value:"Enabling Data Cache",id:"enabling-data-cache",level:2},{value:"BE Configuration",id:"be-configuration",level:3},{value:"FE Configuration",id:"fe-configuration",level:3},{value:"Cache Observability",id:"cache-observability",level:2},{value:"View Cache Hit Rate",id:"view-cache-hit-rate",level:3},{value:"Monitoring Metrics",id:"monitoring-metrics",level:3},{value:"Appendix",id:"appendix",level:2},{value:"Principle",id:"principle",level:3}];function o(e){let a={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(a.p,{children:"Data Cache accelerates subsequent queries of the same data by caching recently accessed data files from remote storage systems (HDFS or object storage) to local disks. In scenarios where the same data is frequently accessed, Data Cache can avoid the overhead of repeated remote data access, improving the performance and stability of query analysis on hot data."}),"\n",(0,c.jsx)(a.h2,{id:"applicable-scenarios",children:"Applicable Scenarios"}),"\n",(0,c.jsx)(a.p,{children:"The data cache function only works for queries on Hive, Iceberg, Hudi, and Paimon tables. It has no effect on internal table queries or non-file external table queries (such as JDBC, Elasticsearch)."}),"\n",(0,c.jsx)(a.p,{children:"Whether data caching can improve query efficiency depends on multiple factors. Below are the applicable scenarios for data caching:"}),"\n",(0,c.jsxs)(a.ul,{children:["\n",(0,c.jsxs)(a.li,{children:["\n",(0,c.jsx)(a.p,{children:"High-speed local disk"}),"\n",(0,c.jsx)(a.p,{children:"It is recommended to use high-speed local disks, such as SSD or NVME media local disks, as the data cache directory. It is not recommended to use mechanical hard drives as the data cache directory. Essentially, the local disk's IO bandwidth and IOPS must be significantly higher than the network bandwidth and the source storage system's IO bandwidth and IOPS to bring noticeable performance improvements."}),"\n"]}),"\n",(0,c.jsxs)(a.li,{children:["\n",(0,c.jsx)(a.p,{children:"Sufficient cache space size"}),"\n",(0,c.jsx)(a.p,{children:"Data caching uses the LRU strategy as the cache eviction policy. If the queried data does not have a clear distinction between hot and cold, the cached data may be frequently updated and replaced, which may reduce query performance. It is recommended to enable data caching in scenarios where the query pattern has a clear distinction between hot and cold (e.g., most queries only access today's data and rarely access historical data), and the cache space is sufficient to store hot data."}),"\n"]}),"\n",(0,c.jsxs)(a.li,{children:["\n",(0,c.jsx)(a.p,{children:"Unstable IO latency of remote storage"}),"\n",(0,c.jsx)(a.p,{children:"This situation usually occurs on HDFS storage. In most enterprises, different business departments share the same HDFS, which may lead to very unstable IO latency during peak periods. In this case, if you need to ensure stable IO latency, it is recommended to enable data caching. However, the first two conditions should still be considered."}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(a.h2,{id:"enabling-data-cache",children:"Enabling Data Cache"}),"\n",(0,c.jsx)(a.p,{children:"The data cache function is disabled by default and needs to be enabled by setting relevant parameters in FE and BE."}),"\n",(0,c.jsx)(a.h3,{id:"be-configuration",children:"BE Configuration"}),"\n",(0,c.jsxs)(a.p,{children:["First, configure the cache path information in ",(0,c.jsx)(a.code,{children:"be.conf"})," and restart the BE node to make the configuration effective."]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,c.jsxs)(a.table,{children:[(0,c.jsx)(a.thead,{children:(0,c.jsxs)(a.tr,{children:[(0,c.jsx)(a.th,{children:"Parameter"}),(0,c.jsx)(a.th,{children:"Required"}),(0,c.jsx)(a.th,{children:"Description"})]})}),(0,c.jsxs)(a.tbody,{children:[(0,c.jsxs)(a.tr,{children:[(0,c.jsx)(a.td,{children:(0,c.jsx)(a.code,{children:"enable_file_cache"})}),(0,c.jsx)(a.td,{children:"Yes"}),(0,c.jsx)(a.td,{children:"Whether to enable Data Cache, default is false"})]}),(0,c.jsxs)(a.tr,{children:[(0,c.jsx)(a.td,{children:(0,c.jsx)(a.code,{children:"file_cache_path"})}),(0,c.jsx)(a.td,{children:"Yes"}),(0,c.jsx)(a.td,{children:"Configuration related to the cache directory, in JSON format."})]}),(0,c.jsxs)(a.tr,{children:[(0,c.jsx)(a.td,{children:(0,c.jsx)(a.code,{children:"clear_file_cache"})}),(0,c.jsx)(a.td,{children:"No"}),(0,c.jsx)(a.td,{children:"Default is false. If true, the cache directory will be cleared when the BE node restarts."})]})]})]}),"\n",(0,c.jsxs)(a.p,{children:["Example configuration of ",(0,c.jsx)(a.code,{children:"file_cache_path"}),":"]}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-sql",children:'file_cache_path=[{"path": "/path/to/file_cache1", "total_size":53687091200},{"path": "/path/to/file_cache2", "total_size":53687091200},{"path": "/path/to/file_cache3", "total_size":53687091200}]\n'})}),"\n",(0,c.jsxs)(a.p,{children:[(0,c.jsx)(a.code,{children:"path"})," is the path where the cache is stored, and one or more paths can be configured. It is recommended to configure only one path per disk."]}),"\n",(0,c.jsxs)(a.p,{children:[(0,c.jsx)(a.code,{children:"total_size"})," is the upper limit of the cache space size, in bytes. When the cache space is exceeded, the LRU strategy will be used to evict cached data."]}),"\n",(0,c.jsx)(a.h3,{id:"fe-configuration",children:"FE Configuration"}),"\n",(0,c.jsx)(a.p,{children:"Enable Data Cache in a single session:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-sql",children:"SET enable_file_cache = true;\n"})}),"\n",(0,c.jsx)(a.p,{children:"Enable Data Cache globally:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-sql",children:"SET GLOBAL enable_file_cache = true;\n"})}),"\n",(0,c.jsxs)(a.p,{children:["Note that if ",(0,c.jsx)(a.code,{children:"enable_file_cache"})," is not enabled, the cache will not be used even if the BE is configured with a cache directory. Similarly, if the BE is not configured with a cache directory, the cache will not be used even if ",(0,c.jsx)(a.code,{children:"enable_file_cache"})," is enabled."]}),"\n",(0,c.jsx)(a.h2,{id:"cache-observability",children:"Cache Observability"}),"\n",(0,c.jsx)(a.h3,{id:"view-cache-hit-rate",children:"View Cache Hit Rate"}),"\n",(0,c.jsxs)(a.p,{children:["Execute ",(0,c.jsx)(a.code,{children:"set enable_profile=true"})," to open the session variable, and you can view the job's Profile on the ",(0,c.jsx)(a.code,{children:"Queries"})," tab of the FE web page. The data cache-related metrics are as follows:"]}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-sql",children:"-  FileCache:  0ns\n    -  BytesScannedFromCache:  2.02  GB\n    -  BytesScannedFromRemote:  0.00  \n    -  BytesWriteIntoCache:  0.00  \n    -  LocalIOUseTimer:  2s723ms\n    -  NumLocalIOTotal:  444\n    -  NumRemoteIOTotal:  0\n    -  NumSkipCacheIOTotal:  0\n    -  RemoteIOUseTimer:  0ns\n    -  WriteCacheIOUseTimer:  0ns\n"})}),"\n",(0,c.jsxs)(a.ul,{children:["\n",(0,c.jsxs)(a.li,{children:["\n",(0,c.jsxs)(a.p,{children:[(0,c.jsx)(a.code,{children:"BytesScannedFromCache"}),": The amount of data read from the local cache."]}),"\n"]}),"\n",(0,c.jsxs)(a.li,{children:["\n",(0,c.jsxs)(a.p,{children:[(0,c.jsx)(a.code,{children:"BytesScannedFromRemote"}),": The amount of data read from the remote."]}),"\n"]}),"\n",(0,c.jsxs)(a.li,{children:["\n",(0,c.jsxs)(a.p,{children:[(0,c.jsx)(a.code,{children:"BytesWriteIntoCache"}),": The amount of data written into the cache."]}),"\n"]}),"\n",(0,c.jsxs)(a.li,{children:["\n",(0,c.jsxs)(a.p,{children:[(0,c.jsx)(a.code,{children:"LocalIOUseTimer"}),": The IO time of the local cache."]}),"\n"]}),"\n",(0,c.jsxs)(a.li,{children:["\n",(0,c.jsxs)(a.p,{children:[(0,c.jsx)(a.code,{children:"RemoteIOUseTimer"}),": The IO time of remote reading."]}),"\n"]}),"\n",(0,c.jsxs)(a.li,{children:["\n",(0,c.jsxs)(a.p,{children:[(0,c.jsx)(a.code,{children:"NumLocalIOTotal"}),": The number of IO operations on the local cache."]}),"\n"]}),"\n",(0,c.jsxs)(a.li,{children:["\n",(0,c.jsxs)(a.p,{children:[(0,c.jsx)(a.code,{children:"NumRemoteIOTotal"}),": The number of remote IO operations."]}),"\n"]}),"\n",(0,c.jsxs)(a.li,{children:["\n",(0,c.jsxs)(a.p,{children:[(0,c.jsx)(a.code,{children:"WriteCacheIOUseTimer"}),": The IO time of writing into the cache."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(a.p,{children:["If ",(0,c.jsx)(a.code,{children:"BytesScannedFromRemote"})," is 0, it means the cache is fully hit."]}),"\n",(0,c.jsx)(a.h3,{id:"monitoring-metrics",children:"Monitoring Metrics"}),"\n",(0,c.jsxs)(a.p,{children:["Users can view cache statistics for each Backend node through the system table ",(0,c.jsx)(a.a,{href:"../admin-manual/system-tables/information_schema/file_cache_statistics",children:(0,c.jsx)(a.code,{children:"file_cache_statistics"})}),"."]}),"\n",(0,c.jsx)(a.h2,{id:"appendix",children:"Appendix"}),"\n",(0,c.jsx)(a.h3,{id:"principle",children:"Principle"}),"\n",(0,c.jsxs)(a.p,{children:["Data caching caches accessed remote data to the local BE node. The original data file is split into Blocks based on the accessed IO size, and Blocks are stored in the local file ",(0,c.jsx)(a.code,{children:"cache_path/hash(filepath).substr(0, 3)/hash(filepath)/offset"}),", with Block metadata saved in the BE node. When accessing the same remote file, doris checks whether the cache data of the file exists in the local cache and determines which data to read from the local Block and which data to pull from the remote based on the Block's offset and size, caching the newly pulled remote data. When the BE node restarts, it scans the ",(0,c.jsx)(a.code,{children:"cache_path"})," directory to restore Block metadata. When the cache size reaches the upper limit, it cleans up long-unused Blocks according to the LRU principle."]})]})}function d(e={}){let{wrapper:a}={...(0,i.a)(),...e.components};return a?(0,c.jsx)(a,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}},250065:function(e,a,n){n.d(a,{Z:function(){return r},a:function(){return s}});var t=n(667294);let c={},i=t.createContext(c);function s(e){let a=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),t.createElement(i.Provider,{value:a},e.children)}}}]);