"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["528712"],{580915:function(e,n,i){i.r(n),i.d(n,{default:()=>h,frontMatter:()=>s,metadata:()=>o,assets:()=>l,toc:()=>a,contentTitle:()=>d});var o=JSON.parse('{"id":"source-install/compilation-with-docker","title":"Compiling with Docker (Recommended)","description":"\x3c!--","source":"@site/community/source-install/compilation-with-docker.md","sourceDirName":"source-install","slug":"/source-install/compilation-with-docker","permalink":"/community/source-install/compilation-with-docker","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Compiling with Docker (Recommended)","language":"en"},"sidebar":"community","previous":{"title":"Verify the Apache Release Version","permalink":"/community/release-and-verify/release-verify"},"next":{"title":"Compiling with LDB Toolchain (Recommended)","permalink":"/community/source-install/compilation-with-ldb-toolchain"}}'),t=i("785893"),r=i("250065");let s={title:"Compiling with Docker (Recommended)",language:"en"},d=void 0,l={},a=[{value:"Install Docker",id:"install-docker",level:2},{value:"Download build image",id:"download-build-image",level:2},{value:"Compile Doris",id:"compile-doris",level:2},{value:"1. Download Doris source code",id:"1-download-doris-source-code",level:3},{value:"2. Run build image",id:"2-run-build-image",level:3},{value:"3. Execute the build",id:"3-execute-the-build",level:3},{value:"Build your own development environment image",id:"build-your-own-development-environment-image",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"This guide is about how to compile Doris using the official compilation image provided. As this image is maintained by the Apache Doris team and is regularly updated with the necessary dependencies, it is the recommended way of compilation for users."}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"Currently, this is not supported in the compute-storage decoupled mode."})}),"\n",(0,t.jsx)(n.h2,{id:"install-docker",children:"Install Docker"}),"\n",(0,t.jsx)(n.p,{children:"In CentOS, execute the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"yum install docker\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Or refer to the ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/engine/install/",children:"official Docker installation doc"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"download-build-image",children:"Download build image"}),"\n",(0,t.jsx)(n.p,{children:'For different versions of Doris, you need to download different build images. The "apache/doris:build-env-ldb-toolchain-latest" image is used for compiling the latest master code, and it is regularly updated to align with the master.'}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Image Version"}),(0,t.jsx)(n.th,{children:"Doris Version"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"apache/doris:build-env-for-2.0"}),(0,t.jsx)(n.td,{children:"2.0.x"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"apache/doris:build-env-for-2.0-no-avx2"}),(0,t.jsx)(n.td,{children:"2.0.x"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"apache/doris:build-env-for-2.1"}),(0,t.jsx)(n.td,{children:"2.1.x"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"apache/doris:build-env-for-2.1-no-avx2"}),(0,t.jsx)(n.td,{children:"2.1.x"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"apache/doris:build-env-for-3.0"}),(0,t.jsx)(n.td,{children:"3.0.x"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"apache/doris:build-env-for-3.0-no-avx2"}),(0,t.jsx)(n.td,{children:"3.0.x"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"apache/doris:build-env-for-3.1"}),(0,t.jsx)(n.td,{children:"3.1.x"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"apache/doris:build-env-for-3.1-no-avx2"}),(0,t.jsx)(n.td,{children:"3.1.x"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"apache/doris:build-env-ldb-toolchain-latest"}),(0,t.jsx)(n.td,{children:"master"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"apache/doris:build-env-ldb-toolchain-no-avx2-latest"}),(0,t.jsx)(n.td,{children:"master"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Take Doris 2.0 as an example, download and check the correponding Docker image."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# Choose docker.io/apache/doris:build-env-for-2.0\n$ docker pull apache/doris:build-env-for-2.0\n\n# Check if it is downloaded\n$ docker images\nREPOSITORY      TAG                  IMAGE ID        CREATED       SIZE\napache/doris    build-env-for-2.0    f29cf1979dba    3 days ago    3.3GB\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Note:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Download the right image version for the Doris version that you\'re working with. The image version number is aligned with the Doris version number. For example, you should use "apache/doris:build-env-for-2.0" to compile Doris 2.0.'}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"apache/doris:build-env-ldb-toolchain-latest"})," (Currently, only for x64 architecture) is used for compiling the latest master code and is updated along with the master. You can check the update time in the ",(0,t.jsx)(n.code,{children:"docker/README.md"})," file."]}),"\n",(0,t.jsx)(n.li,{children:"To perform Docker compilation on an ARM64 architecture, you need to download a Linux image that supports ARM64 (e.g., apache/doris:base-latest, which corresponds to Ubuntu 22.04.5 LTS). Then, refer to the compilation documentation for Linux and ARM platforms to download and install the required dependency packages before proceeding with the build."}),"\n",(0,t.jsx)(n.li,{children:'Images with "no-avx2" in their names contain third-party libraries that can run on CPUs that do not support AVX2 instructions. Using these images, you can compile Doris with the "USE_AVX2=0".'}),"\n",(0,t.jsxs)(n.li,{children:["For information about changes in the compilation image, please see ",(0,t.jsx)(n.a,{href:"https://github.com/apache/doris/blob/master/thirdparty/CHANGELOG.md",children:"ChangeLog"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["The Docker compilation image includes both JDK 8 and JDK 17. You can check the default JDK version by running ",(0,t.jsx)(n.code,{children:"java -version"}),", and switch between versions using the following commands. For versions earlier than 2.1 (inclusive), please use JDK 8. For versions later than 3.0 (inclusive) or the master branch, please use JDK 17."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# Switch to JDK 8\nexport JAVA_HOME=/usr/lib/jvm/java-1.8.0\nexport PATH=$JAVA_HOME/bin/:$PATH\n\n# Switch to JDK 17\nexport JAVA_HOME=/usr/lib/jvm/jdk-17.0.2/\nexport PATH=$JAVA_HOME/bin/:$PATH\n"})}),"\n",(0,t.jsx)(n.h2,{id:"compile-doris",children:"Compile Doris"}),"\n",(0,t.jsx)(n.h3,{id:"1-download-doris-source-code",children:"1. Download Doris source code"}),"\n",(0,t.jsx)(n.p,{children:"Log in to the host machine and obtain the latest code from the Doris 2.0 branch via git clone."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-Plain",children:"$ git clone -b branch-2.0 https://github.com/apache/doris.git\n"})}),"\n",(0,t.jsx)(n.p,{children:'After downloading, assume that the source code path is in the "doris-branch-2.0" directory.'}),"\n",(0,t.jsx)(n.h3,{id:"2-run-build-image",children:"2. Run build image"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-Plain",children:"# Pre-build a Maven .m2 directory on the host machine to reuse the downloaded Java libraries in Docker.\nmkdir ~/.m2 \n\n# Run the build image\ndocker run -it --network=host --name mydocker -v ~/.m2:/root/.m2 -v ~/doris-branch-2.0:/root/doris-branch-2.0/ apache/doris:build-env-for-2.0  \n\n# After successful execution, it should be in the Docker.\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Note:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"It is recommended to run the image by mounting the local Doris source code directory. This way, the compiled binary files will be stored on the host machine and will not be lost when the container exits."}),"\n",(0,t.jsxs)(n.li,{children:["It is also recommended to mount the ",(0,t.jsx)(n.code,{children:".m2"})," directory of Maven in the image to a directory on the host machine. This prevents repeated downloads of Maven dependencies each time the image is started for compilation."]}),"\n",(0,t.jsxs)(n.li,{children:["When running the image for compilation, if there is a need to download additional files, it is suggested to use the host mode. The host mode does not require the use of ",(0,t.jsx)(n.code,{children:"-p"})," for port mapping and allows sharing the network IP and ports with the host machine."]}),"\n",(0,t.jsxs)(n.li,{children:["Below are explanations for some of the parameters used in the ",(0,t.jsx)(n.code,{children:"docker run"})," command:"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"-v"}),(0,t.jsx)(n.td,{children:"Mount a storage volume to a specific directory within a container."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"--name"}),(0,t.jsx)(n.td,{children:"Specify a name for the container to use the assigned name in future container management."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"--network"}),(0,t.jsx)(n.td,{children:'Container network settings: "bridge" uses the Docker daemon\'s specified bridge network, "host" allows the container to use the host\'s network, "container:NAME_or_ID" uses the network of another container by sharing IP and port resources, "none" enables the container to use its own network (similar to --net=bridge) without any additional configuration.'})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"3-execute-the-build",children:"3. Execute the build"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-Plain",children:"# By default, it builds the AVX2 version.\n$ sh build.sh\n\n# If you need the no AVX2 version, add USE_AVX2=0.\n$ USE_AVX2=0 sh build.sh\n\n# To compile a debug version of BE, add BUILD_TYPE=Debug.\n$ BUILD_TYPE=Debug sh build.sh\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"To check if the machine supports AVX2:"})}),(0,t.jsx)(n.p,{children:"$ cat /proc/cpuinfo | grep avx2"})]}),"\n",(0,t.jsxs)(n.p,{children:["After compilation, the output file is in the ",(0,t.jsx)(n.code,{children:"output/"})," directory."]}),"\n",(0,t.jsx)(n.h2,{id:"build-your-own-development-environment-image",children:"Build your own development environment image"}),"\n",(0,t.jsxs)(n.p,{children:["You can create a Doris development environment image by referring to the ",(0,t.jsx)(n.code,{children:"docker/README.md"})," file."]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return d},a:function(){return s}});var o=i(667294);let t={},r=o.createContext(t);function s(e){let n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);