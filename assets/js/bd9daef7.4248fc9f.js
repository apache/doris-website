"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["553596"],{320626:function(e,n,i){i.r(n),i.d(n,{default:()=>u,frontMatter:()=>o,metadata:()=>s,assets:()=>d,toc:()=>c,contentTitle:()=>t});var s=JSON.parse('{"id":"developer-guide/docker-dev","title":"Doris Docker quick build development environment","description":"\x3c!--","source":"@site/community/developer-guide/docker-dev.md","sourceDirName":"developer-guide","slug":"/developer-guide/docker-dev","permalink":"/community/developer-guide/docker-dev","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Doris Docker quick build development environment","language":"en"},"sidebar":"community","previous":{"title":"Debugging Tools","permalink":"/community/developer-guide/debug-tool"},"next":{"title":"Doris BE Storage Layer Benchmark Tool","permalink":"/community/developer-guide/benchmark-tool"}}'),l=i("785893"),r=i("250065");let o={title:"Doris Docker quick build development environment",language:"en"},t="Doris Docker quick build development environment",d={},c=[{value:"Related detailed document navigation",id:"related-detailed-document-navigation",level:2},{value:"Environment preparation",id:"environment-preparation",level:2},{value:"Build image",id:"build-image",level:2},{value:"Compile",id:"compile",level:2},{value:"Run",id:"run",level:2}];function a(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"doris-docker-quick-build-development-environment",children:"Doris Docker quick build development environment"})}),"\n",(0,l.jsx)(n.h2,{id:"related-detailed-document-navigation",children:"Related detailed document navigation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/install/source-install/compilation",children:"Developing mirror compilation using Docker"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/install/install-deploy",children:"Deploying Doris"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/community/developer-guide/be-vscode-dev",children:"VSCode Be Development Debugging"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"environment-preparation",children:"Environment preparation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Install Docker"}),"\n",(0,l.jsxs)(n.li,{children:["VSCode\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Remote plugin"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"build-image",children:"Build image"}),"\n",(0,l.jsx)(n.p,{children:"create dockerfile"}),"\n",(0,l.jsx)(n.p,{children:"VSCode replace all by using Ctrl-d"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"<!!! your user !!!>"}),"\n",(0,l.jsx)(n.li,{children:"<!!! your user password !!!>"}),"\n",(0,l.jsx)(n.li,{children:"<!!! root password !!!>"}),"\n",(0,l.jsx)(n.li,{children:"<!!! your git email !!!>"}),"\n",(0,l.jsx)(n.li,{children:"<!!! your git username !!!>"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:'FROM apache/incubator-doris:build-env-latest\n\nUSER root\nWORKDIR /root\nRUN echo \'<!!! root password !!!>\' | passwd root --stdin\n\nRUN yum install -y vim net-tools man wget git mysql lsof bash-completion \\\n        && cp /var/local/thirdparty/installed/bin/thrift /usr/bin\n\n# safer usage, create new user instead of using root\nRUN yum install -y sudo \\\n        && useradd -ms /bin/bash <!!! your user !!!> && echo <!!! your user password !!!> | passwd <!!! your user !!!> --stdin \\\n        && usermod -a -G wheel <!!! your user !!!>\n\nUSER <!!! your user !!!>\nWORKDIR /home/<!!! your user !!!>\nRUN git config --global color.ui true \\\n        && git config --global user.email "<!!! your git email !!!>" \\\n        && git config --global user.name "<!!! your git username !!!>"\n\n# install zsh and oh my zsh, easier to use on, you can remove it if you don\'t need it\nUSER root\nRUN yum install -y zsh \\\n        && chsh -s /bin/zsh <!!! your user !!!>\nUSER <!!! your user !!!>\nRUN wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | zsh \\\n        && git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions \\\n        && git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting\n'})}),"\n",(0,l.jsx)(n.p,{children:"run build command"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker build -t doris .\n"})}),"\n",(0,l.jsx)(n.p,{children:"run image"}),"\n",(0,l.jsxs)(n.p,{children:["note! ",(0,l.jsx)(n.a,{href:"/community/source-install/compilation-with-docker",children:"problems with mounting"}),"."]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"See the link above: It is recommended to run the image by mounting the local Doris source code directory as a volume ....."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"if you are developing on windows, mounting may cause cross-filesystem access problems, please consider setting it manually"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"--cap-add SYS_PTRACE"})," parameter allows dockers to use ptrace, making it easier for us to use ptrace and gdb remote debugging functions."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker run -it --cap-add SYS_PTRACE doris:latest /bin/bash\n"})}),"\n",(0,l.jsx)(n.p,{children:"if you installed zsh, replace plugins in ~/.zshrc after running the container"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"plugins=(git zsh-autosuggestions zsh-syntax-highlighting)\n"})}),"\n",(0,l.jsx)(n.p,{children:"create directory and download doris"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"su <your user>\nmkdir code && cd code\ngit clone https://github.com/apache/doris.git\ncd doris\ngit submodule update --init --recursive\n"})}),"\n",(0,l.jsx)(n.h2,{id:"compile",children:"Compile"}),"\n",(0,l.jsx)(n.p,{children:"Note:"}),"\n",(0,l.jsx)(n.p,{children:"use the following command first time compiling"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sh build.sh --clean --be --fe --ui\n"})}),"\n",(0,l.jsx)(n.p,{children:"it is because build-env-for-0.15.0 version image upgraded thrift(0.9 -> 0.13), so you need to use --clean command to force use new version of thrift to generate code files, otherwise it will cause incompatibilities."}),"\n",(0,l.jsx)(n.p,{children:"compile Doris"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sh build.sh\n"})}),"\n",(0,l.jsx)(n.h2,{id:"run",children:"Run"}),"\n",(0,l.jsxs)(n.p,{children:["manually create ",(0,l.jsx)(n.code,{children:"meta_dir"})," metadata storage location, default value is ",(0,l.jsx)(n.code,{children:"${DORIS_HOME}/doris-meta"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"mkdir meta_dir\n"})}),"\n",(0,l.jsx)(n.p,{children:"launch FE"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cd output/fe\nsh bin/start_fe.sh --daemon\n"})}),"\n",(0,l.jsx)(n.p,{children:"launch BE"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cd output/be\nsh bin/start_be.sh --daemon\n"})}),"\n",(0,l.jsx)(n.p,{children:"mysql-client connect"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"mysql -h 127.0.0.1 -P 9030 -u root\n"})})]})}function u(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return t},a:function(){return o}});var s=i(667294);let l={},r=s.createContext(l);function o(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);