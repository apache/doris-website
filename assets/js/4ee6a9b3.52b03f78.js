"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["97615"],{858128:function(n,e,i){i.r(e),i.d(e,{default:()=>h,frontMatter:()=>l,metadata:()=>s,assets:()=>a,toc:()=>d,contentTitle:()=>o});var s=JSON.parse('{"id":"query-data/udf/python-user-defined-function","title":"Python UDF, UDAF, UDWF, UDTF","description":"Python UDF provides users with an interface for writing UDFs in Python, facilitating the execution of custom functions using the Python language. Doris supports writing UDF, UDAF, and UDTF using Python. Unless otherwise specified, UDF is used to refer to all user-defined functions in the following text.","source":"@site/docs/query-data/udf/python-user-defined-function.md","sourceDirName":"query-data/udf","slug":"/query-data/udf/python-user-defined-function","permalink":"/docs/dev/query-data/udf/python-user-defined-function","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Python UDF, UDAF, UDWF, UDTF","language":"en","description":"Python UDF provides users with an interface for writing UDFs in Python, facilitating the execution of custom functions using the Python language. Doris supports writing UDF, UDAF, and UDTF using Python. Unless otherwise specified, UDF is used to refer to all user-defined functions in the following text."},"sidebar":"docs","previous":{"title":"Java UDF, UDAF, UDWF, UDTF","permalink":"/docs/dev/query-data/udf/java-user-defined-function"},"next":{"title":"Complex Type","permalink":"/docs/dev/query-data/complex-type"}}'),t=i("785893"),r=i("250065");let l={title:"Python UDF, UDAF, UDWF, UDTF",language:"en",description:"Python UDF provides users with an interface for writing UDFs in Python, facilitating the execution of custom functions using the Python language. Doris supports writing UDF, UDAF, and UDTF using Python. Unless otherwise specified, UDF is used to refer to all user-defined functions in the following text."},o=void 0,a={},d=[{value:"Python UDF",id:"python-udf",level:2},{value:"Creating Python UDF",id:"creating-python-udf",level:3},{value:"Inline Mode",id:"inline-mode",level:4},{value:"Module Mode",id:"module-mode",level:4},{value:"Dropping Python UDF",id:"dropping-python-udf",level:3},{value:"Parameter Description",id:"parameter-description",level:3},{value:"CREATE FUNCTION Parameters",id:"create-function-parameters",level:4},{value:"PROPERTIES Parameters",id:"properties-parameters",level:4},{value:"Runtime Version Description",id:"runtime-version-description",level:4},{value:"Data Type Mapping",id:"data-type-mapping",level:3},{value:"NULL Value Handling",id:"null-value-handling",level:4},{value:"Vectorized Mode",id:"vectorized-mode",level:3},{value:"Basic Examples",id:"basic-examples",level:4},{value:"Advantages of Vectorized Mode",id:"advantages-of-vectorized-mode",level:4},{value:"Using Vectorized Functions",id:"using-vectorized-functions",level:4},{value:"Complex Data Type Handling",id:"complex-data-type-handling",level:3},{value:"ARRAY Type",id:"array-type",level:4},{value:"MAP Type",id:"map-type",level:4},{value:"STRUCT Type",id:"struct-type",level:4},{value:"Practical Application Scenarios",id:"practical-application-scenarios",level:3},{value:"Scenario 1: Data Masking",id:"scenario-1-data-masking",level:4},{value:"Scenario 2: String Similarity Calculation",id:"scenario-2-string-similarity-calculation",level:4},{value:"Scenario 3: Date Calculation",id:"scenario-3-date-calculation",level:4},{value:"Scenario 4: ID Card Validation",id:"scenario-4-id-card-validation",level:4},{value:"Performance Optimization Recommendations",id:"performance-optimization-recommendations",level:3},{value:"1. Prefer Vectorized Mode",id:"1-prefer-vectorized-mode",level:4},{value:"2. Use Module Mode for Complex Logic Management",id:"2-use-module-mode-for-complex-logic-management",level:4},{value:"3. Avoid I/O Operations in Functions",id:"3-avoid-io-operations-in-functions",level:4},{value:"Limitations and Considerations",id:"limitations-and-considerations",level:3},{value:"1. Python Version Support",id:"1-python-version-support",level:4},{value:"2. Dependency Libraries",id:"2-dependency-libraries",level:4},{value:"3. Performance Considerations",id:"3-performance-considerations",level:4},{value:"4. Security",id:"4-security",level:4},{value:"5. Resource Limitations",id:"5-resource-limitations",level:4},{value:"Frequently Asked Questions (FAQ)",id:"frequently-asked-questions-faq",level:3},{value:"Q1: How to use third-party libraries in Python UDF?",id:"q1-how-to-use-third-party-libraries-in-python-udf",level:4},{value:"Q2: Does Python UDF support recursive functions?",id:"q2-does-python-udf-support-recursive-functions",level:4},{value:"Q3: How to debug Python UDF?",id:"q3-how-to-debug-python-udf",level:4},{value:"Q4: Does Python UDF support global variables?",id:"q4-does-python-udf-support-global-variables",level:4},{value:"Q5: How to update existing Python UDF?",id:"q5-how-to-update-existing-python-udf",level:4},{value:"Q6: Can Python UDF access external resources?",id:"q6-can-python-udf-access-external-resources",level:4},{value:"Python UDAF",id:"python-udaf",level:2},{value:"UDAF Basic Concepts",id:"udaf-basic-concepts",level:3},{value:"Lifecycle of Aggregate Functions",id:"lifecycle-of-aggregate-functions",level:4},{value:"Required Class Methods and Properties",id:"required-class-methods-and-properties",level:4},{value:"Basic Syntax",id:"basic-syntax",level:3},{value:"Creating Python UDAF",id:"creating-python-udaf",level:4},{value:"Inline Mode",id:"inline-mode-1",level:5},{value:"Module Mode",id:"module-mode-1",level:5},{value:"Dropping Python UDAF",id:"dropping-python-udaf",level:4},{value:"Parameter Description",id:"parameter-description-1",level:3},{value:"CREATE AGGREGATE FUNCTION Parameters",id:"create-aggregate-function-parameters",level:4},{value:"PROPERTIES Parameters",id:"properties-parameters-1",level:4},{value:"runtime_version Description",id:"runtime_version-description",level:4},{value:"Window Functions",id:"window-functions",level:3},{value:"Data Type Mapping",id:"data-type-mapping-1",level:3},{value:"NULL Value Handling",id:"null-value-handling-1",level:4},{value:"Practical Application Scenarios",id:"practical-application-scenarios-1",level:3},{value:"Scenario 1: Calculate Percentiles",id:"scenario-1-calculate-percentiles",level:4},{value:"Scenario 2: String Deduplication and Aggregation",id:"scenario-2-string-deduplication-and-aggregation",level:4},{value:"Scenario 3: Moving Average",id:"scenario-3-moving-average",level:4},{value:"Performance Optimization Recommendations",id:"performance-optimization-recommendations-1",level:3},{value:"1. Optimize State Object Size",id:"1-optimize-state-object-size",level:4},{value:"2. Reduce Object Creation",id:"2-reduce-object-creation",level:4},{value:"3. Simplify merge Logic",id:"3-simplify-merge-logic",level:4},{value:"4. Use Incremental Calculation",id:"4-use-incremental-calculation",level:4},{value:"5. Avoid Using External Resources",id:"5-avoid-using-external-resources",level:4},{value:"Limitations and Considerations",id:"limitations-and-considerations-1",level:3},{value:"1. Performance Considerations",id:"1-performance-considerations",level:4},{value:"2. State Serialization",id:"2-state-serialization",level:4},{value:"3. Memory Limitations",id:"3-memory-limitations",level:4},{value:"4. Function Naming",id:"4-function-naming",level:4},{value:"5. Environment Consistency",id:"5-environment-consistency",level:4},{value:"Frequently Asked Questions (FAQ)",id:"frequently-asked-questions-faq-1",level:3},{value:"Q1: What is the difference between UDAF and UDF?",id:"q1-what-is-the-difference-between-udaf-and-udf",level:4},{value:"Q2: What is the purpose of the aggregate_state property?",id:"q2-what-is-the-purpose-of-the-aggregate_state-property",level:4},{value:"Q3: Can UDAF be used in window functions?",id:"q3-can-udaf-be-used-in-window-functions",level:4},{value:"Q4: When is the merge method called?",id:"q4-when-is-the-merge-method-called",level:4},{value:"Python UDTF",id:"python-udtf",level:2},{value:"UDTF Basic Concepts",id:"udtf-basic-concepts",level:3},{value:"Execution Method of Table Functions",id:"execution-method-of-table-functions",level:4},{value:"Function Requirements",id:"function-requirements",level:4},{value:"Output Methods",id:"output-methods",level:4},{value:"Basic Syntax",id:"basic-syntax-1",level:3},{value:"Creating Python UDTF",id:"creating-python-udtf",level:4},{value:"Inline Mode",id:"inline-mode-2",level:5},{value:"Module Mode",id:"module-mode-2",level:5},{value:"Dropping Python UDTF",id:"dropping-python-udtf",level:4},{value:"Modifying Python UDTF",id:"modifying-python-udtf",level:4},{value:"Parameter Description",id:"parameter-description-2",level:3},{value:"CREATE TABLES FUNCTION Parameters",id:"create-tables-function-parameters",level:4},{value:"PROPERTIES Parameters",id:"properties-parameters-2",level:4},{value:"runtime_version Description",id:"runtime_version-description-1",level:4},{value:"Data Type Mapping",id:"data-type-mapping-2",level:3},{value:"NULL Value Handling",id:"null-value-handling-2",level:4},{value:"Practical Application Scenarios",id:"practical-application-scenarios-2",level:3},{value:"Scenario 1: CSV Data Parsing",id:"scenario-1-csv-data-parsing",level:4},{value:"Scenario 2: Date Range Generation",id:"scenario-2-date-range-generation",level:4},{value:"Scenario 3: Text Tokenization",id:"scenario-3-text-tokenization",level:4},{value:"Scenario 4: URL Parameter Parsing",id:"scenario-4-url-parameter-parsing",level:4},{value:"Scenario 5: IP Range Expansion",id:"scenario-5-ip-range-expansion",level:4},{value:"Performance Optimization Recommendations",id:"performance-optimization-recommendations-2",level:3},{value:"1. Control Output Row Count",id:"1-control-output-row-count",level:4},{value:"2. Avoid Duplicate Calculations",id:"2-avoid-duplicate-calculations",level:4},{value:"3. Use Generator Expressions",id:"3-use-generator-expressions",level:4},{value:"4. Avoid Accessing External Resources",id:"4-avoid-accessing-external-resources",level:4},{value:"Limitations and Considerations",id:"limitations-and-considerations-2",level:3},{value:"1. Stateless Limitation",id:"1-stateless-limitation",level:4},{value:"2. Performance Considerations",id:"2-performance-considerations",level:4},{value:"3. Fixed Output Type",id:"3-fixed-output-type",level:4},{value:"4. Function Naming",id:"4-function-naming-1",level:4},{value:"5. Environment Consistency",id:"5-environment-consistency-1",level:4},{value:"Frequently Asked Questions (FAQ)",id:"frequently-asked-questions-faq-2",level:3},{value:"Q1: What is the difference between UDTF and UDF?",id:"q1-what-is-the-difference-between-udtf-and-udf",level:4},{value:"Q2: How to output multiple columns?",id:"q2-how-to-output-multiple-columns",level:4},{value:"Q3: Why doesn&#39;t my UDTF produce output?",id:"q3-why-doesnt-my-udtf-produce-output",level:4},{value:"Q4: Can UDTF maintain state?",id:"q4-can-udtf-maintain-state",level:4},{value:"Q5: How to limit UDTF output row count?",id:"q5-how-to-limit-udtf-output-row-count",level:4},{value:"Q6: Are there limitations on UDTF output data types?",id:"q6-are-there-limitations-on-udtf-output-data-types",level:4},{value:"Q7: Can external resources be accessed in UDTF?",id:"q7-can-external-resources-be-accessed-in-udtf",level:4},{value:"Python UDF/UDAF/UDTF Environment Configuration and Multi-Version Management",id:"python-udfudafudtf-environment-configuration-and-multi-version-management",level:2},{value:"Python Environment Management",id:"python-environment-management",level:3},{value:"Installation and Usage of Third-Party Libraries",id:"installation-and-usage-of-third-party-libraries",level:3},{value:"Installation Steps",id:"installation-steps",level:4},{value:"BE Configuration Parameters",id:"be-configuration-parameters",level:3},{value:"Configuration Parameter Description",id:"configuration-parameter-description",level:4},{value:"Method 1: Using Conda to Manage Python Environment",id:"method-1-using-conda-to-manage-python-environment",level:3},{value:"1. Configure BE",id:"1-configure-be",level:4},{value:"2. Environment Search Rules",id:"2-environment-search-rules",level:4},{value:"3. Directory Structure Diagram",id:"3-directory-structure-diagram",level:4},{value:"4. Create Conda Environment",id:"4-create-conda-environment",level:4},{value:"5. Use in UDF",id:"5-use-in-udf",level:4},{value:"Method 2: Using Venv to Manage Python Environment",id:"method-2-using-venv-to-manage-python-environment",level:3},{value:"1. Configure BE",id:"1-configure-be-1",level:4},{value:"2. Configuration Parameter Description",id:"2-configuration-parameter-description",level:4},{value:"3. Directory Structure Diagram",id:"3-directory-structure-diagram-1",level:4},{value:"4. Create Venv Environment",id:"4-create-venv-environment",level:4},{value:"5. Use in UDF",id:"5-use-in-udf-1",level:4},{value:"Environment Management Best Practices",id:"environment-management-best-practices",level:3},{value:"1. Choose Appropriate Management Method",id:"1-choose-appropriate-management-method",level:4},{value:"2. Environment Consistency Requirements",id:"2-environment-consistency-requirements",level:4},{value:"Notes",id:"notes",level:3},{value:"1. Configuration Modification Takes Effect",id:"1-configuration-modification-takes-effect",level:4},{value:"2. Path Verification",id:"2-path-verification",level:4},{value:"3. Permission Settings",id:"3-permission-settings",level:4},{value:"4. Resource Limitations",id:"4-resource-limitations",level:4},{value:"Environment Verification",id:"environment-verification",level:3},{value:"Common Problem Troubleshooting",id:"common-problem-troubleshooting",level:3},{value:"Q1: UDF call prompts &quot;Python environment not found&quot;",id:"q1-udf-call-prompts-python-environment-not-found",level:4},{value:"Q2: UDF call prompts &quot;ModuleNotFoundError: No module named &#39;xxx&#39;&quot;",id:"q2-udf-call-prompts-modulenotfounderror-no-module-named-xxx",level:4},{value:"Q3: Execution results inconsistent across different BE nodes",id:"q3-execution-results-inconsistent-across-different-be-nodes",level:4},{value:"Q4: be.conf modification not effective",id:"q4-beconf-modification-not-effective",level:4},{value:"Usage Limitations",id:"usage-limitations",level:3}];function c(n){let e={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h2,{id:"python-udf",children:"Python UDF"}),"\n",(0,t.jsx)(e.p,{children:"Python UDF (User Defined Function) is a custom scalar function extension mechanism provided by Apache Doris, allowing users to write custom functions in Python for data querying and processing. Through Python UDF, users can flexibly implement complex business logic, handle various data types, and fully leverage Python's rich ecosystem of libraries."}),"\n",(0,t.jsx)(e.p,{children:"Python UDF supports two execution modes:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Scalar Mode"}),": Processes data row by row, suitable for simple transformations and calculations"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Vectorized Mode"}),": Processes data in batches, utilizing Pandas for high-performance computing"]}),"\n"]}),"\n",(0,t.jsxs)(e.admonition,{title:"Note",type:"tip",children:[(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Environment Dependencies"}),": Before using Python UDF, you must pre-install ",(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"pandas"})})," and ",(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"pyarrow"})})," libraries in the Python environment on all BE nodes. These are mandatory dependencies for Doris Python UDF functionality. See ",(0,t.jsx)(e.a,{href:"python-user-defined-function#python-udfudafudtf-environment-configuration-and-multi-version-management",children:"Python UDF Environment Configuration"}),"."]}),(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Log Path"}),": The Python UDF Server runtime log is located at ",(0,t.jsx)(e.code,{children:"output/be/log/python_udf_output.log"}),". Users can check the Python Server's operation status, function execution information, and debug errors in this log."]})]}),"\n",(0,t.jsx)(e.h3,{id:"creating-python-udf",children:"Creating Python UDF"}),"\n",(0,t.jsxs)(e.p,{children:["Python UDF supports two creation modes: ",(0,t.jsx)(e.code,{children:"Inline Mode"})," and ",(0,t.jsx)(e.code,{children:"Module Mode"}),"."]}),"\n",(0,t.jsx)(e.admonition,{title:"Note",type:"caution",children:(0,t.jsxs)(e.p,{children:["If both the ",(0,t.jsx)(e.code,{children:"file"})," parameter and ",(0,t.jsx)(e.code,{children:"AS $$"})," inline Python code are specified, Doris will prioritize loading the ",(0,t.jsx)(e.strong,{children:"inline Python code"})," and run the Python UDF in inline mode."]})}),"\n",(0,t.jsx)(e.h4,{id:"inline-mode",children:"Inline Mode"}),"\n",(0,t.jsx)(e.p,{children:"Inline mode allows writing Python code directly in SQL, suitable for simple function logic."}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Syntax"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'CREATE FUNCTION function_name(parameter_type1, parameter_type2, ...)\nRETURNS return_type\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "entry_function_name",\n    "runtime_version" = "python_version",\n    "always_nullable" = "true|false"\n)\nAS $$\ndef entry_function_name(param1, param2, ...):\n    # Python code here\n    return result\n$$;\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 1: Integer Addition"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_add(INT, INT);\n\nCREATE FUNCTION py_add(INT, INT)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12"\n)\nAS $$\ndef evaluate(a, b):\n    return a + b\n$$;\n\nSELECT py_add(10, 20) AS result; -- Result: 30\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 2: String Concatenation"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_concat(STRING, STRING);\n\nCREATE FUNCTION py_concat(STRING, STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12"\n)\nAS $$\ndef evaluate(s1, s2):\n    if s1 is None or s2 is None:\n        return None\n    return s1 + s2\n$$;\n\nSELECT py_concat(\'Hello\', \' World\') AS result; -- Result: Hello World\nSELECT py_concat(NULL, \' World\') AS result; -- Result: NULL\nSELECT py_concat(\'Hello\', NULL) AS result; -- Result: NULL\n'})}),"\n",(0,t.jsx)(e.h4,{id:"module-mode",children:"Module Mode"}),"\n",(0,t.jsxs)(e.p,{children:["Module mode is suitable for complex function logic, requiring Python code to be packaged into a ",(0,t.jsx)(e.code,{children:".zip"})," archive and referenced during function creation."]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 1: Write Python Module"})}),"\n",(0,t.jsxs)(e.p,{children:["Create ",(0,t.jsx)(e.code,{children:"python_udf_scalar_ops.py"})," file:"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'def add_three_numbers(a, b, c):\n    """Add three numbers"""\n    if a is None or b is None or c is None:\n        return None\n    return a + b + c\n\ndef reverse_string(s):\n    """Reverse a string"""\n    if s is None:\n        return None\n    return s[::-1]\n\ndef is_prime(n):\n    """Check if a number is prime"""\n    if n is None or n < 2:\n        return False\n    if n == 2:\n        return True\n    if n % 2 == 0:\n        return False\n    import math\n    for i in range(3, int(math.sqrt(n)) + 1, 2):\n        if n % i == 0:\n            return False\n    return True\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 2: Package Python Module"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Must"})," package Python files into ",(0,t.jsx)(e.code,{children:".zip"})," format (even for a single file):"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"zip python_udf_scalar_ops.zip python_udf_scalar_ops.py\n"})}),"\n",(0,t.jsx)(e.p,{children:"For multiple Python files:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"zip python_udf_scalar_ops.zip python_udf_scalar_ops.py utils.py helper.py ...\n"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 3: Set Python Module Archive Path"})}),"\n",(0,t.jsxs)(e.p,{children:["Python module archives support multiple deployment methods, specified through the ",(0,t.jsx)(e.code,{children:"file"})," parameter for the ",(0,t.jsx)(e.code,{children:".zip"})," package path:"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Method 1: Local Filesystem"})," (using ",(0,t.jsx)(e.code,{children:"file://"})," protocol)"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'"file" = "file:///path/to/python_udf_scalar_ops.zip"\n'})}),"\n",(0,t.jsxs)(e.p,{children:["Suitable for scenarios where the ",(0,t.jsx)(e.code,{children:".zip"})," package is stored on the BE node's local filesystem."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Method 2: HTTP/HTTPS Remote Download"})," (using ",(0,t.jsx)(e.code,{children:"http://"})," or ",(0,t.jsx)(e.code,{children:"https://"})," protocol)"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'"file" = "http://example.com/udf/python_udf_scalar_ops.zip"\n"file" = "https://s3.amazonaws.com/bucket/python_udf_scalar_ops.zip"\n'})}),"\n",(0,t.jsxs)(e.p,{children:["Suitable for scenarios where the ",(0,t.jsx)(e.code,{children:".zip"})," package is downloaded from object storage (such as S3, OSS, COS, etc.) or HTTP servers. Doris will automatically download and cache it locally."]}),"\n",(0,t.jsx)(e.admonition,{title:"Note",type:"caution",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"When using remote download method, ensure all BE nodes can access the URL"}),"\n",(0,t.jsx)(e.li,{children:"First call will download the file, which may have some delay"}),"\n",(0,t.jsx)(e.li,{children:"Files will be cached, subsequent calls do not need to download again"}),"\n"]})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 4: Set symbol Parameter"})}),"\n",(0,t.jsxs)(e.p,{children:["In module mode, the ",(0,t.jsx)(e.code,{children:"symbol"})," parameter is used to specify the function's location in the ZIP package, with the format:"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"[package_name.]module_name.func_name\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Parameter Description"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"package_name"})," (optional): Top-level Python package name in the ZIP archive. Can be omitted if the function is in the package's root module or if there is no package in the ZIP archive"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"module_name"})," (required): Python module filename containing the target function (without ",(0,t.jsx)(e.code,{children:".py"})," suffix)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"func_name"})," (required): User-defined function name"]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Parsing Rules"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Doris will split the ",(0,t.jsx)(e.code,{children:"symbol"})," string by ",(0,t.jsx)(e.code,{children:"."}),":\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["If ",(0,t.jsx)(e.strong,{children:"two"})," substrings are obtained, they are ",(0,t.jsx)(e.code,{children:"module_name"})," and ",(0,t.jsx)(e.code,{children:"func_name"})]}),"\n",(0,t.jsxs)(e.li,{children:["If ",(0,t.jsx)(e.strong,{children:"three or more"})," substrings are obtained, the beginning is ",(0,t.jsx)(e.code,{children:"package_name"}),", middle is ",(0,t.jsx)(e.code,{children:"module_name"}),", and end is ",(0,t.jsx)(e.code,{children:"func_name"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["The ",(0,t.jsx)(e.code,{children:"module_name"})," part is used as the module path for dynamic import via ",(0,t.jsx)(e.code,{children:"importlib"})]}),"\n",(0,t.jsxs)(e.li,{children:["If ",(0,t.jsx)(e.code,{children:"package_name"})," is specified, the entire path must form a valid Python import path, and the ZIP package structure must match this path"]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Example Illustrations"}),":"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example A: No Package Structure (Two-Part)"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'ZIP Structure:\nmath_ops.py\n\nsymbol = "math_ops.add"\n'})}),"\n",(0,t.jsxs)(e.p,{children:["Indicates that the function ",(0,t.jsx)(e.code,{children:"add"})," is defined in the ",(0,t.jsx)(e.code,{children:"math_ops.py"})," file at the root of the ZIP package."]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example B: Package Structure (Three-Part)"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'ZIP Structure:\nmylib/\n\u251C\u2500\u2500 __init__.py\n\u2514\u2500\u2500 string_helper.py\n\nsymbol = "mylib.string_helper.split_text"\n'})}),"\n",(0,t.jsxs)(e.p,{children:["Indicates that the function ",(0,t.jsx)(e.code,{children:"split_text"})," is defined in the ",(0,t.jsx)(e.code,{children:"mylib/string_helper.py"})," file, where:"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"package_name"})," = ",(0,t.jsx)(e.code,{children:"mylib"})]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"module_name"})," = ",(0,t.jsx)(e.code,{children:"string_helper"})]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"func_name"})," = ",(0,t.jsx)(e.code,{children:"split_text"})]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example C: Nested Package Structure (Four-Part)"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'ZIP Structure:\nmylib/\n\u251C\u2500\u2500 __init__.py\n\u2514\u2500\u2500 utils/\n    \u251C\u2500\u2500 __init__.py\n    \u2514\u2500\u2500 string_helper.py\n\nsymbol = "mylib.utils.string_helper.split_text"\n'})}),"\n",(0,t.jsxs)(e.p,{children:["Indicates that the function ",(0,t.jsx)(e.code,{children:"split_text"})," is defined in the ",(0,t.jsx)(e.code,{children:"mylib/utils/string_helper.py"})," file, where:"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"package_name"})," = ",(0,t.jsx)(e.code,{children:"mylib"})]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"module_name"})," = ",(0,t.jsx)(e.code,{children:"utils.string_helper"})]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"func_name"})," = ",(0,t.jsx)(e.code,{children:"split_text"})]}),"\n"]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Note"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["If the ",(0,t.jsx)(e.code,{children:"symbol"})," format is invalid (such as missing function name, empty module name, empty components in path, etc.), Doris will report an error during function invocation"]}),"\n",(0,t.jsxs)(e.li,{children:["The directory structure in the ZIP package must match the path specified by ",(0,t.jsx)(e.code,{children:"symbol"})]}),"\n",(0,t.jsxs)(e.li,{children:["Each package directory needs to contain an ",(0,t.jsx)(e.code,{children:"__init__.py"})," file (can be empty)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 5: Create UDF Function"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 1: Using Local Files (No Package Structure)"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_add_three(INT, INT, INT);\nDROP FUNCTION IF EXISTS py_reverse(STRING);\nDROP FUNCTION IF EXISTS py_is_prime(INT);\n\nCREATE FUNCTION py_add_three(INT, INT, INT)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.add_three_numbers",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE FUNCTION py_reverse(STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.reverse_string",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE FUNCTION py_is_prime(INT)\nRETURNS BOOLEAN\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.is_prime",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 2: Using HTTP/HTTPS Remote Files"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_add_three(INT, INT, INT);\nDROP FUNCTION IF EXISTS py_reverse(STRING);\nDROP FUNCTION IF EXISTS py_is_prime(INT);\n\nCREATE FUNCTION py_add_three(INT, INT, INT)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "https://your-storage.com/udf/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.add_three_numbers",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE FUNCTION py_reverse(STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "https://your-storage.com/udf/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.reverse_string",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE FUNCTION py_is_prime(INT)\nRETURNS BOOLEAN\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "https://your-storage.com/udf/python_udf_scalar_ops.zip",\n    "symbol" = "python_udf_scalar_ops.is_prime",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 3: Using Package Structure"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_multiply(INT);\n\n-- ZIP Structure: my_udf/__init__.py, my_udf/math_ops.py\nCREATE FUNCTION py_multiply(INT)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/my_udf.zip",\n    "symbol" = "my_udf.math_ops.multiply_by_two",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 6: Use Functions"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"SELECT py_add_three(10, 20, 30) AS sum_result; -- Result: 60\nSELECT py_reverse('hello') AS reversed; -- Result: olleh\nSELECT py_is_prime(17) AS is_prime; -- Result: true\n"})}),"\n",(0,t.jsx)(e.h3,{id:"dropping-python-udf",children:"Dropping Python UDF"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- Syntax\nDROP FUNCTION IF EXISTS function_name(parameter_type1, parameter_type2, ...);\n\n-- Examples\nDROP FUNCTION IF EXISTS py_add_three(INT, INT, INT);\nDROP FUNCTION IF EXISTS py_reverse(STRING);\nDROP FUNCTION IF EXISTS py_is_prime(INT);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"parameter-description",children:"Parameter Description"}),"\n",(0,t.jsx)(e.h4,{id:"create-function-parameters",children:"CREATE FUNCTION Parameters"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Parameter"}),(0,t.jsx)(e.th,{children:"Required"}),(0,t.jsx)(e.th,{children:"Description"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"function_name"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"Function name, must comply with identifier naming rules"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"parameter_type"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"Parameter type list, supports various Doris data types"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"return_type"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"Return value type"})]})]})]}),"\n",(0,t.jsx)(e.h4,{id:"properties-parameters",children:"PROPERTIES Parameters"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Parameter"}),(0,t.jsx)(e.th,{children:"Required"}),(0,t.jsx)(e.th,{children:"Default"}),(0,t.jsx)(e.th,{children:"Description"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"type"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Fixed as ",(0,t.jsx)(e.code,{children:'"PYTHON_UDF"'})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"symbol"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Python function entry name.",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.strong,{children:"Inline Mode"}),": Write function name directly, such as ",(0,t.jsx)(e.code,{children:'"evaluate"'}),(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.strong,{children:"Module Mode"}),": Format is ",(0,t.jsx)(e.code,{children:"[package_name.]module_name.func_name"}),", see module mode description"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"file"})}),(0,t.jsx)(e.td,{children:"No"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Python ",(0,t.jsx)(e.code,{children:".zip"})," package path, only required for module mode. Supports three protocols:",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.code,{children:"file://"})," - Local filesystem path",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.code,{children:"http://"})," - HTTP remote download",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.code,{children:"https://"})," - HTTPS remote download"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"runtime_version"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Python runtime version, such as ",(0,t.jsx)(e.code,{children:'"3.10.12"'}),", requires complete version number"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"always_nullable"})}),(0,t.jsx)(e.td,{children:"No"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"true"})}),(0,t.jsx)(e.td,{children:"Whether to always return nullable results"})]})]})]}),"\n",(0,t.jsx)(e.h4,{id:"runtime-version-description",children:"Runtime Version Description"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Supports Python 3.x versions"}),"\n",(0,t.jsxs)(e.li,{children:["Requires specifying complete version number (such as ",(0,t.jsx)(e.code,{children:'"3.10.12"'}),"), cannot use only major.minor version number (such as ",(0,t.jsx)(e.code,{children:'"3.10"'}),")"]}),"\n",(0,t.jsxs)(e.li,{children:["If ",(0,t.jsx)(e.code,{children:"runtime_version"})," is not specified, function invocation will report an error"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"data-type-mapping",children:"Data Type Mapping"}),"\n",(0,t.jsx)(e.p,{children:"The following table lists the mapping relationship between Doris data types and Python types:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Type Category"}),(0,t.jsx)(e.th,{children:"Doris Type"}),(0,t.jsx)(e.th,{children:"Python Type"}),(0,t.jsx)(e.th,{children:"Description"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Null Type"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"NULL"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"None"})}),(0,t.jsx)(e.td,{children:"Null value"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Boolean Type"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"BOOLEAN"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"bool"})}),(0,t.jsx)(e.td,{children:"Boolean value"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Integer Types"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"TINYINT"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"int"})}),(0,t.jsx)(e.td,{children:"8-bit integer"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"SMALLINT"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"int"})}),(0,t.jsx)(e.td,{children:"16-bit integer"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"INT"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"int"})}),(0,t.jsx)(e.td,{children:"32-bit integer"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"BIGINT"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"int"})}),(0,t.jsx)(e.td,{children:"64-bit integer"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"LARGEINT"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"int"})}),(0,t.jsx)(e.td,{children:"128-bit integer"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Floating Point Types"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"FLOAT"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"float"})}),(0,t.jsx)(e.td,{children:"32-bit floating point"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"DOUBLE"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"float"})}),(0,t.jsx)(e.td,{children:"64-bit floating point"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"TIME"})," / ",(0,t.jsx)(e.code,{children:"TIMEV2"})]}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"float"})}),(0,t.jsx)(e.td,{children:"Time type (as floating point)"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"String Types"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"CHAR"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"str"})}),(0,t.jsx)(e.td,{children:"Fixed-length string"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"VARCHAR"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"str"})}),(0,t.jsx)(e.td,{children:"Variable-length string"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"STRING"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"str"})}),(0,t.jsx)(e.td,{children:"String"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"JSONB"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"str"})}),(0,t.jsx)(e.td,{children:"JSON binary format (converted to string)"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"VARIANT"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"str"})}),(0,t.jsx)(e.td,{children:"Variant type (converted to string)"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"DATE"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"str"})}),(0,t.jsxs)(e.td,{children:["Date string, format ",(0,t.jsx)(e.code,{children:"'YYYY-MM-DD'"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"DATETIME"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"str"})}),(0,t.jsxs)(e.td,{children:["DateTime string, format ",(0,t.jsx)(e.code,{children:"'YYYY-MM-DD HH:MM:SS'"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Date/Time Types"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"DATEV2"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"datetime.date"})}),(0,t.jsx)(e.td,{children:"Date object"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"DATETIMEV2"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"datetime.datetime"})}),(0,t.jsx)(e.td,{children:"DateTime object"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Decimal Types"}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"DECIMAL"})," / ",(0,t.jsx)(e.code,{children:"DECIMALV2"})]}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"decimal.Decimal"})}),(0,t.jsx)(e.td,{children:"High-precision decimal"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"DECIMAL32"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"decimal.Decimal"})}),(0,t.jsx)(e.td,{children:"32-bit fixed-point number"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"DECIMAL64"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"decimal.Decimal"})}),(0,t.jsx)(e.td,{children:"64-bit fixed-point number"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"DECIMAL128"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"decimal.Decimal"})}),(0,t.jsx)(e.td,{children:"128-bit fixed-point number"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"DECIMAL256"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"decimal.Decimal"})}),(0,t.jsx)(e.td,{children:"256-bit fixed-point number"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"TIMESTAMPTZ"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"datetime.datetime"})}),(0,t.jsx)(e.td,{children:"DateTime object with time zone"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"IP Data Types"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"IPV4"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"ipaddress.IPv4Address"})}),(0,t.jsx)(e.td,{children:"IPv4 address"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"IPV6"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"ipaddress.IPv6Address"})}),(0,t.jsx)(e.td,{children:"IPv6 address"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Binary Types"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"BITMAP"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"bytes"})}),(0,t.jsx)(e.td,{children:"Bitmap data (currently not supported)"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"HLL"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"bytes"})}),(0,t.jsx)(e.td,{children:"HyperLogLog data (currently not supported)"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"QUANTILE_STATE"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"bytes"})}),(0,t.jsx)(e.td,{children:"Quantile state data (currently not supported)"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Complex Data Types"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"ARRAY<T>"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"list"})}),(0,t.jsx)(e.td,{children:"Array, element type T"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"MAP<K,V>"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"dict"})}),(0,t.jsx)(e.td,{children:"Dictionary, key type K, value type V"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"STRUCT<f1:T1, f2:T2, ...>"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"dict"})}),(0,t.jsx)(e.td,{children:"Struct, field names as keys, field values as values"})]})]})]}),"\n",(0,t.jsx)(e.h4,{id:"null-value-handling",children:"NULL Value Handling"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Doris ",(0,t.jsx)(e.code,{children:"NULL"})," values are mapped to ",(0,t.jsx)(e.code,{children:"None"})," in Python"]}),"\n",(0,t.jsxs)(e.li,{children:["If a function parameter is ",(0,t.jsx)(e.code,{children:"NULL"}),", Python function receives ",(0,t.jsx)(e.code,{children:"None"})]}),"\n",(0,t.jsxs)(e.li,{children:["If Python function returns ",(0,t.jsx)(e.code,{children:"None"}),", Doris treats it as ",(0,t.jsx)(e.code,{children:"NULL"})]}),"\n",(0,t.jsxs)(e.li,{children:["Recommend explicitly handling ",(0,t.jsx)(e.code,{children:"None"})," values in functions to avoid runtime errors"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"Example:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_safe_divide(DOUBLE, DOUBLE);\n\nCREATE FUNCTION py_safe_divide(DOUBLE, DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(a, b):\n    if a is None or b is None:\n        return None\n    if b == 0:\n        return None\n    return a / b\n$$;\n\nSELECT py_safe_divide(10.0, 2.0);   -- Result: 5.0\nSELECT py_safe_divide(10.0, 0.0);   -- Result: NULL\nSELECT py_safe_divide(10.0, NULL);  -- Result: NULL\n'})}),"\n",(0,t.jsx)(e.h3,{id:"vectorized-mode",children:"Vectorized Mode"}),"\n",(0,t.jsxs)(e.p,{children:["Vectorized mode uses Pandas for batch data processing, offering better performance than scalar mode. In vectorized mode, function parameters are ",(0,t.jsx)(e.code,{children:"pandas.Series"})," objects, and return values should also be ",(0,t.jsx)(e.code,{children:"pandas.Series"}),"."]}),"\n",(0,t.jsx)(e.admonition,{title:"Note",type:"caution",children:(0,t.jsxs)(e.p,{children:["To ensure the system correctly recognizes vectorized mode, please use type annotations in function signatures (such as ",(0,t.jsx)(e.code,{children:"a: pd.Series"}),") and directly operate on batch data structures in function logic. If vectorized types are not explicitly used, the system will fall back to Scalar Mode."]})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"## Vectorized Mode\ndef add(a: pd.Series, b: pd.Series) -> pd.Series:\n    return a + b + 1\n\n## Scalar Mode\ndef add(a, b):\n    return a + b + 1\n"})}),"\n",(0,t.jsx)(e.h4,{id:"basic-examples",children:"Basic Examples"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 1: Vectorized Integer Addition"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_vec_add(INT, INT);\n\nCREATE FUNCTION py_vec_add(INT, INT)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "add",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nimport pandas as pd\n\ndef add(a: pd.Series, b: pd.Series) -> pd.Series:\n    return a + b + 1\n$$;\n\nSELECT py_vec_add(1, 2); -- Result: 4\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 2: Vectorized String Processing"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_vec_upper(STRING);\n\nCREATE FUNCTION py_vec_upper(STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "to_upper",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nimport pandas as pd\n\ndef to_upper(s: pd.Series) -> pd.Series:\n    return s.str.upper()\n$$;\n\nSELECT py_vec_upper(\'hello\'); -- Result: \'HELLO\'\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 3: Vectorized Mathematical Operations"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_vec_sqrt(DOUBLE);\n\nCREATE FUNCTION py_vec_sqrt(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "sqrt",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nimport pandas as pd\nimport numpy as np\n\ndef sqrt(x: pd.Series) -> pd.Series:\n    return np.sqrt(x)\n$$;\n\nSELECT py_vec_sqrt(16); -- Result: 4.0\n'})}),"\n",(0,t.jsx)(e.h4,{id:"advantages-of-vectorized-mode",children:"Advantages of Vectorized Mode"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Performance Optimization"}),": Batch processing reduces interaction frequency between Python and Doris"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Leverage Pandas/NumPy"}),": Fully utilize vectorized computing performance advantages"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Concise Code"}),": Pandas API allows more concise expression of complex logic"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"using-vectorized-functions",children:"Using Vectorized Functions"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"DROP TABLE IF EXISTS test_table;\n\nCREATE TABLE test_table (\n    id INT,\n    value INT,\n    text STRING,\n    score DOUBLE\n) ENGINE=OLAP\nDUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO test_table VALUES\n(1, 10, 'hello', 85.5),\n(2, 20, 'world', 92.0),\n(3, 30, 'python', 78.3);\n\nSELECT \n    id,\n    py_vec_add(value, value) AS sum_result,\n    py_vec_upper(text) AS upper_text,\n    py_vec_sqrt(score) AS sqrt_score\nFROM test_table;\n\n+------+------------+------------+-------------------+\n| id   | sum_result | upper_text | sqrt_score        |\n+------+------------+------------+-------------------+\n|    1 |         21 | HELLO      | 9.246621004453464 |\n|    2 |         41 | WORLD      | 9.591663046625438 |\n|    3 |         61 | PYTHON     | 8.848728722251575 |\n+------+------------+------------+-------------------+\n"})}),"\n",(0,t.jsx)(e.h3,{id:"complex-data-type-handling",children:"Complex Data Type Handling"}),"\n",(0,t.jsx)(e.h4,{id:"array-type",children:"ARRAY Type"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example: Array Element Sum"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_array_sum(ARRAY<INT>);\n\nCREATE FUNCTION py_array_sum(ARRAY<INT>)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(arr):\n    """ ARRAY type in Doris corresponds to list in Python """\n    if arr is None:\n        return None\n    return sum(arr)\n$$;\n\nSELECT py_array_sum([1, 2, 3, 4, 5]) AS result; -- Result: 15\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example: Array Filtering"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_array_filter_positive(ARRAY<INT>);\n\nCREATE FUNCTION py_array_filter_positive(ARRAY<INT>)\nRETURNS ARRAY<INT>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(arr):\n    if arr is None:\n        return None\n    return [x for x in arr if x > 0]\n$$;\n\nSELECT py_array_filter_positive([1, -2, 3, -4, 5]) AS result; -- Result: [1, 3, 5]\n'})}),"\n",(0,t.jsx)(e.h4,{id:"map-type",children:"MAP Type"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example: Get MAP Key Count"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_map_size(MAP<STRING, INT>);\n\nCREATE FUNCTION py_map_size(MAP<STRING, INT>)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(m):\n    """ MAP type in Doris corresponds to dict in Python """\n    if m is None:\n        return None\n    return len(m)\n$$;\n\nSELECT py_map_size({\'a\': 1, \'b\': 2, \'c\': 3}) AS result; -- Result: 3\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example: Get MAP Value"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_map_get(MAP<STRING, STRING>, STRING);\n\nCREATE FUNCTION py_map_get(MAP<STRING, STRING>, STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(m, key):\n    if m is None or key is None:\n        return None\n    return m.get(key)\n$$;\n\nSELECT py_map_get({\'name\': \'Alice\', \'age\': \'30\'}, \'name\') AS result; -- Result: Alice\n'})}),"\n",(0,t.jsx)(e.h4,{id:"struct-type",children:"STRUCT Type"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example: Access STRUCT Field"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_struct_get_name(STRUCT<name: STRING, age: INT>);\n\nCREATE FUNCTION py_struct_get_name(STRUCT<name: STRING, age: INT>)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(s):\n    """ STRUCT type in Doris corresponds to dict in Python """\n    if s is None:\n        return None\n    return s.get(\'name\')\n$$;\n\nSELECT py_struct_get_name({\'Alice\', 30}) AS result; -- Result: Alice\n'})}),"\n",(0,t.jsx)(e.h3,{id:"practical-application-scenarios",children:"Practical Application Scenarios"}),"\n",(0,t.jsx)(e.h4,{id:"scenario-1-data-masking",children:"Scenario 1: Data Masking"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_mask_email(STRING);\n\nCREATE FUNCTION py_mask_email(STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12"\n)\nAS $$\ndef evaluate(email):\n    if email is None or \'@\' not in email:\n        return None\n    parts = email.split(\'@\')\n    if len(parts[0]) <= 1:\n        return email\n    masked_user = parts[0][0] + \'***\'\n    return f"{masked_user}@{parts[1]}"\n$$;\n\nSELECT py_mask_email(\'user@example.com\') AS masked; -- Result: u***@example.com\n'})}),"\n",(0,t.jsx)(e.h4,{id:"scenario-2-string-similarity-calculation",children:"Scenario 2: String Similarity Calculation"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_levenshtein_distance(STRING, STRING);\n\nCREATE FUNCTION py_levenshtein_distance(STRING, STRING)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12"\n)\nAS $$\ndef evaluate(s1, s2):\n    if s1 is None or s2 is None:\n        return None\n    if len(s1) < len(s2):\n        return evaluate(s2, s1)\n    if len(s2) == 0:\n        return len(s1)\n    \n    previous_row = range(len(s2) + 1)\n    for i, c1 in enumerate(s1):\n        current_row = [i + 1]\n        for j, c2 in enumerate(s2):\n            insertions = previous_row[j + 1] + 1\n            deletions = current_row[j] + 1\n            substitutions = previous_row[j] + (c1 != c2)\n            current_row.append(min(insertions, deletions, substitutions))\n        previous_row = current_row\n    \n    return previous_row[-1]\n$$;\n\nSELECT py_levenshtein_distance(\'kitten\', \'sitting\') AS distance; -- Result: 3\n'})}),"\n",(0,t.jsx)(e.h4,{id:"scenario-3-date-calculation",children:"Scenario 3: Date Calculation"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_days_between(DATE, DATE);\n\nCREATE FUNCTION py_days_between(DATE, DATE)\nRETURNS INT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.10.12"\n)\nAS $$\nfrom datetime import datetime\n\ndef evaluate(date1_str, date2_str):\n    if date1_str is None or date2_str is None:\n        return None\n    try:\n        d1 = datetime.strptime(str(date1_str), \'%Y-%m-%d\')\n        d2 = datetime.strptime(str(date2_str), \'%Y-%m-%d\')\n        return abs((d2 - d1).days)\n    except:\n        return None\n$$;\n\nSELECT py_days_between(\'2024-01-01\', \'2024-12-31\') AS days; -- Result: 365\n'})}),"\n",(0,t.jsx)(e.h4,{id:"scenario-4-id-card-validation",children:"Scenario 4: ID Card Validation"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS py_validate_id_card(STRING);\n\nCREATE FUNCTION py_validate_id_card(STRING)\nRETURNS BOOLEAN\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"evaluate\",\n    \"runtime_version\" = \"3.10.12\"\n)\nAS $$\ndef evaluate(id_card):\n    if id_card is None or len(id_card) != 18:\n        return False\n    \n    # Validate first 17 digits are numeric\n    if not id_card[:17].isdigit():\n        return False\n    \n    # Check code weights\n    weights = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2]\n    check_codes = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2']\n    \n    # Calculate check code\n    total = sum(int(id_card[i]) * weights[i] for i in range(17))\n    check_code = check_codes[total % 11]\n    \n    return id_card[17].upper() == check_code\n$$;\n\nSELECT py_validate_id_card('11010519491231002X') AS is_valid; -- Result: True\n\nSELECT py_validate_id_card('110105194912310021x') AS is_valid; -- Result: False\n"})}),"\n",(0,t.jsx)(e.h3,{id:"performance-optimization-recommendations",children:"Performance Optimization Recommendations"}),"\n",(0,t.jsx)(e.h4,{id:"1-prefer-vectorized-mode",children:"1. Prefer Vectorized Mode"}),"\n",(0,t.jsx)(e.p,{children:"Vectorized mode significantly outperforms scalar mode:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"# Scalar Mode - Process row by row\ndef scalar_process(x):\n    return x * 2\n\n# Vectorized Mode - Batch processing\nimport pandas as pd\ndef vector_process(x: pd.Series) -> pd.Series:\n    return x * 2\n"})}),"\n",(0,t.jsx)(e.h4,{id:"2-use-module-mode-for-complex-logic-management",children:"2. Use Module Mode for Complex Logic Management"}),"\n",(0,t.jsx)(e.p,{children:"Place complex function logic in separate Python files for easier maintenance and reuse."}),"\n",(0,t.jsx)(e.h4,{id:"3-avoid-io-operations-in-functions",children:"3. Avoid I/O Operations in Functions"}),"\n",(0,t.jsx)(e.p,{children:"Not recommended to perform file read/write, network requests, and other I/O operations in UDF, which will seriously impact performance."}),"\n",(0,t.jsx)(e.h3,{id:"limitations-and-considerations",children:"Limitations and Considerations"}),"\n",(0,t.jsx)(e.h4,{id:"1-python-version-support",children:"1. Python Version Support"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Only supports Python 3.x versions"}),"\n",(0,t.jsx)(e.li,{children:"Recommend using Python 3.10 or higher"}),"\n",(0,t.jsx)(e.li,{children:"Ensure Doris cluster has the corresponding Python runtime installed"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"2-dependency-libraries",children:"2. Dependency Libraries"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Built-in support for Python standard library"}),"\n",(0,t.jsx)(e.li,{children:"Third-party libraries need to be pre-installed in the cluster environment"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"3-performance-considerations",children:"3. Performance Considerations"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Python UDF performance is lower than Doris built-in functions (C++ implementation)"}),"\n",(0,t.jsx)(e.li,{children:"For performance-sensitive scenarios, prioritize Doris built-in functions"}),"\n",(0,t.jsx)(e.li,{children:"Large data volume scenarios recommend using vectorized mode"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"4-security",children:"4. Security"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"UDF code executes in Doris processes, must ensure code is safe and trusted"}),"\n",(0,t.jsx)(e.li,{children:"Avoid dangerous operations in UDF (such as system commands, file deletion, etc.)"}),"\n",(0,t.jsx)(e.li,{children:"Production environments recommend auditing UDF code"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"5-resource-limitations",children:"5. Resource Limitations"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"UDF execution occupies BE node CPU and memory resources"}),"\n",(0,t.jsx)(e.li,{children:"Heavy UDF usage may impact overall cluster performance"}),"\n",(0,t.jsx)(e.li,{children:"Recommend monitoring UDF resource consumption"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"frequently-asked-questions-faq",children:"Frequently Asked Questions (FAQ)"}),"\n",(0,t.jsx)(e.h4,{id:"q1-how-to-use-third-party-libraries-in-python-udf",children:"Q1: How to use third-party libraries in Python UDF?"}),"\n",(0,t.jsx)(e.p,{children:"A: Need to install corresponding Python libraries on all BE nodes. For example:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"pip3 install numpy pandas\nconda install numpy pandas\n"})}),"\n",(0,t.jsx)(e.h4,{id:"q2-does-python-udf-support-recursive-functions",children:"Q2: Does Python UDF support recursive functions?"}),"\n",(0,t.jsx)(e.p,{children:"A: Yes, but need to pay attention to recursion depth to avoid stack overflow."}),"\n",(0,t.jsx)(e.h4,{id:"q3-how-to-debug-python-udf",children:"Q3: How to debug Python UDF?"}),"\n",(0,t.jsx)(e.p,{children:"A: Can debug function logic in local Python environment first, ensure correctness before creating UDF. Can check BE logs for error information."}),"\n",(0,t.jsx)(e.h4,{id:"q4-does-python-udf-support-global-variables",children:"Q4: Does Python UDF support global variables?"}),"\n",(0,t.jsx)(e.p,{children:"A: Yes, but not recommended, because global variable behavior in distributed environments may not meet expectations."}),"\n",(0,t.jsx)(e.h4,{id:"q5-how-to-update-existing-python-udf",children:"Q5: How to update existing Python UDF?"}),"\n",(0,t.jsx)(e.p,{children:"A: Delete old UDF first, then create new one:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS function_name(parameter_types);\nCREATE FUNCTION function_name(...) ...;\n"})}),"\n",(0,t.jsx)(e.h4,{id:"q6-can-python-udf-access-external-resources",children:"Q6: Can Python UDF access external resources?"}),"\n",(0,t.jsxs)(e.p,{children:["A: Technically possible, but ",(0,t.jsx)(e.strong,{children:"strongly not recommended"}),". Python UDF can use network request libraries (such as ",(0,t.jsx)(e.code,{children:"requests"}),") to access external APIs, databases, etc., but this will seriously impact performance and stability. Reasons include:"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Network latency will slow down queries"}),"\n",(0,t.jsx)(e.li,{children:"External service unavailability will cause UDF failure"}),"\n",(0,t.jsx)(e.li,{children:"Large concurrent requests may cause external service pressure"}),"\n",(0,t.jsx)(e.li,{children:"Difficult to control timeout and error handling"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"python-udaf",children:"Python UDAF"}),"\n",(0,t.jsx)(e.p,{children:"Python UDAF (User Defined Aggregate Function) is a custom aggregate function extension mechanism provided by Apache Doris, allowing users to write custom aggregate functions in Python for data grouping aggregation and window calculations. Through Python UDAF, users can flexibly implement complex aggregation logic such as statistical analysis, data collection, custom metric calculations, etc."}),"\n",(0,t.jsx)(e.p,{children:"Core features of Python UDAF:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Distributed Aggregation"}),": Supports data aggregation in distributed environments, automatically handling data partitioning, merging, and final computation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"State Management"}),": Maintains aggregation state through class instances, supporting complex state objects"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Window Function Support"}),": Can be used with window functions (OVER clause) to implement advanced features like moving aggregations, ranking, etc."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"High Flexibility"}),": Can implement arbitrarily complex aggregation logic without being limited by built-in aggregate functions"]}),"\n"]}),"\n",(0,t.jsxs)(e.admonition,{title:"Note",type:"tip",children:[(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Environment Dependencies"}),": Before using Python UDAF, you must pre-install ",(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"pandas"})})," and ",(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"pyarrow"})})," libraries in the Python environment on all BE nodes. These are mandatory dependencies for Doris Python UDAF functionality. See ",(0,t.jsx)(e.a,{href:"python-user-defined-function#python-udfudafudtf-environment-configuration-and-multi-version-management",children:"Python UDAF Environment Configuration"}),"."]}),(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Log Path"}),": The Python UDAF Server runtime log is located at ",(0,t.jsx)(e.code,{children:"output/be/log/python_udf_output.log"}),". Users can check the Python Server's operation status, aggregate function execution information, and debug errors in this log."]})]}),"\n",(0,t.jsx)(e.h3,{id:"udaf-basic-concepts",children:"UDAF Basic Concepts"}),"\n",(0,t.jsx)(e.h4,{id:"lifecycle-of-aggregate-functions",children:"Lifecycle of Aggregate Functions"}),"\n",(0,t.jsx)(e.p,{children:"Python UDAF is implemented through classes, and the execution of an aggregate function includes the following stages:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsxs)(e.strong,{children:["Initialization (",(0,t.jsx)(e.strong,{children:"init"}),")"]}),": Creates aggregation state object, initializes state variables"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Accumulation (accumulate)"}),": Processes single row data, updates aggregation state"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Merging (merge)"}),": Merges aggregation states from multiple partitions (distributed scenario)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Completion (finish)"}),": Computes and returns final aggregation result"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"required-class-methods-and-properties",children:"Required Class Methods and Properties"}),"\n",(0,t.jsx)(e.p,{children:"A complete Python UDAF class must implement the following methods:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Method/Property"}),(0,t.jsx)(e.th,{children:"Description"}),(0,t.jsx)(e.th,{children:"Required"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"__init__(self)"})}),(0,t.jsx)(e.td,{children:"Initialize aggregation state"}),(0,t.jsx)(e.td,{children:"Yes"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"accumulate(self, *args)"})}),(0,t.jsx)(e.td,{children:"Accumulate single row data"}),(0,t.jsx)(e.td,{children:"Yes"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"merge(self, other_state)"})}),(0,t.jsx)(e.td,{children:"Merge states from other partitions"}),(0,t.jsx)(e.td,{children:"Yes"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"finish(self)"})}),(0,t.jsx)(e.td,{children:"Return final aggregation result"}),(0,t.jsx)(e.td,{children:"Yes"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"aggregate_state"})," (property)"]}),(0,t.jsxs)(e.td,{children:["Return serializable aggregation state, ",(0,t.jsx)(e.strong,{children:"must support pickle serialization"})]}),(0,t.jsx)(e.td,{children:"Yes"})]})]})]}),"\n",(0,t.jsx)(e.h3,{id:"basic-syntax",children:"Basic Syntax"}),"\n",(0,t.jsx)(e.h4,{id:"creating-python-udaf",children:"Creating Python UDAF"}),"\n",(0,t.jsxs)(e.p,{children:["Python UDAF supports two creation modes: ",(0,t.jsx)(e.code,{children:"Inline Mode"})," and ",(0,t.jsx)(e.code,{children:"Module Mode"}),"."]}),"\n",(0,t.jsx)(e.admonition,{title:"Note",type:"tip",children:(0,t.jsxs)(e.p,{children:["If both the ",(0,t.jsx)(e.code,{children:"file"})," parameter and ",(0,t.jsx)(e.code,{children:"AS $$"})," inline Python code are specified, Doris will ",(0,t.jsx)(e.strong,{children:"prioritize loading inline Python code"})," and run the Python UDAF in inline mode."]})}),"\n",(0,t.jsx)(e.h5,{id:"inline-mode-1",children:"Inline Mode"}),"\n",(0,t.jsx)(e.p,{children:"Inline mode allows writing Python classes directly in SQL, suitable for simple aggregation logic."}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Syntax"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'CREATE AGGREGATE FUNCTION function_name(parameter_type1, parameter_type2, ...)\nRETURNS return_type\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "ClassName",\n    "runtime_version" = "python_version",\n    "always_nullable" = "true|false"\n)\nAS $$\nclass ClassName:\n    def __init__(self):\n        # Initialize state variables\n        \n    @property\n    def aggregate_state(self):\n        # Return serializable state\n        \n    def accumulate(self, *args):\n        # Accumulate data\n        \n    def merge(self, other_state):\n        # Merge state\n        \n    def finish(self):\n        # Return final result\n$$;\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 1: Sum Aggregation"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP TABLE IF EXISTS sales;\n\nCREATE TABLE IF NOT EXISTS sales (\n    id INT,\n    category VARCHAR(50),\n    amount INT\n) DUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 1\nPROPERTIES("replication_num" = "1");\n\nINSERT INTO sales VALUES \n(1, \'Electronics\', 1000),\n(2, \'Electronics\', 1500),\n(3, \'Books\', 200),\n(4, \'Books\', 300),\n(5, \'Clothing\', 500),\n(6, \'Clothing\', 800),\n(7, \'Electronics\', 2000),\n(8, \'Books\', 150);\n\nDROP FUNCTION IF EXISTS py_sum(INT);\n\nCREATE AGGREGATE FUNCTION py_sum(INT)\nRETURNS BIGINT\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "SumUDAF",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nclass SumUDAF:\n    def __init__(self):\n        self.total = 0\n    \n    @property\n    def aggregate_state(self):\n        return self.total\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.total += value\n    \n    def merge(self, other_state):\n        self.total += other_state\n    \n    def finish(self):\n        return self.total\n$$;\n\nSELECT category, py_sum(amount) as total_amount\nFROM sales\nGROUP BY category\nORDER BY category;\n\n+-------------+--------------+\n| category    | total_amount |\n+-------------+--------------+\n| Books       |          650 |\n| Clothing    |         1300 |\n| Electronics |         4500 |\n+-------------+--------------+\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 2: Average Aggregation"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"DROP TABLE IF EXISTS employees;\n\nCREATE TABLE IF NOT EXISTS employees (\n    id INT,\n    name VARCHAR(100),\n    department VARCHAR(50),\n    salary DOUBLE\n) DUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO employees VALUES \n(1, 'Alice', 'Engineering', 80000.0),\n(2, 'Bob', 'Engineering', 90000.0),\n(3, 'Charlie', 'Sales', 60000.0),\n(4, 'David', 'Sales', 80000.0),\n(5, 'Eve', 'HR', 50000.0),\n(6, 'Frank', 'Engineering', 70000.0),\n(7, 'Grace', 'HR', 70000.0);\n\nDROP FUNCTION IF EXISTS py_avg(DOUBLE);\n\nCREATE AGGREGATE FUNCTION py_avg(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"AvgUDAF\",\n    \"runtime_version\" = \"3.10.12\",\n    \"always_nullable\" = \"true\"\n)\nAS $$\nclass AvgUDAF:\n    def __init__(self):\n        self.sum = 0.0\n        self.count = 0\n    \n    @property\n    def aggregate_state(self):\n        return (self.sum, self.count)\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.sum += value\n            self.count += 1\n    \n    def merge(self, other_state):\n        other_sum, other_count = other_state\n        self.sum += other_sum\n        self.count += other_count\n    \n    def finish(self):\n        if self.count == 0:\n            return None\n        return self.sum / self.count\n$$;\n\nSELECT department, py_avg(salary) as avg_salary\nFROM employees\nGROUP BY department\nORDER BY department;\n\n+-------------+------------+\n| department  | avg_salary |\n+-------------+------------+\n| Engineering |      80000 |\n| HR          |      60000 |\n| Sales       |      70000 |\n+-------------+------------+\n"})}),"\n",(0,t.jsx)(e.h5,{id:"module-mode-1",children:"Module Mode"}),"\n",(0,t.jsxs)(e.p,{children:["Module mode is suitable for complex aggregation logic, requiring Python code to be packaged into a ",(0,t.jsx)(e.code,{children:".zip"})," archive and referenced during function creation."]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 1: Write Python Module"})}),"\n",(0,t.jsxs)(e.p,{children:["Create ",(0,t.jsx)(e.code,{children:"stats_udaf.py"})," file:"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'import math\n\nclass VarianceUDAF:\n    """Calculate population variance"""\n    \n    def __init__(self):\n        self.count = 0\n        self.sum_val = 0.0\n        self.sum_sq = 0.0\n    \n    @property\n    def aggregate_state(self):\n        return (self.count, self.sum_val, self.sum_sq)\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.count += 1\n            self.sum_val += value\n            self.sum_sq += value * value\n    \n    def merge(self, other_state):\n        other_count,  other_sum,  other_sum_sq = other_state\n        self.count += other_count\n        self.sum_val += other_sum\n        self.sum_sq += other_sum_sq\n    \n    def finish(self):\n        if self.count == 0:\n            return None\n        mean = self.sum_val / self.count\n        variance = (self.sum_sq / self.count) - (mean * mean)\n        return variance\n\n\nclass StdDevUDAF:\n    """Calculate population standard deviation"""\n    \n    def __init__(self):\n        self.count = 0\n        self.sum_val = 0.0\n        self.sum_sq = 0.0\n    \n    @property\n    def aggregate_state(self):\n        return (self.count, self.sum_val, self.sum_sq)\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.count += 1\n            self.sum_val += value\n            self.sum_sq += value * value\n    \n    def merge(self, other_state):\n        other_count, other_sum, other_sum_sq = other_state\n        self.count += other_count\n        self.sum_val += other_sum\n        self.sum_sq += other_sum_sq\n    \n    def finish(self):\n        if self.count == 0:\n            return None\n        mean = self.sum_val / self.count\n        variance = (self.sum_sq / self.count) - (mean * mean)\n        return math.sqrt(max(0, variance))\n\n\nclass MedianUDAF:\n    """Calculate median"""\n    \n    def __init__(self):\n        self.values = []\n    \n    @property\n    def aggregate_state(self):\n        return self.values\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.values.append(value)\n    \n    def merge(self, other_state):\n        if other_state:\n            self.values.extend(other_state)\n    \n    def finish(self):\n        if not self.values:\n            return None\n        sorted_vals = sorted(self.values)\n        n = len(sorted_vals)\n        if n % 2 == 0:\n            return (sorted_vals[n//2 - 1] + sorted_vals[n//2]) / 2.0\n        else:\n            return sorted_vals[n//2]\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 2: Package Python Module"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Must"})," package Python files into ",(0,t.jsx)(e.code,{children:".zip"})," format (even for a single file):"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"zip stats_udaf.zip stats_udaf.py\n"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 3: Set Python Module Archive Path"})}),"\n",(0,t.jsxs)(e.p,{children:["Supports multiple deployment methods, specified through the ",(0,t.jsx)(e.code,{children:"file"})," parameter for the ",(0,t.jsx)(e.code,{children:".zip"})," package path:"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Method 1: Local Filesystem"})," (using ",(0,t.jsx)(e.code,{children:"file://"})," protocol)"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'"file" = "file:///path/to/stats_udaf.zip"\n'})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Method 2: HTTP/HTTPS Remote Download"})," (using ",(0,t.jsx)(e.code,{children:"http://"})," or ",(0,t.jsx)(e.code,{children:"https://"})," protocol)"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'"file" = "http://example.com/udaf/stats_udaf.zip"\n"file" = "https://s3.amazonaws.com/bucket/stats_udaf.zip"\n'})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Note"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"When using remote download method, ensure all BE nodes can access the URL"}),"\n",(0,t.jsx)(e.li,{children:"First call will download the file, which may have some delay"}),"\n",(0,t.jsx)(e.li,{children:"Files will be cached, subsequent calls do not need to download again"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 4: Set symbol Parameter"})}),"\n",(0,t.jsxs)(e.p,{children:["In module mode, the ",(0,t.jsx)(e.code,{children:"symbol"})," parameter is used to specify the class's location in the ZIP package, with the format:"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"[package_name.]module_name.ClassName\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Parameter Description"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"package_name"})," (optional): Top-level Python package name in the ZIP archive"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"module_name"})," (required): Python module filename containing the target class (without ",(0,t.jsx)(e.code,{children:".py"})," suffix)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"ClassName"})," (required): UDAF class name"]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Parsing Rules"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Doris will split the ",(0,t.jsx)(e.code,{children:"symbol"})," string by ",(0,t.jsx)(e.code,{children:"."}),":\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["If ",(0,t.jsx)(e.strong,{children:"two"})," substrings are obtained, they are ",(0,t.jsx)(e.code,{children:"module_name"})," and ",(0,t.jsx)(e.code,{children:"ClassName"})]}),"\n",(0,t.jsxs)(e.li,{children:["If ",(0,t.jsx)(e.strong,{children:"three or more"})," substrings are obtained, the beginning is ",(0,t.jsx)(e.code,{children:"package_name"}),", middle is ",(0,t.jsx)(e.code,{children:"module_name"}),", and end is ",(0,t.jsx)(e.code,{children:"ClassName"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 5: Create UDAF Functions"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_variance(DOUBLE);\nDROP FUNCTION IF EXISTS py_stddev(DOUBLE);\nDROP FUNCTION IF EXISTS py_median(DOUBLE);\n\nCREATE AGGREGATE FUNCTION py_variance(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/stats_udaf.zip",\n    "symbol" = "stats_udaf.VarianceUDAF",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE AGGREGATE FUNCTION py_stddev(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/stats_udaf.zip",\n    "symbol" = "stats_udaf.StdDevUDAF",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE AGGREGATE FUNCTION py_median(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/stats_udaf.zip",\n    "symbol" = "stats_udaf.MedianUDAF",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 6: Use Functions"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"DROP TABLE IF EXISTS exam_results;\n\nCREATE TABLE IF NOT EXISTS exam_results (\n    id INT,\n    student_name VARCHAR(100),\n    category VARCHAR(50),\n    score DOUBLE\n) DUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO exam_results VALUES \n(1, 'Alice', 'Math', 85.0),\n(2, 'Bob', 'Math', 92.0),\n(3, 'Charlie', 'Math', 78.0),\n(4, 'David', 'Math', 88.0),\n(5, 'Eve', 'Math', 95.0),\n(6, 'Frank', 'English', 75.0),\n(7, 'Grace', 'English', 82.0),\n(8, 'Henry', 'English', 88.0),\n(9, 'Iris', 'English', 79.0),\n(10, 'Jack', 'Physics', 90.0),\n(11, 'Kate', 'Physics', 85.0),\n(12, 'Lily', 'Physics', 92.0),\n(13, 'Mike', 'Physics', 88.0);\n\nSELECT \n    category,\n    py_variance(score) as variance,\n    py_stddev(score) as std_dev,\n    py_median(score) as median\nFROM exam_results\nGROUP BY category\nORDER BY category;\n\n+----------+-------------------+-------------------+--------+\n| category | variance          | std_dev           | median |\n+----------+-------------------+-------------------+--------+\n| English  |              22.5 | 4.743416490252569 |   80.5 |\n| Math     | 34.64000000000033 | 5.885575587824892 |     88 |\n| Physics  |            6.6875 |  2.58602010819715 |     89 |\n+----------+-------------------+-------------------+--------+\n"})}),"\n",(0,t.jsx)(e.h4,{id:"dropping-python-udaf",children:"Dropping Python UDAF"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- Syntax\nDROP FUNCTION IF EXISTS function_name(parameter_types);\n\n-- Examples\nDROP FUNCTION IF EXISTS py_sum(INT);\nDROP FUNCTION IF EXISTS py_avg(DOUBLE);\nDROP FUNCTION IF EXISTS py_variance(DOUBLE);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"parameter-description-1",children:"Parameter Description"}),"\n",(0,t.jsx)(e.h4,{id:"create-aggregate-function-parameters",children:"CREATE AGGREGATE FUNCTION Parameters"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Parameter"}),(0,t.jsx)(e.th,{children:"Description"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"function_name"})}),(0,t.jsx)(e.td,{children:"Function name, follows SQL identifier naming rules"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"parameter_types"})}),(0,t.jsxs)(e.td,{children:["Parameter type list, such as ",(0,t.jsx)(e.code,{children:"INT"}),", ",(0,t.jsx)(e.code,{children:"DOUBLE"}),", ",(0,t.jsx)(e.code,{children:"STRING"}),", etc."]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"RETURNS return_type"})}),(0,t.jsx)(e.td,{children:"Return value type"})]})]})]}),"\n",(0,t.jsx)(e.h4,{id:"properties-parameters-1",children:"PROPERTIES Parameters"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Parameter"}),(0,t.jsx)(e.th,{children:"Required"}),(0,t.jsx)(e.th,{children:"Default"}),(0,t.jsx)(e.th,{children:"Description"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"type"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Fixed as ",(0,t.jsx)(e.code,{children:'"PYTHON_UDF"'})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"symbol"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Python class name.",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.strong,{children:"Inline Mode"}),": Write class name directly, such as ",(0,t.jsx)(e.code,{children:'"SumUDAF"'}),(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.strong,{children:"Module Mode"}),": Format is ",(0,t.jsx)(e.code,{children:"[package_name.]module_name.ClassName"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"file"})}),(0,t.jsx)(e.td,{children:"No"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Python ",(0,t.jsx)(e.code,{children:".zip"})," package path, only required for module mode. Supports three protocols:",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.code,{children:"file://"})," - Local filesystem path",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.code,{children:"http://"})," - HTTP remote download",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.code,{children:"https://"})," - HTTPS remote download"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"runtime_version"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Python runtime version, such as ",(0,t.jsx)(e.code,{children:'"3.10.12"'})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"always_nullable"})}),(0,t.jsx)(e.td,{children:"No"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"true"})}),(0,t.jsx)(e.td,{children:"Whether to always return nullable results"})]})]})]}),"\n",(0,t.jsx)(e.h4,{id:"runtime_version-description",children:"runtime_version Description"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Must fill in ",(0,t.jsx)(e.strong,{children:"complete version number"})," of Python version, format is ",(0,t.jsx)(e.code,{children:"x.x.x"})," or ",(0,t.jsx)(e.code,{children:"x.x.xx"})]}),"\n",(0,t.jsx)(e.li,{children:"Doris will search for matching version interpreter in configured Python environment"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"window-functions",children:"Window Functions"}),"\n",(0,t.jsx)(e.p,{children:"Python UDAF can be used with window functions (OVER clause):"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:["If Python UDAF is used in window functions (OVER clause), Doris will call the ",(0,t.jsx)(e.code,{children:"reset"})," method of the UDAF after calculating each window frame, which needs to be implemented in the class to reset the aggregation state to its initial value"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"DROP TABLE IF EXISTS daily_sales_data;\n\nCREATE TABLE IF NOT EXISTS daily_sales_data (\n    sales_date DATE,\n    daily_sales DOUBLE\n) DUPLICATE KEY(sales_date)\nDISTRIBUTED BY HASH(sales_date) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO daily_sales_data VALUES \n('2024-01-01', 1000),\n('2024-01-01', 800),\n('2024-01-02', 1200),\n('2024-01-02', 950),\n('2024-01-03', 900),\n('2024-01-03', 1100),\n('2024-01-04', 1500),\n('2024-01-04', 850),\n('2024-01-05', 1100),\n('2024-01-05', 1300);\n\nDROP FUNCTION IF EXISTS py_running_sum(DOUBLE);\n\nCREATE AGGREGATE FUNCTION py_running_sum(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"RunningSumUDAF\",\n    \"runtime_version\" = \"3.10.12\",\n    \"always_nullable\" = \"true\"\n)\nAS $$\nclass RunningSumUDAF:\n    def __init__(self):\n        self.total = 0.0\n\n    def reset(self):\n        self.total = 0.0\n    \n    @property\n    def aggregate_state(self):\n        return self.total\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.total += value\n    \n    def merge(self, other_state):\n        self.total += other_state\n    \n    def finish(self):\n        return self.total\n$$;\n\nSELECT \n    sales_date,\n    daily_sales,\n    py_running_sum(daily_sales) OVER (\n        ORDER BY sales_date \n        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW\n    ) as last_3_days_sum\nFROM daily_sales_data\nORDER BY sales_date;\n\n+------------+-------------+-----------------+\n| sales_date | daily_sales | last_3_days_sum |\n+------------+-------------+-----------------+\n| 2024-01-01 |         800 |             800 |\n| 2024-01-01 |        1000 |            1800 |\n| 2024-01-02 |         950 |            2750 |\n| 2024-01-02 |        1200 |            3150 |\n| 2024-01-03 |        1100 |            3250 |\n| 2024-01-03 |         900 |            3200 |\n| 2024-01-04 |         850 |            2850 |\n| 2024-01-04 |        1500 |            3250 |\n| 2024-01-05 |        1300 |            3650 |\n| 2024-01-05 |        1100 |            3900 |\n+------------+-------------+-----------------+\n"})}),"\n",(0,t.jsx)(e.h3,{id:"data-type-mapping-1",children:"Data Type Mapping"}),"\n",(0,t.jsx)(e.p,{children:"Python UDAF uses exactly the same data type mapping rules as Python UDF, including all types such as integers, floats, strings, date/time, Decimal, boolean, etc."}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"For detailed data type mapping relationships, please refer to"}),": ",(0,t.jsx)(e.a,{href:"python-user-defined-function#data-type-mapping",children:"Data Type Mapping"})]}),"\n",(0,t.jsx)(e.h4,{id:"null-value-handling-1",children:"NULL Value Handling"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Doris maps SQL ",(0,t.jsx)(e.code,{children:"NULL"})," values to Python's ",(0,t.jsx)(e.code,{children:"None"})]}),"\n",(0,t.jsxs)(e.li,{children:["In the ",(0,t.jsx)(e.code,{children:"accumulate"})," method, need to check if parameters are ",(0,t.jsx)(e.code,{children:"None"})]}),"\n",(0,t.jsxs)(e.li,{children:["Aggregate functions can return ",(0,t.jsx)(e.code,{children:"None"})," to indicate result is ",(0,t.jsx)(e.code,{children:"NULL"})]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"practical-application-scenarios-1",children:"Practical Application Scenarios"}),"\n",(0,t.jsx)(e.h4,{id:"scenario-1-calculate-percentiles",children:"Scenario 1: Calculate Percentiles"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS py_percentile(DOUBLE, INT);\n\nCREATE AGGREGATE FUNCTION py_percentile(DOUBLE, INT)\nRETURNS DOUBLE\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"PercentileUDAF\",\n    \"runtime_version\" = \"3.10.12\",\n    \"always_nullable\" = \"true\"\n)\nAS $$\nclass PercentileUDAF:\n    \"\"\"Calculate percentile, second parameter is percentile (0-100)\"\"\"\n    \n    def __init__(self):\n        self.values = []\n        self.percentile = 50  # Default median\n    \n    @property\n    def aggregate_state(self):\n        return self.values\n    \n    def accumulate(self, value, percentile):\n        if value is not None:\n            self.values.append(value)\n        if percentile is not None:\n            self.percentile = percentile\n    \n    def merge(self, other_state):\n        if other_state:\n            self.values.extend(other_state)\n    \n    def finish(self):\n        if not self.values:\n            return None\n        sorted_vals = sorted(self.values)\n        n = len(sorted_vals)\n        k = (n - 1) * (self.percentile / 100.0)\n        f = int(k)\n        c = k - f\n        if f + 1 < n:\n            return sorted_vals[f] + (sorted_vals[f + 1] - sorted_vals[f]) * c\n        else:\n            return sorted_vals[f]\n$$;\n\nDROP TABLE IF EXISTS api_logs;\n\nCREATE TABLE IF NOT EXISTS api_logs (\n    log_id INT,\n    api_name VARCHAR(100),\n    category VARCHAR(50),\n    response_time DOUBLE\n) DUPLICATE KEY(log_id)\nDISTRIBUTED BY HASH(log_id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO api_logs VALUES \n(1, '/api/users', 'User', 120.5),\n(2, '/api/users', 'User', 95.3),\n(3, '/api/users', 'User', 150.0),\n(4, '/api/users', 'User', 80.2),\n(5, '/api/users', 'User', 200.8),\n(6, '/api/orders', 'Order', 250.0),\n(7, '/api/orders', 'Order', 180.5),\n(8, '/api/orders', 'Order', 300.2),\n(9, '/api/orders', 'Order', 220.0),\n(10, '/api/products', 'Product', 50.0),\n(11, '/api/products', 'Product', 60.5),\n(12, '/api/products', 'Product', 45.0),\n(13, '/api/products', 'Product', 70.2),\n(14, '/api/products', 'Product', 55.8);\n\nSELECT \n    category,\n    py_percentile(response_time, 25) as p25,\n    py_percentile(response_time, 50) as p50,\n    py_percentile(response_time, 75) as p75,\n    py_percentile(response_time, 95) as p95\nFROM api_logs\nGROUP BY category\nORDER BY category;\n\n+----------+-------+-------+-------+-------+\n| category | p25   | p50   | p75   | p95   |\n+----------+-------+-------+-------+-------+\n| Order    |   235 |   235 |   235 |   235 |\n| Product  |  55.8 |  55.8 |  55.8 |  55.8 |\n| User     | 120.5 | 120.5 | 120.5 | 120.5 |\n+----------+-------+-------+-------+-------+\n"})}),"\n",(0,t.jsx)(e.h4,{id:"scenario-2-string-deduplication-and-aggregation",children:"Scenario 2: String Deduplication and Aggregation"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS py_collect_set(STRING);\n\nCREATE AGGREGATE FUNCTION py_collect_set(STRING)\nRETURNS STRING\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"CollectSetUDAF\",\n    \"runtime_version\" = \"3.10.12\",\n    \"always_nullable\" = \"true\"\n)\nAS $$\nclass CollectSetUDAF:\n    \"\"\"Deduplicate and collect strings, return comma-separated string\"\"\"\n    \n    def __init__(self):\n        self.items = set()\n    \n    @property\n    def aggregate_state(self):\n        return list(self.items)\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.items.add(value)\n    \n    def merge(self, other_state):\n        if other_state:\n            self.items.update(other_state)\n    \n    def finish(self):\n        if not self.items:\n            return None\n        return ','.join(sorted(self.items))\n$$;\n\nDROP TABLE IF EXISTS page_views;\n\nCREATE TABLE IF NOT EXISTS page_views (\n    view_id INT,\n    user_id INT,\n    page_url VARCHAR(200),\n    view_time DATETIME\n) DUPLICATE KEY(view_id)\nDISTRIBUTED BY HASH(view_id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO page_views VALUES \n(1, 1001, '/home', '2024-01-01 10:00:00'),\n(2, 1001, '/products', '2024-01-01 10:05:00'),\n(3, 1001, '/home', '2024-01-01 10:10:00'),\n(4, 1001, '/cart', '2024-01-01 10:15:00'),\n(5, 1002, '/home', '2024-01-01 11:00:00'),\n(6, 1002, '/about', '2024-01-01 11:05:00'),\n(7, 1002, '/products', '2024-01-01 11:10:00'),\n(8, 1003, '/products', '2024-01-01 12:00:00'),\n(9, 1003, '/products', '2024-01-01 12:05:00'),\n(10, 1003, '/cart', '2024-01-01 12:10:00'),\n(11, 1003, '/checkout', '2024-01-01 12:15:00');\n\nSELECT \n    user_id,\n    py_collect_set(page_url) as visited_pages\nFROM page_views\nGROUP BY user_id\nORDER BY user_id;\n\n+---------+---------------------------+\n| user_id | visited_pages             |\n+---------+---------------------------+\n|    1001 | /cart,/home,/products     |\n|    1002 | /about,/home,/products    |\n|    1003 | /cart,/checkout,/products |\n+---------+---------------------------+\n"})}),"\n",(0,t.jsx)(e.h4,{id:"scenario-3-moving-average",children:"Scenario 3: Moving Average"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"DROP TABLE IF EXISTS daily_sales;\n\nCREATE TABLE IF NOT EXISTS daily_sales (\n    id INT,\n    date DATE,\n    sales DOUBLE\n) DUPLICATE KEY(id)\nDISTRIBUTED BY HASH(id) BUCKETS 1\nPROPERTIES(\"replication_num\" = \"1\");\n\nINSERT INTO daily_sales VALUES \n(1, '2024-01-01', 1000.0),\n(2, '2024-01-02', 1200.0),\n(3, '2024-01-03', 900.0),\n(4, '2024-01-04', 1500.0),\n(5, '2024-01-05', 1100.0),\n(6, '2024-01-06', 1300.0),\n(7, '2024-01-07', 1400.0),\n(8, '2024-01-08', 1000.0),\n(9, '2024-01-09', 1600.0),\n(10, '2024-01-10', 1250.0);\n\nSELECT \n    date,\n    sales,\n    py_avg(sales) OVER (\n        ORDER BY date \n        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n    ) as moving_avg_7days\nFROM daily_sales\nORDER BY date;\n\n+------------+-------+-------------------+\n| date       | sales | moving_avg_7days  |\n+------------+-------+-------------------+\n| 2024-01-01 |  1000 |              1000 |\n| 2024-01-02 |  1200 |              1100 |\n| 2024-01-03 |   900 | 1033.333333333333 |\n| 2024-01-04 |  1500 |              1150 |\n| 2024-01-05 |  1100 |              1140 |\n| 2024-01-06 |  1300 | 1166.666666666667 |\n| 2024-01-07 |  1400 |              1200 |\n| 2024-01-08 |  1000 |              1200 |\n| 2024-01-09 |  1600 | 1257.142857142857 |\n| 2024-01-10 |  1250 | 1307.142857142857 |\n+------------+-------+-------------------+\n"})}),"\n",(0,t.jsx)(e.h3,{id:"performance-optimization-recommendations-1",children:"Performance Optimization Recommendations"}),"\n",(0,t.jsx)(e.h4,{id:"1-optimize-state-object-size",children:"1. Optimize State Object Size"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Avoid storing large amounts of raw data in state objects"}),"\n",(0,t.jsx)(e.li,{children:"Use aggregated statistics instead of complete data lists whenever possible"}),"\n",(0,t.jsx)(e.li,{children:"For scenarios that must store data (such as median), consider sampling or limiting data volume"}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Not recommended usage"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"class BadMedianUDAF:\n    def __init__(self):\n        self.all_values = []  # May be very large\n    \n    def accumulate(self, value):\n        if value is not None:\n            self.all_values.append(value)\n"})}),"\n",(0,t.jsx)(e.h4,{id:"2-reduce-object-creation",children:"2. Reduce Object Creation"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Reuse state objects, avoid frequent creation of new objects"}),"\n",(0,t.jsx)(e.li,{children:"Use primitive data types instead of complex objects"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"3-simplify-merge-logic",children:"3. Simplify merge Logic"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"merge"})," method is called frequently in distributed environments"]}),"\n",(0,t.jsx)(e.li,{children:"Ensure merge operations are efficient and correct"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"4-use-incremental-calculation",children:"4. Use Incremental Calculation"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"For metrics that can be calculated incrementally (such as average), use incremental approach instead of storing all data"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"5-avoid-using-external-resources",children:"5. Avoid Using External Resources"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Do not access databases or external APIs in UDAF"}),"\n",(0,t.jsx)(e.li,{children:"All calculations should be based on incoming data and internal state"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"limitations-and-considerations-1",children:"Limitations and Considerations"}),"\n",(0,t.jsx)(e.h4,{id:"1-performance-considerations",children:"1. Performance Considerations"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Python UDAF performance is lower than built-in aggregate functions"}),"\n",(0,t.jsx)(e.li,{children:"Recommended for scenarios with complex logic but moderate data volume"}),"\n",(0,t.jsx)(e.li,{children:"For large data volume scenarios, prioritize built-in functions or optimize UDAF implementation"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"2-state-serialization",children:"2. State Serialization"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Objects returned by ",(0,t.jsx)(e.code,{children:"aggregate_state"})," ",(0,t.jsx)(e.strong,{children:"must support pickle serialization"})]}),"\n",(0,t.jsx)(e.li,{children:"Supported types: basic types (int, float, str, bool), list, dict, tuple, set, and custom class instances that support pickle serialization"}),"\n",(0,t.jsx)(e.li,{children:"Not supported: file handles, database connections, socket connections, thread locks, and other objects that cannot be pickle serialized"}),"\n",(0,t.jsx)(e.li,{children:"If state object cannot be pickle serialized, function execution will report an error"}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Recommend prioritizing built-in types"})," (dict, list, tuple) as state objects to ensure compatibility and maintainability"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"3-memory-limitations",children:"3. Memory Limitations"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"State objects occupy memory, avoid storing too much data"}),"\n",(0,t.jsx)(e.li,{children:"Large state objects will affect performance and stability"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"4-function-naming",children:"4. Function Naming"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Same function name can be repeatedly defined in different databases"}),"\n",(0,t.jsxs)(e.li,{children:["Call time should specify database name (such as ",(0,t.jsx)(e.code,{children:"db.func()"}),") to avoid ambiguity"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"5-environment-consistency",children:"5. Environment Consistency"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Python environment on all BE nodes must be consistent"}),"\n",(0,t.jsx)(e.li,{children:"Including Python version, dependency package versions, environment configuration"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"frequently-asked-questions-faq-1",children:"Frequently Asked Questions (FAQ)"}),"\n",(0,t.jsx)(e.h4,{id:"q1-what-is-the-difference-between-udaf-and-udf",children:"Q1: What is the difference between UDAF and UDF?"}),"\n",(0,t.jsxs)(e.p,{children:["A: ",(0,t.jsx)(e.strong,{children:"UDF"})," processes single row data, returns single row result. Function is called once per row. ",(0,t.jsx)(e.strong,{children:"UDAF"})," processes multiple rows of data, returns single aggregation result. Used with GROUP BY."]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- UDF: Called for each row\nSELECT id, py_upper(name) FROM users;\n\n-- UDAF: Called once per group\nSELECT category, py_sum(amount) FROM sales GROUP BY category;\n"})}),"\n",(0,t.jsx)(e.h4,{id:"q2-what-is-the-purpose-of-the-aggregate_state-property",children:"Q2: What is the purpose of the aggregate_state property?"}),"\n",(0,t.jsxs)(e.p,{children:["A: ",(0,t.jsx)(e.code,{children:"aggregate_state"})," is used to serialize and transmit aggregation state in distributed environments:"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Serialization"}),": Convert state object to transmittable format, using ",(0,t.jsx)(e.strong,{children:"pickle protocol"})," for serialization"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Merging"}),": Merge partial aggregation results between different nodes"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Must support pickle serialization"}),": Can return basic types, lists, dictionaries, tuples, sets, and custom class instances that support pickle serialization"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Cannot return"}),": File handles, database connections, socket connections, thread locks, and other objects that cannot be pickle serialized, otherwise function execution will report error"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"q3-can-udaf-be-used-in-window-functions",children:"Q3: Can UDAF be used in window functions?"}),"\n",(0,t.jsx)(e.p,{children:"A: Yes. Python UDAF fully supports window functions (OVER clause)."}),"\n",(0,t.jsx)(e.h4,{id:"q4-when-is-the-merge-method-called",children:"Q4: When is the merge method called?"}),"\n",(0,t.jsxs)(e.p,{children:["A: The ",(0,t.jsx)(e.code,{children:"merge"})," method is called in the following situations:"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Distributed aggregation"}),": Merge partial aggregation results from different BE nodes"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Parallel processing"}),": Merge partial results from different threads within the same node"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Window functions"}),": Merge partial results within window frame"]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:["Therefore, ",(0,t.jsx)(e.code,{children:"merge"})," implementation must be correct, otherwise it will lead to incorrect results."]}),"\n",(0,t.jsx)(e.h2,{id:"python-udtf",children:"Python UDTF"}),"\n",(0,t.jsx)(e.p,{children:"Python UDTF (User Defined Table Function) is a custom table function extension mechanism provided by Apache Doris, allowing users to write custom table functions in Python to convert single-row data into multi-row output. Through Python UDTF, users can flexibly implement complex logic such as data splitting, expansion, and generation."}),"\n",(0,t.jsx)(e.p,{children:"Core features of Python UDTF:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"One Row to Multiple Rows"}),": Receives single row input, outputs zero, one, or multiple rows of results"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Flexible Output Structure"}),": Can define any number and type of output columns, supports both simple types and complex STRUCT types"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Lateral View Support"}),": Used with ",(0,t.jsx)(e.code,{children:"LATERAL VIEW"})," to implement data expansion and association"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Functional Programming"}),": Uses Python functions and ",(0,t.jsx)(e.code,{children:"yield"})," statements, concise and intuitive"]}),"\n"]}),"\n",(0,t.jsxs)(e.admonition,{title:"Note",type:"tip",children:[(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Environment Dependencies"}),": Before using Python UDTF, you must pre-install ",(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"pandas"})})," and ",(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"pyarrow"})})," libraries in the Python environment on all BE nodes. These are mandatory dependencies for Doris Python UDTF functionality. See ",(0,t.jsx)(e.a,{href:"python-user-defined-function#python-udfudafudtf-environment-configuration-and-multi-version-management",children:"Python UDTF Environment Configuration"}),"."]}),(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Log Path"}),": The Python UDTF Server runtime log is located at ",(0,t.jsx)(e.code,{children:"output/be/log/python_udf_output.log"}),". Users can check the Python Server's operation status, aggregate function execution information, and debug errors in this log."]})]}),"\n",(0,t.jsx)(e.h3,{id:"udtf-basic-concepts",children:"UDTF Basic Concepts"}),"\n",(0,t.jsx)(e.h4,{id:"execution-method-of-table-functions",children:"Execution Method of Table Functions"}),"\n",(0,t.jsxs)(e.p,{children:["Python UDTF is implemented through ",(0,t.jsx)(e.strong,{children:"functions"})," (not classes), and the execution flow of a function is as follows:"]}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Receive Input"}),": Function receives column values of single row data as parameters"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Process and Produce"}),": Produces zero or multiple rows of results through ",(0,t.jsx)(e.code,{children:"yield"})," statement"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Stateless"}),": Each function call independently processes one row, does not retain state from previous row"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"function-requirements",children:"Function Requirements"}),"\n",(0,t.jsx)(e.p,{children:"Python UDTF functions must meet the following requirements:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Use yield to produce results"}),": Produce output rows through ",(0,t.jsx)(e.code,{children:"yield"})," statement"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Parameter type correspondence"}),": Function parameters correspond to parameter types defined in SQL"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Output format matching"}),": Data format of ",(0,t.jsx)(e.code,{children:"yield"})," must match ",(0,t.jsx)(e.code,{children:"RETURNS ARRAY<...>"})," definition"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"output-methods",children:"Output Methods"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Single column output"}),": ",(0,t.jsx)(e.code,{children:"yield value"})," produces single value"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Multi-column output"}),": ",(0,t.jsx)(e.code,{children:"yield (value1, value2, ...)"})," produces tuple of multiple values"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Conditional skip"}),": Do not call ",(0,t.jsx)(e.code,{children:"yield"}),", this row produces no output"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"basic-syntax-1",children:"Basic Syntax"}),"\n",(0,t.jsx)(e.h4,{id:"creating-python-udtf",children:"Creating Python UDTF"}),"\n",(0,t.jsx)(e.p,{children:"Python UDTF supports two creation modes: Inline Mode and Module Mode."}),"\n",(0,t.jsx)(e.admonition,{title:"Note",type:"caution",children:(0,t.jsxs)(e.p,{children:["If both the ",(0,t.jsx)(e.code,{children:"file"})," parameter and ",(0,t.jsx)(e.code,{children:"AS $$"})," inline Python code are specified, Doris will ",(0,t.jsx)(e.strong,{children:"prioritize loading inline Python code"})," and run the Python UDTF in inline mode."]})}),"\n",(0,t.jsx)(e.h5,{id:"inline-mode-2",children:"Inline Mode"}),"\n",(0,t.jsx)(e.p,{children:"Inline mode allows writing Python functions directly in SQL, suitable for simple table function logic."}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Syntax"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'CREATE TABLES FUNCTION function_name(parameter_type1, parameter_type2, ...)\nRETURNS ARRAY<return_type>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "function_name",\n    "runtime_version" = "python_version",\n    "always_nullable" = "true|false"\n)\nAS $$\ndef function_name(param1, param2, ...):\n    \'\'\'Function description\'\'\'\n    # Processing logic\n    yield result  # Single column output\n    # or\n    yield (result1, result2, ...)  # Multi-column output\n$$;\n'})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Important Syntax Notes"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Use ",(0,t.jsx)(e.code,{children:"CREATE TABLES FUNCTION"})," (note ",(0,t.jsx)(e.strong,{children:"TABLES"}),", plural form)"]}),"\n",(0,t.jsxs)(e.li,{children:["Single column output: ",(0,t.jsx)(e.code,{children:"ARRAY<type>"}),", such as ",(0,t.jsx)(e.code,{children:"ARRAY<INT>"})]}),"\n",(0,t.jsxs)(e.li,{children:["Multi-column output: ",(0,t.jsx)(e.code,{children:"ARRAY<STRUCT<col1:type1, col2:type2, ...>>"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 1: String Split (Single Column Output)"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_split(STRING, STRING);\n\nCREATE TABLES FUNCTION py_split(STRING, STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "split_string_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef split_string_udtf(text, delimiter):\n    \'\'\'Split string by delimiter into multiple rows\'\'\'\n    if text is not None and delimiter is not None:\n        parts = text.split(delimiter)\n        for part in parts:\n            # Also supports yield (part.strip(),) \n            yield part.strip()\n$$;\n\nSELECT part\nFROM (SELECT \'apple,banana,orange\' as fruits) t\nLATERAL VIEW py_split(fruits, \',\') tmp AS part;\n\n+--------+\n| part   |\n+--------+\n| apple  |\n| banana |\n| orange |\n+--------+\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 2: Generate Number Sequence (Single Column Output)"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_range(INT, INT);\n\nCREATE TABLES FUNCTION py_range(INT, INT)\nRETURNS ARRAY<INT>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "generate_series_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef generate_series_udtf(start, end):\n    \'\'\'Generate integer sequence from start to end\'\'\'\n    if start is not None and end is not None:\n        for i in range(start, end + 1):\n            yield i\n$$;\n\nSELECT num\nFROM (SELECT 1 as start_val, 5 as end_val) t\nLATERAL VIEW py_range(start_val, end_val) tmp AS num;\n\n+------+\n| num  |\n+------+\n|    1 |\n|    2 |\n|    3 |\n|    4 |\n|    5 |\n+------+\n\nSELECT date_add(\'2024-01-01\', n) as date\nFROM (SELECT 0 as start_val, 6 as end_val) t\nLATERAL VIEW py_range(start_val, end_val) tmp AS n;\n\n+------------+\n| date       |\n+------------+\n| 2024-01-01 |\n| 2024-01-02 |\n| 2024-01-03 |\n| 2024-01-04 |\n| 2024-01-05 |\n| 2024-01-06 |\n| 2024-01-07 |\n+------------+\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 3: Multi-Column Output (STRUCT)"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_duplicate(STRING, INT);\n\nCREATE TABLES FUNCTION py_duplicate(STRING, INT)\nRETURNS ARRAY<STRUCT<output:STRING, idx:INT>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "duplicate_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef duplicate_udtf(text, n):\n    \'\'\'Duplicate text n times, each with sequence number\'\'\'\n    if text is not None and n is not None:\n        for i in range(n):\n            yield (text, i + 1)\n$$;\n\nSELECT output, idx\nFROM (SELECT \'Hello\' as text, 3 as times) t\nLATERAL VIEW py_duplicate(text, times) tmp AS output, idx;\n\n+--------+------+\n| output | idx  |\n+--------+------+\n| Hello  |    1 |\n| Hello  |    2 |\n| Hello  |    3 |\n+--------+------+\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 4: Cartesian Product (Multi-Column STRUCT)"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_cartesian(STRING, STRING);\n\nCREATE TABLES FUNCTION py_cartesian(STRING, STRING)\nRETURNS ARRAY<STRUCT<item1:STRING, item2:STRING>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "cartesian_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef cartesian_udtf(list1, list2):\n    \'\'\'Generate Cartesian product of two lists\'\'\'\n    if list1 is not None and list2 is not None:\n        items1 = [x.strip() for x in list1.split(\',\')]\n        items2 = [y.strip() for y in list2.split(\',\')]\n        for x in items1:\n            for y in items2:\n                yield (x, y)\n$$;\n\nSELECT item1, item2\nFROM (SELECT \'A,B\' as list1, \'X,Y,Z\' as list2) t\nLATERAL VIEW py_cartesian(list1, list2) tmp AS item1, item2;\n\n+-------+-------+\n| item1 | item2 |\n+-------+-------+\n| A     | X     |\n| A     | Y     |\n| A     | Z     |\n| B     | X     |\n| B     | Y     |\n| B     | Z     |\n+-------+-------+\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Example 5: JSON Array Parsing"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_explode_json(STRING);\n\nCREATE TABLES FUNCTION py_explode_json(STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "explode_json_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nimport json\n\ndef explode_json_udtf(json_str):\n    \'\'\'Parse JSON array, output each element as one row\'\'\'\n    if json_str is not None:\n        try:\n            data = json.loads(json_str)\n            if isinstance(data, list):\n                for item in data:\n                    yield (str(item),)\n        except:\n            pass  # Skip on parsing failure\n$$;\n\nSELECT element\nFROM (SELECT \'["apple", "banana", "cherry"]\' as json_data) t\nLATERAL VIEW py_explode_json(json_data) tmp AS element;\n\n+---------+\n| element |\n+---------+\n| apple   |\n| banana  |\n| cherry  |\n+---------+\n'})}),"\n",(0,t.jsx)(e.h5,{id:"module-mode-2",children:"Module Mode"}),"\n",(0,t.jsxs)(e.p,{children:["Module mode is suitable for complex table function logic, requiring Python code to be packaged into a ",(0,t.jsx)(e.code,{children:".zip"})," archive and referenced during function creation."]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 1: Write Python Module"})}),"\n",(0,t.jsxs)(e.p,{children:["Create ",(0,t.jsx)(e.code,{children:"text_udtf.py"})," file:"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'import json\nimport re\n\ndef split_lines_udtf(text):\n    """Split text by lines"""\n    if text:\n        lines = text.split(\'\\n\')\n        for line in lines:\n            line = line.strip()\n            if line:  # Filter empty lines\n                yield (line,)\n\n\ndef extract_emails_udtf(text):\n    """Extract all email addresses from text"""\n    if text:\n        email_pattern = r\'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}\'\n        emails = re.findall(email_pattern, text)\n        for email in emails:\n            yield (email,)\n\n\ndef parse_json_object_udtf(json_str):\n    """Parse JSON object, output key-value pairs"""\n    if json_str:\n        try:\n            data = json.loads(json_str)\n            if isinstance(data, dict):\n                for key, value in data.items():\n                    yield (key, str(value))\n        except:\n            pass\n\n\ndef expand_json_array_udtf(json_str):\n    """Expand objects in JSON array, output structured data"""\n    if json_str:\n        try:\n            data = json.loads(json_str)\n            if isinstance(data, list):\n                for item in data:\n                    if isinstance(item, dict):\n                        # Assume each object has id, name, score fields\n                        item_id = item.get(\'id\')\n                        name = item.get(\'name\')\n                        score = item.get(\'score\')\n                        yield (item_id, name, score)\n        except:\n            pass\n\n\ndef ngram_udtf(text, n):\n    """Generate N-gram phrases"""\n    if text and n and n > 0:\n        words = text.split()\n        for i in range(len(words) - n + 1):\n            ngram = \' \'.join(words[i:i+n])\n            yield (ngram,)\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 2: Package Python Module"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Must"})," package Python files into ",(0,t.jsx)(e.code,{children:".zip"})," format (even for a single file):"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"zip text_udtf.zip text_udtf.py\n"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 3: Set Python Module Archive Path"})}),"\n",(0,t.jsxs)(e.p,{children:["Supports multiple deployment methods, specified through the ",(0,t.jsx)(e.code,{children:"file"})," parameter for the ",(0,t.jsx)(e.code,{children:".zip"})," package path:"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Method 1: Local Filesystem"})," (using ",(0,t.jsx)(e.code,{children:"file://"})," protocol)"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'"file" = "file:///path/to/text_udtf.zip"\n'})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Method 2: HTTP/HTTPS Remote Download"})," (using ",(0,t.jsx)(e.code,{children:"http://"})," or ",(0,t.jsx)(e.code,{children:"https://"})," protocol)"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'"file" = "http://example.com/udtf/text_udtf.zip"\n"file" = "https://s3.amazonaws.com/bucket/text_udtf.zip"\n'})}),"\n",(0,t.jsx)(e.admonition,{title:"Note",type:"caution",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"When using remote download method, ensure all BE nodes can access the URL"}),"\n",(0,t.jsx)(e.li,{children:"First call will download the file, which may have some delay"}),"\n",(0,t.jsx)(e.li,{children:"Files will be cached, subsequent calls do not need to download again"}),"\n"]})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 4: Set symbol Parameter"})}),"\n",(0,t.jsxs)(e.p,{children:["In module mode, the ",(0,t.jsx)(e.code,{children:"symbol"})," parameter is used to specify the function's location in the ZIP package, with the format:"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"[package_name.]module_name.function_name\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Parameter Description"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"package_name"})," (optional): Top-level Python package name in the ZIP archive"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"module_name"})," (required): Python module filename containing the target function (without ",(0,t.jsx)(e.code,{children:".py"})," suffix)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"function_name"})," (required): UDTF function name"]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Parsing Rules"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Doris will split the ",(0,t.jsx)(e.code,{children:"symbol"})," string by ",(0,t.jsx)(e.code,{children:"."}),":\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["If ",(0,t.jsx)(e.strong,{children:"two"})," substrings are obtained, they are ",(0,t.jsx)(e.code,{children:"module_name"})," and ",(0,t.jsx)(e.code,{children:"function_name"})]}),"\n",(0,t.jsxs)(e.li,{children:["If ",(0,t.jsx)(e.strong,{children:"three or more"})," substrings are obtained, the beginning is ",(0,t.jsx)(e.code,{children:"package_name"}),", middle is ",(0,t.jsx)(e.code,{children:"module_name"}),", and end is ",(0,t.jsx)(e.code,{children:"function_name"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 5: Create UDTF Functions"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_split_lines(STRING);\nDROP FUNCTION IF EXISTS py_extract_emails(STRING);\nDROP FUNCTION IF EXISTS py_parse_json(STRING);\nDROP FUNCTION IF EXISTS py_expand_json(STRING);\nDROP FUNCTION IF EXISTS py_ngram(STRING, INT);\n\nCREATE TABLES FUNCTION py_split_lines(STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/text_udtf.zip",\n    "symbol" = "text_udtf.split_lines_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE TABLES FUNCTION py_extract_emails(STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/text_udtf.zip",\n    "symbol" = "text_udtf.extract_emails_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE TABLES FUNCTION py_parse_json(STRING)\nRETURNS ARRAY<STRUCT<k:STRING, v:STRING>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/text_udtf.zip",\n    "symbol" = "text_udtf.parse_json_object_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE TABLES FUNCTION py_expand_json(STRING)\nRETURNS ARRAY<STRUCT<id:INT, name:STRING, score:DOUBLE>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/text_udtf.zip",\n    "symbol" = "text_udtf.expand_json_array_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n\nCREATE TABLES FUNCTION py_ngram(STRING, INT)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "file" = "file:///path/to/text_udtf.zip",\n    "symbol" = "text_udtf.ngram_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n);\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Step 6: Use Functions"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'SELECT line\nFROM (SELECT \'Line 1\\nLine 2\\nLine 3\' as text) t\nLATERAL VIEW py_split_lines(text) tmp AS line;\n\n+--------+\n| line   |\n+--------+\n| Line 1 |\n| Line 2 |\n| Line 3 |\n+--------+\n\nSELECT email\nFROM (SELECT \'Contact us at support@example.com or sales@company.org\' as content) t\nLATERAL VIEW py_extract_emails(content) tmp AS email;\n\n+---------------------+\n| email               |\n+---------------------+\n| support@example.com |\n| sales@company.org   |\n+---------------------+\n\nSELECT k, v\nFROM (SELECT \'{"name": "Alice", "age": "25"}\' as json_data) t\nLATERAL VIEW py_parse_json(json_data) tmp AS k, v;\n\n+------+-------+\n| k    | v     |\n+------+-------+\n| name | Alice |\n| age  | 25    |\n+------+-------+\n\nSELECT id, name, score\nFROM (\n    SELECT \'[{"id": 1, "name": "Alice", "score": 95.5}, {"id": 2, "name": "Bob", "score": 88.0}]\' as data\n) t\nLATERAL VIEW py_expand_json(data) tmp AS id, name, score;\n\n+------+-------+-------+\n| id   | name  | score |\n+------+-------+-------+\n|    1 | Alice |  95.5 |\n|    2 | Bob   |    88 |\n+------+-------+-------+\n\nSELECT ngram\nFROM (SELECT \'Apache Doris is a fast database\' as text) t\nLATERAL VIEW py_ngram(text, 2) tmp AS ngram;\n\n+---------------+\n| ngram         |\n+---------------+\n| Apache Doris  |\n| Doris is      |\n| is a          |\n| a fast        |\n| fast database |\n+---------------+\n'})}),"\n",(0,t.jsx)(e.h4,{id:"dropping-python-udtf",children:"Dropping Python UDTF"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- Syntax\nDROP FUNCTION IF EXISTS function_name(parameter_types);\n\n-- Examples\nDROP FUNCTION IF EXISTS py_split(STRING, STRING);\nDROP FUNCTION IF EXISTS py_range(INT, INT);\nDROP FUNCTION IF EXISTS py_explode_json(STRING);\n"})}),"\n",(0,t.jsx)(e.h4,{id:"modifying-python-udtf",children:"Modifying Python UDTF"}),"\n",(0,t.jsx)(e.p,{children:"Doris does not support directly modifying existing functions, you need to drop first and then recreate:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS py_split(STRING, STRING);\nCREATE TABLES FUNCTION py_split(STRING, STRING) ...;\n"})}),"\n",(0,t.jsx)(e.h3,{id:"parameter-description-2",children:"Parameter Description"}),"\n",(0,t.jsx)(e.h4,{id:"create-tables-function-parameters",children:"CREATE TABLES FUNCTION Parameters"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Parameter"}),(0,t.jsx)(e.th,{children:"Description"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"function_name"})}),(0,t.jsx)(e.td,{children:"Function name, follows SQL identifier naming rules"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"parameter_types"})}),(0,t.jsxs)(e.td,{children:["Parameter type list, such as ",(0,t.jsx)(e.code,{children:"INT"}),", ",(0,t.jsx)(e.code,{children:"STRING"}),", ",(0,t.jsx)(e.code,{children:"DOUBLE"}),", etc."]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"RETURNS ARRAY<...>"})}),(0,t.jsxs)(e.td,{children:["Returned array type, defines output structure",(0,t.jsx)(e.br,{}),"\u2022 Single column: ",(0,t.jsx)(e.code,{children:"ARRAY<type>"}),(0,t.jsx)(e.br,{}),"\u2022 Multi-column: ",(0,t.jsx)(e.code,{children:"ARRAY<STRUCT<col1:type1, col2:type2, ...>>"})]})]})]})]}),"\n",(0,t.jsx)(e.h4,{id:"properties-parameters-2",children:"PROPERTIES Parameters"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Parameter"}),(0,t.jsx)(e.th,{children:"Required"}),(0,t.jsx)(e.th,{children:"Default"}),(0,t.jsx)(e.th,{children:"Description"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"type"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Fixed as ",(0,t.jsx)(e.code,{children:'"PYTHON_UDF"'})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"symbol"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Python function name.",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.strong,{children:"Inline Mode"}),": Write function name directly, such as ",(0,t.jsx)(e.code,{children:'"split_string_udtf"'}),(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.strong,{children:"Module Mode"}),": Format is ",(0,t.jsx)(e.code,{children:"[package_name.]module_name.function_name"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"file"})}),(0,t.jsx)(e.td,{children:"No"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Python ",(0,t.jsx)(e.code,{children:".zip"})," package path, only required for module mode. Supports three protocols:",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.code,{children:"file://"})," - Local filesystem path",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.code,{children:"http://"})," - HTTP remote download",(0,t.jsx)(e.br,{}),"\u2022 ",(0,t.jsx)(e.code,{children:"https://"})," - HTTPS remote download"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"runtime_version"})}),(0,t.jsx)(e.td,{children:"Yes"}),(0,t.jsx)(e.td,{children:"-"}),(0,t.jsxs)(e.td,{children:["Python runtime version, such as ",(0,t.jsx)(e.code,{children:'"3.10.12"'})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"always_nullable"})}),(0,t.jsx)(e.td,{children:"No"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"true"})}),(0,t.jsx)(e.td,{children:"Whether to always return nullable results"})]})]})]}),"\n",(0,t.jsx)(e.h4,{id:"runtime_version-description-1",children:"runtime_version Description"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Must fill in ",(0,t.jsx)(e.strong,{children:"complete version number"})," of Python version, format is ",(0,t.jsx)(e.code,{children:"x.x.x"})," or ",(0,t.jsx)(e.code,{children:"x.x.xx"})]}),"\n",(0,t.jsx)(e.li,{children:"Doris will search for matching version interpreter in configured Python environment"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"data-type-mapping-2",children:"Data Type Mapping"}),"\n",(0,t.jsx)(e.p,{children:"Python UDTF uses exactly the same data type mapping rules as Python UDF, including all types such as integers, floats, strings, date/time, Decimal, boolean, arrays, STRUCT, etc."}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"For detailed data type mapping relationships, please refer to"}),": ",(0,t.jsx)(e.a,{href:"python-user-defined-function#data-type-mapping",children:"Data Type Mapping"})]}),"\n",(0,t.jsx)(e.h4,{id:"null-value-handling-2",children:"NULL Value Handling"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Doris maps SQL ",(0,t.jsx)(e.code,{children:"NULL"})," values to Python's ",(0,t.jsx)(e.code,{children:"None"})]}),"\n",(0,t.jsxs)(e.li,{children:["In functions, need to check if parameters are ",(0,t.jsx)(e.code,{children:"None"})]}),"\n",(0,t.jsxs)(e.li,{children:["Values produced by ",(0,t.jsx)(e.code,{children:"yield"})," can contain ",(0,t.jsx)(e.code,{children:"None"}),", indicating that column is ",(0,t.jsx)(e.code,{children:"NULL"})]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"practical-application-scenarios-2",children:"Practical Application Scenarios"}),"\n",(0,t.jsx)(e.h4,{id:"scenario-1-csv-data-parsing",children:"Scenario 1: CSV Data Parsing"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_parse_csv(STRING);\n\nCREATE TABLES FUNCTION py_parse_csv(STRING)\nRETURNS ARRAY<STRUCT<name:STRING, age:INT, city:STRING>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "parse_csv_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef parse_csv_udtf(csv_data):\n    \'\'\'Parse multi-line data in CSV format\'\'\'\n    if csv_data is None:\n        return\n    lines = csv_data.strip().split(\'\\n\')\n    for line in lines:\n        parts = line.split(\',\')\n        if len(parts) >= 3:\n            name = parts[0].strip()\n            age = int(parts[1].strip()) if parts[1].strip().isdigit() else None\n            city = parts[2].strip()\n            yield (name, age, city)\n$$;\n\nSELECT name, age, city\nFROM (\n    SELECT \'Alice,25,Beijing\\nBob,30,Shanghai\\nCharlie,28,Guangzhou\' as data\n) t\nLATERAL VIEW py_parse_csv(data) tmp AS name, age, city;\n\n+---------+------+-----------+\n| name    | age  | city      |\n+---------+------+-----------+\n| Alice   |   25 | Beijing   |\n| Bob     |   30 | Shanghai  |\n| Charlie |   28 | Guangzhou |\n+---------+------+-----------+\n'})}),"\n",(0,t.jsx)(e.h4,{id:"scenario-2-date-range-generation",children:"Scenario 2: Date Range Generation"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"DROP FUNCTION IF EXISTS py_date_range(STRING, STRING);\n\nCREATE TABLES FUNCTION py_date_range(STRING, STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    \"type\" = \"PYTHON_UDF\",\n    \"symbol\" = \"date_range_udtf\",\n    \"runtime_version\" = \"3.10.12\",\n    \"always_nullable\" = \"true\"\n)\nAS $$\nfrom datetime import datetime, timedelta\n\ndef date_range_udtf(start_date, end_date):\n    '''Generate date range'''\n    if start_date is None or end_date is None:\n        return\n    try:\n        start = datetime.strptime(start_date, '%Y-%m-%d')\n        end = datetime.strptime(end_date, '%Y-%m-%d')\n        current = start\n        while current <= end:\n            yield (current.strftime('%Y-%m-%d'),)\n            current += timedelta(days=1)\n    except:\n        pass\n$$;\n\nSELECT date\nFROM (SELECT '2024-01-01' as start_date, '2024-01-07' as end_date) t\nLATERAL VIEW py_date_range(start_date, end_date) tmp AS date;\n\n+------------+\n| date       |\n+------------+\n| 2024-01-01 |\n| 2024-01-02 |\n| 2024-01-03 |\n| 2024-01-04 |\n| 2024-01-05 |\n| 2024-01-06 |\n| 2024-01-07 |\n+------------+\n"})}),"\n",(0,t.jsx)(e.h4,{id:"scenario-3-text-tokenization",children:"Scenario 3: Text Tokenization"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_tokenize(STRING);\n\nCREATE TABLES FUNCTION py_tokenize(STRING)\nRETURNS ARRAY<STRUCT<word:STRING, position:INT>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "tokenize_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nimport re\n\ndef tokenize_udtf(text):\n    \'\'\'Tokenize text, output words and positions\'\'\'\n    if text is None:\n        return\n    # Use regex to extract words\n    words = re.findall(r\'\\b\\w+\\b\', text.lower())\n    for i, word in enumerate(words, 1):\n        if len(word) >= 2:  # Filter single characters\n            yield (word, i)\n$$;\n\nSELECT word, position\nFROM (SELECT \'Apache Doris is a fast OLAP database\' as text) t\nLATERAL VIEW py_tokenize(text) tmp AS word, position;\n\n+----------+----------+\n| word     | position |\n+----------+----------+\n| apache   |        1 |\n| doris    |        2 |\n| is       |        3 |\n| fast     |        5 |\n| olap     |        6 |\n| database |        7 |\n+----------+----------+\n'})}),"\n",(0,t.jsx)(e.h4,{id:"scenario-4-url-parameter-parsing",children:"Scenario 4: URL Parameter Parsing"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_parse_url_params(STRING);\n\nCREATE TABLES FUNCTION py_parse_url_params(STRING)\nRETURNS ARRAY<STRUCT<param_name:STRING, param_value:STRING>>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "parse_url_params_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\nfrom urllib.parse import urlparse, parse_qs\n\ndef parse_url_params_udtf(url):\n    \'\'\'Parse URL parameters\'\'\'\n    if url is None:\n        return\n    try:\n        parsed = urlparse(url)\n        params = parse_qs(parsed.query)\n        for key, values in params.items():\n            for value in values:\n                yield (key, value)\n    except:\n        pass\n$$;\n\nSELECT param_name, param_value\nFROM (\n    SELECT \'https://example.com/page?id=123&category=tech&tag=python&tag=database\' as url\n) t\nLATERAL VIEW py_parse_url_params(url) tmp AS param_name, param_value;\n\n+------------+-------------+\n| param_name | param_value |\n+------------+-------------+\n| id         | 123         |\n| category   | tech        |\n| tag        | python      |\n| tag        | database    |\n+------------+-------------+\n'})}),"\n",(0,t.jsx)(e.h4,{id:"scenario-5-ip-range-expansion",children:"Scenario 5: IP Range Expansion"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'DROP FUNCTION IF EXISTS py_expand_ip_range(STRING, STRING);\n\nCREATE TABLES FUNCTION py_expand_ip_range(STRING, STRING)\nRETURNS ARRAY<STRING>\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "expand_ip_range_udtf",\n    "runtime_version" = "3.10.12",\n    "always_nullable" = "true"\n)\nAS $$\ndef expand_ip_range_udtf(start_ip, end_ip):\n    \'\'\'Expand IP address range (only supports last octet)\'\'\'\n    if start_ip is None or end_ip is None:\n        return\n    try:\n        # Assume format: 192.168.1.10 to 192.168.1.20\n        start_parts = start_ip.split(\'.\')\n        end_parts = end_ip.split(\'.\')\n        \n        if len(start_parts) == 4 and len(end_parts) == 4:\n            # Only expand last octet\n            if start_parts[:3] == end_parts[:3]:\n                prefix = \'.\'.join(start_parts[:3])\n                start_num = int(start_parts[3])\n                end_num = int(end_parts[3])\n                for i in range(start_num, end_num + 1):\n                    yield (f"{prefix}.{i}",)\n    except:\n        pass\n$$;\n\nSELECT ip\nFROM (SELECT \'192.168.1.10\' as start_ip, \'192.168.1.15\' as end_ip) t\nLATERAL VIEW py_expand_ip_range(start_ip, end_ip) tmp AS ip;\n\n+--------------+\n| ip           |\n+--------------+\n| 192.168.1.10 |\n| 192.168.1.11 |\n| 192.168.1.12 |\n| 192.168.1.13 |\n| 192.168.1.14 |\n| 192.168.1.15 |\n+--------------+\n'})}),"\n",(0,t.jsx)(e.h3,{id:"performance-optimization-recommendations-2",children:"Performance Optimization Recommendations"}),"\n",(0,t.jsx)(e.h4,{id:"1-control-output-row-count",children:"1. Control Output Row Count"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"For scenarios that may produce large amounts of output, set reasonable upper limits"}),"\n",(0,t.jsx)(e.li,{children:"Avoid Cartesian product explosion"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"2-avoid-duplicate-calculations",children:"2. Avoid Duplicate Calculations"}),"\n",(0,t.jsx)(e.p,{children:"If you need to use the same calculation result multiple times, pre-calculate:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"# Not recommended\ndef bad_split_udtf(text):\n    for i in range(len(text.split(','))):  # Split every time\n        parts = text.split(',')\n        yield (parts[i],)\n\n# Recommended\ndef good_split_udtf(text):\n    parts = text.split(',')  # Split only once\n    for part in parts:\n        yield (part,)\n"})}),"\n",(0,t.jsx)(e.h4,{id:"3-use-generator-expressions",children:"3. Use Generator Expressions"}),"\n",(0,t.jsx)(e.p,{children:"Leverage Python's generator features, avoid creating intermediate lists:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"# Not recommended\ndef bad_filter_udtf(text, delimiter):\n    parts = text.split(delimiter)\n    filtered = [p.strip() for p in parts if p.strip()]  # Create list\n    for part in filtered:\n        yield (part,)\n\n# Recommended\ndef good_filter_udtf(text, delimiter):\n    parts = text.split(delimiter)\n    for part in parts:\n        part = part.strip()\n        if part:  # Filter directly\n            yield (part,)\n"})}),"\n",(0,t.jsx)(e.h4,{id:"4-avoid-accessing-external-resources",children:"4. Avoid Accessing External Resources"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Do not access databases, files, networks in UDTF"}),"\n",(0,t.jsx)(e.li,{children:"All processing should be based on input parameters"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"limitations-and-considerations-2",children:"Limitations and Considerations"}),"\n",(0,t.jsx)(e.h4,{id:"1-stateless-limitation",children:"1. Stateless Limitation"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Python UDTF is ",(0,t.jsx)(e.strong,{children:"stateless"}),", each function call independently processes one row"]}),"\n",(0,t.jsx)(e.li,{children:"Cannot retain state between multiple calls"}),"\n",(0,t.jsx)(e.li,{children:"If cross-row aggregation is needed, should use UDAF"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"2-performance-considerations",children:"2. Performance Considerations"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Python UDTF performance is lower than built-in table functions"}),"\n",(0,t.jsx)(e.li,{children:"Suitable for scenarios with complex logic but moderate data volume"}),"\n",(0,t.jsx)(e.li,{children:"For large data volume scenarios, prioritize optimization or use built-in functions"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"3-fixed-output-type",children:"3. Fixed Output Type"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Type defined in ",(0,t.jsx)(e.code,{children:"RETURNS ARRAY<...>"})," is fixed"]}),"\n",(0,t.jsxs)(e.li,{children:["Values produced by ",(0,t.jsx)(e.code,{children:"yield"})," must match definition"]}),"\n",(0,t.jsxs)(e.li,{children:["Single column: ",(0,t.jsx)(e.code,{children:"yield value"})," or ",(0,t.jsx)(e.code,{children:"yield (value,)"}),", multi-column: ",(0,t.jsx)(e.code,{children:"yield (value1, value2, ...)"})]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"4-function-naming-1",children:"4. Function Naming"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Same function name can be repeatedly defined in different databases"}),"\n",(0,t.jsx)(e.li,{children:"Recommend specifying database name when calling to avoid ambiguity"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"5-environment-consistency-1",children:"5. Environment Consistency"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Python environment on all BE nodes must be consistent"}),"\n",(0,t.jsx)(e.li,{children:"Including Python version, dependency package versions, environment configuration"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"frequently-asked-questions-faq-2",children:"Frequently Asked Questions (FAQ)"}),"\n",(0,t.jsx)(e.h4,{id:"q1-what-is-the-difference-between-udtf-and-udf",children:"Q1: What is the difference between UDTF and UDF?"}),"\n",(0,t.jsxs)(e.p,{children:["A: ",(0,t.jsx)(e.strong,{children:"UDF"})," inputs single row, outputs single row, one-to-one relationship. ",(0,t.jsx)(e.strong,{children:"UDTF"})," inputs single row, outputs zero or multiple rows, one-to-many relationship."]}),"\n",(0,t.jsx)(e.p,{children:"Example:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"SELECT py_upper(name) FROM users;\n\nSELECT tag FROM users LATERAL VIEW py_split(tags, ',') tmp AS tag;\n"})}),"\n",(0,t.jsx)(e.h4,{id:"q2-how-to-output-multiple-columns",children:"Q2: How to output multiple columns?"}),"\n",(0,t.jsxs)(e.p,{children:["A: Multi-column output uses STRUCT to define return type, and produces tuple in ",(0,t.jsx)(e.code,{children:"yield"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLES FUNCTION func(...)\nRETURNS ARRAY<STRUCT<col1:INT, col2:STRING>>\n...\n\ndef func(...):\n    yield (123, 'hello')  # Corresponds to col1 and col2\n"})}),"\n",(0,t.jsx)(e.h4,{id:"q3-why-doesnt-my-udtf-produce-output",children:"Q3: Why doesn't my UDTF produce output?"}),"\n",(0,t.jsx)(e.p,{children:"A: Possible reasons:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Did not call yield"}),": Ensure ",(0,t.jsx)(e.code,{children:"yield"})," is called in function"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Condition filtering"}),": All data was filtered out"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Exception caught"}),": Check if try-except swallowed errors"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"NULL input"}),": Input is NULL and function returns directly"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"q4-can-udtf-maintain-state",children:"Q4: Can UDTF maintain state?"}),"\n",(0,t.jsx)(e.p,{children:"A: No. Python UDTF is stateless, each function call independently processes one row. If cross-row aggregation or state maintenance is needed, should use Python UDAF."}),"\n",(0,t.jsx)(e.h4,{id:"q5-how-to-limit-udtf-output-row-count",children:"Q5: How to limit UDTF output row count?"}),"\n",(0,t.jsx)(e.p,{children:"A: Add counter or conditional judgment in function:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"def limited_udtf(data):\n    max_rows = 1000\n    count = 0\n    for item in data.split(','):\n        if count >= max_rows:\n            break\n        yield (item,)\n        count += 1\n"})}),"\n",(0,t.jsx)(e.h4,{id:"q6-are-there-limitations-on-udtf-output-data-types",children:"Q6: Are there limitations on UDTF output data types?"}),"\n",(0,t.jsxs)(e.p,{children:["A: UDTF supports all Doris data types, including basic types (INT, STRING, DOUBLE, etc.) and complex types (ARRAY, STRUCT, MAP, etc.). Output type must be explicitly defined in ",(0,t.jsx)(e.code,{children:"RETURNS ARRAY<...>"}),"."]}),"\n",(0,t.jsx)(e.h4,{id:"q7-can-external-resources-be-accessed-in-udtf",children:"Q7: Can external resources be accessed in UDTF?"}),"\n",(0,t.jsxs)(e.p,{children:["A: Technically possible, but ",(0,t.jsx)(e.strong,{children:"strongly not recommended"}),". UDTF should be purely functional, only process based on input parameters. Accessing external resources (databases, files, networks) will cause performance issues and unpredictable behavior."]}),"\n",(0,t.jsx)(e.h2,{id:"python-udfudafudtf-environment-configuration-and-multi-version-management",children:"Python UDF/UDAF/UDTF Environment Configuration and Multi-Version Management"}),"\n",(0,t.jsx)(e.h3,{id:"python-environment-management",children:"Python Environment Management"}),"\n",(0,t.jsxs)(e.p,{children:["Before using Python UDF/UDAF/UDTF, please ensure that the Backend (BE) nodes of Doris have properly configured the Python runtime environment. Doris supports managing Python environments through ",(0,t.jsx)(e.strong,{children:"Conda"})," or ",(0,t.jsx)(e.strong,{children:"Virtual Environment (venv)"}),", allowing different UDFs to use different versions of Python interpreters and dependency libraries."]}),"\n",(0,t.jsx)(e.p,{children:"Doris provides two Python environment management methods:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Conda Mode"}),": Use Miniconda/Anaconda to manage multi-version environments"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Venv Mode"}),": Use Python's built-in virtual environment (venv) to manage multi-version environments"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"installation-and-usage-of-third-party-libraries",children:"Installation and Usage of Third-Party Libraries"}),"\n",(0,t.jsxs)(e.p,{children:["Python UDF, UDAF, and UDTF can all use third-party libraries. However, due to Doris's distributed nature, third-party libraries must be uniformly installed on ",(0,t.jsx)(e.strong,{children:"all BE nodes"}),", otherwise some nodes will fail to execute."]}),"\n",(0,t.jsx)(e.h4,{id:"installation-steps",children:"Installation Steps"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Install dependencies on each BE node"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Install using pip\npip install numpy pandas requests\n\n# Or install using conda\nconda install numpy pandas requests -y\n"})}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Import and use in functions"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"import numpy as np\nimport pandas as pd\n\n# Use in UDF/UDAF/UDTF functions\ndef my_function(x):\n    return np.sqrt(x)\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.admonition,{title:"Note",type:"caution",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsxs)(e.strong,{children:[(0,t.jsx)(e.code,{children:"pandas"})," and ",(0,t.jsx)(e.code,{children:"pyarrow"})," are mandatory dependencies"]}),", must be pre-installed in all Python environments, otherwise Python UDF/UDAF/UDTF cannot run"]}),"\n",(0,t.jsxs)(e.li,{children:["Must install same version dependencies on ",(0,t.jsx)(e.strong,{children:"all BE nodes"}),", otherwise some nodes will fail to execute"]}),"\n",(0,t.jsx)(e.li,{children:"Installation path must match Python runtime environment used by corresponding UDF/UDAF/UDTF"}),"\n",(0,t.jsx)(e.li,{children:"Recommend using virtual environments or Conda to manage dependencies, avoid conflicts with system Python environment"}),"\n"]})}),"\n",(0,t.jsx)(e.h3,{id:"be-configuration-parameters",children:"BE Configuration Parameters"}),"\n",(0,t.jsxs)(e.p,{children:["Set the following parameters in the ",(0,t.jsx)(e.code,{children:"be.conf"})," configuration file on all BE nodes, and ",(0,t.jsx)(e.strong,{children:"restart BE"})," to make the configuration take effect."]}),"\n",(0,t.jsx)(e.h4,{id:"configuration-parameter-description",children:"Configuration Parameter Description"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Parameter Name"}),(0,t.jsx)(e.th,{children:"Type"}),(0,t.jsx)(e.th,{children:"Possible Values"}),(0,t.jsx)(e.th,{children:"Default Value"}),(0,t.jsx)(e.th,{children:"Description"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"enable_python_udf_support"})}),(0,t.jsx)(e.td,{children:"bool"}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"true"})," / ",(0,t.jsx)(e.code,{children:"false"})]}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"false"})}),(0,t.jsx)(e.td,{children:"Whether to enable Python UDF functionality"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"python_env_mode"})}),(0,t.jsx)(e.td,{children:"string"}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"conda"})," / ",(0,t.jsx)(e.code,{children:"venv"})]}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:'""'})}),(0,t.jsx)(e.td,{children:"Python multi-version environment management method"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"python_conda_root_path"})}),(0,t.jsx)(e.td,{children:"string"}),(0,t.jsx)(e.td,{children:"Directory path"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:'""'})}),(0,t.jsxs)(e.td,{children:["Root directory of Miniconda",(0,t.jsx)(e.br,{}),"Only effective when ",(0,t.jsx)(e.code,{children:"python_env_mode = conda"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"python_venv_root_path"})}),(0,t.jsx)(e.td,{children:"string"}),(0,t.jsx)(e.td,{children:"Directory path"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"${DORIS_HOME}/lib/udf/python"})}),(0,t.jsxs)(e.td,{children:["Root directory for venv multi-version management",(0,t.jsx)(e.br,{}),"Only effective when ",(0,t.jsx)(e.code,{children:"python_env_mode = venv"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"python_venv_interpreter_paths"})}),(0,t.jsx)(e.td,{children:"string"}),(0,t.jsxs)(e.td,{children:["Path list (separated by ",(0,t.jsx)(e.code,{children:":"}),")"]}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:'""'})}),(0,t.jsxs)(e.td,{children:["Directory list of available Python interpreters",(0,t.jsx)(e.br,{}),"Only effective when ",(0,t.jsx)(e.code,{children:"python_env_mode = venv"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"max_python_process_num"})}),(0,t.jsx)(e.td,{children:"int32"}),(0,t.jsx)(e.td,{children:"Integer"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"0"})}),(0,t.jsxs)(e.td,{children:["Maximum number of processes in Python Server process pool",(0,t.jsx)(e.br,{}),(0,t.jsx)(e.code,{children:"0"})," means using CPU core count as default value, users can set other positive integers to override default value"]})]})]})]}),"\n",(0,t.jsx)(e.h3,{id:"method-1-using-conda-to-manage-python-environment",children:"Method 1: Using Conda to Manage Python Environment"}),"\n",(0,t.jsx)(e.h4,{id:"1-configure-be",children:"1. Configure BE"}),"\n",(0,t.jsxs)(e.p,{children:["Add the following configuration in ",(0,t.jsx)(e.code,{children:"be.conf"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-properties",children:"## be.conf\nenable_python_udf_support = true\npython_env_mode = conda\npython_conda_root_path = /path/to/miniconda3\n"})}),"\n",(0,t.jsx)(e.h4,{id:"2-environment-search-rules",children:"2. Environment Search Rules"}),"\n",(0,t.jsxs)(e.p,{children:["Doris will search for Conda environments matching the ",(0,t.jsx)(e.code,{children:"runtime_version"})," in UDF under the ",(0,t.jsx)(e.code,{children:"${python_conda_root_path}/envs/"})," directory."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Matching Rules"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"runtime_version"})," ",(0,t.jsx)(e.strong,{children:"must fill in the complete version number of Python version"}),", in the format of ",(0,t.jsx)(e.code,{children:"x.x.x"})," or ",(0,t.jsx)(e.code,{children:"x.x.xx"}),", such as ",(0,t.jsx)(e.code,{children:'"3.9.18"'}),", ",(0,t.jsx)(e.code,{children:'"3.12.11"'})]}),"\n",(0,t.jsxs)(e.li,{children:["Doris will traverse all Conda environments and check whether the actual version of the Python interpreter in each environment exactly matches ",(0,t.jsx)(e.code,{children:"runtime_version"})]}),"\n",(0,t.jsxs)(e.li,{children:["If no matching environment is found, an error will be reported: ",(0,t.jsx)(e.code,{children:"Python environment with version x.x.x not found"})]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Examples"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["If UDF specifies ",(0,t.jsx)(e.code,{children:'runtime_version = "3.9.18"'}),", Doris will search for an environment with Python version 3.9.18 in all environments"]}),"\n",(0,t.jsxs)(e.li,{children:["The environment name can be arbitrary (such as ",(0,t.jsx)(e.code,{children:"py39"}),", ",(0,t.jsx)(e.code,{children:"my-env"}),", ",(0,t.jsx)(e.code,{children:"data-science"}),", etc.), as long as the Python version in that environment is 3.9.18"]}),"\n",(0,t.jsxs)(e.li,{children:["Must fill in complete version number, cannot use version prefix, such as ",(0,t.jsx)(e.code,{children:'"3.9"'})," or ",(0,t.jsx)(e.code,{children:'"3.12"'})]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"3-directory-structure-diagram",children:"3. Directory Structure Diagram"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"## Doris BE Node Filesystem Structure (Conda Mode)\n\n/path/to/miniconda3                  \u2190 python_conda_root_path (configured by be.conf)\n\u2502\n\u251C\u2500\u2500 bin/\n\u2502   \u251C\u2500\u2500 conda                        \u2190 conda command-line tool (used by operations)\n\u2502   \u2514\u2500\u2500 ...                          \u2190 Other conda tools\n\u2502\n\u251C\u2500\u2500 envs/                            \u2190 All Conda environments directory\n\u2502   \u2502\n\u2502   \u251C\u2500\u2500 py39/                        \u2190 Conda environment 1 (created by user)\n\u2502   \u2502   \u251C\u2500\u2500 bin/\n\u2502   \u2502   \u2502   \u251C\u2500\u2500 python               \u2190 Python 3.9 interpreter (directly called by Doris)\n\u2502   \u2502   \u2502   \u251C\u2500\u2500 pip\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502   \u251C\u2500\u2500 lib/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 python3.9/\n\u2502   \u2502   \u2502       \u2514\u2500\u2500 site-packages/   \u2190 Third-party dependencies for this environment (e.g., pandas, pyarrow)\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502\n\u2502   \u251C\u2500\u2500 py312/                       \u2190 Conda environment 2 (created by user)\n\u2502   \u2502   \u251C\u2500\u2500 bin/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 python               \u2190 Python 3.12 interpreter\n\u2502   \u2502   \u2514\u2500\u2500 lib/\n\u2502   \u2502       \u2514\u2500\u2500 python3.12/\n\u2502   \u2502           \u2514\u2500\u2500 site-packages/   \u2190 Pre-installed dependencies (e.g., torch, sklearn)\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 ml-env/                      \u2190 Semantic environment name (recommended)\n\u2502       \u251C\u2500\u2500 bin/\n\u2502       \u2502   \u2514\u2500\u2500 python               \u2190 Possibly Python 3.12 + GPU dependencies\n\u2502       \u2514\u2500\u2500 lib/\n\u2502           \u2514\u2500\u2500 python3.12/\n\u2502               \u2514\u2500\u2500 site-packages/\n\u2502\n\u2514\u2500\u2500 ...\n"})}),"\n",(0,t.jsx)(e.h4,{id:"4-create-conda-environment",children:"4. Create Conda Environment"}),"\n",(0,t.jsx)(e.admonition,{title:"Note",type:"caution",children:(0,t.jsxs)(e.p,{children:["Doris Python UDF/UDAF/UDTF functionality ",(0,t.jsx)(e.strong,{children:"mandatorily depends on"})," ",(0,t.jsx)(e.code,{children:"pandas"})," and ",(0,t.jsx)(e.code,{children:"pyarrow"})," libraries, which ",(0,t.jsx)(e.strong,{children:"must"})," be pre-installed in all Python environments, otherwise UDF will not run normally."]})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Execute the following commands on all BE nodes"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Install Miniconda (if not already installed)\nwget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh\nbash Miniconda3-latest-Linux-x86_64.sh -b -p /opt/miniconda3\n\n# Create Python 3.9.18 environment and install required dependencies (environment name can be customized)\n/opt/miniconda3/bin/conda create -n py39 python=3.9.18 pandas pyarrow -y\n\n# Create Python 3.12.11 environment and pre-install dependencies (Important: Python version must be precisely specified, and pandas and pyarrow must be installed)\n/opt/miniconda3/bin/conda create -n py312 python=3.12.11 pandas pyarrow numpy -y\n\n# Activate environment and install additional dependencies\nsource /opt/miniconda3/bin/activate py39\nconda install requests beautifulsoup4 -y\nconda deactivate\n\n# Verify Python version in environment\n/opt/miniconda3/envs/py39/bin/python --version     # Should output: Python 3.9.18\n/opt/miniconda3/envs/py312/bin/python --version    # Should output: Python 3.12.11\n"})}),"\n",(0,t.jsx)(e.h4,{id:"5-use-in-udf",children:"5. Use in UDF"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'-- Use Python 3.12.11 environment\nCREATE FUNCTION py_ml_predict(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.12.11",  -- Must specify complete version number, matching Python 3.12.11\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(x):\n    # Can use libraries installed in Python 3.12.11 environment\n    return x * 2\n$$;\n\n-- Note: Whether the environment name is py312 or ml-env, as long as the Python version is 3.12.11, it can be used\n-- runtime_version only cares about Python version, not environment name\n'})}),"\n",(0,t.jsx)(e.h3,{id:"method-2-using-venv-to-manage-python-environment",children:"Method 2: Using Venv to Manage Python Environment"}),"\n",(0,t.jsx)(e.h4,{id:"1-configure-be-1",children:"1. Configure BE"}),"\n",(0,t.jsxs)(e.p,{children:["Add the following configuration in ",(0,t.jsx)(e.code,{children:"be.conf"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-properties",children:"## be.conf\nenable_python_udf_support = true\npython_env_mode = venv\npython_venv_root_path = /doris/python_envs\npython_venv_interpreter_paths = /opt/python3.9/bin/python3.9:/opt/python3.12/bin/python3.12\n"})}),"\n",(0,t.jsx)(e.h4,{id:"2-configuration-parameter-description",children:"2. Configuration Parameter Description"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"python_venv_root_path"})}),": Root directory of virtual environments, all venv environments will be created under this directory"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"python_venv_interpreter_paths"})}),": List of absolute paths to Python interpreters separated by English colon ",(0,t.jsx)(e.code,{children:":"}),". Doris will check the version of each interpreter and match the corresponding interpreter according to the ",(0,t.jsx)(e.code,{children:"runtime_version"})," (complete version number, such as ",(0,t.jsx)(e.code,{children:'"3.9.18"'}),") specified in UDF"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"3-directory-structure-diagram-1",children:"3. Directory Structure Diagram"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'## Doris BE Configuration (be.conf)\npython_venv_interpreter_paths = "/opt/python3.9/bin/python3.9:/opt/python3.12/bin/python3.12"\npython_venv_root_path = /doris/python_envs\n\n/opt/python3.9/bin/python3.9                \u2190 System pre-installed Python 3.9\n/opt/python3.12/bin/python3.12              \u2190 System pre-installed Python 3.12\n\n/doris/python_envs/                         \u2190 Root directory of all virtual environments (python_venv_root_path)\n\u2502\n\u251C\u2500\u2500 python3.9.18/                           \u2190 Environment ID = Python complete version\n\u2502   \u251C\u2500\u2500 bin/\n\u2502   \u2502   \u251C\u2500\u2500 python\n\u2502   \u2502   \u2514\u2500\u2500 pip\n\u2502   \u2514\u2500\u2500 lib/python3.9/site-packages/\n\u2502       \u251C\u2500\u2500 pandas==2.1.0\n\u2502       \u2514\u2500\u2500 pyarrow==15.0.0\n\u2502\n\u251C\u2500\u2500 python3.12.11/                          \u2190 Python 3.12.11 environment\n\u2502   \u251C\u2500\u2500 bin/\n\u2502   \u2502   \u251C\u2500\u2500 python\n\u2502   \u2502   \u2514\u2500\u2500 pip\n\u2502   \u2514\u2500\u2500 lib/python3.12/site-packages/\n\u2502       \u251C\u2500\u2500 pandas==2.1.0\n\u2502       \u2514\u2500\u2500 pyarrow==15.0.0\n\u2502\n\u2514\u2500\u2500 python3.12.10/                          \u2190 Python 3.12.10 environment\n    \u2514\u2500\u2500 ...\n'})}),"\n",(0,t.jsx)(e.h4,{id:"4-create-venv-environment",children:"4. Create Venv Environment"}),"\n",(0,t.jsx)(e.admonition,{title:"Note",type:"caution",children:(0,t.jsxs)(e.p,{children:["Doris Python UDF/UDAF/UDTF functionality ",(0,t.jsx)(e.strong,{children:"mandatorily depends on"})," ",(0,t.jsx)(e.code,{children:"pandas"})," and ",(0,t.jsx)(e.code,{children:"pyarrow"})," libraries, which ",(0,t.jsx)(e.strong,{children:"must"})," be pre-installed in all Python environments, otherwise UDF will not run normally."]})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Execute the following commands on all BE nodes"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Create virtual environment root directory\nmkdir -p /doris/python_envs\n\n# Use Python 3.9 to create virtual environment\n/opt/python3.9/bin/python3.9 -m venv /doris/python_envs/python3.9.18\n\n# Activate environment and install required dependencies (pandas and pyarrow must be installed)\nsource /doris/python_envs/python3.9.18/bin/activate\npip install pandas pyarrow numpy\ndeactivate\n\n# Use Python 3.12 to create virtual environment\n/opt/python3.12/bin/python3.12 -m venv /doris/python_envs/python3.12.11\n\n# Activate environment and install required dependencies (pandas and pyarrow must be installed)\nsource /doris/python_envs/python3.12.11/bin/activate\npip install pandas pyarrow numpy scikit-learn\ndeactivate\n"})}),"\n",(0,t.jsx)(e.h4,{id:"5-use-in-udf-1",children:"5. Use in UDF"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'-- Use Python 3.9.18 environment\nCREATE FUNCTION py_clean_text(STRING)\nRETURNS STRING\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.9.18",  -- Must specify complete version number, matching Python 3.9.18\n    "always_nullable" = "true"\n)\nAS $$\ndef evaluate(text):\n    return text.strip().upper()\n$$;\n\n-- Use Python 3.12.11 environment\nCREATE FUNCTION py_calculate(DOUBLE)\nRETURNS DOUBLE\nPROPERTIES (\n    "type" = "PYTHON_UDF",\n    "symbol" = "evaluate",\n    "runtime_version" = "3.12.11",  -- Must specify complete version number, matching Python 3.12.11\n    "always_nullable" = "true"\n)\nAS $$\nimport numpy as np\n\ndef evaluate(x):\n    return np.sqrt(x)\n$$;\n'})}),"\n",(0,t.jsx)(e.h3,{id:"environment-management-best-practices",children:"Environment Management Best Practices"}),"\n",(0,t.jsx)(e.h4,{id:"1-choose-appropriate-management-method",children:"1. Choose Appropriate Management Method"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Scenario"}),(0,t.jsx)(e.th,{children:"Recommended Method"}),(0,t.jsx)(e.th,{children:"Reason"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Need to frequently switch Python versions"}),(0,t.jsx)(e.td,{children:"Conda"}),(0,t.jsx)(e.td,{children:"Good environment isolation, simple dependency management"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Already have Conda environment"}),(0,t.jsx)(e.td,{children:"Conda"}),(0,t.jsx)(e.td,{children:"Can directly reuse existing environment"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Limited system resources"}),(0,t.jsx)(e.td,{children:"Venv"}),(0,t.jsx)(e.td,{children:"Small footprint, fast startup"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Already have Python system environment"}),(0,t.jsx)(e.td,{children:"Venv"}),(0,t.jsx)(e.td,{children:"No need to install additional Conda"})]})]})]}),"\n",(0,t.jsx)(e.h4,{id:"2-environment-consistency-requirements",children:"2. Environment Consistency Requirements"}),"\n",(0,t.jsxs)(e.admonition,{title:"Note",type:"caution",children:[(0,t.jsxs)(e.p,{children:["All BE nodes must be configured with ",(0,t.jsx)(e.strong,{children:"exactly the same"})," Python environment, including:"]}),(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Python version must be consistent"}),"\n",(0,t.jsx)(e.li,{children:"Installed dependency packages and their versions must be consistent"}),"\n",(0,t.jsx)(e.li,{children:"Environment directory paths must be consistent"}),"\n"]})]}),"\n",(0,t.jsx)(e.h3,{id:"notes",children:"Notes"}),"\n",(0,t.jsx)(e.h4,{id:"1-configuration-modification-takes-effect",children:"1. Configuration Modification Takes Effect"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["After modifying ",(0,t.jsx)(e.code,{children:"be.conf"}),", ",(0,t.jsx)(e.strong,{children:"must restart BE process"})," to take effect"]}),"\n",(0,t.jsx)(e.li,{children:"Please ensure configuration is correct before restart to avoid service interruption"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"2-path-verification",children:"2. Path Verification"}),"\n",(0,t.jsx)(e.p,{children:"Please ensure paths are correct before configuration:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Conda mode: Verify conda path\nls -la /opt/miniconda3/bin/conda\n/opt/miniconda3/bin/conda env list\n\n# Venv mode: Verify interpreter path\n/opt/python3.9/bin/python3.9 --version\n/opt/python3.12/bin/python3.12 --version\n"})}),"\n",(0,t.jsx)(e.h4,{id:"3-permission-settings",children:"3. Permission Settings"}),"\n",(0,t.jsx)(e.p,{children:"Ensure Doris BE process has permission to access Python environment directory:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Conda mode\nchmod -R 755 /opt/miniconda3\n\n# Venv mode\nchmod -R 755 /doris/python_envs\nchown -R doris:doris /doris/python_envs  # Assuming BE process user is doris\n"})}),"\n",(0,t.jsx)(e.h4,{id:"4-resource-limitations",children:"4. Resource Limitations"}),"\n",(0,t.jsx)(e.p,{children:"Adjust Python process pool parameters according to actual needs:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-properties",children:"## Confirm using CPU core count (recommended, max_python_process_num = 0)\nmax_python_process_num = 0\n\n## High concurrency scenario, manually specify process count\nmax_python_process_num = 128\n\n## Resource-constrained scenario, limit process count\nmax_python_process_num = 32\n"})}),"\n",(0,t.jsx)(e.h3,{id:"environment-verification",children:"Environment Verification"}),"\n",(0,t.jsx)(e.p,{children:"Verify on each BE node whether the environment is correct:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'# Conda mode\n/opt/miniconda3/envs/py39/bin/python --version\n/opt/miniconda3/envs/py39/bin/python -c "import pandas; print(pandas.__version__)"\n\n# Venv mode\n/doris/python_envs/python3.9.18/bin/python --version\n/doris/python_envs/python3.9.18/bin/python -c "import pandas; print(pandas.__version__)"\n'})}),"\n",(0,t.jsx)(e.h3,{id:"common-problem-troubleshooting",children:"Common Problem Troubleshooting"}),"\n",(0,t.jsx)(e.h4,{id:"q1-udf-call-prompts-python-environment-not-found",children:'Q1: UDF call prompts "Python environment not found"'}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Reason"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Version specified by ",(0,t.jsx)(e.code,{children:"runtime_version"})," does not exist in the system"]}),"\n",(0,t.jsx)(e.li,{children:"Environment path configuration is incorrect"}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Check Conda environment list\nconda env list\n\n# Check if Venv interpreter exists\nls -la /opt/python3.9/bin/python3.9\n\n# Check BE configuration\ngrep python /path/to/be.conf\n"})}),"\n",(0,t.jsx)(e.h4,{id:"q2-udf-call-prompts-modulenotfounderror-no-module-named-xxx",children:"Q2: UDF call prompts \"ModuleNotFoundError: No module named 'xxx'\""}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Reason"}),": Required dependency package not installed in Python environment"]}),"\n",(0,t.jsx)(e.h4,{id:"q3-execution-results-inconsistent-across-different-be-nodes",children:"Q3: Execution results inconsistent across different BE nodes"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Reason"}),": Python environment or dependency versions inconsistent across BE nodes"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"Check Python version and dependency versions on all nodes."}),"\n",(0,t.jsx)(e.li,{children:"Verify environment consistency across all nodes."}),"\n",(0,t.jsxs)(e.li,{children:["Use ",(0,t.jsx)(e.code,{children:"requirements.txt"})," (pip) or ",(0,t.jsx)(e.code,{children:"environment.yml"})," (Conda) to deploy environments; common usage examples:"]}),"\n"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Using ",(0,t.jsx)(e.code,{children:"requirements.txt"})," (pip):"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Export dependencies from development environment\npip freeze > requirements.txt\n# On BE nodes, install with target Python interpreter\n/path/to/python -m pip install -r requirements.txt\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Using ",(0,t.jsx)(e.code,{children:"environment.yml"})," (Conda):"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# export dependencies\nconda env export --from-history -n py312 -f environment.yml\n# On BE nodes, create the environment\nconda env create -f environment.yml -n py312\n# Or update an existing environment\nconda env update -f environment.yml -n py312\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Notes"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Ensure ",(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"pandas"})})," and ",(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"pyarrow"})})," are included in the dependency files and installed with the same versions on all BE nodes."]}),"\n",(0,t.jsxs)(e.li,{children:["When installing, use the Python interpreter or Conda path configured for Doris (for example, ",(0,t.jsx)(e.code,{children:"/opt/miniconda3/bin/conda"})," or the venv interpreter path used by BE)."]}),"\n",(0,t.jsx)(e.li,{children:"Keep dependency files under version control or on shared storage so operations can distribute them consistently to all BE nodes."}),"\n",(0,t.jsxs)(e.li,{children:["References: ",(0,t.jsx)(e.a,{href:"https://pip.pypa.io/en/stable/cli/pip/",children:"pip docs"}),"\uFF0C",(0,t.jsx)(e.a,{href:"https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#exporting-the-environment",children:"Conda export/import"})]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"q4-beconf-modification-not-effective",children:"Q4: be.conf modification not effective"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Possible Reason"}),": BE process not restarted"]}),"\n",(0,t.jsx)(e.h3,{id:"usage-limitations",children:"Usage Limitations"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Performance Considerations"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Python UDF performance is lower than built-in functions, recommended for scenarios with complex logic but small data volume"}),"\n",(0,t.jsx)(e.li,{children:"For large data volume processing, prioritize vectorized mode"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Type Limitations"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Does not support special types such as HLL, Bitmap"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Environment Isolation"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Same function name can be repeatedly defined in different databases"}),"\n",(0,t.jsxs)(e.li,{children:["Call time should specify database name (such as ",(0,t.jsx)(e.code,{children:"db.func()"}),") to avoid ambiguity"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Concurrency Limitations"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Python UDF executes through process pool, concurrency is limited by ",(0,t.jsx)(e.code,{children:"max_python_process_num"})]}),"\n",(0,t.jsx)(e.li,{children:"High concurrency scenarios need to appropriately increase this parameter"}),"\n"]}),"\n"]}),"\n"]})]})}function h(n={}){let{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(c,{...n})}):c(n)}},250065:function(n,e,i){i.d(e,{Z:function(){return o},a:function(){return l}});var s=i(667294);let t={},r=s.createContext(t);function l(n){let e=s.useContext(r);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);