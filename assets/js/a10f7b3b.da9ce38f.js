"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["646877"],{681423:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>o,metadata:()=>t,assets:()=>c,toc:()=>a,contentTitle:()=>l});var t=JSON.parse('{"id":"developer-guide/regression-testing","title":"Regression Testing","description":"\x3c!--","source":"@site/community/developer-guide/regression-testing.md","sourceDirName":"developer-guide","slug":"/developer-guide/regression-testing","permalink":"/community/developer-guide/regression-testing","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Regression Testing","language":"en"},"sidebar":"community","previous":{"title":"Github Checks","permalink":"/community/developer-guide/github-checks"},"next":{"title":"Doris Team","permalink":"/community/team"}}'),i=s("785893"),r=s("250065");let o={title:"Regression Testing",language:"en"},l="Regression Testing",c={},a=[{value:"Basic Concepts",id:"basic-concepts",level:2},{value:"Steps",id:"steps",level:2},{value:"Directory Structure",id:"directory-structure",level:2},{value:"Default Configurations of the Framework",id:"default-configurations-of-the-framework",level:2},{value:"Steps to Write Test Cases",id:"steps-to-write-test-cases",level:2},{value:"Action",id:"action",level:2},{value:"sql action",id:"sql-action",level:3},{value:"qt action",id:"qt-action",level:3},{value:"test action",id:"test-action",level:3},{value:"explain action",id:"explain-action",level:3},{value:"streamLoad action",id:"streamload-action",level:3},{value:"Other Actions",id:"other-actions",level:3},{value:"Startup Script Examples",id:"startup-script-examples",level:2},{value:"Generate <code>.out</code> File Based on the Query Result",id:"generate-out-file-based-on-the-query-result",level:2},{value:"Suite Plug-in",id:"suite-plug-in",level:2},{value:"CI/CD Support",id:"cicd-support",level:2},{value:"TeamCity",id:"teamcity",level:3},{value:"E2E Test with External Data Sources",id:"e2e-test-with-external-data-sources",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"regression-testing",children:"Regression Testing"})}),"\n",(0,i.jsx)(n.h2,{id:"basic-concepts",children:"Basic Concepts"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Suite"}),": A test case (the file name)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Group"}),": A test set (the directory that the test case belongs to)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Action"}),": An encapsulated test action, such as ",(0,i.jsx)(n.code,{children:"sql_action"}),"  for SQL execution, ",(0,i.jsx)(n.code,{children:"test_action"}),"  for result verification, and ",(0,i.jsx)(n.code,{children:"streamLoad_action"}),"  for data ingestion."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"steps",children:"Steps"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Get the clusters ready"}),"\n",(0,i.jsxs)(n.li,{children:["Modify the configuration files ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/conf/regression-conf.groovy"}),", set items, such as JDBC URL and user"]}),"\n",(0,i.jsx)(n.li,{children:"Create the test case files and write the test cases"}),"\n",(0,i.jsxs)(n.li,{children:["If a test case includes a ",(0,i.jsx)(n.code,{children:"qt"})," Action, you also need to create the relevant data files. For example, the case ",(0,i.jsx)(n.code,{children:"suites/demo/qt_action.groovy"})," will require a TSV file ",(0,i.jsx)(n.code,{children:"data/demo/qt_action.out"})," for output verification."]}),"\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/run-regression-test.sh"})," to test all cases, or run ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/run-regression-test.sh --run <suiteName>"}),'  to test a few cases. For more examples, please refer to the "Startup Script Examples" section on this page.']}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,i.jsx)(n.p,{children:"Key files and directories to pay attention to:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"run-regression-test.sh"}),": Startup script"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"regression-conf.groovy"}),": Default configurations for regression test"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data"}),": where the the input and output data is"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"suites"}),": where test cases are"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"./${DORIS_HOME}\n    |-- **run-regression-test.sh**           Startup script for regression test\n    |-- regression-test\n    |   |-- plugins                          Plug-ins\n    |   |-- conf\n    |   |   |-- logback.xml                  Log configurations\n    |   |   |-- **regression-conf.groovy**   Default configurations\n    |   |\n    |   |-- framework                        framework source code for regression test\n    |   |-- **data**                         Input and output data files of test cases\n    |   |   |-- demo                         Input and output data files of demo\n    |   |   |-- correctness                  Input and output data files of correctness test cases\n    |   |   |-- performance                  Input and output data files of performance test cases\n    |   |   |-- utils                        Input and output data files of other utilities\n    |   |\n    |   |-- **suites**                       Test cases for regression testing\n    |       |-- demo                         Demo of test cases\n    |       |-- correctness                  Test cases of correctness tests\n    |       |-- performance                  Test cases of performance tests\n    |       |-- utils                        Other utilities\n    |\n    |-- output\n        |-- regression-test\n            |-- log                          Logs of regression testing\n"})}),"\n",(0,i.jsx)(n.h2,{id:"default-configurations-of-the-framework",children:"Default Configurations of the Framework"}),"\n",(0,i.jsx)(n.p,{children:"Modify the JDBC and FE configurations based on the case."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'/* ============ Key parts to pay attention to ============ */\n// The default database, which will be created if the user does not create a database\ndefaultDb = "regression_test"\n\n// JDBC configurations\njdbcUrl = "jdbc:mysql://127.0.0.1:9030/?"\njdbcUser = "root"\njdbcPassword = ""\n\n// FE address configurations, used for Stream Load\nfeHttpAddress = "127.0.0.1:8030"\nfeHttpUser = "root"\nfeHttpPassword = ""\n\n/* ============ Configurations that usually do not require modifications ============ */\n\n// DORIS_HOME is loaded by run-regression-test.sh\n// which is java -DDORIS_HOME=./\n\n// Set the path for the test cases\nsuitePath = "${DORIS_HOME}/regression-test/suites"\n// Set the path for the input and output data\ndataPath = "${DORIS_HOME}/regression-test/data"\n// Set the path for the plug-ins\npluginPath = "${DORIS_HOME}/regression-test/plugins"\n\n// By default, all groups will be read. The groups are separated by comma. For example, "demo,performance".\n// This is dynamically specified and overwritten via run-regression-test.sh --run -g\ntestGroups = ""\n// By default, all suites will be read. This is dynamically specified and overwritten via run-regression-test.sh --run -s\ntestSuites = ""\n// Directories specified in this parameter will be loaded by default. It can be dynamically specified and overwritten via run-regression-test.sh --run -d\ntestDirectories = ""\n\n// Groups specified in this parameter will be excluded. It can be dynamically specified and overwritten via run-regression-test.sh --run -xg\nexcludeGroups = ""\n// Suites specified in this parameter will be excluded. It can be dynamically specified and overwritten via run-regression-test.sh --run -xs\nexcludeSuites = ""\n// Directories specified in this parameter will be excluded. It can be dynamically specified and overwritten via run-regression-test.sh --run -xd\nexcludeDirectories = ""\n\n// Other self-defined configurations\ncustomConf1 = "test_custom_conf_value"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"steps-to-write-test-cases",children:"Steps to Write Test Cases"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Enter the ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test"})," directory"]}),"\n",(0,i.jsxs)(n.li,{children:["Choose a directory based on the test. For correctness test, place the test in ",(0,i.jsx)(n.code,{children:"suites/correctness"}),"; for performance test, put the test case in ",(0,i.jsx)(n.code,{children:"suites/performance"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Create a groovy test case file, and add a few ",(0,i.jsx)(n.code,{children:"Action"})," for testing."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"action",children:"Action"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Action"})," refers to a test action, which is defined by DSL and provided in the test framework."]}),"\n",(0,i.jsx)(n.h3,{id:"sql-action",children:"sql action"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.code,{children:"sql_action"})," is used to commit SQL and obtain results. If the query fails, an error will be thrown."]}),"\n",(0,i.jsx)(n.p,{children:"Parameters:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"String sql: the input SQL string"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"return List<List<Object>>"}),": the query result. If it is DDL/DML, a result of one row and one column will be returned and the value will be updateRowCount."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can find the following sample code in ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/sql_action.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("sql_action", "demo") {\n    // execute sql and ignore result\n    sql "show databases"\n\n    // execute sql and get result, outer List denote rows, inner List denote columns in a single row\n    List<List<Object>> tables = sql "show tables"\n\n    // assertXxx() will invoke junit5\'s Assertions.assertXxx() dynamically\n    assertTrue(tables.size() >= 0) // test rowCount >= 0\n\n    // syntax error\n    try {\n        sql "a b c d e"\n        throw new IllegalStateException("Should be syntax error")\n    } catch (java.sql.SQLException t) {\n        assertTrue(true)\n    }\n\n    def testTable = "test_sql_action1"\n\n    try {\n        sql "DROP TABLE IF EXISTS ${testTable}"\n\n        // multi-line sql\n        def result1 = sql """\n                        CREATE TABLE IF NOT EXISTS ${testTable} (\n                            id int\n                        )\n                        DISTRIBUTED BY HASH(id) BUCKETS 1\n                        PROPERTIES (\n                          "replication_num" = "1"\n                        ) \n                        """\n\n        // DDL/DML return 1 row and 1 column, the only value is update row count\n        assertTrue(result1.size() == 1)\n        assertTrue(result1[0].size() == 1)\n        assertTrue(result1[0][0] == 0, "Create table should update 0 rows")\n\n        def result2 = sql "INSERT INTO test_sql_action1 values(1), (2), (3)"\n        assertTrue(result2.size() == 1)\n        assertTrue(result2[0].size() == 1)\n        assertTrue(result2[0][0] == 3, "Insert should update 3 rows")\n    } finally {\n        /**\n         * try_xxx(args) means:\n         *\n         * try {\n         *    return xxx(args)\n         * } catch (Throwable t) {\n         *     // do nothing\n         *     return null\n         * }\n         */\n        try_sql("DROP TABLE IF EXISTS ${testTable}")\n\n        // you can see the error sql will not throw exception and return\n        try {\n            def errorSqlResult = try_sql("a b c d e f g")\n            assertTrue(errorSqlResult == null)\n        } catch (Throwable t) {\n            assertTrue(false, "Never catch exception")\n        }\n    }\n\n    // order_sql(sqlStr) equals to sql(sqlStr, isOrder=true)\n    // sort result by string dict\n    def list = order_sql """\n                select 2\n                union all\n                select 1\n                union all\n                select null\n                union all\n                select 15\n                union all\n                select 3\n                """\n\n    assertEquals(null, list[0][0])\n    assertEquals(1, list[1][0])\n    assertEquals(15, list[2][0])\n    assertEquals(2, list[3][0])\n    assertEquals(3, list[4][0])\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"qt-action",children:"qt action"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.code,{children:"qt_action"})," is used to commit SQL and verify the output results based on the ",(0,i.jsx)(n.code,{children:".out"})," TSV file."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"String sql: the input SQL string"}),"\n",(0,i.jsx)(n.li,{children:"return void"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can find the following sample code in ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/qt_action.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("qt_action", "demo") {\n    /**\n     * qt_xxx sql equals to quickTest(xxx, sql) in which xxx is tag.\n     * The result will be compared to the relevant file: ${DORIS_HOME}/regression_test/data/qt_action.out.\n     *\n     * If you want to generate .out tsv file, you can run -genOut or -forceGenOut.\n     * e.g\n     *   ${DORIS_HOME}/run-regression-test.sh --run qt_action -genOut\n     *   ${DORIS_HOME}/run-regression-test.sh --run qt_action -forceGenOut\n     */\n    qt_select "select 1, \'beijing\' union all select 2, \'shanghai\'"\n\n    qt_select2 "select 2"\n\n    // Order result by string dict then compare to .out file.\n    // order_qt_xxx sql equals to quickTest(xxx, sql, true).\n    order_qt_union_all  """\n                select 2\n                union all\n                select 1\n                union all\n                select null\n                union all\n                select 15\n                union all\n                select 3\n                """\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"test-action",children:"test action"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.code,{children:"test_action"})," is to test with more complicated verification rules, such as to verify the number of rows, execution time, and the existence of errors"]}),"\n",(0,i.jsx)(n.p,{children:"Parameters:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"String sql: the input SQL string"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"List<List<Object>> result"}),": provide a list to check if the output is equal to that list"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Iterator<Object> resultIterator"}),": provide an iterator to check if the output is equal to that iterator"]}),"\n",(0,i.jsxs)(n.li,{children:["String resultFile: provide a file URI (a relative path of a local file or a http(s) path) to check if the output is equal to the http response stream. The format is similar to that of the ",(0,i.jsx)(n.code,{children:".out"})," file, but there is no header or comment."]}),"\n",(0,i.jsx)(n.li,{children:"String exception: check if the error thrown includes certain strings"}),"\n",(0,i.jsx)(n.li,{children:"long rowNum: check the number of rows"}),"\n",(0,i.jsx)(n.li,{children:"long time: check if the execution time is shorter than this value, which is measured in millisecond"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Closure<List<List<Object>>, Throwable, Long, Long> check"}),": self-defined callback validation function, in which you can input the query result, error thrown, and response time. When there is a callback validation function, other verification methods will fail."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can find the following sample code in ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/test_action.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("test_action", "demo") {\n    test {\n        sql "abcdefg"\n        // check exception message contains\n        exception "errCode = 2, detailMessage = Syntax error"\n    }\n\n    test {\n        sql """\n            select *\n            from (\n                select 1 id\n                union all\n                select 2\n            ) a\n            order by id"""\n\n        // multi check condition\n\n        // check return 2 rows\n        rowNum 2\n        // execute time must <= 5000 millisecond\n        time 5000\n        // check result, must be 2 rows and 1 column, the first row is 1, second is 2\n        result(\n            [[1], [2]]\n        )\n    }\n\n    test {\n        sql "a b c d e f g"\n\n        // other check will not work because already declared a check callback\n        exception "aaaaaaaaa"\n\n        // callback\n        check { result, exception, startTime, endTime ->\n            // assertXxx() will invoke junit5\'s Assertions.assertXxx() dynamically\n            assertTrue(exception != null)\n        }\n    }\n\n    test {\n        sql  """\n                select 2\n                union all\n                select 1\n                union all\n                select null\n                union all\n                select 15\n                union all\n                select 3\n                """\n\n        check { result, ex, startTime, endTime ->\n            // same as order_sql(sqlStr)\n            result = sortRows(result)\n\n            assertEquals(null, result[0][0])\n            assertEquals(1, result[1][0])\n            assertEquals(15, result[2][0])\n            assertEquals(2, result[3][0])\n            assertEquals(3, result[4][0])\n        }\n    }\n\n    // execute sql and order query result, then compare to iterator\n    def selectValues = [1, 2, 3, 4]\n    test {\n        order true\n        sql selectUnionAll(selectValues)\n        resultIterator(selectValues.iterator())\n    }\n\n    // compare to data/demo/test_action.csv\n    test {\n        order true\n        sql selectUnionAll(selectValues)\n\n        // you can set to http://xxx or https://xxx\n        // and compare to http response body\n        resultFile "test_action.csv"\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"explain-action",children:"explain action"}),"\n",(0,i.jsxs)(n.p,{children:["An ",(0,i.jsx)(n.code,{children:"explain_action"})," is used to check if the returned string contains certain strings."]}),"\n",(0,i.jsx)(n.p,{children:"Parameters:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"String sql: the SQL that needs to be explained"}),"\n",(0,i.jsx)(n.li,{children:"String contains: check if certain strings are included. You can check for multiple strings at a time."}),"\n",(0,i.jsx)(n.li,{children:"String notContains: check if certain strings are not included. You can check for multiple strings at a time."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Closure<String> check"}),": self-defined callback validation function, by which you can obtain the returned string. When there is a callback validation function, other verification methods will fail."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Closure<String, Throwable, Long, Long> check"}),": self-defined callback validation function, by which you can obtain the error thrown and response time"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can find the following sample code in ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/explain_action.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("explain_action", "demo") {\n    explain {\n        sql("select 100")\n\n        // contains("OUTPUT EXPRS:<slot 0> 100\\n") && contains("PARTITION: UNPARTITIONED\\n")\n        contains "OUTPUT EXPRS:<slot 0> 100\\n"\n        contains "PARTITION: UNPARTITIONED\\n"\n    }\n\n    explain {\n        sql("select 100")\n\n        // contains(" 100\\n") && !contains("abcdefg") && !("1234567")\n        contains " 100\\n"\n        notContains "abcdefg"\n        notContains "1234567"\n    }\n\n    explain {\n        sql("select 100")\n        // simple callback\n        check { explainStr -> explainStr.contains("abcdefg") || explainStr.contains(" 100\\n") }\n    }\n\n    explain {\n        sql("a b c d e")\n        // callback with exception and time\n        check { explainStr, exception, startTime, endTime ->\n            // assertXxx() will invoke junit5\'s Assertions.assertXxx() dynamically\n            assertTrue(exception != null)\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"streamload-action",children:"streamLoad action"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.code,{children:"streamLoad_action"})," is used to ingest data."]}),"\n",(0,i.jsx)(n.p,{children:"Parameters:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"String db: database, set to the defaultDb in regression-conf.groovy"}),"\n",(0,i.jsx)(n.li,{children:"String table: table name"}),"\n",(0,i.jsx)(n.li,{children:"String file: the path of the file to be loaded. It can be a relative path under the data directory, or a HTTP URL."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Iterator<List<Object>> inputIterator"}),": the iterator to be loaded"]}),"\n",(0,i.jsx)(n.li,{children:"String inputText: the text to be loaded (rarely used)"}),"\n",(0,i.jsx)(n.li,{children:"InputStream inputStream: the stream to be loaded (rarely used)"}),"\n",(0,i.jsx)(n.li,{children:"long time: check if the exection time is shorter than this value, which is measure in millisecond"}),"\n",(0,i.jsx)(n.li,{children:"void set(String key, String value): set the header of the HTTP request for Stream Load, such as label and columnSeparator."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Closure<String, Throwable, Long, Long> check"}),": self-defined callback validation function, by which you can obtain the returned result, error thrown, and response time. When there is a callback validation function, other verification methods will fail."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can find the following sample code in ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/streamLoad_action.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("streamLoad_action", "demo") {\n\n    def tableName = "test_streamload_action1"\n\n    sql """\n            CREATE TABLE IF NOT EXISTS ${tableName} (\n                id int,\n                name varchar(255)\n            )\n            DISTRIBUTED BY HASH(id) BUCKETS 1\n            PROPERTIES (\n              "replication_num" = "1"\n            ) \n        """\n\n    streamLoad {\n        // you can skip declare db, because a default db already specify in ${DORIS_HOME}/conf/regression-conf.groovy\n        // db \'regression_test\'\n        table tableName\n\n        // default label is UUID:\n        // set \'label\' UUID.randomUUID().toString()\n\n        // default column_separator is specify in doris fe config, usually is \'\\t\'.\n        // this line change to \',\'\n        set \'column_separator\', \',\'\n\n        // relate to ${DORIS_HOME}/regression-test/data/demo/streamload_input.csv.\n        // also, you can stream load a http stream, e.g. http://xxx/some.csv\n        file \'streamload_input.csv\'\n\n        time 10000 // limit inflight 10s\n\n        // stream load action will check result, include Success status, and NumberTotalRows == NumberLoadedRows\n    }\n\n\n    // stream load 100 rows\n    def rowCount = 100\n    // range: [0, rowCount)\n    // or rangeClosed: [0, rowCount]\n    def rowIt = range(0, rowCount)\n            .mapToObj({i -> [i, "a_" + i]}) // change Long to List<Long, String>\n            .iterator()\n\n    streamLoad {\n        table tableName\n        // also, you can upload a memory iterator\n        inputIterator rowIt\n\n        // if declared a check callback, the default check condition will ignore.\n        // So you must check all condition\n        check { result, exception, startTime, endTime ->\n            if (exception != null) {\n                throw exception\n            }\n            log.info("Stream load result: ${result}".toString())\n            def json = parseJson(result)\n            assertEquals("success", json.Status.toLowerCase())\n            assertEquals(json.NumberTotalRows, json.NumberLoadedRows)\n            assertTrue(json.NumberLoadedRows > 0 && json.LoadBytes > 0)\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"other-actions",children:"Other Actions"}),"\n",(0,i.jsxs)(n.p,{children:["Other actions include thread, lazyCheck, events, connect, and selectUnionAll. You can find examples for them in ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"startup-script-examples",children:"Startup Script Examples"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'# View parameter descriptions for scripts\n./run-regression-test.sh h\n\n# View parameter descriptions for framework\n./run-regression-test.sh --run -h\n\n# Test all cases\n./run-regression-test.sh \n\n# Delete test framework compilation results and test logs\n./run-regression-test.sh --clean\n\n# Test the suite named "sql_action". Currently, the test case file suffix is the same as the suiteName, so the corresponding test case file in this case is sql_action.groovy.\n./run-regression-test.sh --run sql_action \n\n# Test the suite whose name contains \'sql\'. **Remember to use single quotation marks.**\n./run-regression-test.sh --run \'*sql*\' \n\n# Test the "demo" and "perfomance" group\n./run-regression-test.sh --run -g \'demo,performance\'\n\n# Test the suite "sql_action" in the "demo" group\n./run-regression-test.sh --run -g demo -s sql_action\n\n# Test the suite "sql_action" in the demo directory\n./run-regression-test.sh --run -d demo -s sql_action\n\n# Test the suites under the demo directory except the "sql_action" suite\n./run-regression-test.sh --run -d demo -xs sql_action\n\n# Exclude the test cases in the demo directory\n./run-regression-test.sh --run -xd demo\n\n# Exclude the test cases in the "demo" group\n./run-regression-test.sh --run -xg demo\n\n# Self-defined configurations\n./run-regression-test.sh --run -conf a=b\n\n# Parallel execution\n./run-regression-test.sh --run -parallel 5 -suiteParallel 10 -actionParallel 20\n'})}),"\n",(0,i.jsxs)(n.h2,{id:"generate-out-file-based-on-the-query-result",children:["Generate ",(0,i.jsx)(n.code,{children:".out"})," File Based on the Query Result"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# Automatically generate an .out file for the sql_action test case based on the query result. Ignore this if the .out file already exists.\n./run-regression-test.sh --run sql_action -genOut\n\n# Automatically generate an .out file for the sql_action test case based on the query result. If an .out file already exist, it will be overwritten.\n./run-regression-test.sh --run sql_action -forceGenOut\n"})}),"\n",(0,i.jsx)(n.h2,{id:"suite-plug-in",children:"Suite Plug-in"}),"\n",(0,i.jsxs)(n.p,{children:["Sometimes there might be a need to expand the suite classes, but it is not easy to change the source code of suite classes. In this case, you might do that by plug-ins. The default directory for plug-ins is ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/plugins"}),", in whic you can define how to expand suite classes with a groovy script. For example, this is how to add a ",(0,i.jsx)(n.code,{children:"testPlugin"})," function for log printing to ",(0,i.jsx)(n.code,{children:"plugin_example.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'import org.apache.doris.regression.suite.Suite\n\n// Register `testPlugin` function to Suite,\n// and invoke in ${DORIS_HOME}/regression-test/suites/demo/test_plugin.groovy\nSuite.metaClass.testPlugin = { String info /* param */ ->\n\n    // Which suite invoke current function?\n    Suite suite = delegate as Suite\n\n    // Function body\n    suite.getLogger().info("Test plugin: suiteName: ${suite.name}, info: ${info}".toString())\n\n    // Optional return value\n    return "OK"\n}\n\nlogger.info("Added \'testPlugin\' function to Suite")\n'})}),"\n",(0,i.jsxs)(n.p,{children:["After adding the ",(0,i.jsx)(n.code,{children:"testPlugin"})," function, you can use it in a regular test case. For example, in ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/regression-test/suites/demo/test_plugin.groovy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:'suite("test_plugin", "demo") {\n    // register testPlugin function in ${DORIS_HOME}/regression-test/plugins/plugin_example.groovy\n    def result = testPlugin("message from suite")\n    assertEquals("OK", result)\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"cicd-support",children:"CI/CD Support"}),"\n",(0,i.jsx)(n.h3,{id:"teamcity",children:"TeamCity"}),"\n",(0,i.jsxs)(n.p,{children:["You can use TeamCity to recognize Service Message via stdout. If you start the regression test framework using the ",(0,i.jsx)(n.code,{children:"--teamcity"})," parameter, the TeamCity Service Message will be printed in stdout. TeamCity will automatically read the event logs in stdout, and show ",(0,i.jsx)(n.code,{children:"Tests"})," in the current pipeline, in which there will be the test and logs. Therefore, you only need to configure the following command to start the regression test framework. In the following snippet, ",(0,i.jsx)(n.code,{children:"-Dteamcity.enableStdErr=false"})," means to print error logs to stdout, too, so that the logs can be chronologically organized."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'JAVA_OPTS="-Dteamcity.enableStdErr=${enableStdErr}" ./run-regression-test.sh --teamcity --run\n'})}),"\n",(0,i.jsx)(n.h2,{id:"e2e-test-with-external-data-sources",children:"E2E Test with External Data Sources"}),"\n",(0,i.jsx)(n.p,{children:"Doris supports queries on external data sources, so the regression testing framework allows users to build external data sources using Docker Compose, so that they can run end-to-end tests with external data sources."}),"\n",(0,i.jsxs)(n.ol,{start:"0",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Preparation"}),"\n",(0,i.jsxs)(n.p,{children:["To begin with, modify ",(0,i.jsx)(n.code,{children:"CONTAINER_UID"})," in ",(0,i.jsx)(n.code,{children:"docker/thirdparties/custom_settings.env"}),". For example, ",(0,i.jsx)(n.code,{children:"doris-10002-18sda1-"}),". The follow-up startup scripts will replace the corresponding names in Docker Compose to ensure consistency across multiple containers environment."]}),"\n",(0,i.jsx)(n.p,{children:"Before starting the containers, you need to check the network configuration of your server/cloud host to ensure that the mapping relationship between hostname and host IP address (hostname -i) is configured in /etc/hosts."}),"\n",(0,i.jsxs)(n.p,{children:["It should look like: ",(0,i.jsx)(n.code,{children:"10.0.0.46    iZj6cbwlx5pl6y0681t6scZ    iZj6cbwlx5pl6y0681t6scZ"}),", which are IP address (output of hostname -i command, usually the IP of eth0), hostname (output of hostname command), and alias (same as the previous one)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Start the Container"}),"\n",(0,i.jsxs)(n.p,{children:["So far, Doris has supported Docker Compose for data sources including Elasticsearch, MySQL, PostgreSQL, Hive, SQLServer, Oracle, Iceberg, Hudi, and Trino. The relevant files can be found in the directory ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"By default, you can use the following command to start the Docker containers for all external data sources:"}),"\n",(0,i.jsx)(n.p,{children:"(Note that for Hive and Hudi containers, you also need to download the pre-built data files. See the relevant documentation of Hive and Hudi.)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cd docker/thirdparties && sh run-thirdparties-docker.sh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Executing this command requires root or sudo privilege. If the command returns, that means all containers are started. You can check on them by inputing a ",(0,i.jsx)(n.code,{children:"docker ps -a"})," command."]}),"\n",(0,i.jsxs)(n.p,{children:["During the container startup process, you can use the ",(0,i.jsx)(n.code,{children:"docker logs -f <container-name>"})," command to view the container logs."]}),"\n",(0,i.jsx)(n.p,{children:"To stop all containers, you can use the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cd docker/thirdparties && sh run-thirdparties-docker.sh --stop\n"})}),"\n",(0,i.jsx)(n.p,{children:"To start or stop some specific components, you can use the following commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cd docker/thirdparties\n# Start MySQL\nsh run-thirdparties-docker.sh -c mysql\n# Start MySQL, PostgreSQL, Iceberg\nsh run-thirdparties-docker.sh -c mysql,pg,iceberg\n# Stop MySQL, PostgreSQL, Iceberg\nsh run-thirdparties-docker.sh -c mysql,pg,iceberg --stop\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"MySQL"}),"\n",(0,i.jsxs)(n.p,{children:["You can find the MySQL-related Docker Compose files in ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose/mysql"})," ."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mysql-5.7.yaml.tpl"}),": Docker Compose file template, no modification required. The default username and password is root/123456"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mysql-5.7.env"}),": Configuration file, in which you can configure the external port of the MySQL container (default number: 3316)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"init/"}),": SQL files in this directory will be automatically executed once the container is created."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data/"}),": The container will be mounted to this local data directory after it is started. The ",(0,i.jsx)(n.code,{children:"run-thirdparties-docker.sh"}),"  script will clear and rebuild this directory every time it is started."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"PostgreSQL"}),"\n",(0,i.jsxs)(n.p,{children:["You can find the PostgreSQL-related Docker Compose files in  ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose/postgresql"})," ."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"postgresql-14.yaml.tpl"}),": Docker Compose file template, no modification required. The default username and password is postgres/123456"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"postgresql-14.env"}),": Configuration file, in which you can configure the external port of the PostgreSQL container (default number: 5442)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"init/"}),": SQL files in this directory will be automatically executed once the container is created. By default, that includes the creation of database, table, and some data input."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data/"}),": The container will be mounted to this local data directory after it is started. The ",(0,i.jsx)(n.code,{children:"run-thirdparties-docker.sh"}),"  script will clear and rebuild this directory every time it is started."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Hive"}),"\n",(0,i.jsxs)(n.p,{children:["You can find the Hive-related Docker Compose files in ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose/hive"}),", supporting both Hive2 and Hive3."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hive-2x.yaml.tpl"}),", ",(0,i.jsx)(n.code,{children:"hive-3x.yaml.tpl"}),": Docker Compose file templates, no modification required."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hadoop-hive.env.tpl"}),", ",(0,i.jsx)(n.code,{children:"hadoop-hive-2x.env.tpl"})," and ",(0,i.jsx)(n.code,{children:"hadoop-hive-3x.env.tpl"}),": Configuration file templates, no modification required."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hive-2x_settings.env"}),": Hive2 initialization configuration script, which will be automatically called when ",(0,i.jsx)(n.code,{children:"run-thirdparties-docker.sh"})," starts. You can modify four external ports in this file: ",(0,i.jsx)(n.code,{children:"FS_PORT"}),", ",(0,i.jsx)(n.code,{children:"HMS_PORT"}),", ",(0,i.jsx)(n.code,{children:"HS_PORT"}),", and ",(0,i.jsx)(n.code,{children:"PG_PORT"}),", which correspond to ",(0,i.jsx)(n.code,{children:"hive2HdfsPort"}),", ",(0,i.jsx)(n.code,{children:"hive2HmsPort"}),", ",(0,i.jsx)(n.code,{children:"hive2ServerPort"}),", and ",(0,i.jsx)(n.code,{children:"hive2PgPort"})," in ",(0,i.jsx)(n.code,{children:"regression-conf.groovy"}),". The first two are for Hadoop's defaultFs and Hive metastore ports, with defaults of 8020 and 9083."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hive-3x_settings.env"}),": Hive3 initialization configuration script, which will be automatically called when ",(0,i.jsx)(n.code,{children:"run-thirdparties-docker.sh"})," starts. You can modify four external ports in this file: ",(0,i.jsx)(n.code,{children:"FS_PORT"}),", ",(0,i.jsx)(n.code,{children:"HMS_PORT"}),", ",(0,i.jsx)(n.code,{children:"HS_PORT"}),", and ",(0,i.jsx)(n.code,{children:"PG_PORT"}),", which correspond to ",(0,i.jsx)(n.code,{children:"hive3HdfsPort"}),", ",(0,i.jsx)(n.code,{children:"hive3HmsPort"}),", ",(0,i.jsx)(n.code,{children:"hive3ServerPort"}),", and ",(0,i.jsx)(n.code,{children:"hive3PgPort"})," in ",(0,i.jsx)(n.code,{children:"regression-conf.groovy"}),". The first two are for Hadoop's defaultFs and Hive metastore ports, with defaults of 8320 and 9383."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"scripts/"})," directory will be mounted to the container once it is started. Files in this directory require no modifications. Note that you need to download the pre-built files before you start the container:"]}),"\n",(0,i.jsxs)(n.p,{children:["Download files from  ",(0,i.jsx)(n.code,{children:"https://doris-regression-hk.oss-cn-hongkong.aliyuncs.com/regression/datalake/pipeline_data/tpch1.db.tar.gz"}),"  to the ",(0,i.jsx)(n.code,{children:"scripts/"})," directory and decompress."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Elasticsearch"}),"\n",(0,i.jsxs)(n.p,{children:["You can find three Docker images (for Elasticsearch 6, Elasticsearch 7, and Elasticsearch 8) in ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose/elasticsearch/"})," ."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"es.yaml.tpl"}),": Docker Compose file template, three versions included, no modifications required."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"es.env"}),": Configuration file, in which you need to configure the port number for Elasticsearch."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scripts"})," : In this directory, you can find the initialization script after the image is started."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Oracle"}),"\n",(0,i.jsxs)(n.p,{children:["You can find the image for Oracle 11 in ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose/oracle/"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"oracle-11.yaml.tpl"}),": Docker Compose file template, no modifications required."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"oracle-11.env"}),": Configure the external port for Oracle (default number: 1521)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"SQLServer"}),"\n",(0,i.jsxs)(n.p,{children:["You can find the image for SQLServer 2022 in ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose/sqlserver/"})," ."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sqlserver.yaml.tpl"}),": Docker Compose file template, no modifications required."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sqlserver.env"}),": Configure the external port for SQLServer (default number: 1433)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"ClickHouse"}),"\n",(0,i.jsxs)(n.p,{children:["You can find the image for ClickHouse 22 in ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose/clickhouse/"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"clickhouse.yaml.tpl"}),": Docker Compose file template, no modifications required."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"clickhouse.env"}),": Configure the external port for ClickHouse (default number: 8123)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Iceberg"}),"\n",(0,i.jsxs)(n.p,{children:["You can find the image of Iceberg + Spark + Minio in ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose/iceberg/"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"iceberg.yaml.tpl"}),": Docker Compose file template, no modifications required."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"entrypoint.sh.tpl"}),": The template of the initialization script after the image is started, no modifications required."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"spark-defaults.conf.tpl"}),": Configuration file template for Spark, no modifications required."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"iceberg.env"}),": Configuration file for external ports. You need to modify every external port to avoid conflicts."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"After the image is started, execute the following command to start spark-sql:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"docker exec -it doris-xx-spark-iceberg spark-sql"})}),"\n",(0,i.jsxs)(n.p,{children:["In this command, ",(0,i.jsx)(n.code,{children:"doris-xx-spark-iceberg"})," is the container name."]}),"\n",(0,i.jsx)(n.p,{children:"Execution examples for spark-sql iceberg:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"create database db1;\nshow databases;\ncreate table db1.test1(k1 bigint, k2 bigint, k3 string) partitioned by (k1);\ninsert into db1.test1 values(1,2,'abc');\nselect * from db1.test1;\nquit;\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can also access by spark-shell:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'docker exec -it doris-xx-spark-iceberg spark-shell\n\nspark.sql(s"create database db1")\nspark.sql(s"show databases").show()\nspark.sql(s"create table db1.test1(k1 bigint, k2 bigint, k3 string) partitioned by (k1)").show()\nspark.sql(s"show tables from db1").show()\nspark.sql(s"insert into db1.test1 values(1,2,\'abc\')").show()\nspark.sql(s"select * from db1.test1").show()\n:q\n'})}),"\n",(0,i.jsxs)(n.p,{children:["For more usage guide, see  ",(0,i.jsx)(n.a,{href:"https://tabular.io/blog/docker-spark-and-iceberg/",children:"Tabular Documentation"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Hudi"}),"\n",(0,i.jsxs)(n.p,{children:["You can find the Hudi-related Docker Compose file in ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose/hudi"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hudi.yaml.tpl"}),": Docker Compose file template, no modifications required."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hadoop.env"}),": Configuration file template, no modifications required."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"scripts/"})," directory will be mounted to the container once it is started. Files in this directory require no modifications. Note that you need to download the pre-built files before you start the container:"]}),"\n",(0,i.jsxs)(n.p,{children:["Download files from ",(0,i.jsx)(n.code,{children:"https://doris-build-hk-1308700295.cos.ap-hongkong.myqcloud.com/regression/load/hudi/hudi_docker_compose_attached_file.zip"}),"  to the ",(0,i.jsx)(n.code,{children:"scripts/"})," directory and decompress."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Before starting, add the following configurations to ",(0,i.jsx)(n.code,{children:"/etc/hosts"})," to avoid ",(0,i.jsx)(n.code,{children:"UnknownHostException"}),":"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"127.0.0.1 adhoc-1\n127.0.0.1 adhoc-2\n127.0.0.1 namenode\n127.0.0.1 datanode1\n127.0.0.1 hiveserver\n127.0.0.1 hivemetastore\n127.0.0.1 sparkmaster\n"})}),"\n",(0,i.jsx)(n.p,{children:"After starting, you can execute the following command to start a Hive query:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"docker exec -it adhoc-2 /bin/bash\n\nbeeline -u jdbc:hive2://hiveserver:10000 \\\n--hiveconf hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat \\\n--hiveconf hive.stats.autogather=false\n\nshow tables;\nshow partitions stock_ticks_mor_rt;\nselect symbol, max(ts) from stock_ticks_cow group by symbol HAVING symbol = 'GOOG';\nselect symbol, max(ts) from stock_ticks_mor_ro group by symbol HAVING symbol = 'GOOG';\nexit;\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can also access by spark-shell:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'docker exec -it adhoc-1 /bin/bash\n\n$SPARK_INSTALL/bin/spark-shell \\\n  --jars /var/scripts/hudi_docker_compose_attached_file/jar/hoodie-hive-sync-bundle.jar \\\n  --master local[2] \\\n  --driver-class-path $HADOOP_CONF_DIR \\\n  --conf spark.sql.hive.convertMetastoreParquet=false \\\n  --deploy-mode client \\\n  --driver-memory 1G \\\n  --executor-memory 3G \\\n  --num-executors 1\n\nspark.sql("show tables").show(100, false)\nspark.sql("select symbol, max(ts) from stock_ticks_cow group by symbol HAVING symbol = \'GOOG\'").show(100, false)\nspark.sql("select `_hoodie_commit_time`, symbol, ts, volume, open, close  from stock_ticks_cow where  symbol = \'GOOG\'").show(100, false)\nspark.sql("select symbol, max(ts) from stock_ticks_mor_ro group by symbol HAVING symbol = \'GOOG\'").show(100, false)\nspark.sql("select symbol, max(ts) from stock_ticks_mor_rt group by symbol HAVING symbol = \'GOOG\'").show(100, false)\nspark.sql("select `_hoodie_commit_time`, symbol, ts, volume, open, close  from stock_ticks_mor_ro where  symbol = \'GOOG\'").show(100, false)\n:q\n'})}),"\n",(0,i.jsxs)(n.p,{children:["For more usage guide, see ",(0,i.jsx)(n.a,{href:"https://hudi.apache.org/docs/docker_demo",children:"Hudi Documentation"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Trino\nYou can find the Trino-related Docker Compose file in ",(0,i.jsx)(n.code,{children:"docker/thirdparties/docker-compose/trino"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Template files:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"gen_env.sh.tpl: This is used to generate HDFS-related port numbers, no modifications required, but you can change the port numbers in the case of port conflicts."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"hive.properties.tpl: This is used to configure the Trino catalog, no modifications required."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"trino_hive.env.tpl: Environment configurations of Hive, no modifications required."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"trino_hive.yaml.tpl: Docker Compose file, no modifications required."}),"\n",(0,i.jsx)(n.p,{children:"After the Trino Docker is started, a Trino + Hive Catalog will be configured, and then Trino will have two catalogs."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Hive"}),"\n",(0,i.jsx)(n.li,{children:"TPCH (self-contained in Trino Docker)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For more usage guide, see  ",(0,i.jsx)(n.a,{href:"https://trino.io/docs/current/installation/containers.html",children:"Trino Documentation"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Run the regression test"}),"\n",(0,i.jsxs)(n.p,{children:["Regression test for external data sources is disabled by default. You can enable it by modifying the following configurations in  ",(0,i.jsx)(n.code,{children:"regression-test/conf/regression-conf.groovy"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enableJdbcTest"}),": This is to enable test for JDBC external tables. For this purpose, you need to start the MySQL and PostgreSQL containers."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mysql_57_port"})," and ",(0,i.jsx)(n.code,{children:"pg_14_port"})," are the external port of MySQL and PostgreSQL, respectively. Default port numbers: 3316 and 5442."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enableHiveTest"}),": This is to enable test for Hive external tables. For this purpose, you need to start the Hive container."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hive2HmsPort"})," is the external port for Hive2 metastore. Default number: 9083."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hive2HdfsPort"})," is the external port for Hive2 HDFS namenode. Default number: 8020."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enableEsTest"}),": This is to enable test for Elasticsearch external tables. For this purpose, you need to start the Elasticsearch container."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"es_6_port"}),": Port for Elasticsearch 6."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"es_7_port"}),": Port for Elasticsearch 7."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"es_8_port"}),": Port for Elasticsearch 8."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return l},a:function(){return o}});var t=s(667294);let i={},r=t.createContext(i);function o(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);