"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["396197"],{25405:function(e,t,n){n.r(t),n.d(t,{default:()=>g,frontMatter:()=>r,metadata:()=>a,assets:()=>o,toc:()=>l,contentTitle:()=>c});var a=JSON.parse('{"id":"lakehouse/best-practices/doris-unity-catalog","title":"Integration with Databricks Unity Catalog","description":"As enterprises increasingly manage growing data assets under the Lakehouse architecture, the demand for cross-platform, high-performance,","source":"@site/docs/lakehouse/best-practices/doris-unity-catalog.md","sourceDirName":"lakehouse/best-practices","slug":"/lakehouse/best-practices/doris-unity-catalog","permalink":"/docs/dev/lakehouse/best-practices/doris-unity-catalog","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Integration with Databricks Unity Catalog","language":"en","description":"As enterprises increasingly manage growing data assets under the Lakehouse architecture, the demand for cross-platform, high-performance,"},"sidebar":"docs","previous":{"title":"Integration with Microsoft OneLake","permalink":"/docs/dev/lakehouse/best-practices/doris-onelake"},"next":{"title":"Integration with Lakekeeper","permalink":"/docs/dev/lakehouse/best-practices/doris-lakekeeper"}}'),i=n("785893"),s=n("250065");let r={title:"Integration with Databricks Unity Catalog",language:"en",description:"As enterprises increasingly manage growing data assets under the Lakehouse architecture, the demand for cross-platform, high-performance,"},c=void 0,o={},l=[{value:"Databricks Environment Setup",id:"databricks-environment-setup",level:2},{value:"Creating an External Location",id:"creating-an-external-location",level:3},{value:"Creating a Catalog",id:"creating-a-catalog",level:3},{value:"Enabling External Use Schema Permissions",id:"enabling-external-use-schema-permissions",level:3},{value:"Creating Iceberg Tables and Inserting Data",id:"creating-iceberg-tables-and-inserting-data",level:3},{value:"Obtaining Access Token",id:"obtaining-access-token",level:3},{value:"Doris Connection to Unity Catalog",id:"doris-connection-to-unity-catalog",level:2},{value:"Creating a Catalog",id:"creating-a-catalog-1",level:3},{value:"Accessing the Catalog",id:"accessing-the-catalog",level:3},{value:"Managing Iceberg Tables",id:"managing-iceberg-tables",level:3},{value:"Summary",id:"summary",level:2}];function d(e){let t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["As enterprises increasingly manage growing data assets under the Lakehouse architecture, the demand for cross-platform, high-performance, and governed data access capabilities becomes more urgent. Apache Doris, as a next-generation real-time analytical database, has now achieved deep integration with ",(0,i.jsx)(t.a,{href:"https://www.databricks.com/product/unity-catalog",children:"Databricks Unity Catalog"}),", enabling enterprises to directly access and efficiently query data lakes managed by Databricks under a unified governance framework, achieving seamless data connectivity."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Through this documentation, you will gain in-depth understanding of:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Databricks Environment Setup: How to create External Locations, Catalogs, and Iceberg tables in Databricks, along with related permission configurations"}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Doris Connection to Unity Catalog: How to connect Doris to Databricks Unity Catalog and access Iceberg tables"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"Note: This functionality requires Doris version 3.1.3 or higher."}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"databricks-environment-setup",children:"Databricks Environment Setup"}),"\n",(0,i.jsx)(t.h3,{id:"creating-an-external-location",children:"Creating an External Location"}),"\n",(0,i.jsxs)(t.p,{children:["In Unity Catalog, an ",(0,i.jsx)(t.a,{href:"https://docs.databricks.com/aws/en/sql/language-manual/sql-ref-external-locations",children:"External Location"})," is a secure object that associates paths in cloud object storage with Storage Credentials. External Locations support external access, and Unity Catalog can issue short-term credentials to external systems through the Credential Vending feature, allowing external systems to access these paths."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"unity1",src:n(842797).Z+"",width:"1058",height:"636"})}),"\n",(0,i.jsx)(t.p,{children:"This document uses AWS Quickstart to create an External Location in AWS S3."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"unity2",src:n(926055).Z+"",width:"1544",height:"674"})}),"\n",(0,i.jsx)(t.p,{children:"After creation, you can see the External Catalog and its corresponding Credential:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"unity3",src:n(313498).Z+"",width:"1526",height:"678"})}),"\n",(0,i.jsx)(t.h3,{id:"creating-a-catalog",children:"Creating a Catalog"}),"\n",(0,i.jsx)(t.p,{children:"Click the Create Catalog option in the interface."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"unity4",src:n(380026).Z+"",width:"1058",height:"600"})}),"\n",(0,i.jsxs)(t.p,{children:["Fill in the Catalog name. Uncheck ",(0,i.jsx)(t.code,{children:"Use default storage"})," and select the External Location created earlier."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"unity5",src:n(877945).Z+"",width:"1268",height:"1160"})}),"\n",(0,i.jsx)(t.h3,{id:"enabling-external-use-schema-permissions",children:"Enabling External Use Schema Permissions"}),"\n",(0,i.jsxs)(t.p,{children:["Click on the newly created ",(0,i.jsx)(t.code,{children:"Catalog"})," \u2192 ",(0,i.jsx)(t.code,{children:"Permissions"})," \u2192 ",(0,i.jsx)(t.code,{children:"Grant"}),":"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"unity6",src:n(35647).Z+"",width:"1934",height:"720"})}),"\n",(0,i.jsxs)(t.p,{children:["Select ",(0,i.jsx)(t.code,{children:"All account users"})," and check the ",(0,i.jsx)(t.code,{children:"EXTERNAL USE SCHEMA"})," option."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"unity7",src:n(217799).Z+"",width:"1528",height:"1258"})}),"\n",(0,i.jsx)(t.h3,{id:"creating-iceberg-tables-and-inserting-data",children:"Creating Iceberg Tables and Inserting Data"}),"\n",(0,i.jsx)(t.p,{children:"Execute the following SQL in Databricks SQL Editor to create an Iceberg table and insert data:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:'CREATE TABLE `my-unity-catalog`.default.iceberg_table (\n  id int,\n  name string\n) USING iceberg;\n\nINSERT INTO `my-unity-catalog`.default.iceberg_table VALUES(1, "jack");\n'})}),"\n",(0,i.jsx)(t.h3,{id:"obtaining-access-token",children:"Obtaining Access Token"}),"\n",(0,i.jsxs)(t.p,{children:["Click the user avatar in the top right corner, go to the ",(0,i.jsx)(t.code,{children:"Settings"})," page, and select ",(0,i.jsx)(t.code,{children:"Access tokens"})," under ",(0,i.jsx)(t.code,{children:"User"})," \u2192 ",(0,i.jsx)(t.code,{children:"Developer"}),". Create a new Token for subsequent use when connecting Doris to Unity Catalog. The Token is a string in the format: ",(0,i.jsx)(t.code,{children:"dapi4f..."})]}),"\n",(0,i.jsx)(t.h2,{id:"doris-connection-to-unity-catalog",children:"Doris Connection to Unity Catalog"}),"\n",(0,i.jsx)(t.h3,{id:"creating-a-catalog-1",children:"Creating a Catalog"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:'-- Use oauth2 credential and vended credentials\nCREATE CATALOG dbx_unity_catalog PROPERTIES (\n  "uri" = "https://dbc-xx.cloud.databricks.com:443/api/2.1/unity-catalog/iceberg-rest/",\n  "type" = "iceberg",\n  "warehouse" = "my-unity-catalog",\n  "iceberg.catalog.type" = "rest",\n  "iceberg.rest.security.type" = "oauth2",\n  "iceberg.rest.oauth2.credential" = "clientid:clientsecret",\n  "iceberg.rest.oauth2.server-uri" = "https://dbc-xx.cloud.databricks.com:443/oidc/v1/token",\n  "iceberg.rest.oauth2.scope" = "all-apis",\n  "iceberg.rest.vended-credentials-enabled" = "true"\n);\n\n-- Use PAT and vended credentials\nCREATE CATALOG dbx_unity_catalog PROPERTIES (\n  "uri" = "https://<dbc-account>.cloud.databricks.com/api/2.1/unity-catalog/iceberg-rest/",\n  "type" = "iceberg",\n  "warehouse" = "my-unity-catalog",\n  "iceberg.catalog.type" = "rest",\n  "iceberg.rest.security.type" = "oauth2",\n  "iceberg.rest.oauth2.token" = "<token>",\n  "iceberg.rest.vended-credentials-enabled" = "true"\n);\n\n-- Use oauth2 credential and static ak/sk for accessing aws s3\nCREATE CATALOG dbx_unity_catalog PROPERTIES (\n  "uri" = "https://dbc-xx.cloud.databricks.com:443/api/2.1/unity-catalog/iceberg-rest/",\n  "type" = "iceberg",\n  "warehouse" = "my-unity-catalog",\n  "iceberg.catalog.type" = "rest",\n  "iceberg.rest.security.type" = "oauth2",\n  "iceberg.rest.oauth2.credential" = "clientid:clientsecret",\n  "iceberg.rest.oauth2.server-uri" = "https://dbc-xx.cloud.databricks.com:443/oidc/v1/token",\n  "iceberg.rest.oauth2.scope" = "all-apis",\n  "s3.endpoint" = "https://s3.<region>.amazonaws.com",\n  "s3.access_key" = "<ak>",\n  "s3.secret_key" = "<sk>",\n  "s3.region" = "<region>"\n);\n'})}),"\n",(0,i.jsx)(t.h3,{id:"accessing-the-catalog",children:"Accessing the Catalog"}),"\n",(0,i.jsx)(t.p,{children:"Once created, you can start accessing Iceberg tables stored in Unity Catalog:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"mysql> USE dbx_unity_catalog.`default`;\nDatabase changed\n\nmysql> SELECT * FROM iceberg_table;\n+------+------+\n| id   | name |\n+------+------+\n|    1 | jack |\n+------+------+\n1 row in set (3.32 sec)\n"})}),"\n",(0,i.jsx)(t.h3,{id:"managing-iceberg-tables",children:"Managing Iceberg Tables"}),"\n",(0,i.jsx)(t.p,{children:"You can also directly create, manage, and write to Iceberg tables in Unity Catalog through Doris:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:'-- Write to existing table in Unity Catalog\nINSERT INTO iceberg_table VALUES(2, "mary");\n\n-- Create a partitioned table\nCREATE TABLE partition_table (\n  `ts` DATETIME COMMENT \'ts\',\n  `col1` BOOLEAN COMMENT \'col1\',\n  `pt1` STRING COMMENT \'pt1\',\n  `pt2` STRING COMMENT \'pt2\'\n)\nPARTITION BY LIST (day(ts), pt1, pt2) ();\n\n-- Insert data\nINSERT INTO partition_table VALUES("2025-11-12", true, "foo", "bar");\n\n-- View table partition information\nSELECT * FROM partition_table$partitions\\G\n*************************** 1. row ***************************\n                    partition: {"ts_day":"2025-11-12", "pt1":"foo", "pt2":"bar"}\n                      spec_id: 0\n                 record_count: 1\n                   file_count: 1\ntotal_data_file_size_in_bytes: 2552\n position_delete_record_count: 0\n   position_delete_file_count: 0\n equality_delete_record_count: 0\n   equality_delete_file_count: 0\n              last_updated_at: 2025-11-18 15:20:45.964000\n     last_updated_snapshot_id: 9024874735105617773\n'})}),"\n",(0,i.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(t.p,{children:"Through deep integration with Databricks Unity Catalog, Apache Doris enables enterprises to access and analyze core assets in data lakes with higher performance and lower costs under a unified governance framework. This capability not only enhances the overall consistency of the Lakehouse architecture but also brings new possibilities for real-time analytics, interactive queries, and AI scenarios. Whether data teams, analytics engineers, or platform architects, they can all leverage Doris to build more agile and intelligent data applications on top of existing data lake foundations."})]})}function g(e={}){let{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},842797:function(e,t,n){n.d(t,{Z:function(){return a}});let a=n.p+"assets/images/unity-1-c35661294afc0f00586ea7b326f829fc.png"},926055:function(e,t,n){n.d(t,{Z:function(){return a}});let a=n.p+"assets/images/unity-2-7c32e206ed7cf6cf95026a5a4a8edd45.png"},313498:function(e,t,n){n.d(t,{Z:function(){return a}});let a=n.p+"assets/images/unity-3-e19be9b14d506ffaf5f3abe778d2db7c.png"},380026:function(e,t,n){n.d(t,{Z:function(){return a}});let a=n.p+"assets/images/unity-4-5434bd87d5c551714296943b6859b690.png"},877945:function(e,t,n){n.d(t,{Z:function(){return a}});let a=n.p+"assets/images/unity-5-661b49c4afc822023932d3efa16d97a1.png"},35647:function(e,t,n){n.d(t,{Z:function(){return a}});let a=n.p+"assets/images/unity-6-37b8ae861ef4db3b2dde56c1fbdb2482.png"},217799:function(e,t,n){n.d(t,{Z:function(){return a}});let a=n.p+"assets/images/unity-7-bc37cd9b24fe7e829d90b728cd661a46.png"},250065:function(e,t,n){n.d(t,{Z:function(){return c},a:function(){return r}});var a=n(667294);let i={},s=a.createContext(i);function r(e){let t=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);