"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["607576"],{799822:function(e,s,n){n.r(s),n.d(s,{default:()=>h,frontMatter:()=>l,metadata:()=>r,assets:()=>o,toc:()=>c,contentTitle:()=>i});var r=JSON.parse('{"id":"install/cluster-deployment/k8s-deploy/install-access-cluster","title":"Accessing Doris Cluster","description":"Access using ClusterIP mode","source":"@site/versioned_docs/version-2.0/install/cluster-deployment/k8s-deploy/install-access-cluster.md","sourceDirName":"install/cluster-deployment/k8s-deploy","slug":"/install/cluster-deployment/k8s-deploy/install-access-cluster","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/install-access-cluster","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"Accessing Doris Cluster","language":"en"},"sidebar":"docs","previous":{"title":"Deploying Doris Cluster","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/install-doris-cluster"},"next":{"title":"Upgrading Apache Doris cluster deployed by Doris Operator","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/doris-cluster-upgrade"}}'),t=n("785893"),a=n("250065");let l={title:"Accessing Doris Cluster",language:"en"},i=void 0,o={},c=[{value:"Access using ClusterIP mode",id:"access-using-clusterip-mode",level:2},{value:"Access using NodePort mode",id:"access-using-nodeport-mode",level:2},{value:"Stream Load ErrorURL Redirect",id:"stream-load-errorurl-redirect",level:2},{value:"View ErrorURL inside the container",id:"view-errorurl-inside-the-container",level:3},{value:"View ErrorURL outside the container",id:"view-errorurl-outside-the-container",level:3}];function d(e){let s={a:"a",admonition:"admonition",annotation:"annotation",code:"code",h2:"h2",h3:"h3",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h2,{id:"access-using-clusterip-mode",children:"Access using ClusterIP mode"}),"\n",(0,t.jsx)(s.p,{children:"Doris provides ClusterIP access mode by default on Kubernetes. The ClusterIP access mode provides an internal IP address within a Kubernetes cluster through which services are exposed. With ClusterIP mode, access is only possible within the cluster."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Configure and use ClusterIP as the Service type"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Doris provides ClusterIP access mode by default on Kubernetes. No modification is required to use ClusterIP access mode."}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsx)(s.li,{children:"Get Service"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"After deploying the cluster, you can view the services exposed by Doris Operator through the following command:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"kubectl -n doris get svc\n"})}),"\n",(0,t.jsx)(s.p,{children:"The return result is as follows:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"NAME                              TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                               AGE\ndoriscluster-sample-be-internal   ClusterIP   None          <none>        9050/TCP                              9m\ndoriscluster-sample-be-service    ClusterIP   10.1.68.128   <none>        9060/TCP,8040/TCP,9050/TCP,8060/TCP   9m\ndoriscluster-sample-fe-internal   ClusterIP   None          <none>        9030/TCP                              14m\ndoriscluster-sample-fe-service    ClusterIP   10.1.118.16   <none>        8030/TCP,9020/TCP,9030/TCP,9010/TCP   14m\n"})}),"\n",(0,t.jsx)(s.p,{children:"In the above results, FE and BE have two types of Services, with the suffixes internal and service respectively:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Service services with the suffix internal can only be used for Doris internal communication, such as heartbeat, data exchange and other operations, and are not used externally."}),"\n",(0,t.jsx)(s.li,{children:"Service services with the service suffix can be provided to users"}),"\n"]}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsx)(s.li,{children:"Access Doris inside the container"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Use the following command to create a pod containing the mysql client in the current Kubernetes cluster:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"kubectl run mysql-client --image=mysql:5.7 -it --rm --restart=Never --namespace=doris -- /bin/bash\n"})}),"\n",(0,t.jsxs)(s.p,{children:["In the container in the cluster, you can use the externally exposed service name with the suffix ",(0,t.jsx)(s.code,{children:"service"})," to access the Doris cluster:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"## Use service type pod name to access the Doris cluster\nmysql -uroot -P9030 -hdoriscluster-sample-fe-service\n"})}),"\n",(0,t.jsx)(s.h2,{id:"access-using-nodeport-mode",children:"Access using NodePort mode"}),"\n",(0,t.jsx)(s.p,{children:"If users need to access Doris outside the Kubernetes cluster, they can choose to use NodePort mode."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Plan NodePort mode port mapping"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"To use and maintain Doris cluster, users need to access the following ports:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"port name"}),(0,t.jsx)(s.th,{children:"default port"}),(0,t.jsx)(s.th,{children:"port description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Query Port"}),(0,t.jsx)(s.td,{children:"9030"}),(0,t.jsx)(s.td,{children:"Used to access Doris cluster through MySQL protocol"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"HTTP Port"}),(0,t.jsx)(s.td,{children:"8030"}),(0,t.jsx)(s.td,{children:"http server port on FE, used to view FE information"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Web Server Port"}),(0,t.jsx)(s.td,{children:"8040"}),(0,t.jsx)(s.td,{children:"http server port on BE, used to view BE information"})]})]})]}),"\n",(0,t.jsx)(s.p,{children:"There are two ways of port allocation using NodePort:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Dynamic allocation: If port mapping is not explicitly set, Kubernetes will automatically allocate an unused port when creating a pod (the default range is 30000-32767);"}),"\n",(0,t.jsx)(s.li,{children:"Static allocation: If port mapping is explicitly specified, Kubernetes will fixedly allocate the port when the port is not in use without conflict."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Kubernetes uses dynamic port allocation by default. If you need to plan the port in advance, you need to specify it explicitly in Custom Resource. In the following example, the Doris port is mapped:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"...\nspec:\n  feSpec:\n    replicas: 3\n    service:\n      type: NodePort\n      servicePorts:\n        - nodePort: 31001\n          targetPort: 8030\n        - nodePort: 31002\n          targetPort: 8040\n        - nodePort: 31003\n          targetPort: 9030\n...\n  beSpec:\n    replicas: 3\n    service:\n      type: NodePort\n      servicePorts:\n        - nodePort: 31005\n          targetPort: 9060\n        - nodePort: 31006\n          targetPort: 8040\n        - nodePort: 31007\n          targetPort: 9050\n        - nodePort: 31008\n          targetPort: 8060\n...\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsx)(s.li,{children:"Configure using NodePort as Service type"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Custom DorisCluster resource to use NodePort mode with BE, the specific changes are as follows:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"...\nspec:\n   feSpec:\n     replicas: 3\n     service:\n       type: NodePort\n...\n    beSpec:\n     replicas: 3\n     service:\n       type: NodePort\n...\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsx)(s.li,{children:"Get Service"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"After deploying the cluster, you can view the services exposed by Doris Operator through the following command:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"kubectl get service\n"})}),"\n",(0,t.jsx)(s.p,{children:"The return result is as follows:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE\nkubernetes ClusterIP 10.152.183.1 <none> 443/TCP 169d\ndoriscluster-sample-fe-internal ClusterIP None <none> 9030/TCP 2d\ndoriscluster-sample-fe-service NodePort 10.152.183.58 <none> 8030:31041/TCP,9020:30783/TCP,9030:31545/TCP,9010:31610/TCP 2d\ndoriscluster-sample-be-internal ClusterIP None <none> 9050/TCP 2d\ndoriscluster-sample-be-service NodePort 10.152.183.244 <none> 9060:30940/TCP,8040:32713/TCP,9050:30621/TCP,8060:30926/TCP 2d\n"})}),"\n",(0,t.jsx)(s.p,{children:"Doris's Query Port defaults to 9030, which is mapped to local port 31545 locally. When accessing the Doris cluster, you need to obtain the corresponding IP address, which can be viewed with the following command:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"kubectl get nodes -owide\n"})}),"\n",(0,t.jsx)(s.p,{children:"The return result is as follows:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"NAME   STATUS   ROLES           AGE   VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE          KERNEL-VERSION          CONTAINER-RUNTIME\nr60    Ready    control-plane   14d   v1.28.2   192.168.88.60   <none>        CentOS Stream 8   4.18.0-294.el8.x86_64   containerd://1.6.22\nr61    Ready    <none>          14d   v1.28.2   192.168.88.61   <none>        CentOS Stream 8   4.18.0-294.el8.x86_64   containerd://1.6.22\nr62    Ready    <none>          14d   v1.28.2   192.168.88.62   <none>        CentOS Stream 8   4.18.0-294.el8.x86_64   containerd://1.6.22\nr63    Ready    <none>          14d   v1.28.2   192.168.88.63   <none>        CentOS Stream 8   4.18.0-294.el8.x86_64   containerd://1.6.22\n"})}),"\n",(0,t.jsx)(s.p,{children:"In NodePort mode, you can access services in the Kubernetes cluster based on the host IP and port mapping of any node. In this example, you can use any node IP, 192.168.88.61, 192.168.88.62, 192.168.88.63, to access the Doris service. For example, in the following example, the node node 192.168.88.62 and the mapped query port port 31545 are used to access the cluster:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"mysql -h 192.168.88.62 -P 31545 -uroot\n"})}),"\n",(0,t.jsx)(s.h2,{id:"stream-load-errorurl-redirect",children:"Stream Load ErrorURL Redirect"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.a,{href:"../../../data-operate/import/stream-load-manual",children:"Stream Load"})," is a synchronous import mode provided by Doris. It is an efficient way to import local files into Doris. In the case of physical or virtual machine deployment, directly use http to initiate an import data request to FE, and FE will redirect the request to the BE service through the 301 mechanism to execute the write request. On Kubernetes, FE and BE use ",(0,t.jsx)(s.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/",children:"Service"})," as the method of service discovery. In situations where a proxy is used to mask the internal real address to provide service discovery, the address of the BE (the real address used for internal communication within the service) returned using FE 301 cannot be accessed. On Kubernetes, you need to use BE's Service address to import data."]}),"\n",(0,t.jsxs)(s.p,{children:["As in the following example, Stream Load ErrorUrl returns the result ",(0,t.jsx)(s.code,{children:"http://doriscluster-sample-be-2.doriscluster-sample-be-internal.doris.svc.cluster.local:8040/api/_load_error_log?file=__shard_1/error_log_insert_stmt_af474190276a2e9c-49bb9d175b8e968e_af474190276a2e9c_49bb9d175b8e968e"})]}),"\n",(0,t.jsx)(s.h3,{id:"view-errorurl-inside-the-container",children:"View ErrorURL inside the container"}),"\n",(0,t.jsx)(s.p,{children:"If you perform Stream Load inside Kubernetes, you can directly use the error address returned by Stream Load to obtain a detailed error report."}),"\n",(0,t.jsx)(s.p,{children:"In the return result of the above example, you can directly obtain the return result through the curl command in the Pod in the same Kubernetes cluster:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"curl http://doriscluster-sample-be-2.doriscluster-sample-be-internal.doris.svc.cluster.local:8040/api/_load_error_log?file=__shard_1/error_log_insert_stmt_af474190276a2e9c-49bb9d175b8e968e_af474190276a2e9c_49bb9d175b8e968e\n"})}),"\n",(0,t.jsx)(s.h3,{id:"view-errorurl-outside-the-container",children:"View ErrorURL outside the container"}),"\n",(0,t.jsx)(s.p,{children:"An error occurs when importing data using Stream Load from outside Kubernetes. The returned error address cannot be directly accessed outside Kubernetes to obtain a detailed error report. In the Kubernetes environment, you need to use a customized Service proxy to detect the pod where an error occurred. Configure the customized Service in an externally accessible mode and obtain a detailed error report by accessing the proxy Service."}),"\n",(0,t.jsx)(s.p,{children:"The customized Service template is as follows:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app.doris.service/role: debug\n    app.kubernetes.io/component: be\n  name: doriscluster-detail-error\nspec:\n  externalTrafficPolicy: Cluster\n  internalTrafficPolicy: Cluster\n  ipFamilies:\n    - IPv4\n  ipFamilyPolicy: SingleStack\n  ports:\n    - name: webserver-port\n      port: 8040\n      protocol: TCP\n      targetPort: 8040\n  selector:\n    app.kubernetes.io/component: be\n    statefulset.kubernetes.io/pod-name: ${podName}\n  sessionAffinity: None\n  type: ${ServiceType}\n"})}),"\n",(0,t.jsx)(s.p,{children:"in:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"${podName} represents the third-level domain name of the pod where the error currently occurs. For example, in the above example, the pod name needs to be filled in doriscluster-sample-be-2"}),"\n",(0,t.jsx)(s.li,{children:"${ServiceType} is the deployed Service type, you can choose NodePort or LoadBalancer"}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{title:"Tip",type:"tip",children:(0,t.jsx)(s.p,{children:"Since the pod name returned by each stream load may be different, please delete the customized Service after obtaining the detailed error information of the stream load."})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"NodePort Mode"})}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Deploy NodePort Service"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Follow the service in the above example, replace ",(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{children:"p"}),(0,t.jsx)(s.mi,{children:"o"}),(0,t.jsx)(s.mi,{children:"d"}),(0,t.jsx)(s.mi,{children:"N"}),(0,t.jsx)(s.mi,{children:"a"}),(0,t.jsx)(s.mi,{children:"m"}),(0,t.jsx)(s.mi,{children:"e"})]}),(0,t.jsx)(s.mi,{children:"i"}),(0,t.jsx)(s.mi,{children:"n"}),(0,t.jsx)(s.mi,{children:"C"}),(0,t.jsx)(s.mi,{children:"R"}),(0,t.jsx)(s.mi,{children:"w"}),(0,t.jsx)(s.mi,{children:"i"}),(0,t.jsx)(s.mi,{children:"t"}),(0,t.jsx)(s.mi,{children:"h"}),(0,t.jsx)(s.mi,{children:"d"}),(0,t.jsx)(s.mi,{children:"o"}),(0,t.jsx)(s.mi,{children:"r"}),(0,t.jsx)(s.mi,{children:"i"}),(0,t.jsx)(s.mi,{children:"s"}),(0,t.jsx)(s.mi,{children:"c"}),(0,t.jsx)(s.mi,{children:"l"}),(0,t.jsx)(s.mi,{children:"u"}),(0,t.jsx)(s.mi,{children:"s"}),(0,t.jsx)(s.mi,{children:"t"}),(0,t.jsx)(s.mi,{children:"e"}),(0,t.jsx)(s.mi,{children:"r"}),(0,t.jsx)(s.mo,{children:"\u2212"}),(0,t.jsx)(s.mi,{children:"s"}),(0,t.jsx)(s.mi,{children:"a"}),(0,t.jsx)(s.mi,{children:"m"}),(0,t.jsx)(s.mi,{children:"p"}),(0,t.jsx)(s.mi,{children:"l"}),(0,t.jsx)(s.mi,{children:"e"}),(0,t.jsx)(s.mo,{children:"\u2212"}),(0,t.jsx)(s.mi,{children:"b"}),(0,t.jsx)(s.mi,{children:"e"}),(0,t.jsx)(s.mo,{children:"\u2212"}),(0,t.jsx)(s.mn,{children:"2"}),(0,t.jsx)(s.mo,{separator:"true",children:","}),(0,t.jsx)(s.mi,{children:"a"}),(0,t.jsx)(s.mi,{children:"n"}),(0,t.jsx)(s.mi,{children:"d"}),(0,t.jsx)(s.mi,{children:"r"}),(0,t.jsx)(s.mi,{children:"e"}),(0,t.jsx)(s.mi,{children:"p"}),(0,t.jsx)(s.mi,{children:"l"}),(0,t.jsx)(s.mi,{children:"a"}),(0,t.jsx)(s.mi,{children:"c"}),(0,t.jsx)(s.mi,{children:"e"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"{podName} in CR with doriscluster-sample-be-2, and replace "})]})})}),(0,t.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"o"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"d"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"N"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"am"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"e"})]}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"in"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"CRw"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"i"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"t"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"h"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"d"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"or"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"i"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"sc"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"u"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"s"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"t"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"er"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(s.span,{className:"mbin",children:"\u2212"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"s"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"am"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"pl"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"e"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(s.span,{className:"mbin",children:"\u2212"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.7778em",verticalAlign:"-0.0833em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"b"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"e"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(s.span,{className:"mbin",children:"\u2212"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(s.span,{className:"mord",children:"2"}),(0,t.jsx)(s.span,{className:"mpunct",children:","}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"an"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"d"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"re"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"pl"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"a"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"ce"})]})]})]}),"{ServiceType} with NodePort. Use the kubectl apply command to create the service service in the same namespace of the doris cluster."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"kubectl -n {namespace} apply -f strem_load_get_error.yaml\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsx)(s.li,{children:"Build access commands"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Use the following command to view the NodePort assigned by the above deployment Service:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"kubectl get service -n doris doriscluster-detail-error\n"})}),"\n",(0,t.jsx)(s.p,{children:"The return result is as follows:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"NAME                              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)            AGE\ndoriscluster-detail-error         NodePort    10.152.183.35    <none>        8040:31201/TCP     32s\n"})}),"\n",(0,t.jsxs)(s.p,{children:["The BE port accessed by ",(0,t.jsx)(s.code,{children:"Stream Load"})," is 8040, and the host port (NodePort) corresponding to 8040 in the above Service is 31201."]}),"\n",(0,t.jsx)(s.p,{children:"Get the host address controlled by K8s:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"kubectl get node -owide\n"})}),"\n",(0,t.jsx)(s.p,{children:"The return result is as follows:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"NAME             STATUS   ROLES    AGE    VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                       KERNEL-VERSION       CONTAINER-RUNTIME\nvm-10-8-centos   Ready    <none>   226d   v1.28.7   10.16.10.8    <none>        TencentOS Server 3.1 (Final)   5.4.119-19-0009.3    containerd://1.6.28\nvm-10-7-centos   Ready    <none>   19d    v1.28.7   10.16.10.7    <none>        TencentOS Server 3.1 (Final)   5.4.119-19.0009.25   containerd://1.6.28\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Use any of the above hosts ",(0,t.jsx)(s.code,{children:"INTERNAL-IP"})," and get the host port to build an access address using NodePort mode to get error details. In ",(0,t.jsx)(s.code,{children:"NodePort"})," mode, the address for obtaining error details is spliced into ",(0,t.jsx)(s.code,{children:"Host IP:NodePort"}),", then the accessible address of the case is ",(0,t.jsx)(s.code,{children:"10.16.10.8:31201"}),". Replace the access address in the returned error address information to obtain the accessible error information. Available addresses for details:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"http://10.16.10.8:31201/api/_load_error_log?file=__shard_1/error_log_insert_stmt_af474190276a2e9c-49bb9d175b8e968e_af474190276a2e9c_49bb9d175b8e968e\n"})}),"\n",(0,t.jsx)(s.p,{children:"Use the above command to obtain detailed error information of Stream Load."}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"LoadBalancer Mode"})}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Deploy and obtain error details Service"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Assume that the error address of the Stream Load range is as follows:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"http://doriscluster-sample-be-2.doriscluster-sample-be-internal.doris.svc.cluster.local:8040/api/_load_error_log?file=__shard_1/error_log_insert_stmt_af474190276a2e9c-49bb9d175b8e968e_af474190276a2e9c_49bb9d175b8e968e\n"})}),"\n",(0,t.jsxs)(s.p,{children:["The domain name address of the above address is ",(0,t.jsx)(s.code,{children:"doriscluster-sample-be-2.doriscluster-sample-be-internal.doris.svc.cluster.local"}),". Among the domain names used by pods deployed by ",(0,t.jsx)(s.code,{children:"Doris Operator"})," on ",(0,t.jsx)(s.code,{children:"Kubernetes"}),", the third level The domain name is the name of the pod. Replace {podName} in the above template with the real ",(0,t.jsx)(s.code,{children:"pod"})," name, replace {serviceType} with ",(0,t.jsx)(s.code,{children:"LoadBalancer"}),", and save the changes to the newly created ",(0,t.jsx)(s.code,{children:"stream_load_get_error.yaml"})," file. Use the following command to deploy service:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"kubectl -n {namespace} apply -f strem_load_get_error.yaml\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsx)(s.li,{children:"Build access commands"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Use the following command to view the LoadBalaner address EXTERNAL-IP assigned by the above deployment Service. The following is a test instance in aws eks:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"kubectl get service -n doris doriscluster-detail-error\n"})}),"\n",(0,t.jsx)(s.p,{children:"The return result is as follows:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"NAME                         TYPE          CLUSTER-IP       EXTERNAL-IP                                                              PORT(S)           AGE\ndoriscluster-detail-error    LoadBalancer  172.20.183.136   ac4828493dgrftb884g67wg4tb68gyut-1137856348.us-east-1.elb.amazonaws.com  8040:32003/TCP    14s\n"})}),"\n",(0,t.jsxs)(s.p,{children:["The above Service obtains the LoadBalancer address assigned by the K8s cluster as ",(0,t.jsx)(s.code,{children:"ac4828493dgrftb884g67wg4tb68gyut``-1137856348.us-east-1.elb.amazonaws.com"}),". In LoadBalancer mode, the port is still the listening port for deployment deployment. In ",(0,t.jsx)(s.code,{children:"LoadBalancer"}),' mode , the address to obtain error details is spliced into "EXTERNAL-IP:listener-port". In the above example, the address to obtain error details is ',(0,t.jsx)(s.code,{children:"ac4828493dgrftb884g67wg4tb68gyut-1137856348.us-east-1.elb.amazonaws.com:8040"}),". The address to obtain detailed error information is as follows:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"http://ac4828493dgrftb884g67wg4tb68gyut-1137856348.us-east-1.elb.amazonaws.com:8040/api/_load_error_log?file=__shard_1/error_log_insert_stmt_af474190276a2e9c-49bb9d175b8e968e_af474190276a2e9c_49bb9d175b8e968e\n"})})]})}function h(e={}){let{wrapper:s}={...(0,a.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},250065:function(e,s,n){n.d(s,{Z:function(){return i},a:function(){return l}});var r=n(667294);let t={},a=r.createContext(t);function l(e){let s=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(a.Provider,{value:s},e.children)}}}]);