"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["648198"],{997550:function(e,n,t){t.r(n),t.d(n,{default:()=>u,frontMatter:()=>a,metadata:()=>s,assets:()=>l,toc:()=>c,contentTitle:()=>i});var s=JSON.parse('{"id":"install/deploy-on-kubernetes/separating-storage-compute/install-doris-cluster","title":"Deploy Doris Cluster | Separating Storage Compute","description":"Deploying a functional decoupled storage and compute Doris cluster on Kubernetes involves four main steps:","source":"@site/docs/install/deploy-on-kubernetes/separating-storage-compute/install-doris-cluster.md","sourceDirName":"install/deploy-on-kubernetes/separating-storage-compute","slug":"/install/deploy-on-kubernetes/separating-storage-compute/install-doris-cluster","permalink":"/docs/dev/install/deploy-on-kubernetes/separating-storage-compute/install-doris-cluster","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Deploy Doris Cluster | Separating Storage Compute","language":"en","description":"Deploying a functional decoupled storage and compute Doris cluster on Kubernetes involves four main steps:","sidebar_label":"Deploy Doris Cluster"},"sidebar":"docs","previous":{"title":"Config ComputeGroups","permalink":"/docs/dev/install/deploy-on-kubernetes/separating-storage-compute/config-cg"},"next":{"title":"Deploying on AWS","permalink":"/docs/dev/install/deploy-on-cloud/doris-on-aws"}}'),r=t("785893"),o=t("250065");let a={title:"Deploy Doris Cluster | Separating Storage Compute",language:"en",description:"Deploying a functional decoupled storage and compute Doris cluster on Kubernetes involves four main steps:",sidebar_label:"Deploy Doris Cluster"},i="Deploy Doris Cluster",l={},c=[{value:"Step 1: Preparation",id:"step-1-preparation",level:2},{value:"Step 2: Deploying the Doris Operator",id:"step-2-deploying-the-doris-operator",level:2},{value:"Step 3: Deploy the compute-storage decoupled cluster",id:"step-3-deploy-the-compute-storage-decoupled-cluster",level:2},{value:"Step 4: Creating the Remote Storage Backend",id:"step-4-creating-the-remote-storage-backend",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"deploy-doris-cluster",children:"Deploy Doris Cluster"})}),"\n",(0,r.jsx)(n.p,{children:"Deploying a functional decoupled storage and compute Doris cluster on Kubernetes involves four main steps:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Preparation \u2013 Primarily, install a FoundationDB cluster."}),"\n",(0,r.jsx)(n.li,{children:"Deploying the Doris Operator."}),"\n",(0,r.jsx)(n.li,{children:"Deploying the compute-storage decoupled cluster."}),"\n",(0,r.jsx)(n.li,{children:"Creating the Storage Backend."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-1-preparation",children:"Step 1: Preparation"}),"\n",(0,r.jsx)(n.p,{children:"Before deploying a decoupled cluster on Kubernetes, it is essential to have FoundationDB deployed in advance."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["(Preferred) Direct Deployment on Machines:\nEnsure that the machine where FoundationDB is installed is accessible by services running within the Kubernetes cluster. For direct machine deployments, please refer to the ",(0,r.jsx)(n.a,{href:"../../../compute-storage-decoupled/before-deployment",children:"Preparation Phase"})," in the decoupled deployment documentation."]}),"\n",(0,r.jsxs)(n.li,{children:["Deployment on Kubernetes:\nFor deploying FoundationDB on Kubernetes, please refer to ",(0,r.jsx)(n.a,{href:"/docs/dev/install/deploy-on-kubernetes/separating-storage-compute/install-fdb",children:"Deploying FoundationDB on Kubernetes"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-2-deploying-the-doris-operator",children:"Step 2: Deploying the Doris Operator"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Create the resource definitions:\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl create -f https://raw.githubusercontent.com/apache/doris-operator/master/config/crd/bases/crds.yaml\n"})}),"\nIf a non-decoupled cluster has already been deployed, use the following command to create the CRD definitions:\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"kubectl create -f https://raw.githubusercontent.com/apache/doris-operator/master/config/crd/bases/disaggregated.cluster.doris.com_dorisdisaggregatedclusters.yaml\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Deploy the Doris Operator and its associated RBAC rules:\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f https://raw.githubusercontent.com/apache/doris-operator/master/config/operator/disaggregated-operator.yaml\n"})}),"\nAfter deployment, verify the status of the Operator Pod using:\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl -n doris get pods\nNAME                              READY   STATUS    RESTARTS   AGE\ndoris-operator-6b97df65c4-xwvw8   1/1     Running   0          19s\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-3-deploy-the-compute-storage-decoupled-cluster",children:"Step 3: Deploy the compute-storage decoupled cluster"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Download the Deployment Sample:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"curl -O https://raw.githubusercontent.com/apache/doris-operator/master/doc/examples/disaggregated/cluster/ddc-sample.yaml\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Configure FoundationDB access information.\nThe compute-storage decoupled version of Doris uses FoundationDB to store metadata. The access details for FoundationDB can be provided in the DorisDisaggregatedCluster under ",(0,r.jsx)(n.code,{children:"spec.metaService.fdb"})," in one of two ways: by directly specifying the access address or by using a ConfigMap that includes the access information."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Direct Access Address Configuration\nIf FoundationDB is deployed outside of Kubernetes, you can specify its access address directly:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  metaService:\n    fdb:\n      address: ${fdbAddress}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Here, ${fdbAddress} refers to the client access address for FoundationDB. On Linux VMs, this is typically stored in ",(0,r.jsx)(n.code,{children:"/etc/foundationdb/fdb.cluster"}),". For more details, refer to the FoundationDB ",(0,r.jsx)(n.a,{href:"https://apple.github.io/foundationdb/administration.html#foundationdb-cluster-file",children:"cluster file documentation"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Configuring via a ConfigMap Containing Access Information\nIf FoundationDB is deployed using the ",(0,r.jsx)(n.a,{href:"https://github.com/FoundationDB/fdb-kubernetes-operator",children:"fdb-kubernetes-operator"}),", the operator will generate a specific ConfigMap containing the access information within the deployment namespace.\nThe generated ConfigMap's name is the FoundationDB resource name with the suffix \u201C-config\u201D. After obtaining the ConfigMap's name and namespace, configure the DorisDisaggregatedCluster resource as follows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  metaService:\n    fdb:\n      configMapNamespaceName:\n        name: ${foundationdbConfigMapName}\n        namespace: ${namespace}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, {foundationdbConfigMapName} is the name of the ConfigMap generated by the fdb-kubernetes-operator, and {namespace} is the namespace where the ConfigMap resides."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure the DorisDisaggregatedCluster Resource\nBased on the decoupled deployment documentation, configure:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The metadata service as  detailed in the (",(0,r.jsx)(n.a,{href:"/docs/dev/install/deploy-on-kubernetes/separating-storage-compute/config-ms",children:"metaService configuration"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["The FE cluster specifications (",(0,r.jsx)(n.a,{href:"/docs/dev/install/deploy-on-kubernetes/separating-storage-compute/config-fe",children:"FE cluster configuration"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["The compute groups (",(0,r.jsx)(n.a,{href:"/docs/dev/install/deploy-on-kubernetes/separating-storage-compute/config-cg",children:"compute group configuration"}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"After completing the configuration, deploy the resources with the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f ddc-sample.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Once the resources are applied, wait for the cluster to be fully established. The expected output of the following command is:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl get ddc\nNAME                         CLUSTERHEALTH   FEPHASE   CGCOUNT   CGAVAILABLECOUNT   CGFULLAVAILABLECOUNT\ntest-disaggregated-cluster   green           Ready     2         2                  2\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-4-creating-the-remote-storage-backend",children:"Step 4: Creating the Remote Storage Backend"}),"\n",(0,r.jsx)(n.p,{children:"After the cluster has successfully started, configure an available object storage as the persistent storage backend (referred to as a Vault in Doris) using SQL."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Obtain the FE Service Access Address\nAfter the cluster is deployed, you can view the services exposed by the Doris Operator with the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl get svc\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"NAME                                     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                               AGE\ntest-disaggregated-cluster-fe            ClusterIP   10.96.147.97   <none>        8030/TCP,9020/TCP,9030/TCP,9010/TCP   15m\ntest-disaggregated-cluster-fe-internal   ClusterIP   None           <none>        9030/TCP                              15m\ntest-disaggregated-cluster-ms            ClusterIP   10.96.169.8    <none>        5000/TCP                              15m\ntest-disaggregated-cluster-cg1           ClusterIP   10.96.47.90    <none>        9060/TCP,8040/TCP,9050/TCP,8060/TCP   14m\ntest-disaggregated-cluster-cg2           ClusterIP   10.96.50.199   <none>        9060/TCP,8040/TCP,9050/TCP,8060/TCP   14m\n"})}),"\n",(0,r.jsx)(n.p,{children:"The Service without the \u201C-internal\u201D suffix is intended for external access."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Connect Using the MySQL Client\nWithin the Kubernetes cluster, create a Pod containing the MySQL Client and enter the Pod:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl run mysql-client --image=mysql:5.7 -it --rm --restart=Never -- /bin/bash\n"})}),"\n",(0,r.jsx)(n.p,{children:"Within the Pod, connect to the Doris cluster directly using the Service name:\u3001"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"mysql -uroot -P9030 -h test-disaggregated-cluster-fe \n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Create the Storage Backend(Vault)\nCreate an object storage backend supporting the S3 protocol as the Vault using SQL. For example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mysql",children:'CREATE STORAGE VAULT IF NOT EXISTS s3_vault\n   PROPERTIES (\n       "type"="S3",\n       "s3.endpoint" = "oss-cn-beijing.aliyuncs.com",\n       "s3.region" = "bj",\n       "s3.bucket" = "bucket",\n       "s3.root.path" = "big/data/prefix",\n       "s3.access_key" = "your-ak",\n       "s3.secret_key" = "your-sk",\n       "provider" = "OSS" \n   );\n'})}),"\n",(0,r.jsxs)(n.p,{children:["For instructions on creating other storage backends and detailed explanations of each field, please refer to the ",(0,r.jsx)(n.a,{href:"/docs/dev/compute-storage-decoupled/managing-storage-vault",children:"Managing Storage Vault"})," section of the decoupled deployment documentation.\nSet the Default Storage Vault."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mysql",children:"SET {vaultName} AS DEFAULT STORAGE VAULT;\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, {vaultName} is the name of the Vault you wish to use, for example, s3_vault as created in the example above."}),"\n"]}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return i},a:function(){return a}});var s=t(667294);let r={},o=s.createContext(r);function a(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);