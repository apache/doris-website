"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["561815"],{195474:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>a,metadata:()=>i,assets:()=>o,toc:()=>d,contentTitle:()=>r});var i=JSON.parse('{"id":"data-operate/delete/delete-manual","title":"Deleting Data with DELETE Command","description":"The DELETE statement removes data from a specified table or partition based on conditions through the MySQL protocol.","source":"@site/versioned_docs/version-2.1/data-operate/delete/delete-manual.md","sourceDirName":"data-operate/delete","slug":"/data-operate/delete/delete-manual","permalink":"/docs/2.1/data-operate/delete/delete-manual","draft":false,"unlisted":false,"tags":[],"version":"2.1","lastUpdatedAt":1770477659000,"frontMatter":{"title":"Deleting Data with DELETE Command","language":"en","description":"The DELETE statement removes data from a specified table or partition based on conditions through the MySQL protocol."},"sidebar":"docs","previous":{"title":"Delete Overview","permalink":"/docs/2.1/data-operate/delete/delete-overview"},"next":{"title":"Batch Deletion Based on Load","permalink":"/docs/2.1/data-operate/delete/batch-delete-manual"}}'),l=t("785893"),s=t("250065");let a={title:"Deleting Data with DELETE Command",language:"en",description:"The DELETE statement removes data from a specified table or partition based on conditions through the MySQL protocol."},r=void 0,o={},d=[{value:"Delete by Specifying Filter Predicates",id:"delete-by-specifying-filter-predicates",level:2},{value:"Required Parameters",id:"required-parameters",level:3},{value:"Optional Parameters",id:"optional-parameters",level:3},{value:"Usage Restrictions",id:"usage-restrictions",level:3},{value:"Examples",id:"examples",level:3},{value:"Delete Using the <code>USING</code> Clause",id:"delete-using-the-using-clause",level:2},{value:"Required Parameters",id:"required-parameters-1",level:3},{value:"Optional Parameters",id:"optional-parameters-1",level:3},{value:"Notes",id:"notes",level:3},{value:"Example",id:"example",level:3},{value:"Related Configuration",id:"related-configuration",level:2},{value:"View History",id:"view-history",level:2},{value:"Performance Recommendations",id:"performance-recommendations",level:2},{value:"Syntax",id:"syntax",level:2}];function c(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"DELETE"})," statement removes data from a specified table or partition based on conditions through the MySQL protocol. It supports specifying the data to be deleted using simple predicate combinations and also supports using the ",(0,l.jsx)(n.code,{children:"USING"})," clause to join multiple tables for deletion on primary key tables."]}),"\n",(0,l.jsx)(n.h2,{id:"delete-by-specifying-filter-predicates",children:"Delete by Specifying Filter Predicates"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DELETE FROM table_name [table_alias]\n  [PARTITION partition_name | PARTITIONS (partition_name [, partition_name])]\n  WHERE column_name op { value | value_list } [ AND column_name op { value | value_list } ...];\n"})}),"\n",(0,l.jsx)(n.h3,{id:"required-parameters",children:"Required Parameters"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"table_name"}),": The table from which data needs to be deleted."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"column_name"}),": A column belonging to ",(0,l.jsx)(n.code,{children:"table_name"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"op"}),": Logical comparison operators, including: =, >, <, >=, <=, !=, in, not in."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"value | value_list"}),": The value or list of values for logical comparison."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"optional-parameters",children:"Optional Parameters"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"PARTITION partition_name | PARTITIONS (partition_name [, partition_name])"}),": Specifies the partition name where the data deletion is to be executed. If the table does not have this partition, an error will be reported."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"table_alias"}),": Alias for the table."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"usage-restrictions",children:"Usage Restrictions"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"When using the Aggregate table model, conditions can only be specified on Key columns. If the selected Key column does not exist in a Rollup, deletion cannot be performed."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"For partitioned tables, partitions need to be specified. If not specified, Doris will infer the partition from the conditions."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Doris cannot infer the partition from the conditions in two cases:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"The conditions do not include partition columns."}),"\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"op"})," of the partition column is ",(0,l.jsx)(n.code,{children:"not in"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["When the partitioned table is not a Unique table, and it does not specify a partition or cannot infer the partition from the conditions, the session variable ",(0,l.jsx)(n.code,{children:"delete_without_partition"})," needs to be set to ",(0,l.jsx)(n.code,{children:"true"}),", and the delete operation will apply to all partitions."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["1. Delete rows in partition ",(0,l.jsx)(n.code,{children:"p1"})," of ",(0,l.jsx)(n.code,{children:"my_table"})," where the value of column ",(0,l.jsx)(n.code,{children:"k1"})," is 3"]})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DELETE FROM my_table PARTITION p1\n  WHERE k1 = 3;\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["2. Delete rows in partition ",(0,l.jsx)(n.code,{children:"p1"})," of ",(0,l.jsx)(n.code,{children:"my_table"})," where the value of column ",(0,l.jsx)(n.code,{children:"k1"})," is greater than or equal to 3 and the value of column ",(0,l.jsx)(n.code,{children:"status"}),' is "outdated"']})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:'DELETE FROM my_table PARTITION p1\nWHERE k1 >= 3 AND status = "outdated";\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["3. Delete rows in partitions ",(0,l.jsx)(n.code,{children:"p1"})," and ",(0,l.jsx)(n.code,{children:"p2"})," of ",(0,l.jsx)(n.code,{children:"my_table"})," where the value of column ",(0,l.jsx)(n.code,{children:"k1"})," is greater than or equal to 3 and the value of column ",(0,l.jsx)(n.code,{children:"dt"}),' is between "2024-10-01" and "2024-10-31"']})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:'DELETE FROM my_table PARTITIONS (p1, p2)\nWHERE k1 >= 3 AND dt >= "2024-10-01" AND dt <= "2024-10-31";\n'})}),"\n",(0,l.jsxs)(n.h2,{id:"delete-using-the-using-clause",children:["Delete Using the ",(0,l.jsx)(n.code,{children:"USING"})," Clause"]}),"\n",(0,l.jsxs)(n.p,{children:["In some scenarios, users need to join multiple tables to accurately determine the data to be deleted. In such cases, the ",(0,l.jsx)(n.code,{children:"USING"})," clause is very useful. The syntax is as follows:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DELETE FROM table_name [table_alias]\n  [PARTITION partition_name | PARTITIONS (partition_name [, partition_name])]\n  [USING additional_tables]\n  WHERE condition\n"})}),"\n",(0,l.jsx)(n.h3,{id:"required-parameters-1",children:"Required Parameters"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"table_name"}),": The table from which data needs to be deleted."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"WHERE condition"}),": Specifies the condition for selecting the rows to be deleted."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"optional-parameters-1",children:"Optional Parameters"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"PARTITION partition_name | PARTITIONS (partition_name [, partition_name])"}),": Specifies the partition name where the data deletion is to be executed. If the table does not have this partition, an error will be reported."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"table_alias"}),": Alias for the table."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"notes",children:"Notes"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"This form can only be used on UNIQUE KEY model tables."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,l.jsxs)(n.p,{children:["Using the join result of tables ",(0,l.jsx)(n.code,{children:"t2"})," and ",(0,l.jsx)(n.code,{children:"t3"}),", delete data from ",(0,l.jsx)(n.code,{children:"t1"}),". The table to be deleted only supports the unique model."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- Create tables t1, t2, t3\nCREATE TABLE t1\n  (id INT, c1 BIGINT, c2 STRING, c3 DOUBLE, c4 DATE)\nUNIQUE KEY (id)\nDISTRIBUTED BY HASH (id)\nPROPERTIES('replication_num'='1', \"function_column.sequence_col\" = \"c4\");\n\nCREATE TABLE t2\n  (id INT, c1 BIGINT, c2 STRING, c3 DOUBLE, c4 DATE)\nDISTRIBUTED BY HASH (id)\nPROPERTIES('replication_num'='1');\n\nCREATE TABLE t3\n  (id INT)\nDISTRIBUTED BY HASH (id)\nPROPERTIES('replication_num'='1');\n\n-- Insert data\nINSERT INTO t1 VALUES\n  (1, 1, '1', 1.0, '2000-01-01'),\n  (2, 2, '2', 2.0, '2000-01-02'),\n  (3, 3, '3', 3.0, '2000-01-03');\n\nINSERT INTO t2 VALUES\n  (1, 10, '10', 10.0, '2000-01-10'),\n  (2, 20, '20', 20.0, '2000-01-20'),\n  (3, 30, '30', 30.0, '2000-01-30'),\n  (4, 4, '4', 4.0, '2000-01-04'),\n  (5, 5, '5', 5.0, '2000-01-05');\n\nINSERT INTO t3 VALUES\n  (1),\n  (4),\n  (5);\n\n-- Delete data from t1\nDELETE FROM t1\n  USING t2 INNER JOIN t3 ON t2.id = t3.id\n  WHERE t1.id = t2.id;\n"})}),"\n",(0,l.jsxs)(n.p,{children:["The expected result is to delete the row in table ",(0,l.jsx)(n.code,{children:"t1"})," where ",(0,l.jsx)(n.code,{children:"id"})," is ",(0,l.jsx)(n.code,{children:"1"}),"."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-Plain",children:"+----+----+----+--------+------------+\n| id | c1 | c2 | c3     | c4         |\n+----+----+----+--------+------------+\n| 2  | 2  | 2  |    2.0 | 2000-01-02 |\n| 3  | 3  | 3  |    3.0 | 2000-01-03 |\n+----+----+----+--------+------------+\n"})}),"\n",(0,l.jsx)(n.h2,{id:"related-configuration",children:"Related Configuration"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Timeout Configuration"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"insert_timeout"}),": Since the delete operation is an SQL command and is considered a special load, the delete statement is affected by the ",(0,l.jsx)(n.code,{children:"insert_timeout"})," value in the Session. You can increase the timeout by ",(0,l.jsx)(n.code,{children:"SET insert_timeout = xxx"}),", where the unit is seconds."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"IN Predicate Configuration"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"max_allowed_in_element_num_of_delete"}),": If the user needs to use a large number of elements in the ",(0,l.jsx)(n.code,{children:"in"})," predicate, this item can be adjusted to increase the allowed element limit. The default value is 1024."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"view-history",children:"View History"}),"\n",(0,l.jsxs)(n.p,{children:["Users can view the history of completed delete records using the ",(0,l.jsx)(n.code,{children:"SHOW DELETE"})," statement."]}),"\n",(0,l.jsx)(n.p,{children:"The syntax is as follows:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SHOW DELETE [FROM db_name]\n"})}),"\n",(0,l.jsx)(n.p,{children:"Example:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:'mysql> show delete from test_db;\n+-----------+---------------+---------------------+-----------------+----------+\n| TableName | PartitionName | CreateTime          | DeleteCondition | State    |\n+-----------+---------------+---------------------+-----------------+----------+\n| empty_tbl | p3            | 2020-04-15 23:09:35 | k1 EQ "1"       | FINISHED |\n| test_tbl  | p4            | 2020-04-15 23:09:53 | k1 GT "80"      | FINISHED |\n+-----------+---------------+---------------------+-----------------+----------+\n2 rows in set (0.00 sec)\n'})}),"\n",(0,l.jsx)(n.h2,{id:"performance-recommendations",children:"Performance Recommendations"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"On detail tables (Duplicate Key) and aggregate tables (Aggregate Key), the delete operation executes quickly, but a large number of delete operations in a short period will affect query performance."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["On primary key tables (Unique Key), the delete operation is converted into an ",(0,l.jsx)(n.code,{children:"INSERT INTO"})," statement. When deleting a large range, the execution speed is slow, but a large number of delete operations in a short period will not significantly affect query performance."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"syntax",children:"Syntax"}),"\n",(0,l.jsxs)(n.p,{children:["For detailed delete syntax, refer to the ",(0,l.jsx)(n.a,{href:"../../sql-manual/sql-statements/data-modification/DML/DELETE",children:"DELETE"})," syntax manual."]})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return r},a:function(){return a}});var i=t(667294);let l={},s=i.createContext(l);function a(e){let n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);