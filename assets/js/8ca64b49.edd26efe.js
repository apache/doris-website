"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["594595"],{547450:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>i,metadata:()=>r,assets:()=>d,toc:()=>c,contentTitle:()=>a});var r=JSON.parse('{"id":"developer-guide/benchmark-tool","title":"Doris BE Storage Layer Benchmark Tool","description":"\x3c!--","source":"@site/community/developer-guide/benchmark-tool.md","sourceDirName":"developer-guide","slug":"/developer-guide/benchmark-tool","permalink":"/community/developer-guide/benchmark-tool","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Doris BE Storage Layer Benchmark Tool","language":"en"},"sidebar":"community","previous":{"title":"Doris Docker quick build development environment","permalink":"/community/developer-guide/docker-dev"},"next":{"title":"Pipeline Tracing","permalink":"/community/developer-guide/pipeline-tracing"}}'),o=t("785893"),s=t("250065");let i={title:"Doris BE Storage Layer Benchmark Tool",language:"en"},a="Doris BE Storage Layer Benchmark Tool",d={},c=[{value:"usage",id:"usage",level:2},{value:"Compilation",id:"compilation",level:2},{value:"operator",id:"operator",level:2},{value:"Use randomly generated data set for segment read test",id:"use-randomly-generated-data-set-for-segment-read-test",level:4},{value:"Use randomly generated data set for segment write test",id:"use-randomly-generated-data-set-for-segment-write-test",level:4},{value:"Use the data set imported from the file for segment read test",id:"use-the-data-set-imported-from-the-file-for-segment-read-test",level:4},{value:"Use the data set imported from the file for segment write test",id:"use-the-data-set-imported-from-the-file-for-segment-write-test",level:4},{value:"Use randomly generated data set for page dictionary encoding test",id:"use-randomly-generated-data-set-for-page-dictionary-encoding-test",level:4},{value:"Use randomly generated data set for page dictionary decoding test",id:"use-randomly-generated-data-set-for-page-dictionary-decoding-test",level:4},{value:"Custom test",id:"custom-test",level:2}];function l(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"doris-be-storage-layer-benchmark-tool",children:"Doris BE Storage Layer Benchmark Tool"})}),"\n",(0,o.jsx)(n.h2,{id:"usage",children:"usage"}),"\n",(0,o.jsx)(n.p,{children:"It can be used to test the performance of some parts of the BE storage layer (for example, segment, page). According to the input data, the designated object is constructed, and the google benchmark is used for performance testing."}),"\n",(0,o.jsx)(n.h2,{id:"compilation",children:"Compilation"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["To ensure that the environment has been able to successfully compile the Doris ontology, you can refer to ",(0,o.jsx)(n.a,{href:"/docs/install/source-install/compilation-general",children:"Installation and deployment"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute",(0,o.jsx)(n.code,{children:"run-be-ut.sh"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["The compiled executable file is located in ",(0,o.jsx)(n.code,{children:"./be/ut_build_ASAN/test/tools/benchmark_tool"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"operator",children:"operator"}),"\n",(0,o.jsx)(n.h4,{id:"use-randomly-generated-data-set-for-segment-read-test",children:"Use randomly generated data set for segment read test"}),"\n",(0,o.jsxs)(n.p,{children:["The data set will be used to write a ",(0,o.jsx)(n.code,{children:"segment"})," file first, and then the time-consuming scan of the entire ",(0,o.jsx)(n.code,{children:"segment"})," will be counted."]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"./benchmark_tool --operation=SegmentScan --column_type=int,varchar --rows_number=10000 --iterations=0"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"column_type"})," here can set the schema, the column type of the ",(0,o.jsx)(n.code,{children:"segment"})," layer currently supports ",(0,o.jsx)(n.code,{children:"int, char, varchar, string"}),", the length of the ",(0,o.jsx)(n.code,{children:"char"})," type is ",(0,o.jsx)(n.code,{children:"8"}),", and both ",(0,o.jsx)(n.code,{children:"varchar"})," and ",(0,o.jsx)(n.code,{children:"string"})," types have length restrictions Is the maximum value. The default value is ",(0,o.jsx)(n.code,{children:"int,varchar"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"The data set is generated according to the following rules."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"int: Random in [1,1000000]."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The data character set of string type is uppercase and lowercase English letters, and the length varies according to the type."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"char: Length random in [1,8].\nvarchar: Length random in [1,128].\nstring: Length random in [1,100000]."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"rows_number"})," indicates the number of rows of data, the default value is ",(0,o.jsx)(n.code,{children:"10000"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"iterations"})," indicates the number of iterations, the benchmark will repeat the test, and then calculate the average time. If ",(0,o.jsx)(n.code,{children:"iterations"})," is ",(0,o.jsx)(n.code,{children:"0"}),", it means that the number of iterations is automatically selected by the benchmark. The default value is ",(0,o.jsx)(n.code,{children:"10"}),"."]}),"\n",(0,o.jsx)(n.h4,{id:"use-randomly-generated-data-set-for-segment-write-test",children:"Use randomly generated data set for segment write test"}),"\n",(0,o.jsx)(n.p,{children:"Perform time-consuming statistics on the process of adding data sets to segments and writing them to disk."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"./benchmark_tool --operation=SegmentWrite"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"use-the-data-set-imported-from-the-file-for-segment-read-test",children:"Use the data set imported from the file for segment read test"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"./benchmark_tool --operation=SegmentScanByFile --input_file=./sample.dat"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"input_file"})," here is the imported data set file.\nThe first row of the data set file defines the schema, and each row corresponds to a row of data, and each data is separated by ",(0,o.jsx)(n.code,{children:","}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"int,char,varchar\n123,hello,world\n321,good,bye\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The type support is also ",(0,o.jsx)(n.code,{children:"int"}),", ",(0,o.jsx)(n.code,{children:"char"}),", ",(0,o.jsx)(n.code,{children:"varchar"}),", ",(0,o.jsx)(n.code,{children:"string"}),". Note that the data length of the ",(0,o.jsx)(n.code,{children:"char"})," type cannot exceed 8."]}),"\n",(0,o.jsx)(n.h4,{id:"use-the-data-set-imported-from-the-file-for-segment-write-test",children:"Use the data set imported from the file for segment write test"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"./benchmark_tool --operation=SegmentWriteByFile --input_file=./sample.dat"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"use-randomly-generated-data-set-for-page-dictionary-encoding-test",children:"Use randomly generated data set for page dictionary encoding test"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"./benchmark_tool --operation=BinaryDictPageEncode --rows_number=10000 --iterations=0"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Randomly generate varchar with a length between [1,8], and perform time-consuming statistics on encoding."}),"\n",(0,o.jsx)(n.h4,{id:"use-randomly-generated-data-set-for-page-dictionary-decoding-test",children:"Use randomly generated data set for page dictionary decoding test"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"./benchmark_tool --operation=BinaryDictPageDecode"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Randomly generate varchar with a length between [1,8] and encode, and perform time-consuming statistics on decoding."}),"\n",(0,o.jsx)(n.h2,{id:"custom-test",children:"Custom test"}),"\n",(0,o.jsxs)(n.p,{children:["Here, users are supported to use their own functions for performance testing, which can be implemented in ",(0,o.jsx)(n.code,{children:"/be/test/tools/benchmark_tool.cpp"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"For example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cpp",children:"void custom_run_plus() {\n    int p = 100000;\n    int q = 0;\n    while (p--) {\n        q++;\n        if (UNLIKELY(q == 1024)) q = 0;\n    }\n}\nvoid custom_run_mod() {\n    int p = 100000;\n    int q = 0;\n    while (p--) {\n        q++;\n        if (q %= 1024) q = 0;\n    }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You can join the test by registering ",(0,o.jsx)(n.code,{children:"CustomBenchmark"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cpp",children:'benchmarks.emplace_back(\n                    new doris::CustomBenchmark("custom_run_plus", 0,\n                    	custom_init, custom_run_plus));\nbenchmarks.emplace_back(\n                    new doris::CustomBenchmark("custom_run_mod", 0,\n                    	custom_init, custom_run_mod));\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"custom_init"})," here is the initialization step of each round of testing (not counted as time-consuming). If the user has an object that needs to be initialized, it can be implemented by a derived class of ",(0,o.jsx)(n.code,{children:"CustomBenchmark"}),".\nAfter running, the results are as follows:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"2021-08-30T10:29:35+08:00\nRunning ./benchmark_tool\nRun on (96 X 3100.75 MHz CPU s)\nCPU Caches:\n  L1 Data 32 KiB (x48)\n  L1 Instruction 32 KiB (x48)\n  L2 Unified 1024 KiB (x48)\n  L3 Unified 33792 KiB (x2)\nLoad Average: 0.55, 0.53, 0.39\n----------------------------------------------------------\nBenchmark                Time             CPU   Iterations\n----------------------------------------------------------\ncustom_run_plus      0.812 ms        0.812 ms          861\ncustom_run_mod        1.30 ms         1.30 ms          539\n"})})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return a},a:function(){return i}});var r=t(667294);let o={},s=r.createContext(o);function i(e){let n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);