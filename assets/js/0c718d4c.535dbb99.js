"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["841655"],{948148:function(e,t,n){n.r(t),n.d(t,{default:()=>p,frontMatter:()=>r,metadata:()=>s,assets:()=>l,toc:()=>d,contentTitle:()=>i});var s=JSON.parse('{"id":"admin-manual/data-admin/backup-restore/restore","title":"Restore","description":"Prerequisites","source":"@site/docs/admin-manual/data-admin/backup-restore/restore.md","sourceDirName":"admin-manual/data-admin/backup-restore","slug":"/admin-manual/data-admin/backup-restore/restore","permalink":"/docs/dev/admin-manual/data-admin/backup-restore/restore","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Restore","language":"en"},"sidebar":"docs","previous":{"title":"Backup","permalink":"/docs/dev/admin-manual/data-admin/backup-restore/backup"},"next":{"title":"Overview","permalink":"/docs/dev/admin-manual/data-admin/ccr/overview"}}'),a=n("785893"),o=n("250065");let r={title:"Restore",language:"en"},i=void 0,l={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"1. Get the Backup Timestamp of the Snapshot",id:"1-get-the-backup-timestamp-of-the-snapshot",level:2},{value:"2. Restore from Snapshot",id:"2-restore-from-snapshot",level:2},{value:"Option 1: Restore Snapshot to Current Database",id:"option-1-restore-snapshot-to-current-database",level:3},{value:"Option 2: Restore Snapshot to Specified Database",id:"option-2-restore-snapshot-to-specified-database",level:3},{value:"Option 3: Restore a Single Table from Snapshot",id:"option-3-restore-a-single-table-from-snapshot",level:3},{value:"Option 4: Restore Partitions and Tables from Snapshot",id:"option-4-restore-partitions-and-tables-from-snapshot",level:3},{value:"3. Check the Execution Status of the Restore Job",id:"3-check-the-execution-status-of-the-restore-job",level:2}];function c(e){let t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Ensure you have ",(0,a.jsx)(t.strong,{children:"administrator"})," privileges to perform the restore operation."]}),"\n",(0,a.jsxs)(t.li,{children:["Ensure you have an existing ",(0,a.jsx)(t.strong,{children:"Repository"})," to store the backup. If not, follow the steps to create a Repository and perform a ",(0,a.jsx)(t.a,{href:"/docs/dev/admin-manual/data-admin/backup-restore/backup",children:"backup"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["Ensure you have a valid ",(0,a.jsx)(t.strong,{children:"backup"})," snapshot available for restore."]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"1-get-the-backup-timestamp-of-the-snapshot",children:"1. Get the Backup Timestamp of the Snapshot"}),"\n",(0,a.jsxs)(t.p,{children:["The following SQL statement can be used to view existing backups in the Repository named ",(0,a.jsx)(t.code,{children:"example_repo"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:"mysql> SHOW SNAPSHOT ON example_repo;\n+-----------------+---------------------+--------+\n| Snapshot            | Timestamp              | Status   |\n+-----------------+---------------------+--------+\n| exampledb_20241225 | 2022-04-08-15-52-29 | OK     |\n+-----------------+---------------------+--------+\n1 row in set (0.15 sec)\n"})}),"\n",(0,a.jsx)(t.h2,{id:"2-restore-from-snapshot",children:"2. Restore from Snapshot"}),"\n",(0,a.jsx)(t.h3,{id:"option-1-restore-snapshot-to-current-database",children:"Option 1: Restore Snapshot to Current Database"}),"\n",(0,a.jsxs)(t.p,{children:["The following SQL statement restores the snapshot labeled ",(0,a.jsx)(t.code,{children:"restore_label1"})," with the timestamp ",(0,a.jsx)(t.code,{children:"2022-04-08-15-52-29"})," from the Repository named ",(0,a.jsx)(t.code,{children:"example_repo"})," to the current database."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:'RESTORE SNAPSHOT `restore_label1`\nFROM `example_repo`\nPROPERTIES\n(\n    "backup_timestamp"="2022-04-08-15-52-29"\n);\n'})}),"\n",(0,a.jsx)(t.h3,{id:"option-2-restore-snapshot-to-specified-database",children:"Option 2: Restore Snapshot to Specified Database"}),"\n",(0,a.jsxs)(t.p,{children:["The following SQL statement restores the snapshot labeled ",(0,a.jsx)(t.code,{children:"restore_label1"})," with the timestamp ",(0,a.jsx)(t.code,{children:"2022-04-08-15-52-29"})," from the Repository named ",(0,a.jsx)(t.code,{children:"example_repo"})," to a database named ",(0,a.jsx)(t.code,{children:"destdb"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:'RESTORE SNAPSHOT destdb.`restore_label1`\nFROM `example_repo`\nPROPERTIES\n(\n    "backup_timestamp"="2022-04-08-15-52-29"\n);\n'})}),"\n",(0,a.jsx)(t.h3,{id:"option-3-restore-a-single-table-from-snapshot",children:"Option 3: Restore a Single Table from Snapshot"}),"\n",(0,a.jsxs)(t.p,{children:["Restore the table ",(0,a.jsx)(t.code,{children:"backup_tbl"})," from the snapshot in ",(0,a.jsx)(t.code,{children:"example_repo"})," to the current database, with the snapshot labeled ",(0,a.jsx)(t.code,{children:"restore_label1"})," and timestamp ",(0,a.jsx)(t.code,{children:"2022-04-08-15-52-29"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:'RESTORE SNAPSHOT `restore_label1`\nFROM `example_repo`\nON ( `backup_tbl` )\nPROPERTIES\n(\n    "backup_timestamp"="2022-04-08-15-52-29"\n);\n'})}),"\n",(0,a.jsx)(t.h3,{id:"option-4-restore-partitions-and-tables-from-snapshot",children:"Option 4: Restore Partitions and Tables from Snapshot"}),"\n",(0,a.jsxs)(t.p,{children:["Restore partitions p1 and p2 of the table ",(0,a.jsx)(t.code,{children:"backup_tbl"}),", as well as the table ",(0,a.jsx)(t.code,{children:"backup_tbl2"})," to the current database ",(0,a.jsx)(t.code,{children:"example_db1"}),", renaming it to ",(0,a.jsx)(t.code,{children:"new_tbl"}),", from the backup snapshot ",(0,a.jsx)(t.code,{children:"snapshot_2"}),", with the snapshot timestamp ",(0,a.jsx)(t.code,{children:'"2018-05-04-17-11-01"'}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:'RESTORE SNAPSHOT `restore_label1`\nFROM `example_repo`\nON\n(\n    `backup_tbl` PARTITION (`p1`, `p2`),\n    `backup_tbl2` AS `new_tbl`\n)\nPROPERTIES\n(\n    "backup_timestamp"="2022-04-08-15-55-43"\n);\n'})}),"\n",(0,a.jsx)(t.h2,{id:"3-check-the-execution-status-of-the-restore-job",children:"3. Check the Execution Status of the Restore Job"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"  ```sql\n"})}),"\n",(0,a.jsx)(t.p,{children:'mysql> SHOW RESTORE\\G;\n*************************** 1. row ***************************\nJobId: 17891851\nLabel: snapshot_label1\nTimestamp: 2022-04-08-15-52-29\nDbName: default_cluster:example_db1\nState: FINISHED\nAllowLoad: false\nReplicationNum: 3\nRestoreObjs: {\n"name": "snapshot_label1",\n"database": "example_db",\n"backup_time": 1649404349050,\n"content": "ALL",\n"olap_table_list": [\n{\n"name": "backup_tbl",\n"partition_names": [\n"p1",\n"p2"\n]\n}\n],\n"view_list": [],\n"odbc_table_list": [],\n"odbc_resource_list": []\n}\nCreateTime: 2022-04-08 15:59:01\nMetaPreparedTime: 2022-04-08 15:59:02\nSnapshotFinishedTime: 2022-04-08 15:59:05\nDownloadFinishedTime: 2022-04-08 15:59:12\nFinishedTime: 2022-04-08 15:59:18\nUnfinishedTasks:\nProgress:\nTaskErrMsg:\nStatus: [OK]\nTimeout: 86400\n1 row in set (0.01 sec)'}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{})})]})}function p(e={}){let{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return i},a:function(){return r}});var s=n(667294);let a={},o=s.createContext(a);function r(e){let t=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);