"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["254974"],{847711:function(e,n,i){i.r(n),i.d(n,{default:()=>h,frontMatter:()=>s,metadata:()=>t,assets:()=>l,toc:()=>c,contentTitle:()=>o});var t=JSON.parse('{"id":"lakehouse/datalake-analytics/hive","title":"Hive Catalog","description":"By connecting to Hive Metastore, Doris can automatically obtain database and table information from Hive and perform data queries.","source":"@site/versioned_docs/version-2.0/lakehouse/datalake-analytics/hive.md","sourceDirName":"lakehouse/datalake-analytics","slug":"/lakehouse/datalake-analytics/hive","permalink":"/docs/2.0/lakehouse/datalake-analytics/hive","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"Hive Catalog","language":"en"},"sidebar":"docs","previous":{"title":"Lakehouse Overview","permalink":"/docs/2.0/lakehouse/lakehouse-overview"},"next":{"title":"Hudi Catalog","permalink":"/docs/2.0/lakehouse/datalake-analytics/hudi"}}'),r=i("785893"),a=i("250065");let s={title:"Hive Catalog",language:"en"},o=void 0,l={},c=[{value:"Note",id:"note",level:2},{value:"Create Catalog",id:"create-catalog",level:2},{value:"Hive on HDFS",id:"hive-on-hdfs",level:3},{value:"Hive on VIEWFS",id:"hive-on-viewfs",level:3},{value:"Hive on JuiceFS",id:"hive-on-juicefs",level:3},{value:"Doris query DLC",id:"doris-query-dlc",level:3},{value:"Hive on S3",id:"hive-on-s3",level:3},{value:"Hive on OSS",id:"hive-on-oss",level:3},{value:"Hive on OBS",id:"hive-on-obs",level:3},{value:"Hive on COS",id:"hive-on-cos",level:3},{value:"Hive with AWS Glue",id:"hive-with-aws-glue",level:3},{value:"Metadata Cache &amp; Refresh",id:"metadata-cache--refresh",level:2},{value:"Default behavior and TTL",id:"default-behavior-and-ttl",level:3},{value:"Manual refresh",id:"manual-refresh",level:3},{value:"Regular refresh",id:"regular-refresh",level:3},{value:"Auto refresh",id:"auto-refresh",level:3},{value:"Hive Version",id:"hive-version",level:2},{value:"Column type mapping",id:"column-type-mapping",level:2},{value:"Access HMS with broker",id:"access-hms-with-broker",level:2},{value:"Integrate with Apache Ranger",id:"integrate-with-apache-ranger",level:2},{value:"Environment settings",id:"environment-settings",level:3},{value:"Best Practice",id:"best-practice",level:3},{value:"Authentication with Kerberos",id:"authentication-with-kerberos",level:2},{value:"Environment settings",id:"environment-settings-1",level:3},{value:"Best practice",id:"best-practice-1",level:3},{value:"Hive transactional table",id:"hive-transactional-table",level:2},{value:"Support for Hive transactional tables",id:"support-for-hive-transactional-tables",level:3},{value:"Current restrictions",id:"current-restrictions",level:3}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"By connecting to Hive Metastore, Doris can automatically obtain database and table information from Hive and perform data queries."}),"\n",(0,r.jsx)(n.p,{children:"In addition to Hive, systems like Iceberg and Hudi also use Hive Metastore for metadata storage. Hive Catalog in Doris allows users to easily integrate with not only Hive but also systems that use Hive Metastore as metadata storage."}),"\n",(0,r.jsx)(n.h2,{id:"note",children:"Note"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Hive 1, Hive 2, and Hive 3 are supported."}),"\n",(0,r.jsx)(n.li,{children:"Managed Tables, External Tables, and part of the Hive Views are supported."}),"\n",(0,r.jsx)(n.li,{children:"It can recognize Hive, Iceberg, and Hudi metadata stored in the Hive Metastore."}),"\n",(0,r.jsx)(n.li,{children:"You should place core-site.xml, hdfs-site.xml, and hive-site.xml in the conf directory of both FE and BE. During reading, the hadoop configuration files in the conf directory are read first, followed by the configuration files related to the HADOOP_CONF_DIR environment variable."}),"\n",(0,r.jsx)(n.li,{children:"If the Hadoop node is configured with hostname, please ensure to add the corresponding mapping relationship to the /etc/hosts file."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"create-catalog",children:"Create Catalog"}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-hdfs",children:"Hive on HDFS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:"CREATE CATALOG hive PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:8088',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:8088',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In addition to the two required parameters of ",(0,r.jsx)(n.code,{children:"type"})," and ",(0,r.jsx)(n.code,{children:"hive.metastore.uris"}),", you can specify more parameters to pass the required information for the connection."]}),"\n",(0,r.jsx)(n.p,{children:"Example to provide HDFS HA information:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:"CREATE CATALOG hive PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:8088',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:8088',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-viewfs",children:"Hive on VIEWFS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:"CREATE CATALOG hive PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:8088',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:8088',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider',\n    'fs.defaultFS' = 'viewfs://your-cluster',\n    'fs.viewfs.mounttable.your-cluster.link./ns1' = 'hdfs://your-nameservice/',\n    'fs.viewfs.mounttable.your-cluster.homedir' = '/ns1'\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can add viewfs-related parameters to the catalog configuration as above, or add them to ",(0,r.jsx)(n.code,{children:"conf/core-site.xml"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["For details about how viewfs works and the parameter configurations, please refer to relevant hadoop documents, such as ",(0,r.jsx)(n.a,{href:"https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/ViewFs.html",children:"https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/ViewFs.html"})]}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-juicefs",children:"Hive on JuiceFS"}),"\n",(0,r.jsx)(n.p,{children:"Example for data stored on JuiceFS:"}),"\n",(0,r.jsxs)(n.p,{children:["(You should put ",(0,r.jsx)(n.code,{children:"juicefs-hadoop-x.x.x.jar"})," under ",(0,r.jsx)(n.code,{children:"fe/lib/"})," and ",(0,r.jsx)(n.code,{children:"apache_hdfs_broker/lib/"}),".)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:"CREATE CATALOG hive PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hadoop.username' = 'root',\n    'fs.jfs.impl' = 'io.juicefs.JuiceFileSystem',\n    'fs.AbstractFileSystem.jfs.impl' = 'io.juicefs.JuiceFS',\n    'juicefs.meta' = 'xxx'\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"doris-query-dlc",children:"Doris query DLC"}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"Supported since Doris version 2.0.13"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://cloud.tencent.com/product/dlc",children:"DLC"})," of Tencent Cloud use HMS to manage its metadata, so Hive catalog can be used\u3002\nDLC stores data on LakeFS or COSN, below catalog is compatible with both file system."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG dlc PROPERTIES (\n    'type' = 'hms',\n    'hive.metastore.uris' = 'thrift://<dlc_metastore_ip>:<dlc_metastore_port>',\n    's3.access_key' = 'xxxxx',\n    's3.secret_key' = 'xxxxx',\n    's3.region' = 'ap-xxx',\n    's3.endpoint' = 'cos.ap-xxx.myqcloud.com',\n    'fs.cosn.bucket.region' = 'ap-xxx',\n    'fs.ofs.user.appid' = '<your_tencent_cloud_appid>',\n    'fs.ofs.tmp.cache.dir' = '<tmp_cache_dir>'\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["After create catalog, you need to ",(0,r.jsx)(n.a,{href:"https://cloud.tencent.com/document/product/436/38648",children:"grant"})," essential privilege to the appid your dlc catalog is using."]}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-s3",children:"Hive on S3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:'CREATE CATALOG hive PROPERTIES (\n    "type"="hms",\n    "hive.metastore.uris" = "thrift://172.0.0.1:9083",\n    "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n    "s3.region" = "us-east-1",\n    "s3.access_key" = "ak",\n    "s3.secret_key" = "sk",\n    "use_path_style" = "true"\n);\n'})}),"\n",(0,r.jsx)(n.p,{children:"Optional properties:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"s3.connection.maximum: defaults to 50"}),"\n",(0,r.jsx)(n.li,{children:"s3.connection.request.timeout: defaults to 3000ms"}),"\n",(0,r.jsx)(n.li,{children:"s3.connection.timeout: defaults to 1000ms"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-oss",children:"Hive on OSS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:'CREATE CATALOG hive PROPERTIES (\n    "type"="hms",\n    "hive.metastore.uris" = "thrift://172.0.0.1:9083",\n    "oss.endpoint" = "oss.oss-cn-beijing.aliyuncs.com",\n    "oss.access_key" = "ak",\n    "oss.secret_key" = "sk"\n);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-obs",children:"Hive on OBS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:'CREATE CATALOG hive PROPERTIES (\n    "type"="hms",\n    "hive.metastore.uris" = "thrift://172.0.0.1:9083",\n    "obs.endpoint" = "obs.cn-north-4.myhuaweicloud.com",\n    "obs.access_key" = "ak",\n    "obs.secret_key" = "sk"\n);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-cos",children:"Hive on COS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:'CREATE CATALOG hive PROPERTIES (\n    "type"="hms",\n    "hive.metastore.uris" = "thrift://172.0.0.1:9083",\n    "cos.endpoint" = "cos.ap-beijing.myqcloud.com",\n    "cos.access_key" = "ak",\n    "cos.secret_key" = "sk"\n);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"hive-with-aws-glue",children:"Hive with AWS Glue"}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["When connecting to Glue, if you are in a non-EC2 environment, you need to copy the ",(0,r.jsx)(n.code,{children:"~/.aws"})," directory from the EC2 environment to your current environment. Alternatively, you can download the AWS ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html",children:"CLI"})," tool for configuration, which will also create the ",(0,r.jsx)(n.code,{children:".aws"})," directory in the current user's home directory."]})}),"\n",(0,r.jsx)(n.p,{children:"Access to AWS services with Doris supports two authentication methods."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Authentication using Catalog properties"})}),"\n",(0,r.jsx)(n.p,{children:"You can fill in the basic properties of credentials, such as:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["When accessing S3, you can use ",(0,r.jsx)(n.code,{children:"s3.endpoint"}),", ",(0,r.jsx)(n.code,{children:"s3.access_key"}),", ",(0,r.jsx)(n.code,{children:"s3.secret_key"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["When accessing Glue, you can use ",(0,r.jsx)(n.code,{children:"glue.endpoint"}),", ",(0,r.jsx)(n.code,{children:"glue.access_key"}),", ",(0,r.jsx)(n.code,{children:"glue.secret_key"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"For example, if you are accessing Glue using Iceberg Catalog, you can fill in the following properties to access tables hosted on Glue:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:'CREATE CATALOG hive PROPERTIES (\n    "type"="hms",\n    "hive.metastore.type" = "glue",\n    "glue.endpoint" = "https://glue.us-east-1.amazonaws.com",\n    "glue.access_key" = "ak",\n    "glue.secret_key" = "sk"\n);\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Authentication using system properties"})}),"\n",(0,r.jsx)(n.p,{children:"This authentication method is used for applications running on AWS resources such as EC2 instances. It avoids hard-coding credentials and enhances data security."}),"\n",(0,r.jsx)(n.p,{children:"If you create a Catalog without filling in the Credentials properties, the DefaultAWSCredentialsProviderChain will be used by default. It can read properties configured in system environment variables or instance profiles."}),"\n",(0,r.jsxs)(n.p,{children:["For configurations of environment variables and system properties, refer to ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html",children:"AWS CLI"}),"."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Optional environment variables include: ",(0,r.jsx)(n.code,{children:"AWS_ACCESS_KEY_ID"}),", ",(0,r.jsx)(n.code,{children:"AWS_SECRET_ACCESS_KEY"}),", ",(0,r.jsx)(n.code,{children:"AWS_SESSION_TOKEN"}),", ",(0,r.jsx)(n.code,{children:"AWS_ROLE_ARN"}),", ",(0,r.jsx)(n.code,{children:"AWS_WEB_IDENTITY_TOKEN_FILE"}),", etc."]}),"\n",(0,r.jsxs)(n.li,{children:["You can follow ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html",children:"AWS Configure"})," to directly configure the Credentials information, which will generate a credentials file in the ",(0,r.jsx)(n.code,{children:"~/.aws"})," directory."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"metadata-cache--refresh",children:"Metadata Cache & Refresh"}),"\n",(0,r.jsx)(n.p,{children:"For Hive Catalog, Doris caches 4 types of metadata:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Table schema: table column information, etc."}),"\n",(0,r.jsx)(n.li,{children:"Partition value: partition value information of all partitions in a table."}),"\n",(0,r.jsx)(n.li,{children:"Partition information: information of each partition, such as partition data format, partition storage location, partition value, etc."}),"\n",(0,r.jsx)(n.li,{children:"File information: file information corresponding to each partition, such as file path location, etc."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The above cached information will not be persisted to Doris, so operations such as restarting Doris FE node, switching to masters may invalidate the cache. If the cache expires, Doris will directly access the Hive MetaStore to obtain information and refill the cache."}),"\n",(0,r.jsx)(n.p,{children:"Metadata cache can be updated automatically, manually, or configured with TTL (Time-to-Live)."}),"\n",(0,r.jsx)(n.h3,{id:"default-behavior-and-ttl",children:"Default behavior and TTL"}),"\n",(0,r.jsxs)(n.p,{children:["By default, the metadata cache expires 10 minutes after it is first accessed. The TTL is determined by the configuration parameter ",(0,r.jsx)(n.code,{children:"external_cache_expire_time_minutes_after_access"})," in fe.conf. (Note that in versions 2.0.1 and earlier, the default value for this parameter was 1 day)."]}),"\n",(0,r.jsx)(n.p,{children:"For example, if the user accesses the metadata of table A for the first time at 10:00, then the metadata will be cached and will automatically expire after 10:10. If the user accesses the same metadata again at 10:11, Doris will directly access the Hive MetaStore to obtain information and refill the cache."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"external_cache_expire_time_minutes_after_access"})," affects all 4 caches under Catalog."]}),"\n",(0,r.jsxs)(n.p,{children:["For the ",(0,r.jsx)(n.code,{children:"INSERT INTO OVERWRITE PARTITION"})," operation commonly used in Hive, you can also timely update the ",(0,r.jsx)(n.code,{children:"File Information Cache"})," by configuring the TTL of the ",(0,r.jsx)(n.code,{children:"File Information Cache"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Plain",children:"CREATE CATALOG hive PROPERTIES (\n     'type'='hms',\n     'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n     'file.meta.cache.ttl-second' = '60'\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In the above example, ",(0,r.jsx)(n.code,{children:"file.meta.cache.ttl-second"})," is set to 60 seconds, and the cache will expire after 60 seconds. This parameter will only affect the ",(0,r.jsx)(n.code,{children:"file information cache"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"You can also set this value to 0 to disable file caching, which will fetch file information directly from the Hive MetaStore every time."}),"\n",(0,r.jsx)(n.h3,{id:"manual-refresh",children:"Manual refresh"}),"\n",(0,r.jsxs)(n.p,{children:["Users need to manually refresh the metadata through the ",(0,r.jsx)(n.a,{href:"/docs/2.0/sql-manual/sql-reference/Utility-Statements/REFRESH",children:"REFRESH"})," command."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"REFRESH CATALOG: Refresh the specified Catalog."})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Shell",children:'REFRESH CATALOG ctl1 PROPERTIES("invalid_cache" = "true");\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This command refreshes the database list, table list, and all cached information of the specified Catalog."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"invalid_cache"})," indicates whether to refresh the cache. It defaults to true. If it is false, it will only refresh the database and table list of the catalog, but not the cached information. This parameter is applicable when the user only wants to synchronize newly added or deleted database/table information."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"REFRESH DATABASE: Refresh the specified Database."})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Shell",children:'REFRESH DATABASE [ctl.]db1 PROPERTIES("invalid_cache" = "true"); \n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This command refreshes the table list of the specified database and all cached information under the database."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"invalid_cache"})," indicates the same as above. It defaults to true. If false, it will only refresh the table list of the database, but not the cached information. This parameter is applicable when the user only wants to synchronize newly added or deleted table information."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"REFRESH TABLE: Refresh the specified Table."})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Shell",children:"REFRESH TABLE [ctl.][db.]tbl1; \n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This command refreshes all cached information under the specified table."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"regular-refresh",children:"Regular refresh"}),"\n",(0,r.jsx)(n.p,{children:"Users can schedule the refresh for a Catalog when creating the Catalog."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Plain",children:"CREATE CATALOG hive PROPERTIES (\n     'type'='hms',\n     'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n     'metadata_refresh_interval_sec' = '600'\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In the above example, ",(0,r.jsx)(n.code,{children:"metadata_refresh_interval_sec"})," means refreshing the Catalog every 600 seconds, which means the following command will be executed automatically every 600 seconds:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'REFRESH CATALOG ctl1 PROPERTIES("invalid_cache" = "true");\n'})}),"\n",(0,r.jsx)(n.p,{children:"Note that the scheduled refresh interval must not be less than 5 seconds."}),"\n",(0,r.jsx)(n.h3,{id:"auto-refresh",children:"Auto refresh"}),"\n",(0,r.jsx)(n.p,{children:"Currently, Doris only supports automatic update of metadata in Hive Metastore (HMS). It perceives changes in metadata by the FE node which regularly reads the notification events from HMS. The supported events are as follows:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Event"}),(0,r.jsx)(n.th,{children:"Corresponding Update Operation"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CREATE DATABASE"}),(0,r.jsx)(n.td,{children:"Create a database in the corresponding catalog."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"DROP DATABASE"}),(0,r.jsx)(n.td,{children:"Delete a database in the corresponding catalog."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ALTER DATABASE"}),(0,r.jsx)(n.td,{children:"Such alterations mainly include changes in properties, comments, or storage location of databases. They do not affect Doris' queries in External Catalogs."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CREATE TABLE"}),(0,r.jsx)(n.td,{children:"Create a table in the corresponding database."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"DROP TABLE"}),(0,r.jsx)(n.td,{children:"Delete a table in the corresponding database, and invalidate the cache of that table."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ALTER TABLE"}),(0,r.jsx)(n.td,{children:"If it is renaming, delete the table of the old name, and then create a new table with the new name; otherwise, invalidate the cache of that table."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADD PARTITION"}),(0,r.jsx)(n.td,{children:"Add a partition to the cached partition list of the corresponding table."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"DROP PARTITION"}),(0,r.jsx)(n.td,{children:"Delete a partition from the cached partition list of the corresponding table, and invalidate the cache of that partition."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ALTER PARTITION"}),(0,r.jsx)(n.td,{children:"If it is a renaming, delete the partition of the old name, and then create a new partition with the new name; otherwise, invalidate the cache of that partition."})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["After data ingestion, changes in partition tables will follow the ",(0,r.jsx)(n.code,{children:"ALTER PARTITION"})," logic, while those in non-partition tables will follow the ",(0,r.jsx)(n.code,{children:"ALTER TABLE"})," logic."]}),"\n",(0,r.jsx)(n.p,{children:"If changes are conducted on the file system directly instead of through the HMS, the HMS will not generate an event. As a result, such changes will not be perceived by Doris."}),"\n",(0,r.jsx)(n.p,{children:"The automatic update feature involves the following parameters in fe.conf:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"enable_hms_events_incremental_sync"}),": This specifies whether to enable automatic incremental synchronization for metadata, which is disabled by default."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hms_events_polling_interval_ms"}),": This specifies the interval between two readings, which is set to 10000 by default. (Unit: millisecond)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hms_events_batch_size_per_rpc"}),": This specifies the maximum number of events that are read at a time, which is set to 500 by default."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"To enable automatic update(Excluding Huawei MRS), you need to modify the hive-site.xml of HMS and then restart HMS and HiveServer2:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Plain",children:"<property>\n    <name>hive.metastore.event.db.notification.api.auth</name>\n    <value>false</value>\n</property>\n<property>\n    <name>hive.metastore.dml.events</name>\n    <value>true</value>\n</property>\n<property>\n    <name>hive.metastore.transactional.event.listeners</name>\n    <value>org.apache.hive.hcatalog.listener.DbNotificationListener</value>\n</property>\n"})}),"\n",(0,r.jsx)(n.p,{children:"For Huawei MRS, you need to change hivemetastore-site.xml and restart HMS and HiveServer2:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Plain",children:"<property>\n    <name>metastore.transactional.event.listeners</name>\n    <value>org.apache.hive.hcatalog.listener.DbNotificationListener</value>\n</property>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"hive-version",children:"Hive Version"}),"\n",(0,r.jsxs)(n.p,{children:["Doris can correctly access the Hive Metastore in different Hive versions. By default, Doris will access the Hive Metastore with a Hive 2.3 compatible interface. If you encounter the ",(0,r.jsx)(n.code,{children:"Invalid method name: 'get_table_req'"})," error during queries, the root cause is Hive version incompatibility."]}),"\n",(0,r.jsx)(n.p,{children:"You can specify the Hive version when creating the Catalog. For example, to access Hive 1.1.0 version:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Plain",children:"CREATE CATALOG hive PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hive.version' = '1.1.0'\n);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"column-type-mapping",children:"Column type mapping"}),"\n",(0,r.jsx)(n.p,{children:"For Hive/Iceberge/Hudi"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"HMS Type"}),(0,r.jsx)(n.th,{children:"Doris Type"}),(0,r.jsx)(n.th,{children:"Comment"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"tinyint"}),(0,r.jsx)(n.td,{children:"tinyint"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"smallint"}),(0,r.jsx)(n.td,{children:"smallint"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"int"}),(0,r.jsx)(n.td,{children:"int"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"bigint"}),(0,r.jsx)(n.td,{children:"bigint"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"date"}),(0,r.jsx)(n.td,{children:"date"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"timestamp"}),(0,r.jsx)(n.td,{children:"datetime"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"float"}),(0,r.jsx)(n.td,{children:"float"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"double"}),(0,r.jsx)(n.td,{children:"double"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"char"}),(0,r.jsx)(n.td,{children:"char"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"varchar"}),(0,r.jsx)(n.td,{children:"varchar"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"decimal"}),(0,r.jsx)(n.td,{children:"decimal"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"array<type>"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"array<type>"})}),(0,r.jsxs)(n.td,{children:["Supports nested structure, such as ",(0,r.jsx)(n.code,{children:"array<map<string, int>>"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"map<KeyType, ValueType>"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"map<KeyType, ValueType>"})}),(0,r.jsxs)(n.td,{children:["Supports nested structure, such as ",(0,r.jsx)(n.code,{children:"map<string, array<int>>"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"struct<col1: Type1, col2: Type2, ...>"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"struct<col1: Type1, col2: Type2, ...>"})}),(0,r.jsxs)(n.td,{children:["Supports nested structure, such as ",(0,r.jsx)(n.code,{children:"struct<col1: array<int>"}),", ",(0,r.jsx)(n.code,{children:"col2: map<int, date>>"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"other"}),(0,r.jsx)(n.td,{children:"unsupported"}),(0,r.jsx)(n.td,{})]})]})]}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Truncate char or varchar columns"})}),(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"truncate_char_or_varchar_columns"})," is enabled, and the maximum length of the char or varchar column in the schema of the hive table is inconsistent with the schema in the underlying Parquet or ORC file, the columns will be truncated according to the maximum length of the hive table column."]}),(0,r.jsx)(n.p,{children:"The variable defaults to false."})]}),"\n",(0,r.jsx)(n.h2,{id:"access-hms-with-broker",children:"Access HMS with broker"}),"\n",(0,r.jsxs)(n.p,{children:["Add the following setting when creating an HMS catalog, file splitting and scanning for Hive external table will be completed by the broker named ",(0,r.jsx)(n.code,{children:"test_broker"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:'"broker.name" = "test_broker"\n'})}),"\n",(0,r.jsx)(n.p,{children:"Doris supports querying HMS Catalog Iceberg by implementing the Iceberg FileIO interface in the Broker. If needed, you can add the following configuration when creating an HMS Catalog."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:'"io-impl" = "org.apache.doris.datasource.iceberg.broker.IcebergBrokerIO"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"integrate-with-apache-ranger",children:"Integrate with Apache Ranger"}),"\n",(0,r.jsx)(n.p,{children:"Apache Ranger is a security framework for monitoring, enabling services, and comprehensive data security access management on the Hadoop platform."}),"\n",(0,r.jsx)(n.p,{children:"Doris supports authentication on specified External Hive Catalog using Apache Ranger."}),"\n",(0,r.jsx)(n.p,{children:"Currently Doris supports authentication of Ranger libraries, tables, and columns, but does not support encryption, row privileges, and Data Mask."}),"\n",(0,r.jsxs)(n.p,{children:["If you need to use Apache Ranger for authentication of the entire Doris cluster, refer to ",(0,r.jsx)(n.a,{href:"../../lakehouse/datalake/hive#integrate-with-apache-ranger",children:"Integrate with Apache Ranger"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"environment-settings",children:"Environment settings"}),"\n",(0,r.jsx)(n.p,{children:"To connect to the Hive Metastore with Ranger authentication enabled, you need to add configurations and environment settings as follows:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"When creating a Catalog, add:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:'"access_controller.properties.ranger.service.name" = "hive",\n"access_controller.class" = "org.apache.doris.catalog.authorizer.RangerHiveAccessControllerFactory",\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"access_controller.properties.ranger.service.name"})," refers to the type of service, such as ",(0,r.jsx)(n.code,{children:"hive"}),", ",(0,r.jsx)(n.code,{children:"hdfs"}),", etc. It does not correspond to the value of ",(0,r.jsx)(n.code,{children:"ranger.plugin.hive.service.name"})," in the configuration file."]})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Configure all FE environments:"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"a. Copy the configuration files ranger-hive-audit.xml, ranger-hive-security.xml, and ranger-policymgr-ssl.xml under the HMS conf directory to the FE conf directory."}),"\n",(0,r.jsx)(n.p,{children:"b. Modify the properties in ranger-hive-security.xml, an example is as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:'<?xml version="1.0" encoding="UTF-8"?>\n<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>\n<configuration>\n    #The directory for caching permission data, needs to be writable\n    <property>\n        <name>ranger.plugin.hive.policy.cache.dir</name>\n        <value>/mnt/datadisk0/zhangdong/rangerdata</value>\n    </property>\n    #The time interval for periodically pulling permission data\n    <property>\n        <name>ranger.plugin.hive.policy.pollIntervalMs</name>\n        <value>30000</value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.policy.rest.client.connection.timeoutMs</name>\n        <value>60000</value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.policy.rest.client.read.timeoutMs</name>\n        <value>60000</value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.policy.rest.ssl.config.file</name>\n        <value></value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.policy.rest.url</name>\n        <value>http://172.21.0.32:6080</value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.policy.source.impl</name>\n        <value>org.apache.ranger.admin.client.RangerAdminRESTClient</value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.service.name</name>\n        <value>hive</value>\n    </property>\n\n    <property>\n        <name>xasecure.hive.update.xapolicies.on.grant.revoke</name>\n        <value>true</value>\n    </property>\n\n</configuration>\n'})}),"\n",(0,r.jsxs)(n.p,{children:["c. In order to obtain the logs of Ranger authentication, add the configuration file log4j.properties in the ",(0,r.jsx)(n.code,{children:"<doris_home>/conf"})," directory."]}),"\n",(0,r.jsx)(n.p,{children:"d. Restart FE."}),"\n",(0,r.jsx)(n.h3,{id:"best-practice",children:"Best Practice"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Create ",(0,r.jsx)(n.code,{children:"user1"})," on the Ranger side and authorize the query permission of db1.table1.col1"]}),"\n",(0,r.jsxs)(n.li,{children:["Create ",(0,r.jsx)(n.code,{children:"role1"})," on the Ranger side and authorize the query permission of db1.table1.col2"]}),"\n",(0,r.jsxs)(n.li,{children:["Create the same ",(0,r.jsx)(n.code,{children:"user1"})," in Doris, ",(0,r.jsx)(n.code,{children:"user1"})," will be directly granted with the query permission of db1.table1.col1"]}),"\n",(0,r.jsxs)(n.li,{children:["Create the same ",(0,r.jsx)(n.code,{children:"role1"})," in Doris, and assign ",(0,r.jsx)(n.code,{children:"role1"})," to ",(0,r.jsx)(n.code,{children:"user1"}),". ",(0,r.jsx)(n.code,{children:"user1"})," will be directly granted with the query permission of db1.table1.col1 and col2 at the same time."]}),"\n",(0,r.jsx)(n.li,{children:"The Admin and Root privileges of Doris are not impacted by Apache Ranger."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"authentication-with-kerberos",children:"Authentication with Kerberos"}),"\n",(0,r.jsx)(n.p,{children:"Kerberos is an authentication protocol designed to provide strong identity verification for applications through the use of encryption with private keys."}),"\n",(0,r.jsx)(n.h3,{id:"environment-settings-1",children:"Environment settings"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"When the services in the cluster are configured with Kerberos authentication, the relevant authentication information is needed in Hive Catalog configuration."}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hadoop.kerberos.keytab"}),": the principal required for authentication. It should be the same as the keytab in the Doris cluster."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hadoop.kerberos.principal"}),": Find the corresponding principal for the hostname in the Doris cluster, such as ",(0,r.jsx)(n.code,{children:"doris/``hostname@HADOOP.COM"}),", and verify with ",(0,r.jsx)(n.code,{children:"klist -kt"})," using the keytab."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"yarn.resourcemanager.principal"}),": Go to the Yarn Resource Manager node and retrieve this from ",(0,r.jsx)(n.code,{children:"yarn-site.xml"}),". Verify the keytab of Yarn with ",(0,r.jsx)(n.code,{children:"klist -kt"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hive.metastore.kerberos.principal"}),": Go to the Hive metadata service node and retrieve this from ",(0,r.jsx)(n.code,{children:"hive-site.xml"}),". Verify the keytab of Hive with ",(0,r.jsx)(n.code,{children:"klist -kt"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hadoop.security.authentication"}),": Enable Hadoop Kerberos authentication."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Place the ",(0,r.jsx)(n.code,{children:"krb5.conf"})," file and ",(0,r.jsx)(n.code,{children:"keytab"})," authentication file on all BE and FE nodes. Ensure consistencyt of the path of the ",(0,r.jsx)(n.code,{children:"keytab"})," authentication file. By default, the ",(0,r.jsx)(n.code,{children:"krb5.conf"})," file is placed in the ",(0,r.jsx)(n.code,{children:"/etc/krb5.conf"})," path. Also, confirm that the JVM parameter ",(0,r.jsx)(n.code,{children:"-Djava.security.krb5.conf"})," and the environment variable ",(0,r.jsx)(n.code,{children:"KRB5_CONFIG"}),"point to the correct path of the ",(0,r.jsx)(n.code,{children:"krb5.conf"})," file."]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"After the configuration is completed, if you cannot locate the issue in the FE and BE logs, you can enable Kerberos debugging."}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["On all FE and BE nodes, locate the ",(0,r.jsx)(n.code,{children:"conf/fe.conf"})," and ",(0,r.jsx)(n.code,{children:"conf/be.conf"})," files in the deployment path."]}),"\n",(0,r.jsxs)(n.li,{children:["After finding the configuration files, set the JVM parameter ",(0,r.jsx)(n.code,{children:"-Dsun.security.krb5.debug=true"})," in the ",(0,r.jsx)(n.code,{children:"JAVA_OPTS"})," variable to enable Kerberos debugging."]}),"\n",(0,r.jsxs)(n.li,{children:["The FE Kerberos authentication debug information can be found in the FE log path ",(0,r.jsx)(n.code,{children:"log/fe.out"}),", and the BE Kerberos authentication debug information can be found in the BE log path ",(0,r.jsx)(n.code,{children:"log/be.out"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["For solutions to more common issues, refer to ",(0,r.jsx)(n.a,{href:"../../faq/lakehouse-faq",children:"FAQ"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"best-practice-1",children:"Best practice"}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:"CREATE CATALOG hive_krb PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hive.metastore.sasl.enabled' = 'true',\n    'hive.metastore.kerberos.principal' = 'your-hms-principal',\n    'hadoop.security.authentication' = 'kerberos',\n    'hadoop.kerberos.keytab' = '/your-keytab-filepath/your.keytab',   \n    'hadoop.kerberos.principal' = 'your-principal@YOUR.COM',\n    'yarn.resourcemanager.principal' = 'your-rm-principal'\n);\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example of HDFS HA information and Kerberos authentication information:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:"CREATE CATALOG hive_krb_ha PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hive.metastore.sasl.enabled' = 'true',\n    'hive.metastore.kerberos.principal' = 'your-hms-principal',\n    'hadoop.security.authentication' = 'kerberos',\n    'hadoop.kerberos.keytab' = '/your-keytab-filepath/your.keytab',   \n    'hadoop.kerberos.principal' = 'your-principal@YOUR.COM',\n    'yarn.resourcemanager.principal' = 'your-rm-principal',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:8088',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:8088',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"hive-transactional-table",children:"Hive transactional table"}),"\n",(0,r.jsxs)(n.p,{children:["Hive transactional tables are tables that support ACID semantics in Hive. For more details, see: ",(0,r.jsx)(n.a,{href:"https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions",children:"https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions"})]}),"\n",(0,r.jsx)(n.h3,{id:"support-for-hive-transactional-tables",children:"Support for Hive transactional tables"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Table Type"}),(0,r.jsx)(n.th,{children:"Supported Operations in Hive"}),(0,r.jsx)(n.th,{children:"Hive Table Properties"}),(0,r.jsx)(n.th,{children:"Supported Hive Versions"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Full-ACID Transactional Table"}),(0,r.jsx)(n.td,{children:"Supports Insert, Update, Delete operations"}),(0,r.jsx)(n.td,{children:"'transactional'='true', 'transactional_properties'='insert_only'"}),(0,r.jsx)(n.td,{children:"3.x, 2.x. In 2.x, loading can only be performed after major compaction is executed in Hive."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Insert-Only Transactional Table"}),(0,r.jsx)(n.td,{children:"Only supports Insert operations"}),(0,r.jsx)(n.td,{children:"'transactional'='true'"}),(0,r.jsx)(n.td,{children:"3.x\uFF0C2.x"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"current-restrictions",children:"Current restrictions"}),"\n",(0,r.jsx)(n.p,{children:"Currently, scenarios involving Original Files are not supported. After a table is converted into a transactional table, subsequent newly written data files will follow the schema of Hive Transactional table. However, existing data files will not be converted to the schema of the Transactional table. These files are referred to as Original Files."})]})}function h(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return o},a:function(){return s}});var t=i(667294);let r={},a=t.createContext(r);function s(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);