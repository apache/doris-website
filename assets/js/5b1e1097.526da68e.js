"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["305933"],{346996:function(e,n,i){i.r(n),i.d(n,{default:()=>d,frontMatter:()=>o,metadata:()=>t,assets:()=>c,toc:()=>l,contentTitle:()=>r});var t=JSON.parse('{"id":"query-acceleration/performance-tuning-overview/tuning-process","title":"Tuning Process","description":"Overview","source":"@site/docs/query-acceleration/performance-tuning-overview/tuning-process.md","sourceDirName":"query-acceleration/performance-tuning-overview","slug":"/query-acceleration/performance-tuning-overview/tuning-process","permalink":"/docs/dev/query-acceleration/performance-tuning-overview/tuning-process","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Tuning Process","language":"en"},"sidebar":"docs","previous":{"title":"Analysis Tools","permalink":"/docs/dev/query-acceleration/performance-tuning-overview/analysis-tools"},"next":{"title":"Materialized View Overview","permalink":"/docs/dev/query-acceleration/materialized-view/overview"}}'),s=i("785893"),a=i("250065");let o={title:"Tuning Process",language:"en"},r=void 0,c={},l=[{value:"Overview",id:"overview",level:2},{value:"Step 1: Use Performance Diagnostic Tools to Identify Slow Queries",id:"step-1-use-performance-diagnostic-tools-to-identify-slow-queries",level:2},{value:"Step 2: Schema Design and Tuning",id:"step-2-schema-design-and-tuning",level:2},{value:"Step 3: Plan Tuning",id:"step-3-plan-tuning",level:2},{value:"Step 4: Execution Tuning",id:"step-4-execution-tuning",level:2},{value:"Summary",id:"summary",level:2}];function u(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",p:"p",ul:"ul",...(0,a.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["Performance tuning is a systematic process that requires a comprehensive methodology and implementation framework for systematic diagnosis and optimization. With the strong support of ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/performance-tuning-overview/diagnostic-tools",children:"diagnostic tools"})," and ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/performance-tuning-overview/analysis-tools",children:"analysis tools"}),", the Doris system can efficiently diagnose, analyze, locate, and resolve performance issues. The complete four-step process for tuning is as follows:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Tuning process",src:i(39248).Z+"",width:"2560",height:"600"})}),"\n",(0,s.jsx)(n.h2,{id:"step-1-use-performance-diagnostic-tools-to-identify-slow-queries",children:"Step 1: Use Performance Diagnostic Tools to Identify Slow Queries"}),"\n",(0,s.jsxs)(n.p,{children:["For business systems running on Doris, use the aforementioned ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/performance-tuning-overview/diagnostic-tools",children:"performance diagnostic tools"})," to identify slow SQL queries."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If Doris Manager is installed, it is recommended to use the Manager's log page for convenient visual identification of slow queries."}),"\n",(0,s.jsxs)(n.li,{children:["If Manager is not installed, you can directly check the ",(0,s.jsx)(n.code,{children:"fe.audit.log"})," file on the FE node or the audit_log system table to obtain a list of slow SQL queries and prioritize them for tuning."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-2-schema-design-and-tuning",children:"Step 2: Schema Design and Tuning"}),"\n",(0,s.jsx)(n.p,{children:"After identifying specific slow SQL queries, the first priority is to inspect and tune the business schema design to eliminate performance issues caused by unreasonable schema design."}),"\n",(0,s.jsx)(n.p,{children:"Schema design tuning can be divided into three aspects:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/optimizing-table-schema",children:"Table-level Schema Design Tuning"}),", such as adjusting the number of partitions and buckets, and field optimization;"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/optimizing-table-index",children:"Index Design and Tuning"})}),"\n",(0,s.jsxs)(n.li,{children:["The use of specific optimization techniques, such as ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/optimizing-join-with-colocate-group",children:"Optimizing Join with Colocate Group"}),". The main goal is to eliminate performance issues caused by unreasonable schema design or failure to fully leverage Doris's existing optimization capabilities."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["For detailed tuning examples, please refer to the documentation on ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/optimizing-table-schema",children:"Plan Tuning"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"step-3-plan-tuning",children:"Step 3: Plan Tuning"}),"\n",(0,s.jsx)(n.p,{children:"After inspecting and tuning the business schema, the main task of tuning begins: plan tuning and execution tuning. As mentioned above, at this stage, the primary task is to make full use of the various levels of Explain tools provided by Doris to systematically analyze the execution plans of slow SQL queries and identify key optimization points for targeted optimization."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For single-table query and analysis scenarios, you can analyze the execution plan to check if ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/optimizing-table-scanning",children:"partition pruning"})," is working properly and ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/transparent-rewriting-with-sync-mv",children:"use single-table materialized views for query acceleration"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["For complex multi-table analysis scenarios, you can analyze the Join Order to determine if it is reasonable and identify specific performance bottlenecks. You can also ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/transparent-rewriting-with-async-mv",children:"use multi-table materialized views for transparent rewriting to accelerate queries"}),". If unexpected situations occur, such as unreasonable Join Order, you can manually specify the Join Hint to bind the execution plan, such as ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/reordering-join-with-leading-hint",children:"using the Leading hint to control Join Order"}),", ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/adjusting-join-shuffle",children:"using the Shuffle Hint to adjust the Join shuffle method"}),", and ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/controlling-hints-with-cbo-rule",children:"using Hints to control cost-based optimization rules"}),", to achieve the goal of tuning the execution plan."]}),"\n",(0,s.jsxs)(n.li,{children:["For specific scenarios, you can also leverage advanced features provided by Doris, such as ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/accelerating-queries-with-sql-cache",children:"using SQL Cache to accelerate queries"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["For detailed tuning examples, please refer to the documentation on ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-plan/optimizing-table-schema",children:"Plan Tuning"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"step-4-execution-tuning",children:"Step 4: Execution Tuning"}),"\n",(0,s.jsx)(n.p,{children:"In the execution tuning stage, you need to validate the effectiveness of plan tuning based on the actual execution of SQL queries. Additionally, within the framework of the existing plan, continue to analyze bottlenecks on the execution side, identify which execution stages are slow, or other common issues such as suboptimal parallelism."}),"\n",(0,s.jsx)(n.p,{children:"Taking multi-table analysis queries as an example, you can analyze the Profile to check if the planned Join order is reasonable, if Runtime Filters are effective, and if the parallelism meets expectations. Furthermore, the Profile can provide feedback on machine load, such as slow I/O or unexpected network transmission performance. When confirming and diagnosing such issues, system-level tools are needed to assist in diagnosis and tuning."}),"\n",(0,s.jsxs)(n.p,{children:["For detailed tuning examples, please refer to the documentation on ",(0,s.jsx)(n.a,{href:"/docs/dev/query-acceleration/tuning/tuning-execution/adjustment-of-runtimefilter-wait-time",children:"Execution Tuning"}),"."]}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsx)(n.p,{children:"When analyzing specific performance issues, it is recommended to first check the plan and then tune the execution. Start by using the Explain tool to confirm the execution plan, and then use the Profile tool to locate and tune execution performance. Reversing the order may lead to inefficiencies and hinder the rapid identification of performance issues."})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"Query tuning is a systematic process, and Doris provides users with tools across various dimensions to facilitate the diagnosis, identification, analysis, and resolution of performance issues at different levels. By familiarizing themselves with these diagnostic and analysis tools and adopting reasonable tuning methods, business personnel and DBAs can quickly and effectively address performance bottlenecks, better unleash Doris's powerful performance advantages, and better adapt to business scenarios for business enablement."})]})}function d(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},39248:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/query-tuning-steps-78b9a475a9dfec9ea7d20834161b3727.jpg"},250065:function(e,n,i){i.d(n,{Z:function(){return r},a:function(){return o}});var t=i(667294);let s={},a=t.createContext(s);function o(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);