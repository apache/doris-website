"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["774313"],{674636:function(e,t,a){a.r(t),a.d(t,{assets:function(){return c},contentTitle:function(){return o},default:function(){return h},frontMatter:function(){return r},metadata:function(){return i},toc:function(){return d}});var i=a(208882),n=a(785893),s=a(250065);let r={title:"Apache Doris helped Netease create a refined operation DMP system",description:"Better data analysis enables users to get better experience. Currently, the normal analysis method is to build a user tags system to accurately generate user portraits and improve user experience. The topic we shared today is the practice of Netease DMP tags system.",date:"2022-11-30",author:"Xiaodong Liu",tags:["Best Practice"],image:"/images/best-practice.png"},o="Apache Doris Helped Netease Create a Refined Operation DMP System",c={authorsImageUrls:[void 0]},d=[{value:"About Netease and Lifease",id:"about-netease-and-lifease",level:2},{value:"About the DMP System",id:"about-the-dmp-system",level:2},{value:"Production of Tags",id:"production-of-tags",level:2},{value:"Tags Storage",id:"tags-storage",level:2},{value:"Advantages of Apache Doris in Practice",id:"advantages-of-apache-doris-in-practice",level:2},{value:"Future Plan",id:"future-plan",level:2}];function l(e){let t={blockquote:"blockquote",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",ul:"ul",...(0,s.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(109436).Z+"",width:"900",height:"383"})}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"Guide: Refined operation is a trend of the future Internet, which requires excellent data analysis. In this article, you will get knowledge of: the construction of Netease Lifease's DMP system and the application of Apache Doris."}),"\n"]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"Author | Xiaodong Liu, Lead Developer, Netease"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Better data analysis enables users to get better experience. Currently, the normal analysis method is to build a user tags system to accurately generate user portraits and improve user experience. The topic we shared today is the practice of Netease DMP tags system."}),"\n",(0,n.jsx)(t.h2,{id:"about-netease-and-lifease",children:"About Netease and Lifease"}),"\n",(0,n.jsx)(t.p,{children:"NetEase (NASDAQ: NTES) is a leading Internet technology company in China, providing users with free emails, gaming, search engine services, news and entertainment, sports, e-commerce and other services."}),"\n",(0,n.jsx)(t.p,{children:"Lifease is Netease's self-operated home furnishing e-commerce brand. Its products cover 8 categories in total: home life, apparel, food and beverages, personal care and cleaning, baby products, outdoor sport, digital home appliances, and Lifease's Special. In Q1 of 2022, Lifease launches \"Pro \" membership and other multiple memberships for different users. The number of Pro members has increased by 65% \u200B\u200Bcompared with the previous year."}),"\n",(0,n.jsx)(t.h2,{id:"about-the-dmp-system",children:"About the DMP System"}),"\n",(0,n.jsx)(t.p,{children:"DMP system plays an important role in Lifease's data analysis.\nThe data sources of DMP mainly include:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Business logs of APPs, H5s, PCs and other terminals"}),"\n",(0,n.jsx)(t.li,{children:"Basic data constructed within NetEase Group"}),"\n",(0,n.jsx)(t.li,{children:"Data from products sold by third-party such as JD.com, Alibaba, and Bytedance\nThrough data collection and data cleaning, the above data is ingested into data assets. Based on these data, DMP has created a system of functions, such as tag creation, grouping and portrait analysis, which supports the business including: intelligent product matching, user engagement, and user insight. In general, the DMP system concentrates on building a data-centric tagging system and portrait system to assist the business."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"You can get basic knowledge of the DMP system starting from the concepts below:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Tagging: Tagging is one of the user monitoring abilities to uniquely identify individual users across different browsers, devices, and user sessions. This approach to user tagging works by capturing available data in your application's page source: age, address, preference and other variables."}),"\n",(0,n.jsx)(t.li,{children:"Targeting: Target audience may be dictated by age, gender, income, location, interests or a myriad of other factors."}),"\n",(0,n.jsx)(t.li,{children:'User Portrait Analysis: User portrait analysis is to develop user profiles, actions and attributes after targeting audience. For instance, check the behavior paths and consumption models of users whose portraits are "City: Hangzhou, Gender: Female" on Lifease APP.'}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(620657).Z+"",width:"1153",height:"642"})}),"\n",(0,n.jsx)(t.p,{children:"Llifease's tagging system mainly provides two core capabilities:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"Tag Query: the ability to query the specified tag of a specific entity, which is often used to display basic information."}),"\n",(0,n.jsx)(t.li,{children:"Targeting Audience: for both real-time and offline targets. Result after targeting is mainly used for:"}),"\n"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"As Grouping Criteria: It can be used to tell if the user is in one or more specified groups. This occasionally occurs in scenarios such as advertising and contact marketing."}),"\n",(0,n.jsx)(t.li,{children:"Resultset Pull: Extract specified data to business system for customized development."}),"\n",(0,n.jsx)(t.li,{children:"Portrait Analysis: Analyze the behavioral and consumption models in specific groups of people for more refined operations."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"The overall business process is as follows:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(241644).Z+"",width:"1223",height:"662"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"First define the rules for tags and grouping;"}),"\n",(0,n.jsx)(t.li,{children:"After defining the DSL, the task can be submitted to Spark for processing;"}),"\n",(0,n.jsx)(t.li,{children:"After the processing is done, the results can be stored in Hive and Doris;"}),"\n",(0,n.jsx)(t.li,{children:"Data from Hive or Doris can be queried and used according to the actual business needs."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(638193).Z+"",width:"1197",height:"706"})}),"\n",(0,n.jsx)(t.p,{children:"The DMP platform is divided into four modules: Processing&storage layer, scheduling layer, service layer, and metadata management.\nAll tag meta-information is stored in the source data table; The scheduling layer schedules tasks for the entire business process: Data processing and aggregation are converted into basic tags, and the data in the basic tags and source tables are converted into something that can be used for data query through SQL; The scheduling layer dispatches tasks to Spark to process, and then stores results in both Hive and Doris. The service layer consists of four parts: tag service, entity grouping service, basic tag data service, and portrait analysis service."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(155176).Z+"",width:"1124",height:"648"})}),"\n",(0,n.jsx)(t.p,{children:"The lifecycle of tag consists of 5 phases:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Tag requirements: At this stage, the operation team demands and the product manager team evaluates the rationality and urgency of the requirements."}),"\n",(0,n.jsx)(t.li,{children:"Scheduling production: Developers first sort out the data from ODS to DWD, which is the entire link of DM layer. Secondly, they build a model based on data, and at the same time, monitor the production process."}),"\n",(0,n.jsx)(t.li,{children:"Targeting Audience: After the tag is produced, group the audience by those tags."}),"\n",(0,n.jsx)(t.li,{children:"Precision marketing: Carry out precision marketing strategy to people grouped by."}),"\n",(0,n.jsx)(t.li,{children:"Effect evaluation: In the end, tage usage rate and use effect need to be evaluated for future optimization."}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"production-of-tags",children:"Production of Tags"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(256572).Z+"",width:"1145",height:"675"})}),"\n",(0,n.jsx)(t.p,{children:"Tag data layering:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"The bottom layer is the ODS layer, including user login logs, event tracking records, transaction data, and Binlog data of various databases"}),"\n",(0,n.jsx)(t.li,{children:"The data processed by the ODS layer, such as user login table, user activity table and order information table reaches the DWD detail layer"}),"\n",(0,n.jsx)(t.li,{children:"The DWD layer data is aggregated to the DM layer and the tags are all implemented based on the DM layer data.\nAt present, we have fully automated the data output from the original database to the ODS layer. And we also realized partial automation from the ODS layer to the DWD layer. And there are a small number of automated operations from the DWD to the DM layer, which will be our focus in the future."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(60211).Z+"",width:"1154",height:"677"})}),"\n",(0,n.jsx)(t.p,{children:"Tags are devided based on timeliness: offline tags, quasi-real-time tags and real-time tags. According to the scale of data, it is divided into: aggregation tags and detail tags. In other cases, tags can also be divided into: account attribute tags, consumption behavior tags, active behavior tags, user preference tags, asset information tags, etc."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(386605).Z+"",width:"1163",height:"672"})}),"\n",(0,n.jsx)(t.p,{children:"It is inconvenient to use the data of the DM layer directly because the basic data is relatively primitive. The abstraction level is lacking and it is not easy to use. By combining basic data with AND, OR, and NOT, business tags are formed for further use, which can reduce the cost of understanding operations and make it easier to use."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(159301).Z+"",width:"1161",height:"696"})}),"\n",(0,n.jsx)(t.p,{children:"After the tags are merged, it is necessary to apply the tags to specific business scenarios, such as grouping. The configuration is shown on the left side of the figure above, which supports offline crowd packages and real-time behaviors (need to be configured separately). After configuration, generate the DSL rules shown on the right side of the figure above, expressed in Json format, which is more friendly to FE, and can also be converted into query statements of the datebase engine."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(248892).Z+"",width:"1120",height:"649"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(661822).Z+"",width:"1114",height:"649"})}),"\n",(0,n.jsx)(t.p,{children:"Tagging is partially automated. The degree of automation in grouping is relatively high. For example, group refresh can be done regularly every day; Advanced processing, such as intersection/merge/difference between groups; Data cleaning means timely cleaning up expired and invalid data."}),"\n",(0,n.jsx)(t.h2,{id:"tags-storage",children:"Tags Storage"}),"\n",(0,n.jsx)(t.p,{children:"Lifease's DMP labeling system needs to carry relatively large customer end traffic, and has relatively high requirements for real-time performance. Our storage requirements include:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Need support high-performance query to deal with large-scale customer end traffic"}),"\n",(0,n.jsx)(t.li,{children:"Need support SQL to facilitate data analysis scenarios"}),"\n",(0,n.jsx)(t.li,{children:"Need support data update mechanism"}),"\n",(0,n.jsx)(t.li,{children:"Can store large amount of data"}),"\n",(0,n.jsx)(t.li,{children:"Need support for extension functions to handle custom data structures"}),"\n",(0,n.jsx)(t.li,{children:"Closely integrated with big data ecology"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"In the field of big data, multiple engines vary in different applicable scenarios. We used the popular engines in the chart below to optimize our database architecture for 2 times."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(663664).Z+"",width:"1133",height:"660"})}),"\n",(0,n.jsx)(t.p,{children:"Our architecture V1.0 is shown below:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(715178).Z+"",width:"1175",height:"695"})}),"\n",(0,n.jsx)(t.p,{children:"Most of the offline data is stored in Hive while a small part is stored in Hbase (mainly used for querying basic tags). Part of the real-time data is stored in Hbase for basic tags query and the rest is double-written into KUDU and Elasticsearch for real-time grouping and data query. The data offline is processed by Impala and cached in Redis.\nDisadvantages :"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Too many database engines."}),"\n",(0,n.jsx)(t.li,{children:"Double writing has hidden problems with data quality. One side may succeed while the other side fails, resulting in data inconsistency."}),"\n",(0,n.jsx)(t.li,{children:"The project is complex and maintainability is poor.\nIn order to reduce the usage of engine and storage, we improved and implemented version 2.0 :"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(777974).Z+"",width:"1148",height:"677"})}),"\n",(0,n.jsx)(t.p,{children:"In storage architecture V2.0, Apache Doris is adopted. Offline data is mainly stored in Hive. At the same time, basic tags are imported into Doris, and real-time data as well. The query federation of Hive and Doris is performed based on Spark, and the results are stored in Redis. After this improvement, an storage engine which can manages offline and real-time data has been created. We are currently use Apache Doris 1.0, which enables : 1. The query performance can be controlled within 20ms at 99% 2.  The query performance can be controlled within 50ms at 99.9%.  Now the architecture is simplified, which greatly reduces operation and maintenance costs."}),"\n",(0,n.jsx)(t.h2,{id:"advantages-of-apache-doris-in-practice",children:"Advantages of Apache Doris in Practice"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(708158).Z+"",width:"1128",height:"658"})}),"\n",(0,n.jsx)(t.p,{children:"Lifeuse has adopted Apache Doris to check, batch query, path analyse and grouping. The advantages are as follows:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"The query federation performance of  key query and a small number of tables exceeds 10,000 QPS, with RT99<50MS."}),"\n",(0,n.jsx)(t.li,{children:"The horizontal expansion capability is relatively strong and maintenance cost is relatively low."}),"\n",(0,n.jsx)(t.li,{children:"The offlin and real-time data are unified to reduce the complexity of the tags model."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"The downside is that importing a large amount of small data takes up more resources. But this problem has been optimized in Doris 1.1. Apache Doris has greatly enhanced the data compaction capability in version 1.1, and can quickly complete aggregation of new data, avoiding the -235 error caused by too many versions of sharded data and the low query efficiency problems."}),"\n",(0,n.jsx)(t.h2,{id:"future-plan",children:"Future Plan"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"1280X1280",src:a(183989).Z+"",width:"1117",height:"652"})}),"\n",(0,n.jsx)(t.p,{children:"Hive and Spark are gradually turning into Apache Doris.\nOptimize the tagging system:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Establish a rich and accurate tag evaluation system"}),"\n",(0,n.jsx)(t.li,{children:"Improve tag quality and output speed"}),"\n",(0,n.jsx)(t.li,{children:"Improve tag coverage\nMore precision operation:"}),"\n",(0,n.jsx)(t.li,{children:"Build a rich user analysis model"}),"\n",(0,n.jsx)(t.li,{children:"Improve the user insight model evaluation system based on the frequency of use and user value"}),"\n",(0,n.jsx)(t.li,{children:"Establish general image analysis capabilities to assist intelligent decision-making in operations"}),"\n"]})]})}function h(e={}){let{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},661822:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/10__automation-fe72dc6c87f37fdd94f217a9174706bd.png"},663664:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/11__comparision-dd0d69a571e362dcca7711561a30db7c.png"},715178:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/12__architecture_v1_0-59dffe2265ac0754860a4bc796c090fa.png"},777974:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/13__architecture_v2_0-1f1c2b508793cf146a606b3a453e01a5.png"},708158:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/14__advantages_in_practice-3fc1c9893383a6635c8c9612e3ef0a15.png"},183989:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/15__future_plan-199b125bad243e0dcd93f00b9f4395fe.png"},620657:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/1__core_capability-188f05fadbac0c4dfa3574a4e140cb8b.png"},241644:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/2__business_process-ca10e9f507ff8157caa521d0c44d7fc4.png"},638193:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/3__dmp_architecture-82a3358b3eb8794fcff543415248505e.png"},155176:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/4__tag_lifecycle-ec086d95f04379a7f9a10993c0089e63.png"},256572:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/5__production_of_tags-a53f5f1d2e03dc74f8d0e69092e4bd02.png"},60211:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/6__type_of__tags-91b30c2315a91d57aa96017a4ec716eb.png"},386605:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/7__tags_settings-8a8c1c99a4afbc7f78ceb4659da2c184.png"},159301:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/8__target_audience-cfe11c32b47db0639303f640a3452d98.png"},248892:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/9__target_audience-mapping-1b00b571d178577b4f0c4f2c8a5b1acf.png"},109436:function(e,t,a){a.d(t,{Z:function(){return i}});let i=a.p+"assets/images/kv-a63c2e8908df91d10704f971aa636fa6.png"},250065:function(e,t,a){a.d(t,{Z:function(){return o},a:function(){return r}});var i=a(667294);let n={},s=i.createContext(n);function r(e){let t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),i.createElement(s.Provider,{value:t},e.children)}},208882:function(e){e.exports=JSON.parse('{"permalink":"/blog/Netease","source":"@site/blog/Netease.md","title":"Apache Doris helped Netease create a refined operation DMP system","description":"Better data analysis enables users to get better experience. Currently, the normal analysis method is to build a user tags system to accurately generate user portraits and improve user experience. The topic we shared today is the practice of Netease DMP tags system.","date":"2022-11-30T00:00:00.000Z","tags":[{"inline":true,"label":"Best Practice","permalink":"/blog/tags/best-practice"}],"hasTruncateMarker":false,"authors":[{"name":"Xiaodong Liu","key":null,"page":null}],"frontMatter":{"title":"Apache Doris helped Netease create a refined operation DMP system","description":"Better data analysis enables users to get better experience. Currently, the normal analysis method is to build a user tags system to accurately generate user portraits and improve user experience. The topic we shared today is the practice of Netease DMP tags system.","date":"2022-11-30","author":"Xiaodong Liu","tags":["Best Practice"],"image":"/images/best-practice.png"},"unlisted":false,"prevItem":{"title":"JD.com\'s exploration and practice with Apache Doris in real time OLAP","permalink":"/blog/JD_OLAP"},"nextItem":{"title":"The application of Apache Doris in NIO","permalink":"/blog/NIO"}}')}}]);