"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["614275"],{326180:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>o,metadata:()=>s,assets:()=>a,toc:()=>d,contentTitle:()=>r});var s=JSON.parse('{"id":"admin-manual/cluster-management/elastic-expansion","title":"Elastic Scaling","description":"Doris supports online elastic scaling, allowing users to dynamically add or remove nodes without interrupting services. This capability ensures businesses can meet growing demands or reduce idle resource waste. Scaling up or down BE nodes does not affect cluster availability but involves data migration, so it is recommended to perform scaling operations during periods of low business activity.","source":"@site/docs/admin-manual/cluster-management/elastic-expansion.md","sourceDirName":"admin-manual/cluster-management","slug":"/admin-manual/cluster-management/elastic-expansion","permalink":"/docs/dev/admin-manual/cluster-management/elastic-expansion","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Elastic Scaling","language":"en"},"sidebar":"docs","previous":{"title":"Upgrading Cluster","permalink":"/docs/dev/admin-manual/cluster-management/upgrade"},"next":{"title":"Load Balancing","permalink":"/docs/dev/admin-manual/cluster-management/load-balancing"}}'),i=t("785893"),l=t("250065");let o={title:"Elastic Scaling",language:"en"},r=void 0,a={},d=[{value:"Scale In/Out the FE Clusters",id:"scale-inout-the-fe-clusters",level:2},{value:"Scale the FE out",id:"scale-the-fe-out",level:3},{value:"Scale In the FE Cluster",id:"scale-in-the-fe-cluster",level:3},{value:"Scale In/Out the BE Cluster",id:"scale-inout-the-be-cluster",level:2},{value:"Scale Out the BE Cluster",id:"scale-out-the-be-cluster",level:3},{value:"Scale In the BE Cluster",id:"scale-in-the-be-cluster",level:3},{value:"DECOMMISSION Command Description:",id:"decommission-command-description",level:3}];function c(e){let n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Doris supports online elastic scaling, allowing users to dynamically add or remove nodes without interrupting services. This capability ensures businesses can meet growing demands or reduce idle resource waste. Scaling up or down BE nodes does not affect cluster availability but involves data migration, so it is recommended to perform scaling operations during periods of low business activity."}),"\n",(0,i.jsx)(n.h2,{id:"scale-inout-the-fe-clusters",children:"Scale In/Out the FE Clusters"}),"\n",(0,i.jsx)(n.p,{children:"Doris FE nodes are divided into the following three roles, with each FE node containing a full set of metadata:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Master Node: Responsible for reading and writing metadata. When metadata changes occur on the Master node, they are synchronized to non-Master nodes via the BDB JE protocol. There can be only one Master FE node in the cluster."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Follower Node: Responsible for reading metadata. In the event of a Master node failure, Follower nodes initiate a leader election to select a new Master node. Within the cluster, the total number of Master and Follower nodes is recommended to be an odd number."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Observer Node: Responsible for reading metadata but does not participate in leader election. It is used to extend the read service capacity of FE nodes."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Typically, each FE node can handle the load operations of 10-20 BE nodes. A configuration of 3 FE nodes is sufficient to meet the requirements of most business scenarios."}),"\n",(0,i.jsx)(n.h3,{id:"scale-the-fe-out",children:"Scale the FE out"}),"\n",(0,i.jsxs)(n.admonition,{title:"Note:",type:"info",children:[(0,i.jsx)(n.p,{children:"When adding a new FE node, please pay attention to the following:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"http_port"})," of the new FE node must match the ",(0,i.jsx)(n.code,{children:"http_port"})," of all existing FE nodes in the cluster."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"If adding a Follower node, it is recommended that the total number of Master and Follower nodes in the cluster be an odd number."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["You can view the ports and roles of the current cluster nodes using the ",(0,i.jsx)(n.code,{children:"show frontends"})," command."]}),"\n"]}),"\n"]})]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Start FE Node:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"fe/bin/start_fe.sh --helper <leader_fe_host>:<edit_log_port> --daemon\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Register FE Node:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Register the node as a Follower FE:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER SYSTEM ADD FOLLOWER "<follower_host>:<edit_log_port>";\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Register the node as an Observer FE:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER SYSTEM ADD OBSERVER "<observer_host>:<edit_log_port>";\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check the status of the newly added FE node"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"show frontends;\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"scale-in-the-fe-cluster",children:"Scale In the FE Cluster"}),"\n",(0,i.jsx)(n.p,{children:"When scaling in FE nodes, ensure that the total number of Master and Follower nodes in the cluster remains an odd number. Use the following commands to remove nodes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER SYSTEM DROP FOLLOWER[OBSERVER] "<fe_host>:<edit_log_port>";\n'})}),"\n",(0,i.jsx)(n.p,{children:"After scaling in, you need to manually delete the FE directory."}),"\n",(0,i.jsx)(n.h2,{id:"scale-inout-the-be-cluster",children:"Scale In/Out the BE Cluster"}),"\n",(0,i.jsx)(n.h3,{id:"scale-out-the-be-cluster",children:"Scale Out the BE Cluster"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Start the BE process:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"be/bin/start_be.sh\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Register the BE node:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER SYSTEM ADD backend '<be_host>:<be_heartbeat_service_port>';\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"scale-in-the-be-cluster",children:"Scale In the BE Cluster"}),"\n",(0,i.jsx)(n.p,{children:"When scaling in BE nodes, you can choose between the DROP or DECOMMISSION methods:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{}),(0,i.jsx)(n.th,{children:"DROP"}),(0,i.jsx)(n.th,{children:"DECOMMISSION"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Principle"}),(0,i.jsx)(n.td,{children:"Directly remove the node, deleting the BE node."}),(0,i.jsx)(n.td,{children:"Initiates a command to migrate data on the BE node to other nodes. Once migration is complete, the BE node is automatically removed."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Effective Time"}),(0,i.jsx)(n.td,{children:"Takes effect immediately after execution."}),(0,i.jsx)(n.td,{children:"Takes effect after data migration is completed. Depending on the cluster's existing data volume, this can take hours to up to a day."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Single Replica Table Handling"}),(0,i.jsx)(n.td,{children:"May result in data loss."}),(0,i.jsx)(n.td,{children:"Does not result in data loss."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Removing Multiple Nodes Simultaneously"}),(0,i.jsx)(n.td,{children:"May result in data loss."}),(0,i.jsx)(n.td,{children:"Does not result in data loss."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Production Recommendation"}),(0,i.jsx)(n.td,{children:"Not recommended for production environments."}),(0,i.jsx)(n.td,{children:"Recommended for production environments."})]})]})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Use the following command to remove a BE node using the DROP method:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER SYSTEM DROP backend "<be_host>:<be_heartbeat_service_port>";\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Use the following command to remove a BE node using the DECOMMISSION method:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'ALTER SYSTEM DECOMMISSION backend "<be_host>:<be_heartbeat_service_port>";\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"decommission-command-description",children:"DECOMMISSION Command Description:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["DECOMMISSION is an asynchronous operation. After execution, you can see the BE node's ",(0,i.jsx)(n.code,{children:"SystemDecommissioned"})," status set to ",(0,i.jsx)(n.code,{children:"true"})," via ",(0,i.jsx)(n.code,{children:"SHOW backends;"}),". This indicates the node is being removed."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The DECOMMISSION command may fail. For instance, if there is insufficient storage space on the remaining BE nodes to accommodate the data from the BE being removed, or if the remaining nodes do not meet the minimum replication requirements, the command will not complete, and the BE will remain in a ",(0,i.jsx)(n.code,{children:"SystemDecommissioned"})," state set to ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The progress of DECOMMISSION can be monitored using ",(0,i.jsx)(n.code,{children:"SHOW PROC '/backends';"}),". If the operation is in progress, the ",(0,i.jsx)(n.code,{children:"TabletNum"})," value will decrease continuously."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["You can cancel the operation using the command ",(0,i.jsx)(n.code,{children:'CANCEL DECOMMISSION BACKEND "be_host:be_heartbeat_service_port";'}),". After cancellation, the BE node will retain its current remaining data, and Doris will re-balance the load."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The data migration rate can be adjusted by modifying the ",(0,i.jsx)(n.code,{children:"balance_slot_num_per_path"})," parameter."]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return r},a:function(){return o}});var s=t(667294);let i={},l=s.createContext(i);function o(e){let n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);